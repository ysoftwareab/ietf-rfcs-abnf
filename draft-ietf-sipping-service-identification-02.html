<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Identification of Communications Services in the Session Initiation
	Protocol (SIP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Identification of Communications Services in the Session Initiation
	Protocol (SIP)">
<meta name="keywords" content="SIP, IMS">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIPPING</td><td class="header">J. Rosenberg</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Cisco</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">July 15, 2008</td></tr>
<tr><td class="header">Expires: January 16, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Identification of Communications Services in the Session Initiation
	Protocol (SIP)<br />draft-ietf-sipping-service-identification-02</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 16, 2009.</p>

<h3>Abstract</h3>

<p>This document considers the problem of service
	    identification in the Session Initiation Protocol
	    (SIP). Service identification is the process of
	    determining the user-level use case that is driving the
	    signaling being utilized by the user agent. This document
	    discusses the uses of service identification, and outlines
	    several architectural principles behind the process. It
	    identifies perils when service identification is not done
	    properly - including fraud, interoperability failures and
	    stifling of innovation.
	    
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#sec-defs">2.</a>&nbsp;
Services and Service Identification<br />
<a href="#sec-examples">3.</a>&nbsp;
Example Services<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-ex-iptv">3.1.</a>&nbsp;
IPTV vs. Multimedia<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-ex-game">3.2.</a>&nbsp;
Gaming vs. Voice Chat<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-ex-game2">3.3.</a>&nbsp;
Gaming vs. Voice Chat #2<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-ex-config">3.4.</a>&nbsp;
Configuration vs. Pager Messaging<br />
<a href="#sec-use">4.</a>&nbsp;
Using Service Identification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">4.1.</a>&nbsp;
Application Invocation in the User Agent<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.2.</a>&nbsp;
Application Invocation in the Network<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">4.3.</a>&nbsp;
Network Quality of Service Authorization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.4.</a>&nbsp;
Service Authorization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.5.</a>&nbsp;
Accounting and Billing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.6.</a>&nbsp;
Negotiation of Service<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.7.</a>&nbsp;
Dispatch to Devices<br />
<a href="#sec-key">5.</a>&nbsp;
Key Principles of Service Identification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">5.1.</a>&nbsp;
Services are a By-Product of Signaling<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.2.</a>&nbsp;
Identical Signaling Produces Identical Services<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.3.</a>&nbsp;
Do What I Say, not What I Mean<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.4.</a>&nbsp;
Explicit Service Identifiers are Redundant<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">5.5.</a>&nbsp;
URIs are Key for Differentiated Signaling<br />
<a href="#sec-problems">6.</a>&nbsp;
Perils of Declarative Service
				      Identification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-fraud">6.1.</a>&nbsp;
Fraud<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">6.2.</a>&nbsp;
Systematic Interoperability Failures<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">6.3.</a>&nbsp;
Stifling of Service Innovation<br />
<a href="#anchor16">7.</a>&nbsp;
Recommendations<br />
<a href="#anchor17">8.</a>&nbsp;
Security Considerations<br />
<a href="#anchor18">9.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor19">10.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">11.</a>&nbsp;
Informational References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
The Session Initiation Protocol (SIP) <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> defines
mechanisms for initiating and managing communications sessions between
agents. SIP allows for a broad array of session types between
agents. It can manage audio sessions, ranging from low bitrate voice-only up to
multi-channel hi fidelity music. It can manage video sessions, ranging
from small, "talking-head" style video chat, up to high definition
multipoint video conferencing, to low bandwidth user-generated
content, up to high definition movie and TV content. SIP endpoints can
be anything - adaptors that convert an old analog telephone to Voice
over IP (VoIP), dedicated hardphones, fancy hardphones with rich
displays and user entry capabilities, softphones on a PC, buddylist
and presence applications on a PC, dedicated videoconferencing
peripherals, and speakerphones.

</p>
<p>
This breadth of applicability is SIP's greatest asset, but it also
introduces numerous challenges. One of these is that, when an endpoint
generates a SIP INVITE for a session, or receives one, that session
can potentially be within the context of any number of different use
cases and endpoint types. For example, a SIP INVITE with a single
audio stream could represent a Push-To-Talk session between mobile
devices, a VoIP session between softphones, or audio-based access to
stored content on a server.

</p>
<p>
Each of these different use cases represents a different service. The
service is the user-visible use case that is driving 
the behavior of the user-agents and servers in the SIP
network. 

</p>
<p>
The differing services possible with SIP has driven implementors and system
designers to seek techniques for service identification. Service
identification is the process of determining and/or signaling the
specific use case that is driving the signaling being generated by a
user agent. At first glance, this seems harmless and easy enough. It
is tempting to define a new header, "Service-ID", for example, and
have a user agent populate it with any number of well-known tokens
which define what the service is. It could then be consumed for any
number of purposes. A service identifier placed into the
signaling is called a service identifier. 

</p>
<p>Service identification and service identifiers, when used properly,
can be beneficial. However, when done improperly, service
identification can lead to fraud, systemic interoperability failures,
and a complete stifling of the innovation that SIP was meant to
achieve. The purpose of this document is to describe service
identification in more detail and describe how these problems arise.

</p>
<p>
<a class='info' href='#sec-defs'>Section&nbsp;2<span> (</span><span class='info'>Services and Service Identification</span><span>)</span></a> begins by defining a service and the service
identification problem. <a class='info' href='#sec-examples'>Section&nbsp;3<span> (</span><span class='info'>Example Services</span><span>)</span></a> gives some
concrete examples of services and why they can be challenging to
identify. <a class='info' href='#sec-use'>Section&nbsp;4<span> (</span><span class='info'>Using Service Identification</span><span>)</span></a> explores the ways in which a
service identification can be utilized within a network. Next,
<a class='info' href='#sec-key'>Section&nbsp;5<span> (</span><span class='info'>Key Principles of Service Identification</span><span>)</span></a> discusses the key architectural principles of
service identification. <a class='info' href='#sec-problems'>Section&nbsp;6<span> (</span><span class='info'>Perils of Declarative Service 				      Identification</span><span>)</span></a> describes what
explicit service invocation is, and how it can lead to fraud, interoperability
failures, and stifling of service innovation.

</p>
<a name="sec-defs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Services and Service Identification</h3>

<p>
The problem of identifying services within SIP is not a
new one. The problem has been considered extensively in the context of
presence. In particular, the presence data model for SIP <a class='info' href='#RFC4479'>[RFC4479]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Data Model for Presence,&rdquo; July&nbsp;2006.</span><span>)</span></a> defines the concept of a service as one of the core
notions that presence describes. Services are described in Section 3.3
of RFC 4479. 

</p>
<p>
Essentially, the service is the user-visible use case that is driving
the behavior of the user-agents and servers in the SIP
network. Being user-visible means that there is a difference in
user experience between two services that are different. That user
experience can be part of the call, or outside of the call. Within a
call, the user
experience can be based on different media types (an audio call vs. a
video chat), different content within a particular media type (stored
content, such as a movie or TV session), different devices (a wireless
device for "telephony" vs. a PC application for "voice-chat"),
different user interfaces (a buddy list view of voice on a PC
application vs. a software emulation of a hard phone), different
communities that can be accessed (voice chat with other users that
have the same voice chat client, vs. voice communications with any
endpoint on the PSTN), or different applications that are invoked by
the user (manually selecting a push-to-talk application from a
wireless phone vs. a telephony application). Outside of a call, the
difference in user experience can be a billing one (cheaper for one
service than other), a notification feature for one and not another
(for example, an IM that gets sent whenever a user makes a call), and
so on. 

</p>
<p>
In some cases, there is very little difference in the underlying
technology that will support two different services, and in other
cases, there are big differences. However, for purposes of this
discussion, the key definition is that two services are distinct when
there is a perceived difference by the user in the two services. 

</p>
<p>
This leads naturally to the desire to perform service
identification. Service identification is defined as the process of:
</p>
<ol class="text">
<li> determination of the underlying service which is driving a
particular signaling exchange,
</li>
<li> associating that service with a service identifier, and 
</li>
<li> attaching that moniker to a signaling message
(typically a SIP INVITE)

</li>
</ol><p>

</p>
<p>
Once service identification is performed, the service identifier can
then be used for various purposes within the network. Service
identification can be done in the endpoints, in which case the UA
would insert the moniker directly into the signaling message based on
its awareness of the service. Or, it can be done within a server in
the network (such as a proxy), based on inspection of the SIP message,
or based on hints placed into the message by the user.

</p>
<p>
When service identification is performed entirely by inspecting the
signaling, this is called derived service identification. When
it is done based on knowledge known only by the invoking user
agent, it is called declarative service identification. Declarative
service identification can only be done in user agents, by definition.

</p>
<a name="sec-examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Example Services</h3>

<p>
It is very useful to consider several example services, especially
ones that appear difficult to differentiate from each other. In cases
where it is hard to differentiate, service identification - and in
particular, declarative service identification - appears highly
attractive (and indeed, required). 

</p>
<a name="sec-ex-iptv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
IPTV vs. Multimedia</h3>

<p>
IP Television (IPTV) is the usage of IP networks to access traditional
television content, such as movies and shows. SIP can be utilized to
establish a session to a media server in a network, which then serves
up multimedia content and streams it as an audio and video stream
towards the client. Whether SIP is ideal for IPTV is, in itself, a
good question. However, such a discussion is outside the scope of this
document. 

</p>
<p>
Consider multimedia conferencing. The user accesses a voice and video
conference at a conference server. The user might join in listen-only
mode, in which case the user receives audio and video streams, but
does not send.

</p>
<p>
These two services - IPTV and listen-only multimedia conferencing,
clearly appear as different services. They have different user
experiences and applications. A user is unlikely to ever be confused
about whether a session is IPTV or listen-only multimedia
conferencing. Indeed, they are likely to have different software
applications or endpoints for the two services.

</p>
<p>
However, these two services look remarkably alike based on the
signaling. Both utilize audio and video. Both could utilize the same
codecs. Both are unidirectional streams (from a server in the network
to the client). Thus, it would appear on the surface that there is no
way to differentiate them, based on inspection of the signaling
alone. 

</p>
<a name="sec-ex-game"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Gaming vs. Voice Chat</h3>

<p>
Consider an interactive game, played between two users from their
mobile devices. The game involves the users sending each other game
moves, using a messaging channel, in addition to voice. In another
service, users have a voice and IM chat conversation using a buddy
list application on their PC.

</p>
<p>
In both services, there are two media streams - audio and
messaging. The audio uses the same codecs. Both use the Message
Session Relay Protocol (MSRP) <a class='info' href='#RFC4975'>[RFC4975]<span> (</span><span class='info'>Campbell, B., Mahy, R., and C. Jennings, &ldquo;The Message Session Relay Protocol (MSRP),&rdquo; September&nbsp;2007.</span><span>)</span></a>. In both cases, the caller
would send an INVITE to the Address of Record (AOR) of the target
user. However, these 
represent fairly different services, in terms of user experience.

</p>
<a name="sec-ex-game2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Gaming vs. Voice Chat #2</h3>

<p>
Consider a variation on the example in
<a class='info' href='#sec-ex-game'>Section&nbsp;3.2<span> (</span><span class='info'>Gaming vs. Voice Chat</span><span>)</span></a>. In this variation, two users are playing
an interactive game between their phones. However, the game itself is
set up and controlled using a proprietary mechanism - not using SIP at
all. However, the client application allows the user to chat with
their opponent. The chat session is a simple voice session setup
between the players.

</p>
<p>
Compare this with a basic telephone call between the two users. Both
involve a single audio session. Both use the same codecs. They appear
to be identical. However, different user experiences are needed. For
example, we desire traditional telephony features 
(such as call forwarding and call screening) to be applied in the
telephone service, but not in the gaming chat service. 

</p>
<a name="sec-ex-config"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Configuration vs. Pager Messaging</h3>

<p>
The SIP MESSAGE method <a class='info' href='#RFC3428'>[RFC3428]<span> (</span><span class='info'>Campbell, B., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a> provides a way to send
one-shot messages to a particular AOR. This specification is primarily
aimed at Short Message Service (SMS) style messaging, commonly found
in wireless phones. Receipt of a MESSAGE request would cause the
messaging application on a phone to launch, allowing the user to
browse message history and respond. 

</p>
<p>
However, MESSAGE is sometimes used for the delivery of content to a
device for other purposes. For example, some providers use it to
deliver configuration updates, such as new phone settings or
parameters, or to indicate that a new version of firmware is
available. Though not designed for this purpose, MESSAGE gets used
since, in existing wireless networks, SMS is used for this purpose,
and MESSAGE is the SIP equivalent of SMS.

</p>
<p>
Consequently, the MESSAGE request sent to a phone can be for two
different services. One would require invocation of a messaging app,
whereas the other would be consumed by the software in the phone,
without any user interaction at all. 

</p>
<a name="sec-use"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Using Service Identification</h3>

<p>
It is important to understand what the service identity would be
utilized for, if known. This section discusses the primary uses. These
are application invocation in user agents and the network, Quality of
Service authorization, service authorization, accounting and billing,
service negotiation, and device dispatch. 

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Application Invocation in the User Agent</h3>

<p>
In some of the examples above, there were multiple software
applications executing on the host. One common way of achieving this
is to utilize a common SIP user agent implementation that
listens for requests on a single port. When an incoming
INVITE or MESSAGE arrives, it must be delivered to the appropriate
application software. When each service is bound to a distinct
software application, it would seem that the service identity is
needed to dispatch the message to the appropriate piece of
software. This is shown in <a class='info' href='#fig-model'>Figure&nbsp;1</a>.

</p><br /><hr class="insert" />
<a name="fig-model"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
                +---------------------------------+
                |                                 |
                | +-------------+ +-------------+ |
                | |     UI      | |     UI      | |
                | +-------------+ +-------------+ |
                | +-------------+ +-------------+ |
                | |             | |             | |
                | |  Service 1  | |  Service 2  | |
                | |             | |             | |
                | +-------------+ +-------------+ |
                | +-----------------------------+ |
                | |                             | |
                | |             SIP             | |
                | |            Layer            | |
                | |                             | |
                | +-----------------------------+ |
                |                                 |
                +---------------------------------+

                          Physical Device
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
The role of the SIP layer is to parse incoming messages, handle the
SIP state machinery for transactions and dialogs, and then dispatch
request to the appropriate service. This software architecture is
analagous to the way web servers frequently work. An HTTP server
listens on port 80 for requests, and based on the HTTP Request-URI,
dispatches the request to a number of disparate applications. The same
is happening here. For the example services in <a class='info' href='#sec-ex-game'>Section&nbsp;3.2<span> (</span><span class='info'>Gaming vs. Voice Chat</span><span>)</span></a>, an incoming INVITE for the gaming service
would be delivered to the gaming application software. An incoming
INVITE for the voice chat service would be delivered to the voice chat
application software. The example in <a class='info' href='#sec-ex-game2'>Section&nbsp;3.3<span> (</span><span class='info'>Gaming vs. Voice Chat #2</span><span>)</span></a> is
similar. For the examples in <a class='info' href='#sec-ex-config'>Section&nbsp;3.4<span> (</span><span class='info'>Configuration vs. Pager Messaging</span><span>)</span></a>, a MESSAGE request for user to user messaging
would be delivered to the messaging or SMS app, and a MESSAGE request
containing configuration data would be delivered to a configuration
update application. 

</p>
<p>
Unlike the web, however, in all three use cases, the user initiating
communications has (or appears to have - more below) only a single
identifier for the recipient - their AOR. Consequently, the SIP
Request-URI cannot be used for dispatching, as it is identical in all
three cases.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Application Invocation in the Network</h3>

<p>
Another usage of a service identifier would be to cause servers in the
SIP network to provide additional processing, based on the
service. For example, an INVITE issued by a user agent for IPTV would
pass through a server that does some kind of content rights
management, authorizing whether the user is allowed to access that
content. On the other hand, an INVITE issued by a user for multimedia
conferencing would pass through a server providing "traditional"
telephony features, such as outbound call screening and call
recording. It would make no sense for the INVITE associated with IPTV
to have outbound call screening and call recording applied, and it
would make no sense for the multimedia conferencing INVITE to be
processed by the content rights management server. Indeed, in these
cases, it's not just an efficiency issue (invoking servers when not
needed), but rather, truly incorrect behavior can occur. For example,
if an outbound call screening application is set to block outbound
calls to everything except for the phone numbers of friends and
family, an IPTV request that gets processed by such a server would be
blocked (as it's not targeted to the AOR of a friend or family
member). This would block a user's attempt to access IPTV services,
when that was not the goal at all.

</p>
<p>
Similarly, a MESSAGE request from <a class='info' href='#sec-ex-config'>Section&nbsp;3.4<span> (</span><span class='info'>Configuration vs. Pager Messaging</span><span>)</span></a> might
need to pass through a message server for filtering when it is
associated with chat, but not when it is associated with
config. Consider a filter which gets applied to MESSAGE requests, and
that filter runs in a server in the network. The filter operation
prevents user Joe from sending messages to user Bob that contain the
words "stock" or "purchase", due to some regulations that disallow Joe
and Bob from discussing stock trading. However, a MESSAGE for
configuration purposes might contain an XML document that uses the
token "stock" as some kind of attribute. This configuration update
would be discarded by the filtering server, when it should not have
been. 

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Network Quality of Service Authorization</h3>

<p>
The IP network can provide differing levels of Quality of Service
(QoS) to IP packets. This service can include guaranteed throughput,
latency, or loss characteristics. Typically, the user agent will make
some kind of QoS request, either using explicit signaling protocols
(such as RSVP) or through marking of Diffserv value in
packets. The network will need to make a policy decision based on
whether these QoS treatments are authorized or not. One common
authorization policy is to check if the user has invoked a service
using SIP that they are authorized to invoke, and that this service
requires the level of QoS treatment the user has requested.

</p>
<p>
For example, consider IPTV and multimedia conferencing as described in
<a class='info' href='#sec-ex-iptv'>Section&nbsp;3.1<span> (</span><span class='info'>IPTV vs. Multimedia</span><span>)</span></a>. IPTV is a non-real time
service. Consequently, media traffic for IPTV would be authorized for
bandwidth guarantees, but not for latency or loss guarantees. On the
other hand, multimedia conferencing is real time. Its traffic would
require bandwidth, loss and latency guarantees from the network.

</p>
<p>
Consequently, if a user should make an RSVP reservation for a media
stream, and ask for latency guarantees for that stream, the network
would like to be able to authorize it if the service was multimedia
conferencing, but not if it was IPTV. This would require the server
performing the QoS authorization to know the service associated with
the INVITE that set up the session.

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Service Authorization</h3>

<p>
Frequently, a network administrator will want to authorize whether a
user is allowed to invoke a particular service. Not all users will be
authorized to use all services that are provided. For example, a user
may not be authorized to access IPTV services, whereas they are
authorized to utilize multimedia processing. A user might not be able
to utilize a multiplayer gaming service, whereas they are authorized
to utilize voice chat services. 

</p>
<p>
Consequently, when an INVITE arrives at a server in the network, the
server will need to determine what the requested service is, so that
the server can make an authorization decision.

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Accounting and Billing</h3>

<p>
Service authorization and accounting/billing go hand in
hand. One of the primary reasons for authorizing that a
user can utilize a service is that they are being billed differently
based on the type of service. Consequently, one of the goals of a
service identity is to be able to include it in accounting records, so
that the appropriate billing model can be applied. 

</p>
<p>
For example, in the case of IPTV, a service provider can bill based on
the content (US $5 per movie, perhaps), whereas for multimedia
conferencing, they can bill by the minute. This requires the
accounting streams to indicate which service was invoked for the
particular session.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Negotiation of Service</h3>

<p>
In some cases, when the caller initiates a session, they don't
actually know which service will be utilized. Rather, they might like
to offer up all of the services they have available to the called
party, and then let the called party decide, or let the system make a
decision based on overlapping service capabilities.

</p>
<p>
As an example, a user can do both the game and the voice chat service
of <a class='info' href='#sec-ex-game'>Section&nbsp;3.2<span> (</span><span class='info'>Gaming vs. Voice Chat</span><span>)</span></a>. They initiate a session to a target
AOR, but the devices used by that user can only support voice
chat. The called device returns, in its call acceptance, an indication
that only voice chat can be used. Consequently, voice chat gets
utilized for the session. 

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7"></a><h3>4.7.&nbsp;
Dispatch to Devices</h3>

<p>
When a user has multiple devices, each with varying capabilities in
terms of service, it is useful to dispatch an incoming request to the
right device based on whether the device can support the service that
has been requested.

</p>
<p>
For example, if a user initiates a gaming session with voice chat, and
the target user has two devices - one that can support the gaming
service, and the other that cannot, the INVITE should be dispatched to
the device which supports the gaming session.

</p>
<a name="sec-key"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Key Principles of Service Identification</h3>

<p>
In this section, we describe several key principles of service
identification:

</p>
<ol class="text">
<li>Services are a by-product of signaling
</li>
<li>Identical signaling produces identical services
</li>
<li>Declarative service identification is an example of Do-What-I-Mean
  (DWIM)
</li>
<li>Explicit service identifiers are redundant
</li>
<li>URIs are a key mechanism for producing differentiated signaling
</li>
</ol>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Services are a By-Product of Signaling</h3>

<p>
Declarative service identification - the addition of a service
identifier by clients in order to inform other entities what the
service is - is a very compelling solution to solving the use cases
described above. It provides a clear way for each of the use cases to
be differentiated. On the other hand, derived service identification
appears "hard" since the signaling appears to be the same for these
different services. 

</p>
<p>
Declarative service identification misses a key point, which cannot be stressed
enough, and which represents the core architectural principle to be
understood here:

</p>
<p></p>
<blockquote class="text">
<p>A service is the by-product of the signaling and the context around
  it (the user profile, time-of-day and so on) - the effects of the
  signaling message once launched into the network. The service
  identity is therefore always derivable from the signaling and its
  context without additional identifiers. In other words, derived
  service identification is always possible when signaling is being
  properly handled.

</p>
</blockquote>

<p>
When a user sends an INVITE request to the network, and targets that
request at an IPTV server, and includes SDP for audio and video
streaming, the *result* of sending such an INVITE is that an IPTV
session occurs. The entire purpose of the INVITE is to establish such
a session, and therefore, invoke the service. Thus, a service is not
something that is different from the rest of the signaling message. A
service is what the user gets after the network and other user agents
have processed a signaling message. 

</p>
<p>
It may seem that delayed offers (SIP INVITE requests that lack SDP)
make it impossible to perform derived service identification. After
all, in some of the cases above, the differentiation was done using
the SDP in the request. What if its not there? The answer is simple -
if its not there, and the SDP is being offered by the called party,
you cannot in fact know the service at the time of the INVITE. Thats
the whole point of delayed offer - to give the called party the chance
to offer up what it wants for the session. In cases where service
identification is needed at request time, delayed offer cannot be
used. 

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Identical Signaling Produces Identical Services</h3>

<p>
This principle is a natural conclusion of the previous assertion. 
If a service is the byproduct of signaling, how can a user have
different experiences and different services when the signaling
message is the same? They cannot.

</p>
<p>But how can that be? From the examples in
<a class='info' href='#sec-examples'>Section&nbsp;3<span> (</span><span class='info'>Example Services</span><span>)</span></a>, it would seem that there are services
which are different, but have identical signaling.  If we hold true to
the assertion, there is in fact only one logical conclusion:

</p>
<p></p>
<blockquote class="text">
<p>
If two services are different, but their signaling appears to be the
same, it is because one or more of the following is true:
</p>
<ol class="text">
<li>there is in fact something different that has been
overlooked
</li>
<li>something has been implied from the signaling which
should have been signaled explicitly
</li>
<li>the signaling mechanism should be changed so that there is, in
  fact, something that is different
</li>
</ol>


</blockquote>

<p>
To illustrate this, let us take each of the example services in <a class='info' href='#sec-examples'>Section&nbsp;3<span> (</span><span class='info'>Example Services</span><span>)</span></a> and investigate whether there is, or should
be, something different in the signaling in each case.

</p>
<p></p>
<blockquote class="text"><dl>
<dt>IPTV vs. Multimedia Conferencing:</dt>
<dd> The two services in
<a class='info' href='#sec-ex-iptv'>Section&nbsp;3.1<span> (</span><span class='info'>IPTV vs. Multimedia</span><span>)</span></a> appear to have identical signaling. They
both involve audio and video streams, both of which are
unidirectional. Both might utilize the same codecs. However, there is
another important difference in the signaling - the target URI. In the
case of IPTV, the request is targeted at a media server or to a
particular piece of content to be viewed. In the case of multimedia
conferencing, the target is a conference server. The administrator of
the domain can therefore examine the two Request-URI, and figure out
whether it is targeted for a conference server or a content server,
and use that to derive the service associated with the request.

</dd>
<dt>Gaming vs. Voice Chat:</dt>
<dd> Though both sessions involve
MSRP and voice, and both are targeted to the same AOR of the called
user, there is a difference. The MSRP messages for the gaming session
carry content which is game specific, whereas the MSRP messages for
the voice chat are just regular text, meant for rendering to a
user. Thus, the MSRP session in the SDP will indicate the specific
content type that MSRP is carrying, and this type will differ in both
cases. Even if the game moves look like text, since they are being
consumed by an automata there is an underlying schema that dictates
their content, and therefore, this schema represents the actual
content type that should be signaled.

</dd>
<dt>Gaming vs. Voice CHat #2:</dt>
<dd> In this case, both sessions
  involve only voice, and both are targeted at the same AOR. Indeed,
  there truly is nothing different - if indeed the signaling works
  this way. However, there is an alternative mechanism for performing
  the signaling. For the gaming session, the proprietary protocol can
  be used to exchange a URI that can be used to identify the voice
  chat function on the phone that is associated with the game (for
  example, a GRUU can be used
  <a class='info' href='#I-D.ietf-sip-gruu'>[I&#8209;D.ietf&#8209;sip&#8209;gruu]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Obtaining and Using Globally Routable User Agent (UA) URIs (GRUU) in the  Session Initiation Protocol (SIP),&rdquo; October&nbsp;2007.</span><span>)</span></a>). Indeed, the gaming chat is not
  targeting the USER - its targeting the gaming instance on the
  phone. Thus, if a special GRUU is used for the gaming chat, this
  makes the signaling different between these two services.

</dd>
<dt>Configuration vs. Pager Messaging:</dt>
<dd> Just as in the case
of gaming vs. voice chat, the content type of the messages
differentiates the service that occurs as a consequence of the
messages. 

</dd>
</dl></blockquote>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Do What I Say, not What I Mean</h3>

<p>
"Do What I Mean", abbreviated as DWIM, is a concept in computer 
science. It is sometimes used to describe a function which tries to
intelligently guess at what the user intended. It is contrast to "Do
What I Say", or DWIS, which describes a function that behaves
concretely based on the inputs provided. Systems built on the DWIM
concept can have 
unexpected behaviors because they are driven by unstated rules. 

</p>
<p>
Declarative service identification is an example of DWIM. The service
identifier has no well-defined impact on the state machinery or
protocols in the system; it has various side-effects based on an
assumption of what is meant by the service identifier. Derived service
identification, on the other hand, is an expression of the principle
of DWIS - the behavior of the system is based entirely on the
specifics of the protocol and are well defined by the protocol
specification. The service identifier is just a short hand for
summarizing things that are well defined by signaling.

</p>
<p>
As a litmus test to differentiate the two cases, consider the
following question. If a request contained a service identifier, and
that request were processed by a domain which didn't understand the
concept of service identifiers at all, would the request be rejected
if that service were not supported, or would it complete but do the
wrong thing? If it is the latter case, its DWIM. If its the former,
its DWIS.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Explicit Service Identifiers are Redundant</h3>

<p>
Because an explicit service identifier is, by definition, inside of
the signaling message, and because the signaling itself completely
defines the behavior of the service, another natural conclusion is
that an explicit service identifier is redundant with the signaling
itself. It says nothing that could not or should not otherwise be derived from
examination of the signaling.

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
URIs are Key for Differentiated Signaling</h3>

<p>
In the IPTV example and in the second gaming example, it was
ultimately the Request-URI that was (or should be) different between
the two services. This is important. In many cases where services
appear the same, it is because the resource which is being targeted is
not, in fact, the user. Rather, it is a resource that is linked with
the user. This resource might be an instance of a software application
on the particular device of a user, or a resource in the network which
acts on behalf of the user. 

</p>
<p>
The Request-URI is an infinitely large namespace for identifying these
resources. It is an ideal mechanism for providing differentiation
when there would otherwise be none.

</p>
<p>
Returning again to the example in <a class='info' href='#sec-ex-game2'>Section&nbsp;3.3<span> (</span><span class='info'>Gaming vs. Voice Chat #2</span><span>)</span></a>, we can
see that it does make more sense to target the gaming chat session at
a software instance on the user's phone, rather than at the user
themselves. The gaming chat session should really only go to the phone
on which the user is playing the game. The software instance does
indeed live only on that phone, whereas the user themselves can be
contacted many ways. We don't want telephony features invoked for the
gaming chat session because those features only make sense when
someone is trying to communicate with the USER. When someone is trying
to communicate with a software instance that acts on behalf of the
user, a different set of rules apply since the target of the request
is completely different. 

</p>
<a name="sec-problems"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Perils of Declarative Service
				      Identification</h3>

<p>
Based on these principles, several perils of declarative service
identification can be described. They are:

</p>
<ol class="text">
<li>Declarative service identification can be used for fraud
</li>
<li> Declarative service identification can hurt interoperability
</li>
<li>Declarative service identification can stifle service innovation
</li>
</ol>
<a name="sec-fraud"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Fraud</h3>

<p>
Declarative service identification can lead to fraud. If a provider uses the
service identifier for billing and accounting purposes, or for
authorization purposes, it opens an avenue for attack. The user can
construct the signaling message so that its actual effect (which is
the service the user will receive), is what the user desires, but the
user places a service identifier into the request (which is what is
used for billing and authorization) that identifies a cheaper service,
or one that the user is authorized to receive. In such a case, the
user will be billed for something they did not receive.

</p>
<p>
If, however, the domain administrator derived the service identifier
from the signaling itself (derived service identification), the user
cannot lie. If they did lie, they wouldn't get the desired service.

</p>
<p>
Consider the example of IPTV vs. multimedia conferencing. If
multimedia conferencing is cheaper, the user could send an INVITE for
an IPTV session, but include a service identifier which indicates
multimedia conferencing. The user gets the service associated with IPTV,
but at the cost of multimedia conferencing.

</p>
<p>
This same principle shows up in other places. For example, in the
identification of an emergency services call <a class='info' href='#I-D.ietf-ecrit-framework'>[I&#8209;D.ietf&#8209;ecrit&#8209;framework]<span> (</span><span class='info'>Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;Framework for Emergency Calling using Internet Multimedia,&rdquo; July&nbsp;2009.</span><span>)</span></a>. It is desirable to give emergency
services calls special treatment, such as being free, authorized even
when the user cannot otherwise make calls, and to give them
priority. If emergency calls where indicated through something other
than the target of the call being an emergency services URN <a class='info' href='#RFC5031'>[RFC5031]<span> (</span><span class='info'>Schulzrinne, H., &ldquo;A Uniform Resource Name (URN) for Emergency and Other Well-Known Services,&rdquo; January&nbsp;2008.</span><span>)</span></a>, it would open an avenue for
fraud. The user could place any desired URI in the request-URI, and
indicate that the call is an emergency services call. This could would
then get special treatment, but of course get routed to the target
URI. The only way to prevent this fraud is to consider an emergency
call as any call whose target is an emergency services URN. Thus, the
service identification here is based on the target of the
request. When the target is an emergency services URN, the request can
get special treatment. The user cannot lie, since there is no way to
separately indicate this is an emergency call, besides targeting it to
an emergency URN.

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Systematic Interoperability Failures</h3>

<p>
How can declarative service identification cause loss of
interoperability? When an identifier is used to drive
functionality - such as dispatch on the phones, in the network, or QoS
authorization, it means that the wrong thing can happen when this
field is not set properly. Consider a user in domain 1, calling a user
in domain 2. Domain 1 provides the user with a service they call
"voice chat", which utilizes voice and IM for real time conversation,
driven off of a buddy list application on a PC. Domain 2 provides
their users with a service they call, "text telephony", which is a
voice service on a wireless device that also allows the user to send
text messages. Consider the case where domain 1 and domain 2 both have
their user agents insert a service identifiers into the request, and
then use that to perform QoS authorization, accounting, and invocation
of applications in the network and in the device. The user in domain 1
calls the user in domain 2, and inserts the identifier "Voice Chat"
into the INVITE. When this arrives at the server in domain 2, the
service identifier is unknown. Consequently, the request does not get
the proper QoS treatment, even if the call itself will succeed.

</p>
<p>
If, on the other hand, derived service identification were used, the
service identifier could be removed by domain 2, and then recomputed
based on the signaling to match its own notion of services. In this
case, domain 2 could derive the "text telephony" identifier, and the
request completes successfully. 

</p>
<p>declarative service identification, used between domains, causes
interoperability failures unless all interconnected domains agree on
exactly the same set of services and how to name them. 
Of course, lack of service identifiers does not guarantee service
interoperability. However, SIP was built with rich tools for
negotiation of capabilities at a finely granular level. One user agent
can make a call using audio and video, but if the receiving UA only
supports audio, SIP allows both sides to negotiate down to the lowest
common denominator. Thus, communications is still provided. As another
example, if one agent initiates a Push-To-Talk session (which is audio
with a companion floor control mechanism), and the other side only did
regular audio, SIP would be able to negotiate back down to a regular
voice call. As another example, if a calling user agent is running a
high-definition video conferencing endpoint, and the called user agent
supports just a regular video endpoint, the codecs themselves can
negotiate downward to a lower rate, picture size, and so on. Thus,
interoperability is achieved. Interestingly, the final "service" may
no longer be well characterized by the service identifier that would
have been placed in the original INVITE. For example, in this case, of
the original INVITE from the caller had contained the service
identifier, "hi-fi video", but the video gets negotiated down to a
lower rate and picture size, the service identifier is no longer
really appropriate. That is why services need to be derived by
signaling - because the signaling itself provides negotiation and
interoperability between different domains. 

</p>
<p>
This illustrates another key aspect of the interoperability problem.
Declarative service identification will result in
inconsistencies between its service identifiers and the results of
any SIP negotiation that might otherwise be applied in the session. 

</p>
<p>
When a service identifier becomes something that both proxies and the
user agent need to understand in order to properly treat a request
(which is the case for declarative service identification), it
becomes equivalent to including a token in the Proxy-Require and
Require header fields of every single SIP request. The very reason
that <a class='info' href='#RFC4485'>[RFC4485]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;Guidelines for Authors of Extensions to the Session Initiation Protocol (SIP),&rdquo; May&nbsp;2006.</span><span>)</span></a> frowns upon usage of Require and
certainly Proxy-Require is the huge impact on interoperability it
causes. It is for this same reason that declarative service
identification needs to be avoided.

</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Stifling of Service Innovation</h3>

<p>
The probability that any two pair of service providers end up with the
same set of services, and give them the same names, becomes
decreasingly small as the number of providers grow. Indeed, it would
almost certainly require a centralized authority to identify what the
services are, how they work, and what they are named. This, in turn,
leads to a requirement for complete homogeneity in order to facilitate
interconnection. Two providers cannot usefully interconnect unless
they agree on the set of services they are offering to their
customers, and each do the same thing. This is because each provider
has become dependent on inclusion of the proper service identifier in
the request, in order for the overall treatment of the request to
proceed correctly. This is, in a very real sense,
anathema to the entire notion of SIP, which is built on the idea that
heterogeneous domains can interconnect and still get interoperability.

</p>
<p>Declarative service identification leads to a requirement for homogeneity
in service definitions across providers that interconnect, ruining the
very service heterogeneity that SIP was meant to bring.

</p>
<p>
Indeed, Metcalfe's law says that the value of a network grows with the
square of the number of participants. As a consequence of this, once a
bunch of large domains did get together, agree on a set of services,
and then a set of well-known identifiers for those services, it would
force other providers to also deploy the same services, in order to
obtain the value that interconnection brings. This, in turn, will
stifle innovation, and quickly force the set of services in SIP to
become fixed and never expand beyond the ones initially agreed
upon. This, too, is anathema to the very framework on which SIP is
built, and defeats much of the purpose of why providers have chosen to
deploy SIP in their own networks:

</p>
<p>
Consider the following example. Several providers get together, and
standardize on a bunch of service identifiers. One of these uses audio
and video (say, "multimedia conversation"). This service is
successful, and is widely utilized. Endpoints look for this identifier
to dispatch calls to the right software applications, and the network
looks for it to invoke features, perform accouting, and QoS. A new
provider gets the idea for a new service, say, avatar-enhanced
multimedia conversation. In this service, there is audio and video,
but there is a third stream, which renders an avatar. A caller can
press buttons on their phone, to cause the avatar on the other
person's device to show emotion, make noise, and so on. This is
similar to the way emoticons are used today in IM. This service is
enabled by adding a third media stream (and consequently, third
m-line) to the SDP. 

</p>
<p>
Normally, this service would be backwards compatible with a regular
audio-video endpoint, which would just reject the third media
stream. However, because a large network has been deployed that is
expecting to see the token, "multimedia conversation" and its
associated audio+video service, it is nearly impossible for the new
provider to roll out this new service. If they did, it would fail
completely, or partially fail, when their users call users in other
provider domains. 

</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Recommendations</h3>

<p>
From these principles, several recommendations can be made:

</p>
<p></p>
<ul class="text">
<li>Systems needing to perform service identification must examine
existing signaling constructs to identify the service based on fields
that exist within the signaling message already.

</li>
<li>If it appears that the signaling currently defined in standards is
not sufficient to identify the service, it may be due to lack of
sufficient signaling to convey what is needed, or may because request
URIs should be used for differentiation.

</li>
<li>
When performing derived service identification, domains should be
aware that sessions may arrive from different networks and different
endpoints. Consequently, the service identification algorithm must be
complete - meaning it computes the best answer for any possible
signaling message that might be received.

</li>
<li>
Presence can help a great deal with providing unique URIs for
different services. When a
user wishes to contact another user, and knows only the AOR for the
target (which is usually the case), the user can fetch the presence
document for the target. That document, in turn, can contain numerous
service URI for contacting the target with different services. Those
URI can then be used in the Request-URI for differentiation. When
possible, this is the best solution to the problem. 

</li>
<li>
Service identifiers themselves are not bad; derived service
identification allows each domain to cache the results of the service
identification process for usage by another
network element within the same domain. However, service identifiers
are fundamentally useful within a particular domain, and any such
header must be stripped at a network boundary.

</li>
<li>
Device dispatch should be done following the principles of
<a class='info' href='#RFC3841'>[RFC3841]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and P. Kyzivat, &ldquo;Caller Preferences for the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a>, using implicit preferences based on the
signaling. For example,
<a class='info' href='#I-D.rosenberg-sip-app-media-tag'>[I&#8209;D.rosenberg&#8209;sip&#8209;app&#8209;media&#8209;tag]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Session Initiation Protocol (SIP) Media Feature Tag for MIME Application Sub-Types,&rdquo; September&nbsp;2009.</span><span>)</span></a> defines a new UA
capability that can be used to dispatch requests based on different
types of application media streams.

</li>
</ul>

<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>
Oftentimes, the service associated with a request is utilized for
purposes such as authorization, accounting, and billing. When service
identification is not done properly, the possibility of unauthorized
service use and network fraud
is introduced. It is for this reason, discussed extensively in <a class='info' href='#sec-fraud'>Section&nbsp;6.1<span> (</span><span class='info'>Fraud</span><span>)</span></a>, that the usage of explicit service identifiers
inserted by a UA is not recommended.

</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>
There are no IANA considerations associated with this specification.

</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgements</h3>

<p>
This document is based on discussions with Paul Kyzivat and Andrew
Allen, who contributed significantly to the ideas here. Much of the
content in this draft is a result of discussions amongst participants
in the SIPPING mailing list, including Dean Willis, Tom Taylor, Eric
Burger, Dale Worley, Christer Holmberg, and John Elwell, amongst many
others. Thanks to Spencer Dawkins, Tolga Asveren, Mahesh Anjanappa
and Claudio Allochio for reviews of this document.

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.&nbsp;Informational References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4479">[RFC4479]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4479">A Data Model for Presence</a>,&rdquo; RFC&nbsp;4479, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4479.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4485">[RFC4485]</a></td>
<td class="author-text">Rosenberg, J. and H. Schulzrinne, &ldquo;<a href="http://tools.ietf.org/html/rfc4485">Guidelines for Authors of Extensions to the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4485, May&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4485.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4975">[RFC4975]</a></td>
<td class="author-text">Campbell, B., Mahy, R., and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4975">The Message Session Relay Protocol (MSRP)</a>,&rdquo; RFC&nbsp;4975, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4975.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5031">[RFC5031]</a></td>
<td class="author-text">Schulzrinne, H., &ldquo;<a href="http://tools.ietf.org/html/rfc5031">A Uniform Resource Name (URN) for Emergency and Other Well-Known Services</a>,&rdquo; RFC&nbsp;5031, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5031.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-ecrit-framework">[I-D.ietf-ecrit-framework]</a></td>
<td class="author-text">Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ecrit-framework-10.txt">Framework for Emergency Calling using Internet Multimedia</a>,&rdquo; draft-ietf-ecrit-framework-10 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-ecrit-framework-10.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sip-gruu">[I-D.ietf-sip-gruu]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-gruu-15.txt">Obtaining and Using Globally Routable User Agent (UA) URIs (GRUU) in the  Session Initiation Protocol (SIP)</a>,&rdquo; draft-ietf-sip-gruu-15 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-gruu-15.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.rosenberg-sip-app-media-tag">[I-D.rosenberg-sip-app-media-tag]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-rosenberg-sip-app-media-tag-04.txt">A Session Initiation Protocol (SIP) Media Feature Tag for MIME Application Sub-Types</a>,&rdquo; draft-rosenberg-sip-app-media-tag-04 (work in progress), September&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-rosenberg-sip-app-media-tag-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3428">[RFC3428]</a></td>
<td class="author-text">Campbell, B., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;<a href="http://tools.ietf.org/html/rfc3428">Session Initiation Protocol (SIP) Extension for Instant Messaging</a>,&rdquo; RFC&nbsp;3428, December&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3428.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3841">[RFC3841]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., and P. Kyzivat, &ldquo;<a href="http://tools.ietf.org/html/rfc3841">Caller Preferences for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3841, August&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3841.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jonathan Rosenberg</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Edison, NJ</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jdrosen@cisco.com">jdrosen@cisco.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.jdrosen.net">http://www.jdrosen.net</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
