<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Traffic classification, filtering and redirection for end-system IP VPNs.  </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 End-system functionality">
<link href="#rfc.section.3" rel="Chapter" title="3 XML schema">
<link href="#rfc.section.4" rel="Chapter" title="4 Signaling gateway functionality">
<link href="#rfc.section.5" rel="Chapter" title="5 Top-of-rack switch">
<link href="#rfc.section.6" rel="Chapter" title="6 Applications">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="When IP VPNs are used to interconnect " />
  <meta name="description" content="When IP VPNs are used to interconnect " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">P. Marques</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">L. Fang</td>
</tr>
<tr>
<td class="left">Expires: April 13, 2012</td>
<td class="right">Cisco Systems</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">P. Pan</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Infinera Corp</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">A. Shukla</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Juniper Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 11, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Traffic classification, filtering and redirection for end-system IP VPNs.  <br />
  <span class="filename">draft-marques-sdnp-flow-spec-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>When IP VPNs are used to interconnect <a href="#I-D.marques-l3vpn-end-system">end-systems</a> <cite title="NONE">[I-D.marques-l3vpn-end-system]</cite> it may be desirable to introduce traffic control rules at a finer level of granularity than an IP destination address.</p>
<p>This document extends the end-system IP VPN specification with support for fine grain traffic classification, filtering and redirection rules.  It applies the existing BGP IP VPN <a href="#RFC5575">flow specification dissemination mechanism</a> <cite title="NONE">[RFC5575]</cite> to end-system IP VPNs in order to provide the ability to control IP packets that match a specific pattern, which may include fields other than the IP destination address.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 13, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">End-system functionality</a>
</li>
<li>3.   <a href="#rfc.section.3">XML schema</a>
</li>
<li>4.   <a href="#rfc.section.4">Signaling gateway functionality</a>
</li>
<li>5.   <a href="#rfc.section.5">Top-of-rack switch</a>
</li>
<li>6.   <a href="#rfc.section.6">Applications</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">When <a href="#I-D.marques-l3vpn-end-system">end-system IP VPNs</a> <cite title="NONE">[I-D.marques-l3vpn-end-system]</cite> are used to interconnect Virtual Machines or other multi-tenant applications it may be desirable to control the flow of traffic between sender(s) and receiver at a finer level of granularity than an IP destination host prefix.</p>
<p id="rfc.section.1.p.2">In the IP protocol model, ingress points map traffic into forwarding equivalence classes (FECs) which are then given consistent treatment through a transport network. This document defines a signaling protocol that conveys traffic classification rules. These rules can be applied by ingress points into an end-system IP VPN in order to define FECs that depend on both the destination IP address of the traffic as well as additional fiels such as the the transport protocol and ports.</p>
<p id="rfc.section.1.p.3">One example where this may be desirable is in scenarios where different VPNs may exchange traffic directly. For instance, a VPN that provides a common service to multiple tenants. In this case, the owner of the destination address may wish to inject a traffic rule that limits traffic to TCP packets to and from a specific port.  Another example is an application that request specific <a href="#RFC2474">diffserv</a> <cite title="NONE">[RFC2474]</cite> markings for certain types of traffic.  In other situations, network administrators may wish to inject specific rules that temporarily redirect traffic.</p>
<p id="rfc.section.1.p.4">This document uses a point-to-multipoint model for traffic filtering rules where the traffic egress requests all the ingresses to perform a given traffic classification action.  The entity that advertises the destination address of the traffic, or a proxy in its behalf, injects a flow-based route advertisement into the signaling infrastructure. This flow-based route is propagated according to VPN policies to all the ingress points of the VPN, the end-systems which contain VMs allowed to access the destination.</p>
<p id="rfc.section.1.p.5">The traffic filtering rules are then applied at all the ingress points of the VPN. The egress MAY also choose to apply the same rules in cases where they are equivalent at both locations.</p>
<div id="#rfc.figure.1"></div>
<div id="#model"></div>
<pre>
+-----+	    +--------+
| VM1 | --- | host 1 | -
+-----+	    +--------+   \
             &lt;filter&gt;      \+~~~~~~~~~+	     +--------+	   +------+
                            | network | ---- | host 3 | -- | VM 3 |
                            +~~~~~~~~~+	     +--------+	   +------+
			   /
+-----+	    +--------+	  /
| VM2 | --- | host 2 | - /
+-----+	    +--------+
             &lt;filter&gt;
</pre>
<p id="rfc.section.1.p.6">The figure above contains an example topology in which a given VM (VM 3) provides a common infrastructure service. VM1 and VM2 belong to different tenants and are in VPNs which are allowed to access the service in VM3.</p>
<p id="rfc.section.1.p.7">This specification allows VM3 to advertise a traffic filtering rule, as a flow-spec route, requesting the Host OSes in host 1 and host 2 to limit any traffic flow to VM3's destination IP address such that, for instance, only packets for a specific TCP destination port are allowed.</p>
<p id="rfc.section.1.p.8">It is important to note that traffic filtering does not avoid the need for application level authorization and authentication.</p>
<p id="rfc.section.1.p.9">When a flow-spec route is advertised, the number of possible ingress points it not known in advance. There is no mechanism to generate a positive or negative acknowledgement from the ingress points. This is in contrast to the more traditional network management operation in which the management station is aware of all the agents that must be controlled.</p>
<p id="rfc.section.1.p.10">As with the base end-system IP VPN specification, the forwarding and signaling networks are distinct. Flow-spec routes are advertised by the egress end-system or by a proxy in its behalf. The routes are injected into one or more XMPP signaling gateways and propagated using the BGP <a href="#RFC5575">flow-spec address family</a> <cite title="NONE">[RFC5575]</cite>.</p>
<p id="rfc.section.1.p.11">Using the same vrf-import and export policies that define the IP VPN, the flow-spec routes are then imported from BGP into a vpn-specific database and advertised to all the ingress end-system, which apply them.</p>
<p id="rfc.section.1.p.12">This document limits itself to "stateless" traffic classification rules that classify a given IP packet independently of any previous data traffic.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> End-system functionality</h1>
<p id="rfc.section.2.p.1">It is common for end-systems to support traffic classification . One such example is the Linux "ipchains" functionality. This document assumes that such functionality can be associated with a particular Virtual Routing and Forwarding (VRF) table on the end-system and that each virtual interface is associated with a VRF. The traffic classification rules described in this document are applied at the VRF level.</p>
<p id="rfc.section.2.p.2">The BGP <a href="#RFC5575">Flow Specification</a> <cite title="NONE">[RFC5575]</cite> document lists a set of IPv4 protocol header fields and match operations that are though to be a minimum common set of supported functionality among hardware implementations.</p>
<p id="rfc.section.2.p.3">These fields are: </p>

<ul>
<li>IPv4 destination address.</li>
<li>IPv4 source address.</li>
<li>IP protocol identifier.</li>
<li>Transport Ports: Source, Destination or Either.</li>
<li>ICMP Type and Code.</li>
<li>TCP flags.</li>
<li>Packet length.</li>
<li>Diffserv Code Point.</li>
<li>IPv4 fragmentation flags.</li>
</ul>

<p> </p>
<p id="rfc.section.2.p.4">When numeric values are specified (i.e. fields other than IP addresses), the match operator can specify a list of values with inequality operators. Note that this may result in one logical rule, as defined by this specification to be implemented as multiple classification rules on the underlying OS implementation. For instance the match operations in the Linux "ipchains" implementation are more restrictive.</p>
<p id="rfc.section.2.p.5">The match operator is defined via the following BNF grammar: </p>

<dl>
<dt>&lt;match&gt; ::=</dt>
<dd style="margin-left: 8">&lt;terms&gt;</dd>
<dt>&lt;terms&gt; ::=</dt>
<dd style="margin-left: 8">&lt;term&gt; </dd>
<dt></dt>
<dd style="margin-left: 8">| &lt;term&gt; "||" &lt;terms&gt; </dd>
<dt></dt>
<dd style="margin-left: 8">| &lt;term&gt; "&amp;&amp;" &lt;terms&gt;</dd>
<dt>&lt;term&gt; ::=</dt>
<dd style="margin-left: 8">&lt;operator&gt; value</dd>
<dt>&lt;operator&gt; ::=</dt>
<dd style="margin-left: 8">"&lt;" | "&lt;=" | "=" | "!=" | "&gt;=" | "&gt;"</dd>
</dl>

<p> </p>
<p id="rfc.section.2.p.6">As an example, a value range is expressed as: "&gt;= begin &amp;&amp; &lt;= end".</p>
<p id="rfc.section.2.p.7">The result of a flow-spec rule is one of the following actions: </p>

<ul>
<li>allow</li>
<li>deny</li>
<li>rate-limit</li>
<li>redirect</li>
<li>copy</li>
<li>log</li>
<li>set-dscp</li>
</ul>

<p> </p>
<p id="rfc.section.2.p.8">The redirect and copy actions have as a target an FEC which should contain an unique <a href="#RFC4122">UUID</a> <cite title="NONE">[RFC4122]</cite> identifier as well as information regarding the SNPA address and label used for forwarding.</p>
<p id="rfc.section.2.p.9">The copy action instructs the system to generate a copy of the original packet and forward to the specified FEC. Both copy and log actions have an additional parameter which controls whether all matching packets or a sample is subject to the specified treatment.</p>
<p id="rfc.section.2.p.10">The 'set-dscp' action specifies the DSCP value to be assigned to the outer IP header of the packet, when a packet is encapsulated.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> XML schema</h1>
<p id="rfc.section.3.p.1">In the <a href="#I-D.marques-l3vpn-end-system">end-system IP VPN</a> <cite title="NONE">[I-D.marques-l3vpn-end-system]</cite> specification, IP reachability information is encoded as XMPP "item" information belonging to collection nodes where each collection is the IP reachability information for a given VPN.  End-systems can publish and receive notifications for these nodes.</p>
<p id="rfc.section.3.p.2">This document uses the same approach. It uses a collection with the name of "&lt;vpn-customer-name&gt;/ip4-flow-spec" to publish and receive updates corresponding to IPv4 flow-spec routes.  When an end-system published a node into such a collection it must generate a node name that is unique among the nodes that it publishes. It then associates that node with the collection.</p>
<div id="#rfc.figure.2"></div>
<p>XML encoding used by flow-spec items:</p>
<pre>
&lt;item&gt;
  &lt;entry xmlns='http://ietf.org/protocol/bgpvpn/ip4-flow-spec'&gt;
    &lt;ip4-destination&gt;10.0.1/24&lt;/ip4-destination&gt;
    &lt;ip4-source&gt;20.0.128/20&lt;/ip4-source&gt;
    &lt;ip4-protocol&gt;=6 || =17&lt;/ip4-protocol&gt;
    &lt;port&gt;=80&lt;/port&gt;
    &lt;destination-port&gt;=80&lt;/destination-port&gt;
    &lt;source-port&gt;=80&lt;/source-port&gt;
    &lt;icmp-type&gt;=1&lt;/icmp-type&gt;
    &lt;icmp-code&gt;=1&lt;/icmp-code&gt;
    &lt;tcp-flags&gt;=(syn|rst|ack|fin)&lt;/tcp-flags&gt;
    &lt;ip-length&gt;&gt;40&lt;/ip-length&gt;
    &lt;dscp&gt;=0&lt;/dscp&gt;
    &lt;ip4-fragment&gt;=(df|first|more|last)&lt;/ip4-fragment&gt;
    &lt;action&gt;
      &lt;accept/&gt;
      &lt;deny/&gt;
      &lt;rate-limit rate='10pps'/&gt;
      &lt;redirect&gt;
        &lt;fec uuid='550e8400-e29b-41d4-a716-446655440000'&gt;
	  &lt;snpa af='1'&gt;'infrastructure-ip-address'&lt;/snpa&gt;
	  &lt;label&gt;1&lt;/label&gt;
	&lt;/fec&gt;
      &lt;/redirect&gt;
      &lt;copy&gt;
        &lt;fec&gt;...&lt;/fec&gt;
	&lt;sample/&gt;
      &lt;/copy&gt;
      &lt;log/&gt;
      &lt;set-dscp&gt;128&lt;/set-dscp&gt;
    &lt;/action&gt;
  &lt;/entry&gt;
&lt;/item&gt;
</pre>
<p id="rfc.section.3.p.3">The sequence of XML elements in an item SHOULD follow the "flow specification" NLRI type order as the example above. IP source and destination prefixes are encoded in their standard textual representation of &lt;dotted notation&gt;"/"&lt;prefix-length&gt;. Protocol and Port elements are expressed using the match operator syntax documented above. "&lt;port&gt;" and "&lt;destination-port&gt;" or "&lt;source-port&gt;" SHOULD be mutually exclusive. The icmp type and code fields as well as ip-length and dscp are again encoded using the value match operator. The "&gt;tcp-flags&gt;" element uses either an equality or match operation of the TCP header flags. A binary match is expressed as "m/(syn|rst|ack|fin)/". The "&lt;ip4-fragment&gt;" element may also use a binary match operation.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Signaling gateway functionality</h1>
<p id="rfc.section.4.p.1">As with IP reachabilty information, signaling gateways create a routing database for each 'vpn-customer-name'. An XMPP client (an end-system) can publish and subscribe to multiple of these databases. Each "virtual interface" on the end-system is associated with a virtual routing table on the gateway.</p>
<p id="rfc.section.4.p.2">From a signaling perspective, the gateway functions as a IP VPN PE as described in section 8 of <a href="#RFC5575">[RFC5575]</a>. As with IP reachability, this document uses the XMPP interface to delegate the forwarding functionality to the end-system, separating it from the signaling node.</p>
<p id="rfc.section.4.p.3">In <a href="#RFC5575">[RFC5575]</a> no route validation procedure is defined for the IP VPN application. For the purposes of the end-system IP VPN application, signaling gateways SHOULD enforce the following rules.  </p>

<ul class="empty">
<li>A flow-spec route is valid if its Route Target list is an exact match to the export route target list for the virtual routing table.</li>
<li>A flow-spec route is valid if it contains an IP destination prefixes and there is an exact match between its Route Target list and the Route Target list contained in the IP unicast route that covers that specific destination prefix.</li>
<li>A flow-spec route should be considered unfeasible otherwise and not imported into the specific virtual routing database.</li>
</ul>

<p> </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Top-of-rack switch</h1>
<p id="rfc.section.5.p.1">It may be desirable to implement some of the traffic classification functionality on a traditional network element, rather than in the end-system.  For instance the end-system may not fully support all the desired functionality.</p>
<p id="rfc.section.5.p.2">In this case, a network element can have access to the signaling information using two different methods: </p>

<ul class="empty">
<li>By receiving BGP signaling information directly. A Top-of-rack switch, for example, could infer whether a given end-system is downstream from it by examining the IP infrastructure addresses of the end-systems and extracting information into its forwarding plane whenever an end-point of a VPN is downstream.</li>
<li>By using a "men-in-the-middle" technique in which the XMPP client sessions from end-systems terminate in the TOP-of-rack switches. The switch can then establish an XMPP session to the signaling gateway and proxy the information between the two sessions.</li>
</ul>

<p> </p>
<p id="rfc.section.5.p.3">The second approach presents the switch itself with a simplified interface in which it does not need to understand the policies associated with a specific VPN.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Applications</h1>
<p id="rfc.section.6.p.1">This specification provides a mechanism to distribute traffic classification rules to many enforcement points. This may of interest in applications where it is desirable to avoid the standard approach of a centralized enforcement point. Typically in situations where the volume of traffic or the nature of the problem make it more cost effective to do so.</p>
<p id="rfc.section.6.p.2">One such application is the enforcement of stateless traffic forwarding rules for infrastructure services. An application level services, such as a storage server may need to support multiple data-center tenants. In this scenario the storage VPN advertises a given address prefix, which contains both the anycast IP address of the load-balancers as the addresses of individual servers. Using VPN import policies, the data-center management solution allows the tenant specific VPNs to see these routes. The tenant VPN addresses must also be reachable on the storage VPN, in this example.</p>
<p id="rfc.section.6.p.3">This specification allows the storage service to block out traffic that does not match the specific transport protocols used to provide this service. It also allows confirming traffic to be marked with the appropriate diffserv classification. The network administrator case also use this mechanism for diagnostic purposes.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Security Considerations</h1>
<p id="rfc.section.7.p.1">There are two independent areas that are worth examining when it comes to security. The integrity of the control plane information and the forwarding actions.</p>
<p id="rfc.section.7.p.2">This document assumes that all signaling interactions use mutual authentication, where all communication channels are authenticated.</p>
<p id="rfc.section.7.p.3">For traffic filtering and redirection this mechanism assumes a "best-effort" model. The ingress points will strive to perform the actions specified by the egress. However there are no strict guarantees that the actions can be applied successfully on an ingress points or that the order of operations is such that no non-conforming traffic is ever presented to the egress.</p>
<p id="rfc.section.7.p.4">For traffic filtering rules, the egress point can choose to apply the rules also in order to provide stronger guarantees.</p>
<p id="rfc.section.7.p.5">Applications should themselves authenticate its communication peers my methods that do not depend on the IP addresses used at the network layer.</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.marques-l3vpn-end-system">[I-D.marques-l3vpn-end-system]</b></td>
<td class="top">
<a>Marques, P</a>, <a>Fang, L</a>, <a>Pan, P</a> and <a>A Shukla</a>, "<a href="http://tools.ietf.org/html/draft-marques-l3vpn-end-system-02">End-system support for BGP-signaled IP/VPNs.</a>", Internet-Draft draft-marques-l3vpn-end-system-02, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2474">[RFC2474]</b></td>
<td class="top">
<a href="mailto:kmn@cisco.com" title="Cisco Systems">Nichols, K.</a>, <a href="mailto:slblake@torrentnet.com" title="Torrent Networking Technologies">Blake, S.</a>, <a href="mailto:fred@cisco.com" title="Cisco Systems">Baker, F.</a> and <a href="mailto:black_david@emc.com" title="EMC Corporation">D.L. Black</a>, "<a href="http://tools.ietf.org/html/rfc2474">Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</a>", RFC 2474, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4122">[RFC4122]</b></td>
<td class="top">
<a href="mailto:paulle@microsoft.com" title="Microsoft">Leach, P.</a>, <a href="mailto:michael@refactored-networks.com" title="Refactored Networks, LLC">Mealling, M.</a> and <a href="mailto:rsalz@datapower.com" title="DataPower Technology, Inc.">R. Salz</a>, "<a href="http://tools.ietf.org/html/rfc4122">A Universally Unique IDentifier (UUID) URN Namespace</a>", RFC 4122, July 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5575">[RFC5575]</b></td>
<td class="top">
<a>Marques, P.</a>, <a>Sheth, N.</a>, <a>Raszuk, R.</a>, <a>Greene, B.</a>, <a>Mauch, J.</a> and <a>D. McPherson</a>, "<a href="http://tools.ietf.org/html/rfc5575">Dissemination of Flow Specification Rules</a>", RFC 5575, August 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Pedro Marques</span> 
	  <span class="n hidden">
		<span class="family-name">Marques</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:pedro.r.marques@gmail.com">pedro.r.marques@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Luyuan Fang</span> 
	  <span class="n hidden">
		<span class="family-name">Fang</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  <span>111 Wood Avenue South</span>

	  <span class="vcardline">
		<span class="locality">Iselin</span>,  
		<span class="region">NJ</span> 
		<span class="code">08830</span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:lufang@cisco.com">lufang@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ping Pan</span> 
	  <span class="n hidden">
		<span class="family-name">Pan</span>
	  </span>
	</span>
	<span class="org vcardline">Infinera Corp</span>
	<span class="adr">
	  <span>140 Caspian Ct.</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94089</span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ppan@infinera.com">ppan@infinera.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Amit Shukla</span> 
	  <span class="n hidden">
		<span class="family-name">Shukla</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  <span>1194 N. Mathilda Av.</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94089</span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:amit@juniper.net">amit@juniper.net</a></span>

  </address>
</div>

</body>
</html>