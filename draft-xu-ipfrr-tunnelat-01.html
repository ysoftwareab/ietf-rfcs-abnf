<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IP Fast Reroute Using Tunnel-AT</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IP Fast Reroute Using Tunnel-AT">
<meta name="keywords" content="IPFRR, Tunnel, iSPF">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header"> M. Xu</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header"> L. Pan</td></tr>
<tr><td class="header">Expires: September 8, 2010</td><td class="header">Tsinghua University</td></tr>
<tr><td class="header">&nbsp;</td><td class="header"> S. Yang</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Beijing University of Posts and</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Telecommunications</td></tr>
<tr><td class="header">&nbsp;</td><td class="header"> Q. Li</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Tsinghua University</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 07, 2010</td></tr>
</table></td></tr></table>
<h1><br />IP Fast Reroute Using Tunnel-AT<br />draft-xu-ipfrr-tunnelat-01</h1>

<h3>Abstract</h3>

<p>This draft decribes Tunnel-AT mechanism that improves the
      Tunnel IP fast re-route mechanism. Tunnel-AT provides 100% node
      protection coverage in a symmetric biconnected network at a
      computational cost of less than one full SPT calculation.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 8, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#term">2.</a>&nbsp;
Terminology<br />
<a href="#overview">3.</a>&nbsp;
Tunnel-AT Overview<br />
<a href="#anchor1">4.</a>&nbsp;
Tunnel-AT Routing Algorithm<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">4.1.</a>&nbsp;
Rerouting to the Incoming Node<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.2.</a>&nbsp;
Complexity<br />
<a href="#anchor4">5.</a>&nbsp;
Forwarding Plane Mechanism<br />
<a href="#anchor5">6.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor6">7.</a>&nbsp;
 Security Considerations<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
      When a link or node failure occurs in an IP network, there is a
      period of disruption to the delivery of traffic until the
      network re-converges on a new topology. IP fast reroute (IPFRR)
      mechanisms are methods used in pure IP networks to provide
      protection from such disruptions.  This is done by having
      failure-adjacent nodes compute backup routes in advance that
      allow them to repair failures immediately upon detection of
      failures.  Traffic can be delivered to their correct
      destinations even before the network has re-converged on a new
      topology.
      
</p>
<p>
      Thus far, there are three different IPFRR mechanisms that are
      documented in RFCs or IETF drafts: LFA
      in <a class='info' href='#refs.RFC5286'>RFC 5286<span> (</span><span class='info'>Atlas, A., Zinin, A., Torvi, R., Choudhury, G., Martin, C., Imhoff, B., and D. Fedyk, &ldquo;Basic Specification for IP Fast-Reroute: Loop-free         Alternates,&rdquo; September&nbsp;2008.</span><span>)</span></a> [1], <a class='info' href='#refs.Tunnels'>Tunnels<span> (</span><span class='info'>Bryant, S., Filsfils, C., Previdi, S., and M. Shand, &ldquo;IP Fast Reroute using tunnels,&rdquo; 2008.</span><span>)</span></a> [3] in
      [I-D.ietf-bryant-ipfrr-tunnels], and <a class='info' href='#refs.Tunnels'>NotVia<span> (</span><span class='info'>Bryant, S., Filsfils, C., Previdi, S., and M. Shand, &ldquo;IP Fast Reroute using tunnels,&rdquo; 2008.</span><span>)</span></a> [3] in
      [I-D.ietf-rtgwg-ipfrr-notvia-addresses]. However, LFA only
      provides 50~80% single-node failure protection coverage; routers
      running NotVia must maintain extra NotVia addresses, which
      causes high address management burden. In addition, NotVia also
      can cause packets to be forwarded through unnecessary
      tracebacks. The original Tunnel can not provide 100% protection
      coverage for single node failures and the original draft does
      not describes an efficient method to calculate tunnel endpoints.
      
</p>
<p>
      This draft presents Tunnel-AT to improve Tunnel. Tunnel-AT
      requires less than one full SPT computation, provides 100%
      single node protection, and does not require routers to maintain
      extra addresses. In addition, the length of the backup paths
      computed under Tunnel-AT are always exactly or very close to the
      length of the shortest working path to the destination.
      
</p>
<a name="term"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>This section defines the terms and symbols used in this draft.
      
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>Directed Forwarding:</dt>
<dd>The ability of the
            repairing router (S) to specify the next hop (Q) on
            exit from a tunnel end-point (P).
</dd>
<dt>T:</dt>
<dd>The original shortest path tree of S.
</dd>
<dt>T':</dt>
<dd>The new shortest path tree of S after
          removing a supposed failed neighbor (F) and associated edges
          from original topology.
</dd>
<dt>Affected node:</dt>
<dd>A node in the subtree of T
          rooted at F.
</dd>
<dt>Incremental SPT:</dt>
<dd>Algorithms to build new
          shortest path tree based on the original shortest path tree
          upon topological change.
</dd>
</dl></blockquote><p>
      
</p>
<a name="overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Tunnel-AT Overview</h3>

<p>
        When a failure occurs in an IP network, there is no way for the
        failure-adjacent routers to tell whether the failure was caused by a
        node failures or simply a link failure. To cope with the worst case,
        routers will first try to use the backup paths precalculated for a
        node failure. If no such routes are available, they will try to use
        the backup paths for a link failure. 
      
</p>
<p>
        The backup paths are used until the completion of the routing
        transition. Only routers adjacent to the failed component are
        aware of the nature of the failure.  Once all the routers
        compute new shortest path based on the new topology, the
        backup paths will not be used anymore since packets are no
        longer forwarded through the failed components. At this time,
        the computation of new backup paths for the new topology are
        scheduled.
      
</p>
<p>
        The forwarding plane mechanism of Tunnel-AT is similar to
        <a class='info' href='#refs.Tunnels'>Tunnels<span> (</span><span class='info'>Bryant, S., Filsfils, C., Previdi, S., and M. Shand, &ldquo;IP Fast Reroute using tunnels,&rdquo; 2008.</span><span>)</span></a> [3]. It uses tunnel and
        directed forwarding to implement repair paths, too. But
        in the routing plane, Tunnel-AT is totally different
        from Tunnels.  The routing algorithm is based on the
        incremental SPF (<a class='info' href='#refs.iSPF'>(iSPF)<span> (</span><span class='info'>Narvaez, Siu, and Tzeng, &ldquo;New dynamic SPT algorithm based on a ball-and-string model,&rdquo; 2001.</span><span>)</span></a> [2]) algorithm in
        and the concept of Attaching Tree (thus comes the name
        Tunnel-AT).
      
</p>
<p>
        A simple example is given in Figure 1 to demonstrate
        Tunnel-AT. In Figure 1, the default link cost is 1, and link P-H
        and link H-I have a high cost (20). For destination H, and
        supposed failed neighbor F, S can reroute packets to H by
        first using the S-P tunnel to reroute packets to P. S also
        makes extra marks on the packets so that P would directed
        forwarding these packets to H.
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                   --------[I]
                              +---/         |
                 [S]---------[F]            | 20
                  +           +----------\  |
                  |                       \ |
                  +---[N]---[P]------------[H]
                                   20

         Figure 1: A case shows how Tunnel-AT works. The default
         link cost is 1. And the cost of link N-H and link H-I
         is 20, much higher than the others.
</pre></div>
<p>
          To reroute packets to node I, S would forward packets with
          destination I to P and tell P to directly forward it to H.
          Since H also notices the failure of F and also performs
          Tunnel-AT, it would forward packets to I directly instead of
          using the original next hop F. So, packets have been
          protected more than once. We call the subsequent protections
          re-protections. Using re-protection, Tunnel-AT achieves 100%
          protection coverage.
        
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Tunnel-AT Routing Algorithm</h3>

<p>
        Under the link weight routing protocol, repairing node S has
        already computed an original shortest path tree T based on the
        current topology. Next, for each neighbor N, S deletes N and
        associated links from the original topology and computes
        repair paths for every affected destination. The remaining
        part of this section describes how S computes repair paths for
        a specific supposed failed neighbor F.
      
</p>
<p>
        Tunnel-AT is based on the incremental SPF algorithm.
        Intuitively, the process of the iSPF algorithm can be viewed
        as attaching subtrees of the original shortest path tree back
        one by one and finally forming a new shortest path tree. We
        name the subtrees Attaching Trees.  An attaching tree may be
        attached to a node of another attaching tree. In this way,
        they form a super attaching tree. The root of the super
        attaching tree attached to a node that is not affected by the
        changing of tolopogy. We call the root the traffic incoming
        node, or simply the incoming node. Given a node S and a
        supposed failed neighbor F, to deliver a packet to an affected
        destination D, it is sufficient to reroute it to D's incoming
        node. From the original shortest path tree, the iSPF algorithm
        can be used to compute the new shortest path tree after
        removing F from the topology, and the incoming node of each
        affected node can be determined during the process.
       
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Rerouting to the Incoming Node</h3>

<p>
        To reroute a packet with destination D to the incoming node I,
        the parent of I, denoted as P, can be used as the tunnel
        endpoint. It is also needed to determine whether directed
        forwarding is necessary to ensure P forwarding the packet to
        I. The original distance from S to P and from S to D,
        i.e. dist(S, P) and dist(S, D), can be obtained from the
        original tree T; the new distance from P to D, dist'(P, D),
        can be obtained from tree T'. If the network is symmetric,
        dist(P, S) equals to dist(S, P). At a first glance, the
        following condition seems works:
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          dist'(P, D) &lt; dist(P, S) + dist(S, D)
</pre></div><p>

        However this condition only guarantees P does not forward the
        packet back to S. Figure 2 shows a very simple
        counter-example. Here, D's incoming node is D itself and
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          dist'(P, D) = 7 &lt; 8 = dist(P, S) + dist(S, D)
</pre></div><p>

        But P will send the packet to N if directed forwarding is not
        used because P->N->F->D is a shorter path and P is not aware
        of the failure. The packet will still reach D via
        the protection by N for the second time, but it takes a longer
        path that it has to.
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>


                       +---[D]----+ 3
                       |          |
                       |      1   |
                     7 |   +-----[F]
                       |  [N]     |
                       |  /       |
                       | / 2      | 2
                       |/         |
                      [P]--------[S]
                           3

          Figure 2: An example: If S does not tell P to
          directly forwarding a packet with destination
          D to D, the packet will take the long path
          S-&gt;P-&gt;N-&gt;P-&gt;D.
</pre></div>
<p>
        To avoid P routing packets back to F, another more rigorous
        condition can be used: 
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          dist'(P, D) - dist(F, D) &lt;= dist(S, P) - dist(S, F) .
</pre></div><p>

        It can be proved that this condition ensures that P forwords
        packets with destination D to nieghbor I, so no mark for
        directed forwording is needed. 

        To see how this equation works, let's assume the above
        condition holds but P routing packet back to F, so
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          dist(P, D) &gt;= dist(P, N) + dist(N, F) + dist(F, D)
</pre></div><p>

        since the shortest path from S to P does not traverse F, we have
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          dist(S, P) &lt; dist(S, F) + dist(F, N) + dist(N, P)
</pre></div><p>

        Combining the two inequalities yields:
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          dist(P, D) - dist(F, D) &gt; dist(S, P) - dist(S, F)
</pre></div><p>

        Since dist'(P, D) >= dist(P, D), we have
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          dist'(P, D) - dist(F, D) &gt; dist(S, P) - dist(S, F)
</pre></div><p>

        A contridiction.
      
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Complexity</h3>

<p>
        Based on the original shortest path tree T calculated by the
        normal link state routing protocol, every node has to perform
        k times incremental shortest path tree (iSPT) (k is the number
        of neighbors) to construct backup routes for all
        destinations. The core of these algorithms are queue
        operations. The full SPT algorithm (Dijkstra's algorithm)
        invokes three types of queue operations: ADD, EXTRACT-MIN, and
        DECREASE-KEY. The iSPT algorithm invokes one extra type of
        operation -- REMOVE.  If the queue is implemented as a binary
        heap, in a network of V nodes and E edges, the complexity
        of full SPT is O(ElgV). Let V_i denote the number of
        affected nodes if neighbor i fails, let E_i denote the
        number of edges attached to one of these nodes, the number of
        operations in the iSPT for this neighbor i
        can be expressed as follows:  
        </p>
<ul class="text">
<li> Maximum number of EXTRACT-MIN: the iteration number l in
          iSPT. 
</li>
<li> Maximum number of ADD: V_i.
</li>
<li> Maximum number of REMOVE: V_i - l.
</li>
<li> Maximum number of DECREASE-KEY: E_i. 
</li>
</ul><p>
        The main component is DECREASE-KEY. For a node, the
        Tunnel-AT algorithm complexity is 
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           O(E_1 lg V_1) + ... + O(E_k lg V_k)
                = O (E_1 lg V) + ... + O(E_k lg V)
                = O (ElgV)
</pre></div><p>

        the same as one full SPT. 
        
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Forwarding Plane Mechanism</h3>

<p>
	    Tunnel-AT routes are pre-computed in anticipation of later
	    failures by the routing algorithm described above. When a
	    router detects an adjacent failure, it uses these routes
	    to reroute packets until the completion of the routing transition.
	  
</p>
<p>
        A Tunnel-AT route contains two extra fields, Tunnel IP
        address(Tunnel adrresss) and directed forwarding IP address
        (DF address). The Tunnel address is the IP address of the
        tunnel end point router. The DF address is the next hop IP
        address when the tunnel end point router needs to perform
        directed forwarding.  If tunnel or directed forwarding is not
        needed, the corresponding field is not set.
	  
</p>
<p>
		Here we describe a way to implement tunnel and directed
		forwarding.  It is not required that an implementation follow
		exactly the method given in the following section.
	  
</p>
<p>
        When a router receives a packet, it will perform general IP forwarding.
        If a tunnel-at route is chosen for a packet: 

        </p>
<ol class="text">
<li>If DF address is set, a new IP header (DF header)
	    is prepend to the packet. The DST field of the prepended IP header is
		set to the DF address.
</li>
<li>If Tunnel address is set, another new IP header (tunnel
	    header) is prepended, while its DST field is set to tunnel IP
	    address. 
</li>
<li> The TOS fields of these prepended headers are set to 2 and the 
		PROTOCOL fields are also set to a special value IP_TUNAT. We also 
		increase the value of TOS field of the original packet by 1. 
</li>
<li> In the case of IP fragmentation, the above operations are
		performed on all fragments. 
</li>
</ol><p>
	  
</p>
<p>
	    TOS field is used to avoid routing loops, which may occur in the 
		scenarios of multi-link failures.  When a route receives a packet 
		with TOS field being value 2 and find it need another protection,
		it simply drop the packet. So if a packet is being protected, it 
		will not be protected again.  If a packet has been protected twice,
		the TOS field of the original packet will be 2, it will not be
		protected for another time.
	  
</p>
<p>
		If the packet is delivered locally to the router:
		
        </p>
<ol class="text">
<li>
		    If the packet has a tunnel header, i.e. the field of PROTOCOL equals
		IP_TUNAT, and the router is the destination of the tunnel, it drops the 
		tunnel header and check the next header. 
          
</li>
<li>
		    If the nested header is a df header, it forwards the
		    packet by the corresponding interface.
          
</li>
</ol><p>
	  
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
      There are no IANA considerations that arise from this architectural
      description of IPFRR.  However there will be changes to the IGPs to
      support IPFRR in which there will be IANA considerations.
      
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
 Security Considerations</h3>

<p>
        Changes to the IGPs to support IPFRR do not introduce any additional
        security risks.
      
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.&nbsp;References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="refs.RFC5286">[1]</a></td>
<td class="author-text">Atlas, A., Zinin, A., Torvi, R., Choudhury, G., Martin, C., Imhoff, B., and D. Fedyk, &ldquo;<a href="http://tools.ietf.org/html/rfc5286">Basic Specification for IP Fast-Reroute: Loop-free
        Alternates</a>,&rdquo; RFC&nbsp;5286, September&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.iSPF">[2]</a></td>
<td class="author-text">Narvaez, Siu, and Tzeng, &ldquo;New dynamic SPT algorithm based on a ball-and-string model,&rdquo; IEEE/ACM&nbsp;Trans. Netw., 2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.Tunnels">[3]</a></td>
<td class="author-text">Bryant, S., Filsfils, C., Previdi, S., and M. Shand, &ldquo;IP Fast Reroute using tunnels,&rdquo; Internet draft&nbsp;draft-bryant-ipfrr-tunnels-03, 2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.Notvia">[4]</a></td>
<td class="author-text">Shand, M., Bryant, S., and S. Previdi, &ldquo;IP Fast Reroute Using Not-via Addresses,&rdquo; Internet draft&nbsp;draft-ietf-rtgwg-ipfrr-notvia-addresses-04, 2009.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mingwei Xu</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tsinghua University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Department of Computer Science</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing  100084</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:xmw@csnet1.cs.tsinghua.edu.cn">xmw@csnet1.cs.tsinghua.edu.cn</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Lingtao Pan</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tsinghua University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Department of Computer Science</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing  100084</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:freeplant@gmail.com">freeplant@gmail.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sijie Yang</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing University of Posts and Telecommunications</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Department of Computer Science</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing  100876</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:iyangsj@gmail.com">iyangsj@gmail.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Qing Li</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tsinghua University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Department of Computer Science</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing  100084</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:liqing@csnet1.cs.tsinghua.edu.cn">liqing@csnet1.cs.tsinghua.edu.cn</a></td></tr>
</table>
</body></html>
