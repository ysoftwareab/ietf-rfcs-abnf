ACI = rights "#" attr "#" generalSubject

rights = (("grant:" / "deny:") permissions) /
          ("grant:" permissions ";deny:" permissions)

permissions = 1*(permission)

permission = "a" / ; add
              "d" / ; delete
              "e" / ; export
              "i" / ; import
              "n" / ; renameDN
              "b" / ; browseDN
              "v" / ; view (entry level read permission)
              "t" / ; returnDN
              "r" / ; read
              "s" / ; search filter
              "p" / ; search filter (presence only)
              "w" / ; write (mod-add)
              "o" / ; obliterate (mod-del)
              "c" / ; compare
              "m" / ; make
              "u" / ; unveil (disclose on error permission)
              "g"   ; getEffectiveRights

attr = "[all]" / "[entry]" / (attribute *("," attribute))

attribute = AttributeDescription
               ; The <AttributeDescription> rule is defined
               ; in Section 4.1.5 of [LDAPv3]

generalSubject = context pureSubject

context = "authnLevel:" authnLevel ":"

pureSubject = anySubject / machineSubject / idBasedSubject

anySubject =   "public:"

machineSubject = "ipAddress:" ipAddressRange *( "," ipAddressRange ) /
                   "dns:" partialdomainname *( "," partialdomainname )

partialdomainname = [ "*." ] domainname


idBasedSubject = thisSubject /
                  oneSubject /
                  setOfSubjects
thisSubject = "this:"
oneSubject = ( "authzId-" authzId )
setOfSubjects = ( "role:" dn ) /
                 ( "group:" dn ) /
                 ( "subtree:" dn )

authnLevel = "none" /
              "weak" /
              "limited" /
              "strong"

authzId = dnAuthzId / uAuthzId

dnAuthzId  = "dn:" dn

dn = utf8string ; with syntax defined in [UTF]

uAuthzId   = "u:" userid
userid     = utf8string ; syntax unspecified
ipAddress = IPv6address

IPv6address = hexpart [ ":" IPv4address ]
IPv4address = 1*3DIGIT "." 1*3DIGIT "." 1*3DIGIT "." 1*3DIGIT

hexpart = hexseq | hexseq "::" [ hexseq ] | "::" [ hexseq ]
hexseq  = hex4 *( ":" hex4)
hex4    = 1*4HEXDIG

ipAddressRange = ipAddress [ HYPHEN ipAddress ]  ; IPv6 address range

domainname = domaincomponent *( "." domaincomponent )

OUTER = ALPHA / DIGIT
INNER = ALPHA / DIGIT / HYPHEN
HYPHEN = %x2D
domaincomponent = OUTER [ *61( INNER ) OUTER ]


dc=com
                                 |
dc=tivoli                 dc=sun
                        |                        |
cn=ellen                  cn=rob

cn=rvh,dc=att,dc=com
cn=rob,dc=sun,dc=com has "rw" rights to both English- and French-
cn=Admins is working with the following entry:

 dn: cn=personA, o=Company
 cn: personA
 cn: FirstName
 sn: LastName
 objectclass: person


o=Company. The entryACI value for this entry must give the cn=Admin role
o=Company. The entryACI value must give the cn=Admin role rename
cn=FirstName, o=Company and set the deleteOldRdn flag to true. The
cn=Admin role must have permission to rename the entry, and to delete a
cn=personA, o=CompanyB. The cn=Admin role must have export permission on
cn=personA, o=Company to cn=FirstName, o=CompanyB. The cn=Admin role
cn=personA, o=Company entryACI is:

 entryACI: grant:en#[entry]#authnLevel:weak:role:cn=Admin

cn=personA, o=Company to cn=newFirstName, o=CompanyB. The cn=Admin role
cn=FirstName, o=CompanyB and deleting the attribute value personA. The
cn=Admin role must have rename and export permission on the original
o=Company entryACI is:

 entryACI: grant:en#[entry]#authnLevel:weak:role:cn=Admin
 entryACI: grant:o#cn#authnLevel:weak:role:cn=Admin

o=CompanyB and deleting the attribute value personA. The cn=Admin role
cn=personA, o=Company entryACI is:
 entryACI: grant:en#[entry]#authnLevel:weak:role:cn=Admin
 entryACI: grant:wo#OID.cn#authnLevel:weak:role:cn=Admin

dc=com
                                  |
dc=tivoli                 dc=sun
                         |                        |
cn=ellen                  cn=rob

dc=tivoli,dc=com is redundant.

cn=rob,dc=sun,dc=com has effective rights of "r" to all attributes of
cn=ellen,dc=tivoli,dc=com.

cn=ellen,dc=tivoli,dc=com
cn=rob,dc=sun,dc=com

cn=ellen,dc=tivoli,dc=com, and permissions "rw" to all the attributes of
o=sun.com
cn=adminGroup,ou=Groups,o=sun.com
cn=admin,o=sun.com
ou=Groups,o=sun.com
cn=adminGroup,ou=Groups,o=sun.com
ou=Eng,o=sun.com
cn=Joe Engineer,ou=Eng,o=sun.com
ou=Sales,o=sun.com
cn=Joe Sales,ou=Sales,o=sun.com
cn=adminGroup,ou=Groups,o=sun.com group have full rights in the
cn=adminGroup,ou=Groups,o=sun.com), with base "o=sun.com", search filter
o=sun.com
cn=admin,o=sun.com
ou=Groups,o=sun.com
ou=Eng,o=sun.com
cn=Joe Engineer,ou=Eng,o=sun.com
ou=Sales,o=sun.com
cn=Joe Sales,ou=Sales,o=sun.com
