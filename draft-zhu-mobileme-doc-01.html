<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Understanding Apple's Back to My Mac Service</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Understanding Apple's Back to My Mac Service">
<meta name="keywords" content="Mobility Support, BTMM">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">S. Cheshire</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Apple Inc.</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">Z. Zhu</td></tr>
<tr><td class="header">Expires: September 10, 2010</td><td class="header">UCLA</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">R. Wakikawa</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Toyota ITC</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">L. Zhang</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">UCLA</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 09, 2010</td></tr>
</table></td></tr></table>
<h1><br />Understanding Apple's Back to My Mac Service<br />draft-zhu-mobileme-doc-01.txt</h1>

<h3>Abstract</h3>

<p>
This draft describes the implementation of Apple Inc.'s Back to My Mac (BTMM) service. BTMM provides network connectivity between devices so that a user can perform file sharing and screen sharing among multiple computers at home, at work, or on the road. The implementation of BTMM addresses the issues of single sign-on authentication, secure data communication, service discovery and end-to-end connectivity in face of Network Address Translators (NAT) and mobility of devices.

</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 10, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Overview of Back to My Mac<br />
<a href="#anchor3">3.</a>&nbsp;
Representing Host Location in SRV Records<br />
<a href="#anchor4">4.</a>&nbsp;
NAT Traversal<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.1.</a>&nbsp;
Introduction to NAT-PMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.2.</a>&nbsp;
Requesting/Removing a Port Mapping<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.3.</a>&nbsp;
Obtaining NAT box's Public IP Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.4.</a>&nbsp;
Un-supported Scenarios<br />
<a href="#anchor11">5.</a>&nbsp;
Handling IP Address or Port Changes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.1.</a>&nbsp;
Updating Local Interfaces and Tunnels<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">5.2.</a>&nbsp;
Dynamically Updating Reachability Information<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">5.3.</a>&nbsp;
Getting Up-to-Date DNS Resource Records by DNS-LLQ<br />
<a href="#anchor15">6.</a>&nbsp;
An Engineering Approach to Augmenting Host with An Identifier<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">6.1.</a>&nbsp;
Why BTMM Needs Host Identifiers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">6.2.</a>&nbsp;
What to Use As Host Identifier<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">6.3.</a>&nbsp;
IPv6 ULA Configuration<br />
<a href="#anchor19">7.</a>&nbsp;
Securing Communication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">7.1.</a>&nbsp;
Authentication for Connecting to Remote Host<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">7.2.</a>&nbsp;
Authentication for DNS Request/Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">7.3.</a>&nbsp;
Using IPsec to Secure End-to-End Data Communication<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>

The Back to My Mac (BTMM) service was shipped with MAC OS X 10.5 in October 2007.
BTMM provides secure connections among a set of devices over dynamic and heterogeneous network environment. Whether the user is traveling around accessing the Internet with airport wifi, or staying at home behind a NAT, BTMM allows the user to connect to any of his Mac computers with just a click, after which the user can share files with remote computers or control the remote Mac through screen sharing.
When a user is on the road and changes locations and hence the IP addresses (e.g. roaming around with laptop, receiving dynamically allocated IP address, etc.), BTMM provides a way for the roaming host to updates its reachability information. BTMM also provides mechanisms to reach devices behind a NAT.  In order to maintain end-to-end connections in face of IP address changes, BTMM lets each end-host use a unique identifier for TCP connections.  Finally, BTMM also provides security for user data communications.

</p>
<p>
BTMM achieves the above goals largely by integrating a set of existing protocols and software tools. 
BTMM uses DNS-based Service Discovery <a class='info' href='#DNS-SD'>[DNS&#8209;SD]<span> (</span><span class='info'>, &ldquo;DNS-Based Service Discovery,&rdquo; .</span><span>)</span></a> to announce host reachability information, uses dynamic DNS Update <a class='info' href='#DDNS'>[DDNS]<span> (</span><span class='info'>, &ldquo;Dynamic Updates in the Domain Name System (DNS UPDATE),&rdquo; .</span><span>)</span></a> to refresh the DNS resource records when a host changes locations,
and uses DNS Long-lived Queries <a class='info' href='#DNS-LLQ'>[DNS&#8209;LLQ]<span> (</span><span class='info'>, &ldquo;DNS Long-Lived Queries,&rdquo; .</span><span>)</span></a> to make sure that all interested hosts get notified when the content of their interested DNS resource records changes.
It uses the NAT Port Mapping Protocol <a class='info' href='#NAT-PMP'>[NAT&#8209;PMP]<span> (</span><span class='info'>, &ldquo;NAT Port Mapping Protocol,&rdquo; .</span><span>)</span></a> for NAT traversal, and Kerberos for authentication.
BTMM uses IPv6 ULA addresses as host identifiers, and uses IPsec between a pair of host identifiers to secure data communications. 

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Overview of Back to My Mac</h3>

<p><a class='info' href='#btmm'>Figure&nbsp;1</a> provides a sketch of the basic components in BTMM implementation.

</p><br /><hr class="insert" />
<a name="btmm"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

        DDNS update    +--------+  DDNS update
      +---------------&gt;|        |&lt;-------+
      |                |  DNS   |        |
      |      LLQ       |        | LLQ    |
      |    +----------&gt;|        |&lt;----+  |
      |    |           |        |     |  |
      |    |           +--------+     |  |
      |    |                          |  |            +---------+
      |    V                      +---+--+----+       |         |
     ++-------+                   |           +-------|         |
     |Endhost1|     Tunnel        |    NAT    +------&gt;|Endhost2 |
     |        |&lt;=====================================&gt;|         |
     +--------+                   |           |       |         |
                                  +-----------+       +---------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
In BTMM, every user is assigned a DNS domain under members.me.com domain (e.g. bob.members.me.com), and Apple Inc. provides the DNS service.  The reachability information of the user's machines is published in DNS, and only accessible to the user.

When a user logs in from a computer M, the machine starts updating the Dynamic DNS server about M's reachability information. If the user has multiple machines, M will also set up LLQ with the DNS server, so that the DNS server can push any newly changed resource records to it if any other machines change their reachability information. In case a host is behind a NAT, the public IP address of the NAT box and the port opened for the host will be put in the DNS resource records; otherwise, the public IP address of the host and the port opened on the host are published to DNS instead. Other hosts can then use this information to reach computer M.

</p>
<p>
To enable established connections between a pair of machines to survive IP address changes at either end, the connections must be based on unique and stable identifier for each machine.  BTMM chose to use IPv6 ULA as host identifier, so that all the existing IPv6 application and protocol code can be reused.  For security concerns, BTMM leverages IPsec to protect the communications, and Kerberos is used to do the authentication. 

</p>
<p>Thus, each user data packet originated by BTMM is an IPv6 packet, which is inside the IPsec encapsulation. The outer most headers is the UDP head and IPv4 header that are used for NAT traversal. <a class='info' href='#Encapsulation'>Figure&nbsp;2</a> illustrates how an encapsulated packet looks like.  Note that even if both ends have routed public IP addresses, the packet encapsulation process is still the same.


<br /><hr class="insert" />
<a name="Encapsulation"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

  +-------------+------+------------+------------------------+
  | IPv4 Header | UDP  | IP6sec ESP |      IPv6 Packet       |
  +-------------+------+------------+------------------------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


</p>
<p>The following sections describes each of the basic components in BTMM. Since this draft is intended to be an informal description of the BTMM design, we did not include the details (e.g. packet format, error code, etc) of each component.
 
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Representing Host Location in SRV Records</h3>

<p>
For each host, BTMM must encode into DNS both the host identifier and its current location information. Since many hosts are behind a NAT box, NAT traversal requires a transport port number as well.  BTMM stores the host ID in DNS AAAA records, and utilizes DNS SRV RR to represent the host's current location information.

</p>
<p>
The format of SRV RR <a class='info' href='#RFC2782'>[RFC2782]<span> (</span><span class='info'>, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; .</span><span>)</span></a> is as following:

</p>
<p>
<br /><hr class="insert" />
<a name="SRV"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

+----------------------+---+-----+---+--------+------+----+------+
| _Service._Proto.Name |TTL|Class|SRV|Priority|Weight|Port|Target|
+----------------------+---+-----+---+--------+------+----+------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


</p>
<p>The following text explains how BTMM utilizes SRV records to represent the locations of machines.

</p>
<p>Service is the symbolic name of the desired service. In BTMM case, the service is named "autotunnel", which means that the information contained in the SRV RR is used by BTMM to automatically set up a tunnel between two end hosts. 

</p>
<p>Proto is the symbolic name of desired protocol. Typically it is either "_tcp" or "_udp". BTMM uses "_udp" to do the tunneling.

</p>
<p>Name is the domain this RR refers to. When the user subscribes to BTMM service, a domain name "username.members.me.com" is assigned to her. For a particular machine, a user-friendly host name would be appended to the assigned domain name. Hence, the first part of SRV record would look like "_autotunnel._udp.hostname.username.members.me.com". 

</p>
<p>TTL and Class have Standard DNS meaning <a class='info' href='#RFC1035'>[RFC1035]<span> (</span><span class='info'>, &ldquo;Domain Names - implementation and specification,&rdquo; .</span><span>)</span></a>. Priority and Weight are always zero, since in BTMM for each Name there is only one instance that provides "autotunnel" service.  

</p>
<p>Port is the port on this target host of this service. In our case, most likely it is the external port a NAT opened for the host behind it. Knowing the port number, the NAT traversal can be achieved via UDP encapsulation. More on NAT traversal will be discussed in next section. If the host is not behind a NAT, the port opened on the host for autotunnel service would be placed here.

</p>
<p>Target is the domain name of the target host. Here it refers to a name constructed by appending an autotunnel label to the domain name, not generally user-visible. The form of autotunnel label is concatenating "AutoTunnel" with the IEEE EUI-64 identifier, which is created according to <a class='info' href='#EUI64'>[EUI64]<span> (</span><span class='info'>, &ldquo;Guidelines for 64-bit Global Identifier (EUI-64),&rdquo; .</span><span>)</span></a> from the machine's 48bit MAC identifier of the primary interface. The IP address corresponding to the target will be used as external tunnel address during NAT traversal.

</p>
<p>The following is an example of SRV records used by BTMM.

<br /><hr class="insert" />
<a name="SRVRR"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+----------------------------------------------+-----+--+---+-+-+----+-------
| _autotunnel._udp.myMacpro.bob.members.me.com |86400|IN|SRV|0|0|7809|AutoTun
+----------------------------------------------+-----+--+---+-+-+----+-------
-----------------------------------------------+
nel-00-22-69-FF-FE-8E-34-2A.bob.members.me.com |
-----------------------------------------------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
NAT Traversal</h3>

<p>BTMM requires the router devices to support NAT-PMP or UPnP IGD. NAT-PMP is the alternative introduced by Apple Inc. to the more common Internet Gateway Device (IGD) Standardized Device Control Protocol <a class='info' href='#IGD'>[IGD]<span> (</span><span class='info'>, &ldquo;Internet Gateway Device(IGD) Standard Device Control Protocol,&rdquo; .</span><span>)</span></a> as published in UPnP forum. Both NAT-PMP and IGD require that the NAT device can open a port for inbound connections for the host behind it and inform the host about its public IP address. The design difference between IGD and NAT-PMP can be found in <a class='info' href='#NAT-PMP'>[NAT&#8209;PMP]<span> (</span><span class='info'>, &ldquo;NAT Port Mapping Protocol,&rdquo; .</span><span>)</span></a>. This section focuses on NAT-PMP.

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Introduction to NAT-PMP</h3>

<p>NAT-PMP is a protocol that is designed specifically to handle the NAT traversal without manual configuration. When a host determines that its primary IPv4 address is in one of the private IP address ranges defined in "Address Allocation for Private Internets" <a class='info' href='#RFC1918'>[RFC1918]<span> (</span><span class='info'>, &ldquo;Address Allocation for Private Internets,&rdquo; .</span><span>)</span></a>, it will invoke NAT-PMP to communicate with the NAT gateway to request the creation of inbound mappings on demand.  Having created a NAT mapping to allow inbound connections, the client host can then publish its NAT's public IP address and external port number in a public registry (e.g. DNS as we discussed in last section).

</p>
<p>A host sends its Port Mapping Protocol request to the default gateway, which means that by default, this protocol is designed for small home networks where the host's default gateway is the NAT router. If the host finds that NAT-PMP is not available on its network, it would proceed on assumption that the network is a publicly reachable network.

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Requesting/Removing a Port Mapping</h3>

<p>
To request a port mapping, the client host sends its request packet to port 5351 of its configured gateway address, and waits 250ms for a response. If no response is received after 250ms, the host repeats the process with exponential back-off retry timer. 

</p>
<p>
While requesting the port mapping, the host can specify the desired external port(e.g. the port that is identical to the internal port), but the NAT device is not obliged to allocate the desired one. If such port is not available, NAT device responds with another port. The primary reason for allowing host to request a specific port is to help recover from the NAT device crash, so that the host is likely to obtain a port which is the same as the original one (i.e. this allows the end hosts to keep the mapping states and does not require the NAT to keep the mapping state after crash, which turns hard state in the network into soft state, and enables automatic recovery when needed). 

</p>
<p>The recommended port mapping lifetime is 3600 seconds. And the host should begin trying to renew the mapping at 1800 seconds.

</p>
<p>The renewal sent by client host, whether for the purpose of extending lease or recreating mappings on NAT device reboot, is the same as requesting a port mapping. 

</p>
<p>
A mapping may be removed in a variety ways. If a client host fails to renew a mapping, then when its lifetime expires the mapping is automatically deleted. Or if the client host's DHCP address lease expires, the NAT device may automatically delete the mapping. A client host may also send an explicit packet to request deletion of a mapping that is no longer needed.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Obtaining NAT box's Public IP Address</h3>

<p>To determine the public IP address of the NAT, the client host also sends the query packet to port 5351 of the configured gateway address. NAT device should response with a packet containing the public IP address of NAT. 

</p>
<p>In case the public IP address of the NAT changes, the NAT gateway sends a gratuitous response to the link-local multicast address 224.0.0.1, port 5350 to notify the clients about the new IP address.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Un-supported Scenarios</h3>

<p>
There are a number of situations where NAT-PMP (and consequently BTMM) may not work.

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.1"></a><h3>4.4.1.&nbsp;
NAT Behind NAT</h3>

<p>
Some people's primary IP address assigned by their ISP may itself be a NAT address. In addition, some people may have an public IP address, but may then double NAT themselves. NAT traversal can not be achieved with NAT-PMP in such situations.

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.2"></a><h3>4.4.2.&nbsp;
NATs and Routed Private Networks</h3>

<p>
In some cases, a site may install a NAT gateway and subnet the private network. Such subneting breaks the assumption of NAT-PMP protocol because the router address is not necessarily the address of the device performing NAT.

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Handling IP Address or Port Changes</h3>

<p>This section describes how BTMM provides a way to handle IP address or port changes, so that the hosts belonging to the same user can find each other and keep ongoing connections even after the change happens at one or both ends.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Updating Local Interfaces and Tunnels</h3>

<p>After BTMM receives the notification about the network changes, all interfaces are marked as inactive. Then the system updates the interface list, and at the same time it clears all inactive interfaces. Finally it sets up active interfaces.

</p>
<p>Then, BTMM also needs to send requests to the NAT device (if it is behind a NAT) in order to create a port mapping and obtain the new public IP addresses, as discussed in last section.

</p>
<p>Next step, BTMM makes change to the local autotunnel interface, i.e. configures the IPv6 interface for the inner address of tunnel. If there are established tunnels, it scans to find those that local inner/outer addresses have changed since the tunnel was set up, and then put in the current addresses. 

</p>
<p>With all these done, now the BTMM client needs to publish the changes to DNS.

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Dynamically Updating Reachability Information</h3>

<p>
The mobile nature of the BTMM clients implies that Dynamic DNS Update <a class='info' href='#DDNS'>[DDNS]<span> (</span><span class='info'>, &ldquo;Dynamic Updates in the Domain Name System (DNS UPDATE),&rdquo; .</span><span>)</span></a>  is required if the location information of hosts are going to be published via DNS. 

</p>
<p>
However, the dynamically updated resource records are often not properly removed, leaving stale RRs in DNS server. Hence, Dynamic DNS Update Leases <a class='info' href='#DDUL'>[DDUL]<span> (</span><span class='info'>, &ldquo;Dynamic DNS Update Leases,&rdquo; .</span><span>)</span></a> is used by BTMM to reduce the impact of stale RRs. 
Another possible choice is to overload the resource records' TTL as the removal timer. However, there is a concern about unacceptable amount of network traffic due to refreshes if TTL were used to clear stale resource record, because TTL is usually set to be very short in order to minimize stale cached data in intermedia DNS.

</p>
<p>
In the case of network changes, the resource records of a host should be updated immediately after local interfaces are properly configured and port mapping as well as the public IP address of the NAT are obtained. Usually there are 4 types of resource records involved. An AAAA record for updating the new IPv6 address of the host (possibly the same as the old one); an SRV record for updating the autotunnel service information, which includes the new external port and the new target; an A record for updating the new public IP address of the target; and a TXT record for describing the autotunnel device information. The host then constructs and sends an SRV query for the name _dns-update._udp.user-domain. Then the updates are sent to the Dynamic DNS server returned in the target field of SRV query response. 

</p>
<p>
Besides that, periodically refreshment is also required by the Dynamical DNS Update Leases even though the network may not experience any change. The Update Requests contain a signed 32-bit integer indicating the lease life in seconds. To reduce network and server load, a minimum lease of 30 minutes is recommended. On the other hand, to avoid stale information, a lease longer than 2 hours is not allowed in BTMM case. The typical length is 90 minutes. Resource records not to be deleted by the server must be refreshed by the client host before the lease expires.

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Getting Up-to-Date DNS Resource Records by DNS-LLQ</h3>

<p>
In dynamic environments, changes to DNS information are very frequent. How to let the hosts that are concerned about particular DNS resource records know the change efficiently is a challenging question. In traditional DNS, queries are "one-shot" -- a name server will answer a query once, returning the results available at that instant in time. Thus, polling is necessary to learn the changes. This solution is not scalable, however, as low polling rate could leave the client with stale information and a high polling rate would have an adverse impact on the network and server.

</p>
<p>
BTMM relies on DNS long-lived queries <a class='info' href='#DNS-LLQ'>[DNS&#8209;LLQ]<span> (</span><span class='info'>, &ldquo;DNS Long-Lived Queries,&rdquo; .</span><span>)</span></a> to allow the DNS server to notify the client host about the changes to DNS data.

</p>
<p>
The same as in the case of resource records updates, the client issues an SRV query for the name _dns-llq._udp.user-domain and obtains the server providing LLQs. LLQ is initiated by a client and is completed via a four-way handshake: Initial Request, Challenge, Challenge Response, and ACK + Answers. During the Challenge phase,  the DNS server would provides a unique identifier for the request and the client is required to echo this identifier in Challenge Response phase. This handshake provides resilience to packet loss, demonstrates client reachability and reduces denial-of-service attack opportunities. 

</p>
<p>
LLQ lease is negotiated during the handshake. In BTMM case, the minimum lease is 15 minutes and the maximum lease is 2 hours. Lease must be refreshed before expiration. 

</p>
<p>When a change ("event") occurs to a name server's domain, the server checks if the new or deleted resource records answer any LLQs. If so, the resource records would be sent to the LLQ requesters in the form of a gratuitous DNS response, with the question(s) being answered in the Question section, and answer(s) to the question(s) in the Answer section. Client acknowledges the reception of the notifications, otherwise the server would re-send the response. If a total of 3 transmissions fails, the client is considered unreachable and the LLQ is deleted. 

</p>
<p>BTMM host would then update tunnels according to the query answers. The callback function for automatically setting up tunnels goes as <a class='info' href='#callback'>Figure&nbsp;5</a> shows.

<br /><hr class="insert" />
<a name="callback"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>


                       1:  Push Updated AAAA RR       +------------+
                &lt;-----------------------------------  |            |
                    2: Query for autotunnel SRV RR    |            |
    +--------+  -----------------------------------&gt;  |            |
    |        |        3: Reply Updated SRV RR         | DNS server |
    | client |  &lt;-----------------------------------  |            |
    |        |      4: Query for Target in SRV RR     |            |
    +--------+  -----------------------------------&gt;  |            |
                    5: Reply Updated A RR of Target   |            |
                &lt;-----------------------------------  |            |
                                                      +------------+

                  In Step
                  1: client learns the inner IP address of the tunnel
                  3: client learns the port opened for UDP NAT traversal
                  5: client learns the public IP address of the remote NAT,
                     i.e. the outer IP address of the tunnel

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
An Engineering Approach to Augmenting Host with An Identifier</h3>

<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Why BTMM Needs Host Identifiers</h3>

<p>
There are a number of reasons why BTMM would need a topology-independent identifier for each client host.
</p>
<ul class="text">
<li>
A host may on the move, thus any identifier that is related to the topology would be constantly changing, which causes great troubles for mobility support and other purposes.

</li>
<li>
The two ends may wish to have the established TCP connections survive network changes.

</li>
<li>
To facilitate the cryptography protection, sometimes a constant identifier would need to be associated with a key so that the security association can survive the location changes.

</li>
</ul><p>

</p>
<p>


</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
What to Use As Host Identifier</h3>

<p>
There are several candidates for host identifiers, such as DNS name, HIP <a class='info' href='#HIP'>[HIP]<span> (</span><span class='info'>, &ldquo;Host Identify Protocol (HIP) Architecture,&rdquo; .</span><span>)</span></a>, and of course IPv6 address. To be accurate, the last one should be IPv6 ULA <a class='info' href='#RFC4193'>[RFC4193]<span> (</span><span class='info'>, &ldquo;Unique Local IPv6 Unicast Address,&rdquo; .</span><span>)</span></a>, because the globally routable IPv6 address dependents on the topology. So why choose IPv6 ULA?

</p>
<p>
A very pragmatic concern about introducing a host identifier is: do we need to re-write all the protocol and application code? It would be a tedious and error-prone work to migrate all the existing implementations. This gives us a hint: the host identifier should be compatible with existing protocol and application implementations, e.g. something in the same form and length as IP address. This rules out DNS name, which has variable length.

</p>
<p>
For HIP, although it has the same length as IPv6 address and host ID can serve as its public key, we still lack a secure way to retrieve the host ID. Under this condition, using HIP would not bring us much benefit.

</p>
<p>
On the other hand, with IPv6 ULA as host identifier, all the existing code can be used directly. And since in BTMM all the IPv6 addresses are not leaked to the public network, it would not cause any problem to the global Internet. 

</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
IPv6 ULA Configuration</h3>

<p>
In BTMM, IPv6 ULA is advertised to be used in the autotunnel service of the host. Thus, the IPv6 address needs to be configured before BTMM can start its service.

</p>
<p>
When the machine boots up, the IPv6 address for autotunnel service is initialized as zeros and the autotunnel interface is marked as inactive. During the process when BTMM updates the interfaces list (which is performed every time the network changes), if the IPv6 address is found uninitialized, BTMM would randomly generate an IPv6 ULA according to <a class='info' href='#RFC4193'>[RFC4193]<span> (</span><span class='info'>, &ldquo;Unique Local IPv6 Unicast Address,&rdquo; .</span><span>)</span></a>. The first octet of the ULA is set to be "0xFD", and the following 7 octets are randomly selected from 0~255. Finally, the EUI-64 identifier fills up the rest 8 octets. Since there are 56 random bits plus a theoretically unique EUI-64 identifier, it is unlikely to have the IPv6 ULA collision between any two machines of the same subscriber.

</p>
<p>
This locally generated ULA keeps unchanged when the machine is on, despite its location changes. Hence the user can fully enjoy the benefits brought by topology-independent host identifiers. After the machine power off, this particular ULA is no longer kept. 

</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Securing Communication</h3>

<p>
BTMM users often have to fetch their personal data via a network they don't trust (or have no idea whether it's trustworthy). Hence, it is important for BTMM to have effective means to secure the communications.

</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Authentication for Connecting to Remote Host</h3>

<p>Kerberos is a "single sign on" technology and is supported in Apple's products since Mac OS X 10.5. Each Mac OS X client maintains a local Key Distribution Center (KDC) for the use of Bonjour and peer-to-peer security, which means that it is also a component of BTMM.

</p>
<p>When the user first signs in to MobileMe on a host, it automatically receives a digital certificate and private key for "Back to My Mac Encryption Certificate". When the user connects to another system using BTMM, authentication is performed using the standard Public Key Cryptography for Initial Authentication in Kerberos (PKINIT) protocol <a class='info' href='#PKINIT'>[PKINIT]<span> (</span><span class='info'>, &ldquo;Public Key Cryptography for Initial Authentication in Kerberos (PKINIT),&rdquo; .</span><span>)</span></a> with that certificate. After that, the user is granted a "ticket" that permits it to continue to use the services on the remote machine, without re-authenticating, until the ticket expires, which usually has 10 hours lifetime.

</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Authentication for DNS Request/Response</h3>

<p>
BTMM uses Transaction SIGnature (TSIG) to authenticate user when dynamic DNS update is performed, as specified in <a class='info' href='#RFC2845'>[RFC2845]<span> (</span><span class='info'>, &ldquo;Secret Key Transaction Authentication for DNS (TSIG),&rdquo; .</span><span>)</span></a>. Also, to protect the subscriber's privacy, LLQ is required to contain TSIG. This authentication mechanism is based on the shared secret key, which in BTMM's case is the subscriber's MobileMe account password. 

</p>
<p>Every time a DNS request/response is going to be issued, a TSIG RR is dynamically computed with HMAC-MD5 message digest algorithm (and the TSIG RR will be discarded once its has been used). Inside the TSIG RR, a name of the shared secret key in domain name syntax is included, so the receiver knows which key to used (especially useful if the receiver is the DNS server). This TSIG RR is appended to the additional data section before the message is send out. The receiver of the message verifies the TSIG RR and proceeds only if the TSIG is valid.

</p>
<p>Besides, the DNS messages are also protected by TLS <a class='info' href='#RFC2246'>[RFC2246]<span> (</span><span class='info'>, &ldquo;The TLS Protocol,&rdquo; .</span><span>)</span></a>, so that it prevents eavesdropping.

</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Using IPsec to Secure End-to-End Data Communication</h3>

<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1"></a><h3>7.3.1.&nbsp;
Internet Key Exchange</h3>

<p>
Before the Security Association can be established between two end hosts, Internet Key Exchange (IKE) process needs to be accomplished.

</p>
<p>
BTMM calls another process Racoon <a class='info' href='#Racoon'>[Racoon]<span> (</span><span class='info'>, &ldquo;Racoon,&rdquo; .</span><span>)</span></a> to do the key exchange, after which the key will be put into Security Association Database (SAD). The exchange mode is set to be aggressive so that it would not take too long. And it uses pre-shared key to do the user authentication. The subscriber's FQDN is used as both identifier and pre-shared key during IKE process. 

</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.2"></a><h3>7.3.2.&nbsp;
End-to-End Encryption</h3>

<p>
When it comes the time to set up Security Associations between two BTMM clients, we have two choices: either to put the other host's IPv4 address in the destination address field, or otherwise put in the IPv6 address of the remote end. 

</p>
<p>
If the IPv4 address (which is the public address of a NAT) is chosen to associate with a Security Association, that means we set up a Security Association between one end host and the NAT of the other host. The IPv6 packet would then be wrapped by UDP header and then get encrypted by ESP. After the encrypted packet arrives at the NAT, the NAT device decrypts the packet and sends it to the destination according to the port mapping. Although this approach seems viable, there are 3 drawbacks:
</p>
<ul class="text">
<li>
First, the encryption is not end-to-end, i.e. only the path between one end host and the NAT device of the other end is protected. The rest of the path, from the NAT device to the final receiver, is unprotected and vulnerable to attacks. If the NAT device is not trustworthy, the communication is at high risk. Even if the NAT device is trustworthy (e.g. the user owns the NAT), it is not uncommon that the NAT communicates with the host through broadcast channel, which provides opportunities for eavesdropper to sniff the sensitive data (consider the unlocked "free" wifi access near your neighborhood).

</li>
<li>
Second, quite a lot BTMM clients are on move very often. Every time they change their attachment points to the Internet they will get different IPv4 addresses. As a result, the previously established Security Associations become obsoleted and the two end hosts need to re-establish them again. This is a waste of time and resources.

</li>
<li>
Third, this approach assumes that the NAT device is able and willing to do the IPsec ESP for the host behind it, which is not always the case.

</li>
</ul><p>

</p>
<p>
Consequently, BTMM decides to put the IPv6 ULA into the destination field of IPsec Security Associations. This way, the end-to-end path between the hosts are fully protected, and the Security Associations can survive the network changes since the IPv6 ULA remains the same even the BTMM client changes its location. Furthermore, the encryption is transparent to the NAT device, which means we do not need the NAT device to interfere with the IPsec protection.

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.&nbsp;References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="DDNS">[DDNS]</a></td>
<td class="author-text">&ldquo;Dynamic Updates in the Domain Name System (DNS UPDATE),&rdquo; draft&nbsp;draft-cheshire-dnsext-dns-sd-05.txt.</td></tr>
<tr><td class="author-text" valign="top"><a name="DDUL">[DDUL]</a></td>
<td class="author-text">&ldquo;Dynamic DNS Update Leases,&rdquo; draft&nbsp;-sekar-dns-ul-01.txt.</td></tr>
<tr><td class="author-text" valign="top"><a name="DNS-LLQ">[DNS-LLQ]</a></td>
<td class="author-text">&ldquo;DNS Long-Lived Queries,&rdquo; draft&nbsp;draft-cheshire-dns-llq-01.txt.</td></tr>
<tr><td class="author-text" valign="top"><a name="DNS-SD">[DNS-SD]</a></td>
<td class="author-text">&ldquo;DNS-Based Service Discovery,&rdquo; draft&nbsp;draft-cheshire-dnsext-dns-sd-05.txt.</td></tr>
<tr><td class="author-text" valign="top"><a name="EUI64">[EUI64]</a></td>
<td class="author-text">&ldquo;Guidelines for 64-bit Global Identifier (EUI-64),&rdquo; http&nbsp;://standards.ieee.org/regauth/oui/tutorials/EUI64.html.</td></tr>
<tr><td class="author-text" valign="top"><a name="HIP">[HIP]</a></td>
<td class="author-text">&ldquo;<a href="http://tools.ietf.org/html/rfc4423">Host Identify Protocol (HIP) Architecture</a>,&rdquo; RFC&nbsp;4423.</td></tr>
<tr><td class="author-text" valign="top"><a name="IGD">[IGD]</a></td>
<td class="author-text">&ldquo;Internet Gateway Device(IGD) Standard Device Control Protocol,&rdquo; http&nbsp;://www.upnp.org/standardizeddcps/igd.asp.</td></tr>
<tr><td class="author-text" valign="top"><a name="NAT-PMP">[NAT-PMP]</a></td>
<td class="author-text">&ldquo;NAT Port Mapping Protocol,&rdquo; draft&nbsp;draft-cheshire-nat-pmp-03.txt.</td></tr>
<tr><td class="author-text" valign="top"><a name="PKINIT">[PKINIT]</a></td>
<td class="author-text">&ldquo;<a href="http://tools.ietf.org/html/rfc4556">Public Key Cryptography for Initial Authentication in Kerberos (PKINIT)</a>,&rdquo; RFC&nbsp;4556.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1035">[RFC1035]</a></td>
<td class="author-text">&ldquo;<a href="http://tools.ietf.org/html/rfc1035">Domain Names - implementation and specification</a>,&rdquo; RFC&nbsp;1035.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1918">[RFC1918]</a></td>
<td class="author-text">&ldquo;<a href="http://tools.ietf.org/html/rfc1918">Address Allocation for Private Internets</a>,&rdquo; RFC&nbsp;1918.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2246">[RFC2246]</a></td>
<td class="author-text">&ldquo;<a href="http://tools.ietf.org/html/rfc2246">The TLS Protocol</a>,&rdquo; RFC&nbsp;2246.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2782">[RFC2782]</a></td>
<td class="author-text">&ldquo;<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2845">[RFC2845]</a></td>
<td class="author-text">&ldquo;<a href="http://tools.ietf.org/html/rfc2845">Secret Key Transaction Authentication for DNS (TSIG)</a>,&rdquo; RFC&nbsp;2845.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4193">[RFC4193]</a></td>
<td class="author-text">&ldquo;<a href="http://tools.ietf.org/html/rfc4193">Unique Local IPv6 Unicast Address</a>,&rdquo; RFC&nbsp;4193.</td></tr>
<tr><td class="author-text" valign="top"><a name="Racoon">[Racoon]</a></td>
<td class="author-text">&ldquo;Racoon,&rdquo; http&nbsp;://netbsd.gw.com/cgi-bin/man-cgi?racoon++NetBSD-current.</td></tr>
<tr><td class="author-text" valign="top"><a name="WWDC">[WWDC]</a></td>
<td class="author-text">&ldquo;Worldwide Developers Conference,&rdquo; http&nbsp;developer.apple.com/wwdc/.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stuart Cheshire</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Apple Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1 Infinite Loop</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cupertino, CA  95014</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 408 974 3207</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:cheshire@apple.com">cheshire@apple.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Zhenkai Zhu</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UCLA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4805 Boelter Hall, UCLA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Los Angeles, CA  90095</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 310 993 7128</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:zhenkai@cs.ucla.edu">zhenkai@cs.ucla.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ryuji Wakikawa</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Toyota ITC</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">465 Bernardo Avenue</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mountain View, CA  94043</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ryuji@jp.toyota-itc.com">ryuji@jp.toyota-itc.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Lixia Zhang</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UCLA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3713 Boelter Hall, UCLA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Los Angeles, CA  90095</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 310 825 2695</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:lixia@cs.ucla.edu">lixia@cs.ucla.edu</a></td></tr>
</table>
</body></html>
