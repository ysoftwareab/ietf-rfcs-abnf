<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Sieve Email Filtering: 
  MIME part Tests, Iteration, Extraction, Replacement and Enclosure</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Sieve Email Filtering: 
  MIME part Tests, Iteration, Extraction, Replacement and Enclosure">
<meta name="keywords" content="Email, Electronic Mail, Internet Mail, Message Filtering">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">T. Hansen</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">AT&amp;T Laboratories</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">C. Daboo</td></tr>
<tr><td class="header">Expires: May 25, 2009</td><td class="header">Apple Inc.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">November 21, 2008</td></tr>
</table></td></tr></table>
<h1><br />Sieve Email Filtering: 
  MIME part Tests, Iteration, Extraction, Replacement and Enclosure<br />draft-ietf-sieve-mime-loop-08</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 25, 2009.</p>

<h3>Abstract</h3>

<p>
    This document defines extensions to the Sieve email filtering language
    to permit analysis and manipulation of the MIME body parts of an email
    message.
    
</p>
<h3>Note</h3>

<p>
    This document is being discussed on the MTA-FILTERS mailing list, ietf-mta-filters@imc.org.
    
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Conventions Used in This Document<br />
<a href="#anchor3">3.</a>&nbsp;
Sieve Loops: Actions "foreverypart" and "break"<br />
<a href="#anchor4">4.</a>&nbsp;
Changes to Sieve Tests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#header_test">4.1.</a>&nbsp;
Test "header"<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.2.</a>&nbsp;
Test "address"<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.3.</a>&nbsp;
Test "exists"<br />
<a href="#anchor7">5.</a>&nbsp;
Action "replace"<br />
<a href="#anchor8">6.</a>&nbsp;
Action "enclose"<br />
<a href="#anchor9">7.</a>&nbsp;
Action "extracttext"<br />
<a href="#anchor10">8.</a>&nbsp;
Sieve Capability Strings<br />
<a href="#anchor11">9.</a>&nbsp;
Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">9.1.</a>&nbsp;
Example 1<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">9.2.</a>&nbsp;
Example 2<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">9.3.</a>&nbsp;
Example 3<br />
<a href="#anchor15">10.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor16">11.</a>&nbsp;
Security Considerations<br />
<a href="#anchor17">12.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">12.1.</a>&nbsp;
foreverypart capability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">12.2.</a>&nbsp;
mime capability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">12.3.</a>&nbsp;
replace capability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">12.4.</a>&nbsp;
enclose capability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">12.5.</a>&nbsp;
extracttext capability<br />
<a href="#anchor23">13.</a>&nbsp;
Change History<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">13.1.</a>&nbsp;
draft-ietf-sieve-mime-08<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">13.2.</a>&nbsp;
draft-ietf-sieve-mime-07<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">13.3.</a>&nbsp;
draft-ietf-sieve-mime-06<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">13.4.</a>&nbsp;
draft-ietf-sieve-mime-05<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">13.5.</a>&nbsp;
draft-ietf-sieve-mime-04<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">13.6.</a>&nbsp;
draft-ietf-sieve-mime-03<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">13.7.</a>&nbsp;
draft-ietf-sieve-mime-02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">13.8.</a>&nbsp;
draft-ietf-sieve-mime-01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">13.9.</a>&nbsp;
draft-ietf-sieve-mime-00<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">13.10.</a>&nbsp;
draft-sieve-mime-loop-04<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor34">13.11.</a>&nbsp;
draft-hansen-sieve-loop-03<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor35">13.12.</a>&nbsp;
draft-hansen-sieve-loop-02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">13.13.</a>&nbsp;
draft-hansen-sieve-loop-01<br />
<a href="#rfc.references1">14.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">14.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">14.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
        MIME messages (<a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a>) are often complex objects, consisting of many parts and sub-parts.

	This extension defines mechanisms for performing tests on MIME body parts,
	looping through the MIME body parts,
	extracting information from a MIME body part,
	changing the contents of a MIME body part,
	and enclosing the entire message within a wrapper.
    
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions Used in This Document</h3>

<p>
            Conventions for notations are as in <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a> section 1.1.
        
</p>
<p>
            The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
        
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Sieve Loops: Actions "foreverypart" and "break"</h3>

<p>
      The base Sieve language has no looping mechanism.
      Given that messages may contain multiple parts, in order to support
      filters that apply to any and all parts, we introduce a
      new control command: "foreverypart", which is an iterator that
      walks though every MIME part of a message, including nested
      parts, depth first, and applies the commands in the specified block to each of them.
      The iterator will start with the first MIME part (as its current
      context) and will execute a command block (Sieve commands
      enclosed by {...}).
      Upon completion of this command block, the
      iterator advances to the next MIME part (as its current context)
      and executes the same command block again.
    
</p>
<p>
      The iterator can be terminated prematurely by a new Sieve command, "break".
    
</p>
<p>
      </p>
<blockquote class="text"><dl>
<dt>Usage:</dt>
<dd>
      foreverypart [":name" string] block
    
</dd>
<dt>Usage:</dt>
<dd>
      break [":name" string];
    
</dd>
</dl></blockquote><p>
    
</p>
<p>
      "foreverypart" commands can be nested inside other "foreverypart" commands.
      When this occurs, the nested "foreverypart" iterates over the MIME parts contained
      within the MIME part currently being targeted by the nearest enclosing "foreverypart" command.
      (That is, the inner loop only operates on children of the bodypart currently accessed by the outer loop.)
      If that MIME part is a terminal MIME part (i.e. does not contain other MIME parts)
      then the nested "foreverypart" loop is simply ignored.
    
</p>
<p>
      Sieve implementations MAY limit the number of nested loops that occur within one another,
      however they MUST support at least one nested loop inside another loop.
    
</p>
<p>
      If a name is given to a "break" command, it terminates the closest enclosing loop with the identical matching name.
      (If a nested "foreverypart" name is the same as a "foreverpart" name in an outer level, the outer level name is hidden.)
      It is an error if there is no enclosing loop with that name.
    
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Changes to Sieve Tests</h3>

<p>
    This specification extends the base Sieve "header", "address" and "exists" tests to support targeting those tests at a specific MIME part or at all MIME parts in the enclosing scope.
  
</p>
<a name="header_test"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Test "header"</h3>

<p>
      The "header" test is extended with the addition of new ":mime" and ":anychild" tagged arguments and their associated options.
    
</p>
<p>
      </p>
<blockquote class="text"><dl>
<dt>Usage:</dt>
<dd>
          header [":mime"] [":anychild"] [MIMEOPTS]
          [COMPARATOR] [MATCH-TYPE]<br />

          &lt;header-names: string-list&gt; &lt;key-list: string-list&gt;
        
</dd>
<dt>Usage:</dt>
<dd>
          The definition of [MIMEOPTS] is:
        
</dd>
<dt></dt>
<dd>
          Syntax: ":type" / ":subtype" / ":contenttype" /
                  ":param" &lt;param-list: string-list&gt;
        
</dd>
</dl></blockquote><p>
    
</p>
<p>
      When the ":mime" tagged argument is present in the "header" test, it will parse the MIME header lines in the message so that tests can be performed on specific elements.
    
</p>
<p>
		When used outside the context of a "foreverypart" iterator, and
		without an ":anychild" tagged argument, the "header" test will examine
		only the outer top-level RFC2822 headers of the message.
    
</p>
<p>
		When used inside the context of a "foreverypart" iterator, and
		without an ":anychild" tagged argument, the "header" test will examine
		the headers associated with the current MIME part context from the loop.
	
</p>
<p>
		When used outside the context of a "foreverypart" iterator, and
		with an ":anychild" tagged argument, the "header" test
		will examine all MIME body parts and return true if any of them
		satisfies the test.
	
</p>
<p>
		When used inside the context of a "foreverypart" iterator, and
		with an ":anychild" tagged argument, the "header" test will examine
		the current MIME part context and all its nested MIME body parts,
		returning true if any of them satisfies the test.
	
</p>
<p>
      The "header" test with the ":mime" tagged argument can test various aspects of certain structured MIME headers. These options are available:

      </p>
<blockquote class="text"><dl>
<dt>:type</dt>
<dd>
            parses the header assuming it has the format of a "Content-Type:" MIME header field, and tests the value of the MIME type specified in the header.
        
</dd>
<dt>:subtype</dt>
<dd>
            parses the header assuming it has the format of a "Content-Type:" MIME header field, and tests the value of the MIME subtype specified in the header.
        
</dd>
<dt>:contenttype</dt>
<dd>
            parses the header assuming it has the format of a "Content-Type:" MIME header field, and tests the combined value of the MIME type and subtype specified in the header.
        
</dd>
<dt>:param</dt>
<dd>
            parses the header looking for MIME parameters in the header.
	    The supplied string-list lists the names of any parameters to be tested.
	    If any one named parameter value matches any of the test string values, the test will return true.
        
</dd>
</dl></blockquote><p>
    
</p>
<p>Example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
require ["mime", "fileinto"];

if header :mime :type "Content-Type" "image"
{
    fileinto "INBOX.images";
}
</pre></div>
<p>
        In this example, any message that contains a MIME image type part at the top-level is saved to the mailbox "INBOX.images".
    
</p>
<p>Example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
require ["mime", "fileinto"];

if header :mime :anychild :contenttype
          "Content-Type" "text/html"
{
    fileinto "INBOX.html";
}
</pre></div>
<p>
        In this example, any message that contains any MIME part with a content-type of "text/html" is saved to the mailbox "INBOX.html".
    
</p>
<p>Example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
require ["mime", "foreverypart", "fileinto"];

foreverypart
{
    if allof (
      header :mime :param "filename" :contains
         "Content-Disposition" "important",
      header :mime :subtype "Content-Type" "pdf",
      size :over "100K")
    {
        fileinto "INBOX.important";
        break;
    }
}
</pre></div>
<p>
	In this example, any message that contains a MIME part that
	has a content-disposition with a filename parameter containing the text
	"important", has a content-subtype of "pdf" and is bigger than 100 Kb
	is saved to the mailbox "INBOX.important".
    
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Test "address"</h3>

<p>
      The "address" test is extended with the addition of new ":mime" and ":anychild" tagged arguments
      and their associated options.
    
</p>
<p>
      </p>
<blockquote class="text"><dl>
<dt>Usage:</dt>
<dd>
       address [":mime"] [":anychild"] [COMPARATOR]
       [ADDRESS-PART] [MATCH-TYPE]<br />

            &lt;header-list: string-list&gt; &lt;key-list: string-list&gt;
        
</dd>
</dl></blockquote><p>
    
</p>
<p>
      When the ":mime" tagged argument is present in the "address" test,
      it will parse the MIME header lines as if they were standard address
      header lines in a message so that tests can be performed on specific elements.
    
</p>
<p>
      The behavior of the ":anychild" tagged argument and the interaction with the "foreverypart"
      iterator is the same as for the extended "header" test <a class='info' href='#header_test'>Section&nbsp;4.1<span> (</span><span class='info'>Test &quot;header&quot;</span><span>)</span></a>.
    
</p>
<p>
      That is,
      </p>
<blockquote class="text">
<p>the use of "address" with no ":mime" and ":anychild" tagged argument is the test defined
	  in <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>,
	  i.e. it will *only* operate on top level header fields, whether it is inside "foreverypart" or not.
	
</p>
<p>
	  the use of "address" with ":mime" and no ":anychild" operates on the current MIME part only
	  (or on the top level header fields, if outside "foreverypart")
	
</p>
<p>
	  the use of "address" with ":mime" and ":anychild" operates on the current MIME part and all of its descendants
	
</p>
</blockquote><p>
    
</p>
<p>Example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
require ["mime", "fileinto"];

if address :mime :is :all "content-from" "tim@example.com"
{
    fileinto "INBOX.part-from-tim";
}
</pre></div>
<p>
        In this example, any message that contains a MIME Content-From header at the top-level
	matching the text "tim@example.com" is saved to the mailbox "INBOX.part-from-time".
    
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Test "exists"</h3>

<p>
      The "exists" test is extended with the addition of the new ":mime" and ":anychild" tagged arguments and their associated options.
    
</p>
<p>
      </p>
<blockquote class="text"><dl>
<dt>Usage:</dt>
<dd>
       exists [":mime"] [":anychild"] &lt;header-names: string-list&gt;
        
</dd>
</dl></blockquote><p>
    
</p>
<p>
      When the ":mime" tagged argument is present in the "exists" test,
      the test is extended to check for the existence of MIME headers in MIME parts.
    
</p>
<p>
      The behavior of the ":anychild" tagged argument and the interaction
      with the "foreverypart" iterator is the same
      as for the extended "header" test <a class='info' href='#header_test'>Section&nbsp;4.1<span> (</span><span class='info'>Test &quot;header&quot;</span><span>)</span></a>.
    
</p>
<p>
      That is,
      </p>
<blockquote class="text">
<p>the use of "exists" with no ":mime" and ":anychild" tagged argument is the test defined
	  in <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>,
	  i.e. it will *only* operate on top level header fields, whether it is inside "foreverypart" or not.
	
</p>
<p>
	  the use of "exists" with ":mime" and no ":anychild" operates on the current MIME part only
	  (or on the top level header fields, if outside "foreverypart")
	
</p>
<p>
	  the use of "exists" with ":mime" and ":anychild" operates on the current MIME part and all of its descendants
	
</p>
</blockquote><p>
    
</p>
<p>Example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
require ["mime", "fileinto"];

if exists :mime :anychild "content-md5"
{
    fileinto "INBOX.md5";
}
</pre></div>
<p>
        In this example, any message that contains a MIME Content-MD5 header in any MIME part is saved to the mailbox "INBOX.md5".
    
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Action "replace"</h3>

<p>
      </p>
<blockquote class="text"><dl>
<dt>Usage:</dt>
<dd>
      replace [":mime"] [":subject" string] [":from" string] &lt;replacement: string&gt;
    
</dd>
</dl></blockquote><p>
    
</p>
<p>
      The "replace" command is defined to allow a MIME part to be replaced with the text supplied in the command.
    
</p>
<p>
      When used in the context of a "foreverypart" iterator, the MIME part to be replaced is the "current" MIME part.
      If the current MIME context is a multipart MIME part, the entire multipart MIME part is replaced,
      which would alter the MIME structure of the message by eliminating all of the children of the multipart part.
      (Replacing a non-multipart MIME part within a "foreverypart" loop context does not alter the overall message
      structure.)
      If the MIME structure is altered, the change takes effect immediately:
      the "foreverypart" iterator that is executing does not go into the no-longer existing body parts,
      and subsequent "foreverypart" iterators would use the new message structure.
    
</p>
<p>
      When used outside the context of a "foreverypart" loop, the MIME part to be replaced is the entire message.
    
</p>
<p>
      If the :mime parameter is not specified, the replacement string is a text/plain part in UTF-8.
    
</p>
<p>
      If the :mime parameter is specified, then the replacement string is,
      in fact, a MIME entity as defined in <a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a> section 2.4,
      including both MIME headers and content.
    
</p>
<p>
      If the entire message is being replaced, the optional ":subject" parameter specifies
      a subject line to attach to the message that is generated.
      UTF-8 characters can be used in the string argument; implementations MUST convert the string to
      <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> encoded words if and only if non-ASCII characters are present.
      Implementations MUST preserve the previous Subject header as an Original-Subject header.
      Implementations MUST preserve all other header fields from the original
      message with the exception of those relating to the MIME structure that is being replaced.
    
</p>
<p>
      If the entire message is being replaced, the optional ":from" parameter may be used to specify
      an alternate address to use in the From field of the message that is generated.
      The string must specify a valid <a class='info' href='#RFC2822'>[RFC2822]<span> (</span><span class='info'>Resnick, P., &ldquo;Internet Message Format,&rdquo; April&nbsp;2001.</span><span>)</span></a> mailbox-list.
      Implementations SHOULD check the syntax and generate an error when a syntactically
      invalid ":from" parameter is specified.
      Implementations MAY also impose restrictions on what addresses can be specified in a ":from" parameter;
      it is suggested that values that fail such a validity check simply be ignored rather than causing
      the replace action to fail.
      Implementations MUST preserve the previous From header as an Original-From header.
    
</p>
<p>
      If ":mime" is specified and either ":subject" or ":from" is specified,
      the ":subject:" or ":from" parameter MUST be ignored.
      This SHOULD be flagged as a compilation error.
    
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Action "enclose"</h3>

<p>
      </p>
<blockquote class="text"><dl>
<dt>Usage:</dt>
<dd>
          enclose &lt;:subject string&gt; &lt;:headers string-list&gt; string
        
</dd>
</dl></blockquote><p>
    
</p>
<p>
      A new Sieve action command is defined to allow an entire message to be enclosed as an attachment to a new message.
      After enclosure, subsequent actions affecting the message header or content,
      as well as tests operating on the MIME structure or accessing MIME header fields,
      use the newly created message instead of the original message;
      this means that any use of a "replace" action or other similar actions should be executed before the "enclose" action.
    
</p>
<p>
      If multiple "enclose" actions are executed by a script, the message is enclosed multiple times.
      (If a Sieve script desires to choose between different enclosures, or wants to delay the enclosure to the end of the script,
      it can use variables with appropriate tests. <a class='info' href='#RFC5229'>[RFC5229]<span> (</span><span class='info'>Homme, K., &ldquo;Sieve Email Filtering: Variables Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a>)
    
</p>
<p>
      This action does not affect messages that are forwarded via a "redirect" action.
    
</p>
<p>
      Specifically, the original message becomes a multipart/mixed message with two parts:
      a text/plain portion with the string argument as its body,
      and a message/rfc822 portion with the original message enclosed.
      The Content-Type: header field becomes multipart/mixed.
      The optional Subject: header is specified by the :subject argument;
      if not present the subject will be taken from the enclosed message.
      Any headers specified by :headers are copied from the old message into the new message.
      If not specified by :headers, Date: and From: headers should be synthesized
      to reflect the current date and the user running the Sieve action.
    
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Action "extracttext"</h3>

<p>
      </p>
<blockquote class="text"><dl>
<dt>Usage:</dt>
<dd>
	  extracttext [MODIFIER] [":first" number] &lt;varname: string&gt;
        
</dd>
</dl></blockquote><p>
    
</p>
<p>
      The "extracttext" action may be used within the context of a "foreverypart" loop.
      Servers MUST support transcoding of any textual body part into UTF-8 for use with this action.
      This requires decoding any
      transfer encoding as well as transcoding from the indicated character set into UTF-8.
      It stores at most :first characters of the transcoded content of the current MIME body part in the variable
      identified by varname.
      If the :first parameter is not present, the whole content of the current MIME body part is stored.
      In either case the actually stored data MAY be truncated
      to conform to implementation specific limit on variable length and/or
      on MIME body part length.
      If the transfer encoding or character set is
      unrecognized by the implementation or recognized but invalid, an
      empty string will result.
    
</p>
<p>
      If "extracttext" is used outside the context of a "foreverypart" loop,
      the action will set the variable identified by varname to the empty string.
      This SHOULD be flagged as a compilation error.
    
</p>
<p>
      Modifiers are applied on the extracted text before it is stored in
      the variable.  See <a class='info' href='#RFC5229'>[RFC5229]<span> (</span><span class='info'>Homme, K., &ldquo;Sieve Email Filtering: Variables Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a> for details.
    
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Sieve Capability Strings</h3>

<p>
      A Sieve implementation that defines the "foreverypart" and "break" actions
      will advertise the capability string "foreverypart".
    
</p>
<p>
      A Sieve implementation that defines the ":mime" and ":anychild" tagged
      arguments to the "header", "address" and "exists" commands will advertise
      the capability string "mime".
    
</p>
<p>
      A Sieve implementation that defines the "replace" action will advertise the capability string "replace".
    
</p>
<p>
      A Sieve implementation that defines the "enclose" action will advertise the capability string "enclose".
    
</p>
<p>
      A Sieve implementation that defines the "extracttext" action will advertise the capability string "extracttext".
      Note that to be useful, the "extracttext" action also requires the "variables" <a class='info' href='#RFC5229'>[RFC5229]<span> (</span><span class='info'>Homme, K., &ldquo;Sieve Email Filtering: Variables Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a>
      and "foreverypart" capabilities.
    
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Examples</h3>

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Example 1</h3>

<p>
        A Sieve script to replace all the Windows executable attachments in a message would be:
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
require [ "foreverypart", "mime", "replace" ];
foreverypart
{
  if anyof (
         header :mime :contenttype :is "Content-Type" "application/exe",
         header :mime :param "filename"
           ["Content-Type", "Content-Disposition"] :matches "*.com" )
  {
    replace "Executable attachment removed by user filter";
  }
}
</pre></div>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Example 2</h3>

<p>
        A Sieve script to warn the user about executable attachment types would be:
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
require [ "foreverypart", "mime", "enclose" ];

foreverypart
{
  if header :mime :param "filename"
     ["Content-Type", "Content-Disposition"] :matches
       ["*.com", "*.exe", "*.vbs", "*.scr",
        "*.pif", "*.hta", "*.bat", "*.zip" ]
  {
    # these attachment types are executable
    enclose :subject "Warning" :text
WARNING! The enclosed message contains executable attachments.
These attachments types may contain a computer virus program
that can infect your computer and potentially damage your data.

Before clicking on these message attachments, you should verify
with the sender that this message was sent by them and not a
computer virus.
.
;
    break;
  }
}
</pre></div>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
Example 3</h3>

<p>
        A Sieve script to extract subject and text out of messages from the boss:
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
require ["mime", "variables", "extracttext"];

if header :contains "from" "boss@example.org"
{
  # :matches is used to get the value of the Subject header
  if header :matches "Subject" "*"
  {
    set "subject" "${1}";
  }

  # extract the first 100 characters of the first text/* part
  foreverypart
  {
    if header :mime :type :is "Content-Type" "text"
    {
      extracttext :first 100 "msgcontent";
      break;
    }
  }

  # if it's not a 'for your information' message
  if not header :contains "subject" "FYI:"
  {
    # do something using ${subject} and ${msgcontent}
    # such as sending a notification using a
    # notification extension
  }
}
</pre></div>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgements</h3>

<p>Comments from members of the MTA Filters Working Group, in particular
    Ned Freed, Kjetil Torgrim Homme, Mark Mallett, Alexey Melnikov, Aaron Stone and Nigel Swinson are gratefully acknowledged.
    
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Security Considerations</h3>

<p>The "enclose" action creates an entirely new message, as compared to just redirecting or forwarding the existing message.
       Therefore, any site policies applicable to message submission should be enforced.
    
</p>
<p>
      The looping specification specified here provides easier access to information about the message contents, which may also be achieved through other sieve tests.
      This is not believed to raise any additional security
      issues beyond those for the Sieve "envelope" and <a class='info' href='#I-D.ietf-sieve-body'>"body"<span> (</span><span class='info'>Guenther, P. and J. Degener, &ldquo;Sieve Email Filtering: Body Extension,&rdquo; March&nbsp;2008.</span><span>)</span></a> [I&#8209;D.ietf&#8209;sieve&#8209;body] tests.
    
</p>
<p>
      Any change in message content may interfere with digital signature
      mechanisms that include that content in the signed material.
      In particular, using "replace" makes direct changes to the body content and
      will affect the body hash included in DKIM signatures, or the message signature
      used for S/MIME or OpenPGP.
    
</p>
<p>
      It is not possible to examine the MIME structure of decrypted content
      in a multipart/encrypted MIME part. 
    
</p>
<p>
      When "enclose" is used on a message containing a multipart/signed MIME
      part, the SIEVE implementation MUST ensure that the original message is
      copied octet-for-octet to maintain the validity of the digital
      signature.
    
</p>
<p>
       The system MUST be sized and restricted in such a manner that
       even malicious use of mime part matching does not deny service to
       other users of the host system.
    
</p>
<p>All of the security considerations given in the base Sieve
       specification also apply to these extensions.
    
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
IANA Considerations</h3>

<p>
      The Original-Subject: and Original-From: headers are to be registered in the Permanent Message Header Fields table.
    
</p>
<p>
      The following templates specify the IANA registrations of the Sieve
      extensions specified in this document.  This information should be
      added to the list of sieve extensions given on
      http://www.iana.org/assignments/sieve-extensions.
    
</p>
<p>
    [[ RFC Editor Note: replace RFC XXXX with a reference to this RFC. ]]
    
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
foreverypart capability</h3>

<p>
      To: iana@iana.org<br />

      Subject: Registration of new Sieve extension
      <br />
<br />

        Capability name: foreverypart
      <br />

        Description: adds the "foreverypart" and "break" actions for iterating through MIME parts of a message.
      <br />
<br />

        RFC number: RFC XXXX
      <br />

        Contact address: The Sieve discussion list &lt;ietf-mta-filters@imc.org&gt;.
    
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
mime capability</h3>

<p>
      To: iana@iana.org<br />

      Subject: Registration of new Sieve extension
      <br />
<br />

        Capability name: mime
      <br />

        Description: adds the ":mime" and ":anychild" tagged arguments to the
	"header", "address" and "exists" tests.
      <br />
<br />

        RFC number: RFC XXXX
      <br />

        Contact address: The Sieve discussion list &lt;ietf-mta-filters@imc.org&gt;.
    
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3"></a><h3>12.3.&nbsp;
replace capability</h3>

<p>
      To: iana@iana.org<br />

      Subject: Registration of new Sieve extension
      <br />
<br />

        Capability name: replace
      <br />

        Description: adds the "replace" action for replacing a MIME body part of a message.
      <br />
<br />

        RFC number: RFC XXXX
      <br />

        Contact address: The Sieve discussion list &lt;ietf-mta-filters@imc.org&gt;.
    
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.4"></a><h3>12.4.&nbsp;
enclose capability</h3>

<p>
      To: iana@iana.org<br />

      Subject: Registration of new Sieve extension
      <br />

        Capability name: enclose
      <br />

        Description: adds the "enclose" action for enclosing a message with a wrapper.
      <br />
<br />

        RFC number: RFC XXXX
      <br />

        Contact address: The Sieve discussion list &lt;ietf-mta-filters@imc.org&gt;.
    
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.5"></a><h3>12.5.&nbsp;
extracttext capability</h3>

<p>
      To: iana@iana.org<br />

      Subject: Registration of new Sieve extension
      <br />

        Capability name: extracttext
      <br />

        Description: adds the "extracttext" action for extracting text from a MIME body part.
      <br />
<br />

        RFC number: RFC XXXX
      <br />

        Contact address: The Sieve discussion list &lt;ietf-mta-filters@imc.org&gt;.
    
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Change History</h3>

<p>
    [[ RFC Editor NOTE: This section is to be removed prior to publication as an RFC. ]]
    
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.1"></a><h3>13.1.&nbsp;
draft-ietf-sieve-mime-08</h3>

<p>
	enhance description of enclose and multiple enclose.
	
</p>
<p>
	Minor nits
	
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.2"></a><h3>13.2.&nbsp;
draft-ietf-sieve-mime-07</h3>

<p>
	List :anychild parameter next to :mime, where it was added.
	
</p>
<p>
	Expand description of "address" and "exists".
	
</p>
<p>
	In replace, discuss interaction of :mime with :subject/:from.
	
</p>
<p>
	In enclose, expand discussion o fmultiple enclosures.
	
</p>
<p>
	Mention compilation error if extracttext is used outside of a foreverypart loop.
	
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.3"></a><h3>13.3.&nbsp;
draft-ietf-sieve-mime-06</h3>

<p>
	Added note to foreverypart about nested identical names hiding outer names.
	
</p>
<p>
	Added notes to Security Considerations section about it not working on multipart/signed sections,
	and how replace/enclose may affect signatures.
	
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.4"></a><h3>13.4.&nbsp;
draft-ietf-sieve-mime-05</h3>

<p>
        </p>
<blockquote class="text">
<p>Changed for_every_part to foreverypart, and extract_text to extracttext.
</p>
<p>Add option :name parameter to foreverypart and break.
      	    break :name "string" will break out of closest enclosing foreverypart loop with that name.
          
</p>
<p>Clarify nesting a bit more.
</p>
<p>Minor consistency nit picking.
</p>
</blockquote><p>
      
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.5"></a><h3>13.5.&nbsp;
draft-ietf-sieve-mime-04</h3>

<p>
        </p>
<blockquote class="text">
<p>loops are depth first
</p>
<p>:anychild clarifications
</p>
<p>update examples
</p>
<p>grammar nits
</p>
<p>transcoding for extract_text
</p>
</blockquote><p>
      
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.6"></a><h3>13.6.&nbsp;
draft-ietf-sieve-mime-03</h3>

<p>
        </p>
<blockquote class="text">
<p>add extraction
</p>
<p>add security considerations
</p>
<p>fill in iana considerations
</p>
</blockquote><p>
      
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.7"></a><h3>13.7.&nbsp;
draft-ietf-sieve-mime-02</h3>

<p>
        </p>
<blockquote class="text">
<p>minor syntax glitches in examples
</p>
<p>Add clarification on "replace" affecting subsequent for_every_part loops?
</p>
<p>Add IANA considerations for Original-Subject: and Original-From:.
</p>
<p>Add note on "enclose" creating From: and Date: headers.
</p>
</blockquote><p>
      
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.8"></a><h3>13.8.&nbsp;
draft-ietf-sieve-mime-01</h3>

<p>
        </p>
<blockquote class="text">
<p>what happens when nested for_every_part loop's
</p>
<p>a "mime" shorthand for testing the type/subtype, without requiring
</p>
<p>interactions with variables<br />

            notifications<br />

            notifications to calendar service<br />

            address tests, exists tests<br />

            mimeheader, mimeparameter tests<br />

          
</p>
</blockquote><p>
      
</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.9"></a><h3>13.9.&nbsp;
draft-ietf-sieve-mime-00</h3>

<p>
        </p>
<blockquote class="text">
<p>Changed title and text to emphasize MIME Tests.
</p>
<p>Changed for.every.part to for_every_part.
</p>
<p>Added :anychild to mime test.
	    Default is to use the current context or outer envelope; specifying :anychild will look at all children.
          
</p>
<p>Added clarifications to replacing parts affecting the structure.
</p>
<p>Added :mime option to replace, ala draft-ietf-sieve-vacation-06.
</p>
<p>Various other minor nit fixes.
</p>
</blockquote><p>
      
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.10"></a><h3>13.10.&nbsp;
draft-sieve-mime-loop-04</h3>

<p>
        </p>
<blockquote class="text">
<p>update reference for recent published rfcs
</p>
<p>extract-text now required to do decode transfer encoding and transcode to UTF-8
</p>
<p>removed editheader reference since its not actually used
</p>
<p>several text changes as suggested by Nigel Swinson, including re-writes to abstract and introduction
</p>
</blockquote><p>
      
</p>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.11"></a><h3>13.11.&nbsp;
draft-hansen-sieve-loop-03</h3>

<p>
        </p>
<blockquote class="text">
<p>after enclosure, subsequent actions affect newly created message
</p>
<p>synthesis of Date/From headers by the enclose action is no longer controversial
</p>
<p>Filled in Security Considerations
</p>
<p>Picked up extract_text action from draft-ietf-sieve-notify
</p>
<p>Expanded the IANA considerations section
</p>
</blockquote><p>
      
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.12"></a><h3>13.12.&nbsp;
draft-hansen-sieve-loop-02</h3>

<p>
        </p>
<blockquote class="text">
<p>Update to 3028bis reference.
</p>
<p>Added 2119 conventions section.
</p>
<p>Terminology/title tweaks.
</p>
<p>Added informative references to body and editheader extensions.
</p>
<p>Added description of nested loops.
</p>
<p>Replaced mime test by extensions to header, address and exists tests.
</p>
</blockquote><p>
      
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.13"></a><h3>13.13.&nbsp;
draft-hansen-sieve-loop-01</h3>

<p>
        </p>
<blockquote class="text">
<p>Merged with draft-daboo-sieve-mime-00.txt.
</p>
</blockquote><p>
      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2045">[RFC2045]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;2045, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2045.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2047">[RFC2047]</a></td>
<td class="author-text"><a href="mailto:moore@cs.utk.edu">Moore, K.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2047">MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text</a>,&rdquo; RFC&nbsp;2047, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2047.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2047.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2047.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2822">[RFC2822]</a></td>
<td class="author-text">Resnick, P., &ldquo;<a href="http://tools.ietf.org/html/rfc2822">Internet Message Format</a>,&rdquo; RFC&nbsp;2822, April&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc2822.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5228">[RFC5228]</a></td>
<td class="author-text">Guenther, P. and T. Showalter, &ldquo;<a href="http://tools.ietf.org/html/rfc5228">Sieve: An Email Filtering Language</a>,&rdquo; RFC&nbsp;5228, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5228.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sieve-body">[I-D.ietf-sieve-body]</a></td>
<td class="author-text">Guenther, P. and J. Degener, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sieve-body-09.txt">Sieve Email Filtering: Body Extension</a>,&rdquo; draft-ietf-sieve-body-09 (work in progress), March&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sieve-body-09.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5229">[RFC5229]</a></td>
<td class="author-text">Homme, K., &ldquo;<a href="http://tools.ietf.org/html/rfc5229">Sieve Email Filtering: Variables Extension</a>,&rdquo; RFC&nbsp;5229, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5229.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tony Hansen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">AT&amp;T Laboratories</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">200 Laurel Ave.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Middletown, NJ  07748</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:tony+sieveloop@maillennium.att.com">tony+sieveloop@maillennium.att.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cyrus Daboo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Apple Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1 Infinite Loop</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cupertino, CA  95014</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:cyrus@daboo.name">cyrus@daboo.name</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.apple.com/">http://www.apple.com/</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
