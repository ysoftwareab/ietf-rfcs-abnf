<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Configuration of Access Control Policy in REsource LOcation And Discovery (RELOAD) Base Protocol</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Processing an extended Kind">
<link href="#rfc.section.4" rel="Chapter" title="4 Security Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Examples">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Standard Access Control Policies">
<link href="#rfc.appendix.Appendix%20A.1.1" rel="Chapter" title="Appendix A.1.1 USER-MATCH">
<link href="#rfc.appendix.Appendix%20A.1.2" rel="Chapter" title="Appendix A.1.2 NODE-MATCH">
<link href="#rfc.appendix.Appendix%20A.1.3" rel="Chapter" title="Appendix A.1.3 USER-NODE-MATCH">
<link href="#rfc.appendix.Appendix%20A.1.4" rel="Chapter" title="Appendix A.1.4 NODE-MULTIPLE">
<link href="#rfc.appendix.Appendix%20A.2" rel="Chapter" title="Appendix A.2 Service Discovery Usage">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Release notes">
<link href="#rfc.appendix.Appendix%20B.1" rel="Chapter" title="Appendix B.1 Modifications between -02 and -01">
<link href="#rfc.appendix.Appendix%20B.2" rel="Chapter" title="Appendix B.2 Modifications between -01 and -00">
<link href="#rfc.appendix.Appendix%20B.3" rel="Chapter" title="Appendix B.3 Running Code Considerations">
<link href="#rfc.appendix.Appendix%20B.4" rel="Chapter" title="Appendix B.4 TODO List">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes an extension to the REsource LOcation And Discovery (RELOAD) base protocol to distribute the code of new Access Control Policies without having to upgrade the RELOAD implementations in an overlay.  " />
  <meta name="description" content="This document describes an extension to the REsource LOcation And Discovery (RELOAD) base protocol to distribute the code of new Access Control Policies without having to upgrade the RELOAD implementations in an overlay.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M.P.H. Petit-Huguenin</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Stonyfish, Inc.</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">May 13, 2011</td>
</tr>
<tr>
<td class="left">Expires: November 14, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Configuration of Access Control Policy in REsource LOcation And Discovery (RELOAD) Base Protocol<br />
  <span class="filename">draft-petithuguenin-p2psip-access-control-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes an extension to the REsource LOcation And Discovery (RELOAD) base protocol to distribute the code of new Access Control Policies without having to upgrade the RELOAD implementations in an overlay.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on November 14, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may not be modified, and derivative works of it may not be created, except to format it for publication as an RFC or to translate it into languages other than English.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Processing an extended Kind</a>
</li>
<li>4.   <a href="#rfc.section.4">Security Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Acknowledgements</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<li>7.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>7.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Examples</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Standard Access Control Policies</a>
</li>
<li>Appendix A.1.1.   <a href="#rfc.appendix.Appendix%20A.1.1">USER-MATCH</a>
</li>
<li>Appendix A.1.2.   <a href="#rfc.appendix.Appendix%20A.1.2">NODE-MATCH</a>
</li>
<li>Appendix A.1.3.   <a href="#rfc.appendix.Appendix%20A.1.3">USER-NODE-MATCH</a>
</li>
<li>Appendix A.1.4.   <a href="#rfc.appendix.Appendix%20A.1.4">NODE-MULTIPLE</a>
</li>
<li>Appendix A.2.   <a href="#rfc.appendix.Appendix%20A.2">Service Discovery Usage</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Release notes</a>
</li>
<li>Appendix B.1.   <a href="#rfc.appendix.Appendix%20B.1">Modifications between -02 and -01</a>
</li>
<li>Appendix B.2.   <a href="#rfc.appendix.Appendix%20B.2">Modifications between -01 and -00</a>
</li>
<li>Appendix B.3.   <a href="#rfc.appendix.Appendix%20B.3">Running Code Considerations</a>
</li>
<li>Appendix B.4.   <a href="#rfc.appendix.Appendix%20B.4">TODO List</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The RELOAD base protocol specifies an Access Control Policy as "defin[ing] whether a request from a given node to operate on a given value should succeed or fail." The paragraph continues saying that "[i]t is anticipated that only a small number of generic access control policies are required", but there is indications that this assumption will not hold.  On all the RELOAD Usages defined in other documents than the RELOAD base protocol, roughly 50% defines a new Access Control Policy.  </p>
<p id="rfc.section.1.p.2">The problem with a new Access Control Policy is that, because it is executed when a Store request is processed, it needs to be implemented by all the peers and so requires an upgrade of the software.  This is something that is probably not possible in large overlays or on overlays using different implementations.  For this reason, this document proposes an extension to the RELOAD configuration document that permits to transport the code of a new Access Control Policy to each peer.  </p>
<p id="rfc.section.1.p.3">This extension defines a new element &lt;access-control-code&gt; that can be optionally added to a &lt;kind&gt; element in the configuration document.  The &lt;access-control-code&gt; element contains <a href="#ECMA-262">ECMAScript</a> <cite title="NONE">[ECMA-262]</cite> code that will be called for each StoredData object in a StoreReq processed by a peer.  The code receives four parameters, corresponding to the Resource-ID, Signature, Kind and StoredDataValue of the value to store.  The code returns true or false to signal to the implementation if the request should succeed or fail.  </p>
<p id="rfc.section.1.p.4">For example the USER-MATCH Access Control Policy defined in the base protocol could be redefined by inserting the following code in an &lt;access-control-code&gt; element:</p>
<div id="#rfc.figure.1"></div>
<pre>return resource.equalsHash(signature.user_name.bytes());</pre>
<p></p>
<p id="rfc.section.1.p.6">The &lt;kind&gt; parameters are also passed to the code, so the NODE-MULTIPLE Access Control Policy could be implemented like this:</p>
<div id="#rfc.figure.2"></div>
<pre>for (var i = 0; i &lt; kind.max_node_multiple; i++) {
    if (resource.equalsHash(signature.node_id, i.width(4))) {
        return true;
    }
}
return false;</pre>
<p></p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Processing an extended Kind</h1>
<p id="rfc.section.3.p.1">A peer receiving a &lt;kind&gt; definition containing an access-control-code elemtn , either by retrieving it from the configuration server or in a ConfigUpdateReq message, MUST reject this configuration if the kind element is not signed or if the signature verification fails.</p>
<p id="rfc.section.3.p.2">If the &lt;access-control-code&gt; element is present in the namespace allocated to this specification, and the Access Control Policy is not natively implemented, then the code inside the element MUST be called for each DataValue found in a received StoreReq for this Kind.  For each call to the code, the following ECMAScript objects, properties and functions MUST be available: </p>
<p></p>

<dl>
<dt>resource:</dt>
<dd style="margin-left: 8">An opaque object representing the Resource-ID, as an array of bytes.</dd>
<dt>resource.equalsHash(Object...):</dt>
<dd style="margin-left: 8">A function that returns true if hashing the concatenation of the arguments according to the mapping function of the overlay algorithm is equal to the Resource-ID.  Each argument is an array of bytes.  </dd>
<dt>signature.user_name:</dt>
<dd style="margin-left: 8">The rfc822Name stored in the certificate that was used to sign the request, as a String object.</dd>
<dt>signature.node_id:</dt>
<dd style="margin-left: 8">The Node-ID stored in the certificate that was used to sign the request, as an array of bytes.</dd>
<dt>kind.id:</dt>
<dd style="margin-left: 8">The id of the Kind associated with the entry, as a Number object.</dd>
<dt>kind.name:</dt>
<dd style="margin-left: 8">If the Kind associated with the entry is registered by IANA, contains the name as a String object.  If not, this property is undefined.  </dd>
<dt>kind.data_model:</dt>
<dd style="margin-left: 8">The name of the Data Model associated with the entry, as a String object.</dd>
<dt>kind.access_control:</dt>
<dd style="margin-left: 8">The name of the Access Control Policy associated with the entry, as a String object.</dd>
<dt>kind.max_count:</dt>
<dd style="margin-left: 8">The value of the max-count element in the configuration file, as a Number object.</dd>
<dt>kind.max_size:</dt>
<dd style="margin-left: 8">The value of the max-size element in the configuration file as a Number object.</dd>
<dt>kind.max_node_multiple:</dt>
<dd style="margin-left: 8">If the Access Control is MULTIPLE-NODE, contains the value of the max-node-multiple element in the configuration file, as a Number object.  If not, this property is undefined.  </dd>
<dt>entry.index:</dt>
<dd style="margin-left: 8">If the Data Model is ARRAY, contains the index of the entry, as a Number object.  If not, this property is undefined.  </dd>
<dt>entry.key:</dt>
<dd style="margin-left: 8">If the Data Model is DICTIONARY, contains the key of the entry, as an array of bytes.  If not, this property is undefined.  </dd>
<dt>entry.storage_time:</dt>
<dd style="margin-left: 8">The date and time used to store the entry, as a Date object.</dd>
<dt>entry.lifetime:</dt>
<dd style="margin-left: 8">The validity for the entry in seconds, as a Number object.</dd>
<dt>entry.exists:</dt>
<dd style="margin-left: 8">Indicates if the entry value exists, as Boolean object.</dd>
<dt>entry.value:</dt>
<dd style="margin-left: 8">This property contains an opaque object that represents the whole data, as an array of bytes.  </dd>
</dl>
<p id="rfc.section.3.p.4">The properties SHOULD NOT be modifiable or deletable and if they are, modifying or deleting them MUST NOT modify or delete the equivalent internal values (in other words, the code cannot be used to modify the elements that will be stored).  </p>
<p id="rfc.section.3.p.5">The value returned by the code is evaluated to true or false, according to the ECMAScript rules.  If the return value of one of the call to the code is evaluated to false, then the StoreReq fails, the state MUST be rolled back and an Error_Forbidden MUST be returned.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Security Considerations</h1>
<p id="rfc.section.4.p.1">TBD</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> IANA Considerations</h1>
<p id="rfc.section.5.p.1">No IANA considerations.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Acknowledgements</h1>
<p id="rfc.section.6.p.1">This document was written with the xml2rfc tool described in <a href="#RFC2629">[RFC2629]</a>.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-p2psip-base">[I-D.ietf-p2psip-base]</b></td>
<td class="top">
<a>Jennings, C</a>, <a>Lowekamp, B</a>, <a>Rescorla, E</a>, <a>Baset, S</a> and <a>H Schulzrinne</a>, "<a href="http://tools.ietf.org/html/draft-ietf-p2psip-base-13">REsource LOcation And Discovery (RELOAD) Base Protocol</a>", Internet-Draft draft-ietf-p2psip-base-13, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="ECMA-262">[ECMA-262]</b></td>
<td class="top">
<a>Ecma, </a>, "<a>ECMAScript Language Specification 3rd Edition</a>", December 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2629">[RFC2629]</b></td>
<td class="top">
<a href="mailto:mrose@not.invisible.net" title="Invisible Worlds, Inc.">Rose, M.T.</a>, "<a href="http://tools.ietf.org/html/rfc2629">Writing I-Ds and RFCs using XML</a>", RFC 2629, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-p2psip-service-discovery">[I-D.ietf-p2psip-service-discovery]</b></td>
<td class="top">
<a>Maenpaa, J</a> and <a>G Camarillo</a>, "<a href="http://tools.ietf.org/html/draft-ietf-p2psip-service-discovery-02">Service Discovery Usage for REsource LOcation And Discovery (RELOAD)</a>", Internet-Draft draft-ietf-p2psip-service-discovery-02, January 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.knauf-p2psip-share">[I-D.knauf-p2psip-share]</b></td>
<td class="top">
<a>Knauf, A</a>, <a>Hege, G</a>, <a>Schmidt, T</a> and <a>M Waehlisch</a>, "<a href="http://tools.ietf.org/html/draft-knauf-p2psip-share-00">A Usage for Shared Resources in RELOAD (ShaRe)</a>", Internet-Draft draft-knauf-p2psip-share-00, March 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Examples</h1>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> Standard Access Control Policies</h1>
<p id="rfc.section.Appendix A.1.p.1">This section shows the ECMAScript code that could be used to implement the standard Access Control Policies defined in <a href="#I-D.ietf-p2psip-base">[I-D.ietf-p2psip-base]</a>.</p>
<h1 id="rfc.appendix.Appendix A.1.1">
<a href="#rfc.appendix.Appendix%20A.1.1">Appendix A.1.1.</a> USER-MATCH</h1>
<div id="#rfc.figure.3"></div>
<pre>
String.prototype['bytes'] = function() {
    var bytes = [];
    for (var i = 0; i &lt; this.length; i++) {
        bytes[i] = this.charCodeAt(i);
    }
    return bytes;
};

return resource.equalsHash(signature.user_name.bytes());</pre>
<p></p>
<h1 id="rfc.appendix.Appendix A.1.2">
<a href="#rfc.appendix.Appendix%20A.1.2">Appendix A.1.2.</a> NODE-MATCH</h1>
<div id="#rfc.figure.4"></div>
<pre>
return resource.equalsHash(signature.node_id);</pre>
<p></p>
<h1 id="rfc.appendix.Appendix A.1.3">
<a href="#rfc.appendix.Appendix%20A.1.3">Appendix A.1.3.</a> USER-NODE-MATCH</h1>
<div id="#rfc.figure.5"></div>
<pre>
String.prototype['bytes'] = function() {
    var bytes = [];
    for (var i = 0; i &lt; this.length; i++) {
        bytes[i] = this.charCodeAt(i);
    }
    return bytes;
};

var equals = function(a, b) {
    if (a.length !== b.length) return false;
    for (var i = 0; i &lt; a.length; i++) {
        if (a[i] !== b[i]) return false;
    }
    return true;
};

return resource.equalsHash(signature.user_name.bytes())
  &amp;&amp; equals(entry.key, signature.node_id);</pre>
<p></p>
<h1 id="rfc.appendix.Appendix A.1.4">
<a href="#rfc.appendix.Appendix%20A.1.4">Appendix A.1.4.</a> NODE-MULTIPLE</h1>
<div id="#rfc.figure.6"></div>
<pre>
Number.prototype['width'] = function(w) {
    var bytes = [];
    for (var i = 0; i &lt; w; i++) {
        bytes[i] = (this &gt;&gt;&gt; ((w - i - 1) * 8)) &amp; 255;
    }
    return bytes;
};

for (var i = 0; i &lt; kind.max_node_multiple; i++) {
    if (resource.equalsHash(signature.node_id, i.width(4))) {
        return true;
    }
}
return false;</pre>
<p></p>
<p id="rfc.section.Appendix A.1.4.p.2">[[Note that base-13 do not state exactly the length of i when concatenated in the hash input]]</p>
<h1 id="rfc.appendix.Appendix A.2">
<a href="#rfc.appendix.Appendix%20A.2">Appendix A.2.</a> Service Discovery Usage</h1>
<p><a href="#I-D.ietf-p2psip-service-discovery">[I-D.ietf-p2psip-service-discovery]</a> defines a specific Access Control Policy (NODE-ID-MATCH) that need to access the content of the entry to be written.  If implemented as specified by this document, the &lt;kind&gt; element would look something like this: </p>
<div id="#rfc.figure.7"></div>
<pre>&lt;kind name='REDIR'
  xmlns:acp='http://implementers.org/access-control-policy'
  xmlns:ext='http://implementers.org/my-ext'&gt;
    &lt;data-model&gt;DICTIONARY&lt;/data-model&gt;
    &lt;access-control&gt;NODE-ID-MATCH&lt;/access-control&gt;
    &lt;max-count&gt;100&lt;/max-count&gt;
    &lt;max-size&gt;60&lt;/max-size&gt;

    &lt;acp:access-control-code&gt;
        /* Insert here the code from
           http://jsfromhell.com/classes/bignumber
         */

       var toBigNumber = function(node_id) {
           var bignum = new BigNumber(0);
           for (var i = 0; i &lt; node_id.length; i++) {
               bignum = bignum.multiply(256).add(node_id[i]);
           }
           return bignum;
       };

       var checkIntervals = function(node_id, level, node, factor) {
           var size = new BigNumber(2).pow(128);
           var node = toBigNumber(node_id);
           for (var f = 0; f &lt; factor; f++) {
               var temp = size.multiply(new BigNumber(f)
                 .pow(new BigNumber(level).negate()));
               var min = temp.multiply(node.add(new BigNumber(f)
                 .divide(factor)));
               var max = temp.multiply(node.add(new BigNumber(f + 1)
                 .divide(factor)));
               if (node.compare(min) === -1 || node.compare(max) == 1
                 || node.compare(max) == 0) return false;
           }
           return true;
       };

       var equals = function(a, b) {
           if (a.length !== b.length) return false;
           for (var i = 0; i &lt; a.length; i++) {
               if (a[i] !== b[i]) return false;
           }
           return true;
       };

       var level = function(value) {
           var length = value[16] * 256 + value[17];
           return value[18 + length] * 256 + value[18 + length + 1];
       };

       var node = function(value) {
           var length = value[16] * 256 + value[17];
           return value[18 + length + 2] * 256
             + value[18 + length + 3];
       };

       var namespace = function(value) {
           var length = value[16] * 256 + value[17];
           return String.fromCharCode(value.slice(18, length));
       };

       var branching_factor = 2;
       return equals(entry.key, signature.node_id)
         &amp;&amp; (!entry.exists || checkIntervals(entry.key,
           level(entry.value), node(entry.value),
           branching_factor))
         &amp;&amp; (!entry.exists
           || resource.equalsHash(namespace(entry.value),
             level(entry.value), node(entry.value)));
    &lt;/acp:access-control-code&gt;
&lt;/kind&gt;</pre>
<p></p>
<p id="rfc.section.Appendix A.2.p.3">Note that the code for the BigNumber object was removed from this example, as the licensing terms are unclear.  The code is available at <a href="http://jsfromhell.com/classes/bignumber">http://jsfromhell.com/classes/bignumber</a>.  </p>
<p id="rfc.section.Appendix A.2.p.4">The branching-factor variable in the code must match the &lt;redirBranchingFactor&gt; element, which is not accessible to the code.  The signer of the kind must be sure that the two match.  </p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> Release notes</h1>
<p id="rfc.section.Appendix B.p.1">This section must be removed before publication as an RFC.</p>
<h1 id="rfc.appendix.Appendix B.1">
<a href="#rfc.appendix.Appendix%20B.1">Appendix B.1.</a> Modifications between -02 and -01</h1>
<p></p>

<ul>
<li>Made clear that an unsigned kind with this extension must be rejected.</li>
<li>Removed the kind.params array, and converted the max-count, max-size and max-node-multiple as Number objects.  Fixed the examples.  </li>
<li>Removed the parsing of extensions in the kind element.  The former system did not work with namespaces or attributes, and the right solution (xpath) is probably too complex.  The value of the parameters can still be manually mirrored in the script, so there is perhaps no need for the added complexity.  Also fixed the examples.  </li>
<li>Reference draft-p2psip-share instance of draft-p2psip-disco.</li>
<li>Added a "Running Code Considerations" section that contain the reference to the reference implementation and script tester.</li>
<li>Nits</li>
</ul>
<h1 id="rfc.appendix.Appendix B.2">
<a href="#rfc.appendix.Appendix%20B.2">Appendix B.2.</a> Modifications between -01 and -00</h1>
<p></p>

<ul>
<li>Changed reference from JavaScript to ECMAScript.</li>
<li>Changed signature from equals() to equalsHash().</li>
<li>Fixed the examples following implementation.</li>
<li>Replaced automatic decoding of value by ECMAScript code.</li>
<li>Added the type of each property.</li>
<li>Specified that the code cannot be used to modify the value stored.</li>
</ul>
<h1 id="rfc.appendix.Appendix B.3">
<a href="#rfc.appendix.Appendix%20B.3">Appendix B.3.</a> Running Code Considerations</h1>
<p></p>

<ul><li>Reference Implementation and Access Control Policy script tester (&lt;http://debian.implementers.org/testing/source/reload.tar.gz&gt;).  Marc Petit-Huguenin.  Implements version -02.  </li></ul>
<h1 id="rfc.appendix.Appendix B.4">
<a href="#rfc.appendix.Appendix%20B.4">Appendix B.4.</a> TODO List</h1>
<p></p>

<ul><li>Need to convert <a href="#I-D.knauf-p2psip-share">ShaRe</a> <cite title="NONE">[I-D.knauf-p2psip-share]</cite> Usages USER-CHAIN-ACL and USER-PATTERN-MATCH.</li></ul>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Marc Petit-Huguenin</span> 
	  <span class="n hidden">
		<span class="family-name">Petit-Huguenin</span>
	  </span>
	</span>
	<span class="org vcardline">Stonyfish, Inc.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:petithug@acm.org">petithug@acm.org</a></span>

  </address>
</div>

</body>
</html>