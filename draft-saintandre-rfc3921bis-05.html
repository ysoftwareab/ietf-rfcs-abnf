<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence">
<meta name="keywords" content="XMPP, Extensible Messaging and Presence Protocol, Jabber, IM, Instant Messaging, Presence, XML, Extensible Markup Language">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">P. Saint-Andre, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">XMPP Standards Foundation</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc3921'>3921</a> (if&nbsp;approved)</td><td class="header">March 26, 2009</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: September 27, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence<br />draft-saintandre-rfc3921bis-05</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 27, 2009.</p>

<h3>Abstract</h3>

<p>This document describes extensions to core features of the Extensible Messaging and Presence Protocol (XMPP) that provide basic instant messaging (IM) and presence functionality in conformance with RFC 2779.
</p>
<p>This document obsoletes RFC 3921.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-overview">1.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-requirements">1.2.</a>&nbsp;
Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-summary">1.3.</a>&nbsp;
Functional Summary<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-conventions">1.4.</a>&nbsp;
Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-discuss">1.5.</a>&nbsp;
Discussion Venue<br />
<a href="#roster">2.</a>&nbsp;
Managing the Roster<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-syntax">2.1.</a>&nbsp;
Syntax and Semantics<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-syntax-items">2.1.1.</a>&nbsp;
Items<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-syntax-actions-get">2.1.2.</a>&nbsp;
Roster Get<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-syntax-actions-set">2.1.3.</a>&nbsp;
Roster Set<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-syntax-actions-push">2.1.4.</a>&nbsp;
Roster Push<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-syntax-actions-result">2.1.5.</a>&nbsp;
Roster Result<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-syntax-subscription">2.1.6.</a>&nbsp;
Subscription Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-login">2.2.</a>&nbsp;
Retrieving the Roster on Login<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-add">2.3.</a>&nbsp;
Adding a Roster Item<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-add-success">2.3.1.</a>&nbsp;
Success Case<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-add-errors">2.3.2.</a>&nbsp;
Error Cases<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-update">2.4.</a>&nbsp;
Updating a Roster Item<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-update-success">2.4.1.</a>&nbsp;
Success Case<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-update-error">2.4.2.</a>&nbsp;
Error Cases<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-delete">2.5.</a>&nbsp;
Deleting a Roster Item<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-delete-success">2.5.1.</a>&nbsp;
Success Case<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#roster-delete-error">2.5.2.</a>&nbsp;
Error Cases<br />
<a href="#sub">3.</a>&nbsp;
Managing Presence Subscriptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-request">3.1.</a>&nbsp;
Requesting a Subscription<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-request-gen">3.1.1.</a>&nbsp;
Client Generation of Outbound Subscription Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-request-outbound">3.1.2.</a>&nbsp;
Server Processing of Outbound Subscription Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-request-inbound">3.1.3.</a>&nbsp;
Server Processing of Inbound Subscription Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-request-handle">3.1.4.</a>&nbsp;
Client Processing of Inbound Subscription Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-request-approvalout">3.1.5.</a>&nbsp;
Server Processing of Outbound Subscription Approval<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-request-approvalin">3.1.6.</a>&nbsp;
Server Processing of Inbound Subscription Approval<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-cancel">3.2.</a>&nbsp;
Cancelling a Subscription<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-cancel-gen">3.2.1.</a>&nbsp;
Client Generation of Subscription Cancellation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-cancel-outbound">3.2.2.</a>&nbsp;
Server Processing of Outbound Subscription Cancellation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-cancel-inbound">3.2.3.</a>&nbsp;
Server Processing of Inbound Subscription Cancellation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-unsub">3.3.</a>&nbsp;
Unsubscribing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-unsub-gen">3.3.1.</a>&nbsp;
Client Generation of Unsubscribe<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-unsub-outbound">3.3.2.</a>&nbsp;
Server Processing of Outbound Unsubscribe<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-unsub-inbound">3.3.3.</a>&nbsp;
Server Processing of Inbound Unsubscribe<br />
<a href="#presence">4.</a>&nbsp;
Exchanging Presence Information<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-overview">4.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-initial">4.2.</a>&nbsp;
Initial Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-initial-gen">4.2.1.</a>&nbsp;
Client Generation of Initial Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-initial-outbound">4.2.2.</a>&nbsp;
Server Processing of Outbound Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-initial-inbound">4.2.3.</a>&nbsp;
Server Processing of Inbound Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-initial-client">4.2.4.</a>&nbsp;
Client Processing of Inbound Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-probe">4.3.</a>&nbsp;
Presence Probes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-probe-outbound">4.3.1.</a>&nbsp;
Server Generation of Outbound Presence Probe<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-probe-inbound">4.3.2.</a>&nbsp;
Server Processing of Inbound Presence Probe<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-broadcast">4.4.</a>&nbsp;
Subsequent Presence Broadcast<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-broadcast-gen">4.4.1.</a>&nbsp;
Client Generation of Presence Broadcast<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-broadcast-outbound">4.4.2.</a>&nbsp;
Server Processing of Outbound Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-broadcast-inbound">4.4.3.</a>&nbsp;
Server Processing of Inbound Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-broadcast-client">4.4.4.</a>&nbsp;
Client Processing of Inbound Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-unavailable">4.5.</a>&nbsp;
Unavailable Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-unavailable-gen">4.5.1.</a>&nbsp;
Client Generation of Unavailable Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-unavailable-outbound">4.5.2.</a>&nbsp;
Server Processing of Outbound Unavailable Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-unavailable-inbound">4.5.3.</a>&nbsp;
Server Processing of Inbound Unavailable Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-unavailable-client">4.5.4.</a>&nbsp;
Client Processing of Inbound Unavailable Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-directed">4.6.</a>&nbsp;
Directed Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-directed-gen">4.6.1.</a>&nbsp;
Client Generation of Directed Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-directed-outbound">4.6.2.</a>&nbsp;
Server Processing of Outbound Directed Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-directed-inbound">4.6.3.</a>&nbsp;
Server Processing of Inbound Directed Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-directed-client">4.6.4.</a>&nbsp;
Client Processing of Inbound Directed Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-syntax">4.7.</a>&nbsp;
Presence Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-syntax-type">4.7.1.</a>&nbsp;
Type Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-syntax-children">4.7.2.</a>&nbsp;
Child Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-show">4.7.3.</a>&nbsp;
Show Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-status">4.7.4.</a>&nbsp;
Status Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-priority">4.7.5.</a>&nbsp;
Priority Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#presence-extended">4.7.6.</a>&nbsp;
Extended Content<br />
<a href="#message">5.</a>&nbsp;
Exchanging Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-attributes">5.1.</a>&nbsp;
Attributes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-attributes-to">5.1.1.</a>&nbsp;
To Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-attributes-type">5.1.2.</a>&nbsp;
Type Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-elements">5.2.</a>&nbsp;
Child Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-elements-body">5.2.1.</a>&nbsp;
Body<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-elements-subject">5.2.2.</a>&nbsp;
Subject<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-elements-thread">5.2.3.</a>&nbsp;
Thread<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-elements-extended">5.3.</a>&nbsp;
Extended Content<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-chat">5.4.</a>&nbsp;
One-to-One Chat Sessions<br />
<a href="#iq">6.</a>&nbsp;
Exchanging IQ Stanzas<br />
<a href="#session">7.</a>&nbsp;
A Sample Session<br />
<a href="#rules">8.</a>&nbsp;
Server Rules for Processing XML Stanzas<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-nosuchuser">8.1.</a>&nbsp;
No Such User<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-fulljid">8.2.</a>&nbsp;
Full JID at Local Domain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-fulljid-availmatch">8.2.1.</a>&nbsp;
Available Resource Matches<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-fulljid-availnomatch">8.2.2.</a>&nbsp;
No Available Resource Matches<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-barejid">8.3.</a>&nbsp;
Bare JID at Local Domain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-barejid-availyes">8.3.1.</a>&nbsp;
Available Resources<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-barejid-availyes-message">8.3.1.1.</a>&nbsp;
Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-barejid-availyes-pres">8.3.1.2.</a>&nbsp;
Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-barejid-availyes-iq">8.3.1.3.</a>&nbsp;
IQ<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-barejid-availno">8.3.2.</a>&nbsp;
No Available Resources<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-barejid-availno-message">8.3.2.1.</a>&nbsp;
Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-barejid-availno-pres">8.3.2.2.</a>&nbsp;
Presence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-barejid-availno-iq">8.3.2.3.</a>&nbsp;
IQ<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rules-foreign">8.4.</a>&nbsp;
Foreign Domain<br />
<a href="#compliance">9.</a>&nbsp;
IM and Presence Compliance Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#compliance-server">9.1.</a>&nbsp;
Servers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#compliance-client">9.2.</a>&nbsp;
Clients<br />
<a href="#i18n">10.</a>&nbsp;
Internationalization Considerations<br />
<a href="#security">11.</a>&nbsp;
Security Considerations<br />
<a href="#ref">12.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-reg-im">12.1.</a>&nbsp;
Instant Messaging SRV Protocol Label Registration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-reg-pres">12.2.</a>&nbsp;
Presence SRV Protocol Label Registration<br />
<a href="#rfc.references1">13.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">13.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">13.2.</a>&nbsp;
Informative References<br />
<a href="#substates">Appendix&nbsp;A.</a>&nbsp;
Subscription States<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#substates-defined">A.1.</a>&nbsp;
Defined States<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#substates-out">A.2.</a>&nbsp;
Server Processing of Outbound Presence Subscription Stanzas<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#substates-out-subscribe">A.2.1.</a>&nbsp;
Subscribe<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#substates-out-unsubscribe">A.2.2.</a>&nbsp;
Unsubscribe<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#substates-out-subscribed">A.2.3.</a>&nbsp;
Subscribed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#substates-out-unsubscribed">A.2.4.</a>&nbsp;
Unsubscribed<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#substates-in">A.3.</a>&nbsp;
Server Processing of Inbound Presence Subscription Stanzas<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#substates-in-subscribe">A.3.1.</a>&nbsp;
Subscribe<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#substates-in-unsubscribe">A.3.2.</a>&nbsp;
Unsubscribe<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#substates-in-subscribed">A.3.3.</a>&nbsp;
Subscribed<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#substates-in-unsubscribed">A.3.4.</a>&nbsp;
Unsubscribed<br />
<a href="#blocking">Appendix&nbsp;B.</a>&nbsp;
Blocking Communication<br />
<a href="#vcard">Appendix&nbsp;C.</a>&nbsp;
vCards<br />
<a href="#def">Appendix&nbsp;D.</a>&nbsp;
XML Schemas<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#def-client">D.1.</a>&nbsp;
jabber:client<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#def-server">D.2.</a>&nbsp;
jabber:server<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#def-roster">D.3.</a>&nbsp;
jabber:iq:roster<br />
<a href="#diffs">Appendix&nbsp;E.</a>&nbsp;
Differences From RFC 3921<br />
<a href="#copying">Appendix&nbsp;F.</a>&nbsp;
Copying Conditions<br />
<a href="#rfc.index">&#167;</a>&nbsp;
Index<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<a name="intro-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Overview</h3>

<p>The Extensible Messaging and Presence Protocol (XMPP) is an application profile of the Extensible Markup Language <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a> for streaming XML data in close to real time between any two (or more) network-aware entities.  XMPP is typically used to exchange messages, share presence information, and engage in structured request-response interactions.  The core features of XMPP defined in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a> provide the building blocks for many types of near-real-time applications, which may be layered on top of the core by sending application-specific data qualified by particular XML namespaces (refer to <a class='info' href='#XML-NAMES'>[XML&#8209;NAMES]<span> (</span><span class='info'>Bray, T., Hollander, D., and A. Layman, &ldquo;Namespaces in XML,&rdquo; January&nbsp;1999.</span><span>)</span></a>).  This document describes XMPP extensions that provide the basic functionality expected of an instant messaging (IM) and presence application as defined in <a class='info' href='#IMP-REQS'>[IMP&#8209;REQS]<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a>.
</p>
<p>This document obsoletes RFC 3921.
</p>
<a name="intro-requirements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Requirements</h3>

<p>Traditionally, instant messaging applications have combined the following factors:
</p>
<p>
        </p>
<ol class="text">
<li><a name='anchor3'></a>The central point of focus is a list of one's contacts or "buddies" (in XMPP this list is called a ROSTER).
</li>
<li>The purpose of using such an application is to exchange relatively brief text messages with each of one's contacts in close to real time -- often relatively large numbers of such messages in rapid succession, in the form of one-to-one chat sessions as described under <a class='info' href='#message-chat'>Section&nbsp;5.4<span> (</span><span class='info'>One-to-One Chat Sessions</span><span>)</span></a>.
</li>
<li><a name='anchor4'></a>The catalyst for exchanging messages is PRESENCE -- i.e., information about the network availability of each of one's contacts (thus knowing who is online and available for a one-to-one chat session).
</li>
<li>Presence information is provided only to contacts that a user has authorized via a presence subscription.
</li>
</ol><p>
      
</p>
<p>Thus at a high level this document assumes that a user must be able to complete the following use cases:
</p>
<p></p>
<ul class="text">
<li>Manage items in one's contact list
</li>
<li>Exchange messages with one's contacts
</li>
<li>Exchange presence information with one's contacts
</li>
<li>Manage presence subscriptions to and from one's contacts
</li>
</ul>

<p>Detailed definitions of these functionality areas are contained in RFC 2779 <a class='info' href='#IMP-REQS'>[IMP&#8209;REQS]<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a>, and the interested reader is referred to that document regarding the requirements addressed herein.  While the XMPP instant messaging and presence extensions specified herein meet the requirements of RFC 2779, they were not designed explicitly with that specification in mind, since the base protocol evolved through an open development process within the Jabber open-source community before RFC 2779 was written.  Although XMPP protocol extensions addressing many other functionality areas have been defined in the XMPP Standards Foundation's XEP series (e.g., multi-user text chat as specified in <a class='info' href='#XEP-0045'>[XEP&#8209;0045]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Multi-User Chat,&rdquo; April&nbsp;2007.</span><span>)</span></a>), such extensions are not specified in this document because they are not required by RFC 2779.
</p>
<p>Note: RFC 2779 stipulates that presence services must be separable from instant messaging services and vice-versa; i.e., it must be possible to use the protocol to provide a presence service, an instant messaging service, or both.  Although the text of this document assumes that implementations and deployments will want to offer a unified instant messaging and presence service, there is no requirement that a service must offer both a presence service and an instant messaging service, and the protocol makes it possible to offer separate and distinct services for presence and for instant messaging.  (For example, a presence-only service could return a &lt;service-unavailable/&gt; error if a client attempt to send a &lt;message/&gt; stanzas.)
</p>
<a name="intro-summary"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Functional Summary</h3>

<p>This non-normative section provides a developer-friendly, functional summary of XMPP-based instant messaging and presence features; refer to the sections that follow for a normative definition of these features.
</p>
<p><a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a> specifies how an XMPP client connects to an XMPP server.  In particular, it specifies the preconditions that must be fulfilled before a client is allowed to send XML stanzas (the basic unit of meaning in XMPP) to other entities on an XMPP network.  These preconditions comprise negotiation of the XML stream and include XML stream establishment, optional channel encryption via Transport Layer Security <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.1,&rdquo; April&nbsp;2006.</span><span>)</span></a>, mandatory authentication via Simple Authentication and Security Layer <a class='info' href='#SASL'>[SASL]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a>, and binding of a resource to the stream for client addressing.  The reader is referred to <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a> for details regarding these preconditions, and knowledge of <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a> is assumed herein.
</p>
<p>Upon fulfillment of the preconditions specified in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>, an XMPP client has a long-lived XML stream with an XMPP server, which enables the user to send and receive a potentially unlimited number of XML stanzas over the stream.  Such a stream can be used to exchange messages, share presence information, and engage in structured request-response interactions in close to real time.  After negotiation of the XML stream, the typical flow for an instant messaging and presence session is as follows:
</p>
<p>
        </p>
<ol class="text">
<li>Retrieve one's roster.  (See <a class='info' href='#roster-login'>Section&nbsp;2.2<span> (</span><span class='info'>Retrieving the Roster on Login</span><span>)</span></a>.)
</li>
<li>Send initial presence to the server for broadcasting to all subscribed contacts, thus "going online" from the perspective of XMPP communications.  (See <a class='info' href='#presence-initial'>Section&nbsp;4.2<span> (</span><span class='info'>Initial Presence</span><span>)</span></a>.)
</li>
<li>Exchange messages, manage presence subscriptions, perform roster updates, and in general process and generate other XML stanzas with particular semantics throughout the life of the session.  (See <a class='info' href='#message'>Section&nbsp;5<span> (</span><span class='info'>Exchanging Messages</span><span>)</span></a>, <a class='info' href='#sub'>Section&nbsp;3<span> (</span><span class='info'>Managing Presence Subscriptions</span><span>)</span></a>, <a class='info' href='#roster'>Section&nbsp;2<span> (</span><span class='info'>Managing the Roster</span><span>)</span></a>, and <a class='info' href='#iq'>Section&nbsp;6<span> (</span><span class='info'>Exchanging IQ Stanzas</span><span>)</span></a>.)
</li>
<li>Terminate the session when desired by sending unavailable presence and closing the underlying XML stream. (See <a class='info' href='#presence-unavailable'>Section&nbsp;4.5<span> (</span><span class='info'>Unavailable Presence</span><span>)</span></a>.)
</li>
</ol><p>
      
</p>
<a name="intro-conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Conventions</h3>

<p>This document inherits the terminology defined in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<p>The following keywords are to be interpreted as described in <a class='info' href='#TERMS'>[TERMS]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".
</p>
<p>For convenience, this document employs the term "user" to refer to the owner of an XMPP account; however, account owners need not be human persons and may be bots, devices, or other non-human applications.
</p>
<p>In examples, lines have been wrapped for improved readability, "[...]" means elision, and the following prepended strings are used:
</p>
<p>
        </p>
<ul class="text">
<li>C: = client
</li>
<li>CC: = contact's client
</li>
<li>CS: = contact's server
</li>
<li>S: = server
</li>
<li>UC: = user's client
</li>
<li>US: = user's server
</li>
</ul><p>
      
</p>
<a name="intro-discuss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.5"></a><h3>1.5.&nbsp;
Discussion Venue</h3>

<p>The editor welcomes discussion and comments related to the topics presented in this document.  The preferred forum is the &lt;standards@xmpp.org&gt; mailing list, for which archives and subscription information are available at &lt;<a href='http://mail.jabber.org/mailman/listinfo/standards'>http://mail.jabber.org/mailman/listinfo/standards</a>&gt;.
</p>
<a name="roster"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Managing the Roster</h3>

<p>In XMPP, one's roster contains any number of specific contacts.  A user's roster is stored by the user's server on the user's behalf so that the user may access roster information from any resource.
</p>
<a name="roster-syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Syntax and Semantics</h3>

<p>Rosters are managed using IQ stanzas, specifically by means of a &lt;query/&gt; child element qualified by the 'jabber:iq:roster' namespace.  The detailed syntax and semantics are defined in the following sections.
</p>
<a name="roster-syntax-items"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1"></a><h3>2.1.1.&nbsp;
Items</h3>

<p>The &lt;query/&gt; element MAY contain one or more &lt;item/&gt; children, each describing a unique roster item or "contact".
</p>
<p>The syntax of the &lt;item/&gt; is as follows:
</p>
<p>
          </p>
<ol class="text">
<li>The 'jid' attribute is REQUIRED; the value of this attribute is Jabber Identifier (JID) that uniquely identifies the roster item.
</li>
<li>The 'name' attribute is OPTIONAL; the value of this attribute specifies the "handle" to be associated with the JID, as determined by the user (not the contact).  While the value of the 'name' attribute may have meaning to a human user, typically it is opaque to the server (although it MAY be used by the server for matching purposes within the context of various XMPP extensions).
</li>
<li>The 'subscription' attribute is OPTIONAL; see <a class='info' href='#roster-syntax-subscription'>Section&nbsp;2.1.6<span> (</span><span class='info'>Subscription Attribute</span><span>)</span></a>.
</li>
<li>The 'ask' attribute is OPTIONAL and is used to specify certain subscription sub-states; for details, see <a class='info' href='#sub-request-outbound'>Section&nbsp;3.1.2<span> (</span><span class='info'>Server Processing of Outbound Subscription Request</span><span>)</span></a>.
</li>
<li>The &lt;group/&gt; element is OPTIONAL; the XML character data of this element specifies a category into which the roster item should be grouped by a client.  The &lt;item/&gt; MAY contain more than one &lt;group/&gt; element.  The XML character data of the &lt;group/&gt; element is typically opaque to the server but may have meaning to a human user.
</li>
</ol><p>
        
</p>
<a name="roster-syntax-actions-get"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2"></a><h3>2.1.2.&nbsp;
Roster Get</h3>

<p><a name='anchor5'></a>A ROSTER GET is an IQ stanza of type "get" sent from client to server and containing a &lt;query/&gt; element qualified by the 'jabber:iq:roster' namespace.
</p>
<p>The &lt;query/&gt; element in a roster get MUST NOT contain any &lt;item/&gt; child elements.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony'
       type='get'
       id='roster_get'&gt;
    &lt;query xmlns='jabber:iq:roster'/&gt;
  &lt;/iq&gt;
</pre></div>
<a name="roster-syntax-actions-set"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.3"></a><h3>2.1.3.&nbsp;
Roster Set</h3>

<p><a name='anchor6'></a>A ROSTER SET is an IQ stanza of type "set" sent from client to server and containing a &lt;query/&gt; element qualified by the 'jabber:iq:roster' namespace.
</p>
<p>The following rules apply to roster sets:
</p>
<p>
          </p>
<ol class="text">
<li>The &lt;query/&gt; element MUST contain one and only one &lt;item/&gt; element.
</li>
<li>A receiving server MUST ignore any value of the 'subscription' attribute other than "remove" (see <a class='info' href='#roster-syntax-subscription'>Section&nbsp;2.1.6<span> (</span><span class='info'>Subscription Attribute</span><span>)</span></a>).
</li>
<li>A receiving server MUST ignore any 'to' address specified on the IQ stanza and MUST handle the IQ stanza as if it included no 'to' attribute.
</li>
</ol><p>
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony'
       type='set'
       id='roster_set'&gt;
    &lt;query xmlns='jabber:iq:roster'&gt;
      &lt;item jid='nurse@example.com'/&gt;
    &lt;/query&gt;
  &lt;/iq&gt;
</pre></div>
<a name="roster-syntax-actions-push"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.4"></a><h3>2.1.4.&nbsp;
Roster Push</h3>

<p><a name='anchor7'></a>A ROSTER PUSH is an IQ stanza of type "set" sent from server to client and containing a &lt;query/&gt; element qualified by the 'jabber:iq:roster' namespace.
</p>
<p>The following rules apply to roster pushes:
</p>
<p>
          </p>
<ol class="text">
<li>The &lt;query/&gt; element in a roster push MUST contain one and only one &lt;item/&gt; element.
</li>
<li>A receiving client MUST ignore the stanza unless it has no 'from' attribute (i.e., implicitly from the server) or it has a 'from' attribute whose value matches the user's bare JID &lt;user@domain&gt;.
</li>
</ol><p>
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq to='juliet@example.com/chamber'
       type='set'
       id='roster_push'&gt;
    &lt;query xmlns='jabber:iq:roster'&gt;
      &lt;item jid='nurse@example.com'/&gt;
    &lt;/query&gt;
  &lt;/iq&gt;
</pre></div>
<p>As required by the semantics of the IQ stanza as defined in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>, each resource that receives a roster push MUST reply with an IQ stanza of type "result" (or "error").
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony'
      type='result'
      id='a78b4q6ha463'/&gt;

C: &lt;iq from='juliet@example.com/chamber'
      type='result'
      id='a78b4q6ha464'/&gt;
</pre></div>
<p>Note: There is no error case for client replies to roster pushes, and if the server receives an IQ of type "error" in response to a roster push it SHOULD ignore the error.
</p>
<a name="roster-syntax-actions-result"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.5"></a><h3>2.1.5.&nbsp;
Roster Result</h3>

<p><a name='anchor8'></a>A ROSTER RESULT is an IQ stanza of type "result" sent from server to client and containing a &lt;query/&gt; element qualified by the 'jabber:iq:roster' namespace.
</p>
<p>The &lt;query/&gt; element in a roster result contains one &lt;item/&gt; element for each contact and therefore MAY contain more than one &lt;item/&gt; element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq to='juliet@example.com/chamber'
       type='result'
       id='roster_result'&gt;
    &lt;query xmlns='jabber:iq:roster'&gt;
      &lt;item jid='nurse@example.com'/&gt;
      &lt;item jid='romeo@example.net'/&gt;
    &lt;/query&gt;
  &lt;/iq&gt;
</pre></div>
<p>If there are no contacts in the roster, the &lt;query/&gt; element MUST be empty.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq to='juliet@example.com/chamber'
       type='result'
       id='roster_result'&gt;
    &lt;query xmlns='jabber:iq:roster'/&gt;
  &lt;/iq&gt;
</pre></div>
<a name="roster-syntax-subscription"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.6"></a><h3>2.1.6.&nbsp;
Subscription Attribute</h3>

<p>The state of the presence subscription in relation to a roster item is captured in the 'subscription' attribute of the &lt;item/&gt; element.  Allowable subscription-related values for this attribute are:
</p>
<p>
          </p>
<ul class="text">
<li>"none" -- the user does not have a subscription to the contact's presence, and the contact does not have a subscription to the user's presence
</li>
<li>"to" -- the user has a subscription to the contact's presence, but the contact does not have a subscription to the user's presence
</li>
<li>"from" -- the contact has a subscription to the user's presence, but the user does not have a subscription to the contact's presence
</li>
<li>"both" -- both the user and the contact have subscriptions to each other's presence (also called a "mutual subscription")
</li>
</ul><p>
        
</p>
<p>In a roster result, a receiving client MUST ignore values of the 'subscription' attribute other than "none", "to", "from", or "both".
</p>
<p>In a roster push, a receiving client MUST ignore values of the 'subscription' attribute other than "none", "to", "from", "both", or "remove".
</p>
<p>In a roster set, the value of the 'subscription' attribute MAY be "remove", which indicates that the item is to be removed from the roster; a receiving server MUST ignore all values of the 'subscription' attribute other than "remove".
</p>
<a name="roster-login"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Retrieving the Roster on Login</h3>

<p>Upon authenticating with a server and binding a resource (thus becoming a connected resource), a client SHOULD request the roster before sending initial presence (however, because receiving the roster may not be desirable for all resources, e.g., a connection with limited bandwidth, the client's request for the roster is recommended and not required).  After a connected resource sends initial presence (see <a class='info' href='#presence-initial'>Section&nbsp;4.2<span> (</span><span class='info'>Initial Presence</span><span>)</span></a>), it is referred to as an available resource.  If a connected resource or available resource requests the roster, it is referred to as an INTERESTED RESOURCE.  The server MUST send roster pushes to all interested resources.
</p>
<p>Note: Presence subscription requests are sent to available resources, whereas the roster pushes associated with subscription state changes are sent to interested resources.  Therefore if a resource wishes to receive both subscription requests and roster pushes, it MUST both send initial presence and request the roster.
</p>
<p>A client requests the roster by sending a roster get over its stream to the server.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony' type='get' id='roster_1'&gt;
    &lt;query xmlns='jabber:iq:roster'/&gt;
  &lt;/iq&gt;
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq to='juliet@example.com/balcony' type='result' id='roster_1'&gt;
    &lt;query xmlns='jabber:iq:roster'&gt;
      &lt;item jid='romeo@example.net'
            name='Romeo'
            subscription='both'&gt;
        &lt;group&gt;Friends&lt;/group&gt;
      &lt;/item&gt;
      &lt;item jid='mercutio@example.org'
            name='Mercutio'
            subscription='from'/&gt;
      &lt;item jid='nurse@example.com'
            name='Nurse'
            subscription='to'/&gt;
      &lt;item jid='benvolio@example.org'
            name='Benvolio'
            subscription='both'/&gt;
    &lt;/query&gt;
  &lt;/iq&gt;
</pre></div>
<p>If the server cannot process the roster get, it MUST return an appropriate stanza error as described in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a> (such as &lt;service-unavailable/&gt; if the roster namespace is not supported or &lt;internal-server-error/&gt; if the server experiences trouble processing or returning the roster).
</p>
<a name="roster-add"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Adding a Roster Item</h3>

<a name="roster-add-success"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.1"></a><h3>2.3.1.&nbsp;
Success Case</h3>

<p>At any time, a client may add an item to the roster by sending a roster set to the server.
</p>
<p>Note: When the item added represents another IM user, the value of the 'jid' attribute MUST be a bare JID &lt;contact@domain&gt; rather a full JID &lt;contact@domain/resource&gt;, since the desired result is for the user to receive presence from all of the contact's resources, not merely the particular resource specified in the 'to' attribute.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony' type='set' id='roster_2'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='nurse@example.com'
             name='Nurse'&gt;
         &lt;group&gt;Servants&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;
</pre></div>
<p>If the server can successfully process the roster set (i.e., if none of the error cases occurs), it MUST create the roster item in persistent storage and send a roster push containing the new roster item to all of the user's interested resources.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq to='juliet@example.com/balcony'
       type='set'
       id='a78b4q6ha463'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='nurse@example.com'
             name='Nurse'
             subscription='none'&gt;
         &lt;group&gt;Servants&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;

S: &lt;iq to='juliet@example.com/chamber'
       type='set'
       id='a78b4q6ha464'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='nurse@example.com'
             name='Nurse'
             subscription='none'&gt;
         &lt;group&gt;Servants&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;
</pre></div>
<p>The server MUST also return an IQ stanza of type "result" to the connected resource that sent the roster set.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;iq to='juliet@example.com/balcony' type='result' id='roster_2'/&gt;
</pre></div>
<p>As required by the semantics of the IQ stanza as defined in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>, each resource that receives a roster push MUST reply with an IQ stanza of type "result" (or "error").
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony'
      type='result'
      id='a78b4q6ha463'/&gt;

C: &lt;iq from='juliet@example.com/chamber'
      type='result'
      id='a78b4q6ha464'/&gt;
</pre></div>
<a name="roster-add-errors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.2"></a><h3>2.3.2.&nbsp;
Error Cases</h3>

<p>If the server cannot successfully process the roster set, it MUST return an error.  The following error cases are defined (naturally, other stanza errors may occur, e.g.,  &lt;internal-server-error/&gt;).
</p>
<p>The server SHOULD return a &lt;bad-request/&gt; error to the client if the roster set violates any of the following conditions:
</p>
<p>
          </p>
<ol class="text">
<li>The &lt;query/&gt; element contains more than one &lt;item/&gt; child element.
</li>
<li>The &lt;item/&gt; element contains more than one &lt;group/&gt; element, but there are duplicate groups (where duplicates are determined using the Resourceprep profile of stringprep as defined in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>).
</li>
</ol><p>
        
</p>
<p>The server SHOULD return a &lt;not-acceptable/&gt; error to the client if the roster set violates any of the following conditions:
</p>
<p>
          </p>
<ol class="text">
<li>The value of the 'name' attribute is greater than a server-configured limit.
</li>
<li>The XML character data of the &lt;group/&gt; element is of zero length.
</li>
<li>The XML character data of the &lt;group/&gt; element is greater than a server-configured limit.
</li>
</ol><p>
        
</p>
<p>Alternatively, the server MAY ignore the foregoing violations and process the roster set as best as possible (e.g., process only the first &lt;item/&gt; element, ignore duplicate &lt;group/&gt; elements, place the roster item in no group or a default group if the &lt;group/&gt; element is empty, and truncate 'name' attributes and &lt;group/&gt; elements that are too long).
</p>
<p>Error: Roster set contains more than one item
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony' type='set' id='roster_3'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='nurse@example.com'
             name='Nurse'&gt;
         &lt;group&gt;Servants&lt;/group&gt;
       &lt;/item&gt;
       &lt;item jid='mother@example.com'
             name='Mom'&gt;
         &lt;group&gt;Family&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;

S: &lt;iq to='juliet@example.com/balcony' type='error' id='roster_3'&gt;
    &lt;error type='modify'&gt;
      &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
    &lt;/error&gt;
  &lt;/iq&gt;
</pre></div>
<p>Error: Roster set contains item with oversized handle
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony' type='set' id='roster_4'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='nurse@example.com'
             name='[ ... some-very-long-handle ... ]'&gt;
         &lt;group&gt;Servants&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;

S: &lt;iq to='juliet@example.com/balcony' type='error' id='roster_4'&gt;
     &lt;error type='modify'&gt;
       &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<p>Error: Roster set contains duplicate groups
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony' type='set' id='roster_5'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='nurse@example.com'
             name='Nurse'&gt;
         &lt;group&gt;Servants&lt;/group&gt;
         &lt;group&gt;Servants&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;

S: &lt;iq to='juliet@example.com/balcony' type='error' id='roster_5'&gt;
     &lt;error type='modify'&gt;
       &lt;bad-request xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<p>Error: Roster set contains empty group
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony' type='set' id='roster_6'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='nurse@example.com'
             name='Nurse'&gt;
         &lt;group&gt;&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;

S: &lt;iq to='juliet@example.com/balcony' type='error' id='roster_6'&gt;
     &lt;error type='modify'&gt;
       &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<p>Error: Roster set contains oversized group
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony' type='set' id='roster_7'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='nurse@example.com'
             name='Nurse'&gt;
         &lt;group&gt;[ ... some-very-long-group-name ... ]&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;

S: &lt;iq to='juliet@example.com/balcony' type='error' id='roster_7'&gt;
     &lt;error type='modify'&gt;
       &lt;not-acceptable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<p>The server MUST return a &lt;not-allowed/&gt; error to the client if the value of the &lt;item/&gt; element's 'jid' attribute matches the bare JID &lt;node@domain&gt; portion of the &lt;iq/&gt; element's 'from' attribute (i.e., a JID must not be allowed to add itself to its own roster).
</p>
<p>Error: Roster set contains sender's JID
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony' type='set' id='roster_8'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='juliet@example.com'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;

S: &lt;iq to='juliet@example.com/balcony' type='error' id='roster_8'&gt;
      &lt;error type='cancel'&gt;
        &lt;not-allowed xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
      &lt;/error&gt;
    &lt;/iq&gt;
</pre></div>
<a name="roster-update"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Updating a Roster Item</h3>

<a name="roster-update-success"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.1"></a><h3>2.4.1.&nbsp;
Success Case</h3>

<p>Updating an existing roster item is done in the same way as adding a new roster item, i.e., by sending a roster set to the server.  Because a roster item is atomic, the item shall be updated exactly as provided in the roster set.
</p>
<p>There are several reasons why a client might update a roster item:
</p>
<p>
          </p>
<ol class="text">
<li>Adding a group
</li>
<li>Deleting a group
</li>
<li>Changing the handle
</li>
<li>Deleting the handle
</li>
</ol><p>
        
</p>
<p>Consider a roster item that is defined as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;item jid='romeo@example.net'
          name='Romeo'&gt;
      &lt;group&gt;Friends&lt;/group&gt;
    &lt;/item&gt;
</pre></div>
<p>The user who has this item in her roster may want to add the item to another group.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/chamber' type='set' id='update_1'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='romeo@example.net'
             name='Romeo'&gt;
         &lt;group&gt;Friends&lt;/group&gt;
         &lt;group&gt;Lovers&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;
</pre></div>
<p>The user may then want to remove the item from the original group.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/chamber' type='set' id='update_2'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='romeo@example.net'
             name='Romeo'&gt;
         &lt;group&gt;Lovers&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;
</pre></div>
<p>The user may then want to change the handle for the item.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/chamber' type='set' id='update_3'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='romeo@example.net'
             name='MyRomeo'&gt;
         &lt;group&gt;Lovers&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;
</pre></div>
<p>The user may then want to remove the handle altogether (note: including an empty 'name' attribute is equivalent to including no 'name' attribute).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/chamber' type='set' id='update_4'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='romeo@example.net'
             name=''&gt;
         &lt;group&gt;Lovers&lt;/group&gt;
       &lt;/item&gt;
     &lt;/query&gt;
   &lt;/iq&gt;
</pre></div>
<p>The user may then want to remove the item from all groups.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/chamber' type='set' id='update_5'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='romeo@example.net'/&gt;
     &lt;/query&gt;
   &lt;/iq&gt;
</pre></div>
<p>As with adding a roster item, when updating a roster item the server MUST update the roster information in persistent storage, send a roster push to all of the user's interested resources, and send an IQ result to the initiating resource; for details, see <a class='info' href='#roster-add'>Section&nbsp;2.3<span> (</span><span class='info'>Adding a Roster Item</span><span>)</span></a>.
</p>
<a name="roster-update-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.2"></a><h3>2.4.2.&nbsp;
Error Cases</h3>

<p>The error cases described under <a class='info' href='#roster-add-errors'>Section&nbsp;2.3.2<span> (</span><span class='info'>Error Cases</span><span>)</span></a> also apply to updating a roster item.
</p>
<a name="roster-delete"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Deleting a Roster Item</h3>

<a name="roster-delete-success"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.1"></a><h3>2.5.1.&nbsp;
Success Case</h3>

<p>At any time, a client may delete an item from his or her roster by sending a roster set and specifying the value of the 'subscription' attribute to be "remove".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony' type='set' id='delete_1'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='nurse@example.com' subscription='remove'/&gt;
     &lt;/query&gt;
   &lt;/iq&gt;
</pre></div>
<p>As with adding a roster item, if the server can successfully process the roster set then it MUST update the roster information in persistent storage, send a roster push to all of the user's interested resources (with the 'subscription' attribute set to a value of "remove"), and send an IQ result to the initiating resource; for details, see <a class='info' href='#roster-add'>Section&nbsp;2.3<span> (</span><span class='info'>Adding a Roster Item</span><span>)</span></a>.
</p>
<p>The server MUST also generate a presence stanza of type "unsubscribe" and a presence stanza of type "unsubscribed" from the user to the contact.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: &lt;presence from='juliet@example.com'
             to='nurse@example.com'
             type='unsubscribe'/&gt;

S: &lt;presence from='juliet@example.com'
             to='nurse@example.com'
             type='unsubscribed'/&gt;
</pre></div>
<a name="roster-delete-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.2"></a><h3>2.5.2.&nbsp;
Error Cases</h3>

<p>If the value of the 'jid' attribute specifies an item that is not in the roster, the server MUST return an &lt;item-not-found/&gt; error.
</p>
<p>Error: Roster item not found
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
C: &lt;iq from='juliet@example.com/balcony'
       type='set'
       id='delete_2'&gt;
     &lt;query xmlns='jabber:iq:roster'&gt;
       &lt;item jid='[ ... non-existent-jid ... ]'
             subscription='remove'/&gt;
     &lt;/query&gt;
   &lt;/iq&gt;

S: &lt;iq to='juliet@example.com/balcony' type='error' id='delete_2'&gt;
     &lt;error type='modify'&gt;
       &lt;item-not-found xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
     &lt;/error&gt;
   &lt;/iq&gt;
</pre></div>
<a name="sub"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Managing Presence Subscriptions</h3>

<p><a name='anchor9'></a>In order to protect the privacy of instant messaging users, presence information is disclosed only to other entities that the user has approved.  When a user has agreed that another entity may view its presence, the entity is said to have a SUBSCRIPTION to the user's presence.  <a name='anchor10'></a>An entity that has a subscription to a user's presence or to which a user has a presence subscription is called a CONTACT (in this document the term "contact" is also used in less strict sense to refer to a potential contact or an item in a user's roster).
</p>
<p>In XMPP, a subscription lasts across sessions; indeed, it lasts until the contact unsubscribes or the user cancels the previously-granted subscription.
</p>
<p>Subscriptions are managed within XMPP by sending presence stanzas containing specially-defined attributes ("subscribe", "unsubscribe", "subscribed", and "unsubscribed").
</p>
<p>Subscription states are reflected in the rosters of both the user and the contact.  Complete details regarding these subscription states can be found <a class='info' href='#substates'>Appendix&nbsp;A<span> (</span><span class='info'>Subscription States</span><span>)</span></a>; those details are not provided in this section, which simply narrates the protocol flows for common use cases related to presence subscriptions.
</p>
<p>Note: Presence subscription requests are sent to available resources, whereas the roster pushes associated with subscription state changes are sent to interested resources.  Therefore if a resource wishes to receive both subscription requests and roster pushes, it MUST both send initial presence and request the roster.
</p>
<p>Note: When a server processes or generates an outbound presence stanza of type "subscribe", "subscribed", "unsubscribe", or "unsubscribed", the server MUST stamp the outgoing presence stanza with the bare JID &lt;node@domain&gt; of the sending entity, not the full JID &lt;node@domain/resource&gt;.  Enforcement of this rule simplifies the presence subscription model and helps to prevent presence leaks; for information about presence leaks, refer to the security considerations of <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="sub-request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Requesting a Subscription</h3>

<p><a name='anchor11'></a>A SUBSCRIPTION REQUEST is a presence stanza whose 'type' attribute has a value of "subscribe".  A subscription request is generated by a user's client, processed by the (potential) contact's server, and acted on by the contact via the contact's client.  The workflow is described in the following sections.
</p>
<a name="sub-request-gen"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Client Generation of Outbound Subscription Request</h3>

<p>A user's client generates a subscription request by sending a presence stanza of type "subscribe" and specifying a 'to' address of the potential contact's bare JID &lt;contact@domain&gt;.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UC: &lt;presence to='juliet@example.com' type='subscribe'/&gt;
</pre></div>
<p>A user's client SHOULD NOT send a presence subscription to a full JID &lt;contact@domain/resource&gt;.
</p>
<p>Typically the user's client prompts the user for information about the potential contact ("handle" and desired roster group) and generates a roster set with that information before sending the subscription request, but that behavior is recommended rather than required.
</p>
<a name="sub-request-outbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Server Processing of Outbound Subscription Request</h3>

<p>As mentioned, the user's server MUST stamp the outbound subscription request with the bare JID &lt;user@domain&gt; of the user.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence from='romeo@example.net'
              to='juliet@example.com'
              type='subscribe'/&gt;
</pre></div>
<p>Note: If the subscription request is directed to a full JID &lt;contact@domain/resource&gt; instead of a bare JID &lt;contact@domain&gt;, the user's server SHOULD treat it as if the request had been directed to the contact's bare JID and modify the 'to' address accordingly.  This simplifies processing of presence subscriptions.
</p>
<p>If the potential contact is hosted on the same server, the server MUST adhere to the rules specified in the next section in processing the subscription request and delivering it to the (local) contact.
</p>
<p>If the potential contact is hosted on a different server, the user's server then routes the stanza to that foreign domain in accordance with core XMPP stanza processing rules.
</p>
<p>The user's server MUST then send a roster push to all of the user's interested resources, containing the potential contact with a subscription state of "none" and with notation that the subscription is pending (via an 'ask' attribute whose value is "subscribe").
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;iq to='romeo@example.net/foo'
        type='set'
        id='b89c5r7ib574'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='juliet@example.com'
              subscription='none'
              ask='subscribe'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;

US: &lt;iq to='romeo@example.net/bar'
        type='set'
        id='b89c5r7ib575'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='juliet@example.com'
              subscription='none'
              ask='subscribe'/&gt;
        &lt;/item&gt;
      &lt;/query&gt;
    &lt;/iq&gt;
</pre></div>
<p>Note: Because the server must send this roster push, a client MAY simply wait for the roster push rather than proactively adding the contact to the user's roster before sending the subscription request.
</p>
<p>Note: If the contact does not approve or deny the subscription request within some configurable amount of time, the user's server SHOULD re-send the subscription request to the contact based on an implementation-specific algorithm (e.g., whenever a new resource becomes available for the user, or after a certain amount of time has elapsed); this helps to recover from transient, silent errors that may have occurred in relation to the original subscription request.
</p>
<a name="sub-request-inbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.3"></a><h3>3.1.3.&nbsp;
Server Processing of Inbound Subscription Request</h3>

<p>The contact's server MUST adhere to the following rules when processing the inbound subscription request:
</p>
<p>
          </p>
<ol class="text">
<li>Above all, the contact's server MUST NOT automatically approve subscription requests on the contact's behalf; instead, if a subscription request requires approval then the contact's server MUST deliver that request to the contact's available resource(s) for approval or denial by the contact.
</li>
<li>If the contact does not exist, the contact's server MUST automatically return a presence stanza of type "unsubscribed" to the user.
              <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;presence from='juliet@example.com'
              to='romeo@example.net'
              type='unsubscribed'/&gt;
</pre></div>
            
</li>
<li>If the contact exists and the user already has a subscription to the user's presence, then the contact's server SHOULD auto-reply on behalf of the contact by sending a presence stanza of type "subscribed" from the contact's bare JID to the user's bare JID.  If the contact previously sent a presence stanza of type "subscribed" and the contact's server treated that as indicating "pre-approval" for the user's presence subscription (see <a class='info' href='#substates'>Appendix&nbsp;A<span> (</span><span class='info'>Subscription States</span><span>)</span></a>), then the contact's server MAY also auto-reply on behalf of the contact.
</li>
<li>If the contact exists, the user does not already have a subscription to the contact's presence, and there is at least one available resource associated with the contact when the subscription request is received by the contact's server, the contact's server MUST broadcast that subscription request to all available resources in accordance with <a class='info' href='#rules'>Server Rules for Processing XML Stanzas<span> (</span><span class='info'>Server Rules for Processing XML Stanzas</span><span>)</span></a>.
</li>
<li>If the contact exists, the user does not already have a subscription to the contact's presence, and the contact has no available resources when the subscription request is received by the contact's server, the contact's server MUST keep a record of the complete presence stanza comprising the subscription request, including any extended content contained therein, and deliver the request when the contact next has an available resource.  The contact's server MUST continue to deliver the subscription request whenever the contact creates an available resource, until the contact either approves or denies the request.  (Note: The contact's server MUST NOT deliver more than one subscription request from any given user when the contact next has an available resource; e.g., if the user sends multiple subscription requests to the contact while the contact is offline, the contact's server SHOULD store only one of those requests, such as the first request or last request, and MUST deliver only one of the requests when the contact next has an available resource; this helps to prevent "subscription request spam".)
</li>
</ol><p>
        
</p>
<p>Note: If the subscription request is directed to a full JID &lt;contact@domain/resource&gt; instead of a bare JID &lt;contact@domain&gt;, the contact's server SHOULD treat it as if the request had been directed to the contact's bare JID.  This simplifies processing of presence subscriptions.
</p>
<p>Note: Until and unless the contact approves the subscription request as described under <a class='info' href='#sub-request-handle'>Section&nbsp;3.1.4<span> (</span><span class='info'>Client Processing of Inbound Subscription Request</span><span>)</span></a>, the contact's server MUST NOT add an item for the user to the contact's roster.
</p>
<a name="sub-request-handle"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.4"></a><h3>3.1.4.&nbsp;
Client Processing of Inbound Subscription Request</h3>

<p>When the contact's client receives a subscription request from the user, it MUST present the request to the contact for approval (unless the contact has explicitly configured the client to automatically approve or deny some or all subscription requests).
</p>
<p>A subscription request is approved by sending a presence stanza of type "subscribed", which is processed as described in the following sections for both the contact's server and the user's server.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CC: &lt;presence to='romeo@example.net' type='subscribed'/&gt;
</pre></div>
<p>Note: Before approving a presence subscription, the contact MAY generate a roster set that includes a handle for the user and that places the user in one or more roster groups; see <a class='info' href='#roster-add'>Section&nbsp;2.3<span> (</span><span class='info'>Adding a Roster Item</span><span>)</span></a>.
</p>
<p>A subscription request is denied by sending a presence stanza of type "unsubscribed", which is processed as described under <a class='info' href='#sub-cancel'>Section&nbsp;3.2<span> (</span><span class='info'>Cancelling a Subscription</span><span>)</span></a> for both the contact's server and the user's server.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CC: &lt;presence to='romeo@example.net' type='unsubscribed'/&gt;
</pre></div>
<a name="sub-request-approvalout"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.5"></a><h3>3.1.5.&nbsp;
Server Processing of Outbound Subscription Approval</h3>

<p>When the contact's client sends the subscription approval, the contact's server MUST stamp the outbound stanza with the bare JID &lt;contact@domain&gt; of the contact and route or deliver the stanza to the user.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;presence from='juliet@example.com'
              to='romeo@example.net'
              type='subscribed'/&gt;
</pre></div>
<p>The contact's server then MUST send a roster push to all of the contact's interested resources.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;iq to='juliet@example.com/balcony'
        type='set'
        id='a78b4q6ha463'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='romeo@example.net'
              subscription='from'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;

CS: &lt;iq to='juliet@example.com/chamber'
        type='set'
        id='a78b4q6ha464'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='romeo@example.net'
              subscription='from'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;
</pre></div>
<p>The contact's server MUST then also send current presence to the user from each of the contact's available resources.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'/&gt;

CS: &lt;presence from='juliet@example.com/chamber'
              to='romeo@example.net'/&gt;
</pre></div>
<p>From the perspective of the contact, there now exists a subscription from the user.
</p>
<p>In order to subscribe to the user's presence, the contact would then send a subscription request to the user.  (XMPP clients will often automatically send the subscription request instead of requiring the contact to initiate the subscription request, since it is assumed that the desired end state is a mutual subscription.)  Naturally, when the contact sends a subscription request to the user, the subscription states will be different from those shown in the foregoing examples (see <a class='info' href='#substates'>Appendix&nbsp;A<span> (</span><span class='info'>Subscription States</span><span>)</span></a>) and the roles will be reversed.
</p>
<a name="sub-request-approvalin"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.6"></a><h3>3.1.6.&nbsp;
Server Processing of Inbound Subscription Approval</h3>

<p>When the user's server receives the subscription approval, it MUST first check if the contact is in the user's roster with a subscription='none' or subscription='from' and the 'ask' flag set to "subscribe" (i.e., a subscription states of "None + Pending Out" or "From + Pending Out"; see <a class='info' href='#substates'>Appendix&nbsp;A<span> (</span><span class='info'>Subscription States</span><span>)</span></a>).  If the contact is not in the user's roster with either of those states, the user's server MUST silently ignore the presence stanza of type "subscribed" (i.e., it MUST NOT route it to the user, modify the user's roster, or generate a roster push to the user's interested resources).
</p>
<p>If the foregoing check is successful, the user's server MUST initiate a roster push to all of the user's interested resources, containing an updated roster item for the contact with the 'subscription' attribute set to a value of "to".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;iq to='romeo@example.net/foo'
        type='set'
        id='b89c5r7ib576'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='juliet@example.com'
              subscription='to'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;

US: &lt;iq to='romeo@example.net/bar'
        type='set'
        id='b89c5r7ib577'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='juliet@example.com'
              subscription='to'/&gt;
        &lt;/item&gt;
      &lt;/query&gt;
    &lt;/iq&gt;
</pre></div>
<p>From the perspective of the user, there now exists a subscription to the contact's presence.
</p>
<p>The user's server MUST also deliver the available presence stanza received from each of the contact's available resources to each of the user's available resources.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
[ ... to resource1 ... ]

US: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'/&gt;

[ ... to resource2 ... ]

US: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'/&gt;

[ ... to resource1 ... ]

US: &lt;presence from='juliet@example.com/chamber'
              to='romeo@example.net'/&gt;

[ ... to resource2 ... ]

US: &lt;presence from='juliet@example.com/chamber'
              to='romeo@example.net'/&gt;
</pre></div>
<a name="sub-cancel"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Cancelling a Subscription</h3>

<a name="sub-cancel-gen"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
Client Generation of Subscription Cancellation</h3>

<p>If a contact would like to cancel a subscription that it has previously granted to a user (or deny a subscription request), it sends a presence stanza of type "unsubscribed".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CC: &lt;presence to='romeo@example.net' type='unsubscribed'/&gt;
</pre></div>
<a name="sub-cancel-outbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
Server Processing of Outbound Subscription Cancellation</h3>

<p>As mentioned, the contact's server MUST stamp the outbound subscription cancellation with the bare JID &lt;contact@domain&gt; of the contact.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;presence from='juliet@example.com'
              to='romeo@example.net'
              type='unsubscribed'/&gt;
</pre></div>
<p>If the user is hosted on the same server, the server MUST adhere to the rules specified in the next section when processing the subscription cancellation.
</p>
<p>If the user is hosted on a different server, the contact's server then routes the stanza to that foreign domain in accordance with core XMPP stanza processing rules.
</p>
<p>If the user is in the contact's roster, the contact's server then MUST send a roster push with the updated roster item to all of the contact's interested resources, where the subscription state is now either "none" or "to" (see <a class='info' href='#substates'>Appendix&nbsp;A<span> (</span><span class='info'>Subscription States</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;iq to='juliet@example.com/balcony'
        type='set'
        id='a78b4q6ha465'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='romeo@example.net'
              subscription='none'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;

CS: &lt;iq to='juliet@example.com/chamber'
        type='set'
        id='a78b4q6ha466'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='romeo@example.net'
              subscription='none'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;
</pre></div>
<a name="sub-cancel-inbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.3"></a><h3>3.2.3.&nbsp;
Server Processing of Inbound Subscription Cancellation</h3>

<p>When the user's server receives the inbound subscription cancellation, it MUST modify the subscription state and send a roster push to the user's interested resources, where the subscription state is now either "none" or "from" (see <a class='info' href='#substates'>Appendix&nbsp;A<span> (</span><span class='info'>Subscription States</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;iq to='romeo@example.net/foo'
        type='set'
        id='h37h3u1bv400'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='juliet@example.com'
              subscription='none'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;

US: &lt;iq to='romeo@example.net/bar'
        type='set'
        id='h37h3u1bv401'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='juliet@example.com'
              subscription='none'/&gt;
        &lt;/item&gt;
      &lt;/query&gt;
    &lt;/iq&gt;
</pre></div>
<a name="sub-unsub"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Unsubscribing</h3>

<a name="sub-unsub-gen"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1"></a><h3>3.3.1.&nbsp;
Client Generation of Unsubscribe</h3>

<p>If a user would like to unsubscribe from a contact's presence, it sends a presence stanza of type "unsubscribe".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UC: &lt;presence to='juliet@example.com' type='unsubscribe'/&gt;
</pre></div>
<a name="sub-unsub-outbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.2"></a><h3>3.3.2.&nbsp;
Server Processing of Outbound Unsubscribe</h3>

<p>As mentioned, the user's server MUST stamp the outbound unsubscribe with the bare JID &lt;user@domain&gt; of the user.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence from='romeo@example.net'
              to='juliet@example.com'
              type='unsubscribe'/&gt;
</pre></div>
<p>If the contact is hosted on the same server, the server MUST adhere to the rules specified in the next section when processing the unsubscribe.
</p>
<p>If the contact is hosted on a different server, the user's server then routes the stanza to that foreign domain in accordance with core XMPP stanza processing rules.
</p>
<p>The user's server then MUST send a roster push with the updated roster item to all of the user's interested resources, where the subscription state is now either "none" or "from" (see <a class='info' href='#substates'>Appendix&nbsp;A<span> (</span><span class='info'>Subscription States</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;iq to='romeo@example.net/foo'
        type='set'
        id='h37h3u1bv402'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='juliet@example.com'
              subscription='none'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;

US: &lt;iq to='romeo@example.net/bar'
        type='set'
        id='h37h3u1bv403'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='juliet@example.com'
              subscription='none'/&gt;
        &lt;/item&gt;
      &lt;/query&gt;
    &lt;/iq&gt;
</pre></div>
<a name="sub-unsub-inbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.3"></a><h3>3.3.3.&nbsp;
Server Processing of Inbound Unsubscribe</h3>

<p>When the contact's server receives the inbound unsubscribe, it MUST modify the subscription state and send a roster push to the contact's interested resources, where the subscription state is now either "none" or "to" (see <a class='info' href='#substates'>Appendix&nbsp;A<span> (</span><span class='info'>Subscription States</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;iq to='juliet@example.com/balcony'
        type='set'
        id='a78b4q6ha467'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='romeo@example.net'
              subscription='none'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;

CS: &lt;iq to='juliet@example.com/chamber'
        type='set'
        id='a78b4q6ha468'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='romeo@example.net'
              subscription='none'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;
</pre></div>
<a name="presence"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Exchanging Presence Information</h3>

<a name="presence-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Overview</h3>

<p>The concept of presence refers to an entity's availability for communication over a network.  At the most basic level, presence is a boolean "on/off" variable that signals whether an entity is available or unavailable for communication (the terms "online" and "offline" are also used).  In XMPP, a principal's availability is signalled when a client controlled by the principal generates a &lt;presence/&gt; stanza with no 'type' attribute, and an entity's lack of availability is signalled when a client generates a &lt;presence/&gt; stanza whose 'type' attribute has a value of "unavailable".  In XMPP-based applications that combine messaging and presence functionality, the default type of communication for which presence signals availability is messaging; however, XMPP-based applications are not required to combine messaging and presence functionality, and can provide standalone presence features without messaging (in addition, XMPP servers do not require information about network availability in order to successfully route message and IQ stanzas).
</p>
<p>XMPP presence typically follows a "publish-subscribe" or "observer" pattern, wherein an entity sends presence to its server, and its server then broadcasts that information to all of the entity's contacts who have a subscription to the entity's presence (in the terminology of <a class='info' href='#IMP-MODEL'>[IMP&#8209;MODEL]<span> (</span><span class='info'>Day, M., Rosenberg, J., and H. Sugano, &ldquo;A Model for Presence and Instant Messaging,&rdquo; February&nbsp;2000.</span><span>)</span></a>, an entity that generates presence is a "presentity" and the entities that receive presence are "subscribers").  A client generates presence for broadcasting to all subscribed entities by sending a presence stanza to its server with no 'to' address, where the presence stanza has either no 'type' attribute or a 'type' attribute whose value is "unavailable". <a name='anchor12'></a> This kind of presence is called BROADCASTED PRESENCE. <a name='anchor13'></a> (A client MAY also send DIRECTED PRESENCE, i.e., a presence stanza with a 'to' address; this is less common but is sometimes used to send presence to entities that are not subscribed to the principal's presence; see <a class='info' href='#presence-directed'>Section&nbsp;4.6<span> (</span><span class='info'>Directed Presence</span><span>)</span></a>.)
</p>
<p><a name='anchor14'></a>After a client completes the preconditions specified in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>, it can establish a PRESENCE SESSION at its server by sending <a class='info' href='#presence-initial'>initial presence<span> (</span><span class='info'>Initial Presence</span><span>)</span></a>.  Such a presence session is terminated by sending <a class='info' href='#presence-unavailable'>unavailable presence<span> (</span><span class='info'>Unavailable Presence</span><span>)</span></a>.
</p>
<a name="presence-initial"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Initial Presence</h3>

<a name="presence-initial-gen"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Client Generation of Initial Presence</h3>

<p><a name='anchor15'></a>After completing the preconditions described in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a> (REQUIRED) and requesting the roster (RECOMMENDED), a client SHOULD signal its availability for communication by sending INITIAL PRESENCE to its server, i.e., a presence stanza with no 'to' address (indicating that it is meant to be broadcasted by the server on behalf of the client) and no 'type' attribute (indicating the user's availability). <a name='anchor16'></a> After sending initial presence, a connected resource (in the terminology of <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>) is said to be an AVAILABLE RESOURCE.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UC: &lt;presence/&gt;
</pre></div>
<a name="presence-initial-outbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Server Processing of Outbound Presence</h3>

<p>Upon receiving initial presence from a client, the user's server MUST send the initial presence stanza from the full JID &lt;user@domain/resource&gt; of the user to all contacts that are subscribed to the user's presence; such contacts are those for which a JID is present in the user's roster with the 'subscription' attribute set to a value of "from" or "both".
</p>
<p>Note: In the following examples, the "user" is juliet@example.com and the user has three contacts in her roster with a subscription state of "from" or "both": romeo@example.net, mercutio@example.com, and benvolio@example.com.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'/&gt;

US: &lt;presence from='juliet@example.com/balcony'
              to='mercutio@example.com'/&gt;

US: &lt;presence from='juliet@example.com/balcony'
              to='benvolio@example.com'/&gt;
</pre></div>
<p>The user's server MUST also broadcast initial presence from the user's newly available resource to all of the user's available resources.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence from='juliet@example.com/balcony'
              to='juliet@example.com/balcony'/&gt;

US: &lt;presence from='juliet@example.com/balcony'
              to='juliet@example.com/chamber'/&gt;
</pre></div>
<p>In the absence of presence information about the user's contacts, the user's server SHOULD also send presence probes to the user's contacts on behalf of the user as specified under <a class='info' href='#presence-probe'>Section&nbsp;4.3<span> (</span><span class='info'>Presence Probes</span><span>)</span></a>.
</p>
<a name="presence-initial-inbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.3"></a><h3>4.2.3.&nbsp;
Server Processing of Inbound Presence</h3>

<p>Upon receiving presence from the user, the contact's server MUST deliver the user's presence stanza to all of the contact's available resources.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
[ ... to resource1 ... ]

CS: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'/&gt;

[ ... to resource2 ... ]

CS: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'/&gt;
</pre></div>
<a name="presence-initial-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.4"></a><h3>4.2.4.&nbsp;
Client Processing of Inbound Presence</h3>

<p>When the contact's client receives presence from the user and the user is in the contact's roster, it SHOULD display the presence information in an appropriate roster interface.
</p>
<p>If the user is not in the contact's roster but the contact and the user are actively exchanging message or IQ stanzas, the contact's client SHOULD display the presence information in the user interface for that chat session (see also <a class='info' href='#presence-directed'>Section&nbsp;4.6<span> (</span><span class='info'>Directed Presence</span><span>)</span></a> and <a class='info' href='#message-chat'>Section&nbsp;5.4<span> (</span><span class='info'>One-to-One Chat Sessions</span><span>)</span></a>).
</p>
<p>Otherwise, the client SHOULD ignore the presence information and not display it to the contact.
</p>
<a name="presence-probe"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Presence Probes</h3>

<p><a name='anchor17'></a>A PRESENCE PROBE is a presence stanza whose 'type' attribute has a value of "probe".  The value of the 'from' address SHOULD be the full JID &lt;user@domain/resource&gt; of the probing user and the value of the 'to' address SHOULD be the bare JID &lt;contact@domain&gt; of the contact whose availability the user wants to discover.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'
              type='probe'/&gt;
</pre></div>
<p>A presence probe SHOULD NOT be sent by a client.  Instead, it is designed to be sent by a user's server on the user's behalf in order to discover the availability of the user's contacts.
</p>
<p>If a server receives a presence probe intended for a full JID &lt;contact@domain/resource&gt;, it SHOULD treat the probe as if the 'to' address was a bare JID, but MAY instead handle it on behalf of the connected resource by returning only the presence information for that particular resources (and in any case MUST NOT deliver it to the resource).
</p>
<a name="presence-probe-outbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1"></a><h3>4.3.1.&nbsp;
Server Generation of Outbound Presence Probe</h3>

<p>When a server needs to discover the availability of a user's contact, it SHOULD send a presence probe from the full JID &lt;user@domain/resource&gt; of the user to the bare JID &lt;contact@domain&gt; of the contact.  The server SHOULD send a probe to a contact only if the contact is in the user's roster with the 'subscription' attribute set to a value of "to" or "both" (i.e., if the user is subscribed to the contact's presence).
</p>
<p>The user's server SHOULD send a presence probe whenever the user starts a new presence session by sending initial presence; however, the server MAY choose not to send the probe at that point if it has what it deems to be reliable and up-to-date presence information about the user's contacts (e.g., because the user has another available resource or because the user briefly logged off and on before the new presence session began).  In addition, a server MAY periodically send a presence probe to a contact if it has not received presence information or other traffic from the contact in some configurable amount of time; this can help to prevent "ghost" contacts who appear to be online but in fact are not.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'
              type='probe'/&gt;

US: &lt;presence from='juliet@example.com/balcony'
              to='benvolio@example.com'
              type='probe'/&gt;

US: &lt;presence from='juliet@example.com/balcony'
              to='nurse@example.com'
              type='probe'/&gt;
</pre></div>
<a name="presence-probe-inbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.2"></a><h3>4.3.2.&nbsp;
Server Processing of Inbound Presence Probe</h3>

<p>Upon receiving a presence probe from the user's server on behalf of the user, the contact's server SHOULD reply as follows:
</p>
<p>
          </p>
<ol class="text">
<li>If the contact account does not exist or the user is in the contact's roster with a subscription state other than "From", "From + Pending Out", or "Both" (as defined under <a class='info' href='#substates'>Appendix&nbsp;A<span> (</span><span class='info'>Subscription States</span><span>)</span></a>), the contact's server MUST return a presence stanza of type "unsubscribed" in response to the presence probe (however, if a server receives a presence probe from a configured hostname of the server itself or another such trusted service, it MAY provide presence information about the user to that entity).
              <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;presence from='mercutio@example.com'
              to='juliet@example.com'
              type='unsubscribed'/&gt;
</pre></div>
            
</li>
<li>Else, if the contact has no available resources, the server SHOULD reply to the presence probe by sending to the user the full XML of the last presence stanza of type "unavailable" received by the server from the contact (but MAY not reply at all).
</li>
<li>Else, if the contact has at least one available resource, the server MUST reply to the presence probe by sending to the user the full XML of the last presence stanza with no 'to' attribute received by the server from each of the contact's available resources.
              <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;presence from='romeo@example.net/foo'
              to='juliet@example.com'/&gt;

CS: &lt;presence from='romeo@example.net/bar'
              to='juliet@example.com'&gt;
      &lt;show&gt;away&lt;/show&gt;
    &lt;/presence&gt;
</pre></div>
            
</li>
</ol><p>
        
</p>
<a name="presence-broadcast"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Subsequent Presence Broadcast</h3>

<a name="presence-broadcast-gen"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.1"></a><h3>4.4.1.&nbsp;
Client Generation of Presence Broadcast</h3>

<p>After sending initial presence, the user's client may update its availability for broadcasting at any time during its session by sending a presence stanza with no 'to' address and no 'type' attribute.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UC: &lt;presence&gt;
      &lt;show&gt;away&lt;/show&gt;
    &lt;/presence&gt;
</pre></div>
<p>Note: A user SHOULD NOT send a presence update to broadcast information that changes independently of the user's availability for communication.
</p>
<a name="presence-broadcast-outbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.2"></a><h3>4.4.2.&nbsp;
Server Processing of Outbound Presence</h3>

<p>Upon receiving a presence stanza expressing updated availability, the user's server MUST broadcast the full XML of that presence stanza to the contacts who meet all of the following criteria:
</p>
<p>
          </p>
<ol class="text">
<li>The contact is in the user's roster with a subscription type of "from" or "both".
</li>
<li>The last presence stanza received from the contact during the user's presence session was not of type "error" or "unsubscribe".
</li>
</ol><p>
        
</p>
<p>As an optimization, if the subscription type is "both", the server MAY send subsequent presence notifications to a contact only if the contact is online according to the user's server.  That is, if the user's server never received a positive indication that the contact is online in response to the presence probe it sent to the contact or if the last presence stanza received from the contact during the user's presence session was of type "unavailable", the user's server MAY opt not to send subsequent presence notifications from the user to the contact.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'&gt;
      &lt;show&gt;away&lt;/show&gt;
    &lt;/presence&gt;

US: &lt;presence from='juliet@example.com/balcony'
              to='benvolio@example.com'&gt;
      &lt;show&gt;away&lt;/show&gt;
    &lt;/presence&gt;

US: &lt;presence from='juliet@example.com/balcony'
              to='mercutio@example.com'&gt;
      &lt;show&gt;away&lt;/show&gt;
    &lt;/presence&gt;
</pre></div>
<p>The user's server MUST also send the presence stanza to all of the user's available resources.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence from='juliet@example.com/balcony'
              to='juliet@example.com/chamber'&gt;
      &lt;show&gt;away&lt;/show&gt;
    &lt;/presence&gt;

US: &lt;presence from='juliet@example.com/balcony'
              to='juliet@example.com/balcony'&gt;
      &lt;show&gt;away&lt;/show&gt;
    &lt;/presence&gt;
</pre></div>
<a name="presence-broadcast-inbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.3"></a><h3>4.4.3.&nbsp;
Server Processing of Inbound Presence</h3>

<p>Upon receiving presence from the user, the contact's server MUST deliver the user's presence stanza to all of the contact's available resources.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
[ ... to resource1 ... ]

CS: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'&gt;
      &lt;show&gt;away&lt;/show&gt;
    &lt;/presence&gt;

[ ... to resource2 ... ]

CS: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'&gt;
      &lt;show&gt;away&lt;/show&gt;
    &lt;/presence&gt;
</pre></div>
<a name="presence-broadcast-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.4"></a><h3>4.4.4.&nbsp;
Client Processing of Inbound Presence</h3>

<p>When the contact's client receives presence from the user and the user is in the contact's roster, it SHOULD display the presence information in an appropriate roster interface.
</p>
<p>If the user is not in the contact's roster but the contact and the user are actively exchanging message or IQ stanzas, the contact's client SHOULD display the presence information in the user interface for that chat session (see also <a class='info' href='#presence-directed'>Section&nbsp;4.6<span> (</span><span class='info'>Directed Presence</span><span>)</span></a> and <a class='info' href='#message-chat'>Section&nbsp;5.4<span> (</span><span class='info'>One-to-One Chat Sessions</span><span>)</span></a>).
</p>
<p>Otherwise, the client SHOULD ignore the presence information and not display it to the contact.
</p>
<a name="presence-unavailable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Unavailable Presence</h3>

<a name="presence-unavailable-gen"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5.1"></a><h3>4.5.1.&nbsp;
Client Generation of Unavailable Presence</h3>

<p><a name='anchor18'></a>Before ending its presence session with a server, the user's client SHOULD gracefully become unavailable by sending UNAVAILABLE PRESENCE, i.e., a presence stanza that possesses no 'to' attribute and that possesses a 'type' attribute whose value is "unavailable".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UC: &lt;presence type='unavailable'/&gt;
</pre></div>
<p>Optionally, the final presence stanza MAY contain one or more &lt;status/&gt; elements specifying the reason why the user is no longer available.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence type='unavailable'&gt;
      &lt;status&gt;going on vacation&lt;/status&gt;
    &lt;/presence&gt;
</pre></div>
<a name="presence-unavailable-outbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5.2"></a><h3>4.5.2.&nbsp;
Server Processing of Outbound Unavailable Presence</h3>

<p>The user's server MUST NOT depend on receiving unavailable presence from an available resource, since the resource may become unavailable ungracefully (e.g., the resource may be timed out by the server because of inactivity).
</p>
<p>If an available resource becomes unavailable for any reason (either gracefully or ungracefully), the user's server MUST broadcast unavailable presence to all contacts that meet all of the following criteria:
</p>
<p>
          </p>
<ol class="text">
<li>The contact is in the user's roster with a subscription type of "from" or "both".
</li>
<li>The last presence stanza received from the contact during the user's presence session was not of type "error" or "unsubscribe".
</li>
</ol><p>
        
</p>
<p>As an optimization, if the subscription type is "both", the server MAY send the unavailable presence notification to a contact only if the contact is online according to the user's server.  That is, if the user's server never received a positive indication that the contact is online in response to the presence probe it sent to the contact or if the last presence stanza received from the contact during the user's presence session was of type "unavailable", the user's server MAY opt not to send the unavailable presence notification from the user to the contact.
</p>
<p>See <a class='info' href='#presence-directed'>Section&nbsp;4.6<span> (</span><span class='info'>Directed Presence</span><span>)</span></a> regarding rules that supplement the foregoing.
</p>
<p>If the unavailable presence stanza was gracefully received from the client, the server MUST broadcast the full XML of the presence stanza.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'
              type='unavailable'/&gt;

US: &lt;presence from='juliet@example.com/balcony'
              to='benvolio@example.com'
              type='unavailable'/&gt;

US: &lt;presence from='juliet@example.com/balcony'
              to='mercutio@example.com'
              type='unavailable'/&gt;
</pre></div>
<p>The user's server MUST also send the unavailable presence stanza to all of the user's remaining available resources.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence from='juliet@example.com/balcony'
              to='juliet@example.com/chamber'
              type='unavailable'/&gt;
</pre></div>
<p>Note: Any presence stanza with no 'type' attribute and no 'to' attribute that is sent after sending broadcasted unavailable presence MUST be broadcasted by the server to all subscribers (i.e., MUST be treated as equivalent to "initial presence" for a new presence session).
</p>
<a name="presence-unavailable-inbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5.3"></a><h3>4.5.3.&nbsp;
Server Processing of Inbound Unavailable Presence</h3>

<p>Upon receiving unavailable presence from the user, the contact's server MUST deliver the user's presence stanza to all of the contact's available resources.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
[ ... to resource1 ... ]

CS: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'
              type='unavailable'/&gt;

[ ... to resource2 ... ]

CS: &lt;presence from='juliet@example.com/balcony'
              to='romeo@example.net'
              type='unavailable'/&gt;
</pre></div>
<p>If the server is optimizing subsequent presence delivery as described under <a class='info' href='#presence-broadcast'>Section&nbsp;4.4<span> (</span><span class='info'>Subsequent Presence Broadcast</span><span>)</span></a>, it SHOULD also note that the user is unavailable and appropriately update its internal representation of which users are online.
</p>
<a name="presence-unavailable-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5.4"></a><h3>4.5.4.&nbsp;
Client Processing of Inbound Unavailable Presence</h3>

<p>When the contact's client receives unavailable presence from the user and the user is in the contact's roster, it SHOULD display the unavailable presence information in an appropriate roster interface.
</p>
<p>If the user is not in the contact's roster but the contact and the user are actively exchanging message or IQ stanzas, the contact's client SHOULD display the unavailable presence information in the user interface for that chat session (see also <a class='info' href='#presence-directed'>Section&nbsp;4.6<span> (</span><span class='info'>Directed Presence</span><span>)</span></a> and <a class='info' href='#message-chat'>Section&nbsp;5.4<span> (</span><span class='info'>One-to-One Chat Sessions</span><span>)</span></a>).
</p>
<p>Otherwise, the client SHOULD ignore the unavailable presence information and not display it to the contact.
</p>
<a name="presence-directed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Directed Presence</h3>

<p>This section supplements and in some respects modifies the rules defined above, but only for the special case of directed presence.
</p>
<a name="presence-directed-gen"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6.1"></a><h3>4.6.1.&nbsp;
Client Generation of Directed Presence</h3>

<p>As noted, directed presence is a presence stanza with a 'to' attribute whose value is the bare JID or full JID of the other entity and with either no 'type' attribute (indicating availability) or a 'type' attribute whose value is "unavailable".
</p>
<p>Information about the use of directed presence in the context of a one-to-one chat session is provided under <a class='info' href='#message-chat'>Section&nbsp;5.4<span> (</span><span class='info'>One-to-One Chat Sessions</span><span>)</span></a>.
</p>
<a name="presence-directed-outbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6.2"></a><h3>4.6.2.&nbsp;
Server Processing of Outbound Directed Presence</h3>

<p>When the user's server receives the directed presence stanza, it SHOULD process it according to the following rules.
</p>
<p>
          </p>
<ol class="text">
<li>If the user sends directed available or unavailable presence to a contact that is in the user's roster with a subscription type of "from" or "both" after having sent initial presence and before sending broadcasted unavailable presence (i.e., during the user's presence session), the user's server MUST route or deliver the full XML of that presence stanza but SHOULD NOT otherwise modify the contact's status regarding broadcasted presence (i.e., it SHOULD include the contact's JID in any subsequent presence broadcasts initiated by the user).
</li>
<li>If the user sends directed presence to an entity that is not in the user's roster with a subscription type of "from" or "both" after having sent initial presence and before sending broadcasted unavailable presence (i.e., during the user's presence session), the user's server MUST route or deliver the full XML of that presence stanza to the entity but MUST NOT modify the contact's status regarding available presence broadcast (i.e., it MUST NOT include the entity's JID in any subsequent broadcasts of available presence initiated by the user); however, if the available resource from which the user sent the directed presence become unavailable, the user's server MUST route that unavailable presence to the entity (if the user has not yet sent directed unavailable presence to that entity).
</li>
<li>If the user sends directed presence without first sending initial presence or after having sent unavailable presence broadcast (i.e., the resource is connected but not available), the user's server MUST treat the entities to which the user sends directed presence in the same way that it treats the entities listed in case #2 above.
</li>
</ol><p>
        
</p>
<a name="presence-directed-inbound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6.3"></a><h3>4.6.3.&nbsp;
Server Processing of Inbound Directed Presence</h3>

<p>From the perspective of the contact's server, there is no difference between broadcasted presence and directed presence, so the contact's server follows the existing rules for processing of inbound presence.
</p>
<a name="presence-directed-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6.4"></a><h3>4.6.4.&nbsp;
Client Processing of Inbound Directed Presence</h3>

<p>When the contact's client receives presence from the user and the user is in the contact's roster, it SHOULD display the presence information in an appropriate roster interface.
</p>
<p>If the user is not in the contact's roster but the contact and the user are actively exchanging message or IQ stanzas, the contact's client SHOULD display the presence information in an appropriate user interface.
</p>
<p>Otherwise, the client SHOULD ignore the presence information and not display it to the contact.
</p>
<a name="presence-syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7"></a><h3>4.7.&nbsp;
Presence Syntax</h3>

<a name="presence-syntax-type"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7.1"></a><h3>4.7.1.&nbsp;
Type Attribute</h3>

<p>The absence of a 'type' attribute signals that the relevant entity is available for communication (see <a class='info' href='#presence-initial'>Section&nbsp;4.2<span> (</span><span class='info'>Initial Presence</span><span>)</span></a> and <a class='info' href='#presence-broadcast'>Section&nbsp;4.4<span> (</span><span class='info'>Subsequent Presence Broadcast</span><span>)</span></a>).
</p>
<p>A 'type' attribute with a value of "unavailable" signals that the relevant entity is not available for communication (see <a class='info' href='#presence-unavailable'>Section&nbsp;4.5<span> (</span><span class='info'>Unavailable Presence</span><span>)</span></a>).
</p>
<p>The XMPP presence stanza is also used to negotiate and manage subscriptions to the presence of other entities.  These tasks are completed via presence stanzas of type "subscribe", "unsubscribe", "subscribed", and "unsubscribed" as described under <a class='info' href='#sub'>Section&nbsp;3<span> (</span><span class='info'>Managing Presence Subscriptions</span><span>)</span></a>.
</p>
<p>If a user and contact are associated with different XMPP servers, those servers also use a special presence stanza of type "probe" in order to determine the availability of the entity on the peer server; for details, see <a class='info' href='#presence-probe'>Section&nbsp;4.3<span> (</span><span class='info'>Presence Probes</span><span>)</span></a>.  Clients SHOULD NOT send presence stanzas of type "probe".
</p>
<p>The values of the 'type' attribute can be summarized as follows:
</p>
<p>
          </p>
<ul class="text">
<li>error -- An error has occurred regarding processing of a previously-sent presence stanza; if the presence stanza is of type "error", it MUST include an &lt;error/&gt; child element (refer to <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>).
</li>
<li>probe -- A request for an entity's current presence; SHOULD be generated only by a server on behalf of a user.
</li>
<li>subscribe -- The sender wishes to subscribe to the recipient's presence.
</li>
<li>subscribed -- The sender has allowed the recipient to receive their presence.
</li>
<li>unsubscribe -- The sender is unsubscribing from another entity's presence.
</li>
<li>unsubscribed -- The subscription request has been denied or a previously-granted subscription has been cancelled.
</li>
<li>unavailable -- Signals that the entity is no longer available for communication.
</li>
</ul><p>
        
</p>
<p>If the value of the 'type' attribute is not one of the foregoing values, the recipient or an intermediate router SHOULD return a stanza error of &lt;bad-request/&gt;.
</p>
<p>Note: There is no default value for the 'type' attribute of the &lt;presence/&gt; element.  Therefore if the intended recipient or intermediate router receives a &lt;presence/&gt; element whose 'type' value is undefined, it SHOULD return a stanza error of &lt;bad-request/&gt;.
</p>
<a name="presence-syntax-children"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7.2"></a><h3>4.7.2.&nbsp;
Child Elements</h3>

<p>In accordance with the default namespace declaration, a presence stanza is qualified by the 'jabber:client' or 'jabber:server' namespace, which defines certain allowable children of presence stanzas, in particular the &lt;show/&gt;, &lt;status/&gt;, and &lt;priority/&gt; elements.  These child elements are used to provide more detailed information about an entity's availability.  Typically these child elements are provided only if the presence stanza possesses no 'type' attribute, although exceptions are noted in the text that follows.
</p>
<a name="presence-show"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7.3"></a><h3>4.7.3.&nbsp;
Show Element</h3>

<p>The OPTIONAL &lt;show/&gt; element specifies the particular availability sub-state of an entity or a specific resource thereof.  A presence stanza MUST NOT contain more than one &lt;show/&gt; element.  The &lt;show/&gt; element MUST NOT possess any attributes.  The XML character data of the &lt;show/&gt; element is not human-readable.  The XML character data MUST be one of the following (additional availability states could be defined through a properly-namespaced child element of the presence stanza):
</p>
<p>
          </p>
<ul class="text">
<li>away -- The entity or resource is temporarily away.
</li>
<li>chat -- The entity or resource is actively interested in chatting.
</li>
<li>dnd -- The entity or resource is busy (dnd = "Do Not Disturb").
</li>
<li>xa -- The entity or resource is away for an extended period (xa = "eXtended Away").
</li>
</ul><p>
        
</p>
<p>If no &lt;show/&gt; element is provided, the entity is assumed to be online and available.
</p>
<p>Any specialized processing of availability states by recipients and intermediate routers is up to the implementation (e.g., incorporation of availability states into server routing and delivery logic).
</p>
<a name="presence-status"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7.4"></a><h3>4.7.4.&nbsp;
Status Element</h3>

<p>The OPTIONAL &lt;status/&gt; element contains human-readable XML character data specifying a natural-language description of an entity's availability.  It is normally used in conjunction with the show element to provide a detailed description of an availability state (e.g., "In a meeting") when the presence stanza has no 'type' attribute.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;presence from='romeo@example.net/orchard'
          xml:lang='en'&gt;
  &lt;show&gt;dnd&lt;/show&gt;
  &lt;status&gt;Wooing Juliet&lt;/status&gt;
&lt;/presence&gt;
</pre></div>
<p>The &lt;status/&gt; element MUST NOT possess any attributes, with the exception of the 'xml:lang' attribute.  Multiple instances of the &lt;status/&gt; element MAY be included, but only if each instance possesses an 'xml:lang' attribute with a distinct language value (either explicitly or by inheritance from the 'xml:lang' value of an element farther up in the XML hierarchy, which may include the XML stream header as described in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;presence from='romeo@example.net/orchard'
          xml:lang='en'&gt;
  &lt;show&gt;dnd&lt;/show&gt;
  &lt;status&gt;Wooing Juliet&lt;/status&gt;
  &lt;status xml:lang='cs'&gt;Dvo&amp;#x0159;&amp;#x00ED;m se Julii&lt;/status&gt;
&lt;/presence&gt;
</pre></div>
<p>A presence stanza of type "unavailable" MAY also include a &lt;status/&gt; element to provide detailed information about why the entity is going offline.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;presence from='romeo@example.net/orchard'
          type='unavailable'&gt;
  &lt;status&gt;Busy IRL&lt;/status&gt;
&lt;/presence&gt;
</pre></div>
<p>The &lt;status/&gt; child MAY also be sent in a subscription-related presence stanza (i.e., type "subscribe", "subscribed", "unsubscribe", or "unsubscribed") to provide a description of the action.  The receiving client MAY present this &lt;status/&gt; to a human user (see <a class='info' href='#security'>Section&nbsp;11<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;presence from='romeo@example.net'
          to='nurse@example.com'
          type='subscribe'&gt;
  &lt;status&gt;Hi, Juliet said I should add you to my buddy list.&lt;/status&gt;
&lt;/presence&gt;
</pre></div>
<a name="presence-priority"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7.5"></a><h3>4.7.5.&nbsp;
Priority Element</h3>

<p>The OPTIONAL &lt;priority/&gt; element contains non-human-readable XML character data that specifies the priority level of the resource.  The value MUST be an integer between -128 and +127.  A presence stanza MUST NOT contain more than one &lt;priority/&gt; element.  The &lt;priority/&gt; element MUST NOT possess any attributes.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;presence xml:lang='en'&gt;
  &lt;show&gt;dnd&lt;/show&gt;
  &lt;status&gt;Wooing Juliet&lt;/status&gt;
  &lt;status xml:lang='cs'&gt;Dvo&amp;#x0159;&amp;#x00ED;m se Julii&lt;/status&gt;
  &lt;priority&gt;1&lt;/priority&gt;
&lt;/presence&gt;
</pre></div>
<p>If no priority is provided, the processing server or client SHOULD consider the priority to be zero.
</p>
<p>For information regarding the semantics of priority values in stanza processing within instant messaging and presence applications, refer to <a class='info' href='#rules'>Server Rules for Processing XML Stanzas<span> (</span><span class='info'>Server Rules for Processing XML Stanzas</span><span>)</span></a>.
</p>
<a name="presence-extended"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7.6"></a><h3>4.7.6.&nbsp;
Extended Content</h3>

<p>As described in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>, an XML stanza MAY contain any properly-namespaced child element; this applies to the presence stanza as well.
</p>
<p>(In the following example, the presence stanza includes entity capabilities information as defined in <a class='info' href='#XEP-0115'>[XEP&#8209;0115]<span> (</span><span class='info'>Hildebrand, J., Saint-Andre, P., and R. Tron&#xE7;on, &ldquo;Entity Capabilities,&rdquo; August&nbsp;2007.</span><span>)</span></a>).)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;presence from='romeo@example.net'&gt;
  &lt;c xmlns='http://jabber.org/protocol/caps'
     node='http://psi-im.org/caps'
     ver='0.11'/&gt;
&lt;/presence&gt;
</pre></div>
<p>Any extended content included in a presence stanza SHOULD represent aspects of an entity's availability for communication or provide information about communication-related capabilities.
</p>
<a name="message"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Exchanging Messages</h3>

<p>Once a client has authenticated with a server and bound a resource to an XML stream as described in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>, an XMPP server will route XML stanzas to and from that client (if, that is, messaging functionality is enabled and the server is not a presence-only service).  One kind of stanza that may be exchanged is &lt;message/&gt;.  Exchanging messages is a basic use of XMPP and occurs when a user generates a message stanza that is addressed to another entity.  As defined under <a class='info' href='#rules'>Server Rules for Processing XML Stanzas<span> (</span><span class='info'>Server Rules for Processing XML Stanzas</span><span>)</span></a>, the sender's server is responsible for delivering the message to the intended recipient (if the recipient is on the same server) or for routing the message to the recipient's server (if the recipient is on a different server).  Thus a message stanza is used to "push" information to another entity.
</p>
<p>As noted under <a class='info' href='#presence-directed'>Section&nbsp;4.6<span> (</span><span class='info'>Directed Presence</span><span>)</span></a>, if a user exchanges messages with another entity but does not share presence with the entity based on a presence subscription, it is RECOMMENDED for the user's client to send directed presence to the other entity.
</p>
<p>The following sections describe the syntax of the &lt;message/&gt; stanza.
</p>
<a name="message-attributes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Attributes</h3>

<a name="message-attributes-to"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
To Attribute</h3>

<p>An instant messaging client SHOULD specify an intended recipient for a message by providing the JID of an entity other than the sender in the 'to' attribute of the &lt;message/&gt; stanza.
</p>
<p>If the message is being sent outside the context of any existing chat session or received message, the value of the 'to' address SHOULD be of the form &lt;user@domain&gt; rather than of the form &lt;user@domain/resource&gt;.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message
    from='juliet@example.com/balcony'
    to='romeo@example.net'
    type='chat'
    xml:lang='en'&gt;
  &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
&lt;/message&gt;
</pre></div>
<p>If the message is being sent in reply to a message previously received from an address of the form &lt;user@domain/resource&gt; (e.g., within the context of a chat session), the value of the 'to' address SHOULD be of the form &lt;user@domain/resource&gt; rather than of the form &lt;user@domain&gt; unless the sender has knowledge (via presence) that the intended recipient's resource is no longer available.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message
    from='romeo@example.net/orchard'
    to='juliet@example.com/balcony'
    type='chat'
    xml:lang='en'&gt;
  &lt;body&gt;Neither, fair saint, if either thee dislike.&lt;/body&gt;
&lt;/message&gt;
</pre></div>
<a name="message-attributes-type"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
Type Attribute</h3>

<p>Common uses of the message stanza in instant messaging applications include single messages, messages sent in the context of a chat conversation, messages sent in the context of a multi-user chat room, headlines and other alerts, and errors.  These uses are differentiated via the 'type' attribute.  Inclusion of the 'type' attribute is RECOMMENDED.  If included, the 'type' attribute MUST have one of the following values:
</p>
<p>
        </p>
<ul class="text">
<li>chat -- The message is sent in the context of a one-to-one chat session.  A receiving client SHOULD present the message in an interface enabling one-to-one chat between the two parties, including an appropriate conversation history.  Detailed recommendations regarding chat sessions are provided under <a class='info' href='#message-chat'>Section&nbsp;5.4<span> (</span><span class='info'>One-to-One Chat Sessions</span><span>)</span></a>.
</li>
<li>error -- The message is generated by an entity that experiences an error in processing a message received from another entity (for details regarding stanza error syntax, refer to <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>).  A client that receives a message of type "error" SHOULD present an appropriate interface informing the sender of the nature of the error.
</li>
<li>groupchat -- The message is sent in the context of a multi-user chat environment (similar to that of <a class='info' href='#IRC'>[IRC]<span> (</span><span class='info'>Kalt, C., &ldquo;Internet Relay Chat: Architecture,&rdquo; April&nbsp;2000.</span><span>)</span></a>).  A receiving client SHOULD present the message in an interface enabling many-to-many chat between the parties, including a roster of parties in the chatroom and an appropriate conversation history.  Full definition of XMPP-based groupchat protocols is out of scope for this document (for details, refer to <a class='info' href='#XEP-0045'>[XEP&#8209;0045]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Multi-User Chat,&rdquo; April&nbsp;2007.</span><span>)</span></a>).
</li>
<li>headline -- The message is probably generated by an automated service that delivers or broadcasts content (news, sports, market information, syndicated content, alerts, etc.), or the sender wishes the message to be delivered as if it were so generated.  No reply to the message is expected, and a receiving client SHOULD present the message in an interface that appropriately differentiates the message from standalone messages, chat sessions, or groupchat sessions (e.g., by not providing the recipient with the ability to reply).  The receiving server SHOULD deliver the message to all of the recipient's available resources.
</li>
<li>normal -- The message is a standalone message that is sent outside the context of a one-to-one conversation or groupchat, and to which it is expected that the recipient will reply.  A receiving client SHOULD present the message in an interface enabling the recipient to reply, but without a conversation history.  This is the default value of the 'type' attribute.
</li>
</ul><p>
      
</p>
<p>An IM application SHOULD support all of the foregoing message types.  If an application receives a message with no 'type' attribute or the application does not understand the value of the 'type' attribute provided, it MUST consider the message to be of type "normal" (i.e., "normal" is the default).
</p>
<p>Although the 'type' attribute is OPTIONAL, it is considered polite to mirror the type in any replies to a message; furthermore, some specialized applications (e.g., a multi-user chat service) MAY at their discretion enforce the use of a particular message type (e.g., type='groupchat').
</p>
<a name="message-elements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Child Elements</h3>

<p>An XMPP message stanza MAY contain any allowable child elements qualified by the 'jabber:client' (or 'jabber:server') namespace, as well as any other properly-namespaced child element that consists of extended content.  The defined payloads are described in the following sections and extended content payloads are described in the appropriate XMPP extension specifications (not herein).
</p>
<a name="message-elements-body"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
Body</h3>

<p>The &lt;body/&gt; element contains human-readable XML character data that specifies the textual contents of the message; this child element is normally included but is OPTIONAL.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message
    to='romeo@example.net'
    from='juliet@example.com/balcony'
    type='chat'
    xml:lang='en'&gt;
  &lt;body&gt;Wherefore art thou, Romeo?&lt;/body&gt;
&lt;/message&gt;
</pre></div>
<p>The &lt;body/&gt; element MUST NOT possess any attributes, with the exception of the 'xml:lang' attribute.  Multiple instances of the &lt;body/&gt; element MAY be included in a message stanza, but only if each instance possesses an 'xml:lang' attribute with a distinct language value (either explicitly or by inheritance from the 'xml:lang' value of an element farther up in the XML hierarchy, which may include the XML stream header as described in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message
    to='romeo@example.net'
    from='juliet@example.com/balcony'
    type='chat'
    xml:lang='en'&gt;
  &lt;body&gt;Wherefore art thou, Romeo?&lt;/body&gt;
  &lt;body xml:lang='cs'&gt;
     Pro&amp;#x010D;e&amp;#x017D; jsi ty, Romeo?
   &lt;/body&gt;
&lt;/message&gt;
</pre></div>
<p>The &lt;body/&gt; element MUST NOT contain mixed content (as defined in Section 3.2.2 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>).
</p>
<a name="message-elements-subject"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
Subject</h3>

<p>The &lt;subject/&gt; element contains human-readable XML character data that specifies the topic of the message.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message
    to='romeo@example.net'
    from='juliet@example.com/balcony'
    type='chat'
    xml:lang='en'&gt;
  &lt;subject&gt;I implore you!&lt;/subject&gt;
  &lt;body&gt;Wherefore art thou, Romeo?&lt;/body&gt;
&lt;/message&gt;
</pre></div>
<p>The &lt;subject/&gt; element MUST NOT possess any attributes, with the exception of the 'xml:lang' attribute.  Multiple instances of the &lt;subject/&gt; element MAY be included for the purpose of providing alternate versions of the same subject, but only if each instance possesses an 'xml:lang' attribute with a distinct language value (either explicitly or by inheritance from the 'xml:lang' value of an element farther up in the XML hierarchy, which may include the XML stream header as described in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message
    to='romeo@example.net'
    from='juliet@example.com/balcony'
    type='chat'
    xml:lang='en'&gt;
  &lt;subject&gt;I implore you!&lt;/subject&gt;
  &lt;subject xml:lang='cs'&gt;
    &amp;#x00DA;p&amp;#x011B;nliv&amp;#x011B; pros&amp;#x00EDm!
  &lt;/subject&gt;
  &lt;body&gt;Wherefore art thou, Romeo?&lt;/body&gt;
  &lt;body xml:lang='cs'&gt;
     Pro&amp;#x010D;e&amp;#x017E; jsi ty, Romeo?
   &lt;/body&gt;
&lt;/message&gt;
</pre></div>
<p>The &lt;subject/&gt; element MUST NOT contain mixed content (as defined in Section 3.2.2 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>).
</p>
<a name="message-elements-thread"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
Thread</h3>

<p>The primary use of the XMPP &lt;thread/&gt; element is to uniquely identify a conversation thread or "chat session" between two entities instantiated by &lt;message/&gt; stanzas of type 'chat'.  However, the XMPP &lt;thread/&gt; element may also be used to uniquely identify an analogous thread between two entities instantiated by &lt;message/&gt; stanzas of type 'headline' or 'normal', or among multiple entities in the context of a multi-user chat room instantiated by &lt;message/&gt; stanzas of type 'groupchat'. It may also be used for &lt;message/&gt; stanzas not related to a conversation, such as a game session or between plugins.  The &lt;thread/&gt; element is not used to identify individual messages, only conversations.
</p>
<p>The inclusion of the &lt;thread/&gt; element is OPTIONAL.  Because the &lt;thread/&gt; element uniquely identifies the particular conversation thread to which a message belongs, a message stanza MUST NOT contain more than one &lt;thread/&gt; element.
</p>
<p>The value of the &lt;thread/&gt; element is not human-readable and MUST be treated as opaque by entities; no semantic meaning may be derived from it, and only exact comparisons may be made against it.  The value of the &lt;thread/&gt; element MUST be a universally unique identifier (UUID) as described in <a class='info' href='#UUID'>[UUID]<span> (</span><span class='info'>Leach, P., Mealling, M., and R. Salz, &ldquo;A Universally Unique IDentifier (UUID) URN Namespace,&rdquo; July&nbsp;2005.</span><span>)</span></a>.
</p>
<p>The &lt;thread/&gt; element MAY possess a 'parent' attribute that identifies another thread of which the current thread is an offshoot or child; the value of the 'parent' MUST conform to the syntax of the &lt;thread/&gt; element itself.  The &lt;thread/&gt; element MUST NOT contain mixed content (as defined in Section 3.2.2 of <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fourth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message
    to='romeo@example.net'
    from='juliet@example.com/balcony'
    type='chat'
    xml:lang='en'&gt;
  &lt;subject&gt;I implore you!&lt;/subject&gt;
  &lt;subject xml:lang='cs'&gt;
    &amp;#x00DA;p&amp;#x011B;nliv&amp;#x011B; pros&amp;#x00EDm!
  &lt;/subject&gt;
  &lt;body&gt;Wherefore art thou, Romeo?&lt;/body&gt;
  &lt;body xml:lang='cs'&gt;
     Pro&amp;#x010D;e&amp;#x017E; jsi ty, Romeo?
  &lt;/body&gt;
  &lt;thread parent='e0ffe42b28561960c6b12b944a092794b9683a38'&gt;
    0e3141cd80894871a68e6fe6b1ec56fa
  &lt;/thread&gt;
&lt;/message&gt;
</pre></div>
<p>For detailed recommendations regarding use of the &lt;thread/&gt; element, refer to <a class='info' href='#XEP-0201'>[XEP&#8209;0201]<span> (</span><span class='info'>Saint-Andre, P., Paterson, I., and K. Smith, &ldquo;Best Practices for Message Threads,&rdquo; August&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="message-elements-extended"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Extended Content</h3>

<p>As described in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>, an XML stanza MAY contain any properly-namespaced child element; this applies to the message stanza as well.
</p>
<p>(In the following example, the message stanza includes an XHTML-formatted version of the message as defined in <a class='info' href='#XEP-0071'>[XEP&#8209;0071]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;XHTML-IM,&rdquo; August&nbsp;2007.</span><span>)</span></a>).)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;message
    to='romeo@example.net'
    from='juliet@example.com/balcony'
    type='chat'
    xml:lang='en'&gt;
  &lt;body&gt;Wherefore art thou, Romeo?&lt;/body&gt;
  &lt;html xmlns='http://jabber.org/protocol/xhtml-im'&gt;
    &lt;body xmlns='http://www.w3.org/1999/xhtml'&gt;
      Wherefore &lt;span style='font-style: italic'&gt;art&lt;/span&gt;
      thou, &lt;span style='color:red'&gt;Romeo&lt;/span&gt;?
    &lt;/body&gt;
  &lt;/html&gt;
&lt;/message&gt;
</pre></div>
<a name="message-chat"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
One-to-One Chat Sessions</h3>

<p>In practice, instant messaging activity between human users tends to occur in form of a conversational burst that we call <a name='anchor19'></a> a CHAT SESSION: the exchange of at least several messages between two parties in relatively rapid succession within a relatively brief period of time.
</p>
<p>When a human user intends to engage in such a chat session with a contact (rather than sending a single message to which no reply is expected), the user's client SHOULD send a message of type "chat" and the contact's client SHOULD preserve that message type in subsequent replies.   The user's client also SHOULD include a &lt;thread/&gt; element on its initial message, which the contact's client SHOULD also preserve during the life of the chat session.
</p>
<p>The user's client MUST address the initial message in a chat session to the bare JID &lt;contact@domain&gt; (rather than attempting to guess an appropriate full JID &lt;contact@domain/resource&gt;).  Until and unless the user's client receives a reply from the contact, it MUST continue sending any further messages to the contact's bare JID.  The contact's client SHOULD address its subsequent replies to the user's full JID &lt;user@domain/resource&gt; as provided in the 'from' address of the initial message.  Once the user's client receives a reply from the contact's full JID, it SHOULD address its subsequent messages to the contact's full JID as provided in the 'from' address of the contact's replies.
</p>
<p>If a user exchanges messages with a contact but the user does not normally share presence with the contact via a presence subscription, it is RECOMMENDED for the user's client to send directed presence to the contact, subject to user approval (either explicitly for this contact or implicitly via a configuration setting).  If a client supports this feature, it MUST allow the user to disable the feature in order to prevent presence sharing with unknown entities.
</p>
<p>An example of a chat session as described above is provided under <a class='info' href='#session'>Section&nbsp;7<span> (</span><span class='info'>A Sample Session</span><span>)</span></a>.
</p>
<a name="iq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Exchanging IQ Stanzas</h3>

<p>As described in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>, IQ stanzas provide a structured request-response mechanism.  The basic semantics of that mechanism (e.g., that the 'id' attribute is required) are defined in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>, whereas the specific semantics required to complete particular use cases are defined in all cases by the extended namespace that qualifies the direct child element of an IQ stanza of type "get" or "set".  The 'jabber:client' and 'jabber:server' namespaces do not define any children of IQ stanzas other than the &lt;error/&gt; common to all stanza types.  This document defines one such extended namespace, for <a class='info' href='#roster'>Managing the Roster<span> (</span><span class='info'>Managing the Roster</span><span>)</span></a>.  However, an IQ stanza MAY contain structured information qualified by any extended namespace.
</p>
<p>As noted under <a class='info' href='#presence-directed'>Section&nbsp;4.6<span> (</span><span class='info'>Directed Presence</span><span>)</span></a>, if a user exchanges IQ stanzas with another entity but does not share presence with the entity based on a presence subscription, it is RECOMMENDED for the user's client to send directed presence to the other entity.
</p>
<a name="session"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
A Sample Session</h3>

<p>The examples in this section illustrate a possible instant messaging and presence session.  The user is romeo@example.net, he has an available resource whose resource identifier is "orchard", and he has the following individuals in his roster:
</p>
<p></p>
<ul class="text">
<li>juliet@example.com (subscription="both" and she has two available resources, one whose resource identifier is "chamber" and another whose resource identifier is "balcony")
</li>
<li>benvolio@example.org (subscription="to")
</li>
<li>mercutio@example.org (subscription="from")
</li>
</ul>

<p>First, the user completes the preconditions (stream establishment, TLS and SASL negotiation, and resource binding) described in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>; those protocol flows are not reproduced here.
</p>
<p>Next, the user requests his roster.
</p>
<p>Example 1: User requests current roster from server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UC: &lt;iq from='romeo@example.net/balcony' type='get' id='ex1'&gt;
      &lt;query xmlns='jabber:iq:roster'/&gt;
    &lt;/iq&gt;
</pre></div>
<p>Example 2: User receives roster from server:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;iq to='romeo@example.net/balcony' type='result' id='ex1'&gt;
      &lt;query xmlns='jabber:iq:roster'&gt;
        &lt;item jid='romeo@example.com'
              name='Juliet'
              subscription='both'&gt;
          &lt;group&gt;Friends&lt;/group&gt;
        &lt;/item&gt;
        &lt;item jid='benvolio@example.org'
              name='Benvolio'
              subscription='to'/&gt;
        &lt;item jid='mercutio@example.org'
              name='Mercutio'
              subscription='from'/&gt;
      &lt;/query&gt;
    &lt;/iq&gt;
</pre></div>
<p>Now the user begins a presence session.
</p>
<p>Example 3: User sends initial presence:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UC: &lt;presence from='romeo@example.net/orchard'/&gt;
</pre></div>
<p>Example 4: User's server sends presence probes to contacts with subscription="to" and subscription="both" on behalf of the user's available resource:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence
        type='probe'
        from='romeo@example.net/orchard'
        to='juliet@example.com'/&gt;

US: &lt;presence
        type='probe'
        from='romeo@example.net/orchard'
        to='benvolio@example.org'/&gt;
</pre></div>
<p>Example 5: User's server sends initial presence to contacts with subscription="from" and subscription="both" on behalf of the user's available resource:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence
        from='romeo@example.net/orchard'
        to='juliet@example.com'/&gt;

US: &lt;presence
        from='romeo@example.net/orchard'
        to='mercutio@example.org'/&gt;
</pre></div>
<p>Example 6: Contacts' servers reply to presence probe on behalf of all available resources:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;presence
        from='juliet@example.com/balcony'
        to='romeo@example.net/orchard'
        xml:lang='en'&gt;
      &lt;show&gt;away&lt;/show&gt;
      &lt;status&gt;be right back&lt;/status&gt;
      &lt;priority&gt;0&lt;/priority&gt;
    &lt;/presence&gt;

CS: &lt;presence
        from='juliet@example.com/chamber'
        to='romeo@example.net/orchard'&gt;
      &lt;priority&gt;1&lt;/priority&gt;
    &lt;/presence&gt;

CS: &lt;presence
        from='benvolio@example.org/pda'
        to='romeo@example.net/orchard'
        xml:lang='en'&gt;
      &lt;show&gt;dnd&lt;/show&gt;
      &lt;status&gt;gallivanting&lt;/status&gt;
    &lt;/presence&gt;
</pre></div>
<p>Example 7: Contacts' servers deliver user's initial presence to all available resources or return unsubscribed to user:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;presence
        from='romeo@example.net/orchard'
        to='juliet@example.com'/&gt;

CS: &lt;presence
        from='romeo@example.net/orchard'
        to='juliet@example.com'/&gt;

CS: &lt;presence
        from='mercutio@example.org'
        to='romeo@example.net'
        type='unsubscribed'/&gt;
</pre></div>
<p>Example 8: User sends directed presence to another user not in his roster:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UC: &lt;presence
        from='romeo@example.net/orchard'
        to='nurse@example.com'
        xml:lang='en'&gt;
      &lt;show&gt;dnd&lt;/show&gt;
      &lt;status&gt;courting Juliet&lt;/status&gt;
      &lt;priority&gt;0&lt;/priority&gt;
    &lt;/presence&gt;
</pre></div>
<p>Now the user has a chat session with one of his contacts.
</p>
<p>Example 9: A threaded conversation
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CC: &lt;message
        from='juliet@example.com/balcony'
        to='romeo@example.net'
        type='chat'
        xml:lang='en'&gt;
      &lt;body&gt;My ears have not yet drunk a hundred words&lt;/body&gt;
      &lt;thread&gt;e0ffe42b28561960c6b12b944a092794b9683a38&lt;/thread&gt;
    &lt;/message&gt;

CC: &lt;message
        from='juliet@example.com/balcony'
        to='romeo@example.net'
        type='chat'
        xml:lang='en'&gt;
      &lt;body&gt;Of that tongue's utterance, yet I know the sound:&lt;/body&gt;
      &lt;thread&gt;e0ffe42b28561960c6b12b944a092794b9683a38&lt;/thread&gt;
    &lt;/message&gt;

CC: &lt;message
        from='juliet@example.com/balcony'
        to='romeo@example.net'
        type='chat'
        xml:lang='en'&gt;
      &lt;body&gt;Art thou not Romeo, and a Montague?&lt;/body&gt;
      &lt;thread&gt;e0ffe42b28561960c6b12b944a092794b9683a38&lt;/thread&gt;
    &lt;/message&gt;

UC: &lt;message
        from='romeo@example.net/orchard'
        to='juliet@example.com/balcony'
        type='chat'
        xml:lang='en'&gt;
      &lt;body&gt;Neither, fair saint, if either thee dislike.&lt;/body&gt;
      &lt;thread&gt;e0ffe42b28561960c6b12b944a092794b9683a38&lt;/thread&gt;
    &lt;/message&gt;

CC: &lt;message
        from='juliet@example.com/balcony'
        to='romeo@example.net/orchard'
        type='chat'
        xml:lang='en'&gt;
      &lt;body&gt;How cam'st thou hither, tell me, and wherefore?&lt;/body&gt;
      &lt;thread&gt;e0ffe42b28561960c6b12b944a092794b9683a38&lt;/thread&gt;
    &lt;/message&gt;
</pre></div>
<p>And so on.
</p>
<p>The user can also send subsequent broadcasted presence.
</p>
<p>Example 10: User sends updated available presence for broadcasting:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UC: &lt;presence xml:lang='en'&gt;
      &lt;show&gt;away&lt;/show&gt;
      &lt;status&gt;I shall return!&lt;/status&gt;
      &lt;priority&gt;1&lt;/priority&gt;
    &lt;/presence&gt;
</pre></div>
<p>Example 11: User's server broadcasts updated presence only to one contact:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence
        from='romeo@example.net/orchard'
        to='juliet@example.com'
        xml:lang='en'&gt;
      &lt;show&gt;away&lt;/show&gt;
      &lt;status&gt;I shall return!&lt;/status&gt;
      &lt;priority&gt;1&lt;/priority&gt;
    &lt;/presence&gt;
</pre></div>
<p>Example 12: Contact's server delivers updated presence to all of the contact's available resources ("balcony" and "chamber"):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;presence
        from='romeo@example.net/orchard'
        to='juliet@example.com'
        xml:lang='en'&gt;
      &lt;show&gt;away&lt;/show&gt;
      &lt;status&gt;I shall return!&lt;/status&gt;
      &lt;priority&gt;1&lt;/priority&gt;
    &lt;/presence&gt;

CS: &lt;presence
        from='romeo@example.net/orchard'
        to='juliet@example.com'
        xml:lang='en'&gt;
      &lt;show&gt;away&lt;/show&gt;
      &lt;status&gt;I shall return!&lt;/status&gt;
      &lt;priority&gt;1&lt;/priority&gt;
    &lt;/presence&gt;
</pre></div>
<p>Example 13: One of the contact's resources broadcasts unavailable presence:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CC: &lt;presence from='juliet@example.com/chamber' type='unavailable'/&gt;
</pre></div>
<p>Example 14: Contact's server sends unavailable presence to user:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CS: &lt;presence
        type='unavailable'
        from='juliet@example.com/chamber'
        to='romeo@example.net'/&gt;
</pre></div>
<p>Now the user ends his presence session.
</p>
<p>Example 15: User sends unavailable presence:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UC: &lt;presence from='romeo@example.net/orchard'
              type='unavailable'
              xml:lang='en'&gt;
      &lt;status&gt;gone home&lt;/status&gt;
    &lt;/presence&gt;
</pre></div>
<p>Example 16: User's server broadcasts unavailable presence to contact as well as to the person to whom the user sent directed presence:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;presence
        type='unavailable'
        from='romeo@example.net/orchard'
        to='juliet@example.com'
        xml:lang='en'&gt;
      &lt;status&gt;gone home&lt;/status&gt;
    &lt;/presence&gt;

US: &lt;presence
        type='unavailable'
        from='romeo@example.net/orchard'
        to='nurse@example.com'
        xml:lang='en'&gt;
      &lt;status&gt;gone home&lt;/status&gt;
    &lt;/presence&gt;
</pre></div>
<p>Finally the user closes his stream and the server responds in kind.
</p>
<p>Example 17: User closes stream:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UC: &lt;/stream:stream&gt;
</pre></div>
<p>Example 18: User's server closes stream:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
US: &lt;/stream:stream&gt;
</pre></div>
<p>THE END
</p>
<a name="rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Server Rules for Processing XML Stanzas</h3>

<p>Basic server rules for processing XML stanzas are defined in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>.  This section defines supplementary rules for XMPP instant messaging and presence servers; in the absence of a supplementary rule defined below (e.g., for stanzas without a 'to' address), the rule defined in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a> shall apply.
</p>
<a name="rules-nosuchuser"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
No Such User</h3>

<p>If the user account does not exist, how the stanza shall be processed depends on the stanza type.
</p>
<p>
        </p>
<ul class="text">
<li>For an IQ stanza, the server MUST return a &lt;service-unavailable/&gt; stanza error to the sender.
</li>
<li>For a message stanza, the server SHOULD return a &lt;service-unavailable/&gt; stanza error to the sender.
</li>
<li>For a presence stanza with no 'type' attribute or a 'type' attribute of "unavailable", the server SHOULD silently ignore the stanza (i.e., not return an error or a presence stanza of type "unsubscribed").
</li>
<li>For a presence stanza of type "subscribe", "subscribed", "unsubscribe", or "unsubscribed", the server MUST follow the guidelines provided under <a class='info' href='#sub'>Section&nbsp;3<span> (</span><span class='info'>Managing Presence Subscriptions</span><span>)</span></a>.
</li>
</ul><p>
      
</p>
<a name="rules-fulljid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Full JID at Local Domain</h3>

<p>If the hostname of the domain identifier portion of the JID contained in the 'to' attribute of an inbound stanza matches one of the configured hostnames of the server itself and the JID contained in the 'to' attribute is of the form &lt;user@domain/resource&gt;, the server MUST adhere to the following rules.
</p>
<a name="rules-fulljid-availmatch"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.1"></a><h3>8.2.1.&nbsp;
Available Resource Matches</h3>

<p>If an available resource exactly matches the full JID, the recipient's server MUST deliver the stanza to that resource (subject to appropriate security policies as described under <a class='info' href='#security'>Section&nbsp;11<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> and in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>).
</p>
<p>However, for IQ stanzas of type "get" or "set", if the intended recipient does not share presence with the requesting entity either by means of a presence subscription of type "both" or "from" or by means of directed presence, then the server SHOULD NOT deliver the IQ stanza but instead SHOULD return a &lt;service-unavailable/&gt; stanza error to the requesting entity.  This policy helps to prevent presence leaks (see <a class='info' href='#security'>Section&nbsp;11<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>).
</p>
<a name="rules-fulljid-availnomatch"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.2"></a><h3>8.2.2.&nbsp;
No Available Resource Matches</h3>

<p>If no connected or available resource exactly matches the full JID, how the stanza shall be processed depends on the stanza type.
</p>
<p>
          </p>
<ul class="text">
<li>For a message, the server SHOULD treat the stanza as if it were addressed to &lt;user@domain&gt; as described in the next section.
</li>
<li>For a presence stanza with no 'type' attribute or a 'type' attribute of "unavailable", the server SHOULD silently ignore the stanza (i.e., not return an error or a presence stanza of type "unsubscribed").
</li>
<li>For a presence stanza of type "subscribe", "subscribed", "unsubscribe", or "unsubscribed", the server MUST follow the guidelines provided under <a class='info' href='#sub'>Section&nbsp;3<span> (</span><span class='info'>Managing Presence Subscriptions</span><span>)</span></a>.
</li>
<li>For an IQ stanza, the server MUST return a &lt;service-unavailable/&gt; stanza error to the sender.
</li>
</ul><p>
        
</p>
<a name="rules-barejid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Bare JID at Local Domain</h3>

<p>If the hostname of the domain identifier portion of the JID contained in the 'to' attribute of an inbound stanza matches one of the configured hostnames of the server itself and the JID contained in the 'to' attribute is of the form &lt;user@domain&gt;, the server MUST adhere to the following rules.
</p>
<a name="rules-barejid-availyes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.1"></a><h3>8.3.1.&nbsp;
Available Resources</h3>

<p>If there is at least one available resource, how the stanza shall be processed depends on the stanza type.
</p>
<a name="rules-barejid-availyes-message"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.1.1"></a><h3>8.3.1.1.&nbsp;
Message</h3>

<p>For a message stanza of type "headline", the server SHOULD deliver the stanza to all available resources.
</p>
<p>For a message stanza of type "chat", "error", "groupchat", or "normal", the server SHOULD deliver the stanza to the highest-priority available resource. If there is not one highest-priority available resource but instead the highest priority is asserted by two or more available resources, these resources are said to form a "delivery tie".  In the case of a delivery tie, a server SHOULD deliver the message to all of the tied resources.  However, before delivering the message, a server MAY remove one or more resources from the tie.  Methods for doing so are outside the scope of this specification, but could include factors such as the resource's time of connection, time of last network or application activity, availability as determined by some hierarchy of &lt;show/&gt; values, or user-configured rules.  Nevertheless, a server MUST NOT remove all resources from the tie, and MUST deliver the message to at least one of the highest-priority resources (subject to appropriate security policies as described under <a class='info' href='#security'>Section&nbsp;11<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> and in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>).
</p>
<p>However, for any message type the server MUST NOT deliver the stanza to any available resource with a negative priority; if the only available resource has a negative priority, the server SHOULD handle the message as if there were no available resources as described under <a class='info' href='#rules-barejid-availno'>Section&nbsp;8.3.2<span> (</span><span class='info'>No Available Resources</span><span>)</span></a>.
</p>
<p>In all cases, the server MUST NOT rewrite the 'to' attribute (i.e., it MUST leave it as &lt;user@domain&gt; rather than change it to &lt;user@domain/resource&gt;).
</p>
<a name="rules-barejid-availyes-pres"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.1.2"></a><h3>8.3.1.2.&nbsp;
Presence</h3>

<p>For a presence stanza of type "probe", the server MUST handle it directly as described under <a class='info' href='#presence-probe'>Section&nbsp;4.3<span> (</span><span class='info'>Presence Probes</span><span>)</span></a>.
</p>
<p>For a presence stanza with no type or of type "unavailable", the server MUST deliver the stanza to all available resources.
</p>
<p>For a presence stanza of type "subscribe", "subscribed", "unsubscribe", or "unsubscribed", the server MUST adhere to the rules defined under <a class='info' href='#sub'>Section&nbsp;3<span> (</span><span class='info'>Managing Presence Subscriptions</span><span>)</span></a> and summarized under <a class='info' href='#substates'>Appendix&nbsp;A<span> (</span><span class='info'>Subscription States</span><span>)</span></a>.
</p>
<p>In all cases, the server MUST NOT rewrite the 'to' attribute (i.e., it MUST leave it as &lt;user@domain&gt; rather than change it to &lt;user@domain/resource&gt;).
</p>
<a name="rules-barejid-availyes-iq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.1.3"></a><h3>8.3.1.3.&nbsp;
IQ</h3>

<p>For an IQ stanza, the server itself MUST reply on behalf of the user with either an IQ result or an IQ error, and MUST NOT deliver the IQ stanza to any of the user's available resources.  Specifically, if the semantics of the qualifying namespace define a reply that the server can provide on behalf of the user, the server MUST reply to the stanza on behalf of the user by returning either an IQ stanza of type "result" or an IQ stanza of type "error" that is appropriate to the original payload; if not, the server MUST reply with a &lt;service-unavailable/&gt; stanza error.
</p>
<a name="rules-barejid-availno"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.2"></a><h3>8.3.2.&nbsp;
No Available Resources</h3>

<p>If there are no available resources associated with the user, how the stanza shall be processed depends on the stanza type.
</p>
<a name="rules-barejid-availno-message"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.2.1"></a><h3>8.3.2.1.&nbsp;
Message</h3>

<p>In order to properly handle message stanzas, it is strongly RECOMMENDED for an implementation to support <a name='anchor20'></a>, i.e., the server SHOULD store the stanza on behalf of the user and deliver it when the user next becomes available.  For recommendations regarding offline message storage refer to <a class='info' href='#XEP-0160'>[XEP&#8209;0160]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Best Practices for Handling Offline Messages,&rdquo; January&nbsp;2006.</span><span>)</span></a>.
</p>
<p>For a message stanza of type "chat", "groupchat", or "normal", the server SHOULD add the message to offline storage or forward the message to the user via a non-XMPP messaging system (e.g., to the user's email account).  However, if offline message storage or message forwarding is not enabled, the server SHOULD return a &lt;service-unavailable/&gt; stanza error to the sender.
</p>
<p>For a message stanza of type "headline", the server SHOULD NOT added the message to offline storage but instead SHOULD silently discard the message (i.e., neither deliver it to the intended recipient nor return an error to the sender).
</p>
<p>For a message stanza of type "error", the server MUST NOT added the message to offline storage but instead SHOULD silently discard the message (i.e., neither deliver it to the intended recipient nor return an error to the sender).
</p>
<a name="rules-barejid-availno-pres"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.2.2"></a><h3>8.3.2.2.&nbsp;
Presence</h3>

<p>For a presence stanza with no type or of type "unavailable" or "probe", the server SHOULD silently ignore the stanza by not storing it for later delivery and not replying to it on behalf of the user.
</p>
<p>For a presence stanza of type "subscribe", "subscribed", "unsubscribe", or "unsubscribed", the server MUST adhere to the rules defined under <a class='info' href='#sub'>Section&nbsp;3<span> (</span><span class='info'>Managing Presence Subscriptions</span><span>)</span></a> and summarized under <a class='info' href='#substates'>Appendix&nbsp;A<span> (</span><span class='info'>Subscription States</span><span>)</span></a>.
</p>
<a name="rules-barejid-availno-iq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3.2.3"></a><h3>8.3.2.3.&nbsp;
IQ</h3>

<p>For an IQ stanza, the server itself MUST reply on behalf of the user with either an IQ result or an IQ error.  Specifically, if the semantics of the qualifying namespace define a reply that the server can provide on behalf of the user, the server MUST reply to the stanza on behalf of the user by returning either an IQ stanza of type "result" or an IQ stanza of type "error" that is appropriate to the original payload; if not, the server MUST reply with a &lt;service-unavailable/&gt; stanza error.
</p>
<a name="rules-foreign"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
Foreign Domain</h3>

<p>If the hostname of the domain identifier portion of the address contained in the 'to' attribute of an outbound stanza does not match a configured hostname of the server itself, the server MUST attempt to route the stanza to the foreign domain.  If there exists an active stream between the two peers, the server shall route the stanza over that stream for processing by the peer server.  If not, the server MUST do the following.
</p>
<p>First, resolve the hostname of the foreign domain (or use a cached resolution of the foreign domain to an IP address).  The recommended order of attempted resolutions is as follows:
</p>
<p></p>
<ol class="text">
<li>Attempt to resolve the foreign hostname using a DNS service location record <a class='info' href='#SRV'>[SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> Service of "xmpp-server" and Proto of "tcp", resulting in resource records such as "_xmpp-server._tcp.example.com.", as specified in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</li>
<li>If the "xmpp-server" address record resolution fails, attempt to resolve the "_im" or "_pres" SRV Service as specified in <a class='info' href='#IMP-SRV'>[IMP&#8209;SRV]<span> (</span><span class='info'>Peterson, J., &ldquo;Address Resolution for Instant Messaging and Presence,&rdquo; August&nbsp;2004.</span><span>)</span></a>, using the "_im" Service for &lt;message/&gt; stanzas and the "_pres" Service for &lt;presence/&gt; stanzas (it is up to the implementation how to handle &lt;iq/&gt; stanzas).  This will result in one or more resolutions of the form "_im.&lt;proto&gt;.example.com." or "_pres.&lt;proto&gt;.example.com.", where "&lt;proto&gt;" would be a label registered in the Instant Messaging SRV Protocol Label registry or the Presence SRV Protocol Label registry: either "_xmpp" for an XMPP-aware domain or some other IANA-registered label (e.g., "_simple") for a non-XMPP-aware domain.
</li>
<li>If both SRV address record resolutions fail, attempt to perform a normal IPv4/IPv6 address record resolution to determine the IP address using the "xmpp-server" port of 5269 registered with the IANA, as specified in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</li>
</ol>

<p>If the server cannot resolve the foreign domain, it SHOULD return a &lt;remote-server-not-found/&gt; stanza error.
</p>
<p>Second, negotiate XML streams with the foreign domain by following the process defined in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>.  If the server can resolve the foreign domain but cannot establish streams with the XMPP service at that domain, it SHOULD return a &lt;remote-server-timeout/&gt; stanza error.
</p>
<p>Third, route the stanza to the foreign domain for processing by the peer server.
</p>
<p>Note: Administrators of server deployments are strongly encouraged to keep the _im._xmpp, _pres._xmpp, and _xmpp._tcp SRV records properly synchronized, since different implementations might perform the "_im" and "_pres" lookups before the "xmpp-server" lookup.
</p>
<a name="compliance"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IM and Presence Compliance Requirements</h3>

<p>This section summarizes the specific aspects of the Extensible Messaging and Presence Protocol that MUST be supported by instant messaging and presence servers and clients in order to be considered compliant implementations.  All such applications MUST comply with the requirements specified in <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>.  The text in this section specifies additional compliance requirements for instant messaging and presence servers and clients (the requirements described here supplement but do not supersede the core requirements).
</p>
<p>Note: A server or client MAY support only presence or instant messaging, and is not required to support both if only a presence service or an instant messaging service is desired.
</p>
<a name="compliance-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Servers</h3>

<p>In addition to core server compliance requirements, an instant messaging and presence server MUST additionally support all server-related instant messaging and presence syntax and semantics defined in this document, including:
</p>
<p>
        </p>
<ul class="text">
<li>Presence broadcast on behalf of clients as specified under <a class='info' href='#presence'>Section&nbsp;4<span> (</span><span class='info'>Exchanging Presence Information</span><span>)</span></a>
</li>
<li>Presence subscriptions as specified under <a class='info' href='#sub'>Section&nbsp;3<span> (</span><span class='info'>Managing Presence Subscriptions</span><span>)</span></a>
</li>
<li>Roster storage and management as specified under <a class='info' href='#roster'>Section&nbsp;2<span> (</span><span class='info'>Managing the Roster</span><span>)</span></a>
</li>
<li>IM-specific routing and delivery rules as specified under <a class='info' href='#rules'>Section&nbsp;8<span> (</span><span class='info'>Server Rules for Processing XML Stanzas</span><span>)</span></a>
</li>
</ul><p>
      
</p>
<a name="compliance-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Clients</h3>

<p>In addition to core client compliance requirements, an instant messaging and presence client MUST additionally support the following protocols:
</p>
<p>
        </p>
<ul class="text">
<li>Generation and processing of the IM-specific semantics of XML stanzas as defined by the XML schemas, including the 'type' attribute of message and presence stanzas as well as their child elements (see <a class='info' href='#message'>Section&nbsp;5<span> (</span><span class='info'>Exchanging Messages</span><span>)</span></a> and <a class='info' href='#presence'>Section&nbsp;4<span> (</span><span class='info'>Exchanging Presence Information</span><span>)</span></a>)
</li>
<li>All client-related instant messaging syntax and semantics defined in this document, including presence subscriptions and roster management (see <a class='info' href='#sub'>Section&nbsp;3<span> (</span><span class='info'>Managing Presence Subscriptions</span><span>)</span></a> and <a class='info' href='#roster'>Section&nbsp;2<span> (</span><span class='info'>Managing the Roster</span><span>)</span></a>)
</li>
<li>End-to-end object signing and encryption as defined in <a class='info' href='#XMPP-E2E'>[XMPP&#8209;E2E]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;End-to-End Signing and Object Encryption for the Extensible Messaging and Presence Protocol (XMPP),&rdquo; October&nbsp;2004.</span><span>)</span></a>
</li>
</ul><p>
      
</p>
<p>A client MUST also handle addresses that are encoded as "im:" URIs as specified in <a class='info' href='#CPIM'>[CPIM]<span> (</span><span class='info'>Peterson, J., &ldquo;Common Profile for Instant Messaging (CPIM),&rdquo; August&nbsp;2004.</span><span>)</span></a> and "pres:" URIs as specified in <a class='info' href='#CPP'>[CPP]<span> (</span><span class='info'>Peterson, J., &ldquo;Common Profile for Presence (CPP),&rdquo; August&nbsp;2004.</span><span>)</span></a>, although it MAY do so by removing the "im:" or "pres:" scheme and entrusting address resolution to the server as specified under <a class='info' href='#rules-foreign'>Section&nbsp;8.4<span> (</span><span class='info'>Foreign Domain</span><span>)</span></a>.  A client SHOULD also handle addresses that are encoded as "xmpp:" URIs and IRIs as specified in <a class='info' href='#XMPP-URI'>[XMPP&#8209;URI]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP),&rdquo; July&nbsp;2006.</span><span>)</span></a>.
</p>
<a name="i18n"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Internationalization Considerations</h3>

<p>For internationalization considerations, refer to the relevant section of <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Security Considerations</h3>

<p>Core security considerations for XMPP are defined in the relevant section of <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<p>Additional considerations that apply only to instant messaging and presence applications of XMPP are defined in several places within this document; specifically:
</p>
<p></p>
<ul class="text">
<li>When a server processes an inbound presence stanza of type "probe" whose intended recipient is a user associated with one of the server's hostnames, the server MUST NOT reveal the user's presence if the sender is an entity that is not authorized to receive that information as determined by presence subscriptions (see <a class='info' href='#presence'>Exchanging Presence Information<span> (</span><span class='info'>Exchanging Presence Information</span><span>)</span></a>).
</li>
<li>A user's server MUST NOT leak the user's network availability to entities who are not authorized to know the user's presence, either via an explicit subscription as described herein or via an existing trust relationship (such as presence-enabled user directories within organizations).
</li>
<li>When a server processes an outbound presence stanza with no type or of type "unavailable", it MUST follow the rules defined under <a class='info' href='#presence'>Exchanging Presence Information<span> (</span><span class='info'>Exchanging Presence Information</span><span>)</span></a> in order to ensure that such presence information is not broadcasted to entities that are not authorized to know such information.
</li>
<li>When a server generates an error stanza in response to receiving a stanza for a user who does not exist, the use of the &lt;service-unavailable/&gt; error condition can help protect against dictionary attacks, since this is the same error condition that is returned if, for instance, the namespace of an IQ child element is not understood, or if offline message storage or message forwarding is not enabled for a domain.  However, subtle differences in the exact XML of error stanzas, as well as in the timing with which such errors are returned, can enable an attacker to determine the network presence of a user when more advanced blocking technologies are not used (see for instance <a class='info' href='#XEP-0016'>[XEP&#8209;0016]<span> (</span><span class='info'>Millard, P. and P. Saint-Andre, &ldquo;Privacy Lists,&rdquo; February&nbsp;2007.</span><span>)</span></a>).
</li>
<li>A client MAY ignore the &lt;status/&gt; element when contained in a presence stanza of type "subscribe", "unsubscribe", "subscribed", or "unsubscribed" in order to help prevent "presence subscription spam".
</li>
</ul>

<a name="ref"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
IANA Considerations</h3>

<p>The following sections update the registrations provided in <a class='info' href='#RFC3921'>[RFC3921]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>.
</p>
<p>For a number of related IANA considerations, refer to the relevant section of <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="iana-reg-im"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Instant Messaging SRV Protocol Label Registration</h3>

<p><a class='info' href='#IMP-SRV'>Address Resolution for Instant Messaging and Presence<span> (</span><span class='info'>Peterson, J., &ldquo;Address Resolution for Instant Messaging and Presence,&rdquo; August&nbsp;2004.</span><span>)</span></a> [IMP&#8209;SRV] defines an Instant Messaging SRV Protocol Label registry for protocols that can provide services that conform to the "_im" SRV Service label.  Because XMPP is one such protocol, the IANA registers the "_xmpp" protocol label in the appropriate registry, as follows:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Protocol label:</dt>
<dd>_xmpp
</dd>
<dt>Specification:</dt>
<dd>XXXX
</dd>
<dt>Description:</dt>
<dd>Instant messaging protocol label for the Extensible Messaging and Presence Protocol (XMPP) as defined by XXXX.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@xmpp.org&gt;
</dd>
</dl></blockquote>

<a name="iana-reg-pres"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
Presence SRV Protocol Label Registration</h3>

<p><a class='info' href='#IMP-SRV'>Address Resolution for Instant Messaging and Presence<span> (</span><span class='info'>Peterson, J., &ldquo;Address Resolution for Instant Messaging and Presence,&rdquo; August&nbsp;2004.</span><span>)</span></a> [IMP&#8209;SRV] defines a Presence SRV Protocol Label registry for protocols that can provide services that conform to the "_pres" SRV Service label.  Because XMPP is one such protocol, the IANA registers the "_xmpp" protocol label in the appropriate registry, as follows:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Protocol label:</dt>
<dd>_xmpp
</dd>
<dt>Specification:</dt>
<dd>XXXX
</dd>
<dt>Description:</dt>
<dd>Presence protocol label for the Extensible Messaging and Presence Protocol (XMPP) as defined by XXXX.
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, XMPP Working Group, &lt;xmppwg@xmpp.org&gt;
</dd>
</dl></blockquote>

<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="IMP-REQS">[IMP-REQS]</a></td>
<td class="author-text"><a href="mailto:mday@alum.mit.edu">Day, M.</a>, <a href="mailto:sonuag@microsoft.com">Aggarwal, S.</a>, and <a href="mailto:jesse@intonet.com">J. Vincent</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2779">Instant Messaging / Presence Protocol Requirements</a>,&rdquo; RFC&nbsp;2779, February&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2779.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IMP-SRV">[IMP-SRV]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3861">Address Resolution for Instant Messaging and Presence</a>,&rdquo; RFC&nbsp;3861, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3861.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SRV">[SRV]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P., and <a href="mailto:levone@microsoft.com">L. Esibov</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782, February&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2782.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TERMS">[TERMS]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="UUID">[UUID]</a></td>
<td class="author-text"><a href="mailto:paulle@microsoft.com">Leach, P.</a>, <a href="mailto:michael@refactored-networks.com">Mealling, M.</a>, and <a href="mailto:rsalz@datapower.com">R. Salz</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc4122">A Universally Unique IDentifier (UUID) URN Namespace</a>,&rdquo; RFC&nbsp;4122, July&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4122.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc4122.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc4122.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XML">[XML]</a></td>
<td class="author-text">Paoli, J., Maler, E., Sperberg-McQueen, C., Yergeau, F., and T. Bray, &ldquo;<a href="http://www.w3.org/TR/2006/REC-xml-20060816">Extensible Markup Language (XML) 1.0 (Fourth Edition)</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xml-20060816, August&nbsp;2006 (<a href="http://www.w3.org/TR/2006/REC-xml-20060816">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XML-NAMES">[XML-NAMES]</a></td>
<td class="author-text"><a href="mailto:tbray@textuality.com">Bray, T.</a>, <a href="mailto:dmh@corp.hp.com">Hollander, D.</a>, and <a href="mailto:andrewl@microsoft.com">A. Layman</a>, &ldquo;<a href="http://www.w3.org/TR/REC-xml-names">Namespaces in XML</a>,&rdquo; W3C&nbsp;REC-xml-names, January&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP-CORE">[XMPP-CORE]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-saintandre-rfc3920bis-04.txt">Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; draft-saintandre-rfc3920bis-04 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-saintandre-rfc3920bis-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP-E2E">[XMPP-E2E]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://tools.ietf.org/html/rfc3923">End-to-End Signing and Object Encryption for the Extensible Messaging and Presence Protocol (XMPP)</a>,&rdquo; RFC&nbsp;3923, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3923.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP-URI">[XMPP-URI]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc4622">Internationalized Resource Identifiers (IRIs) and Uniform Resource Identifiers (URIs) for the Extensible Messaging and Presence Protocol (XMPP)</a>,&rdquo; RFC&nbsp;4622, July&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4622.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc4622.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc4622.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CPIM">[CPIM]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3860">Common Profile for Instant Messaging (CPIM)</a>,&rdquo; RFC&nbsp;3860, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3860.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="CPP">[CPP]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3859">Common Profile for Presence (CPP)</a>,&rdquo; RFC&nbsp;3859, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3859.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IMP-MODEL">[IMP-MODEL]</a></td>
<td class="author-text"><a href="mailto:mday@alum.mit.edu">Day, M.</a>, <a href="mailto:jdrosen@dynamicsoft.com">Rosenberg, J.</a>, and <a href="mailto:suga@flab.fujitsu.co.jp">H. Sugano</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2778">A Model for Presence and Instant Messaging</a>,&rdquo; RFC&nbsp;2778, February&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="IRC">[IRC]</a></td>
<td class="author-text">Kalt, C., &ldquo;<a href="http://tools.ietf.org/html/rfc2810">Internet Relay Chat: Architecture</a>,&rdquo; RFC&nbsp;2810, April&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2810.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3921">[RFC3921]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://tools.ietf.org/html/rfc3921">Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence</a>,&rdquo; RFC&nbsp;3921, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3921.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SASL">[SASL]</a></td>
<td class="author-text">Melnikov, A. and K. Zeilenga, &ldquo;<a href="http://tools.ietf.org/html/rfc4422">Simple Authentication and Security Layer (SASL)</a>,&rdquo; RFC&nbsp;4422, June&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4422.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TLS">[TLS]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc4346">The Transport Layer Security (TLS) Protocol Version 1.1</a>,&rdquo; RFC&nbsp;4346, April&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4346.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0016">[XEP-0016]</a></td>
<td class="author-text">Millard, P. and <a href="mailto:stpeter@jabber.org">P. Saint-Andre</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0016.html">Privacy Lists</a>,&rdquo; XSF XEP&nbsp;0016, February&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0045">[XEP-0045]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0045.html">Multi-User Chat</a>,&rdquo; XSF XEP&nbsp;0045, April&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0054">[XEP-0054]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0054.html">vcard-temp</a>,&rdquo; XSF XEP&nbsp;0054, March&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0071">[XEP-0071]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0071.html">XHTML-IM</a>,&rdquo; XSF XEP&nbsp;0071, August&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0115">[XEP-0115]</a></td>
<td class="author-text"><a href="mailto:jhildebrand@jabber.com">Hildebrand, J.</a>, <a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, and <a href="mailto:public@el-tramo.be">R. Tron&#xE7;on</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0115.html">Entity Capabilities</a>,&rdquo; XSF XEP&nbsp;0115, August&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0160">[XEP-0160]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0160.html">Best Practices for Handling Offline Messages</a>,&rdquo; XSF XEP&nbsp;0160, January&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="XEP-0201">[XEP-0201]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, <a href="mailto:ian.paterson@clientside.co.uk">Paterson, I.</a>, and <a href="mailto:kevin@kismith.co.uk">K. Smith</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0201.html">Best Practices for Message Threads</a>,&rdquo; XSF XEP&nbsp;0201, August&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="XML-SCHEMA">[XML-SCHEMA]</a></td>
<td class="author-text">Thompson, H., Maloney, M., Mendelsohn, N., and D. Beech, &ldquo;<a href="http://www.w3.org/TR/2004/REC-xmlschema-1-20041028">XML Schema Part 1: Structures Second Edition</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xmlschema-1-20041028, October&nbsp;2004 (<a href="http://www.w3.org/TR/2004/REC-xmlschema-1-20041028">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="VCARD">[VCARD]</a></td>
<td class="author-text"><a href="mailto:frank_dawson@lotus.com">Dawson, F.</a> and <a href="mailto:howes@netscape.com">T. Howes</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2426">vCard MIME Directory Profile</a>,&rdquo; RFC&nbsp;2426, September&nbsp;1998 (<a href="http://xml.resource.org/public/rfc/html/rfc2426.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2426.xml">XML</a>).</td></tr>
</table>

<a name="substates"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Subscription States</h3>

<p>This section provides detailed information about subscription states and server processing of subscription-related presence stanzas (i.e., presence stanzas of type "subscribe", "subscribed", "unsubscribe", and "unsubscribed").
</p>
<a name="substates-defined"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Defined States</h3>

<p>There are four primary subscription states (note: these states are described from the perspective of the user, not the contact):
</p>
<p>
        </p>
<ul class="text">
<li>None -- the user does not have a subscription to the contact's presence, and the contact does not have a subscription to the user's presence
</li>
<li>To -- the user has a subscription to the contact's presence, but the contact does not have a subscription to the user's presence
</li>
<li>From -- the contact has a subscription to the user's presence, but the user does not have a subscription to the contact's presence
</li>
<li>Both -- both the user and the contact have subscriptions to each other's presence (i.e., the union of 'from' and 'to')
</li>
</ul><p>
      
</p>
<p>These states are supplemented by various pending sub-states to yield nine possible subscription states:
</p>
<p></p>
<ol class="text">
<li>"None" = contact and user are not subscribed to each other, and neither has requested a subscription from the other; this is reflected in the user's roster by subscription='none'
</li>
<li>"None + Pending Out" = contact and user are not subscribed to each other, and user has sent contact a subscription request but contact has not replied yet; this is reflected in the user's roster by subscription='none' and ask='subscribe'
</li>
<li>"None + Pending In" = contact and user are not subscribed to each other, and contact has sent user a subscription request but user has not replied yet (note: contact's server SHOULD NOT push or deliver roster items in this state, but instead SHOULD wait until user has approved subscription request from contact); this is reflected in the user's roster by subscription='none'
</li>
<li>"None + Pending Out+In" = contact and user are not subscribed to each other, contact has sent user a subscription request but user has not replied yet, and user has sent contact a subscription request but contact has not replied yet; this is reflected in the user's roster by subscription='none' and ask='subscribe'
</li>
<li>"To" = user is subscribed to contact (one-way); this is reflected in the user's roster by subscription='to'
</li>
<li>"To + Pending In" = user is subscribed to contact, and contact has sent user a subscription request but user has not replied yet; this is reflected in the user's roster by subscription='to'
</li>
<li>"From" = contact is subscribed to user (one-way); this is reflected in the user's roster by subscription='from'
</li>
<li>"From + Pending Out" = contact is subscribed to user, and user has sent contact a subscription request but contact has not replied yet; this is reflected in the user's roster by subscription='from' and ask='subscribe'
</li>
<li>"Both" = user and contact are subscribed to each other (two-way); this is reflected in the user's roster by subscription='both'
</li>
</ol>

<a name="substates-out"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Server Processing of Outbound Presence Subscription Stanzas</h3>

<p>Outbound presence subscription stanzas enable the user to manage his or her subscription to the contact's presence (via the "subscribe" and "unsubscribe" types), and to manage the contact's access to the user's presence (via the "subscribed" and "unsubscribed" types).
</p>
<p>The following rules apply to outbound routing of the stanza as well as changes to the user's roster.
</p>
<p>Note: The rules for server processing of outbound presence subscription stanzas are described from the perspective of the user, not the contact.
</p>
<p>Note: In the following tables, "S.N." stand for SHOULD NOT.
</p>
<a name="substates-out-subscribe"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2.1"></a><h3>A.2.1.&nbsp;
Subscribe</h3>

<p>Table 1: Processing of outbound "subscribe" stanzas
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+-----------------------------------------------------------------+
|  EXISTING STATE          |  ROUTE?  |  NEW STATE                |
+-----------------------------------------------------------------+
|  "None"                  |  MUST    |  "None + Pending Out" [1] |
|  "None + Pending Out"    |  MUST    |  no state change          |
|  "None + Pending In"     |  MUST    |  "None + Pending Out+In"  |
|  "None + Pending Out+In" |  MUST    |  no state change          |
|  "To"                    |  MUST    |  no state change          |
|  "To + Pending In"       |  MUST    |  no state change          |
|  "From"                  |  MUST    |  "From + Pending Out" [1] |
|  "From + Pending Out"    |  MUST    |  no state change          |
|  "Both"                  |  MUST    |  no state change          |
+-----------------------------------------------------------------+
</pre></div>
<p>[1] A state change to "pending out" includes setting the 'ask' flag to a value of "subscribe" in the user's roster.
</p>
<a name="substates-out-unsubscribe"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2.2"></a><h3>A.2.2.&nbsp;
Unsubscribe</h3>

<p>Table 2: Processing of outbound "unsubscribe" stanzas
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+-----------------------------------------------------------------+
|  EXISTING STATE          |  ROUTE?  |  NEW STATE                |
+-----------------------------------------------------------------+
|  "None"                  |  MUST    |  no state change          |
|  "None + Pending Out"    |  MUST    |  "None"                   |
|  "None + Pending In"     |  MUST    |  no state change          |
|  "None + Pending Out+In" |  MUST    |  "None + Pending In"      |
|  "To"                    |  MUST    |  "None"                   |
|  "To + Pending In"       |  MUST    |  "Pending In"             |
|  "From"                  |  MUST    |  no state change          |
|  "From + Pending Out"    |  MUST    |  "From"                   |
|  "Both"                  |  MUST    |  "From"                   |
+-----------------------------------------------------------------+
</pre></div>
<a name="substates-out-subscribed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2.3"></a><h3>A.2.3.&nbsp;
Subscribed</h3>

<p>Table 3: Processing of outbound "subscribed" stanzas
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+-----------------------------------------------------------------+
|  EXISTING STATE          |  ROUTE?  |  NEW STATE                |
+-----------------------------------------------------------------+
|  "None"                  |  S.N.    |  no state change [1]      |
|  "None + Pending Out"    |  S.N.    |  no state change          |
|  "None + Pending In"     |  MUST    |  "From"                   |
|  "None + Pending Out+In" |  MUST    |  "From + Pending Out"     |
|  "To"                    |  S.N.    |  no state change          |
|  "To + Pending In"       |  MUST    |  "Both"                   |
|  "From"                  |  S.N.    |  no state change          |
|  "From + Pending Out"    |  S.N.    |  no state change          |
|  "Both"                  |  S.N.    |  no state change          |
+-----------------------------------------------------------------+
</pre></div>
<p>[1] A server MAY note the fact that the user wishes to allow the contact to be subscribed to the user's presence and automatically approve any subscription request received from the contact; if it does so, upon the receiving presence stanza of type "subscribed" from the user's client it MUST add a roster item for the contact to the user's roster and set the 'ask' flag to a value of "subscribed".  However, the user's server still SHOULD NOT route the presence stanza of type "subscribed" to the contact.  This optional functionality applies only if the contact is not already in the user's roster or if the contact is in the user's roster with a state of "None" (not including a state of "None + Pending Out").
</p>
<a name="substates-out-unsubscribed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2.4"></a><h3>A.2.4.&nbsp;
Unsubscribed</h3>

<p>Table 4: Processing of outbound "unsubscribed" stanzas
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+-----------------------------------------------------------------+
|  EXISTING STATE          |  ROUTE?  |  NEW STATE                |
+-----------------------------------------------------------------+
|  "None"                  |  S.N.    |  no state change          |
|  "None + Pending Out"    |  S.N.    |  no state change          |
|  "None + Pending In"     |  MUST    |  "None"                   |
|  "None + Pending Out+In" |  MUST    |  "None + Pending Out"     |
|  "To"                    |  S.N.    |  no state change          |
|  "To + Pending In"       |  MUST    |  "To"                     |
|  "From"                  |  MUST    |  "None"                   |
|  "From + Pending Out"    |  MUST    |  "None + Pending Out"     |
|  "Both"                  |  MUST    |  "To"                     |
+-----------------------------------------------------------------+
</pre></div>
<a name="substates-in"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Server Processing of Inbound Presence Subscription Stanzas</h3>

<p>Inbound presence subscription stanzas request a subscription-related action from the user (via the "subscribe" type), inform the user of subscription-related actions taken by the contact (via the "unsubscribe" type), or enable the user to manage the contact's access to the user's presence information (via the "subscribed" and "unsubscribed" types).
</p>
<p>The following rules apply to delivery of the inbound stanza as well as changes to the user's roster.
</p>
<p>Note: The rules for server processing of inbound presence subscription stanzas are described from the perspective of the user, not the contact.
</p>
<p>Note: In the following tables, "S.N." stand for SHOULD NOT.
</p>
<a name="substates-in-subscribe"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3.1"></a><h3>A.3.1.&nbsp;
Subscribe</h3>

<p>Table 5: Processing of inbound "subscribe" stanzas
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+------------------------------------------------------------------+
|  EXISTING STATE          |  DELIVER?  |  NEW STATE               |
+------------------------------------------------------------------+
|  "None"                  |  MUST [1]  |  "None + Pending In"     |
|  "None + Pending Out"    |  MUST      |  "None + Pending Out+In" |
|  "None + Pending In"     |  S.N.      |  no state change         |
|  "None + Pending Out+In" |  S.N.      |  no state change         |
|  "To"                    |  MUST      |  "To + Pending In"       |
|  "To + Pending In"       |  S.N.      |  no state change         |
|  "From"                  |  S.N. [2]  |  no state change         |
|  "From + Pending Out"    |  S.N. [2]  |  no state change         |
|  "Both"                  |  S.N. [2]  |  no state change         |
+------------------------------------------------------------------+
</pre></div>
<p>[1] If the user previously sent presence of type "subscribed" as described under <a class='info' href='#substates-out-subscribed'>Appendix&nbsp;A.2.3<span> (</span><span class='info'>Subscribed</span><span>)</span></a>, then the server MAY auto-reply with "subscribed" and change the state to "From" rather than "None + Pending In".
</p>
<p>[2] Server SHOULD auto-reply with "subscribed".
</p>
<a name="substates-in-unsubscribe"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3.2"></a><h3>A.3.2.&nbsp;
Unsubscribe</h3>

<p>When the user's server receives a presence stanza of type "unsubscribe" for the user from the contact, if the stanza results in a subscription state change from the user's perspective then the user's server MUST change the state and SHOULD auto-reply by sending a presence stanza of type "unsubscribed" to the contact on behalf of the user.  Otherwise the user's server MUST NOT change the state and SHOULD NOT deliver the stanza.  These rules are summarized in the following table.
</p>
<p>Table 6: Processing of inbound "unsubscribe" stanzas
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+------------------------------------------------------------------+
|  EXISTING STATE          |  DELIVER?  |  NEW STATE               |
+------------------------------------------------------------------+
|  "None"                  |  S.N.      |  no state change         |
|  "None + Pending Out"    |  S.N.      |  no state change         |
|  "None + Pending In"     |  S.N. [1]  |  "None"                  |
|  "None + Pending Out+In" |  S.N. [1]  |  "None + Pending Out"    |
|  "To"                    |  S.N.      |  no state change         |
|  "To + Pending In"       |  S.N. [1]  |  "To"                    |
|  "From"                  |  S.N. [1]  |  "None"                  |
|  "From + Pending Out"    |  S.N. [1]  |  "None + Pending Out     |
|  "Both"                  |  S.N. [1]  |  "To"                    |
+------------------------------------------------------------------+
</pre></div>
<p>[1] Server SHOULD auto-reply with "unsubscribed".
</p>
<a name="substates-in-subscribed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3.3"></a><h3>A.3.3.&nbsp;
Subscribed</h3>

<p>When the user's server receives a presence stanza of type "subscribed" for the user from the contact, if there is no pending outbound request for access to the contact's presence information, then it MUST NOT change the subscription state and SHOULD NOT deliver the stanza to the user.  If there is a pending outbound request for access to the contact's presence information and the inbound presence stanza of type "subscribed" results in a subscription state change, then the user's server MUST change the subscription state but SHOULD NOT deliver the stanza to the user.  If the user already has access to the contact's presence information, the inbound presence stanza of type "subscribed" does not result in a subscription state change; therefore the user's server MUST NOT change the subscription state and SHOULD NOT deliver the stanza to the user.  These rules are summarized in the following table.
</p>
<p>Table 7: Processing of inbound "subscribed" stanzas
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+------------------------------------------------------------------+
|  EXISTING STATE          |  DELIVER?  |  NEW STATE               |
+------------------------------------------------------------------+
|  "None"                  |  S.N.      |  no state change         |
|  "None + Pending Out"    |  S.N.      |  "To"                    |
|  "None + Pending In"     |  S.N.      |  no state change         |
|  "None + Pending Out+In" |  S.N.      |  "To + Pending In"       |
|  "To"                    |  S.N.      |  no state change         |
|  "To + Pending In"       |  S.N.      |  no state change         |
|  "From"                  |  S.N.      |  no state change         |
|  "From + Pending Out"    |  S.N.      |  "Both"                  |
|  "Both"                  |  S.N.      |  no state change         |
+------------------------------------------------------------------+
</pre></div>
<a name="substates-in-unsubscribed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3.4"></a><h3>A.3.4.&nbsp;
Unsubscribed</h3>

<p>When the user's server receives a presence stanza of type "unsubscribed" for the user from the contact, if there is a pending outbound request for access to the contact's presence information or if the user currently has access to the contact's presence information, then the user's server MUST change the subscription state but SHOULD NOT deliver the stanza to the user.  Otherwise, the user's server MUST NOT change the subscription state and SHOULD NOT deliver the stanza.  These rules are summarized in the following table.
</p>
<p>Table 8: Processing of inbound "unsubscribed" stanzas
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+------------------------------------------------------------------+
|  EXISTING STATE          |  DELIVER?  |  NEW STATE               |
+------------------------------------------------------------------+
|  "None"                  |  S.N.      |  no state change         |
|  "None + Pending Out"    |  S.N.      |  "None"                  |
|  "None + Pending In"     |  S.N.      |  no state change         |
|  "None + Pending Out+In" |  S.N.      |  "None + Pending In"     |
|  "To"                    |  S.N.      |  "None"                  |
|  "To + Pending In"       |  S.N.      |  "None + Pending In"     |
|  "From"                  |  S.N.      |  no state change         |
|  "From + Pending Out"    |  S.N.      |  "From"                  |
|  "Both"                  |  S.N.      |  "From"                  |
+------------------------------------------------------------------+
</pre></div>
<a name="blocking"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Blocking Communication</h3>

<p>Sections 2.3.5 and 5.4.10 of <a class='info' href='#IMP-REQS'>[IMP&#8209;REQS]<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a> require that a compliant instant messaging and presence technology must enable a user to block communications from selected users.  A protocol for doing so is specified in <a class='info' href='#XEP-0016'>[XEP&#8209;0016]<span> (</span><span class='info'>Millard, P. and P. Saint-Andre, &ldquo;Privacy Lists,&rdquo; February&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="vcard"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
vCards</h3>

<p>Sections 3.1.3 and 4.1.4 of <a class='info' href='#IMP-REQS'>[IMP&#8209;REQS]<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a> require that it be possible to retrieve out-of-band contact information for other users (e.g., telephone number or email address).  An XML representation of the vCard specification defined in <a class='info' href='#VCARD'>RFC 2426<span> (</span><span class='info'>Dawson, F. and T. Howes, &ldquo;vCard MIME Directory Profile,&rdquo; September&nbsp;1998.</span><span>)</span></a> [VCARD] is in common use within the Jabber community to provide such information but is out of scope for XMPP (documentation of this protocol is contained in <a class='info' href='#XEP-0054'>[XEP&#8209;0054]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;vcard-temp,&rdquo; March&nbsp;2003.</span><span>)</span></a>).
</p>
<a name="def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
XML Schemas</h3>

<p>Because validation of XML streams and stanzas is optional, the following XML schemas are provided for descriptive purposes only.  These schemas are not normative.
</p>
<p>The following schemas formally define various XML namespaces used in the core XMPP protocols, in conformance with <a class='info' href='#XML-SCHEMA'>[XML&#8209;SCHEMA]<span> (</span><span class='info'>Thompson, H., Maloney, M., Mendelsohn, N., and D. Beech, &ldquo;XML Schema Part 1: Structures Second Edition,&rdquo; October&nbsp;2004.</span><span>)</span></a>.  For schemas defining namespaces for XML streams and other core aspects of XMPP, refer to <a class='info' href='#XMPP-CORE'>[XMPP&#8209;CORE]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="def-client"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D.1"></a><h3>D.1.&nbsp;
jabber:client</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='jabber:client'
    xmlns='jabber:client'
    elementFormDefault='qualified'&gt;

  &lt;xs:import
      namespace='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;

  &lt;xs:element name='message'&gt;
     &lt;xs:complexType&gt;
        &lt;xs:sequence&gt;
          &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
            &lt;xs:element ref='subject'/&gt;
            &lt;xs:element ref='body'/&gt;
            &lt;xs:element ref='thread'/&gt;
          &lt;/xs:choice&gt;
          &lt;xs:any     namespace='##other'
                      minOccurs='0'
                      maxOccurs='unbounded'/&gt;
          &lt;xs:element ref='error'
                      minOccurs='0'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attribute name='from'
                      type='xs:string'
                      use='optional'/&gt;
        &lt;xs:attribute name='id'
                      type='xs:NMTOKEN'
                      use='optional'/&gt;
        &lt;xs:attribute name='to'
                      type='xs:string'
                      use='optional'/&gt;
        &lt;xs:attribute name='type'
                      use='optional'
                      default='normal'&gt;
          &lt;xs:simpleType&gt;
            &lt;xs:restriction base='xs:NCName'&gt;
              &lt;xs:enumeration value='chat'/&gt;
              &lt;xs:enumeration value='error'/&gt;
              &lt;xs:enumeration value='groupchat'/&gt;
              &lt;xs:enumeration value='headline'/&gt;
              &lt;xs:enumeration value='normal'/&gt;
            &lt;/xs:restriction&gt;
          &lt;/xs:simpleType&gt;
        &lt;/xs:attribute&gt;
        &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
     &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='body'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='subject'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='thread' type='xs:NMTOKEN'/&gt;

  &lt;xs:element name='presence'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
          &lt;xs:element ref='show'/&gt;
          &lt;xs:element ref='status'/&gt;
          &lt;xs:element ref='priority'/&gt;
        &lt;/xs:choice&gt;
        &lt;xs:any     namespace='##other'
                    minOccurs='0'
                    maxOccurs='unbounded'/&gt;
        &lt;xs:element ref='error'
                    minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='from'
                    type='xs:string'
                    use='optional'/&gt;
      &lt;xs:attribute name='id'
                    type='xs:NMTOKEN'
                    use='optional'/&gt;
      &lt;xs:attribute name='to'
                    type='xs:string'
                    use='optional'/&gt;
      &lt;xs:attribute name='type' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='error'/&gt;
            &lt;xs:enumeration value='probe'/&gt;
            &lt;xs:enumeration value='subscribe'/&gt;
            &lt;xs:enumeration value='subscribed'/&gt;
            &lt;xs:enumeration value='unavailable'/&gt;
            &lt;xs:enumeration value='unsubscribe'/&gt;
            &lt;xs:enumeration value='unsubscribed'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='show'&gt;
    &lt;xs:simpleType&gt;
      &lt;xs:restriction base='xs:NCName'&gt;
        &lt;xs:enumeration value='away'/&gt;
        &lt;xs:enumeration value='chat'/&gt;
        &lt;xs:enumeration value='dnd'/&gt;
        &lt;xs:enumeration value='xa'/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:simpleType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='status'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='string1024'&gt;
          &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='string1024'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:minLength value='1'/&gt;
      &lt;xs:maxLength value='1024'/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:element name='priority' type='xs:byte'/&gt;

  &lt;xs:element name='iq'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:any     namespace='##other'
                    minOccurs='0'/&gt;
        &lt;xs:element ref='error'
                    minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='from'
                    type='xs:string'
                    use='optional'/&gt;
      &lt;xs:attribute name='id'
                    type='xs:NMTOKEN'
                    use='required'/&gt;
      &lt;xs:attribute name='to'
                    type='xs:string'
                    use='optional'/&gt;
      &lt;xs:attribute name='type' use='required'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='error'/&gt;
            &lt;xs:enumeration value='get'/&gt;
            &lt;xs:enumeration value='result'/&gt;
            &lt;xs:enumeration value='set'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='error'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence xmlns:err='urn:ietf:params:xml:ns:xmpp-stanzas'&gt;
        &lt;xs:group ref='err:stanzaErrorGroup'/&gt;
        &lt;xs:element ref='err:text'
                    minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='type' use='required'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='auth'/&gt;
            &lt;xs:enumeration value='cancel'/&gt;
            &lt;xs:enumeration value='continue'/&gt;
            &lt;xs:enumeration value='modify'/&gt;
            &lt;xs:enumeration value='wait'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="def-server"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D.2"></a><h3>D.2.&nbsp;
jabber:server</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='jabber:server'
    xmlns='jabber:server'
    elementFormDefault='qualified'&gt;

  &lt;xs:import
      namespace='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;

  &lt;xs:element name='message'&gt;
     &lt;xs:complexType&gt;
        &lt;xs:sequence&gt;
          &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
            &lt;xs:element ref='subject'/&gt;
            &lt;xs:element ref='body'/&gt;
            &lt;xs:element ref='thread'/&gt;
          &lt;/xs:choice&gt;
          &lt;xs:any namespace='##other'
                  minOccurs='0'
                  maxOccurs='unbounded'/&gt;
          &lt;xs:element ref='error'
                      minOccurs='0'/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attribute name='from'
                      type='xs:string'
                      use='required'/&gt;
        &lt;xs:attribute name='id'
                      type='xs:NMTOKEN'
                      use='optional'/&gt;
        &lt;xs:attribute name='to'
                      type='xs:string'
                      use='required'/&gt;
        &lt;xs:attribute name='type'
                      use='optional'
                      default='normal'&gt;
          &lt;xs:simpleType&gt;
            &lt;xs:restriction base='xs:NCName'&gt;
              &lt;xs:enumeration value='chat'/&gt;
              &lt;xs:enumeration value='error'/&gt;
              &lt;xs:enumeration value='groupchat'/&gt;
              &lt;xs:enumeration value='headline'/&gt;
              &lt;xs:enumeration value='normal'/&gt;
            &lt;/xs:restriction&gt;
          &lt;/xs:simpleType&gt;
        &lt;/xs:attribute&gt;
        &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
     &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='body'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='subject'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:string'&gt;
          &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='thread' type='xs:NMTOKEN'/&gt;
  &lt;xs:element name='subject'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='xs:NMTOKEN'&gt;
          &lt;xs:attribute name='parent'
                        type='xs:NMTOKEN'
                        use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='presence'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:choice minOccurs='0' maxOccurs='unbounded'&gt;
          &lt;xs:element ref='show'/&gt;
          &lt;xs:element ref='status'/&gt;
          &lt;xs:element ref='priority'/&gt;
        &lt;/xs:choice&gt;
        &lt;xs:any     namespace='##other'
                    minOccurs='0'
                    maxOccurs='unbounded'/&gt;
        &lt;xs:element ref='error'
                    minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='from'
                    type='xs:string'
                    use='required'/&gt;
      &lt;xs:attribute name='id'
                    type='xs:NMTOKEN'
                    use='optional'/&gt;
      &lt;xs:attribute name='to'
                    type='xs:string'
                    use='required'/&gt;
      &lt;xs:attribute name='type' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='error'/&gt;
            &lt;xs:enumeration value='probe'/&gt;
            &lt;xs:enumeration value='subscribe'/&gt;
            &lt;xs:enumeration value='subscribed'/&gt;
            &lt;xs:enumeration value='unavailable'/&gt;
            &lt;xs:enumeration value='unsubscribe'/&gt;
            &lt;xs:enumeration value='unsubscribed'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='show'&gt;
    &lt;xs:simpleType&gt;
      &lt;xs:restriction base='xs:NCName'&gt;
        &lt;xs:enumeration value='away'/&gt;
        &lt;xs:enumeration value='chat'/&gt;
        &lt;xs:enumeration value='dnd'/&gt;
        &lt;xs:enumeration value='xa'/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:simpleType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='status'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:simpleContent&gt;
        &lt;xs:extension base='string1024'&gt;
          &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
        &lt;/xs:extension&gt;
      &lt;/xs:simpleContent&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:simpleType name='string1024'&gt;
    &lt;xs:restriction base='xs:string'&gt;
      &lt;xs:minLength value='1'/&gt;
      &lt;xs:maxLength value='1024'/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:element name='priority' type='xs:byte'/&gt;

  &lt;xs:element name='iq'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:any namespace='##other'
                minOccurs='0'/&gt;
        &lt;xs:element ref='error'
                    minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='from'
                    type='xs:string'
                    use='required'/&gt;
      &lt;xs:attribute name='id'
                    type='xs:NMTOKEN'
                    use='required'/&gt;
      &lt;xs:attribute name='to'
                    type='xs:string'
                    use='required'/&gt;
      &lt;xs:attribute name='type' use='required'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='error'/&gt;
            &lt;xs:enumeration value='get'/&gt;
            &lt;xs:enumeration value='result'/&gt;
            &lt;xs:enumeration value='set'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute ref='xml:lang' use='optional'/&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='error'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence xmlns:err='urn:ietf:params:xml:ns:xmpp-stanzas'&gt;
        &lt;xs:group ref='err:stanzaErrorGroup'/&gt;
        &lt;xs:element ref='err:text'
                    minOccurs='0'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='type' use='required'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='auth'/&gt;
            &lt;xs:enumeration value='cancel'/&gt;
            &lt;xs:enumeration value='continue'/&gt;
            &lt;xs:enumeration value='modify'/&gt;
            &lt;xs:enumeration value='wait'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="def-roster"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D.3"></a><h3>D.3.&nbsp;
jabber:iq:roster</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version='1.0' encoding='UTF-8'?&gt;

&lt;xs:schema
    xmlns:xs='http://www.w3.org/2001/XMLSchema'
    targetNamespace='jabber:iq:roster'
    xmlns='jabber:iq:roster'
    elementFormDefault='qualified'&gt;

  &lt;xs:element name='query'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='item'
                    minOccurs='0'
                    maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='item'&gt;
    &lt;xs:complexType&gt;
      &lt;xs:sequence&gt;
        &lt;xs:element ref='group'
                    minOccurs='0'
                    maxOccurs='unbounded'/&gt;
      &lt;/xs:sequence&gt;
      &lt;xs:attribute name='ask' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='subscribe'/&gt;
            &lt;xs:enumeration value='subscribed'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
      &lt;xs:attribute name='jid' type='xs:string' use='required'/&gt;
      &lt;xs:attribute name='name' type='xs:string' use='optional'/&gt;
      &lt;xs:attribute name='subscription' use='optional'&gt;
        &lt;xs:simpleType&gt;
          &lt;xs:restriction base='xs:NCName'&gt;
            &lt;xs:enumeration value='both'/&gt;
            &lt;xs:enumeration value='from'/&gt;
            &lt;xs:enumeration value='none'/&gt;
            &lt;xs:enumeration value='remove'/&gt;
            &lt;xs:enumeration value='to'/&gt;
          &lt;/xs:restriction&gt;
        &lt;/xs:simpleType&gt;
      &lt;/xs:attribute&gt;
    &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

  &lt;xs:element name='group' type='xs:string'/&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="diffs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.E"></a><h3>Appendix E.&nbsp;
Differences From RFC 3921</h3>

<p>Based on consensus derived from implementation and deployment experience as well as formal interoperability testing, the following substantive modifications were made from RFC 3921.
</p>
<p>
        </p>
<ul class="text">
<li>The protocol for session establishment was determined to be unnecessary and therefore the content previously defined in Section 3 of RFC 3921 was removed.  However, for the sake of backward-compatibility server implementations are encouraged to advertise support for the feature, even though session establishment is a "no-op".
</li>
<li>The protocol for communications blocking specified in Section 10 of RFC 3921 has been moved to <a class='info' href='#XEP-0016'>[XEP&#8209;0016]<span> (</span><span class='info'>Millard, P. and P. Saint-Andre, &ldquo;Privacy Lists,&rdquo; February&nbsp;2007.</span><span>)</span></a>.
</li>
<li>In order to more seamlessly repair lack of synchronization in subscription states between rosters located at different servers, error handling related to presence probes and presence notifications was modified to return presence stanzas of type "unsubscribe" or "unsubscribed" rather than error stanzas.
</li>
<li>Added optional server support for pre-approved presence subscriptions via presence stanzas of type "subscribed" and the optional "subscribed" value for the 'ask' flag.
</li>
</ul><p>
      
</p>
<p>In addition, numerous changes of an editorial nature were made in order to more fully specify and clearly explain the protocols.
</p>
<a name="copying"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.F"></a><h3>Appendix F.&nbsp;
Copying Conditions</h3>

<p>Regarding this entire document or any portion of it, the author makes no guarantees and is not responsible for any damage resulting from its use.  The author grants irrevocable permission to anyone to use, modify, and distribute it in any way that does not diminish the rights of anyone else to use, modify, and distribute it, provided that redistributed derivative works do not contain misleading author or version information.  Derivative works need not be licensed under similar terms.
</p><a name="rfc.index"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Index</h3>
<table>
<tr><td><strong>A</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor16">Available Resource</a></td></tr>
<tr><td><strong>B</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor12">Broadcasted Presence</a></td></tr>
<tr><td><strong>C</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor19">Chat Session</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor10">Contact</a></td></tr>
<tr><td><strong>D</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor13">Directed Presence</a></td></tr>
<tr><td><strong>I</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor15">Initial Presence</a></td></tr>
<tr><td><strong>O</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor20">Offline Message Storage</a></td></tr>
<tr><td><strong>P</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor4">Presence</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor17">Presence Probe</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor14">Presence Session</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor9">Presence Subscription</a></td></tr>
<tr><td><strong>R</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor3">Roster</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor5">Roster Get</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor7">Roster Push</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor8">Roster Result</a></td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor6">Roster Set</a></td></tr>
<tr><td><strong>S</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor11">Subscription Request</a></td></tr>
<tr><td><strong>U</strong></td><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td><td><a href="#anchor18">Unavailable Presence</a></td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Peter Saint-Andre (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">XMPP Standards Foundation</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">stpeter@jabber.org</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="https://stpeter.im/">https://stpeter.im/</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2009).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
