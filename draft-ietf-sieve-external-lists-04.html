<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Sieve Extension: Externally Stored Lists</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Sieve Extension: Externally Stored Lists">
<meta name="keywords" content="Sieve, external list">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Sieve Working Group</td><td class="header">A. Melnikov</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Isode Limited</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">B. Leiba</td></tr>
<tr><td class="header">Expires: May 12, 2011</td><td class="header">Huawei Technologies</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">November 8, 2010</td></tr>
</table></td></tr></table>
<h1><br />Sieve Extension: Externally Stored Lists<br />draft-ietf-sieve-external-lists-04</h1>

<h3>Abstract</h3>

<p>
            The Sieve scripting language can be used to implement whitelisting,
            blacklisting, personal distribution lists, and other sorts of list matching.
            Currently, this requires
            that all members of such lists be hardcoded in the script itself.
            Whenever a member of a list is added or deleted, the script needs
            to be updated and possibly uploaded to a mail server.
          
</p>
<p>
            This document defines a Sieve extension for accessing externally stored
            lists -- lists whose members are stored externally to the script, such as
            using LDAP (RFC 4510), ACAP (RFC 2244), or relational databases.
          
</p>
<h3>ToDo</h3>

<p>
            </p>
<ul class="text">
<li>
                Do we need support for URI schemes in ihave?  From IETF 77 minutes:
                "Can use ihave to test if a URI is valid, both that the scheme is supported and
                that the URI can be retrieved/queried."
              
</li>
<li>
                Do we need to say anything about comparators?  We can be silent (as now),
                we can say that comparators MAY be ignored as a list-specific thing,
                or we can say that comparators MUST NOT be used.
              
</li>
<li>
                Should we add a mandatory-to-implement tag?  Ned suggests (and I agree) that
                it might be good to add a registry of well-defined strings that can be used
                instead of URIs, and define the initial string "pab" to represent the user's
                personal address book.
              
</li>
</ul><p>
          
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on May 12, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">1.1.</a>&nbsp;
Conventions used in this document<br />
<br />
<a href="#anchor2">2.</a>&nbsp;
Extlists extension<br />
<a href="#capability">2.1.</a>&nbsp;
Capability Identifier<br />
<a href="#anchor3">2.2.</a>&nbsp;
:list match type for supported tests<br />
<a href="#anchor4">2.3.</a>&nbsp;
:list tagged argument to the "redirect" action<br />
<a href="#other-uses">2.4.</a>&nbsp;
Other uses for external lists<br />
<a href="#list-name-syntax">2.5.</a>&nbsp;
Syntax of an externally stored list name<br />
<a href="#manage-sieve">2.6.</a>&nbsp;
Interaction with ManageSieve<br />
<a href="#examples">2.7.</a>&nbsp;
Examples<br />
<a href="#example1">2.7.1.</a>&nbsp;
Example 1<br />
<a href="#example2">2.7.2.</a>&nbsp;
Example 2<br />
<a href="#example3">2.7.3.</a>&nbsp;
Example 3<br />
<br />
<a href="#security">3.</a>&nbsp;
Security Considerations<br />
<br />
<a href="#iana">4.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor5">4.1.</a>&nbsp;
Registration of Sieve extension<br />
<a href="#anchor6">4.2.</a>&nbsp;
Registration of ManageSieve capability<br />
<br />
<a href="#acknowledgements">5.</a>&nbsp;
Acknowledgements<br />
<br />
<a href="#rfc.references1">6.</a>&nbsp;
References<br />
<a href="#rfc.references1">6.1.</a>&nbsp;
Normative References<br />
<a href="#rfc.references2">6.2.</a>&nbsp;
Informative References<br />
<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
            This document specifies an extension to the Sieve language <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>
            for checking membership in an external list 
            or for redirecting messages to an external list of recipients.
            An "external list" is a list whose members are stored externally to the Sieve script,
            such as using LDAP <a class='info' href='#RFC4510'>[RFC4510]<span> (</span><span class='info'>Zeilenga, K., &ldquo;Lightweight Directory Access Protocol (LDAP): Technical Specification Road Map,&rdquo; June&nbsp;2006.</span><span>)</span></a>, ACAP <a class='info' href='#RFC2244'>[RFC2244]<span> (</span><span class='info'>Newman, C. and J. Myers, &ldquo;ACAP -- Application Configuration Access Protocol,&rdquo; November&nbsp;1997.</span><span>)</span></a>,
            or relational databases.
          
</p>
<p>
            This extension adds a new match type to apply to supported tests,
            and a new tagged argument to the "redirect" action.
          
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Conventions used in this document</h3>

<p>
              Conventions for notations are as in <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a> section 1.1, including
              the use of <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
            
</p>
<p>
              The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
              "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
              document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
            
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Extlists extension</h3>

<a name="capability"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Capability Identifier</h3>

<p>
              The capability string associated with the extension defined in this
              document is "extlists".
            
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
:list match type for supported tests</h3>

<p>ABNF:
              </p>
<blockquote class="text"><dl>
<dt>   MATCH-TYPE</dt>
<dd>=/ ":list"
                  ; only valid for supported tests
                
</dd>
</dl></blockquote><p>
            
</p>
<p>
              The new ":list" match type changes the interpretation
              of the "key-list" parameter (the second parameter) to
              supported tests.
              When the match type is ":list", the key-list becomes a list of names of externally
              stored lists. The external lists are queried, perhaps through a list-specific
              mechanism, and the test evaluates to "true" if any of the specified values
              matches any member of one or more of the lists.
            
</p>
<p>
              Implementations MUST support "address", "envelope" and "header" tests.
              Implementations that include the Variables extension <a class='info' href='#RFC5229'>[RFC5229]<span> (</span><span class='info'>Homme, K., &ldquo;Sieve Email Filtering: Variables Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a>
              MUST also support "string" tests.
            
</p>
<p>
              Implementations MAY support other tests but MUST raise an error
              (which SHOULD be a compile-time error, but MAY be a runtime error)
              when a script uses :list with a test for which it is not supported.
              To maintain interoperability, other tests that can be used with :list
              SHOULD be documented in a
              specification that defines a capability string that can be tested (in a
              "require" statement, or using ihave <a class='info' href='#RFC5463'>[RFC5463]<span> (</span><span class='info'>Freed, N., &ldquo;Sieve Email Filtering: Ihave Extension,&rdquo; March&nbsp;2009.</span><span>)</span></a>).
            
</p>
<p>
              For example, testing ':header ["to", "cc"]' against a list would cause each
              "to" and "cc" value, ignoring leading and trailing whitespace, to be queried.
              If any value is found to belong to the list, the test returns "true".
              If no value belongs to the list, the test returns "false".
              Once a value is found in the list, there is no need for the query
              mechanism to look further.
            
</p>
<p>
              For some lists, the Sieve engine might directly retrieve the list and make its
              own comparison.  Other lists might not work that way -- they might provide a way
              to ask if a value is in the list, but not permit retrieval of the list itself.
              It is up to the Sieve implementation to understand how to interact with any
              supported list.  If the Sieve engine is permanently unable to query the list
              (perhaps because the list doesn't support the required operation), the test
              MUST result in a runtime error in the Sieve script.
            
</p>
<p>
              See <a class='info' href='#list-name-syntax'>Section&nbsp;2.5<span> (</span><span class='info'>Syntax of an externally stored list name</span><span>)</span></a> for the detailed description
              of syntax used for naming externally stored lists.
            
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
:list tagged argument to the "redirect" action</h3>

<p>
              </p>
<blockquote class="text"><dl>
<dt>Usage:</dt>
<dd>
                  redirect :list &lt;ext-list-name: string&gt;
                
</dd>
</dl></blockquote><p>
            
</p>
<p>
              The "redirect" action with the ":list" argument is used to send
              the message to one or more email addresses stored in the externally stored
              list 'ext-list-name'. This variant of the redirect command can be used
              to implement a personal distribution list.
            
</p>
<p>
              For this feature to work, one of the following conditions has to be true:
              </p>
<ol class="text">
<li>
                  The list resolves to a list of email addresses, and the Sieve
                  engine is able to enumerate those addresses.
                
</li>
<li>
                  The list handler is able to take care of the redirection on
                  behalf of the Sieve engine.
                
</li>
</ol><p>
            
</p>
<p>
              In cases where, for example, a list contains hashed email address values or
              an email address pattern ("sz*@example.com", "*+ietf@example.net"),
              the Sieve engine will not be able to redirect to that list, and responsibility
              must pass to the list handler.
            
</p>
<p>
              If neither the Sieve engine nor the list handler
              can enumerate (or iterate) the list, or the list
              does not resolve to email addresses, the situation
              MUST result in a runtime error in the Sieve script.
            
</p>
<p>
              See <a class='info' href='#list-name-syntax'>Section&nbsp;2.5<span> (</span><span class='info'>Syntax of an externally stored list name</span><span>)</span></a> for the detailed description
              of syntax used for naming externally stored lists.
            
</p>
<a name="other-uses"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Other uses for external lists</h3>

<p>
              The uses for external lists specified here represent the useful
              cases and situations at the time of this writing.
              Other uses for external lists, using other Sieve features,
              might be devised in the future, and such uses can be
              described in extensions to this document.
            
</p>
<a name="list-name-syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Syntax of an externally stored list name</h3>

<p>
              A name of an externally stored list is always an absolute URI <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>.
              Implementations might find URIs such as LDAP <a class='info' href='#RFC4510'>[RFC4510]<span> (</span><span class='info'>Zeilenga, K., &ldquo;Lightweight Directory Access Protocol (LDAP): Technical Specification Road Map,&rdquo; June&nbsp;2006.</span><span>)</span></a>,
              CardDAV <a class='info' href='#I-D.ietf-vcarddav-carddav'>[I&#8209;D.ietf&#8209;vcarddav&#8209;carddav]<span> (</span><span class='info'>Daboo, C., &ldquo;vCard Extensions to WebDAV (CardDAV),&rdquo; November&nbsp;2009.</span><span>)</span></a>,
              or Tag <a class='info' href='#RFC4151'>[RFC4151]<span> (</span><span class='info'>Kindberg, T. and S. Hawke, &ldquo;The 'tag' URI Scheme,&rdquo; October&nbsp;2005.</span><span>)</span></a> to be useful for naming external lists.
            
</p>
<p>
              The "tag" URI scheme <a class='info' href='#RFC4151'>[RFC4151]<span> (</span><span class='info'>Kindberg, T. and S. Hawke, &ldquo;The 'tag' URI Scheme,&rdquo; October&nbsp;2005.</span><span>)</span></a> MUST be supported, and
              can be used to represent opaque,
              but user friendlier identifiers. Resolution of such identifiers is going
              to be implementation specific and it can help in hiding the complexity of
              an implementation from end users. For example, an implementation can
              provide a web interface for managing lists of users stored in LDAP.
              Requiring users to know generic LDAP URI syntax might not be very
              practical, due to its complexity. An implementation can instead use
              a fixed tag URI prefix such as "tag:example.com,&lt;date&gt;:" (where &lt;date&gt;
              can be, for example, a date generated once on installation of the web interface and
              left untouched upon upgrades)
              and the prefix doesn't even need to be shown to end users.
            
</p>
<a name="manage-sieve"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6"></a><h3>2.6.&nbsp;
Interaction with ManageSieve</h3>

<p>
              This extension defines the following new capability for ManageSieve
              (see <a class='info' href='#RFC5804'>[RFC5804]<span> (</span><span class='info'>Melnikov, A. and T. Martin, &ldquo;A Protocol for Remotely Managing Sieve Scripts,&rdquo; July&nbsp;2010.</span><span>)</span></a> section 1.7):
            
</p>
<p>
              EXTLISTS - A space-separated list of URI schema parts <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>
              for supported externally stored list types.  This capability MUST be returned
              if the Sieve implementation supports the "extlists" extension defined in this
              document.
            
</p>
<p>
              This also extends the ManageSieve ABNF as follows:
              </p>
<blockquote class="text"><dl>
<dt>single-capability</dt>
<dd>=/ DQUOTE "EXTLISTS" DQUOTE SP ext-list-types CRLF
                  ; single-capability is defined in <a class='info' href='#RFC5804'>[RFC5804]<span> (</span><span class='info'>Melnikov, A. and T. Martin, &ldquo;A Protocol for Remotely Managing Sieve Scripts,&rdquo; July&nbsp;2010.</span><span>)</span></a>
                
</dd>
<dt>ext-list-types</dt>
<dd>= string
                  ; space separated list of URI schema parts
                  <br />
; for supported externally stored list types.
                  <br />
; MUST NOT be empty.
                
</dd>
</dl></blockquote><p>
            
</p>
<a name="examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7"></a><h3>2.7.&nbsp;
Examples</h3>

<a name="example1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7.1"></a><h3>2.7.1.&nbsp;
Example 1</h3>

<p>
              This example uses the "envelope" option <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>
              and the "subaddress" extension  <a class='info' href='#RFC5233'>[RFC5233]<span> (</span><span class='info'>Murchison, K., &ldquo;Sieve Email Filtering: Subaddress Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a>:
              </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    require ["extlists", "envelope", "subaddress"];

    # Submission from list members is sent to all members
    if allof (envelope :detail :list "to"
                       "tag:example.com,2009-05-28:mylist",
              header :list "from"
                     "tag:example.com,2009-05-28:mylist") {
        redirect :list "tag:example.com,2009-05-28:mylist";
    }
</pre></div><p>

            
</p>
<a name="example2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7.2"></a><h3>2.7.2.&nbsp;
Example 2</h3>

<p>
              This example uses the "currentdate" test <a class='info' href='#RFC5260'>[RFC5260]<span> (</span><span class='info'>Freed, N., &ldquo;Sieve Email Filtering: Date and Index Extensions,&rdquo; July&nbsp;2008.</span><span>)</span></a>
              and a list containing the dates of local holidays.  If today is
              a holiday, the script will notify <a class='info' href='#RFC5435'>[RFC5435]<span> (</span><span class='info'>Melnikov, A., Leiba, B., Segmuller, W., and T. Martin, &ldquo;Sieve Email Filtering: Extension for Notifications,&rdquo; January&nbsp;2009.</span><span>)</span></a>
              the user via XMPP <a class='info' href='#RFC5437'>[RFC5437]<span> (</span><span class='info'>Saint-Andre, P. and A. Melnikov, &ldquo;Sieve Notification Mechanism: Extensible Messaging and Presence Protocol (XMPP),&rdquo; January&nbsp;2009.</span><span>)</span></a>
              about the message.
              </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    require ["extlists", "date", "enotify"];
    if currentdate :list "date"
       "tag:example.com,2010-01-01:localHolidays" {
       notify "xmpp:romeo@im.example.com";
    }
</pre></div><p>

            
</p>
<a name="example3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7.3"></a><h3>2.7.3.&nbsp;
Example 3</h3>

<p>
              This example uses a personal address book, along with
              spamtest  <a class='info' href='#RFC5235'>[RFC5235]<span> (</span><span class='info'>Daboo, C., &ldquo;Sieve Email Filtering: Spamtest and Virustest Extensions,&rdquo; January&nbsp;2008.</span><span>)</span></a>
              and the relational extension <a class='info' href='#RFC5231'>[RFC5231]<span> (</span><span class='info'>Segmuller, W. and B. Leiba, &ldquo;Sieve Email Filtering: Relational Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a>
              to give a different level of spam tolerance to known senders.
              </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    require ["envelope", "extlists", "fileinto", "spamtest",
             "relational", "comparator-i;ascii-numeric"];
    if allof (
         envelope :list "from" "tag:example.com,2010-04-10:pab",
         spamtest :value "ge" :comparator "i;ascii-numeric" "8"
             )
      { /* Known: allow high spam score */
        fileinto "spam";
      }
    elsif spamtest :value "ge" :comparator "i;ascii-numeric" "3"
      { /* Unknown: less tolerance in spam score */
        fileinto "spam";
      }
</pre></div><p>

            
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Security Considerations</h3>

<p>
            Security considerations related to the "address"/"envelope"/"header" tests and
            "redirect" action discussed in Sieve <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a> also apply
            to this document.
          
</p>
<p>
            External list memberships ought to be treated as if they are
            an integral part of the script,
            so a temporary failure to access an external list
            SHOULD be handled in the same way as a temporary failure to retrieve
            the Sieve script itself.
          
</p>
<p>
            For example, if the Sieve script is stored in the 
            Lightweight Directory Access Protocol <a class='info' href='#RFC4510'>[RFC4510]<span> (</span><span class='info'>Zeilenga, K., &ldquo;Lightweight Directory Access Protocol (LDAP): Technical Specification Road Map,&rdquo; June&nbsp;2006.</span><span>)</span></a> and the script
            can't be retrieved when a message is processed (perhaps the LDAP server is
            unavailable), then the Sieve engine
            might delay message delivery until the script can be retrieved successfully.
            Similarly, if an external list is stored in LDAP and that LDAP server is
            unavailable, the Sieve engine would take the same action -- delay message delivery
            and try again later.
          
</p>
<p>
            Protocols/APIs used to retrieve/verify external list membership MUST provide
            an appropriate level of confidentiality and authentication.
            Usually, that will be at least the same level of confidentiality as
            protocols/APIs used to retrieve Sieve scripts, but only the implementation
            (or deployment) will know what is appropriate.
            There's a difference, for example, between making an LDAP
            request on a closed LAN that's only used for trusted servers
            (it may be that neither encryption nor authentication is needed),
            on a firewalled LAN internal to a company
            (it might be OK to skip encryption, depending upon policy),
            and on the open Internet
            (encryption and authentication are probably both required).
            It also matters whether the list being accessed is private or public
            (no encryption or authentication may be needed for public data, even on the
            Internet).
          
</p>
<p>
            Implementations of this extension should keep in mind that
            matching values against an externally stored list can be IO
            and/or CPU intensive. This can be used to deny service to the mailserver
            and/or to servers providing access to externally stored mailing lists.
            A na&iuml;ve implementation, such as the one that tries to retrieve content
            of the whole list to perform matching can make this worse.
          
</p>
<p>
            But note that many protocols that can be used for accessing externally
            stored lists support flexible searching features that can be used
            to minimize network traffic and load on the directory service.
            For example, LDAP allows for search filters.
            Implementations SHOULD use such features whenever they can.
          
</p>
<p>
            Many organizations support external lists with thousands of recipients.
            In order to avoid mailbombs when redirecting a message to
            an externally stored list, implementations SHOULD enforce
            limits on the number of recipients and/or on domains to which such
            recipients belong.
          
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
IANA Considerations</h3>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Registration of Sieve extension</h3>

<p>
              The following template specifies the IANA registration of the
              Sieve extension specified in this document:
            
</p>
<p>
              To: iana@iana.org
              <br />

              Subject: Registration of new Sieve extension
              <br />

              Capability name: extlists
              <br />

              Description: adds the ':list' match type to certain Sieve tests,
              and the ':list' argument to the 'redirect' action.
              The ':list' match type changes tests to match
              values against values stored in one or more externally stored
              lists. The ':list' argument to the redirect action changes
              the redirect action to forward the message to email addresses
              stored in the externally stored list.
              <br />

              RFC number: this RFC
              <br />

              Contact address:
              <br />

              &nbsp; &nbsp; The Sieve discussion list &lt;sieve@ietf.org&gt;
            
</p>
<p>
              This information should be added to the list of sieve extensions
              given on http://www.iana.org/assignments/sieve-extensions.
            
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Registration of ManageSieve capability</h3>

<p>
              The following requests IANA to register a new ManageSieve Capability according
              to the IANA registration template specified in <a class='info' href='#RFC5804'>[RFC5804]<span> (</span><span class='info'>Melnikov, A. and T. Martin, &ldquo;A Protocol for Remotely Managing Sieve Scripts,&rdquo; July&nbsp;2010.</span><span>)</span></a>:
            
</p>
<p>
              To: iana@iana.org
              <br />

              Subject: ManageSieve Capability Registration
              <br />

              Capability name: extlists
              <br />

              Description: This capability is returned if the server supports the
              "extlists" [RFCXXXX] Sieve extension.
              <br />

              Relevant publications: this RFC, <a class='info' href='#manage-sieve'>Section&nbsp;2.6<span> (</span><span class='info'>Interaction with ManageSieve</span><span>)</span></a>
              <br />

              Person & email address to contact for further information:
              Alexey Melnikov &lt;alexey.melnikov@isode.com&gt;
              <br />

              Author/Change controller: IESG
            
</p>
<a name="acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Acknowledgements</h3>

<p>
            Thanks to Alexandros Vellis, Nigel Swinson, Ned Freed,
            Kjetil Torgrim Homme, Dave Cridland, Cyrus Daboo, Pete Resnick,
            and Robert Burrell Donkin
            for ideas, comments and suggestions.
            Kristin Hubner also helped greatly with the examples.
            
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3986">[RFC3986]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>,&rdquo; STD&nbsp;66, RFC&nbsp;3986, January&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3986.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3986.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3986.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4151">[RFC4151]</a></td>
<td class="author-text">Kindberg, T. and S. Hawke, &ldquo;<a href="http://tools.ietf.org/html/rfc4151">The 'tag' URI Scheme</a>,&rdquo; RFC&nbsp;4151, October&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4151.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5228">[RFC5228]</a></td>
<td class="author-text">Guenther, P. and T. Showalter, &ldquo;<a href="http://tools.ietf.org/html/rfc5228">Sieve: An Email Filtering Language</a>,&rdquo; RFC&nbsp;5228, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5228.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5804">[RFC5804]</a></td>
<td class="author-text">Melnikov, A. and T. Martin, &ldquo;<a href="http://tools.ietf.org/html/rfc5804">A Protocol for Remotely Managing Sieve Scripts</a>,&rdquo; RFC&nbsp;5804, July&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5804.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-vcarddav-carddav">[I-D.ietf-vcarddav-carddav]</a></td>
<td class="author-text">Daboo, C., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-vcarddav-carddav-10.txt">vCard Extensions to WebDAV (CardDAV)</a>,&rdquo; draft-ietf-vcarddav-carddav-10 (work in progress), November&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-vcarddav-carddav-10.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2244">[RFC2244]</a></td>
<td class="author-text"><a href="mailto:chris.newman@innosoft.com">Newman, C.</a> and <a href="mailto:jgmyers@netscape.com">J. Myers</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2244">ACAP -- Application Configuration Access Protocol</a>,&rdquo; RFC&nbsp;2244, November&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2244.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4510">[RFC4510]</a></td>
<td class="author-text">Zeilenga, K., &ldquo;<a href="http://tools.ietf.org/html/rfc4510">Lightweight Directory Access Protocol (LDAP): Technical Specification Road Map</a>,&rdquo; RFC&nbsp;4510, June&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4510.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5229">[RFC5229]</a></td>
<td class="author-text">Homme, K., &ldquo;<a href="http://tools.ietf.org/html/rfc5229">Sieve Email Filtering: Variables Extension</a>,&rdquo; RFC&nbsp;5229, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5229.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5231">[RFC5231]</a></td>
<td class="author-text">Segmuller, W. and B. Leiba, &ldquo;<a href="http://tools.ietf.org/html/rfc5231">Sieve Email Filtering: Relational Extension</a>,&rdquo; RFC&nbsp;5231, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5231.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5233">[RFC5233]</a></td>
<td class="author-text">Murchison, K., &ldquo;<a href="http://tools.ietf.org/html/rfc5233">Sieve Email Filtering: Subaddress Extension</a>,&rdquo; RFC&nbsp;5233, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5233.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5235">[RFC5235]</a></td>
<td class="author-text">Daboo, C., &ldquo;<a href="http://tools.ietf.org/html/rfc5235">Sieve Email Filtering: Spamtest and Virustest Extensions</a>,&rdquo; RFC&nbsp;5235, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5235.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5260">[RFC5260]</a></td>
<td class="author-text">Freed, N., &ldquo;<a href="http://tools.ietf.org/html/rfc5260">Sieve Email Filtering: Date and Index Extensions</a>,&rdquo; RFC&nbsp;5260, July&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5260.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5435">[RFC5435]</a></td>
<td class="author-text">Melnikov, A., Leiba, B., Segmuller, W., and T. Martin, &ldquo;<a href="http://tools.ietf.org/html/rfc5435">Sieve Email Filtering: Extension for Notifications</a>,&rdquo; RFC&nbsp;5435, January&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5435.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5437">[RFC5437]</a></td>
<td class="author-text">Saint-Andre, P. and A. Melnikov, &ldquo;<a href="http://tools.ietf.org/html/rfc5437">Sieve Notification Mechanism: Extensible Messaging and Presence Protocol (XMPP)</a>,&rdquo; RFC&nbsp;5437, January&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5437.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5463">[RFC5463]</a></td>
<td class="author-text">Freed, N., &ldquo;<a href="http://tools.ietf.org/html/rfc5463">Sieve Email Filtering: Ihave Extension</a>,&rdquo; RFC&nbsp;5463, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5463.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Alexey Melnikov</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Isode Limited</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">5 Castle Business Village</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">36 Station Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hampton, Middlesex  TW12 2BX</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UK</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Alexey.Melnikov@isode.com">Alexey.Melnikov@isode.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Barry Leiba</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 646 827 0648</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:barryleiba@computer.org">barryleiba@computer.org</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://internetmessagingtechnology.org/">http://internetmessagingtechnology.org/</a></td></tr>
</table>
</body></html>
