<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Multi-Party Text Chat</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Multi-Party Text Chat">
<meta name="keywords" content="Text Chat, Instant Messaging, Session Initiation Protocol, SIP, Message Sessions Relay Protocol, MSRP, Extensible Messaging and Presence Protocol, XMPP">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">P. Saint-Andre</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Cisco</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">S. Loreto</td></tr>
<tr><td class="header">Expires: September 10, 2009</td><td class="header">Ericsson</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">F. Forno</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Bluendo srl</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 09, 2009</td></tr>
</table></td></tr></table>
<h1><br />Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Multi-Party Text Chat<br />draft-saintandre-sip-xmpp-groupchat-01</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 10, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document defines a bi-directional protocol mapping for the exchange of instant messages in the context of a many-to-many chat session among users of the Session Initiation Protocol (SIP) and users of the Extensible Messaging and Presence Protocol (XMPP).  Specifically for SIP text chat, this document specifies a mapping to the Message Session Relay Protocol (MSRP).
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-overview">1.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-scope">1.2.</a>&nbsp;
Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-sessions">1.3.</a>&nbsp;
Formal and Informal Sessions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-heuristics">1.4.</a>&nbsp;
Gateway Heuristics<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-ack">1.5.</a>&nbsp;
Acknowledgements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro-discuss">1.6.</a>&nbsp;
Discussion Venue<br />
<a href="#xmppf">2.</a>&nbsp;
XMPP Group Chat to MSRP Multiparty Instant Message (IM) Session<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xmppf-init">2.1.</a>&nbsp;
Entering a Room<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xmpp-nicksetup">2.2.</a>&nbsp;
Setting up a nickname<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xmppf-presence">2.3.</a>&nbsp;
Presence Broadcast<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xmppf-exchange">2.4.</a>&nbsp;
Exchanging Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xmppf-messageToAll">2.4.1.</a>&nbsp;
Sending a Message to All Occupants<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xmppf-privatemessage">2.4.2.</a>&nbsp;
Sending a Private Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xmppf-exit">2.5.</a>&nbsp;
Exiting a Room<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xmppf-nickConflict">2.6.</a>&nbsp;
Nickname Conflict<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xmppf-nickChanging">2.7.</a>&nbsp;
Changing Nickname<br />
<a href="#msrp">3.</a>&nbsp;
MSRP Multiparty Instant Message (IM) Session to XMPP Group Chat<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#mrsp-init">3.1.</a>&nbsp;
Entering a Room<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msrp-presence">3.2.</a>&nbsp;
Presence Broadcast<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#mrsp-exchange">3.3.</a>&nbsp;
Exchanging Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msrp-messageToAll">3.3.1.</a>&nbsp;
Sending a Message to All Occupants<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msrp-privatemessage">3.3.2.</a>&nbsp;
Sending a Private Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msrp-exit">3.4.</a>&nbsp;
Exiting a Room<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msrp-nickConflict">3.5.</a>&nbsp;
Nickname Conflict<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msrp-nickChanging">3.6.</a>&nbsp;
Changing Nickname<br />
<a href="#security">4.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">5.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">5.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">5.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<a name="intro-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Overview</h3>

<p>Both the Session Initiation Protocol <a class='info' href='#SIP'>[SIP]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> and the Extensible Messaging and Presence Protocol <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> can be used for the purpose of many-to-many text chat over the Internet. To ensure interworking between these technologies, it is important to define bi-directional protocol mappings.
</p>
<p>The architectural assumptions underlying such protocol mappings are provided in <a class='info' href='#SIP-XMPP'>[SIP&#8209;XMPP]<span> (</span><span class='info'>Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; March&nbsp;2009.</span><span>)</span></a>, including mapping of addresses and error conditions. Mappings for single instant messages (sometimes called "pager-mode" messaging) are provided in <a class='info' href='#SIP-XMPP-IM'>[SIP&#8209;XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging,&rdquo; March&nbsp;2009.</span><span>)</span></a>. Mappings for one-to-one text chat sessions are provided in <a class='info' href='#SIP-XMPP-CHAT'>[SIP&#8209;XMPP&#8209;CHAT]<span> (</span><span class='info'>Saint-Andre, P., Gavita, E., Hossain, N., and S. Loreto, &ldquo;Interworking between the Session Initiation Protocol (SIP) and the  Extensible Messaging and Presence Protocol (XMPP): One-to-One Text Chat,&rdquo; March&nbsp;2009.</span><span>)</span></a>. 
</p>
<p>This document specifies mappings for many-to-many text chat sessions (sometimes called "groupchat"); in particular, this document specifies mappings between XMPP and the Message Session Relay Protocol <a class='info' href='#MSRP'>[MSRP]<span> (</span><span class='info'>Campbell, B., Mahy, R., and C. Jennings, &ldquo;The Message Session Relay Protocol (MSRP),&rdquo; September&nbsp;2007.</span><span>)</span></a>.
</p>
<p>Note: The capitalized key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#TERMS'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [TERMS].
</p>
<a name="intro-scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Scope</h3>

<p>Both XMPP and SIP/SIMPLE technologies enable multi-user text chat, whereby users can exchange messages in the context of a room. The term "room" usually is a synonym for a virtual environment where people enter and exchange messages.
</p>
<p>Groupchat messages are messages which are sent from a sender to multiple recipients (i.e., two or more) in the context of a "multi-user chat session", "text conference", or "chatroom".  In XMPP a groupchat message is a &lt;message/&gt; stanza of type "groupchat" that is reflected from the sender to multiple recipients by a multi-user chat service, as defined in <a class='info' href='#MUC'>[MUC]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Multi-User Chat,&rdquo; July&nbsp;2008.</span><span>)</span></a>.  In SIP/SIMPLE a groupchat message is reflected from the sender to multiple recipients by a conference server that uses MSRP to handle groupchat sessions, as defined in <a class='info' href='#MSRP-MULTI'>[MSRP&#8209;MULTI]<span> (</span><span class='info'>Niemi, A., Garcia-Martin, M., and G. Sandbakken, &ldquo;Multi-party Instant Message (IM) Sessions Using the Message Session Relay  Protocol (MSRP),&rdquo; October&nbsp;2009.</span><span>)</span></a>.
</p>
<p>As in <a class='info' href='#SIP-XMPP-IM'>[SIP&#8209;XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging,&rdquo; March&nbsp;2009.</span><span>)</span></a> and related documents, the approach taken here is to directly map syntax and semantics from one protocol to another.  The mapping described herein depends on the protocols defined in the following specifications:
</p>
<p>
          </p>
<ul class="text">
<li>XMPP chat sessions using message stanzas of type "groupchat" are specified in <a class='info' href='#MUC'>[MUC]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Multi-User Chat,&rdquo; July&nbsp;2008.</span><span>)</span></a>.
</li>
<li>SIP-based chat room sessions using the SIP INVITE and SEND request types are specified in <a class='info' href='#MSRP-MULTI'>[MSRP&#8209;MULTI]<span> (</span><span class='info'>Niemi, A., Garcia-Martin, M., and G. Sandbakken, &ldquo;Multi-party Instant Message (IM) Sessions Using the Message Session Relay  Protocol (MSRP),&rdquo; October&nbsp;2009.</span><span>)</span></a>.
</li>
</ul><p>
        
</p>
<a name="intro-sessions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Formal and Informal Sessions</h3>

<p>[TBD] Does XMPP use Formal and Informal session also for group-chat?
</p>
<a name="intro-heuristics"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Gateway Heuristics</h3>

<p>[TBD]
</p>
<a name="intro-ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.5"></a><h3>1.5.&nbsp;
Acknowledgements</h3>

<p>Some text in this document was borrowed from <a class='info' href='#SIP-XMPP'>[SIP&#8209;XMPP]<span> (</span><span class='info'>Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; March&nbsp;2009.</span><span>)</span></a> and from <a class='info' href='#MUC'>[MUC]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Multi-User Chat,&rdquo; July&nbsp;2008.</span><span>)</span></a>.
</p>
<a name="intro-discuss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.6"></a><h3>1.6.&nbsp;
Discussion Venue</h3>

<p>The authors welcome discussion and comments related to the topics presented in this document.  The preferred forum is the &lt;sip-xmpp@xmpp.org&gt; mailing list, for which archives and subscription information are available at <a href='http://mail.jabber.org/mailman/listinfo/sip-xmpp'>http://mail.jabber.org/mailman/listinfo/sip-xmpp</a>.
</p>
<a name="xmppf"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
XMPP Group Chat to MSRP Multiparty Instant Message (IM) Session</h3>

<p>This section describes how to map an XMPP Group Chat to a Multi-party Instant Message (IM) MSRP session.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                                  MSRP conference
XMPP User                      GW                       server
    |                          |                          |
    |(F1) (XMPP) Entering a room                          |
    |-------------------------&gt;|                          |
    |                          |(F2) (SIP) INVITE         |
    |                          |-------------------------&gt;|
    |                          |(F3) (SIP) 200 OK         |
    |                          |&lt;-------------------------|
    |                          |(F4) (SIP) ACK            |
    |                          |-------------------------&gt;|
    |                          |                          |
    |                          |(F5) (MSRP) NICKNAME      |
    |                          |-------------------------&gt;|
    |                          |(F6) (MSRP) 200 OK        |
    |                          |&lt;-------------------------|
    |                          |                          |
    |                          |(F7) (SIP)SUBSCRIBE       |
    |                          |-------------------------&gt;|
    |                          |     Event:conference     |
    |                          |                          |
    |                          |(F8) (SIP) 200 OK         |
    |                          |&lt;-------------------------|
    |                          |                          |
    |                          |(F9) (SIP) NOTIFY         |
    |                          |&lt;-------------------------|
    |                          |(F10) (SIP) 200 OK        |
    |                          |-------------------------&gt;|
    |(F11) (XMPP) Presence     |                          |
    |&lt;-------------------------|                          |
    |                          |                          |
    |(F12) (XMPP) A chat message                          |
    |-------------------------&gt;|                          |
    |                          |(F13) (MSRP) SEND         |
    |                          |-------------------------&gt;|
    |                          |(F14) (MSRP) 200 OK       |
    |                          |&lt;-------------------------|
    |                          |                          |
    |(F15) (XMPP) echo chat message                       |
    |--------------------------|                          |
    .                          .                          .
    .                          .                          .
    |(F16) (XMPP) Exiting a room                          |
    |-------------------------&gt;|                          |
    |                          |(F17) (SIP) BYE           |
    |                          |-------------------------&gt;|
    |                          |(F18) (SIP) 200 OK        |
    |                          |&lt;-------------------------|
</pre></div>
<a name="xmppf-init"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Entering a Room</h3>

<p>When the XMPP user ("Juliet") wants to join a multi-user chat room ("Verona"), she sends a &lt;presence/&gt; stanza to the hostname hosting that chat room, she also specifies the "nick" she desires to use within the room ("juliet"). The Room Nickname is the resource identifier portion of a Room JID. The Juliet client SHOULD signal its ability to speak the multi-user chat protocol by including in the initial presence stanza an empty &lt;x/&gt; element qualified by the
'http://jabber.org/protocol/muc' namespace.
</p>
<p>Example: (F1) Juliet entering a chatroom
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;presence from='juliet@example.com'
             to='verona@chat.shakespeare.net/juliet'&gt;
      &lt;x xmlns='http='http://jabber.org/protocol/muc'/&gt;
    &lt;/presence&gt;

</pre></div>
<p>Upon receiving such a presence stanza, the XMPP server to which Juliet has authenticated attempts to deliver the stanza to a local domain or attempts to route the presence stanza to the remote domain that services the hostname in the 'to' attribute. Naturally, in this document we assume that the hostname in the 'to' attribute is an Chat Room-aware SIP service hosted by a separate server.
</p>
<p>As specified in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>, the XMPP server needs to determine the identity of the remote domain, which it does by performing one or more <a class='info' href='#DNS-SRV'>[DNS&#8209;SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> lookups. For presence stanzas, the order of lookups recommended by <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a> is to first try the "_xmpp-server" service as specified in <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> and to then try the "_im" service as specified in <a class='info' href='#IMP-SRV'>[IMP&#8209;SRV]<span> (</span><span class='info'>Peterson, J., &ldquo;Address Resolution for Instant Messaging and Presence,&rdquo; August&nbsp;2004.</span><span>)</span></a>.  Here we assume that the first lookup will fail but that the second lookup will succeed and return a resolution "_im._simple.shakespeare.net", since we have already assumed that the shakespeare.net hostname is running a SIP instant messaging service.  (Note: The XMPP server may have previously determined that the remote domain is a SIMPLE server, in which case it would not need to perform the SRV lookups; the caching of such information is a matter of implementation and local service policy, and is therefore out of scope for this document.)
</p>
<p>Once the XMPP server (example.com) has determined that the remote domain is serviced by a SIMPLE server, it hands the XMPP presence stanza off to its local XMPP-to-SIP gateway (x2s.example.com), which transforms the presence stanza into SIP syntax and routes it to the remote conference server (shakespeare.net).
</p>
<p>As a compliant multi-user chat services MUST accept the presence stanza containing an empty &lt;x/&gt; element qualified by the
'http://jabber.org/protocol/muc' namespace as a request to enter a room; the XMPP-to-SIP gateway MUST transform it in a SIP INVITE request.

</p>
<p>Example: (F2) Juliet entering a chatroom (SIP transformation)
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    INVITE sip:verona@chat.shakespeare.net SIP/2.0
    To: &lt;sip:verona@chat.shakespeare.net&gt;
    From: &lt;sip:juliet@example.com&gt;;tag=786
    Call-ID: 711609sa
    Content-Type: application/sdp
    Content-Lenght: [length]

    c=IN IP4 x2s.shakespeare.net
    m=message 7654 TCP/MSRP *
    a=accept-types:text/cpim text/plain text/html
    a=path:msrp://x2s.example.com:7654/jshA7weztas;tcp
    a=chatroom:nickname private-message
</pre></div>
<p>Here the Session Description Protocol offer specifies the MSRP-aware XMPP-to-SIP gateway on the XMPP side as well as other particulars of the session.
</p>
<p></p>
<blockquote class="text">
<p>There is no direct mapping for the MSRP URIs.  In fact MSRP URIs identify a session of instant messages at a particular device; they are ephemeral and have no meaning outside the scope of that session.  The authority component of the MSRP URI MUST contain the XMPP-to-SIP gateway hostname or numeric IP address and an explicit port number.
</p>
</blockquote>

<p>As specified in <a class='info' href='#SIP-XMPP'>[SIP&#8209;XMPP]<span> (</span><span class='info'>Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; March&nbsp;2009.</span><span>)</span></a>, the mapping of XMPP syntax elements to SIP and <a class='info' href='#SDP'>[SDP]<span> (</span><span class='info'>Handley, M., Jacobson, V., and C. Perkins, &ldquo;SDP: Session Description Protocol,&rdquo; July&nbsp;2006.</span><span>)</span></a> syntax elements SHOULD be as shown in the following table.  (Mappings for elements not mentioned are undefined.)
</p>
<p>Table 1: Message syntax mapping from XMPP to SIP/SDP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    +-----------------------------+-----------------------------+
    |  XMPP Element or Attribute  |  SIP Header or SDP Contents |
    +-----------------------------+-----------------------------+
    |  from                       |  From                       |
    |  to (without the /nick)     |  To                         |
    +-----------------------------+-----------------------------+
</pre></div>
<p>Here we assume that the chat room server accepts the session establishment. It includes the 'isfocus' and other relevant feature tags in the Contact header field of the response. The chat room server also includes an answer session description that acknowledges the choice of media and contains the extensions specified in <a class='info' href='#MSRP-MULTI'>[MSRP&#8209;MULTI]<span> (</span><span class='info'>Niemi, A., Garcia-Martin, M., and G. Sandbakken, &ldquo;Multi-party Instant Message (IM) Sessions Using the Message Session Relay  Protocol (MSRP),&rdquo; October&nbsp;2009.</span><span>)</span></a>.
</p>
<p>Example: (F3) the chat room accepts the session establishment
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  SIP/2.0 200 OK
  To: &lt;sip:verona@chat.shakespeare.net&gt;
  From: &lt;sip:juliet@example.com&gt;;tag=786
  Call-ID: 711609sa
  Contact: &lt;sip:verona@chat.shakespeare.net;transport=tcp&gt;\
           ;methods="INVITE,BYE,OPTIONS,ACK,CANCEL,SUBSCRIBE,NOTIFY"\
           ;automata;isfocus;message;event="conference"
  Content-Type: application/sdp
  Content-Lenght: [length]

  c=IN IP4 shakespeare.net
  m=message 12763 TCP/MSRP *
  a=accept-types:message/cpim
  a=accept-wrapped-types:text/plain text/html *
  a=path:msrp://s2x.shakespeare.net:12763/kjhd37s2s20w2a;tcp
</pre></div>
<p>Upon receiving such a response, the SIMPLE server or associated SIP-to-XMPP gateway MUST send a SIP ACK to the SIP user.
</p>
<p>Example: (F4) the Gateway sends ACK to the chat room server
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    ACK sip:verona@chat.shakespeare.net SIP/2.0
    To: &lt;sip:verona@chat.shakespeare.net&gt;;tag=087js
    From: &lt;sip:juliet@example.com&gt;;tag=786
    Call-ID: 711609sa
</pre></div>
<a name="xmpp-nicksetup"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Setting up a nickname</h3>

<p>If the chat room server accepted the session, the SIMPLE server or associated SIP-to-XMPP gateway MUST set up the nickname as received in the presence stanza. The nickname is set up using the extension specified in <a class='info' href='#MSRP-MULTI'>[MSRP&#8209;MULTI]<span> (</span><span class='info'>Niemi, A., Garcia-Martin, M., and G. Sandbakken, &ldquo;Multi-party Instant Message (IM) Sessions Using the Message Session Relay  Protocol (MSRP),&rdquo; October&nbsp;2009.</span><span>)</span></a>
</p>
<p>Example: (F5) the Gateway set up the nickname
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP a786hjs2 NICKNAME
    To-Path: msrp://s2x.shakespeare.net:12763/kjhd37s2s20w2a;tcp
    From-Path: msrp://x2s.example.com:7654/jshA7weztas;tcp
    Use-Nickname: "juliet"
    -------a786hjs2
</pre></div>
<p>The chat room server analyzes the existing allocation of nicknames, accepts the nick name proposal and answers with a 200   
        response.
</p>
<p>Example: (F6) the chat room accepts the nickname proposal
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP a786hjs2 200 OK
    To-Path: msrp://x2s.example.com:7654/jshA7weztas;tcp
    From-Path: msrp://s2x.shakespeare.net:12763/kjhd37s2s20w2a;tcp
    -------a786hjs2
</pre></div>
<a name="xmppf-presence"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Presence Broadcast</h3>

<p>If the multi-user chat service accepts the request to enter a room, the xmpp user expects to receive back presence 
      information from all the existing occupants' room. So the XMPP-to-SIP gateway MUST SUBSCRIBE to the Conference Event
      package <a class='info' href='#RFC4575'>[RFC4575]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and O. Levin, &ldquo;A Session Initiation Protocol (SIP) Event Package for Conference State,&rdquo; August&nbsp;2006.</span><span>)</span></a> on the MSRP conference server. When the subscription is completed the MSRP conference
      server send back to the XMPP-to-SIP gateway a NOTIFY with the presence information from all the existing occupants' room
</p>
<p>Example: (F9) the chat room notifies the presence information
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    NOTIFY sip:verona@chat.shakespeare.net SIP/2.0
    To: Juliet &lt;sip:juliet@example.com&gt;;tag=43524545
    From: &lt;sip:verona@chat.shakespeare.net&gt;;tag=a3343df32
    Call-ID: k3l43id034ksereree
    Event: conference
    Subscription-State: active;expires=3600
    Content-Type: application/conference-info+xml
    Content-Length: ...


    &lt;conference-info version="0" state="full"
     entity="sip:3402934234@conf.example.com"&gt;
     &lt;conference-description&gt;
      &lt;subject&gt;Today in Verona&lt;/subject&gt;
      &lt;conf-uris&gt;
       &lt;entry&gt;
        &lt;uri&gt;tel:+18882934234&lt;/uri&gt;
       &lt;/entry&gt;
      &lt;/conf-uris&gt;
     &lt;/conference-description&gt;
     &lt;users&gt;
      &lt;user entity="sip:romeo@example.com" state="full"&gt;
       &lt;nickname-text&gt;romeo&lt;/nickname-text&gt;
        &lt;roles&gt;
         &lt;entry&gt;participant&lt;/entry&gt;
        &lt;/roles&gt;
      &lt;/user&gt;
     &lt;/users&gt;
    &lt;/conference-info&gt;

</pre></div>
<p></p>
<blockquote class="text"><dl>
<dt>[NOTE: 1]</dt>
<dd> a full mapping of RFC 4575 will be defined later on.
</dd>
<dt>[NOTE: 2]</dt>
<dd> the &lt;nickname-text/&gt; attribute is an extension to the conference package
        explained but not defined in <a class='info' href='#MSRP-MULTI'>[MSRP&#8209;MULTI]<span> (</span><span class='info'>Niemi, A., Garcia-Martin, M., and G. Sandbakken, &ldquo;Multi-party Instant Message (IM) Sessions Using the Message Session Relay  Protocol (MSRP),&rdquo; October&nbsp;2009.</span><span>)</span></a> 
</dd>
<dt>[NOTE: 3]</dt>
<dd>the subject (if present in the NOTIFY) must be sent with a separate &lt;message/&gt; stanza;
        so after F11 there should be another &lt;message/&gt; stanza from the gw to the joining party
</dd>
</dl></blockquote>

<p></p>
<blockquote class="text"><dl>
<dt>[OPEN ISSUE: 1]</dt>
<dd> how to send to the room jid with the subject child set: do we need to send it in a different presence stanza
        that the F11?
</dd>
</dl></blockquote>

<p> Upon receiving such a response, the SIP-to-XMPP gateway MUST send a 200 OK to the MSRP conference server and
        translate it in an xmpp presence stanza.
</p>
<p>Example: (F11) the chat room presence information translated in XMPP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;presence from='romeo@example.com/romeo'
     to='verona@chat.shakespeare.net/juliet'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
      &lt;item affiliation='none' role='participant'/&gt;
     &lt;/x&gt;
    &lt;/presence&gt;
</pre></div>
<p>As specified in ???, the mapping of SIP and SDP syntax elements to XMPP syntax elements SHOULD be as shown in the following table.  (Mappings for elements not mentioned are undefined.)
</p>
<p>Table 2: Message syntax mapping from SIP/SDP to XMPP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    +-----------------------------+-----------------------------+
    | SIP Header or SDP Contents  | XMPP Element or Attribute   |
    +-----------------------------+-----------------------------+
    |  &lt;user entity=...&gt;          |  From                       |
    |  To + / &lt;nickname-text&gt;     |  To                         |
    |  roles                      |  role                       |
    |  'none'                     |  affiliation                |
    +-----------------------------+-----------------------------+
</pre></div>
<p></p>
<blockquote class="text"><dl>
<dt>[OPEN ISSUE: 1]</dt>
<dd> how to match the &lt;roles/&gt; SIP Conference attribute in the XMPP 
        &lt;affiliation/&gt; and &lt;role/&gt;. In XMPP roles are current privileges within the room while, affiliations 
        are kept permanently in different sessions (they are the default for a given user).
</dd>
</dl></blockquote>

<a name="xmppf-exchange"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Exchanging Messages</h3>

<p>Once the user has joined the chat room, the user can exchange an unbounded number of messages both public and private.
</p>
<p>The mapping of XMPP syntax elements to MSRP syntax elements SHOULD be as shown in the following table.
        (Mappings for elements not mentioned are undefined.)
</p>
<p>Table 3: Message syntax mapping from XMPP Message to MSRP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    +-----------------------------+-----------------------------+
    |  XMPP Element or Attribute  |  CPIM Header                |
    +-----------------------------+-----------------------------+
    |  to                         |  To                         |
    |  from                       |  From                       |
    |  &lt;body/&gt;                    |  body of the SEND request   |
    +-----------------------------+-----------------------------+
</pre></div>
<a name="xmppf-messageToAll"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.1"></a><h3>2.4.1.&nbsp;
Sending a Message to All Occupants</h3>

<p>When Juliet wants to sends a message to all other occupants in the room, she sends a message of type "groupchat" to 
        &lt;room@service&gt; itself (i.e. &lt;verona@chat.shakespeare.net&gt; in our example).
</p>
<p>The following examples show an exchange of a public message.
</p>
<p>Example: (F12) Juliet sends a Message to all occupants
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;message from='juliet@example.com'
              to='verona@chat.shakespeare.net'
              type='groupchat'&gt;
          &lt;body&gt;Who knows where Romeo is?&lt;/body&gt;
    &lt;/message&gt;
</pre></div>
<p>Upon receiving such stanza message, the XMPP-to-SIP gateway MUST translate it in an MSRP SEND message.
</p>
<p>Example: (F13) Gateway transforms XMPP message to MSRP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP a786hjs2 SEND
    To-Path: msrp://s2x.shakespeare.net:12763/kjhd37s2s20w2a;tcp
    From-Path: msrp://x2s.example.com:7654/jshA7weztas;tcp
    Message-ID: 87652491
    Byte-Range: 1-*/*
    Content-Type: message/cpim

    To: &lt;sip:verona@chat.shakespeare.net;transport=tcp&gt;
    From: &lt;sip:juliet@example.com&gt;
    DateTime: 2008-10-15T15:02:31-03:00
    Content-Type: text/plain

    Who knows where Romeo is?
    -------a786hjs2$
</pre></div>
<p>Upon receiving the SEND request, if the request either contains a Failure-Report header field value of "yes" 
        or does not contain a Failure-Report header at all, MSRP conference server MUST immediately generate and send 
        a response.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP d93kswow 200 OK
    To-Path: msrp://x2s.example.com:7654/jshA7weztas;tcp
    From-Path: msrp://s2x.shakespeare.net:12763/kjhd37s2s20w2a;tcp
    -------d93kswow$
</pre></div>
<p>Since the XMPP room could be moderated and an XMPP User can not be sure whether his message has been accepted
        or not, without an echo from the server, the <a class='info' href='#MUC'>[MUC]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Multi-User Chat,&rdquo; July&nbsp;2008.</span><span>)</span></a> states that the sender have to receive back the
        same message it has generated. So in this scenario the XMPP-to-SIP gateway has to generate the echo message.
</p>
<a name="xmppf-privatemessage"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.2"></a><h3>2.4.2.&nbsp;
Sending a Private Message</h3>

<p>Since each occupant has a unique JID, Juliet MAY send a "private message" to a selected occupant via the
        service by sending a message to the occupant's room JID. The message type SHOULD be "chat" and MUST NOT be
        "groupchat", but MAY be left unspecified.
</p>
<p>The following examples show an exchange of a private message.
</p>
<p>Example: (F12) Juliet sends a private message
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;message from='juliet@example.com'
              to='verona@chat.shakespeare.net/romeo'
              type='chat'/&gt;
          &lt;body&gt;O Romeo, Romeo! wherefore art thou Romeo?&lt;/body&gt;
    &lt;/message&gt;
</pre></div>
<p>Upon receiving such stanza message, the XMPP-to-SIP gateway MUST translate it in an MSRP SEND message.
</p>
<p>Example: (F13) Gateway transforms XMPP message to MSRP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP a786hjs2 SEND
    To-Path: msrp://s2x.shakespeare.net:12763/kjhd37s2s20w2a;tcp
    From-Path: msrp://x2s.example.com:7654/jshA7weztas;tcp
    Message-ID: 87652491
    Byte-Range: 1-*/*
    Content-Type: message/cpim

    To: &lt;sip:romeo@chat.shakespeare.net&gt;
    From: &lt;sip:juliet@chat.shakespeare.net&gt;
    DateTime: 2008-10-15T15:02:31-03:00
    Content-Type: text/plain

    O Romeo, Romeo! wherefore art thou Romeo?
    -------a786hjs2$
</pre></div>
<a name="xmppf-exit"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Exiting a Room</h3>

<p>If Juliet decides to exit the multi-user chat room, her client sends a presence stanza of type "unavailable" to the &lt;verona@chat.shakespeare.net/juliet&gt; she is currently using in the room.
</p>
<p>Example: (F16) Juliet exiting a chatroom
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;presence from='juliet@example.com'
             to='verona@chat.shakespeare.net/juliet'
             type='unavailable'&gt;
    &lt;/presence&gt;
</pre></div>
<p>Upon receiving such stanza exiting the multi-user chat room, the XMPP-to-SIP gateway terminates the SIP session by sending a SIP BYE to MSRP conference server. The MSRP conference server then responds with a 200 OK.
</p>
<p>Juliet MAY include a custom exit message in the presence stanza of type "unavailable"
</p>
<p>Example: (F16) Juliet exiting a chatroom
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;presence from='juliet@example.com'
             to='verona@chat.shakespeare.net/juliet'
             type='unavailable'&gt;
      &lt;status&gt;I can not chat now!&lt;/status&gt;
    &lt;/presence&gt;
</pre></div>
<p>Upon receiving such stanza exiting the multi-user chat room, the XMPP-to-SIP gateway MUST before delivering the message and then, after the message is successfully delivered, it terminates the SIP session by sending a SIP BYE to MSRP conference server. The MSRP conference server then responds with a 200 OK.
</p>
<a name="xmppf-nickConflict"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6"></a><h3>2.6.&nbsp;
Nickname Conflict</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                                  MSRP conference
XMPP User                      GW                       server
    |                          |                          |
    |(F1) (XMPP) Entering a room                          |
    |-------------------------&gt;|                          |
    |                          |(F2) (SIP) INVITE         |
    |                          |-------------------------&gt;|
    |                          |(F3) (SIP) 200 OK         |
    |                          |&lt;-------------------------|
    |                          |(F4) (SIP) ACK            |
    |                          |-------------------------&gt;|
    |                          |                          |
    |                          |(F5) (MSRP) NICKNAME      |
    |                          |-------------------------&gt;|
    |                          |(F6) (MSRP) 423 OK        |
    |                          |&lt;-------------------------|
    |                          |                          |
    |(F7) (XMPP) Presence Error
    |&lt;-------------------------|                          |
    .                          .                          .
    |                          |(F8) (SIP) BYE            |
    |                          |-------------------------&gt;|
    |                          |(F9) (SIP) 200 OK         |
    |                          |&lt;-------------------------|
</pre></div>
<p>The chat room server analyzes the existing allocation of nicknames, and detects that the nickname proposal
        is already provided to another partecipant by the conference. In this case the MSRP conference server answers
        with a 423 response.
</p>
<p>Example: (F6) the chat room does not accept the nickname proposal
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP a786hjs2 423 Nickname usage failed
    To-Path: msrp://x2s.example.com:7654/jshA7weztas;tcp
    From-Path: msrp://s2x.shakespeare.net:12763/kjhd37s2s20w2a;tcp
    -------a786hjs2
</pre></div>
<p> Upon receiving such a response, the SIP-to-XMPP gateway MUST translate it in an xmpp presence stanza of type "error"
        specifying a &lt;conflict/&gt; error condition.
</p>
<p>Example: (F7) Juliet sends a Message to all occupants
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;presence from='verona@chat.shakespeare.net'
              to='juliet@example.com'
              type='error'&gt;
      &lt;x xmlns='http='http://jabber.org/protocol/muc'/&gt;
      &lt;error type='cancel'&gt;
        &lt;conflict xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'/&gt;
      &lt;/error&gt;
    &lt;/presence&gt;
</pre></div>
<a name="xmppf-nickChanging"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7"></a><h3>2.7.&nbsp;
Changing Nickname</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                                  MSRP conference
XMPP User                      GW                       server
    |                          |                          |
    |(F1) (XMPP) Presence changing Nickname               |
    |-------------------------&gt;|                          |
    |                          |(F2) (MSRP) NICKNAME      |
    |                          |-------------------------&gt;|
    |                          |(F3) (MSRP) 200 OK        |
    |                          |&lt;-------------------------|

</pre></div>
<p>If Juliet decides to changing her nickname within the room, she SHOULD send an update presence information to the room, 
      specifically she SHOULD send a new Nickname in the same room.
</p>
<p>Example: (F1) Juliet changing the nickname
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;presence from='juliet@example.com'
             to='verona@chat.shakespeare.net/July'&gt;
    &lt;/presence&gt;

</pre></div>
<a name="msrp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
MSRP Multiparty Instant Message (IM) Session to XMPP Group Chat</h3>

<p>This section describes how to map a Multi-party Instant Message (IM) MSRP session to an XMPP Group Chat.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                                    XMPP Chat
SIP User                     GW                       room
   |                         |                          |
   |(F1)(SIP) INVITE         |                          |
   |------------------------&gt;|                          |
   |(F2) (SIP) 200 OK        |                          |
   |&lt;------------------------|                          |
   |(F3) (SIP) ACK           |                          |
   |------------------------&gt;|                          |
   |                         |                          |
   |(F4) (MSRP) NICKNAME     |                          |
   |------------------------&gt;|                          |
   |                         |(F5)(XMPP) Entering a room|
   |                         |-------------------------&gt;|
   |(F6) (MSRP) 200 OK       |                          |
   |&lt;------------------------|                          |
   |                         |(F7)(XMPP) (XMPP) Presence|
   |                         |&lt;-------------------------|
   |(ISSUE)how to handle F7  |                          |
   |    if the user has not  |                          |
   |    yet SUBSCRIBE to     |                          |
   |    Event: conference    |                          |
   |                         |                          |
   |(F8)(SIP) SUBSCRIBE      |                          |
   |------------------------&gt;|                          |
   |     Event:conference    |                          |
   |                         |                          |
   |(F9) (SIP) 200 OK        |                          |
   |&lt;------------------------|                          |
   |                         |                          |
   |(F10) (SIP) NOTIFY       |                          |
   |&lt;------------------------|                          |
   |(F11) (SIP) 200 OK       |                          |
   |------------------------&gt;|                          |
   |                         |                          |
   |(F12)(MSRP) SEND         |                          |
   |------------------------&gt;|                          |
   |                         |(F13)(XMPP) A chat message|
   |(F14)(MSRP) 200 OK       |-------------------------&gt;|
   |&lt;------------------------|(F15)(XMPP) A chat message|
   |                         |&lt;-------------------------|
   |(F16)(MSRP) SEND         |                          |
   |&lt;------------------------|                          |
   |(F17)(MSRP) 200 OK       |                          |
   |------------------------&gt;|                          |
   .                         .                          .
   .                         .                          .
   |                         |                          |
   |(F18)(SIP) BYE           |                          |
   |------------------------&gt;|                          |
   |                         |(F19)(XMPP) Exiting a room|
   |                         |-------------------------&gt;|
   |(F20)(SIP) 200 OK        |                          |
   |&lt;------------------------|                          |
</pre></div>
<a name="mrsp-init"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Entering a Room</h3>

<p>When the MSRP user ("Romeo") wants to join a multi-user chat room ("Verona"), he first has to start the SIP session by sending out
      a SIP INVITE request containing an offered session description that includes an MSRP media line accompanied by a mandatory "path" and
      "chatroom" attributes. The MSRP media line is also accompanied by an "accept-types" attribute specifing support for a Message/CPIM top 
      level wrapper for the MSRP message.
</p>
<p>Example: (F1) SIP user starts the session
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    INVITE sip:verona@chat.shakespeare.net SIP/2.0
    To: &lt;sip:verona@chat.shakespeare.net&gt;
    From: &lt;sip:romeo@example.com&gt;;tag=786
    Call-ID: 742510no
    Content-Type: application/sdp
    Content-Lenght: [length]

    c=IN IP4 s2x.example.net
    m=message 7313 TCP/MSRP *
    a=accept-types:message/cpim text/plain text/html
    a=path:msrp://s2x.example.net:7313/ansp71weztas;tcp
    a=chatroom:nickname private-message
</pre></div>
<p></p>
<blockquote class="text"><dl>
<dt>[OPEN ISSUE: 1]</dt>
<dd><a class='info' href='#MSRP-MULTI'>[MSRP&#8209;MULTI]<span> (</span><span class='info'>Niemi, A., Garcia-Martin, M., and G. Sandbakken, &ldquo;Multi-party Instant Message (IM) Sessions Using the Message Session Relay  Protocol (MSRP),&rdquo; October&nbsp;2009.</span><span>)</span></a> does not say anything abouth the inclusion of the SDP "chatroom" attribute in the INVITE
              however that is the only way for a GW to understand the the INVITE is establishing a group-chat session
</dd>
</dl></blockquote>

<p>Upon receiving the INVITE, the SIP-to-XMPP gateway needs to determine the identity of the remote domain, which it does by 
        performing one or more DNS SRV lookups <a class='info' href='#DNS-SRV'>[DNS&#8209;SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a>. The SIP-to-XMPP gateway SHOULD resolve the address present in the
       To header of the INVITE to an im URI, then follow the rules in <a class='info' href='#IMP-SRV'>[IMP&#8209;SRV]<span> (</span><span class='info'>Peterson, J., &ldquo;Address Resolution for Instant Messaging and Presence,&rdquo; August&nbsp;2004.</span><span>)</span></a> regarding the "_im" SRV service for the
       target domain contained in the To header. If SRV address resolution fails for the "_im" service, the SIP-to-XMPP gateway MAY attempt
       a lookup for the "_xmpp-server" service as specified in <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> or MAY return an error to the sender (i.e.  502 Bad
       Gateway).
</p>
<p>If SRV address resolution succeeds, the SIP-to-XMPP gateway SHOULD answer successfuly with a SIP 200 OK (F2), but it MUST not
        yet translate the request into an XMPP presece stanza before the MSRP user set up the nickname.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  SIP/2.0 200 OK
  To: &lt;sip:verona@chat.shakespeare.net&gt;
  From: &lt;sip:romeo@example.com&gt;;tag=786
  Contact: &lt;sip:x2s.example.com;transport=tcp&gt; \
           ;methods="INVITE,BYE,OPTIONS,ACK,CANCEL,SUBSCRIBE,NOTIFY"\
           ;automata;isfocus;message;event="conference"
  Call-ID: 742510no
  Content-Type: application/sdp

  c=IN IP4 x2s.example.com
  m=message 8763 TCP/MSRP *
  a=accept-types:message/cpim text/plain text/html
  a=path:msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp
</pre></div>
<p></p>
<blockquote class="text"><dl>
<dt>[OPEN ISSUE: 1]</dt>
<dd>the GW could use a temporary nick name and translate directly the request into a XMPP presence stanza, entering the XMPP
           chat room
</dd>
</dl></blockquote>

<p>Example: (F4) the MSRP user set up the nickname
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP a786hjs2 NICKNAME
    To-Path: path:msrp://s2x.example.net:7313/ansp71weztas;tcp
    From-Path: path:msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp
    Use-Nickname: "romeo"
        -------a786hjs2
</pre></div>
<p>Upon receiving the MSRP NICKNAME request, the SIP-to-XMPP gateway is responsible to generate an XMPP presence stanza and
        sending it to the hostname hosting that chat room.
</p>
<p>Example: (F5) Romeo entering a chatroom
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;presence from='romeo@example.com'
             to='verona@chat.shakespeare.net/romeo'&gt;
      &lt;x xmlns='http='http://jabber.org/protocol/muc'/&gt;
    &lt;/presence&gt;
</pre></div>
<p>If the room does not already contain another user with the nickname, the service accept the access. So if the GW does not
        receive any stanza of type "error" specifying a &lt;conflict/&gt; error condition, it MUST answer the MSRP nickname proposal
        with a 200 OK response (F6).
</p>
<p>Example: (F6) 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP a786hjs2 200 OK
    To-Path: path:msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp
    From-Path: path:msrp://s2x.example.net:7313/ansp71weztas;tcp
        -------a786hjs2
</pre></div>
<a name="msrp-presence"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Presence Broadcast</h3>

<p>If the multi-user chat service is able to add the user to the room, it sends presence from all the existing occupants' room
        JIDs to the new occupants's full JID, including extended presence information about roles in an &lt;x/&gt; element.
</p>
<p>Example: (F7) the chat room presence information translated in XMPP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;presence from='verona@chat.shakespeare.net/juliet'
     to='juliet@example.com'&gt;
     &lt;x xmlns='http://jabber.org/protocol/muc#user'&gt;
      &lt;item affiliation='none' role='participant'/&gt;
     &lt;/x&gt;
    &lt;/presence&gt;
</pre></div>
<p> Upon receiving such a response, if the MSRP has already complited the subscription to the Conference Event package
        <a class='info' href='#RFC4575'>[RFC4575]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and O. Levin, &ldquo;A Session Initiation Protocol (SIP) Event Package for Conference State,&rdquo; August&nbsp;2006.</span><span>)</span></a>, the XMPP-to-SIP gateway MUST translate it in a SIP NOTIFY request.
</p>
<p>Example: (F10) the XMPP-to-SIP notifies the presence information
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    NOTIFY sip:romeo@example.com SIP/2.0
    To: Juliet &lt;sip:romeo@example.com&gt;;tag=43524545
    From: &lt;sip:verona@chat.shakespeare.net&gt;;tag=a3343df32
    Call-ID: k3l43id034ksererff
    Event: conference
    Subscription-State: active;expires=3600
    Content-Type: application/conference-info+xml
    Content-Length: ...


    &lt;conference-info version="0" state="full"
     entity="sip:3402934234@conf.example.com"&gt;
     &lt;conference-description&gt;
      &lt;subject&gt;Today in Verona&lt;/subject&gt;
      &lt;conf-uris&gt;
       &lt;entry&gt;
        &lt;uri&gt;tel:+18882934234&lt;/uri&gt;
       &lt;/entry&gt;
      &lt;/conf-uris&gt;
     &lt;/conference-description&gt;
     &lt;users&gt;
      &lt;user entity="sip:juliet@example.com" state="full"&gt;
       &lt;nickname-text&gt;juliet&lt;/nickname-text&gt;
        &lt;roles&gt;
         &lt;entry&gt;participant&lt;/entry&gt;
        &lt;/roles&gt;
      &lt;/user&gt;
     &lt;/users&gt;
    &lt;/conference-info&gt;

</pre></div>
<a name="mrsp-exchange"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Exchanging Messages</h3>

<p>Once the user has joined the chat room, the user can exchange an unbounded number of messages both public and private.
</p>
<p>The mapping of MSRP syntax elements to XMPP syntax elements SHOULD be as shown in the following table.
        (Mappings for elements not mentioned are undefined.)
</p>
<p>Table 4: Message syntax mapping from MSRP Message to XMPP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    +-----------------------------+-----------------------------+
    |  CPIM Header                |XMPP Element or Attribute    |
    +-----------------------------+-----------------------------+
    |  To                         |  to                         |
    |  From                       |  from                       |
    |  body of the SEND request   |  &lt;body/&gt;                    |
    +-----------------------------+-----------------------------+
</pre></div>
<a name="msrp-messageToAll"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1"></a><h3>3.3.1.&nbsp;
Sending a Message to All Occupants</h3>

<p>When Romeo wants to sends a message to all other occupants in the room, he sends a MSRP SEND request to 
        &lt;room@service&gt; itself (i.e. &lt;verona@chat.shakespeare.net&gt; in our example).
</p>
<p>Example: (F12) ROMEO sends a message to the chat room
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP a786hjs2 SEND
    To-Path: path:msrp://s2x.example.net:7313/ansp71weztas;tcp
    From-Path: path:msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp
    Message-ID: 87652492
    Byte-Range: 1-*/*
    Content-Type: message/cpim

    To: &lt;sip:verona@chat.shakespeare.net;transport=tcp&gt;
    From: &lt;sip:juliet@example.com&gt;
    DateTime: 2008-10-15T15:02:31-03:00
    Content-Type: text/plain

    Romeo is here!
    -------a786hjs2$
</pre></div>
<p>Upon receiving the SEND request, if the request either contains a Failure-Report header field value of "yes" 
        or does not contain a Failure-Report header at all, the SIP-to-XMPP gateway MUST immediately translate in a xmpp message stanza (F13)
        and then generate and send an MSRP response (F14).
</p>
<p>The following examples show an exchange of a public message.
</p>
<p>Example: (F13) Romeo sends a Message to all occupants
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;message from='romeo@example.com'
              to='verona@chat.shakespeare.net'
              type='groupchat'&gt;
          &lt;body&gt;Romeo is here!&lt;/body&gt;
    &lt;/message&gt;
</pre></div>
<p>Example: (F14) the SIP-to-XMPP send the MSRP response
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP d93kswow 200 OK
    To-Path: path:msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp
    From-Path: path:msrp://s2x.example.net:7313/ansp71weztas;tcp
    -------d93kswow$
</pre></div>
<p></p>
<blockquote class="text"><dl>
<dt>[OPEN ISSUE: 1]</dt>
<dd>The SIP-to-XMPP gateway will receive back the echo message from the Chat room service. The SIP-to-XMPP gateway 
           has to translate it back to the MSRP user or no?
</dd>
</dl></blockquote>

<a name="msrp-privatemessage"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.2"></a><h3>3.3.2.&nbsp;
Sending a Private Message</h3>

<p>Romeo MAY send a "private message" to a selected occupant via the chat room service by sending a message 
        to the occupant's room nick name.
</p>
<p>The following examples show an exchange of a private message.
</p>
<p>Example: (F12) Romeo sends a private message
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP a786hjs2 SEND
    To-Path: path:msrp://s2x.example.net:7313/ansp71weztas;tcp
    From-Path: path:msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp
    Message-ID: 87652492
    Byte-Range: 1-*/*
    Content-Type: message/cpim

    To: &lt;sip:juliet@chat.shakespeare.net&gt;
    From: &lt;sip:romeo@example.com&gt;
    DateTime: 2008-10-15T15:02:31-03:00
    Content-Type: text/plain

    I am here!!!
    -------a786hjs2$
</pre></div>
<p>Example: (F13) Juliet sends a private message
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;message from='romeo@example.com'
              to='verona@chat.shakespeare.net/juliet'
              type='chat'/&gt;
          &lt;body&gt;I am here!!!&lt;/body&gt;
    &lt;/message&gt;
</pre></div>
<a name="msrp-exit"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Exiting a Room</h3>

<p>If Romeo decides to exit the multi-user chat room, his client sends SIP BYE to the &lt;verona@chat.shakespeare.net&gt;
         chat room.
</p>
<p>Example: (F11) Romeo terminates the session
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    BYE sip:verona@chat.shakespeare.net SIP/2.0
    Max-Forwards: 70
    From: &lt;sip:romeo@example.net&gt;;tag=786
    To: &lt;sip:verona@chat.shakespeare.net&gt;;tag=534
    Call-ID: 742510no
    Cseq: 1 BYE
    Content-Length: 0
</pre></div>
<p>Upon receiving the SIP BYE, the SIP-to-XMPP gateway translate it in a presence stanza (F19) and send it to the XMPP chat room
        service. Then the SIP-to-XMPP gateway responds with a 200 OK to the MSRP user.
</p>
<p>Example: (F19) Juliet exiting a chatroom
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;presence from='romeo@example.com'
             to='verona@chat.shakespeare.net/romeo'
             type='unavailable'&gt;
    &lt;/presence&gt;
</pre></div>
<a name="msrp-nickConflict"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Nickname Conflict</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                                  XMPP conference
SIP User                      GW                       server
   |                         |                          |
   |(F1)(SIP) INVITE         |                          |
   |------------------------&gt;|                          |
   |(F2) (SIP) 200 OK        |                          |
   |&lt;------------------------|                          |
   |(F3) (SIP) ACK           |                          |
   |------------------------&gt;|                          |
   |                         |                          |
   |(F4) (MSRP) NICKNAME     |                          |
   |------------------------&gt;|                          |
   |                         |(F5)(XMPP) Entering a room|
   |                         |-------------------------&gt;|
   |                         |(F7) (XMPP) Presence Error|
   |                         |&lt;-------------------------|
   |(F6) (MSRP) 423 OK       |                          |
   |&lt;------------------------|                          |
   |                         |                          |

</pre></div>
<a name="msrp-nickChanging"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6"></a><h3>3.6.&nbsp;
Changing Nickname</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                                  XMPP conference
SIP User                      GW                       server
    |                          |                          |
    |(F1) (MSRP) NICKNAME      |                          |
    |-------------------------&gt;|                          |
    |                          |(F2) (XMPP) Presence w/ Nickname
    |                          |-------------------------&gt;|
    |(F3) (MSRP) 200 OK        |                          |
    |&lt;-------------------------|                          |

</pre></div>
<p>If Romeo decides to changing her nickname within the room, he SHOULD send a
     new MSRP NICKNAME request. In fact modification of the nickname in MSRP is
     not different from the initial reservation and usage of a nickname.
</p>
<p>Example: (F1) the MSRP user changes the nickname
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    MSRP a786hjs2 NICKNAME
    To-Path: path:msrp://s2x.example.net:7313/ansp71weztas;tcp
    From-Path: path:msrp://x2s.example.com:8763/lkjh37s2s20w2a;tcp
    Use-Nickname: "montecchi"
        -------a786hjs2
</pre></div>
<p>Upon receiving such message, the SIP-to-XMPP gateway MUST translate it in a XMPP presence stanza.
</p>
<p>Example: (F2) Juliet changing the nickname
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    &lt;presence from='juliet@example.com'
             to='verona@chat.shakespeare.net/montecchi'&gt;
    &lt;/presence&gt;

</pre></div>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>To follow.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>5.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="IMP-SRV">[IMP-SRV]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3861">Address Resolution for Instant Messaging and Presence</a>,&rdquo; RFC&nbsp;3861, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3861.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="MSRP">[MSRP]</a></td>
<td class="author-text">Campbell, B., Mahy, R., and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4975">The Message Session Relay Protocol (MSRP)</a>,&rdquo; RFC&nbsp;4975, September&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc4975.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="MUC">[MUC]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P.</a>, &ldquo;<a href="http://www.xmpp.org/extensions/xep-0045.html">Multi-User Chat</a>,&rdquo; XSF XEP&nbsp;0045, July&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP">[SIP]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TERMS">[TERMS]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP">[XMPP]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3920">Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; RFC&nbsp;3920, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3920.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3920.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3920.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP-IM">[XMPP-IM]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3921">Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence</a>,&rdquo; RFC&nbsp;3921, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3921.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3921.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3921.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>5.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="DNS-SRV">[DNS-SRV]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P., and <a href="mailto:levone@microsoft.com">L. Esibov</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782, February&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2782.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="MSRP-MULTI">[MSRP-MULTI]</a></td>
<td class="author-text">Niemi, A., Garcia-Martin, M., and G. Sandbakken, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-chat-03.txt">Multi-party Instant Message (IM) Sessions Using the Message Session Relay  Protocol (MSRP)</a>,&rdquo; draft-ietf-simple-chat-03 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-chat-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4575">[RFC4575]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., and O. Levin, &ldquo;<a href="http://tools.ietf.org/html/rfc4575">A Session Initiation Protocol (SIP) Event Package for Conference State</a>,&rdquo; RFC&nbsp;4575, August&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4575.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SDP">[SDP]</a></td>
<td class="author-text">Handley, M., Jacobson, V., and C. Perkins, &ldquo;<a href="http://tools.ietf.org/html/rfc4566">SDP: Session Description Protocol</a>,&rdquo; RFC&nbsp;4566, July&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4566.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP-XMPP">[SIP-XMPP]</a></td>
<td class="author-text">Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-saintandre-sip-xmpp-core-01.txt">Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; draft-saintandre-sip-xmpp-core-01 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-saintandre-sip-xmpp-core-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP-XMPP-CHAT">[SIP-XMPP-CHAT]</a></td>
<td class="author-text">Saint-Andre, P., Gavita, E., Hossain, N., and S. Loreto, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-saintandre-sip-xmpp-chat-03.txt">Interworking between the Session Initiation Protocol (SIP) and the  Extensible Messaging and Presence Protocol (XMPP): One-to-One Text Chat</a>,&rdquo; draft-saintandre-sip-xmpp-chat-03 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-saintandre-sip-xmpp-chat-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP-XMPP-IM">[SIP-XMPP-IM]</a></td>
<td class="author-text">Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-saintandre-sip-xmpp-im-01.txt">Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Instant Messaging</a>,&rdquo; draft-saintandre-sip-xmpp-im-01 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-saintandre-sip-xmpp-im-01.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Peter Saint-Andre</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:psaintan@cisco.com">psaintan@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Salvatore Loreto</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ericsson</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hirsalantie 11</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jorvas  02420</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Salvatore.Loreto@ericsson.com">Salvatore.Loreto@ericsson.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Fabio Forno</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bluendo srl</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Via Morosini 10</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Torino  10128</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Italy</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:fabio@bluendo.com">fabio@bluendo.com</a></td></tr>
</table>
</body></html>
