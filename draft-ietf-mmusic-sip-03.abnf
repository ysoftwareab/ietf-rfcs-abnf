SIP-URL            =    short-sip-url | full-sip-url
full-sip-url       =    "sip://" user [ ":" password ] "@" host
                                url-parameters [ headers ]
short-sip-url      =    user [ ":" password ] "@" host : port
user               =    ;  defined in RFC 1738 [18]
host               =    ;  defined in RFC 1738
port               =    *digit
url-parameters     =    *( ";" url-parameter)
url-parameter      =    transport-param |
                                ttl-param | maddr-param
transport-param    =    "transport=" ( "udp" | "tcp" )
ttl-param          =    "ttl=" ttl
ttl                =    1*3DIGIT                                     ; 0 to 255
maddr-param        =    "maddr=" maddr
maddr              =    ;  dotted decimal multicast address
headers            =    "?" header *( "                            " header )
header             =    hname "=" hvalue
hname              =    *urlc
hvalue             =    *urlc
urlc               =    ;  defined in [17]


SIP-message = Request | Response  ; SIP messages
generic-message    =    start-line
                                *message-header
                                CRLF
                                [ message-body ]

start-line         =    Request-Line | Status-Line




Request     =    Request-Line          ; Section 4.1
                         *( general-header
                         | request-header
                         | entity-header )
                         CRLF
                         [ message-body ]

Response    =    Status-Line           ; Section 5.1
                         *( general-header
                         | response-header
                         | entity-header )
                         CRLF
                         [ message-body ]



general-header     =     Call-ID                ; Section 6.11
                      |     Date                   ; Section 6.14
                      |     Expires                ; Section 6.15
                      |     From                   ; Section 6.16
                      |     Sequence               ; Section 6.26
                      |     Via                    ; Section 6.31
entity-header      =     Content-Length         ; Section 6.12
                      |     Content-Type           ; Section 6.13
request-header     =     Accept                 ; Section 6.6
                      |     Accept-Language        ; Section 6.7
                      |     Authorization          ; Section 6.9
                      |     Organization           ; Section 6.18
                      |     Priority               ; Section 6.20
                      |     Proxy-Authorization    ; Section 6.22
                      |     Reach                  ; Section 6.24
                      |     Subject                ; Section 6.28
                      |     To                     ; Section 6.29
                      |     User-Agent             ; Section 6.30
response-header    =     Location               ; Section 6.17
                      |     Proxy-Authenticate     ; Section 6.21
                      |     Public                 ; Section 6.23
                      |     Retry-After            ; Section 6.25
                      |     Server                 ; Section 6.27
                      |     Warning                ; Section 6.32
                      |     WWW-Authenticate       ; Section 6.33


Request    =    Request-Line         ;  Section 4.1
                        *( general-header
                        | request-header
                        | entity-header )
                        CRLF
                        [ message-body ]     ;  Section 8


Request-Line = Method SP Request-URI SP SIP-Version CRLF
method    =    "INVITE" | "CONNECTED" | "OPTIONS" | "BYE"
                 |     "REGISTER" | "UNREGISTER"


Response    =    Status-Line          ;  Section 5.1
                         *( general-header
                         | response-header
                         | entity-header )
                         CRLF
                         [ message-body ]     ;  Section 8


Status-Line = SIP-version SP Status-Code SP Reason-Phrase
Status-Code       =    "100"                         ;  Trying
                    |     "180"                         ;  Ringing
                    |     "200"                         ;  OK
                    |     "300"                         ;  Multiple Choices
                    |     "301"                         ;  Moved Permanently
                    |     "302"                         ;  Moved Temporarily
                    |     "303"                         ;  See Other
                    |     "305"                         ;  Use Proxy
                    |     "380"                         ;  Alternative Service
                    |     "400"                         ;  Bad Request
                    |     "401"                         ;  Unauthorized
                    |     "402"                         ;  Payment Required
                    |     "403"                         ;  Forbidden
                    |     "404"                         ;  Not Found
                    |     "405"                         ;  Method Not Allowed
                    |     "407"                         ;  Proxy Authentication Required
                    |     "408"                         ;  Request Timeout
                    |     "409"                         ;  Conflict
                    |     "410"                         ;  Gone
                    |     "411"                         ;  Length Required
                    |     "412"                         ;  Precondition Failed
                    |     "413"                         ;  Request Message Body Too Large
                    |     "414"                         ;  Request-URI Too Large
                    |     "415"                         ;  Unsupported Media Type
                    |     "420"                         ;  Bad Extension
                    |     "480"                         ;  Temporarily not available
                    |     "500"                         ;  Internal Server Error
                    |     "501"                         ;  Not Implemented
                    |     "502"                         ;  Bad Gateway
                    |     "503"                         ;  Service Unavailable
                    |     "504"                         ;  Gateway Timeout
                    |     "505"                         ;  SIP Version not supported
                    |     "600"                         ;  Busy
                    |     "603"                         ;  Decline
                    |     "604"                         ;  Does not exist anywhere
                    |     "606"                         ;  Not Acceptable
                    |     extension-code
extension-code    =    3DIGIT
Reason-Phrase     =    *<TEXT,  excluding CR, LF>


message-header    =    field-name ":" [ field-value ] CRLF
field-name        =    token
field-value       =    *( field-content | LWS )
field-content     =    < the OCTETs  making up the field-value
                                and consisting of either *TEXT or combinations
                                of token, tspecials, and quoted-string>


Call-ID    =     ( "Call-ID" | "i" ) ":" atom "@" host


Content-Length = "Content-Length" ":" 1*DIGIT

Content-Type = "Content-Type" ":" media-type

Expires = "Expires" ":" ( HTTP-date | delta-seconds )

From = ( "From" | "f" ) ":" *1( ( SIP-URL | URL ) [ comment
Location              =    ( "Location" | "m" ) ( SIP-URL | URL )
                                   *( ";" location-params )
extension-name       =     token
extension-value      =     *( token | quoted-string | LWS | extension-specials)
extension-specials   =      < any element of  tspecials except <"> >
language-tag         =     <  see [H3.10] >
service-tag          =     "fax" | "IP" | "PSTN" | "ISDN" | "pager" | "voice-mail
                                   | "attendant"
media-tag            =      < see SDP: "audio" | "video" | ...
feature-list         =      to be determined



location-params       =    "q"                     "="    qvalue
                         |    "mobility"              "="    ( "fixed" | "mobile" )
                         |    "class"                 "="    ( "personal" | "business" )
                         |    "language"              "="    1# language-tag
                         |    "service"               "="    1# service-tag
                         |    "media"                 "="    1# media-tag
                         |    "features"              "="    1# feature-list
                         |    "description"           "="    quoted-string
                         |    "duplex"                "="    ( "full" | "half" | "receive-only" |
                                                             "send-only" )
                         |    extension-attributes
extension-attribute   =    extension-name          "="    extension-value


language=en,es,iw ;q=0.5
duplex=send-only;media=text; q=0.1



Priority          =    "Priority" ":" priority-value
priority-value    =    "urgent" | "normal" | "non-urgent"


Reach = "Reach" ":" 1#( "first" | "all" ) ( "do-not-
Retry-After = "Retry-After" ":" ( HTTP-date | delta-seconds
Sequence = "Sequence" ":" 1*DIGIT

Subject = ( "Subject" | "s" ) ":" *text

To = ( "To" | "t" ) ":" ( SIP-URL | URL ) [ comment ]

Via                   =    ( "Via" | "v") ":" 1#( sent-protocol sent-by
                                   *( ";" via-params ) [ comment ] )
via-params            =    "ttl" "=" ttl
                             |     "fanout"
sent-protocol         =    [ protocol-name "/" ] protocol-version
protocol-name         =    "SIP" | token
protocol-version      =    token
transport             =    "UDP" | "TCP"
sent-by               =    host [ ":" port ]
ttl                   =    1*3DIGIT                                         ; 0 to 255


Warning          =    "Warning" ":" 1#warning-value
warning-value    =    warn-code SP warn-agent SP warn-text
warn-code        =    2DIGIT
warn-agent       =    ( host [ ":" port ] ) | pseudonym
                              ;  the name or pseudonym of the server adding
                              ;  the Warning header, for use in debugging
warn-text        =    quoted-string


v=0
o=user1 53655765 2353687637 IN IP4 128.3.4.5
s=Mbone Audio
i=Discussion of Mbone Engineering Issues
e=mbone@somewhere.com
c=IN IP4 224.2.0.1/127
t=0 0
m=audio 3456 RTP/AVP 0
v=0
o=schooler 4858949 4858949 IN IP4 192.1.2.3
t=0 0
m=audio 5004 RTP/AVP 0
c=IN IP4 131.215.131.147



v=0
o=mm-server 2523535 0 IN IP4 131.215.131.131
s=Answering Machine
i=Leave an audio message
c=IN IP4 131.215.131.131
t=0 0
m=audio 12345 RTP/AVP 0



v=0
o=mm-server 2523535 0 IN IP4 131.215.131.131
s=Answering Machine
i=Leave an audio message
c=IN IP4 128.16.64.19
t=0 0
m=audio 26472 RTP/AVP 0



v=0
s=Lets talk
b=CT:128
c=IN IP4 131.215.131.131
m=audio 3456 RTP/AVP 7 0 13
m=video 2232 RTP/AVP 31



language=en,es,iw ;q=0.5
duplex=send-only;media=text; q=0.1



v=0
m=audio 0 RTP/AVP 0 1 3 99
m=video 0 RTP/AVP 29 30
v=0
o=user1 53655765 2353687637 IN IP4 128.3.4.5
s=Mbone Audio
i=Discussion of Mbone Engineering Issues
e=mbone@somewhere.com
c=IN IP4 224.2.0.1/127
t=0 0
m=audio 3456 RTP/AVP 0



N = /* number of addresses to try */
r = await_response();
class = r.status / 100;

best = r.status;
multicast = 0;
best = r.status;
best = r.status;
best = 404;
CR       =    %d13            ;  carriage return character
LF       =    %d10            ;  line feed character
CRLF     =    CR LF           ;  typically the end of a line
SP       =    %d32            ;  space character
TAB      =    %d09            ;  tab character
LWS      =    *( SP | TAB)    ;  linear whitespace
DIGIT    =    "0" .. "9"      ;  a single decimal digit



