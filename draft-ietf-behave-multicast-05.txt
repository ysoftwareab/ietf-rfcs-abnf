


BEHAVE                                                           D. Wing
Internet-Draft                                             Cisco Systems
Intended status:  Best Current                               May 9, 2007
Practice
Expires:  November 10, 2007


  Multicast Requirements for a Network Address Port Translator (NAPT)
                     draft-ietf-behave-multicast-05

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on November 10, 2007.

Copyright Notice

   Copyright (C) The IETF Trust (2007).

Abstract

   This document specifies requirements for a Network Address Translator
   (NAT) and Network Address and Port Translator (NAPT) that supports
   any-source multicast or single-source multicast.  A multicast-capable
   NAPT device that adheres to the requirements of this document can
   optimize the operation of multicast applications that are generally
   unaware of multicast NAPT devices.




Wing                    Expires November 10, 2007               [Page 1]

Internet-Draft         NAPT Multicast Requirements              May 2007


Table of Contents

   1.  Problem Statement  . . . . . . . . . . . . . . . . . . . . . .  3
   2.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  3
     2.1.  Scope  . . . . . . . . . . . . . . . . . . . . . . . . . .  3
     2.2.  Background . . . . . . . . . . . . . . . . . . . . . . . .  4
   3.  Conventions Used in this Document  . . . . . . . . . . . . . .  5
   4.  Requirements . . . . . . . . . . . . . . . . . . . . . . . . .  5
     4.1.  IGMP/MLD Proxy . . . . . . . . . . . . . . . . . . . . . .  5
     4.2.  IGMPv1 and IGMPv2 NAPTs  . . . . . . . . . . . . . . . . .  5
     4.3.  IGMPv3 NAPT  . . . . . . . . . . . . . . . . . . . . . . .  5
     4.4.  UDP mapping lifetime with ASM transmission . . . . . . . .  5
     4.5.  Considerations for Source-Specific Multicast (SSM) . . . .  6
   5.  Security Considerations  . . . . . . . . . . . . . . . . . . .  7
   6.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . .  7
   7.  Acknowledgments  . . . . . . . . . . . . . . . . . . . . . . .  7
   8.  References . . . . . . . . . . . . . . . . . . . . . . . . . .  7
     8.1.  Normative References . . . . . . . . . . . . . . . . . . .  7
     8.2.  Informational References . . . . . . . . . . . . . . . . .  8
   Author's Address . . . . . . . . . . . . . . . . . . . . . . . . .  8
   Intellectual Property and Copyright Statements . . . . . . . . . . 10






























Wing                    Expires November 10, 2007               [Page 2]

Internet-Draft         NAPT Multicast Requirements              May 2007


1.  Problem Statement

   In order for multicast applications to function well over NATs,
   multicast UDP must work as seamlessly as unicast UDP.  However, NATs
   have little consistency in multicast operation which results in
   inconsistent user experiences and failed multicast operation.


2.  Introduction

   This document describes how an IGMP/MLD proxy device [RFC4605] can
   NAPT multicast traffic so that existing any-source multicast
   applications and single-source multicast applications can function
   without awareness of NAPT device.

   Such a NAPT device will send and receive IGMP membership reports and
   queries.  When it does so, it functions exactly like a non-NAPTted
   IGMP/MLD Proxy [RFC4605].  This is because IGMP packets are link
   local, and for IGMPv3 are not forwarded (but rather aggregated) by
   the device's IGMP/MLD Proxying function.  For example, when the
   IGMPv3 proxying device receives an IGMP membership on an inside
   interface, it creates its own IGMP proxying membership state and its
   own IGMP/MLD forwarding table.  It then creates an independent IGMP
   membership report on its outside interface reporting the multicast
   groups/channels -- but there is no direct relationship or "relaying"
   of IGMP membership reports or queries across the interfaces.  The
   NAPT device will subsequently receive a multicast data packet on the
   outside ('public') interface and forward the multicast packet to
   inside ('internal') interfaces based on its IGMP/MLD forwarding
   table.

   As with normal NAPT operation for unicast flows, multicast packets
   received from the outside interface and forwarded to the inside
   interface do not have their source IP addresses changed.  Such
   multicast packets do not need to have their destination IP address
   changed (unless the NAT device wishes to establish septate multicast
   domains, but this is not the typical operation).

   As with normal NAPT operation for unicast flows, multicast packets
   received from an inside interface and forwarded to the public
   interface do have their source IP address changed to the public IP
   interface of the NAPT and their source UDP port changed to a port
   selected by the NAPT.  This NAPT is commonly called a 'mapping'.

2.1.  Scope

   This document describes the behavior of a device providing any-source
   multicast or source-specific multicast proxy functions as described



Wing                    Expires November 10, 2007               [Page 3]

Internet-Draft         NAPT Multicast Requirements              May 2007


   in [RFC4605] using IGMPv1 [RFC1112], or IGMPv2 [RFC2236], or IGMPv3
   [RFC3376] and that additionally functions as a Network Address and
   Port Translator (NAPT), as described in section 4.1.2 of [RFC2663].

   Out of scope of this document are PIM-SM [RFC4601] and IPv6
   [RFC2460].  The IGMP Proxy devices that are scoped in this document
   do not forward PIM-SM.  IPv6 is out of scope because NAPT is not
   considered necessary with IPv6.

   This document is a companion document to "NAT Behavioral Requirements
   for Unicast UDP" [RFC4787].

2.2.  Background

   When a NAPT isn't used, a host might be connected to the Internet in
   a configuration such as this:

                            +-------------+
                 +------+   |  DSL modem  |    +------------+
                 | host +---+     or      +-//-+ WAN Router |
                 +------+   | cable modem |    +------------+
                            +-------------+

               Figure 1: Network without NATting IGMP Proxy

   The primary functions of an IGMP proxy device are to collect IGMP
   traffic from the 'inside' interface, aggregate them, and transmit the
   aggregated IGMP membership information to the 'outside' interface.
   Additionally, multicast traffic is accepted from the 'inside' and
   (more typically) from the 'outside' interface and routed to the other
   interface(s) based on forwarding state established by the IGMP/MLP
   proxy routing.  Packets with a multicast destination IP address do
   not have their destination IP address changed by a NAPT.  However,
   their source IP address and source UDP port is changed if the packet
   goes from an 'inside' interface of a NAPT to the 'outside' interface
   of a NAPT -- similar to the behavior of a unicast packet across those
   same interfaces.

          +----+   +-------------+
          |host+---+ +---------+ |  +-----------+
          +----+   | |Multicast| |  | DSL modem |    +------------+
                   | |  Proxy  | +--+    or     +-//-+ WAN Router |
          inside   | +---------+ |  |cable modem|    +------------+
        interfaces |             |  +-----------+
                   |  +------+   |
          +----+   |  | NAPT |   |  outside
          |host+---+  +------+   | interfaces
          +----+   +-------------+



Wing                    Expires November 10, 2007               [Page 4]

Internet-Draft         NAPT Multicast Requirements              May 2007


                IGMP Proxy NAPT Device

                 Figure 2: Network with NAPTing IGMP Proxy


3.  Conventions Used in this Document

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [RFC2119].


4.  Requirements

4.1.  IGMP/MLD Proxy

   REQ-1:  A device compliant with this specification MUST implement
           [RFC4605].

4.2.  IGMPv1 and IGMPv2 NAPTs

   REQ-2:  If a NAPT supports only IGMPv1 or IGMPv2 (but not IGMPv2), it
           MAY simply receive IGMP membership reports on the inside
           interface, NAT them, and relay the IGMP membership report.
           That is, the NAPT does not need to do any aggregation of IGMP
           messages.

4.3.  IGMPv3 NAPT

   REQ-3:  If a NAPT supports IGMPv3, the NAPT MUST aggregate the IGMPv3
           membership reports, and report the aggregated information
           upstream.

   Failure to do this aggregation will cause undesired temporary
   blackholing of multicast traffic.  For example, consider two hosts
   behind the same NAPT.  If one host is joining a session at the same
   time another is lesaving the session, and the NAPT merely relays the
   join and leave upstream, the session will be terminated and the join
   and leave announcements do not comply with section 5 of [RFC3376].

4.4.  UDP mapping lifetime with ASM transmission

   Any-sosurce multicast (ASM) uses the IP addresses in the 224.0.0.0 -
   239.255.255.255 range [IANA-ALLOC].







Wing                    Expires November 10, 2007               [Page 5]

Internet-Draft         NAPT Multicast Requirements              May 2007


   REQ-4:  If a host on the inside interface of a NAPT belongs to an
           any-source multicast host group and sends a UDP packet to the
           same group, the NAPT MUST have a UDP mapping timer of 60
           minutes for that mapping.

           a.  This UDP mapping SHOULD be destroyed when the host leaves
               that host group.

           b.  If a NAPT has exhausted its resources, the NAPT MAY time
               out that mapping before 60 minutes have elapsed, but this
               is discouraged.

               Note that even in a situation with resource exhaustion, a
               NAPT is still required to follow the minimum mapping
               duration of 2 minutes (REQ-5 of [RFC4787]).

   Discussion:  If a NAPT merely followed the requirements of [RFC4787]
   it could cause problems for RTP [RFC3550].  RTP uses the source
   transport address (source IP address and source UDP port) and the
   RTP/RTCP SSRC value to identify session members.  If a session member
   sees the same SSRC arrive from a different transport address, that
   session member will perform RTP collision detection (section 8.2 of
   [RFC3550]).  If a NAPT merely followed the requirements of [RFC4787]
   and timed out a UDP session after 2 minutes of inactivity and RTCP
   receiver reports are sent less often than every 2 minutes, RTP
   collision detection would be performed by other session members
   sharing the same SSRC, complicating diagnostic tools and potentially
   interfering with jitter buffer algorithms.  This situation can occur,
   for example, with a multicast group of approximately 300 members with
   a normal 50kbps audio RTP stream.

   To prevent this unnecessary RTP collision detection by other session
   members, the other session members need to see the same source
   transport address for the RTP and RTCP traffic from the NAPTed host.
   This requires the NAPT to assign the same UDP source port for that
   RTCP traffic.  This requirement also facilitates other, non-RTP
   multicast applications which may function similarly.

4.5.  Considerations for Source-Specific Multicast (SSM)

   Source-specific multicast uses the IP addresses in the 232/8
   (232.0.0.0 to 232.255.255.255) range [IANA-ALLOC].

   REQ-5:  When implementing a NAPT that operates with Source-Specific
           Multicast [RFC4607], the NAPT MUST:






Wing                    Expires November 10, 2007               [Page 6]

Internet-Draft         NAPT Multicast Requirements              May 2007


           a.  implement IGMPv3 according to section 4.2 of [RFC4607],
               and;

           b.  follow the requirements in section Section 4.3 of this
               document.

   Primarily due to NAPTs functioning as IGMP/MLD proxies with multiple
   receivers behind the NAT, multicast applications are encouraged to
   use identifiers, rather than IP addresses and UDP ports, to identify
   specific multicast receivers (e.g., [I-D.ietf-avt-rtcpssm] encourages
   SSM applications to not rely exclusively on transport addresses for
   collision detection).  As compared to any-source multicast, the use
   of such receiver identifiers removes the need for the NAT to have
   long mapping timers; instead, the timers in [RFC4787] are used when a
   host transmits to a single-source multicast address.


5.  Security Considerations

   Compliance with this specification does not increase security risks
   beyond those already discussed in the Security Considerations section
   of IGMPv3 [RFC3376] and IGMP/MLD Proxying [RFC4605].


6.  IANA Considerations

   This document does not require any IANA registrations.


7.  Acknowledgments

   Thanks to Yiqun Cai, Stephen Casner, Toerless Eckert, Alfred Hines,
   Marcus Maranhao, Bryan McLaughlin, and Magnus Westerlund for their
   assistance in writing this document.


8.  References

8.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC2236]  Fenner, W., "Internet Group Management Protocol, Version
              2", RFC 2236, November 1997.

   [RFC3376]  Cain, B., Deering, S., Kouvelas, I., Fenner, B., and A.
              Thyagarajan, "Internet Group Management Protocol, Version



Wing                    Expires November 10, 2007               [Page 7]

Internet-Draft         NAPT Multicast Requirements              May 2007


              3", RFC 3376, October 2002.

   [RFC3550]  Schulzrinne, H., Casner, S., Frederick, R., and V.
              Jacobson, "RTP: A Transport Protocol for Real-Time
              Applications", STD 64, RFC 3550, July 2003.

   [RFC4605]  Fenner, B., He, H., Haberman, B., and H. Sandick,
              "Internet Group Management Protocol (IGMP) / Multicast
              Listener Discovery (MLD)-Based Multicast Forwarding
              ("IGMP/MLD Proxying")", RFC 4605, August 2006.

   [RFC4787]  Audet, F. and C. Jennings, "Network Address Translation
              (NAT) Behavioral Requirements for Unicast UDP", BCP 127,
              RFC 4787, January 2007.

8.2.  Informational References

   [I-D.ietf-avt-rtcpssm]
              Chesterfield, J., "RTCP Extensions for Single-Source
              Multicast Sessions with Unicast Feedback",
              draft-ietf-avt-rtcpssm-13 (work in progress), March 2007.

   [IANA-ALLOC]
              Internet Assigned Numbers Authority, "Internet Multicast
              Addresses",
              <http://www.iana.org/assignments/multicast-addresses>.

   [RFC1112]  Deering, S., "Host extensions for IP multicasting", STD 5,
              RFC 1112, August 1989.

   [RFC2460]  Deering, S. and R. Hinden, "Internet Protocol, Version 6
              (IPv6) Specification", RFC 2460, December 1998.

   [RFC2663]  Srisuresh, P. and M. Holdrege, "IP Network Address
              Translator (NAT) Terminology and Considerations",
              RFC 2663, August 1999.

   [RFC4601]  Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas,
              "Protocol Independent Multicast - Sparse Mode (PIM-SM):
              Protocol Specification (Revised)", RFC 4601, August 2006.

   [RFC4607]  Holbrook, H. and B. Cain, "Source-Specific Multicast for
              IP", RFC 4607, August 2006.








Wing                    Expires November 10, 2007               [Page 8]

Internet-Draft         NAPT Multicast Requirements              May 2007


Author's Address

   Dan Wing
   Cisco Systems
   170 West Tasman Drive
   San Jose, CA  95134
   USA

   Email:  dwing@cisco.com










































Wing                    Expires November 10, 2007               [Page 9]

Internet-Draft         NAPT Multicast Requirements              May 2007


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in BCP 78, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.


Acknowledgment

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).





Wing                    Expires November 10, 2007              [Page 10]

