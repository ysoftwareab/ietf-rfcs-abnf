<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Secure Vector Routing (SVR)</title>
<meta content="Abilash Menon" name="author">
<meta content="Michael Baj" name="author">
<meta content="Patrick Timmons" name="author">
<meta content="Hadriel Kaplan" name="author">
<meta content="
       This document describes Secure Vector Routing (SVR). Secure Vectors
      contain application layer metadata used for authentication and
      communicating network intent between data routers. The metadata is
      extensible, and could be used to transmit information, network routes,
      security policies, and quality policies securely across network
      boundaries. Boundaries include those formed by private network RFC1918
      networks with the IPv4 public internet, and the IPv6 public
      internet. 
    " name="description">
<meta content="xml2rfc 3.10.0" name="generator">
<meta content="draft-menon-svr-00" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.10.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.2
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 58.0.4
    six 1.16.0
-->
<link href="/tmp/draft-menon-svr-00-lj59ibd3.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Secure Vector Routing (SVR)</td>
<td class="right">October 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Menon, et al.</td>
<td class="center">Expires 4 April 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-menon-svr-00</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-10-01" class="published">1 October 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-04-04">4 April 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A. Menon</div>
<div class="org">Juniper Networks</div>
</div>
<div class="author">
      <div class="author-name">M. Baj</div>
<div class="org">Juniper Networks</div>
</div>
<div class="author">
      <div class="author-name">P. Timmons</div>
<div class="org">Juniper Networks</div>
</div>
<div class="author">
      <div class="author-name">H. Kaplan</div>
<div class="org">Juniper Networks</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Secure Vector Routing (SVR)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes Secure Vector Routing (SVR). Secure Vectors
      contain application layer metadata used for authentication and
      communicating network intent between data routers. The metadata is
      extensible, and could be used to transmit information, network routes,
      security policies, and quality policies securely across network
      boundaries. Boundaries include those formed by private network RFC1918
      networks with the IPv4 public internet, and the IPv6 public
      internet.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 4 April 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-overview" class="xref">Overview</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-qualified-service-name-qsn" class="xref">Qualified Service Name (QSN)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-theory-of-operation-of-secu" class="xref">Theory of operation of Secure Vector Routing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-svr-peer-definition" class="xref">SVR Peer Definition</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-svr-peer-paths" class="xref">SVR Peer Paths</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-directionality" class="xref">Directionality</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="xref">2.4</a>.  <a href="#name-metadata-handshake" class="xref">Metadata Handshake</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="xref">2.5</a>.  <a href="#name-path-obstructions" class="xref">Path Obstructions</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="xref">2.6</a>.  <a href="#name-metadata-removal" class="xref">Metadata removal</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.7">
                <p id="section-toc.1-1.2.2.7.1"><a href="#section-2.7" class="xref">2.7</a>.  <a href="#name-modification-of-transport-a" class="xref">Modification of transport   addresses</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.8">
                <p id="section-toc.1-1.2.2.8.1"><a href="#section-2.8" class="xref">2.8</a>.  <a href="#name-unique-5-tuples-for-every-s" class="xref">Unique 5-Tuples for Every Session</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.9">
                <p id="section-toc.1-1.2.2.9.1"><a href="#section-2.9" class="xref">2.9</a>.  <a href="#name-session-state-requirements" class="xref">Session State Requirements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.10">
                <p id="section-toc.1-1.2.2.10.1"><a href="#section-2.10" class="xref">2.10</a>. <a href="#name-waypoint-addresses" class="xref">Waypoint Addresses</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-metadata-format-and-composi" class="xref">Metadata Format and Composition</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-metadata-header" class="xref">Metadata Header</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="xref">3.1.1</a>.  <a href="#name-false-positives" class="xref">False Positives</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="xref">3.1.2</a>.  <a href="#name-header-attributes" class="xref">Header Attributes</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.3">
                    <p id="section-toc.1-1.3.2.1.2.3.1"><a href="#section-3.1.3" class="xref">3.1.3</a>.  <a href="#name-payload-attributes" class="xref">Payload Attributes</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.4">
                    <p id="section-toc.1-1.3.2.1.2.4.1"><a href="#section-3.1.4" class="xref">3.1.4</a>.  <a href="#name-forward-and-reverse-attribu" class="xref">Forward and Reverse Attributes</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-header-attributes-2" class="xref">Header Attributes</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-fragment" class="xref">Fragment</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="xref">3.2.2</a>.  <a href="#name-security-identifier" class="xref">Security Identifier</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.3">
                    <p id="section-toc.1-1.3.2.2.2.3.1"><a href="#section-3.2.3" class="xref">3.2.3</a>.  <a href="#name-disable-forward-metadata" class="xref">Disable Forward Metadata</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.4">
                    <p id="section-toc.1-1.3.2.2.2.4.1"><a href="#section-3.2.4" class="xref">3.2.4</a>.  <a href="#name-ipv4-router-egress-source-a" class="xref">IPv4 Router Egress Source Address</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.5">
                    <p id="section-toc.1-1.3.2.2.2.5.1"><a href="#section-3.2.5" class="xref">3.2.5</a>.  <a href="#name-ipv4-router-egress-source-ad" class="xref">IPv4 Router Egress Source Address</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.6">
                    <p id="section-toc.1-1.3.2.2.2.6.1"><a href="#section-3.2.6" class="xref">3.2.6</a>.  <a href="#name-selective-acknowledgement" class="xref">Selective Acknowledgement</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.7">
                    <p id="section-toc.1-1.3.2.2.2.7.1"><a href="#section-3.2.7" class="xref">3.2.7</a>.  <a href="#name-svr-protocol-message" class="xref">SVR Protocol Message</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.8">
                    <p id="section-toc.1-1.3.2.2.2.8.1"><a href="#section-3.2.8" class="xref">3.2.8</a>.  <a href="#name-path-metrics" class="xref">Path Metrics</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.9">
                    <p id="section-toc.1-1.3.2.2.2.9.1"><a href="#section-3.2.9" class="xref">3.2.9</a>.  <a href="#name-modify-request" class="xref">Modify Request</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-payload-attributes-2" class="xref">Payload Attributes</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.  <a href="#name-forward-context-ipv4" class="xref">Forward Context IPv4</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="xref">3.3.2</a>.  <a href="#name-forward-context-ipv6" class="xref">Forward Context IPv6</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.3">
                    <p id="section-toc.1-1.3.2.3.2.3.1"><a href="#section-3.3.3" class="xref">3.3.3</a>.  <a href="#name-reverse-context-ipv4" class="xref">Reverse Context IPv4</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.4">
                    <p id="section-toc.1-1.3.2.3.2.4.1"><a href="#section-3.3.4" class="xref">3.3.4</a>.  <a href="#name-reverse-context-ipv6" class="xref">Reverse Context IPv6</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.5">
                    <p id="section-toc.1-1.3.2.3.2.5.1"><a href="#section-3.3.5" class="xref">3.3.5</a>.  <a href="#name-session-uuid" class="xref">Session UUID</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.6">
                    <p id="section-toc.1-1.3.2.3.2.6.1"><a href="#section-3.3.6" class="xref">3.3.6</a>.  <a href="#name-source-tenant-name" class="xref">Source Tenant Name</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.7">
                    <p id="section-toc.1-1.3.2.3.2.7.1"><a href="#section-3.3.7" class="xref">3.3.7</a>.  <a href="#name-service-name" class="xref">Service Name</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.8">
                    <p id="section-toc.1-1.3.2.3.2.8.1"><a href="#section-3.3.8" class="xref">3.3.8</a>.  <a href="#name-session-encrypted" class="xref">Session Encrypted</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.9">
                    <p id="section-toc.1-1.3.2.3.2.9.1"><a href="#section-3.3.9" class="xref">3.3.9</a>.  <a href="#name-tcp-syn-packet" class="xref">TCP SYN Packet</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.10">
                    <p id="section-toc.1-1.3.2.3.2.10.1"><a href="#section-3.3.10" class="xref">3.3.10</a>. <a href="#name-source-router-name" class="xref">Source Router Name</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.11">
                    <p id="section-toc.1-1.3.2.3.2.11.1"><a href="#section-3.3.11" class="xref">3.3.11</a>. <a href="#name-source-router-security-name" class="xref">Source Router Security Name</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.12">
                    <p id="section-toc.1-1.3.2.3.2.12.1"><a href="#section-3.3.12" class="xref">3.3.12</a>. <a href="#name-destination-router-name" class="xref">Destination Router Name</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.13">
                    <p id="section-toc.1-1.3.2.3.2.13.1"><a href="#section-3.3.13" class="xref">3.3.13</a>. <a href="#name-peer-path-id" class="xref">Peer Path ID</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.14">
                    <p id="section-toc.1-1.3.2.3.2.14.1"><a href="#section-3.3.14" class="xref">3.3.14</a>. <a href="#name-ipv4-source-nat-address" class="xref">IPv4 Source NAT Address</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-metadata-exchanges-and-use-" class="xref">Metadata Exchanges and Use Cases</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-establishing-a-peer-path" class="xref">Establishing a Peer Path</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-peer-path-status-and-perfor" class="xref">Peer Path Status and Performance</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-sharing-path-metrics-betwee" class="xref">Sharing Path Metrics between routers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.3">
                    <p id="section-toc.1-1.4.2.1.2.3.1"><a href="#section-4.1.3" class="xref">4.1.3</a>.  <a href="#name-testing-path-availability" class="xref">Testing Path Availability</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-new-session-initiation" class="xref">New Session Initiation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="xref">4.2.1</a>.  <a href="#name-first-packet-processing" class="xref">First Packet Processing</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="xref">4.2.2</a>.  <a href="#name-signing-the-metadata" class="xref">Signing the Metadata</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.3">
                    <p id="section-toc.1-1.4.2.2.2.3.1"><a href="#section-4.2.3" class="xref">4.2.3</a>.  <a href="#name-encryption-of-the-metadata" class="xref">Encryption of the Metadata</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.4">
                    <p id="section-toc.1-1.4.2.2.2.4.1"><a href="#section-4.2.4" class="xref">4.2.4</a>.  <a href="#name-receiving-the-first-respons" class="xref">Receiving the First Response Packet</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.5">
                    <p id="section-toc.1-1.4.2.2.2.5.1"><a href="#section-4.2.5" class="xref">4.2.5</a>.  <a href="#name-subsequent-packet-processin" class="xref">Subsequent Packet Processing</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.6">
                    <p id="section-toc.1-1.4.2.2.2.6.1"><a href="#section-4.2.6" class="xref">4.2.6</a>.  <a href="#name-session-termination" class="xref">Session Termination</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.7">
                    <p id="section-toc.1-1.4.2.2.2.7.1"><a href="#section-4.2.7" class="xref">4.2.7</a>.  <a href="#name-unicast-and-asymmetric-flow" class="xref">Unicast and Asymmetric Flows</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-moving-a-session" class="xref">Moving a Session</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-hmac-authentication" class="xref">HMAC Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-replay-prevention" class="xref">Replay Prevention</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-payload-encryption" class="xref">Payload Encryption</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-ddos-and-unexpected-traffic" class="xref">DDoS and Unexpected Traffic on Waypoint Addresses</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-acknowledgements" class="xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">There exists a need to extend network intent across multiple IP networks
and paths to provide an end-to-end experience. Selection of specific paths and
their attributes is a key intent. There is also a need for applications to
communicate their intent to networks. This need is increasing as workloads
move to public cloud and the numbers of cloud locations increase. The standard
practice today is to use an overlay network of tunnels to create a virtual
network. SVR is being proposed as an alternative to using tunnels, which
simplifies the network by virtue of having only one network to manage and
securely transport traffic with encryption and authentication; also, the
absence of tunneling overhead reduces bandwidth. Since SVR specifies intent
abstractly, it also has the capability to interwork policies between different
networks and address spaces.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Most networks are deployed with a virtual private network (VPN) across IP
backbone facilities. VPNs have the significant disadvantage of carrying
additional payload on top of the actual packet thereby leading to IP
fragmentation as well as reduced bandwidth. In this document, SVR is being
proposed as a new technique which is session aware and does not have the
overhead of IP tunnels.<a href="#section-1-2" class="pilcrow">¶</a></p>
<div id="overview">
<section id="section-1.1">
        <h3 id="name-overview">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
        </h3>
<p id="section-1.1-1">A Secure Vector Route (SVR) describes a network intent and shares this
intent in the form of metadata with a routing peer. The intent to a peer
router is conveyed by means of a cookie, often referred to as first packet
metadata, which is placed on the first packet that is targeted towards the
peer. SVR is session aware on every router and sets up a biflow (forward and
reverse flows) based on the intent. Once the session is set up, the cookie is
not sent for the subsequent packets.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<div id="net_diagram">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-1.1-2.1">
<pre>
            +---------+                    +---------+
    +----+  |  Edge   |  (-------------)   |  Edge   |  +----+
    |CPE |--|  Router |--( IP Backbone )---|  Router |--|CPE |
    +----+  |         |  (-------------)   |         |  +----+
            +---------+                    +---------+
                  &lt;-------SVR -------&gt;
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a></figcaption></figure>
</div>
<p id="section-1.1-3">This intent must include:<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-4.1">Authority: This defines the owner of the namespace to be used for
  defining policies. Each namespace owner can allocate Tenant names
  (representing collections of network endpoints sharing common network
  enforcement policy), and Service names (representing accessible destinations
  and traffic treatment policy). Authority namespace allocation will be
  managed like any other domain name reservation.<a href="#section-1.1-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.2">Context: This is the original "5-tuple" of an IP packet, including source
  IP, source port, destination IP, destination port, and protocol. Optionally,
  Layer 2 information such as MAC Address or VLAN tags may be included for
  certain use cases if required.<a href="#section-1.1-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.3">Signature: The metadata must be cryptographically signed using HMAC by
  the source router, so the next hop router can authenticate the sender of the
  data. The portion of the packet that is signed must not include the IP
  header, as it may go through a NAT or IPv4 to IPv6 conversion.<a href="#section-1.1-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.4">Direction: This is the intended client to server direction. The initial
  network packet of a communication session indicates the direction. For
  example, a TCP SYN packet would travel from client to server, defining the
  direction of an intent. Forward direction is always client to server, and
  reverse is always server to client. These directions have nothing to do with
  a network topology (for example, hub and spoke), and a single network path
  could have forward sessions going bi-directionally -- traffic going from
  node A to node B may represent the forward direction for some sessions and
  the reverse direction for other sessions.<a href="#section-1.1-4.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.5">Tenant(s): This is a textual description defining network endpoints that
  share common access policy (allowlists or blocklists to network
  destinations). These may be mapped using any known technique including
  source IP address mask, a VLAN tag, ingress interface, provided by an
  authentication system, or even client supplied, and this mapping is outside
  the scope of this document. Often these are location specific definitions,
  but the tenant has global meaning within an authority. Tenant names can
  conform to domain name syntax, and be expressed as hierarchical structures
  (i.e., location.department.company).<a href="#section-1.1-4.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.6">
            <p id="section-1.1-4.6.1">Service(s): This is a textual description of what server(s) can be
  accessed with this intent. Examples include Zoom, or Office365/Outlook.
  Although outside the scope of this document, these could be defined with any
  known technique, including URLs, IP address(es) protocol(s) and port(s),
  CIDR block(s), etc. Having a single text name to describe a network
  destination makes applying network intent easier. This Service name can be
  used to define all other attributes of network intent including:<a href="#section-1.1-4.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-4.6.2.1">Quality Policy: Associated or imputed by the Service, a description
      of the bandwidth quality that is required. These can be implementation
      specific.<a href="#section-1.1-4.6.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-1.1-4.6.2.2">Security Policy: Associated or imputed by the Service, a description
      of what kinds of encryption may be required and security processing that
      is required. These can be implementation specific.<a href="#section-1.1-4.6.2.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-1.1-4.6.3">These additional attributes are outside the scope of this protocol as
    they are locally defined and associated locally to the specific
    Service.<a href="#section-1.1-4.6.3" class="pilcrow">¶</a></p>
<p id="section-1.1-4.6.4">When performing HMAC signatures, or payload encryption, key management
    is also outside the scope of this document. Standard IKEv2 techniques
    could be applied, or integration with authentication systems may be
    appropriate.<a href="#section-1.1-4.6.4" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="qsn">
<section id="section-1.2">
        <h3 id="name-qualified-service-name-qsn">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-qualified-service-name-qsn" class="section-name selfRef">Qualified Service Name (QSN)</a>
        </h3>
<p id="section-1.2-1">A Secure Vector Route can be described as a Qualified Service Name (QSN).
This is shorthand for a human understanding of a specific network intent
definition. This shorthand is used in use case examples, but is not part of
the specific protocol.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-1.2-2">
<pre>
    QSN://[subtenant.]tenant.authority/service/subservice
</pre><a href="#section-1.2-2" class="pilcrow">¶</a>
</div>
<p id="section-1.2-3">The QSN conforms with the definition of a URL. The QSN describes the
Direction, Tenant, and Service of an SVR. The QSN introduces the concept of a
naming authority, which controls the namespace for subtenants, tenants,
services, and subservices. Examples of QSNs include the following:<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-1.2-4">
<pre>
    QSN://engineering.juniper/github/project
    QSN://engineering.acme/github
</pre><a href="#section-1.2-4" class="pilcrow">¶</a>
</div>
<p id="section-1.2-5">These examples indicate that juniper and acme are different authorities,
and can each completely describe a QSN without defining overlapping intents in
any way. The first example is a name for the intent definition for engineering
at juniper to access github for a specific project. In the second case,
engineering at acme can access any resources defined as github. QSNs will be
used in this document and are useful in describing a high-level intent.<a href="#section-1.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="op_theory">
<section id="section-2">
      <h2 id="name-theory-of-operation-of-secu">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-theory-of-operation-of-secu" class="section-name selfRef">Theory of operation of Secure Vector Routing</a>
      </h2>
<p id="section-2-1">The SVR metadata must be inserted into existing packets directly after the
L4 header, even if the resulting increase in packet size would cause the
packet to require fragmentation. The metadata must be in the very first packet
of a new session (TCP or UDP bidirectional flow) to have any role in path
selection or security. Metadata may be sent in any subsequent packet to
change/update the networking intent. The metadata is inserted into the payload
portion of a packet to guarantee it makes it unchanged through the network.
Packet lengths and checksums must be adjusted accordingly, although adjusting
TCP sequence numbers is not necessary.<a href="#section-2-1" class="pilcrow">¶</a></p>
<div id="svr_peer_define">
<section id="section-2.1">
        <h3 id="name-svr-peer-definition">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-svr-peer-definition" class="section-name selfRef">SVR Peer Definition</a>
        </h3>
<p id="section-2.1-1">A SVR Peer is any client, server, or network element that can understand
  and participate in SVR. Having pre-shared cryptographic keys, and the
  ability to authenticate and decrypt metadata is a prerequisite to being a
  peer. Peers do not have to be directly adjacent, but reachable via IP
  networking, even across network boundaries. Examples of peers include:<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2" class="keepWithNext">A branch router and a data center edge router:<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.1-3">
<pre>
    +-----------+                               +-----------+
    |           |                               |           |
    |  Branch   |  ----------------------------&gt;| Datacenter|
    |  Router   |   Secure Vector Routing(SVR)  |   Router  |
    |           |                               |           |
    +-----------+                               +-----------+
</pre><a href="#section-2.1-3" class="pilcrow">¶</a>
</div>
<p id="section-2.1-4" class="keepWithNext">A client desktop computer and a nearby router:<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.1-5">
<pre>
                                                +-----------+
    +-----------+                               |           |
    |  Computer |  ----------------------------&gt;|  Router   |
    +-----------+   Secure Vector Routing(SVR)  |           |
                                                +-----------+
</pre><a href="#section-2.1-5" class="pilcrow">¶</a>
</div>
<p id="section-2.1-6" class="keepWithNext">A WIFI AP and an edge router:<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.1-7">
<pre>
                                                +-----------+
    +-----------+                               |           |
    |  Wifi AP  |  ----------------------------&gt;|  Router   |
    +-----------+   Secure Vector Routing(SVR)  |           |
                                                +-----------+
</pre><a href="#section-2.1-7" class="pilcrow">¶</a>
</div>
<p id="section-2.1-8" class="keepWithNext">A data center edge router and a VPC based router in a public
    cloud:<a href="#section-2.1-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.1-9">
<pre>
    +-----------+                               +-----------+
    |           |                               |           |
    |  Edge     |  ----------------------------&gt;| Cloud VPC |
    |  Router   |   Secure Vector Routing(SVR)  |           |
    |           |                               |           |
    +-----------+                               +-----------+
</pre><a href="#section-2.1-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="svr_peer_paths">
<section id="section-2.2">
        <h3 id="name-svr-peer-paths">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-svr-peer-paths" class="section-name selfRef">SVR Peer Paths</a>
        </h3>
<p id="section-2.2-1">SVR Peers may have many different possible pathways between them. Each
  path must be discovered, and its service state should be known prior to
  sending metadata. Techniques such as BFD (RFC 5580) could be used to
  determine path availability. Each of these individual paths between peers is
  called a "peer path." Secure Vector routes are always defined and used
  between peers and can support session resiliency across multiple paths.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">Peer paths are defined by their IP addresses or hostnames. Routers with
  multiple interfaces may have multiple peer paths to a next hop router. The
  IP addresses routers use on their interfaces are also referred to as
  waypoints. Every peer path can be defined by a pair of waypoint addresses.
  To avoid confusion when branch or edge devices obtain new IP addresses
  dynamically, these peer paths are assigned a hostname which is used instead.
  The named pathway and associated keys(ip-address/hostname and peer name) are
  provisioned and presumed available in this specification. Details of this
  provisioning are outside the scope of this document.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="directionality">
<section id="section-2.3">
        <h3 id="name-directionality">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-directionality" class="section-name selfRef">Directionality</a>
        </h3>
<p id="section-2.3-1">The protocol utilizes the concept of direction. Direction is either
  forward or reverse; it is not tied to network topology, but rather the
  direction of session establishment. For TCP, the forward direction is always
  the client side towards the server side. For UDP, the forward direction is
  from the sender of the first packet. Reverse is the opposite direction.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">These directions can be used to qualify a path between a pair of SVR
  Peers, the ingress and the egress (forward is from ingress to egress); or to
  qualify metadata (forward metadata is inserted by the ingress).<a href="#section-2.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="handshake">
<section id="section-2.4">
        <h3 id="name-metadata-handshake">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-metadata-handshake" class="section-name selfRef">Metadata Handshake</a>
        </h3>
<p id="section-2.4-1">To ensure the metadata is received and understood between peers, a
  handshake is performed. A router that supports SVR peer paths  inserts
  metadata for each packet flow in the following circumstances:<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.4-2.1">It is a "forward" packet representing a new session and the ingress
    node has not yet received any reverse metadata from the recipient egress
    node.<a href="#section-2.4-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.4-2.2">It is a "reverse" packet from the recipient egress node to the
    initiating ingress node and recipient egress node has not received forward
    packets from this session without metadata.<a href="#section-2.4-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.4-3">These two comprise what is known as the "metadata handshake" -- that is,
  the initiating router includes metadata in all packets it sends to the
  recipient router until it receives a reverse packet with metadata from that
  recipient. Likewise, the recipient continues to send metadata to the
  initiating router until it receives a packet without metadata. This is how
  two routers acknowledge receipt of metadata from their counterparts: the
  absence of metadata in a packet indicates that it has received metadata from
  its counterpart.<a href="#section-2.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="path_obstruct">
<section id="section-2.5">
        <h3 id="name-path-obstructions">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-path-obstructions" class="section-name selfRef">Path Obstructions</a>
        </h3>
<p id="section-2.5-1">Firewalls and middleboxes that sit along a peer path may not tolerate TCP
  SYN messages with data in the payload, or may verify sequence numbers in TCP
  streams (which are invalidated due to the inclusion of SVR metadata). The
  two devices that represent the peer path endpoints may determine through
  testing if there is a firewall, NAT, or other active middlebox between the
  two routers. Procedures for this (like STUN/TURN/ICE) are well known, and
  not included in this document. If a middlebox is detected, the packets can
  be UDP-transformed ie; the protocol byte can be changed from TCP to UDP by
  the transmitting router and restored to TCP by the receiving router for
  packets flowing in both directions. The sequence number of the TCP packet
  will be copied to the TCP checksum location as it will be overwritten by the
  UDP header. The original protocol in use is part of the context in the
  metadata and can be restored by the receiving peer.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="meta_remove">
<section id="section-2.6">
        <h3 id="name-metadata-removal">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-metadata-removal" class="section-name selfRef">Metadata removal</a>
        </h3>
<p id="section-2.6-1">To prevent breaking any applications, there must be a 100% guarantee that
  metadata inserted by a participating SVR device is removed prior to the
  consumption of the data by the application service. If the client and server
  support metadata, then the network intent can be sent end-to-end. When a
  mid-stream packet router wants to insert SVR metadata, it must guarantee
  that the packet is directed to a next hop device that will understand and
  remove the metadata.<a href="#section-2.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="transport_addr_mod">
<section id="section-2.7">
        <h3 id="name-modification-of-transport-a">
<a href="#section-2.7" class="section-number selfRef">2.7. </a><a href="#name-modification-of-transport-a" class="section-name selfRef">Modification of transport   addresses</a>
        </h3>
<p id="section-2.7-1">To guarantee that the packet will go to a specific device, the
  destination address for the packet is changed to the waypoint address of the
  next hop. Because the original addresses are stored in the context field,
  they can be recovered if needed. This is similar to IPv6 segment routing or
  a LISP RLOC with the exception that the original addresses are stored in
  metadata within the payload portion of the packet, and not the IP
  Header.<a href="#section-2.7-1" class="pilcrow">¶</a></p>
<p id="section-2.7-2">To communicate to the next hop the origin of the packet and to define and
  open a return path, the source address of the packet is NATted to the
  interface of the source router. This is called a source waypoint address.
  This provides a return path and can be used to guarantee symmetric flows if
  desired. Once again, the original addresses are state information that the
  source router must maintain.<a href="#section-2.7-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="unique_tuples">
<section id="section-2.8">
        <h3 id="name-unique-5-tuples-for-every-s">
<a href="#section-2.8" class="section-number selfRef">2.8. </a><a href="#name-unique-5-tuples-for-every-s" class="section-name selfRef">Unique 5-Tuples for Every Session</a>
        </h3>
<p id="section-2.8-1">To avoid sharing a hash with all traffic, and to make sessions completely
  independent, the source port and destination port can be assigned any values
  that are unique by the source router. When there are no NATs between the two
  router interfaces, this permits 2^32 (4,294,967,296) different unique
  sessions on a peer path. If there are source NATs, this will be reduced to
  2^16 (65,536) different unique sessions. Ports can be reassigned if not in
  active use. It is also possible that middle boxes will limit what
  destination ports are permissible, reducing the number of possibilities. The
  range of ports that can be used could be discovered at run time by testing a
  peer path, provisioned, or both.<a href="#section-2.8-1" class="pilcrow">¶</a></p>
<p id="section-2.8-2">Note: The ingress SVR peer (client side) assigns both source and
  destination ports. The ingress side always chooses even ports for local
  (source port) and odd ports for remote(destination port) This provides total
  uniqueness between any two peers, with no negotiation or collision
  possibilities. Think of the two ports as a Sessions Identification Tag. Even
  if a session traveling in the opposite direction was allocated the same
  exact ports, because the source address and destination addresses would be
  swapped, the 5 tuples on the wire remain unique.<a href="#section-2.8-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="session_state_reqs">
<section id="section-2.9">
        <h3 id="name-session-state-requirements">
<a href="#section-2.9" class="section-number selfRef">2.9. </a><a href="#name-session-state-requirements" class="section-name selfRef">Session State Requirements</a>
        </h3>
<p id="section-2.9-1">Each participant (peer) in secure vector routing must maintain state for
  every active session. This includes the full set of original addresses and
  translations required. This allows participants to stop sending metadata
  once it has been received by the peer. Should one side lose state
  information, it can notify the other that it must send metadata to restore a
  session. Typically a path change will trigger metadata to be turned on for
  the subsequent forward packets so that the new session state including the
  waypoints can be maintained by the next hop router.<a href="#section-2.9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="waypoint_addrs">
<section id="section-2.10">
        <h3 id="name-waypoint-addresses">
<a href="#section-2.10" class="section-number selfRef">2.10. </a><a href="#name-waypoint-addresses" class="section-name selfRef">Waypoint Addresses</a>
        </h3>
<p id="section-2.10-1">Each SVR router (peer) must statefully remember the source address that a
  session with metadata was received on. This may not be the same address the
  router sent a packet from due to a NAT or Firewall in the pathway. Routers
  use provisioned waypoint addresses, but statefully record and store the
  actual waypoint addresses.<a href="#section-2.10-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="meta_format">
<section id="section-3">
      <h2 id="name-metadata-format-and-composi">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-metadata-format-and-composi" class="section-name selfRef">Metadata Format and Composition</a>
      </h2>
<p id="section-3-1">The format of metadata has both Header attributes as well as Payload
attributes. Header attributes are always guaranteed to be unencrypted. These
headers may be inspected by intermediate network elements but can't be
changed. Payload attributes optionally can be encrypted by the sender. The
pre-existing security association and key sharing is outside the scope of this
document. Each attribute listed below will indicate whether it is a header
attribute (unencrypted) or payload attribute (optionally encrypted).  There
are no attributes that can exist in both sections.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="meta_header">
<section id="section-3.1">
        <h3 id="name-metadata-header">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-metadata-header" class="section-name selfRef">Metadata Header</a>
        </h3>
<p id="section-3.1-1">The metadata header is shown below. A well-known "cookie"
    (0x4c48dbc6ddf6670c in network byte order or 0x0c67f6ddc6db484c in host
    byte order) is built into the header which is used in concert with
    contextual awareness of the packet itself to determine the presence of
    metadata within a packet. This is an eight-byte pattern that immediately
    follows the L4 header and is an indicator to a receiving router that a
    packet contains metadata. NOTE: Because packets are not normally directed
    to a routers interface, all packets arriving on a waypoint should include
    metadata or they will be dropped.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div id="meta_header_diagram">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-3.1-2.1">
<pre>
   0                 1                2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  +                             Cookie                            +
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |Version|   Header Length       |         Payload Length        |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |     Header TLVs ...           |       Payload TLVs ...        |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.1-3">
          <dt id="section-3.1-3.1">Cookie (8 bytes)</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-3.2">The fingerprint of metadata. This value
      is used to determine the existence of metadata within a packet.<a href="#section-3.1-3.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-3.3">Version (4 bits)</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-3.4">Field representing the version of the
      metadata header. The current version of metadata is 0x1.<a href="#section-3.1-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-3.5">Header Length (12 bits)</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-3.6">Length of the metadata header
      including any added optional attributes that are guaranteed to be
      unencrypted. The value of the number of bytes in the header.<a href="#section-3.1-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-3.7">Payload Length (2 bytes)</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-3.8">Length of data following the
      metadata header, not including the size of the header. This data could
      be encrypted.  The value of this field is the number of bytes in the
      payload.<a href="#section-3.1-3.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<div id="false_positives">
<section id="section-3.1.1">
          <h4 id="name-false-positives">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-false-positives" class="section-name selfRef">False Positives</a>
          </h4>
<p id="section-3.1.1-1">Given that no byte sequence is truly unique in the payload of a
      packet, in the scenario where the original payload after the L4 header
      contained the same byte sequence as the cookie, false positive logic is
      enacted on the packet. If the metadata signature can't verify that the
      metadata is valid, then a false positive metadata header is added to the
      packet to indicate that the first eight bytes of the payload matches the
      cookie. The structure of a false positive metadata packet is one which
      has a metadata header length that is the same as the base header size as
      well as having zero payload length. The receiving side of a packet with
      false positive metadata will strip out the metadata header if the next
      hop of the packet is not expecting a metadata header.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1.1-2">In the scenario where a router receives a false positive metadata
      header but intends to add metadata to the packet, the false positive
      metadata header is modified to contain the newly added attributes. Once
      attributes are added, the metadata header is no longer considered to be
      false positive.<a href="#section-3.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hdr_attr">
<section id="section-3.1.2">
          <h4 id="name-header-attributes">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-header-attributes" class="section-name selfRef">Header Attributes</a>
          </h4>
<p id="section-3.1.2-1">Header attributes are unencrypted and not associated with any one
      specific session, and do not have a forward or reverse direction. These
      are tied instead to the router peer path itself. The metadata header
      contains a 12-bit field associated with the header length of the
      metadata header. The field represents the overall length of the header.
      Its base value is 0xC which is the initial length of the metadata
      header.<a href="#section-3.1.2-1" class="pilcrow">¶</a></p>
<p id="section-3.1.2-2">The value 0xC comes from:<a href="#section-3.1.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1.2-3">
<pre>
          64 bits  Cookie Length
           4 bits  Metadata Version
          12 bits  Header Length
        + 16 bits  Payload Length
        --------------------------
        96 bits = 12 bytes decimal = 0xC hex
</pre><a href="#section-3.1.2-3" class="pilcrow">¶</a>
</div>
<p id="section-3.1.2-4">Any value greater than 0xC would indicate that there are optional
      attributes associated with this metadata header which are guaranteed to
      be unencrypted.<a href="#section-3.1.2-4" class="pilcrow">¶</a></p>
<p id="section-3.1.2-5">An example of an optional attribute which would reside in the
      guaranteed unencrypted section of metadata would be per-packet fabric
      fragment attribute. This attribute is not associated with any session or
      encryption schema and as such must not be encrypted.<a href="#section-3.1.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="payload_attr">
<section id="section-3.1.3">
          <h4 id="name-payload-attributes">
<a href="#section-3.1.3" class="section-number selfRef">3.1.3. </a><a href="#name-payload-attributes" class="section-name selfRef">Payload Attributes</a>
          </h4>
<p id="section-3.1.3-1">The metadata header contains a two-byte payload length field which is
      associated with attributes that can be encrypted.<a href="#section-3.1.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="fwd_rev_attr">
<section id="section-3.1.4">
          <h4 id="name-forward-and-reverse-attribu">
<a href="#section-3.1.4" class="section-number selfRef">3.1.4. </a><a href="#name-forward-and-reverse-attribu" class="section-name selfRef">Forward and Reverse Attributes</a>
          </h4>
<p id="section-3.1.4-1">Each metadata payload attribute may be valid in the forward
      direction, the reverse direction, or both. If not valid, it is ignored
      quietly by the receiving side.<a href="#section-3.1.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="header_attr">
<section id="section-3.2">
        <h3 id="name-header-attributes-2">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-header-attributes-2" class="section-name selfRef">Header Attributes</a>
        </h3>
<div id="fragment">
<section id="section-3.2.1">
          <h4 id="name-fragment">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-fragment" class="section-name selfRef">Fragment</a>
          </h4>
<p id="section-3.2.1-1">When a packet is fragmented to insert metadata, a new fragmentation
      mechanism must be added to prevent fragmentation attacks and to support
      reassembly (which requires protocol and port information). If a packet
      is received that IS a fragment, and it must transit through a metadata
      signaled pathway, it must also have this metadata attached to properly
      bind the fragment with the correct session.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-3.2.1-2">All fragments will have a metadata header and the fragment TLV added
      to the guaranteed unencrypted portion of the metadata header. If the
      original packet already has a metadata header on it, the fragment TLV
      will be added to it.<a href="#section-3.2.1-2" class="pilcrow">¶</a></p>
<div id="fragment_attr_diagram">
<figure id="figure-3">
            <div class="alignLeft art-text artwork" id="section-3.2.1-3.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            Type = 1           |           Length = 10         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                         Extended ID                           |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |       Original ID             |Flags|    Fragment Offset      |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |    Largest Seen Fragment      |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.1-4">
            <dt id="section-3.2.1-4.1">Type = 1 decimal (0x01) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-4.2">Identifier for the
        Fragment TLV.<a href="#section-3.2.1-4.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-4.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-4.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.2.1-4.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-4.5">Extended ID (4 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-4.6">Value used for differentiating
        fragment tuples.<a href="#section-3.2.1-4.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-4.7">Original ID (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-4.8">Original identification value of
        the L3 header.<a href="#section-3.2.1-4.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-4.9">Flags (3 bits)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-4.10">
              <p id="section-3.2.1-4.10.1">Field used for identifying fragment
        attributes. They are (in order, from most significant to least
        significant):<a href="#section-3.2.1-4.10.1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-3.2.1-4.10.2.1">bit 0: Reserved; must be zero.<a href="#section-3.2.1-4.10.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal ulEmpty" id="section-3.2.1-4.10.2.2">bit 1: Don't fragment (DF).<a href="#section-3.2.1-4.10.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal ulEmpty" id="section-3.2.1-4.10.2.3">bit 2: More fragments (MF).<a href="#section-3.2.1-4.10.2.3" class="pilcrow">¶</a>
</li>
              </ul>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-4.11">Fragment Offset (13 bits)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-4.12">Field associated with the
        number of eight-byte segments the fragment payload contains.<a href="#section-3.2.1-4.12" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-4.13">Largest Seen Fragment (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-4.14">Used along with a given
        egress network interface MTU to determine the fragment size of a
        reassembled packet.<a href="#section-3.2.1-4.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="security_id">
<section id="section-3.2.2">
          <h4 id="name-security-identifier">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-security-identifier" class="section-name selfRef">Security Identifier</a>
          </h4>
<p id="section-3.2.2-1">A versioning identifier used to determine which security key version
      should be used when handling features dealing with security and
      authenticity of a packet.<a href="#section-3.2.2-1" class="pilcrow">¶</a></p>
<div id="security_id_diagram">
<figure id="figure-4">
            <div class="alignLeft art-text artwork" id="section-3.2.2-2.1">
<pre>
 0                1                 2                 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Type = 16           |            Length = 4         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Security Key ID                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.2-3">
            <dt id="section-3.2.2-3.1">Type = 16 Decimal (0x10) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.2-3.2">Identifier for the
        Security Identifier TLV.<a href="#section-3.2.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.2-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.2-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.2.2-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.2-3.5">Security Identifier (4 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.2-3.6">This is a four-byte
        security key version identifier. This is used to identify the
        algorithmic version used for metadata authentication and
        encryption.<a href="#section-3.2.2-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="disabled_fwd_meta">
<section id="section-3.2.3">
          <h4 id="name-disable-forward-metadata">
<a href="#section-3.2.3" class="section-number selfRef">3.2.3. </a><a href="#name-disable-forward-metadata" class="section-name selfRef">Disable Forward Metadata</a>
          </h4>
<p id="section-3.2.3-1">An indication that forward metadata should be disabled.  This is sent
      in the reverse metadata to acknowledge receipt of the metadata. This is
      the second part of the metadata handshake.<a href="#section-3.2.3-1" class="pilcrow">¶</a></p>
<div id="disabled_fwd_attr_diagram">
<figure id="figure-5">
            <div class="alignLeft art-text artwork" id="section-3.2.3-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |           Type = 18           |         Length = 0            |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.3-3">
            <dt id="section-3.2.3-3.1">Type = 18 Decimal (0x12) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.3-3.2">Note: The binding of
        the forward metadata to this is based on the 5-tuple address on the
        wire. Every session first packet with metadata will have a unique
        5-tuple as it leaves the router. This unique address is used to bind a
        forward and reverse metadata. See metadata handshake in <a href="#handshake" class="xref">Section 2.4</a>.<a href="#section-3.2.3-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.3-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.3-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.2.3-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-3.2.3-4">Note: This type does not contain any value as its existence in
      metadata indicates a true value.<a href="#section-3.2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rtr_egress_src_addr_v4">
<section id="section-3.2.4">
          <h4 id="name-ipv4-router-egress-source-a">
<a href="#section-3.2.4" class="section-number selfRef">3.2.4. </a><a href="#name-ipv4-router-egress-source-a" class="section-name selfRef">IPv4 Router Egress Source Address</a>
          </h4>
<p id="section-3.2.4-1">The IP address of the originating packet on the wire. This is sent by
      the source to the destination because there may be a NAT between the two
      routers. By recognizing the actual source packet on the wire, and
      comparing it with this field, a router can detect a NAT is present.<a href="#section-3.2.4-1" class="pilcrow">¶</a></p>
<div id="rtr_egress_src_addr_v4_diagram">
<figure id="figure-6">
            <div class="alignLeft art-text artwork" id="section-3.2.4-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |           Type = 20           |          Length = 4           |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                        Source Address                         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.4-3">
            <dt id="section-3.2.4-3.1">Type = 20 decimal (0x14) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.4-3.2">Identifier for the
        Source Address (IPv4) TLV.<a href="#section-3.2.4-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.4-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.4-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.2.4-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.4-3.5">Source Address (4 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.4-3.6">Original IPv4 source address of
        the originating router.<a href="#section-3.2.4-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="rtr_egress_src_addr_v6">
<section id="section-3.2.5">
          <h4 id="name-ipv4-router-egress-source-ad">
<a href="#section-3.2.5" class="section-number selfRef">3.2.5. </a><a href="#name-ipv4-router-egress-source-ad" class="section-name selfRef">IPv4 Router Egress Source Address</a>
          </h4>
<p id="section-3.2.5-1">The IP address of the originating packet. This is sent by the source
      to the destination because there may be a NAT between the two routers.
      By recognizing the actual source packet on the wire, and comparing it
      with this field, a router can detect a NAT is present.<a href="#section-3.2.5-1" class="pilcrow">¶</a></p>
<div id="rtr_egress_src_addr_v6_diagram">
<figure id="figure-7">
            <div class="alignLeft art-text artwork" id="section-3.2.5-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |           Type = 21           |          Length = 16          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  +                                                               +
  |                                                               |
  +                        Source Address                         +
  |                                                               |
  +                                                               +
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.5-3">
            <dt id="section-3.2.5-3.1">Type 21 decimal (Ox15) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.5-3.2">Identifier for the
        Source Address (IPv6) TLV.<a href="#section-3.2.5-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.5-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.5-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.2.5-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.5-3.5">Source Address (16 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.5-3.6">Original IPv6 source address
        of the originating router.<a href="#section-3.2.5-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="select_ack">
<section id="section-3.2.6">
          <h4 id="name-selective-acknowledgement">
<a href="#section-3.2.6" class="section-number selfRef">3.2.6. </a><a href="#name-selective-acknowledgement" class="section-name selfRef">Selective Acknowledgement</a>
          </h4>
<p id="section-3.2.6-1">Used for TCP session optimization between peers. Allows sending side
      in long latency situations to queue packets and retransmit them to
      optimize TCP traffic.<a href="#section-3.2.6-1" class="pilcrow">¶</a></p>
<div id="select_ack_diagram">
<figure id="figure-8">
            <div class="alignLeft art-text artwork" id="section-3.2.6-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |           Type = 23           |        Length = variable      |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                         SACK Seq. No.                         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.6-3">
            <dt id="section-3.2.6-3.1">Type = 23 decimal (0x17) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.6-3.2">Identifier for the
        Selective Acknowledgement TLV.<a href="#section-3.2.6-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.6-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.6-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.2.6-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.6-3.5">ACK Sequence Number (4 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.6-3.6">Sequence number for the
        last TCP message received.<a href="#section-3.2.6-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.6-3.7">Variable Number of Selective Ack Blocks (8 bytes per block)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.6-3.8">
              <div class="alignLeft art-text artwork" id="section-3.2.6-3.8.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                         Left Edge                             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                         Right Edge                            |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-3.2.6-3.8.1" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.6-3.8.2">
                <dt id="section-3.2.6-3.8.2.1">Left Edge (4 bytes)</dt>
                <dd style="margin-left: 1.5em" id="section-3.2.6-3.8.2.2">Left Edge of the Selective Ack
            Block.<a href="#section-3.2.6-3.8.2.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-3.2.6-3.8.2.3">Right Edge (4 bytes)</dt>
                <dd style="margin-left: 1.5em" id="section-3.2.6-3.8.2.4">Right Edge of the Selective Ack
            Block.<a href="#section-3.2.6-3.8.2.4" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="proto_msg">
<section id="section-3.2.7">
          <h4 id="name-svr-protocol-message">
<a href="#section-3.2.7" class="section-number selfRef">3.2.7. </a><a href="#name-svr-protocol-message" class="section-name selfRef">SVR Protocol Message</a>
          </h4>
<p id="section-3.2.7-1">The SVR Protocol Message is a force drop message that is used as an
      out-of-band signaling mechanism between 128T routers.  These are
      messages that are internally generated and not intended to be forwarded
      through the router to another destination. Any sessions utilizing the 5
      tuples defined by the received packet with metadata may be acted upon
      based on the drop reason.<a href="#section-3.2.7-1" class="pilcrow">¶</a></p>
<div id="proto_msg_diagram">
<figure id="figure-9">
            <div class="alignLeft art-text artwork" id="section-3.2.7-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |          Type = 24            |           Length = 1          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |  Drop Reason  |
  +-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.7-3">
            <dt id="section-3.2.7-3.1">Type 24 decimal (0x18) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.7-3.2">Identifier for the
        force drop TLV.<a href="#section-3.2.7-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.7-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.7-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.2.7-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.7-3.5">Drop Reason (1 byte)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.7-3.6">
              <p id="section-3.2.7-3.6.1">Reason why this packet should be
        dropped.<a href="#section-3.2.7-3.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2.7-3.6.2.1">0 = Unknown. This value is reserved and used for backwards
            compatibility.<a href="#section-3.2.7-3.6.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-3.2.7-3.6.2.2">1 = Keep Alive. A packet that is dropped by the receiving node.
            Used only to keep NAT pinholes alive on middleboxes.<a href="#section-3.2.7-3.6.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-3.2.7-3.6.2.3">2 = Enable Metadata. When packets are received on a 128T's
            wayport address and does not have metadata, the receiving 128T
            treats the packet as a new session, requesting the sending 128T to
            resend the packet with Metadata in the packet. If state is lost,
            this can help with recovery.<a href="#section-3.2.7-3.6.2.3" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-3.2.7-3.6.2.4">3 = Disable Metadata. An indication that forward metadata
            should be disabled.  This is sent in the reverse metadata to
            acknowledge receipt of the metadata. If recovery is complete, this
            can be sent.<a href="#section-3.2.7-3.6.2.4" class="pilcrow">¶</a>
</li>
              </ul>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="path_metrics">
<section id="section-3.2.8">
          <h4 id="name-path-metrics">
<a href="#section-3.2.8" class="section-number selfRef">3.2.8. </a><a href="#name-path-metrics" class="section-name selfRef">Path Metrics</a>
          </h4>
<p id="section-3.2.8-1">Inline flow performance metrics to compute jitter, latency and loss
      per service, per path, per traffic class.<a href="#section-3.2.8-1" class="pilcrow">¶</a></p>
<div id="path_metrics_diagram">
<figure id="figure-10">
            <div class="alignLeft art-text artwork" id="section-3.2.8-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |           Type = 26           |           Length = 10         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  | Tx Co |                Transmit TimeValue                     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  | Rx Co |                Received TimeValue                     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |D|   Previous Rx Color Count   |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.8-3">
            <dt id="section-3.2.8-3.1">Type = 26 decimal (Ox1A) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.8-3.2">Identifier for the
        Path Metrics TLV.<a href="#section-3.2.8-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.8-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.8-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.2.8-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.8-3.5">Transmit Color (4 bits)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.8-3.6">Current color of a transmitting
        node.<a href="#section-3.2.8-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.8-3.7">Transmit Time Value (28 bits)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.8-3.8">Current time value in
        milliseconds at time of marking. This time value represents the amount
        of time which has elapsed since the start of a transmit color.<a href="#section-3.2.8-3.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.8-3.9">Received Color (4 bits)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.8-3.10">Most recently received color
        from a remote node.<a href="#section-3.2.8-3.10" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.8-3.11">Receive Time Value (28 bits)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.8-3.12">Cached time value in
        milliseconds from adjacent node adjusted by the elapsed time between
        caching of the value and current time. This time value is associated
        with the received color.<a href="#section-3.2.8-3.12" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.8-3.13">Drop Bit (1 bit)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.8-3.14">Should this packet be dropped.<a href="#section-3.2.8-3.14" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.8-3.15">Previous Rx Color Count (15 bits)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.8-3.16">Number of packets
        received from the previous color block. This count is in reference to
        the color previous to the current RX color which is defined above.<a href="#section-3.2.8-3.16" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="modify_req">
<section id="section-3.2.9">
          <h4 id="name-modify-request">
<a href="#section-3.2.9" class="section-number selfRef">3.2.9. </a><a href="#name-modify-request" class="section-name selfRef">Modify Request</a>
          </h4>
<p id="section-3.2.9-1">A modify operation on an existing session, which diverts the packet
      to the service area for additional treatment and processing.  This
      forces an "inline" session modify instead of allocating new waypoints to
      cause the same behavior.<a href="#section-3.2.9-1" class="pilcrow">¶</a></p>
<div id="modify_req_diagram">
<figure id="figure-11">
            <div class="alignLeft art-text artwork" id="section-3.2.9-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |           Type = 28           |          Length = 2           |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |F|D|res|   sequence number     |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.9-3">
            <dt id="section-3.2.9-3.1">Type = 28 decimal (0x1C) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.9-3.2">Identifier for the
        Modify Request TLV.<a href="#section-3.2.9-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.9-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.9-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.2.9-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.9-3.5">F (1 bit)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.9-3.6">Direction - forward or reverse.  0 = reverse.
        1 = forward.<a href="#section-3.2.9-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.9-3.7">D (1 bit)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.9-3.8">Divert - Whether the modify can be handled
        inline in the fastpath or needs to be diverted to the service area. 1
        = divert. 0 = do not divert.<a href="#section-3.2.9-3.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.9-3.9">Reserved (2 bits)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.9-3.10">Reserved for future use. Value is
        00.<a href="#section-3.2.9-3.10" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.9-3.11">Sequence Number (12 bits)</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.9-3.12">The number of modifications
        the session has undergone.<a href="#section-3.2.9-3.12" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="payload_attrs">
<section id="section-3.3">
        <h3 id="name-payload-attributes-2">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-payload-attributes-2" class="section-name selfRef">Payload Attributes</a>
        </h3>
<p id="section-3.3-1">Payload attributes are used for session establishment and can be
    encrypted to provide privacy. Encryption can be disabled for
    debugging.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<div id="fwd_ctx_v4">
<section id="section-3.3.1">
          <h4 id="name-forward-context-ipv4">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-forward-context-ipv4" class="section-name selfRef">Forward Context IPv4</a>
          </h4>
<p id="section-3.3.1-1">The context contains a five-tuple associated with the original
      addresses, ports, and protocol of the packet. This is also known as the
      Forward Session Key.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<div id="fwd_ctx_v4_diagram">
<figure id="figure-12">
            <div class="alignLeft art-text artwork" id="section-3.3.1-2.1">
<pre>
   0                 1                2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |             Type = 2          |           Length = 13         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                        Source Address                         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                     Destination Address                       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |         Source Port           |      Destination Port         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |   Protocol    |
  +-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.1-3">
            <dt id="section-3.3.1-3.1">Type = 2 decimal (0x02) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-3.2">Identifier for the
        Forward Session Key (IPv4) TLV.<a href="#section-3.3.1-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.1-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.1-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.1-3.5">Source Address (4 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-3.6">Original IPv4 source address of
        the packet.<a href="#section-3.3.1-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.1-3.7">Destination Address (4 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-3.8">Original IPv4 destination
        address of the packet.<a href="#section-3.3.1-3.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.1-3.9">Source Port (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-3.10">Original source port of the
        packet.<a href="#section-3.3.1-3.10" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.1-3.11">Destination Port (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-3.12">Original destination port of
        the packet.<a href="#section-3.3.1-3.12" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.1-3.13">Protocol (1 byte)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-3.14">Original protocol of the packet.<a href="#section-3.3.1-3.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="fwd_ctx_v6">
<section id="section-3.3.2">
          <h4 id="name-forward-context-ipv6">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-forward-context-ipv6" class="section-name selfRef">Forward Context IPv6</a>
          </h4>
<p id="section-3.3.2-1">A five-tuple associated with the original addresses, ports, and
      protocol of the packet for IPv6.<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
<div id="fwd_ctx_v6_diagram">
<figure id="figure-13">
            <div class="alignLeft art-text artwork" id="section-3.3.2-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |           Type = 3            |          Length = 37          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  +                                                               +
  |                                                               |
  +                         Source Address                        +
  |                                                               |
  +                                                               +
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  +                                                               +
  |                                                               |
  +                       Destination Address                     +
  |                                                               |
  +                                                               +
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |          Source Port          |        Destination Port       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |   Protocol    |
  +-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.2-3">
            <dt id="section-3.3.2-3.1">Type = 3 decimal (0x03) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.2-3.2">Identifier for the
        Forward Session Key (IPv6) TLV.<a href="#section-3.3.2-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.2-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.2-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.2-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.2-3.5">Source Address (16 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.2-3.6">Original IPv6 source address of
        the packet.<a href="#section-3.3.2-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.2-3.7">Destination Address (16 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.2-3.8">Original IPv6 destination
        address of the packet.<a href="#section-3.3.2-3.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.2-3.9">Source Port (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.2-3.10">Original source port of the
        packet.<a href="#section-3.3.2-3.10" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.2-3.11">Destination Port (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.2-3.12">Original destination port of
        the packet.<a href="#section-3.3.2-3.12" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.2-3.13">Protocol (1 byte)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.2-3.14">Original protocol of the packet.<a href="#section-3.3.2-3.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="rev_ctx_v4">
<section id="section-3.3.3">
          <h4 id="name-reverse-context-ipv4">
<a href="#section-3.3.3" class="section-number selfRef">3.3.3. </a><a href="#name-reverse-context-ipv4" class="section-name selfRef">Reverse Context IPv4</a>
          </h4>
<p id="section-3.3.3-1">Five-tuple associated with the egress (router) addresses, ports, and
      protocol of the packet. Forward context and reverse context session keys
      are not guaranteed to be symmetrical due to functions which apply source
      NAT, destination NAT, or both to a packet before leaving the router.<a href="#section-3.3.3-1" class="pilcrow">¶</a></p>
<div id="rev_ctx_v4_diagram">
<figure id="figure-14">
            <div class="alignLeft art-text artwork" id="section-3.3.3-2.1">
<pre>
   0                 1                2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |             Type = 4          |           Length = 13         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                        Source Address                         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                     Destination Address                       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |         Source Port           |      Destination Port         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |   Protocol    |
  +-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.3-3">
            <dt id="section-3.3.3-3.1">Type = 4 decimal (0x04) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.3-3.2">Identifier for the
        Reverse Session Key (IPv4) TLV.<a href="#section-3.3.3-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.3-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.3-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.3-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.3-3.5">Source Address (4 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.3-3.6">Egress IPv4 source address of
        the packet.<a href="#section-3.3.3-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.3-3.7">Destination Address (4 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.3-3.8">Egress IPv4 destination
        address of the packet.<a href="#section-3.3.3-3.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.3-3.9">Source Port (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.3-3.10">Egress source port of the
        packet.<a href="#section-3.3.3-3.10" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.3-3.11">Destination Port (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.3-3.12">Egress destination port of
        the packet.<a href="#section-3.3.3-3.12" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.3-3.13">Protocol (1 byte)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.3-3.14">Original protocol of the packet.<a href="#section-3.3.3-3.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="rev_ctx_v6">
<section id="section-3.3.4">
          <h4 id="name-reverse-context-ipv6">
<a href="#section-3.3.4" class="section-number selfRef">3.3.4. </a><a href="#name-reverse-context-ipv6" class="section-name selfRef">Reverse Context IPv6</a>
          </h4>
<p id="section-3.3.4-1">Five-tuple associated with the egress (router) addresses, ports, and
      protocol of the packet. Forward and reverse session keys are not
      guaranteed to be symmetrical due to functions which apply source NAT,
      destination NAT, or both to a packet before leaving the router.<a href="#section-3.3.4-1" class="pilcrow">¶</a></p>
<div id="rev_ctx_v6_diagram">
<figure id="figure-15">
            <div class="alignLeft art-text artwork" id="section-3.3.4-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |           Type = 3            |          Length = 37          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  +                                                               +
  |                                                               |
  +                         Source Address                        +
  |                                                               |
  +                                                               +
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  +                                                               +
  |                                                               |
  +                       Destination Address                     +
  |                                                               |
  +                                                               +
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |          Source Port          |        Destination Port       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |   Protocol    |
  +-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-15" class="selfRef">Figure 15</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.4-3">
            <dt id="section-3.3.4-3.1">Type = 3 decimal (0x03) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.4-3.2">Identifier for the
        Reverse Session Key (IPv6) TLV.<a href="#section-3.3.4-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.4-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.4-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.4-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.4-3.5">Source Address (16 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.4-3.6">Egress IPv6 source address of
        the packet.<a href="#section-3.3.4-3.6" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.4-3.7">Destination Address (16 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.4-3.8">Egress IPv6 destination
        address of the packet.<a href="#section-3.3.4-3.8" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.4-3.9">Source Port (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.4-3.10">Egress source port of the
        packet.<a href="#section-3.3.4-3.10" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.4-3.11">Destination Port (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.4-3.12">Egress destination port of
        the packet.<a href="#section-3.3.4-3.12" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.4-3.13">Protocol (1 byte)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.4-3.14">Original protocol of the packet.<a href="#section-3.3.4-3.14" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="session_uuid">
<section id="section-3.3.5">
          <h4 id="name-session-uuid">
<a href="#section-3.3.5" class="section-number selfRef">3.3.5. </a><a href="#name-session-uuid" class="section-name selfRef">Session UUID</a>
          </h4>
<p id="section-3.3.5-1">Unique identifier of a session. This is assigned by the peer that is
      initiating a session. Once assigned, it is maintained through all
      participating routers end-to-end.<a href="#section-3.3.5-1" class="pilcrow">¶</a></p>
<div id="session_uuid_diagram">
<figure id="figure-16">
            <div class="alignLeft art-text artwork" id="section-3.3.5-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            Type = 6           |           Length = 16         |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                                                               |
  +                                                               +
  |                                                               |
  +                              UUID                             +
  |                                                               |
  +                                                               +
  |                                                               |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-16" class="selfRef">Figure 16</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.5-3">
            <dt id="section-3.3.5-3.1">Type = 6 decimal (0x06) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.5-3.2">Identifier for the
        Session UUID TLV.<a href="#section-3.3.5-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.5-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.5-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.5-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.5-3.5">UUID (16 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.5-3.6">Unique identifier of a session.<a href="#section-3.3.5-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="src_tenant_name">
<section id="section-3.3.6">
          <h4 id="name-source-tenant-name">
<a href="#section-3.3.6" class="section-number selfRef">3.3.6. </a><a href="#name-source-tenant-name" class="section-name selfRef">Source Tenant Name</a>
          </h4>
<p id="section-3.3.6-1">An alphanumeric ASCII string which dictates what tenancy the session
      belongs to.<a href="#section-3.3.6-1" class="pilcrow">¶</a></p>
<div id="src_tenant_name_diagram">
<figure id="figure-17">
            <div class="alignLeft art-text artwork" id="section-3.3.6-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            Type = 7           |       Length = variable       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                              Name                             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-17" class="selfRef">Figure 17</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.6-3">
            <dt id="section-3.3.6-3.1">Type 7 decimal (0x07) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.6-3.2">Identifier for the
        Tenant ID TLV.<a href="#section-3.3.6-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.6-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.6-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.6-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.6-3.5">Name (variable length)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.6-3.6">The tenant name represented as a
        string.<a href="#section-3.3.6-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="service_name">
<section id="section-3.3.7">
          <h4 id="name-service-name">
<a href="#section-3.3.7" class="section-number selfRef">3.3.7. </a><a href="#name-service-name" class="section-name selfRef">Service Name</a>
          </h4>
<p id="section-3.3.7-1">An alphanumeric string which dictates what service the session
      belongs to. This attribute must be present in all forward metadata
      packets.<a href="#section-3.3.7-1" class="pilcrow">¶</a></p>
<div id="service_name_diagram">
<figure id="figure-18">
            <div class="alignLeft art-text artwork" id="section-3.3.7-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            Type = 10          |       Length = variable       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                              Name                             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-18" class="selfRef">Figure 18</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.7-3">
            <dt id="section-3.3.7-3.1">Type = 10 decimal (0x0A) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.7-3.2">Identifier for the
        Service Name TLV.<a href="#section-3.3.7-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.7-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.7-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.7-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.7-3.5">Name (variable length)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.7-3.6">The service name represented as a
        string.<a href="#section-3.3.7-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="session_encrypt">
<section id="section-3.3.8">
          <h4 id="name-session-encrypted">
<a href="#section-3.3.8" class="section-number selfRef">3.3.8. </a><a href="#name-session-encrypted" class="section-name selfRef">Session Encrypted</a>
          </h4>
<p id="section-3.3.8-1">Indicates if the session is having its payload encrypted. This
      enables payload encryption with tenant specific attributes and keys.
      Details of key management and encryption types are outside the scope of
      this standard.<a href="#section-3.3.8-1" class="pilcrow">¶</a></p>
<div id="session_encrypt_diagram">
<figure id="figure-19">
            <div class="alignLeft art-text artwork" id="section-3.3.8-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            Type = 11          |           Length = 0          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-19" class="selfRef">Figure 19</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.8-3">
            <dt id="section-3.3.8-3.1">Type = 11 decimal (0x0B) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.8-3.2">Identifier for the
        Session Encrypted TLV.<a href="#section-3.3.8-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.8-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.8-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.8-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-3.3.8-4">Note: This type does not contain any value as its existence in
      metadata indicates a value.<a href="#section-3.3.8-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tcp_syn_pkt">
<section id="section-3.3.9">
          <h4 id="name-tcp-syn-packet">
<a href="#section-3.3.9" class="section-number selfRef">3.3.9. </a><a href="#name-tcp-syn-packet" class="section-name selfRef">TCP SYN Packet</a>
          </h4>
<p id="section-3.3.9-1">Indicates if the packet in question is a TCP SYN packet. Due to the
      potential that this packet could have had its TCP header transformed to
      UDP temporarily, the flags in the TCP header may not be accessible.<a href="#section-3.3.9-1" class="pilcrow">¶</a></p>
<div id="tcp_syn_pkt_diagram">
<figure id="figure-20">
            <div class="alignLeft art-text artwork" id="section-3.3.9-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            Type = 12          |           Length = 0          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-20" class="selfRef">Figure 20</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.9-3">
            <dt id="section-3.3.9-3.1">Type = 12 decimal (0x0C) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.9-3.2">Identifier for the TCP
        SYN packet TLV.<a href="#section-3.3.9-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.9-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.9-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.9-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<p id="section-3.3.9-4">Note: This type does not contain any value as its existence in
      metadata indicates a value.<a href="#section-3.3.9-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="src_rtr_name">
<section id="section-3.3.10">
          <h4 id="name-source-router-name">
<a href="#section-3.3.10" class="section-number selfRef">3.3.10. </a><a href="#name-source-router-name" class="section-name selfRef">Source Router Name</a>
          </h4>
<p id="section-3.3.10-1">An alphanumeric string which dictates which source router the packet
      is originating from. This attribute may be present in all forward
      metadata packets if needed.<a href="#section-3.3.10-1" class="pilcrow">¶</a></p>
<div id="src_rtr_name_diagram">
<figure id="figure-21">
            <div class="alignLeft art-text artwork" id="section-3.3.10-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            Type = 14          |       Length = variable       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                              Name                             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-21" class="selfRef">Figure 21</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.10-3">
            <dt id="section-3.3.10-3.1">Type = 14 decimal (0x0E) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.10-3.2">Identifier for the
        Source Router Name TLV.<a href="#section-3.3.10-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.10-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.10-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.10-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.10-3.5">Name (variable length)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.10-3.6">The router name represented as a
        string.<a href="#section-3.3.10-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="src_rtr_sec_name">
<section id="section-3.3.11">
          <h4 id="name-source-router-security-name">
<a href="#section-3.3.11" class="section-number selfRef">3.3.11. </a><a href="#name-source-router-security-name" class="section-name selfRef">Source Router Security Name</a>
          </h4>
<p id="section-3.3.11-1">An alphanumeric string which dictates what security policy to be used
      for encrypting metadata when sending reverse packets back to this
      router.  This attribute is optional.<a href="#section-3.3.11-1" class="pilcrow">¶</a></p>
<div id="src_rtr_sec_name_diagram">
<figure id="figure-22">
            <div class="alignLeft art-text artwork" id="section-3.3.11-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            Type = 15          |       Length = variable       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                              Name                             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-22" class="selfRef">Figure 22</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.11-3">
            <dt id="section-3.3.11-3.1">Type = 15 decimal (0x0F) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.11-3.2">Identifier for the
        Source Router Security Name TLV.<a href="#section-3.3.11-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.11-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.11-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.11-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.11-3.5">Name (variable length)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.11-3.6">The peer security name
        represented as a string.<a href="#section-3.3.11-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="dst_rtr_name">
<section id="section-3.3.12">
          <h4 id="name-destination-router-name">
<a href="#section-3.3.12" class="section-number selfRef">3.3.12. </a><a href="#name-destination-router-name" class="section-name selfRef">Destination Router Name</a>
          </h4>
<p id="section-3.3.12-1">An alphanumeric string which dictates which destination router the
      packet is sent to. This attribute may be present if needed.<a href="#section-3.3.12-1" class="pilcrow">¶</a></p>
<div id="dst_rtr_name_diagram">
<figure id="figure-23">
            <div class="alignLeft art-text artwork" id="section-3.3.12-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            Type = 17          |       Length = variable       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                              Name                             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-23" class="selfRef">Figure 23</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.12-3">
            <dt id="section-3.3.12-3.1">Type = 17 decimal (0x11) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.12-3.2">Identifier for the
        Destination Router Name TLV.<a href="#section-3.3.12-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.12-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.12-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.12-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.12-3.5">Name (variable length)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.12-3.6">The destination router name
        represented as a string.<a href="#section-3.3.12-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="peer_rtr_id">
<section id="section-3.3.13">
          <h4 id="name-peer-path-id">
<a href="#section-3.3.13" class="section-number selfRef">3.3.13. </a><a href="#name-peer-path-id" class="section-name selfRef">Peer Path ID</a>
          </h4>
<p id="section-3.3.13-1">An alphanumeric string which dictates which router path has been
      chosen for a packet. This name can be the hostname or IP address of the
      egress interface of the originating router. Any two routers may have
      multiple pathways between them. This enables association of policies
      with specific paths.<a href="#section-3.3.13-1" class="pilcrow">¶</a></p>
<div id="peer_rtr_id_diagram">
<figure id="figure-24">
            <div class="alignLeft art-text artwork" id="section-3.3.13-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            Type = 19          |       Length = variable       |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                              Name                             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-24" class="selfRef">Figure 24</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.13-3">
            <dt id="section-3.3.13-3.1">Type = 19 decimal (0x13) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.13-3.2">Identifier for the
        Peer Path ID TLV.<a href="#section-3.3.13-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.13-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.13-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.13-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.13-3.5">Name (variable length)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.13-3.6">The peer path name which is
        represented as a string.<a href="#section-3.3.13-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="src_nat_addr_v4">
<section id="section-3.3.14">
          <h4 id="name-ipv4-source-nat-address">
<a href="#section-3.3.14" class="section-number selfRef">3.3.14. </a><a href="#name-ipv4-source-nat-address" class="section-name selfRef">IPv4 Source NAT Address</a>
          </h4>
<p id="section-3.3.14-1">An alphanumeric string which dictates which router path has been
      chosen for a packet. This name can be the hostname or IP address of the
      egress interface of the originating router. Any two routers may have
      multiple pathways between them. This enables association of policies
      with specific paths.<a href="#section-3.3.14-1" class="pilcrow">¶</a></p>
<div id="src_nat_addr_v4_diagram">
<figure id="figure-25">
            <div class="alignLeft art-text artwork" id="section-3.3.14-2.1">
<pre>
   0                1                 2                 3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |            Type = 25          |           Length = 4          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |                              Name                             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-25" class="selfRef">Figure 25</a></figcaption></figure>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.14-3">
            <dt id="section-3.3.14-3.1">Type = 25 decimal (0x19) (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.14-3.2">Identifier for the
        Source NAT Address (IPv4) TLV.<a href="#section-3.3.14-3.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.14-3.3">Length (2 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.14-3.4">Number of bytes associated with the
        length of the value (not including the 4 bytes associated with the
        type and length fields).<a href="#section-3.3.14-3.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.14-3.5">Source Address (4 bytes)</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.14-3.6">Source NATed address of the
        packet.<a href="#section-3.3.14-3.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="meta_use_cases">
<section id="section-4">
      <h2 id="name-metadata-exchanges-and-use-">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-metadata-exchanges-and-use-" class="section-name selfRef">Metadata Exchanges and Use Cases</a>
      </h2>
<p id="section-4-1">Metadata can be inserted and used to share network intent between routers.
Below are examples for specific use cases. The metadata is not limited to
these use cases, these are just illustrative.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="establish_peer_path">
<section id="section-4.1">
        <h3 id="name-establishing-a-peer-path">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-establishing-a-peer-path" class="section-name selfRef">Establishing a Peer Path</a>
        </h3>
<p id="section-4.1-1">Before a client or router can send metadata to a next hop router or
    server, it must know apriori of the next hop router's existence (and
    interface IP Address or waypoint). The client or router must also have a
    routed path to the IP Address (as determined by L2 and L3 routing
    protocols). The mechanism to obtain the router's address is outside the
    scope of this document. This could be through configuration, a DNS lookup,
    a LISP like RLOC query, or through a registry service. Routing protocols
    can be used to share topology as needed to locate supporting routers, and
    to obtain and share cryptographic keys.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">Client software that does not have access to routing layers can
    generate packets to test if the default route supports metadata by sending
    specially constructed packets to the default gateway.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<div id="peer_status_perf">
<section id="section-4.1.1">
          <h4 id="name-peer-path-status-and-perfor">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-peer-path-status-and-perfor" class="section-name selfRef">Peer Path Status and Performance</a>
          </h4>
<p id="section-4.1.1-1">If a router or client learns the IP address of a participating peer, it
      can then verify the path and performance by using BFD or other quality
      measurement techniques. Once connectivity is established (at L2, L3, and
      SVR), the peer path status and performance measurements can be measured.
      This measured criteria can be used to select which peer path to use. This
      is outside the scope of this document.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="share_metrics">
<section id="section-4.1.2">
          <h4 id="name-sharing-path-metrics-betwee">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-sharing-path-metrics-betwee" class="section-name selfRef">Sharing Path Metrics between routers</a>
          </h4>
<p id="section-4.1.2-1">Two routers that can send metadata between each other are said to be
      "peers". The interface addresses they use to talk to each other are
      called "waypoints". A router can send its "peer" a quality report of
      what it has measured from its point of view with a peer. This provides a
      view from the peers point of view that may be useful in deciding
      algorithmically what peer path to select. To send information to a peer,
      one can include a Path Metrics Header as defined in <a href="#path_metrics" class="xref">Section 3.2.8</a>.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2-2">This header can be included in any metadata sent, at any time. The
      receiving side can use this information as needed. There are no standard
      timeframes for sending this information, and it is implementation
      specific.<a href="#section-4.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="test_path">
<section id="section-4.1.3">
          <h4 id="name-testing-path-availability">
<a href="#section-4.1.3" class="section-number selfRef">4.1.3. </a><a href="#name-testing-path-availability" class="section-name selfRef">Testing Path Availability</a>
          </h4>
<p id="section-4.1.3-1">Testing path availability is outside the scope of this document. BFD
      is frequently used to verify that a path to a router is available. Lack
      of a metadata response when sending sessions to a router indicates that
      path is unavailable as well. Since routers are also running routing
      protocols, should the waypoint address become unreachable, the path is
      also declared down.<a href="#section-4.1.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="new_session_init">
<section id="section-4.2">
        <h3 id="name-new-session-initiation">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-new-session-initiation" class="section-name selfRef">New Session Initiation</a>
        </h3>
<p id="section-4.2-1">When a client or router detects that a new session is being
    established, metadata must be inserted into the first packet to
    communicate intent to a next hop router. Detecting a new session is
    protocol specific. For TCP, it's a new 5 Tuple packet (new flow) that is a
    SYN packet. For UDP, it's simply a new 5 Tuple packet not currently in
    use. These are easily detected because:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.1">The packet search key generates a flow miss which indicates it's a
      new 5 tuple to the router.<a href="#section-4.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-2.2">Any packet arriving at the router's interface address that is a flow
      miss MUST have metadata to be processed.<a href="#section-4.2-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-3">Because it is a flow miss, the router will forward the packet
    internally to a branch of code that will look up routes and insert
    metadata.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<div id="first_pkt_proc">
<section id="section-4.2.1">
          <h4 id="name-first-packet-processing">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-first-packet-processing" class="section-name selfRef">First Packet Processing</a>
          </h4>
<p id="section-4.2.1-1">For illustrative purposes, assume that the packet is an engineer at
      Juniper Networks attempting to access a Zoom video conference service.
      The resulting QSN is: QSN://engineer.juniper/zoom.<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.2.1-2">Locally, the source IPv4 address for the engineer is 10.0.1.1.
      Engineers are assigned to vlan 10, and DNS resolves the Zoom address to
      be 3.208.72.109. When the packet arrives at the branch router with the
      name "Branch 1", the following steps will be performed:<a href="#section-4.2.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-3.1">Determine the Tenant. This is just a text name which describes the
        routes and policies that are available for a group of source IP
        addresses. In our example, the "engineer" is based upon VLAN 10, and
        the tenant will be "engineer" as named by the authority "juniper".<a href="#section-4.2.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-3.2">Using the destination IP address, determine a Service. Some
        services have a single IP Address, while others have multiple CIDR
        blocks. The Service name can also be obtained by using DPI (SNI/URL/CN
        from Certificate) or by proxying DNS resolutions.<a href="#section-4.2.1-3.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.2.1-4">The determination of a service is essential. With Zoom by example,
      the current published list of IP addresses, protocol, and ports include
      over 230 CIDR block ranges where the most common block is a /25.
      Describing network intent would be difficult using IP Addresses.<a href="#section-4.2.1-4" class="pilcrow">¶</a></p>
<p id="section-4.2.1-5">Once the tenant and service are known, the routing intent can be
      determined. The routing policies are checked, specifically:<a href="#section-4.2.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-6.1">Are engineers allowed to use Zoom.<a href="#section-4.2.1-6.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-6.2">Is there a valid L3 route to 3.208.72.109. If no valid route
        exists, is there another Zoom service address configured?<a href="#section-4.2.1-6.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-6.3">Look up security policies for Zoom.<a href="#section-4.2.1-6.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-6.4">Look up QoS policies for Zoom. Assign Video Conferencing QoS
        policy.<a href="#section-4.2.1-6.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-6.5">
              <p id="section-4.2.1-6.5.1">Select a peer to send the session to:<a href="#section-4.2.1-6.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-6.5.2.1">The Source Peer/Destination Peer defines a peer path that has
            been chosen. This establishes the source and destination IP
            Addresses on the wire.<a href="#section-4.2.1-6.5.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.2.1-6.5.2.2">There may be more than one path acceptable, and they are rank
            ordered for the forwarding plane to use.<a href="#section-4.2.1-6.5.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-4.2.1-6.6">
              <p id="section-4.2.1-6.6.1">Choose a peer path, and establish fast path rules for subsequent
          packets:<a href="#section-4.2.1-6.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-6.6.2.1">Pick the best peer path for communication. The algorithm for
            selecting the best peer path could include any criteria or
            algorithm and is not part of this protocol definition.<a href="#section-4.2.1-6.6.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.2.1-6.6.2.2">Allocate source and destination[AM2]  ports for the waypoint IP
            addresses chosen for each peer path. to create a unique 5 tuple
            session between peers.<a href="#section-4.2.1-6.6.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.2.1-6.6.2.3">Install fast path NAT rules for the packet in the forward
            direction.<a href="#section-4.2.1-6.6.2.3" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4.2.1-6.6.2.4">Install fast path NAT rules for packets that will come in the
            reverse direction.<a href="#section-4.2.1-6.6.2.4" class="pilcrow">¶</a>
</li>
              </ul>
</li>
          </ul>
<p id="section-4.2.1-7">Once all of these local L2/L3 parameters are mapped to Tenant/Service
      routing intent, then metadata can be constructed an inserted into the
      first packet (for TCP A SYN Packet).<a href="#section-4.2.1-7" class="pilcrow">¶</a></p>
<p id="section-4.2.1-8">The metadata attributes that will be inserted includes:<a href="#section-4.2.1-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-9.1">Header: Security Identifier<a href="#section-4.2.1-9.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-9.2">Payload: Forward Context<a href="#section-4.2.1-9.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-9.3">Payload: Source Tenant Name<a href="#section-4.2.1-9.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-9.4">Payload: Service Name<a href="#section-4.2.1-9.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-9.5">Payload: Session UUID<a href="#section-4.2.1-9.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-9.6">Payload: Source Router Name<a href="#section-4.2.1-9.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-9.7">Payload: Source Router Security Name<a href="#section-4.2.1-9.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-9.8">Payload: Peer Path Name<a href="#section-4.2.1-9.8" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.2.1-10">When the first packet is sent, the sending side will include the same
      exact metadata on every packet until a packet in the opposite direction
      (reverse direction) arrives with metadata indicating a complete
      handshake. For TCP, the SYN packet contains metadata, and typically a
      SYN-ACK from the server side responds with metadata, and there is no
      further metadata inserted in a session.<a href="#section-4.2.1-10" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2.1-11">
<pre>
      Client ----&gt;    TCP SYN w/Metadata  ----&gt; Server
      Server &lt;---- TCP SYN-ACK w/Metadata &lt;---- Server
</pre><a href="#section-4.2.1-11" class="pilcrow">¶</a>
</div>
<p id="section-4.2.1-12">For UDP, metadata can be inserted in packets until there is a reverse
      flow packet.<a href="#section-4.2.1-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="signing_meta">
<section id="section-4.2.2">
          <h4 id="name-signing-the-metadata">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-signing-the-metadata" class="section-name selfRef">Signing the Metadata</a>
          </h4>
<p id="section-4.2.2-1">The metadata is signed with an HMAC signature that is a defined
      number of bytes long. The signature used is defined by RFC2104. The HMAC
      signature is placed at the very end of the packet, extending the packet
      length by the number of bytes. The shared keys used for signing and
      verifying the authenticity of the packet are outside the scope of this
      document, but could be any well known and trusted key distribution
      scheme.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encrypt_meta">
<section id="section-4.2.3">
          <h4 id="name-encryption-of-the-metadata">
<a href="#section-4.2.3" class="section-number selfRef">4.2.3. </a><a href="#name-encryption-of-the-metadata" class="section-name selfRef">Encryption of the Metadata</a>
          </h4>
<p id="section-4.2.3-1">The metadata Payload Headers are encrypted utilizing AES256, with the
      initialization vector (IV) supplied directly after the encrypted data to
      guarantee the receiver can decrypt the information statelessly.<a href="#section-4.2.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rcv_response_pkt">
<section id="section-4.2.4">
          <h4 id="name-receiving-the-first-respons">
<a href="#section-4.2.4" class="section-number selfRef">4.2.4. </a><a href="#name-receiving-the-first-respons" class="section-name selfRef">Receiving the First Response Packet</a>
          </h4>
<p id="section-4.2.4-1">When a next hop router receives a packet directed to an interface the
      router owns that has a uniquely new 5 tuple, it can reasonably expect
      the packet (if not a routing protocol packet) contains metadata. By
      performing DPI on the received packet, the router can determine
      positively if metadata is present. If so, the metadata can be
      authenticated, decrypted, parsed for network intent, and removed. The
      packet is forwarded (possibly through a second SVR). When a first
      reverse packet is received for the session, the router will construct a
      block of metadata in the reverse direction. The purpose of this is:<a href="#section-4.2.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.4-2.1">Indicate to the sender that it can stop sending metadata.<a href="#section-4.2.4-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.4-2.2">Provide backward information about the service for routing of future instances.<a href="#section-4.2.4-2.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.2.4-3">The reverse metadata attributes that will be inserted include:<a href="#section-4.2.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.4-4.1">Header: Security Identifier<a href="#section-4.2.4-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.4-4.2">Payload: Reverse Context<a href="#section-4.2.4-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.4-4.3">Payload: Tenant Name<a href="#section-4.2.4-4.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.4-4.4">Payload: Destination Router Name<a href="#section-4.2.4-4.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.4-4.5">Payload: Peer Path ID<a href="#section-4.2.4-4.5" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="subs_pkt_proc">
<section id="section-4.2.5">
          <h4 id="name-subsequent-packet-processin">
<a href="#section-4.2.5" class="section-number selfRef">4.2.5. </a><a href="#name-subsequent-packet-processin" class="section-name selfRef">Subsequent Packet Processing</a>
          </h4>
<p id="section-4.2.5-1">As soon as the initiating router gets confirmation that the next hop
      router understands the metadata, it can stop sending metadata. In the
      case of the TCP transport layer, this occurs with the 2nd packet of the
      session, first reverse packet, the TCP SYN-ACK response.<a href="#section-4.2.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="session_terminate">
<section id="section-4.2.6">
          <h4 id="name-session-termination">
<a href="#section-4.2.6" class="section-number selfRef">4.2.6. </a><a href="#name-session-termination" class="section-name selfRef">Session Termination</a>
          </h4>
<p id="section-4.2.6-1">No metadata is sent upon normal session termination. The router can
      monitor the TCP state machine and have a guard timer after seeing a
      FIN/ACK or RST exchange. After the guard timer, the session can be
      removed from the system. If a new session arrives during this period (A
      TCP SYN), then it will cause immediate termination of the existing
      session. In addition, all protocols also have an associated inactivity
      timeout, after which the session gets terminated if no packets flow in
      either direction.<a href="#section-4.2.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="unicast_async_flows">
<section id="section-4.2.7">
          <h4 id="name-unicast-and-asymmetric-flow">
<a href="#section-4.2.7" class="section-number selfRef">4.2.7. </a><a href="#name-unicast-and-asymmetric-flow" class="section-name selfRef">Unicast and Asymmetric Flows</a>
          </h4>
<p id="section-4.2.7-1">When there are multicast flows, or asymmetry, the sender must assume
      for TCP when the sequence number is advancing, that there is end-to-end
      communication, and one can stop sending metadata. For UDP asymmetry the
      sending router will send a maximum of 11 packets with metadata and if no
      reverse packets are seen, the receiving peer router will trigger a
      disable metadata packet to the originating router to turn off metadata
      for subsequent forward packets.<a href="#section-4.2.7-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="moving_session">
<section id="section-4.3">
        <h3 id="name-moving-a-session">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-moving-a-session" class="section-name selfRef">Moving a Session</a>
        </h3>
<p id="section-4.3-1">To change the pathway of a session between two routers, one simply
    reinserts the metadata described in section 3.2.1. but retains the same
    Session UUID. This will cause the upstream router to do the following:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-2.1">Update its Fast Packet forwarding tables to reflect the new IP
      addresses and ports for transport.<a href="#section-4.3-2.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.3-3">When the sender of the metadata sees packets returning on the new
    interface, the old fast path entries can be removed.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec_consider">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="hamc_auth">
<section id="section-5.1">
        <h3 id="name-hmac-authentication">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-hmac-authentication" class="section-name selfRef">HMAC Authentication</a>
        </h3>
<p id="section-5.1-1">HMAC signatures are mandatory for the packets that contain Metadata to
    guarantee the contents were not changed, and that the router sending it is
    known to the receiver. Any HMAC algorithm can be used, from SHA128, SHA256
    or MD5, as long as both sides agree. HMAC is always performed on the layer
    4 payload of the packet.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="replay_prevent">
<section id="section-5.2">
        <h3 id="name-replay-prevention">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-replay-prevention" class="section-name selfRef">Replay Prevention</a>
        </h3>
<p id="section-5.2-1">Optional HMAC signatures can be added to every packet. This prevents
    any mid-stream attempts to corrupt or impact sessions that are ongoing.
    The signature must include all of the packet after Layer 4, and include a
    current time of day to prevent replay attacks.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Both the sending and receiving routers must agree on these optional
    HMAC signatures, details of which are outside the scope of this
    document.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="payload_encrypt">
<section id="section-5.3">
        <h3 id="name-payload-encryption">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-payload-encryption" class="section-name selfRef">Payload Encryption</a>
        </h3>
<p id="section-5.3-1">Payload encryption can use AES-CBC-128 or AES-CBC-256 ciphers which can
    be configured. Since these are block-ciphers, the payload should be
    divisible by 16. If the actual payload length is divisible by 16, then the
    last 16 bytes will be all 0s. If the actual payload is not divisible by
    16, then the remaining data will be padded by 0's and the last byte will
    indicate the length.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ddos_attack">
<section id="section-5.4">
        <h3 id="name-ddos-and-unexpected-traffic">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-ddos-and-unexpected-traffic" class="section-name selfRef">DDoS and Unexpected Traffic on Waypoint Addresses</a>
        </h3>
<p id="section-5.4-1">Waypoint addresses could be addressed by any client at any time. IP
    Packets that arrive on the router's interface will be processed with the
    assumption that they MUST contain metadata OR be part of an existing
    established routing protocol.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">Routers will only accept metadata from routers that they are
    provisioned to speak with. As such an ACL on incoming source addresses is
    limited to routers provisioned to communicate. All other packets are
    dropped.<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<p id="section-5.4-3">When a packet is received the "cookie" in the metadata header is
    reviewed first. If the cookie isn't correct, the packet is dropped.<a href="#section-5.4-3" class="pilcrow">¶</a></p>
<p id="section-5.4-4">The HMAC signature is checked. If the signature validates, the packet
    is assumed good, and processing continues. If the HMAC fails, the packet
    is dropped.<a href="#section-5.4-4" class="pilcrow">¶</a></p>
<p id="section-5.4-5">These methods prevent distributed denial of service attacks on the
    waypoint addresses of routers.<a href="#section-5.4-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="acknowledgements">
<section id="section-6">
      <h2 id="name-acknowledgements">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-6-1">The authors would like to thank Anya Yungelson, Scott McCulley, and Patrick
MeLampy for their input into this document.<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-7">
      <h2 id="name-normative-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2234">[RFC2234]</dt>
    <dd>
<span class="refAuthor">Crocker, D., Ed.</span> and <span class="refAuthor">P. Overell</span>, <span class="refTitle">"Augmented BNF for Syntax Specifications: ABNF"</span>, <span class="seriesInfo">RFC 2234</span>, <span class="seriesInfo">DOI 10.17487/RFC2234</span>, <time datetime="1997-11" class="refDate">November 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2234">https://www.rfc-editor.org/info/rfc2234</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Abilash Menon</span></div>
<div dir="auto" class="left"><span class="org">Juniper Networks</span></div>
<div dir="auto" class="left"><span class="street-address">200 Summit Dr #600</span></div>
<div dir="auto" class="left">
<span class="locality">Burlington</span>, <span class="region">MA</span> <span class="postal-code">01803</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:abilashm@juniper.net" class="email">abilashm@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Michael Baj</span></div>
<div dir="auto" class="left"><span class="org">Juniper Networks</span></div>
<div dir="auto" class="left"><span class="street-address">200 Summit Dr #600</span></div>
<div dir="auto" class="left">
<span class="locality">Burlington</span>, <span class="region">MA</span> <span class="postal-code">01803</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mbaj@juniper.net" class="email">mbaj@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Patrick Timmons</span></div>
<div dir="auto" class="left"><span class="org">Juniper Networks</span></div>
<div dir="auto" class="left"><span class="street-address">200 Summit Dr #600</span></div>
<div dir="auto" class="left">
<span class="locality">Burlington</span>, <span class="region">MA</span> <span class="postal-code">01803</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ptimmons@juniper.net" class="email">ptimmons@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Hadriel Kaplan</span></div>
<div dir="auto" class="left"><span class="org">Juniper Networks</span></div>
<div dir="auto" class="left"><span class="street-address">200 Summit Dr #600</span></div>
<div dir="auto" class="left">
<span class="locality">Burlington</span>, <span class="region">MA</span> <span class="postal-code">01803</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:hkaplan@juniper.net" class="email">hkaplan@juniper.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
