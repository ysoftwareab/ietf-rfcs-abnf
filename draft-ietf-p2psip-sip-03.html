<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>A SIP Usage for RELOAD</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="A SIP Usage for RELOAD">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">P2PSIP</td><td class="header">C. Jennings</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Cisco</td></tr>
<tr><td class="header">Intended status:  Standards Track</td><td class="header">B. Lowekamp, Ed.</td></tr>
<tr><td class="header">Expires:  April 26, 2010</td><td class="header">MYMIC LLC</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">E. Rescorla</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Network Resonance</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">S. Baset</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">H. Schulzrinne</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Columbia University</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 23, 2009</td></tr>
</table></td></tr></table>
<h1><br />A SIP Usage for RELOAD<br />draft-ietf-p2psip-sip-03</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 26, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document defines a SIP Usage for REsource LOcation And Discovery
      (RELOAD), The SIP Usage provides the functionality of a SIP proxy or
      registrar in a fully-distributed system. The SIP Usage provides lookup
      service for AoRs stored in the overlay. The SIP Usage also defines GRUUs
      that allow the registrations to map an AoR to a specific node reachable
      through the overlay. The AppAttach method is used to establish a direct
      connection between nodes through which SIP messages are exchanged.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Overview<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
Registering AORs<br />
<a href="#anchor4">4.</a>&nbsp;
Looking up an AOR<br />
<a href="#anchor5">5.</a>&nbsp;
Forming a Direct Connection<br />
<a href="#sec-gruus">6.</a>&nbsp;
GRUUs<br />
<a href="#sec.sip-reg-kind">7.</a>&nbsp;
SIP-REGISTRATION Kind Definition<br />
<a href="#anchor6">8.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">8.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#section.sip-issues">8.2.</a>&nbsp;
SIP-Specific Issues<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">8.2.1.</a>&nbsp;
Fork Explosion<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-security-malicious-retargeting">8.2.2.</a>&nbsp;
Malicious Retargeting<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">8.2.3.</a>&nbsp;
Privacy Issues<br />
<a href="#anchor10">9.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor11">10.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">11.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">11.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">11.2.</a>&nbsp;
Informative References<br />
<a href="#sec-changes">Appendix&nbsp;A.</a>&nbsp;
Change Log<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">A.1.</a>&nbsp;
Changes since draft-ietf-p2psip-reload-00<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Overview</h3>

<p>The SIP Usage of RELOAD allows SIP user agents to provide a
      peer-to-peer telephony service without the requirement for permanent
      proxy or registration servers. In such a network, the RELOAD overlay
      itself performs the registration and rendezvous functions ordinarily
      associated with such servers.
</p>
<p>The SIP Usage involves two basic functions: </p>
<blockquote class="text"><dl>
<dt>Registration: </dt>
<dd>SIP UAs can use the RELOAD data storage
          functionality to store a mapping from their AOR to their Node-ID in
          the overlay, and to retrieve the Node-ID of other UAs.
</dd>
<dt>Rendezvous: </dt>
<dd>Once a SIP UA has identified the Node-ID
          for an AOR it wishes to call, it can use the RELOAD message routing
          system to set up a direct connection which can be used to exchange
          SIP messages.
</dd>
</dl></blockquote>

<p>For instance, Bob could register his Node-ID, "1234", under his AOR,
      "sip:bob@dht.example.com". When Alice wants to call Bob, she queries the
      overlay for "sip:bob@dht.example.com" and gets back Node-ID 1234. She
      then uses the overlay to establish a direct connection with Bob and can
      use that direct connection to perform a standard SIP INVITE. The way
      this works is as follows:
</p>
<p></p>
<ol class="text">
<li>Bob, operating Node-ID 1234, stores a mapping from his URI to his
          Node-ID in the overlay. I.e., "sip:bob@dht.example.com -&gt;
          1234".
</li>
<li>Alice, operating Node-ID 5678, decides to call Bob. She looks up
          "sip:bob@dht.example.com" in the overlay and retrieves "1234".
</li>
<li>Alice uses the overlay to route an AppAttach message to Bob's
          peer. Bob responds with his own AppAttach and they set up a direct
          connection, as shown below.
</li>
</ol>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Alice       Peer1      Overlay     PeerN      Bob
(5678)                                     (1234)
-------------------------------------------------
AppAttach -&gt;
            AppAttach -&gt;
                      AppAttach -&gt;
                                  AppAttach -&gt;
                                     &lt;- AppAttach
                            &lt;- AppAttach
                 &lt;- AppAttach
     &lt;- AppAttach

&lt;------------------ ICE Checks -----------------&gt;
INVITE -----------------------------------------&gt;
&lt;--------------------------------------------- OK
ACK --------------------------------------------&gt;
&lt;------------ ICE Checks for media -------------&gt;
&lt;-------------------- RTP ----------------------&gt;

</pre></div>
<p>It is important to note that RELOAD's only role here is to set up the
      direct SIP connection between Alice and Bob. As soon as the ICE checks
      complete and the connection is established, then ordinary SIP is used.
      In particular, the establishment of the media channel for the phone call
      happens via the usual SIP mechanisms, and RELOAD is not involved. Media
      never goes over the overlay. After the successful exchange of SIP
      messages, call peers run ICE connectivity checks for media.
</p>
<p>As well as allowing mappings from AORs to Node-IDs, the SIP Usage
      also allows mappings from AORs to other AORs. For instance, if Bob
      wanted his phone calls temporarily forwarded to Charlie, he could store
      the mapping "sip:bob@dht.example.com -&gt; sip:charlie@dht.example.com".
      When Alice wants to call Bob, she retrieves this mapping and can then
      fetch Charlie's AOR to retrieve his Node-ID.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<p>We use the terminology and definitions from <a class='info' href='#I-D.ietf-p2psip-concepts'>Concepts and Terminology for Peer to
      Peer SIP<span> (</span><span class='info'>Bryan, D., Matthews, P., Shim, E., Willis, D., and S. Dawkins, &ldquo;Concepts and Terminology for Peer to Peer SIP,&rdquo; July&nbsp;2008.</span><span>)</span></a> [I&#8209;D.ietf&#8209;p2psip&#8209;concepts] and the <a class='info' href='#I-D.ietf-p2psip-base'>RELOAD Base
      Protocol<span> (</span><span class='info'>Jennings, C., Lowekamp, B., Rescorla, E., Baset, S., and H. Schulzrinne, &ldquo;REsource LOcation And Discovery (RELOAD) Base           Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a> [I&#8209;D.ietf&#8209;p2psip&#8209;base] extensively in this document.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Registering AORs</h3>

<p>In ordinary SIP, a UA registers its AOR and location with a
      registrar. In RELOAD, this registrar function is provided by the overlay
      as a whole. To register its location, a RELOAD peer stores a
      SipRegistration structure under its own AOR. This uses the
      SIP-REGISTRATION Kind-ID, which is formally defined in <a class='info' href='#sec.sip-reg-kind'>Section&nbsp;7<span> (</span><span class='info'>SIP-REGISTRATION Kind Definition</span><span>)</span></a>. </p>
<blockquote class="text"><dl>
<dt>Note:</dt>
<dd>GRUUs are handled via a separate mechanism, as
          described in <a class='info' href='#sec-gruus'>Section&nbsp;6<span> (</span><span class='info'>GRUUs</span><span>)</span></a>.
</dd>
</dl></blockquote>

<p>As a simple example, if Alice's AOR were "sip:alice@dht.example.com"
      and her Node-ID were "1234", she might store the mapping
      "sip:alice@example.org -&gt; 1234". This would tell anyone who wanted to
      call Alice to contact node "1234".
</p>
<p>RELOAD peers MAY store two kinds of SIP mappings:
</p>
<p></p>
<ul class="text">
<li>From AORs to destination lists (a single Node-ID is just a
          trivial destination list.)
</li>
<li>From AORs to other AORs.
</li>
</ul>

<p>The meaning of the first kind of mapping is "in order to contact me,
      form a connection with this peer." The meaning of the second kind of
      mapping is "in order to contact me, dereference this AOR". This allows
      for forwarding. For instance, if Alice wants calls to her to be
      forwarded to her secretary, Sam, she might insert the following mapping
      "sip:alice@dht.example.org -&gt; sip:sam@dht.example.org".
</p>
<p>The contents of a SipRegistration structure are as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

       enum {sip_registration_uri (1), sip_registration_route (2),
          (255)} SipRegistrationType;

       select (SipRegistration.type) {
         case sip_registration_uri:
           opaque               uri&lt;0..2^16-1&gt;;

         case sip_registration_route:
           opaque               contact_prefs&lt;0..2^16-1&gt;;
           Destination          destination_list&lt;0..2^16-1&gt;;

         /* This type can be extended */

       } SipRegistrationData;

       struct {
          SipRegistrationType   type;
          uint16                length;
          SipRegistrationData   data;
      } SipRegistration;


</pre></div>
<p>The contents of the SipRegistration PDU are:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
</dd>
<dt>type </dt>
<dd>
</dd>
<dt></dt>
<dd>the type of the registration
</dd>
<dt></dt>
<dd>
</dd>
<dt>length </dt>
<dd>
</dd>
<dt></dt>
<dd>the length of the rest of the PDU
</dd>
<dt></dt>
<dd>
</dd>
<dt>data </dt>
<dd>
</dd>
<dt></dt>
<dd>the registration data
</dd>
</dl></blockquote>

<p></p>
<ul class="text">
<li>If the registration is of type "sip_registration_uri", then the
          contents are an opaque string containing the URI.
</li>
<li>If the registration is of type "sip_registration_route", then the
          contents are an opaque string containing the callee's contact
          preferences and a destination list for the peer.
</li>
</ul>

<p>RELOAD explicitly supports multiple registrations for a single AOR.
      The registrations are stored in a Dictionary with the dictionary keys
      being Node-IDs. Consider, for instance, the case where Alice has two
      peers:
</p>
<p></p>
<ul class="text">
<li>her desk phone (1234)
</li>
<li>her cell phone (5678)
</li>
</ul>

<p>Alice might store the following in the overlay at resource
      "sip:alice@dht.example.com".
</p>
<p></p>
<ul class="text">
<li>A SipRegistration of type "sip_registration_route" with
          dictionary key "1234" and value "1234".
</li>
<li>A SipRegistration of type "sip_registration_route" with
          dictionary key "5678" and value "5678".
</li>
</ul>

<p>Note that this structure explicitly allows one Node-ID to forward to
      another Node-ID. For instance, Alice could set calls to her desk phone
      to ring at her cell phone. It's not clear that this is useful in this
      case, but may be useful if Alice has two AORs.
</p>
<p>In order to prevent hijacking, registrations are subject to access
      control rules. Before a Store is permitted, the storing peer MUST check
      that:
</p>
<p></p>
<ul class="text">
<li>The certificate contains a username that is a SIP AOR that hashes
          to the Resource-ID it is being stored at.
</li>
<li>The certificate contains a Node-ID that is the same as the
          dictionary key it is being stored at.
</li>
</ul>

<p>Note that these rules permit Alice to forward calls to Bob without
      his permission. However, they do not permit Alice to forward Bob's calls
      to her. See <a class='info' href='#sec-security-malicious-retargeting'>Section&nbsp;8.2.2<span> (</span><span class='info'>Malicious Retargeting</span><span>)</span></a>
      for more on this point.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Looking up an AOR</h3>

<p>When a RELOAD user wishes to call another user, starting with a
      non-GRUU AOR, he follows the following procedure. (GRUUs are discussed
      in <a class='info' href='#sec-gruus'>Section&nbsp;6<span> (</span><span class='info'>GRUUs</span><span>)</span></a>).
</p>
<p></p>
<ol class="text">
<li>Check to see if the domain part of the AOR matches the domain
          name of an overlay of which he is a member. If not, then this is an
          external AOR, and he MUST do one of the following: 
<ul class="text">
<li>Fail the call.
</li>
<li>Use ordinary SIP procedures.
</li>
<li>Attempt to become a member of the overlay indicated by the
              domain part, if that overlay is a RELOAD overlay.)
</li>
</ul>
</li>
<li>Perform a Fetch for kind SIP-REGISTRATION at the Resource-ID
          corresponding to the AOR. This Fetch SHOULD NOT indicate any
          dictionary keys, so that it will fetch all the stored values.
</li>
<li>If any of the results of the Fetch are non-GRUU AORs, then repeat
          step 1 for that AOR.
</li>
<li>Once only GRUUs and destination lists remain, the peer removes
          duplicate destination lists and GRUUs from the list and forms a SIP
          connection to the appropriate peers as described in the following
          sections. If there are also external AORs, the peer follows the
          appropriate procedure for contacting them as well.
</li>
</ol>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Forming a Direct Connection</h3>

<p>Once the peer has translated the AOR into a set of destination lists,
      it then uses the overlay to route AppAttach messages to each of those
      peers. The "application" field MUST be 5060 to indicate SIP. If
      certificate-based authentication is in use, the responding peer MUST
      present a certificate with a Node-ID matching the terminal entry in the
      route list. Note that it is possible that the peers already have a
      RELOAD connection between them. This MUST NOT be used for SIP messages.
      However, if a SIP connection already exists, that MAY be used. Once the
      AppAttach succeeds, the peer sends SIP messages over the connection as
      in normal SIP.
</p>
<a name="sec-gruus"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
GRUUs</h3>

<p>GRUUs do not require storing data in the Overlay Instance. Rather,
      they are constructed by embedding a base64-encoded destination list in
      the gr URI parameter of the GRUU. The base64 encoding is done with the
      alphabet specified in table 1 of RFC 4648 with the exception that ~ is
      used in place of =. An example GRUU is
      "sip:alice@example.com;gr=MDEyMzQ1Njc4OTAxMjM0NTY3ODk~". When a peer
      needs to route a message to a GRUU in the same P2P network, it simply
      uses the destination list and connects to that peer.
</p>
<p>Because a GRUU contains a destination list, it MAY have the same
      contents as a destination list stored elsewhere in the resource
      dictionary.
</p>
<p>Anonymous GRUUs are done in roughly the same way but require either
      that the enrollment server issue a different Node-ID for each anonymous
      GRUU required or that a destination list be used that includes a peer
      that compresses the destination list to stop the Node-ID from being
      revealed.
</p>
<a name="sec.sip-reg-kind"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
SIP-REGISTRATION Kind Definition</h3>

<p>This section defines the SIP-REGISTRATION kind.
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
</dd>
<dt>Name</dt>
<dd>SIP-REGISTRATION
</dd>
<dt></dt>
<dd>
</dd>
<dt>Kind IDs</dt>
<dd>The Resource Name for the SIP-REGISTRATION
          Kind-ID is the AOR of the user. The data stored is a
          SipRegistrationData, which can contain either another URI or a
          destination list to the peer which is acting for the user.
</dd>
<dt></dt>
<dd>
</dd>
<dt>Data Model</dt>
<dd>The data model for the SIP-REGISTRATION
          Kind-ID is dictionary. The dictionary key is the Node-ID of the
          storing peer. This allows each peer (presumably corresponding to a
          single device) to store a single route mapping.
</dd>
<dt></dt>
<dd>
</dd>
<dt>Access Control</dt>
<dd>USER-NODE-MATCH.
</dd>
</dl></blockquote>

<p>Data stored under the SIP-REGISTRATION kind is of type
      SipRegistration. This comes in two varieties: </p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
</dd>
<dt>sip_registration_uri </dt>
<dd>
</dd>
<dt></dt>
<dd>a URI which the user can be reached at.
</dd>
<dt></dt>
<dd>
</dd>
<dt>sip_registration_route </dt>
<dd>
</dd>
<dt></dt>
<dd>a destination list which can be used to reach the user's
          peer.
</dd>
</dl></blockquote>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Overview</h3>

<p>RELOAD provides a generic storage service, albeit one designed to
        be useful for P2PSIP. In this section we discuss security issues that
        are likely to be relevant to any usage of RELOAD. In <a class='info' href='#section.sip-issues'>Section&nbsp;8.2<span> (</span><span class='info'>SIP-Specific Issues</span><span>)</span></a> we describe issues that are
        specific to SIP.
</p>
<a name="section.sip-issues"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
SIP-Specific Issues</h3>

<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.1"></a><h3>8.2.1.&nbsp;
Fork Explosion</h3>

<p>Because SIP includes a forking capability (the ability to
          retarget to multiple recipients), fork bombs are a potential DoS
          concern. However, in the SIP usage of RELOAD, fork bombs are a much
          lower concern because the calling party is involved in each
          retargeting event and can therefore directly measure the number of
          forks and throttle at some reasonable number.
</p>
<a name="sec-security-malicious-retargeting"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.2"></a><h3>8.2.2.&nbsp;
Malicious Retargeting</h3>

<p>Another potential DoS attack is for the owner of an attractive
          number to retarget all calls to some victim. This attack is
          difficult to ameliorate without requiring the target of a SIP
          registration to authorize all stores. The overhead of that
          requirement would be excessive and in addition there are good use
          cases for retargeting to a peer without there explicit
          cooperation.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.3"></a><h3>8.2.3.&nbsp;
Privacy Issues</h3>

<p>All RELOAD SIP registration data is public. Methods of providing
          location and identity privacy are still being studied.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>IANA [shall register/has registered] code point TBD to represent the
      SIP-REGISTRATION kind, as described in <a class='info' href='#sec.sip-reg-kind'>Section&nbsp;7<span> (</span><span class='info'>SIP-REGISTRATION Kind Definition</span><span>)</span></a>.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgments</h3>

<p>This draft is a merge of the "REsource LOcation And Discovery
      (RELOAD)" draft by David A. Bryan, Marcia Zangrilli and Bruce B.
      Lowekamp, the "Address Settlement by Peer to Peer" draft by Cullen
      Jennings, Jonathan Rosenberg, and Eric Rescorla, the "Security
      Extensions for RELOAD" draft by Bruce B. Lowekamp and James Deverick,
      the "A Chord-based DHT for Resource Lookup in P2PSIP" by Marcia
      Zangrilli and David A. Bryan, and the Peer-to-Peer Protocol (P2PP) draft
      by Salman A. Baset, Henning Schulzrinne, and Marcin Matuszewski.
</p>
<p>Thanks to Michael Chen for his contributions.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-p2psip-base">[I-D.ietf-p2psip-base]</a></td>
<td class="author-text">Jennings, C., Lowekamp, B., Rescorla, E., Baset, S., and H. Schulzrinne, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-p2psip-base-00.txt">REsource LOcation And Discovery (RELOAD) Base
          Protocol</a>,&rdquo; draft-ietf-p2psip-base-00 (work in progress), October&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-p2psip-base-00.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-p2psip-concepts">[I-D.ietf-p2psip-concepts]</a></td>
<td class="author-text">Bryan, D., Matthews, P., Shim, E., Willis, D., and S. Dawkins, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-p2psip-concepts-02.txt">Concepts and Terminology for Peer to Peer SIP</a>,&rdquo; draft-ietf-p2psip-concepts-02 (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-p2psip-concepts-02.txt">TXT</a>).</td></tr>
</table>

<a name="sec-changes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Change Log</h3>

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Changes since draft-ietf-p2psip-reload-00</h3>

<p></p>
<ul class="text">
<li>Split SIP Usage from combined draft into new draft.
</li>
</ul>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cullen Jennings</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">170 West Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">MS: SJC-21/2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 408 421-9990</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:fluffy@cisco.com">fluffy@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bruce B. Lowekamp (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">MYMIC LLC</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1040 University Blvd., Suite 100</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Portsmouth, VA  23703</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:bbl@lowekamp.net">bbl@lowekamp.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Eric Rescorla</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Network Resonance</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">2064 Edgewood Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Palo Alto, CA  94303</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 650 320-8549</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ekr@networkresonance.com">ekr@networkresonance.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Salman A. Baset</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Columbia University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1214 Amsterdam Avenue</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">New York, NY</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:salman@cs.columbia.edu">salman@cs.columbia.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Henning Schulzrinne</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Columbia University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1214 Amsterdam Avenue</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">New York, NY</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hgs@cs.columbia.edu">hgs@cs.columbia.edu</a></td></tr>
</table>
</body></html>
