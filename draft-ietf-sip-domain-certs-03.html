<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Domain Certificates in the Session Initiation Protocol (SIP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Domain Certificates in the Session Initiation Protocol (SIP)">
<meta name="keywords" content="I-D, Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIP WG</td><td class="header">V. Gurbani</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Bell Laboratories, Alcatel-Lucent</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfcRFC3261'>RFC3261</a></td><td class="header">S. Lawrence</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">Nortel Networks, Inc.</td></tr>
<tr><td class="header">Intended status:  Standards Track</td><td class="header">A. Jeffrey</td></tr>
<tr><td class="header">Expires:  October 10, 2009</td><td class="header">Bell Laboratories, Alcatel-Lucent</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">April 08, 2009</td></tr>
</table></td></tr></table>
<h1><br />Domain Certificates in the Session Initiation Protocol (SIP)<br />draft-ietf-sip-domain-certs-03</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on October 10, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document describes how to construct and interpret certain information in a 
X.509 PKIX-compliant certificate for use in a Session Initiation Protocol 
(SIP) over Transport Layer Security (TLS) connection.  More specifically, 
this document describes how to encode and extract the identity of a SIP domain in a 
certificate and how to use that identity for SIP domain authentication.
As such, this document is relevant both to implementors of SIP and to issuers of cetificates.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Key Words<br />
<a href="#anchor3">2.</a>&nbsp;
Introduction<br />
<a href="#problem">3.</a>&nbsp;
Problem statement<br />
<a href="#domain-to-host">4.</a>&nbsp;
SIP domain to host resolution<br />
<a href="#problem-mutual">5.</a>&nbsp;
The need for mutual interdomain authentication<br />
<a href="#sp">6.</a>&nbsp;
Certificate usage by a SIP service provider<br />
<a href="#SIP-considerations">7.</a>&nbsp;
Behavior of SIP entities<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cert-subject">7.1.</a>&nbsp;
Finding SIP Identities in a Certificate<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#id-compare">7.2.</a>&nbsp;
Comparing SIP Identities<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uac">7.3.</a>&nbsp;
Client behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uas">7.4.</a>&nbsp;
Server behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#proxy">7.5.</a>&nbsp;
Proxy behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#registrar">7.6.</a>&nbsp;
Registrar behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#redirect">7.7.</a>&nbsp;
Redirect server behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#virtual-servers">7.8.</a>&nbsp;
Virtual SIP Servers and Certificate Content<br />
<a href="#sec-cons">8.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#digest-connection">8.1.</a>&nbsp;
Connection authentication using Digest<br />
<a href="#iana-cons">9.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor4">10.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">11.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">11.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">11.2.</a>&nbsp;
Informative References<br />
<a href="#anchor7">Appendix&nbsp;A.</a>&nbsp;
Editorial guidance (non-normative)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#additions">A.1.</a>&nbsp;
Additions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">A.2.</a>&nbsp;
Changes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">A.2.1.</a>&nbsp;
26.3.1<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Terminology</h3>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Key Words</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [1]. 
</p>
<p>Additional definition(s):

 </p>
<blockquote class="text"><dl>
<dt>SIP domain identity:</dt>
<dd>An identity (e.g., "sip:example.com")
  contained in an X.509 certificate bound to a subject that identifies 
  the subject as an authoritative SIP server for a domain.
</dd>
</dl></blockquote><p>

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p><a class='info' href='#RFC5246'>RFC 5246<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> [3] Transport Layer Security (TLS)  has started to
appear in an increasing number of Session Initiation Protocol (SIP) <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [2] implementations.  In order to use the authentication
capabilities of TLS, certificates as defined by the Internet X.509 Public
Key Infrastructure <a class='info' href='#RFC5280'>RFC 5280<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and   Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> [4] are required.
</p>
<p>Existing SIP specifications do not sufficiently specify how to use
certificates for domain (as opposed to host) authentication.  This document
provides guidance to ensure interoperability and uniform conventions for the 
construction and interpretation of certificates used to identify their
holders as being authoritative for the domain.
</p>
<p>The discussion in this document is pertinent to an X.509 PKIX-compliant
certificate used for a TLS connection; this document does not define use of such
certificates for any other purpose (such as S/MIME).  
</p>
<a name="problem"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Problem statement</h3>

<p>TLS uses <a class='info' href='#RFC5280'>RFC 5280<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and   Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> [4] X.509 Public Key 
Infrastructure to bind an identity or a set of identities, to the subject 
of a X.509 certificate.  While RFC3261 provides adequate guidance 
on the use of X.509 certificates used for S/MIME, it is relatively silent 
on the use of such certificates for TLS.  With respect to certificates 
for TLS, RFC3261 (Section 26.3.1) says:
</p>
<p></p>
<blockquote class="text">
<p>"Proxy servers, redirect servers and registrars SHOULD possess a
 site certificate whose subject corresponds to their canonical
 hostname."
</p>
</blockquote>

<p>The security properties of TLS and S/MIME as used in SIP are different:
X.509 certificates for S/MIME are generally used for end-to-end 
authentication and encryption, thus they serve to bind the identity
of a user to the certificate and RFC3261 is sufficiently clear that
in certificates used for S/MIME, the subjectAltName field will contain 
the appropriate identity.  On the other hand, X.509 certificates used for 
TLS serve to bind the identities of the per-hop domain sending or 
receiving the SIP messages.  However, the lack of guidelines in RFC3261
on exactly where to put identities -- in the subjectAltName field or 
carried as a Common Name (CN) in the Subject field -- of a X.509 certificates 
created ambiguities.  Following the accepted practice of the time, 
legacy X.509 certificates were allowed to store the identity in the 
CN field of the certificate 
instead of the currently specified subjectAltName extension.  Lack of
further guidelines on how to interpret the identities, which identity
to choose if more than one identity is present in the certificate, 
the behavior when multiple identities with different schemes were 
present in the certificate, etc. lead to ambiguities when attempting to 
interpret the certificate in a uniform manner for TLS use.
</p>
<p>This document shows how the certificates are to be used for mutual
authentication when both the client and server possess appropriate
certificates, and normative behavior for matching the 
DNS query string with an identity stored in the X.509 certificate.
Furthermore, a certificate can contain multiple 
identities for the subject in the subjectAltName extension (the "subject"
of a certificate identifies the entity associated with the public
key stored in the public key field.)  As such, this document specifies 
appropriate matching rules to encompass various subject identity 
representation options.  And finally, this document also provides 
guidelines to service providers for assigning certificates to SIP 
servers.
</p>
<p>The rest of this document is organized as follows: the next section
provides an overview of the most primitive case of a client using DNS
to access a SIP server and the resulting authentication steps.  
<a class='info' href='#problem-mutual'>Section&nbsp;5<span> (</span><span class='info'>The need for mutual interdomain authentication</span><span>)</span></a> looks at the reason why mutual inter-domain 
authentication is desired in SIP, and the lack of normative text and 
behavior in RFC3261 for doing so. <a class='info' href='#sp'>Section&nbsp;6<span> (</span><span class='info'>Certificate usage by a SIP service provider</span><span>)</span></a> outlines normative
guidelines for a service provider assigning certificates to
SIP servers.  <a class='info' href='#SIP-considerations'>Section&nbsp;7<span> (</span><span class='info'>Behavior of SIP entities</span><span>)</span></a> provides
normative behavior on the SIP entities (user agent clients, user agent
servers, registrars, redirect servers, and proxies) that need perform
authentication based on X.509 certificates.   
<a class='info' href='#sec-cons'>Section&nbsp;8<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> includes the security considerations.
</p>
<a name="domain-to-host"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
SIP domain to host resolution</h3>

<p>Routing in SIP is performed by having the client execute 
<a class='info' href='#RFC3263'>RFC 3263<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;Session Initiation Protocol (SIP): Location SIP Servers,&rdquo; June&nbsp;2002.</span><span>)</span></a> [7] procedures on a URI, called the 
"Application Unique String (AUS) (c.f. Section 8 of <a class='info' href='#RFC3263'>RFC 
3263<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;Session Initiation Protocol (SIP): Location SIP Servers,&rdquo; June&nbsp;2002.</span><span>)</span></a> [7]).  These procedures take as input a SIP AUS (the SIP domain) and 
return an ordered set containing one or more IP addresses, and a port number 
and transport corresponding to each IP address in the set (the "Expected 
Output") by querying an Domain Name Service (DNS).  If the transport 
indicates the use of TLS, then a TLS connection is opened to the server on a 
specific IP address and port.  The server presents an X.509 certificate 
to the client for verification as part of the initial TLS handshake.
</p>
<p>The client extracts identifiers from the Subject and any subjectAltName
extension in the certificate (see <a class='info' href='#cert-subject'>Section&nbsp;7.1<span> (</span><span class='info'>Finding SIP Identities in a Certificate</span><span>)</span></a>) and compares 
these values to the AUS.  If any identifier match is found, the server is 
considered to be authenticated and subsequent signaling can now proceed 
over the TLS connection.  Matching rules for X.509 certificates and the 
normative behavior for clients is specified in <a class='info' href='#uac'>Section&nbsp;7.3<span> (</span><span class='info'>Client behavior</span><span>)</span></a>.
</p>
<p>As an example, consider a request that is to be routed to the SIP address
"sips:alice@example.com".  This address requires a secure connection to 
the SIP domain "example.com", which becomes the SIP AUS value.  
Through a series of DNS manipulations, the AUS is mapped to a set of host
addresses and transports.  The entity attempting to create the connection
selects an address appropriate for use with TLS from this set.  When the connection is established to that server, 
the server presents a certificate asserting the identity "sip:example.com".  
Since the domain part of the SIP AUS matches the subject of the 
certificate, the server is authenticated (see <a class='info' href='#id-compare'>Section&nbsp;7.2<span> (</span><span class='info'>Comparing SIP Identities</span><span>)</span></a> for the normative rules that govern this comparison)
</p>
<p></p>
<blockquote class="text">
<p>SIPS borrows this pattern of server certificate matching from HTTPS.  However,
 <a class='info' href='#RFC2818'>RFC 2818<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> [8] prefers that the identity 
 be conveyed as a subjectAltName extension of type dNSName rather than 
 the common practice of conveying the identity in the CN 
 field of the Subject field.  Similarly, this document recommends
 that the SIP domain identity be conveyed as a subjectAltName extension of
 type uniformResourceIdentifier (c.f. <a class='info' href='#sp'>Section&nbsp;6<span> (</span><span class='info'>Certificate usage by a SIP service provider</span><span>)</span></a>, <a class='info' href='#cert-subject'>Section&nbsp;7.1<span> (</span><span class='info'>Finding SIP Identities in a Certificate</span><span>)</span></a>).
</p>
<p>A domain name in an X.509 certificates is properly interpreted
 only as a sequence of octets to be compared to the URI used to reach the
 host.  No inference can be made based on the DNS name hierarchy.  For example, 
 a valid certificate for "example.com" does not imply that the owner of that
 certificate has any relationship at all to "subname.example.com".
</p>
</blockquote>

<a name="problem-mutual"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
The need for mutual interdomain authentication</h3>

<p>Consider the SIP trapezoid shown in <a class='info' href='#sip-trapezoid'>Figure&nbsp;1<span> (</span><span class='info'>SIP Trapezoid</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="sip-trapezoid"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

  Proxy-A.example.com           Proxy-B.example.net
     +-------+                    +-------+
     | Proxy |--------------------| Proxy |
     +----+--+                    +---+---+
          |                           |
          |                           |
          |                           |
          |                         +---+
        0---0                       |   |
         /-\                        |___|
        +---+                      /    /
                                  +----+
   alice@example.com          bob@example.net

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: SIP Trapezoid&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>An user, alice@example.com, invites bob@example.net for a multimedia
communication session.  Alice's outbound proxy, Proxy-A.example.com,
uses normal <a class='info' href='#RFC3263'>RFC 3263<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;Session Initiation Protocol (SIP): Location SIP Servers,&rdquo; June&nbsp;2002.</span><span>)</span></a> [7] resolution rules
to find a proxy -- Proxy-B.example.net -- in the example.net domain that 
uses TLS.  Proxy-A actively establishes an interdomain TLS connection 
with Proxy-B and each presents a certificate to authenticate that 
connection.
</p>
<p><a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [2] section 26.3.2.2 
&quot;Interdomain Requests&quot; states that when a TLS connection is 
created between two proxies:

 </p>
<blockquote class="text">
<p>"Each side of the connection SHOULD verify and inspect
   the certificate of the other, noting the domain name that appears in
   the certificate for comparison with the header fields of SIP
   messages."
</p>
</blockquote><p>

However, RFC3261 is silent on whether to use the subjectAltName or CN of the certificate to obtain the domain name, and which takes precedence 
when there are multiple names identifying the holder of the certificate.
</p>
<p>The authentication problem for Proxy-A is straightforward: assuming
a secure DNS infrastructure and no routing attacks, Proxy-A already knows 
that Proxy-B is a valid proxy for the example.net domain.  Thus, in the 
certificate Proxy-A receives from Proxy-B, Proxy-A looks for the host name 
("Proxy-B.example.net") or an identity consisting of a SIP URI 
("sip:example.net") that asserts Proxy-B's authority over the example.net
domain.  Normative behavior for a TLS client like Proxy-A is specified
in <a class='info' href='#uac'>Section&nbsp;7.3<span> (</span><span class='info'>Client behavior</span><span>)</span></a>.
</p>
<p>The problem for Proxy-B is slightly more complex since it accepted
the TLS request passively.  Thus, Proxy-B does not possess an equivalent
AUS that it can use as an anchor in matching identities from Proxy-A's
certificate.

 </p>
<blockquote class="text">
<p><a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [2] section 26.3.2.2 only tells
  Proxy-B to "compare the domain asserted by the certificate with the
  'domainname' portion of the From header field in the INVITE request."
  The difficulty with that instruction is that the domainname in the From 
  header field is not always that of the domain from which the
  request is received.
</p>
</blockquote><p>

The normative behavior for a TLS server like Proxy-B that passively 
accepts a TLS connection and requires authentication of the sending 
peer domain is provided in <a class='info' href='#uas'>Section&nbsp;7.4<span> (</span><span class='info'>Server behavior</span><span>)</span></a>.
</p>
<a name="sp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Certificate usage by a SIP service provider</h3>

<p>Service providers MAY continue the practice of using existing
certificates for SIP usage with the identity conveyed in the Subject
field; however, such usage is NOT RECOMMENDED for new certificates, 
which MUST contain the identity or identities in the subjectAltName 
extension field.
</p>
<p>When assigning certificates to authoritative servers, 
a SIP service provider MUST ensure that the SIP AUS
used to reach the server appears as an identity in the subjectAltName field, 
or for compatibility with existing certificates, the Subject field of 
the certificate.  In practice, this means that a service provider distributes 
to its users SIP URIs whose domain portion corresponds to an identity for 
which the service provider has been issued a certificate.
</p>
<a name="SIP-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Behavior of SIP entities</h3>

<p>This section normatively specifies the behavior of SIP entities
when using X.509 certificates to determine an authenticated SIP domain
identity.
</p>
<p>The first two subsections apply to all SIP implementations that use TLS
to authenticate the peer: <a class='info' href='#cert-subject'>Section&nbsp;7.1<span> (</span><span class='info'>Finding SIP Identities in a Certificate</span><span>)</span></a> describes how to extract a set of SIP
identities from the certificate obtained from a TLS peer, and <a class='info' href='#id-compare'>Section&nbsp;7.2<span> (</span><span class='info'>Comparing SIP Identities</span><span>)</span></a> specifies how to compare SIP identities.  The
remaining subsections provide context for how and when these rules are to
be applied by entitites in different SIP roles.
</p>
<a name="cert-subject"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Finding SIP Identities in a Certificate</h3>

<p>Implementations (both clients and server) MUST determine the validity of a certificate by following
the procedures for constructing a certificate path and checking revocation
status described in <a class='info' href='#RFC5280'>RFC 5280<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and   Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> [4]. 
This document adds additional rules for interpreting 
an X.509 certificate for use in SIP.
</p>
<p>As specified by <a class='info' href='#RFC5280'>RFC 5280<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and   Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> [4] section 4.2.1.12, implementations 
MUST check for restrictions on certificate usage declared by any extendedKeyUsage 
extentions in the certificate.  The <a class='info' href='#I-D.sip-eku'>SIP Extended Key Usage (EKU) document<span> (</span><span class='info'>Lawrence, S. and V. Gurbani, &ldquo;Using Extended Key Usage (EKU) for Session Initiation Protocol (SIP)     X.509 Certificates,&rdquo; December&nbsp;2008.</span><span>)</span></a> [5] 
defines an extendedKeyUsage for SIP.
</p>
<p>Given an X.509 certificate that the above checks have found to be
acceptable, the following describes how to determine what SIP domain identity 
or identities the certificate contains.   A single certificate can serve more than
one purpose - that is, the certificate might contain identities not acceptable as SIP,
domain identities and/or might contain one or more identities that are acceptable for 
use as SIP domain identities.

</p>
<ol class="text">
<li>Examine each value in the subjectAltName field.  The
subjectAltName field and the constraints on its values
are defined in Section 4.2.1.6 of <a class='info' href='#RFC5280'>RFC 5280<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and   Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> [4].  
The subjectAltName field can be absent or can contain one or
more values.  Each value in the subjectAltName has a type; the only types
acceptable for encoding a SIP domain identity SHALL be:


<blockquote class="text"><dl>
<dt>URI</dt>
<dd>
    If the scheme of the URI is not "sip", then the implementation
    MUST NOT accept the value as a SIP domain identity.
  
</dd>
<dt></dt>
<dd>
    If the scheme of the URI value is "sip", and the URI value that contains 
    a userpart (there is an '@'), the implementation MUST NOT accept the value as a SIP domain 
    identity (a value with a userpart identifies an individual user, not a 
    domain).
  
</dd>
<dt></dt>
<dd>
    If the scheme of the URI value is "sip", and there is no userinfo component 
    in the URI (there is no '@'), then the implementation MUST accept the hostpart as a SIP domain identity.  
  
</dd>
<dt></dt>
<dd>Note: URI scheme tokens are always case insensitive
</dd>
<dt>DNS</dt>
<dd>An implementation MUST accept a domain name system identifier as a
  SIP domain identity if and only if no other identity is found that 
  matches the "sip" URI type described above.
</dd>
</dl></blockquote>

</li>
<li>If and only if the subjectAltName does not appear in the certificate, the
implementation MAY examine the CN field of the certificate.  If a valid DNS name 
is found there, the implementation MAY accept this value as a SIP domain 
identity.
</li>
<li>Accepting a DNS name in the CN value is allowed for backward
compatibility, but a Certificate Authority SHOULD NOT
issue new certificates with the identity as a DNS name in the CN value; see
<a class='info' href='#sp'>Section&nbsp;6<span> (</span><span class='info'>Certificate usage by a SIP service provider</span><span>)</span></a>.
</li>
</ol><p>

</p>
<p>The above procedure yields a set containing zero or more 
identities from the certificate.  A client uses these identities
to authenticate a server (see <a class='info' href='#uac'>Section&nbsp;7.3<span> (</span><span class='info'>Client behavior</span><span>)</span></a>) and a server uses 
them to authenticate a client (see <a class='info' href='#uas'>Section&nbsp;7.4<span> (</span><span class='info'>Server behavior</span><span>)</span></a>). 
</p>
<a name="id-compare"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Comparing SIP Identities</h3>

<p>When an implementation (either client or server) compares two values as SIP domain identities:

</p>
<blockquote class="text">
<p>Implementations MUST compare only the DNS name component of each SIP domain identifier; 
an implementation MUST NOT use any scheme or parameters in the
comparison.
</p>
<p>Implementations MUST compare the values as DNS names, which means that the
comparison is case insensitive as specified by <a class='info' href='#RFC4343'>RFC 4343<span> (</span><span class='info'>Eastlake, D., &ldquo;Domain Name System (DNS) Case Insensitivity Clarification,&rdquo; January&nbsp;2006.</span><span>)</span></a> [6].  
Implementations MUST handle Internationalized Domain Names (IDNs)
in accordance with Section 7.2 of <a class='info' href='#RFC5280'>RFC 5280<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and   Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> [4]
.
</p>
<p>Implemenations MUST match the values in their entirety:
</p>
<blockquote class="text">
<p>Implementations MUST NOT match suffixes.  For example,
"foo.example.com" does not match "example.com".
</p>
<p>Implemenations MUST NOT match any form of wildcard, such as a leading "." or "*." with any other DNS label or sequence of labels.  For example, "*.example.com" matches only "*.example.com" but not "foo.example.com".   Similarly, ".example.com" matches only ".example.com", and does not match "foo.example.com."

 </p>
<blockquote class="text">
<p><a class='info' href='#RFC2818'>RFC 2818<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> [8] (HTTP over TLS)  allows the dNSName 
  component to contain a wildcard; e.g., "DNS:*.example.com".  
  <a class='info' href='#RFC5280'>RFC 5280<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and   Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> [4], while not disallowing this 
  explicitly, leaves the interpretation of wildcards to the individual 
  specification.  <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [2]  does not provide any 
  guidelines on the presence of wildcards in certificates.  Through the rule above, this document
  prohibits such wildcards in certificates for SIP domains.
</p>
</blockquote>


</blockquote>


</blockquote><p>

</p>
<a name="uac"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Client behavior</h3>

<p>A client uses the domain portion of the SIP AUS to query a (possibly
untrusted) DNS to obtain a result set, which is one or more SRV and A records
identifying the server for the domain (see <a class='info' href='#domain-to-host'>Section&nbsp;4<span> (</span><span class='info'>SIP domain to host resolution</span><span>)</span></a> for an overview.)
</p>
<p>The SIP server, when establishing a TLS connection, presents its
certificate to the client for authentication.  The client MUST determine
the SIP domain identities in the server certificate using the procedure in
<a class='info' href='#cert-subject'>Section&nbsp;7.1<span> (</span><span class='info'>Finding SIP Identities in a Certificate</span><span>)</span></a>.  Then, the client MUST compare the original
domain portion of the SIP AUS used as input to the <a class='info' href='#RFC3263'>RFC 3263<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;Session Initiation Protocol (SIP): Location SIP Servers,&rdquo; June&nbsp;2002.</span><span>)</span></a> [7] server location 
procedures to the SIP domain identities obtained 
from the certificate.

</p>
<ul class="text">
<li>If there were no identities found in the server certificate, the server
is not authenticated.
</li>
<li>If the AUS matches any SIP domain identity obtained from the certificate
when compared as described in section <a class='info' href='#id-compare'>Section&nbsp;7.2<span> (</span><span class='info'>Comparing SIP Identities</span><span>)</span></a>, the
server is authenticated for the domain.
</li>
</ul><p>

</p>
<p>If the server is not authenticated, the client MUST close the connection
immediately.
</p>
<a name="uas"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Server behavior</h3>

<p>When a server accepts a TLS connection, the server presents its own X.509
certificate to the client.  To authenticate the client, the server asks the
client for a certificate.  If the client possesses a certificate, that certificate is
presented to the server.  If the client does not present a certificate, the client
MUST NOT be considered authenticated.

</p>
<blockquote class="text">
<p>Whether or not to close a connection if the client does not present a
  certificate is a matter of local policy, and depends on the authentication
  needs of the server for the connection.  Some currently deployed servers
  use Digest authentication to authenticate individual requests on the
  connection, and choose to treat the connection as authenticated by those
  requests for some purposes (but see <a class='info' href='#digest-connection'>Section&nbsp;8.1<span> (</span><span class='info'>Connection authentication using Digest</span><span>)</span></a>).
</p>
<p>If the local server policy requires client authentication for some local purpose,
  then one element of such a local policy might be to allow the connection only if the
  client is authenticated.  For example, if the server is an inbound proxy
  that has peering relationships with the outbound proxies of other specific
  domains, the server might allow only connections authenticated as coming from
  those domains.
</p>
</blockquote><p>

</p>
<p>To authenticate the client, the server MUST obtain the set of SIP domain identities from the client
certificate as described in <a class='info' href='#cert-subject'>Section&nbsp;7.1<span> (</span><span class='info'>Finding SIP Identities in a Certificate</span><span>)</span></a>.
Because the server accepted the TLS connection passively, unlike a
client, the server does not possess an AUS for comparison.  Nonetheless, server
policies can use the set of SIP domain identities gathered from the
certificate in <a class='info' href='#cert-subject'>Section&nbsp;7.1<span> (</span><span class='info'>Finding SIP Identities in a Certificate</span><span>)</span></a> to make authorization
decisions.
</p>
<p>For example, a very open policy could be to accept a X.509
certificate and validate the certificate using the procedures in <a class='info' href='#RFC5280'>RFC 5280<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and   Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> [4] .  If the certificate is valid, the identity set
is logged.
</p>
<p>Alternatively, the server could have a list of all SIP 
domains the server is allowed to accept connections from; when a client presents 
its certificate, for each identity in the client certificate, the 
server searches for the identity in the list of acceptable domains to decide 
whether or not to accept the connection.  Other policies that make 
finer distinctions are possible.
</p>
<p>The decision of whether or not the authenticated connection to
the client is appropriate for use to route new requests to the client
domain is independent of whether or not the connection is authenticated;
the <a class='info' href='#I-D.connect-reuse'>connect-reuse<span> (</span><span class='info'>Mahy, R., Gurbani, V., and B. Tate, &ldquo;Connection Reuse in the Session Initiation Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a> [10] draft discusses
this aspect in more detail.
</p>
<a name="proxy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
Proxy behavior</h3>

<p>A proxy MUST use the procedures defined for a User Agent Server (UAS) in 
<a class='info' href='#uas'>Section&nbsp;7.4<span> (</span><span class='info'>Server behavior</span><span>)</span></a> when authenticating a connection from a client.
</p>
<p>A proxy MUST use the procedures defined for a User Agent Client (UAC) in 
<a class='info' href='#uac'>Section&nbsp;7.3<span> (</span><span class='info'>Client behavior</span><span>)</span></a> when requesting an authenticated connection to a UAS.
</p>
<p>If a proxy adds a Record-Route when forwarding a request with the
expectation that the route is to use secure connections, the proxy MUST insert
into the Record-Route header a URI that corresponds to an identity for
which the proxy has a certificate; if the proxy does not insert such a URI, then creation of a secure connection using the value from the Record-Route as the
AUS will be impossible.
</p>
<a name="registrar"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6"></a><h3>7.6.&nbsp;
Registrar behavior</h3>

<p>A SIP registrar, acting as a server, follows the normative behavior
of <a class='info' href='#uas'>Section&nbsp;7.4<span> (</span><span class='info'>Server behavior</span><span>)</span></a>.  When the SIP registrar accepts a TLS connection from the client,
the SIP registrar presents its certificate.  Depending on the registrar policies, the SIP registrar can
challenge the client with HTTP Digest.
</p>
<a name="redirect"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.7"></a><h3>7.7.&nbsp;
Redirect server behavior</h3>

<p>A SIP redirect server follows the normative behavior of a UAS as specified in <a class='info' href='#uas'>Section&nbsp;7.4<span> (</span><span class='info'>Server behavior</span><span>)</span></a>.

</p>
<a name="virtual-servers"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.8"></a><h3>7.8.&nbsp;
Virtual SIP Servers and Certificate Content</h3>

<p>In the "virtual hosting" cases where multiple domains are managed by a
single application, a certificate can contain multiple subjects by 
having distinct identities in the subjectAltName field
as specified in <a class='info' href='#RFC4474'>RFC 4474<span> (</span><span class='info'>Peterson, J. and C. Jennings, &ldquo;Enhancements for Authenticated Identity Management in the Session          Initiation Protocol (SIP),&rdquo; August&nbsp;2006.</span><span>)</span></a> [9].  Clients seeking to authenticate a server
on such a virtual host can still follow the directions in 
<a class='info' href='#uac'>Section&nbsp;7.3<span> (</span><span class='info'>Client behavior</span><span>)</span></a> to find the identity matching the SIP AUS used
to query DNS.
</p>
<p>Alternatively, if the TLS client hello "server_name" extension as defined in <a class='info' href='#RFC5246'>RFC 5246<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> [3]
is supported, the client SHOULD use that extension to request a certificate corresponding
to the specific domain (the SIP AUS) that the client is seeking to 
establish a connection with.
</p>
<a name="sec-cons"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>The goals of TLS (when used with X.509 certificates) include the 
following security guarantees at the transport layer:

</p>
<blockquote class="text"><dl>
<dt>Confidentiality:</dt>
<dd>packets tunneled through TLS can be read only
  by the sender and receiver.
</dd>
<dt>Integrity:</dt>
<dd>packets tunneled through TLS cannot be undetectably 
  modified on the connection between the sender and receiver.
</dd>
<dt>Authentication:</dt>
<dd>each principal is authenticated to the other as
  possessing a private key for which a certificate has been issued.
  Moreover, this certificate has not been revoked, and is verifiable by a
  certificate chain leading to a (locally configured) trust anchor.
</dd>
</dl></blockquote>

<p>We expect appropriate processing of domain
certificates to provide the following security guarantees at the
application level:

</p>
<blockquote class="text"><dl>
<dt>Confidentiality:</dt>
<dd>SIPS messages from alice@example.com to 
  bob@example.net can be read only by alice@example.com, bob@example.net, and 
  SIP proxies issued with domain certificates for example.com or 
  example.net.
</dd>
<dt>Integrity:</dt>
<dd>SIPS messages from alice@example.com to 
  bob@example.net cannot be undetectably modified on the links between 
  alice@example.com, bob@example.net, and SIP proxies issued with domain 
  certificates for example.com or example.net.
</dd>
<dt>Authentication:</dt>
<dd>alice@example.com and proxy.example.com 
  are mutually authenticated; moreover proxy.example.com is authenticated to
  alice@example.com as an authoritative proxy for domain example.com.
  Similar mutual authentication guarantees are given between
  proxy.example.com and proxy.example.net and between proxy.example.net
  and bob@example.net.  As a result, alice@example.com is transitively
  mutually authenticated to bob@example.net (assuming trust in the
  authoritative proxies for example.com and example.net).
</dd>
</dl></blockquote>

<a name="digest-connection"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Connection authentication using Digest</h3>

<p>Digest authentication in SIP provides for authentication of the
  message sender to the challenging UAS.  As commonly deployed, digest authentication provides
  only very limited integrity protection of the authenticated message, and
  has no provision for binding the authentication to any attribute of the transport.
  Many existing SIP deployments have chosen to use the Digest authentication of
  one or more messages on a particular transport connection as a way to authenticate
  the connection itself - by implication, authenticating other
  (unauthenticated) messages on that connection.  Some even choose to
  similarly authenticate a UDP source address and port based on the digest
  authentication of another message received from that address and port.  
  This use of digest goes beyond the assurances that the Digest
  Authentication mechanism
  was designed to provide.  A SIP imlementation SHOULD NOT use the Digest
  Authentication of one message on a TCP connection or from a UDP peer to
  infer any authentication of any other messages on that connection or from
  that peer.  Authentication of the
  domain at the other end of a connection SHOULD be accomplished using TLS
  and the certificate validation rules described by this specification
  instead.
</p>
<a name="iana-cons"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>This memo does not contain any considerations for IANA.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgments</h3>

<p>The following IETF contributors provided substantive input to this
document: Jeroen van Bemmel, Michael Hammer, Cullen Jennings, Paul Kyzivat,
Derek MacDonald, Dave Oran, Jon Peterson, Eric Rescorla, Jonathan
Rosenberg, Russ Housley.  Special acknowledgement goes to Stephen Kent 
for extensively reviewing draft versions and suggesting invaluable 
feedback, edits, and comments.
</p>
<p>Paul Hoffman, Eric Rescorla and Robert Sparks provided much valuable
WGLC comments.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[1]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.ietf.org/rfc/rfc2119.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[2]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.ietf.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[3]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008 (<a href="ftp://ftp.isi.edu/in-notes/rfc5246.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5280">[4]</a></td>
<td class="author-text">Cooper, D., Santesson, S., Farrell, S., Boyen, S., Housley, R., and W. Polk, &ldquo;<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and
  Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;5280, May&nbsp;2008 (<a href="http://www.ietf.org/rfc/rfc5280.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.sip-eku">[5]</a></td>
<td class="author-text">Lawrence, S. and V. Gurbani, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-eku-03.txt.txt">Using Extended Key Usage (EKU) for Session Initiation Protocol (SIP)
    X.509 Certificates</a>,&rdquo; draft-ietf-sip-eku-03.txt (work in progress), December&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-eku-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4343">[6]</a></td>
<td class="author-text">Eastlake, D., &ldquo;<a href="http://tools.ietf.org/html/rfc4343">Domain Name System (DNS) Case Insensitivity Clarification</a>,&rdquo; RFC&nbsp;4343, January&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4343.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3263">[7]</a></td>
<td class="author-text">Rosenberg, J. and H. Schulzrinne, &ldquo;<a href="http://tools.ietf.org/html/rfc3263">Session Initiation Protocol (SIP): Location SIP Servers</a>,&rdquo; RFC&nbsp;3263, June&nbsp;2002 (<a href="http://www.ietf.org/rfc/rfc3263.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2818">[8]</a></td>
<td class="author-text">Rescorla, E., &ldquo;<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>,&rdquo; RFC&nbsp;2818, May&nbsp;2000 (<a href="http://www.ietf.org/rfc/rfc2818.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4474">[9]</a></td>
<td class="author-text">Peterson, J. and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4474">Enhancements for Authenticated Identity Management in the Session
         Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4474, August&nbsp;2006 (<a href="http://www.ietf.org/rfc/rfc4474.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.connect-reuse">[10]</a></td>
<td class="author-text">Mahy, R., Gurbani, V., and B. Tate, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-connect-reuse-13.txt.txt">Connection Reuse in the Session Initiation Protocol</a>,&rdquo; draft-ietf-sip-connect-reuse-13.txt (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-connect-reuse-13.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.essential-corrections">[11]</a></td>
<td class="author-text">Drage, K., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-drage-sip-essential-correction-03.txt.txt">A Process for Handling Essential Corrections to the
         Session Initiation  Protocol (SIP)</a>,&rdquo; draft-drage-sip-essential-correction-03.txt (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-drage-sip-essential-correction-03.txt">TXT</a>).</td></tr>
</table>

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Editorial guidance (non-normative)</h3>

<p>
    This document is intended to update RFC 3261 in accordance with the SIP
    Working Group procedures described in <a class='info' href='#I-D.essential-corrections'>[11]<span> (</span><span class='info'>Drage, K., &ldquo;A Process for Handling Essential Corrections to the          Session Initiation  Protocol (SIP),&rdquo; July&nbsp;2008.</span><span>)</span></a> or its successor.
  
</p>
<p>
    This appendix provides guidance to the editor of the next comprehensive
    update to <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [2] on how to incorporate
    the changes provided by this document.
  
</p>
<a name="additions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Additions</h3>

<p>
      The content of sections <a class='info' href='#domain-to-host'>Section&nbsp;4<span> (</span><span class='info'>SIP domain to host resolution</span><span>)</span></a> through <a class='info' href='#SIP-considerations'>Section&nbsp;7<span> (</span><span class='info'>Behavior of SIP entities</span><span>)</span></a> inclusive can be incorporated as
      subsections within a section that describes SIP domain authentication.
    
</p>
<p>
      The contents of <a class='info' href='#digest-connection'>Section&nbsp;8.1<span> (</span><span class='info'>Connection authentication using Digest</span><span>)</span></a> can be incorporated into 
      the Security Considerations section of the new document.
    
</p>
<p>
      All normative references from this document can be carried forward
      to the successor document.
    
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Changes</h3>

<p>
      The following subsections describe changes in specific sections of
      <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [2] that need to be modified in
      the successor document to align them with the content of this
      document.  In each of the following, the token
      &lt;domain-authentication&gt; is a reference to the section added as
      described in <a class='info' href='#additions'>Appendix&nbsp;A.1<span> (</span><span class='info'>Additions</span><span>)</span></a>.
    
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2.1"></a><h3>A.2.1.&nbsp;
26.3.1</h3>

<p>
        The current text says:
        </p>
<blockquote class="text">
<p>
            Proxy servers, redirect servers and registrars SHOULD possess a
            site certificate whose subject corresponds to their canonical
            hostname.
          
</p>
</blockquote><p>
        The suggested replacement for the above is:
        </p>
<blockquote class="text">
<p>
            Proxy servers, redirect servers, registrars, and any other
            server that is authoritative for some SIP purpose in a given
            domain SHOULD possess a certificate whose subject is a SIP domain
            as described in &lt;domain-authentication&gt;.
          
</p>
</blockquote><p>
      
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Vijay K. Gurbani</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bell Laboratories, Alcatel-Lucent</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1960 Lucent Lane</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Room 9C-533</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Naperville, IL  60566</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 630 224-0216</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:vkg@alcatel-lucent.com">vkg@alcatel-lucent.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Scott Lawrence</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nortel Networks, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">600 Technology Park</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Billerica, MA  01821</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 978 288 5508</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:scott.lawrence@nortel.com">scott.lawrence@nortel.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Alan S.A. Jeffrey</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bell Laboratories, Alcatel-Lucent</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1960 Lucent Lane</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Room 9C-533</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Naperville, IL  60566</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ajeffrey@alcatel-lucent.com">ajeffrey@alcatel-lucent.com</a></td></tr>
</table>
</body></html>
