



Network Working Group                                          D. Franke
Internet-Draft                                                    Akamai
Updates: 5905 (if approved)                                  A. Malhotra
Intended status: Standards Track                       Boston University
Expires: January 28, 2018                                  July 27, 2017


                      NTP Client Data Minimization
                  draft-ietf-ntp-data-minimization-01

Abstract

   This memo proposes backward-compatible updates to the Network Time
   Protocol to strip unnecessary identifying information from client
   requests and to improve resilience against blind spoofing of
   unauthenticated server responses.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on January 28, 2018.

Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



Franke & Malhotra       Expires January 28, 2018                [Page 1]

Internet-Draft        NTP Client Data Minimization             July 2017


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Requirements Language . . . . . . . . . . . . . . . . . . . .   2
   3.  Client Packet Format  . . . . . . . . . . . . . . . . . . . .   2
   4.  Security and Privacy Considerations . . . . . . . . . . . . .   3
     4.1.  Data Minimization . . . . . . . . . . . . . . . . . . . .   3
     4.2.  Transmit Timestamp Randomization  . . . . . . . . . . . .   4
   5.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   4
   6.  Implementation status - RFC EDITOR: REMOVE BEFORE PUBLICATION   4
   7.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   5
     7.1.  Normative References  . . . . . . . . . . . . . . . . . .   5
     7.2.  Informative References  . . . . . . . . . . . . . . . . .   5
   Appendix A.  Acknowledgements . . . . . . . . . . . . . . . . . .   6
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   6

1.  Introduction

   Network Time Protocol (NTP) packets, as specified by RFC 5905
   [RFC5905], carry a great deal of information about the state of the
   NTP daemon which transmitted them.  In the case of mode 4 packets
   (responses sent from server to client), as well as in broadcast (mode
   5) and symmetric peering modes (mode 1/2), most of this information
   is essential for accurate and reliable time synchronizaton.  However,
   in mode 3 packets (requests sent from client to server), most of
   these fields serve no purpose.  Server implementations never need to
   inspect them, and they can achieve nothing by doing so.  Populating
   these fields with accurate information is harmful to privacy of
   clients because it allows a passive observer to fingerprint clients
   and track them as they move across networks.

   This memo updates RFC 5905 to redact unnecessary data from mode 3
   packets.  This is a fully backwards-compatible proposal.  It calls
   for no changes on the server side, and clients which implement these
   updates will remain fully interoperable with existing servers.

2.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [RFC2119].

3.  Client Packet Format

   In every client-mode packet sent by a Network Time Protocol [RFC5905]
   implementation:





Franke & Malhotra       Expires January 28, 2018                [Page 2]

Internet-Draft        NTP Client Data Minimization             July 2017


      The first octet, which contains the leap indicator, version
      number, and mode fields, SHOULD be set to 0x23 (LI = 0, VN = 4,
      Mode = 3).

      The Transmit Timestamp field SHOULD be set uniformly at random,
      generated by a mechanism suitable for cryptographic purposes.
      [RFC4086] provides guidance on the generation of random values.

      The Poll field MAY be set to the actual polling interval as
      specified by RFC 5905, or else MAY be set to zero.

      The Precision field SHOULD be set to 0x20.

      All other header fields, specifically the Stratum, Root Delay,
      Root Dispersion, Reference ID, Reference Timestamp, Origin
      Timestamp, and Receive Timestamp, SHOULD be set to zero.

   Servers MUST allow client packets to conform to the above
   recommendations.  This requirement shall not be construed so as to
   prohibit servers from rejecting conforming packets for unrelated
   reasons, such as access control or rate limiting.

4.  Security and Privacy Considerations

4.1.  Data Minimization

   Zeroing out unused fields in client requests prevents disclosure of
   information that can be used for fingerprinting [RFC6973].

   While populating any of these fields with authentic data reveals at
   least some identifying information about the client, the Origin
   Timestamp and Receive Timestamp fields constitute a particularly
   severe information leak.  RFC 5905 calls for clients to copy the
   transmit timestamp and destination timestamp of the server's most
   recent response into the origin timestamp and receive timestamp
   (respectively) of their next request to that server.  Therefore, when
   a client moves between networks, a passive observer of both network
   paths can determine with high confidence that the old and new IP
   addresses belong to the same system by noticing that the transmit
   timestamp of a response sent to the old IP matches the origin
   timestamp of a request sent from the new one.

   Zeroing the poll field is made optional (MAY rather than SHOULD) so
   as not to preclude future development of schemes wherein the server
   uses information about the client's current poll interval in order to
   recommend adjustments back to the client.  Putting accurate
   information into this field has no significant impact on privacy




Franke & Malhotra       Expires January 28, 2018                [Page 3]

Internet-Draft        NTP Client Data Minimization             July 2017


   since an observer can already obtain this information simply by
   observing the actual interval between requests.

4.2.  Transmit Timestamp Randomization

   While this memo calls for most fields in client packets to be set to
   zero, the transmit timestamp is randomized.  This decision is
   motivated by security as well as privacy.

   NTP servers copy the transmit timestamp from the client's request
   into the origin timestamp of the response; this memo calls for no
   change in this behavior.  Clients discard any response whose origin
   timestamp does not match the transmit timestamp of any request
   currently in flight.

   In the absence of cryptographic authentication, verification of
   origin timestamps is clients' primary defense against blind spoofing
   of NTP responses.  It is therefore important that clients' transmit
   timestamps be unpredictable.  Their role in this regard is closely
   analagous to that of TCP Initial Sequence Numbers [RFC6528].

   The traditional behavior of the NTP reference implementation is to
   randomize only a few (typically 10-15 depending on the precision of
   the system clock) low-order bits of transmit timestamp, with all
   higher bits representing the system time, as measured just before the
   packet was sent.  This is suboptimal, because with so few random
   bits, an adversary sending spoofed packets at high volume will have a
   good chance of correctly guessing a valid origin timestamp.

5.  IANA Considerations

   [RFC EDITOR: DELETE PRIOR TO PUBLICATION]

   This memo introduces no new IANA considerations.

6.  Implementation status - RFC EDITOR: REMOVE BEFORE PUBLICATION

   This section records the status of known implementations of the
   protocol defined by this specification at the time of posting of this
   Internet-Draft, and is based on a proposal described in RFC7942.  The
   description of implementations in this section is intended to assist
   the IETF in its decision processes in progressing drafts to RFCs.
   Please note that the listing of any individual implementation here
   does not imply endorsement by the IETF.  Furthermore, no effort has
   been spent to verify the information presented here that was supplied
   by IETF contributors.  This is not intended as, and must not be
   construed to be, a catalog of available implementations or their




Franke & Malhotra       Expires January 28, 2018                [Page 4]

Internet-Draft        NTP Client Data Minimization             July 2017


   features.  Readers are advised to note that other implementations may
   exist.

   As of today the following vendors have produced an implementation of
   the NTP Client Data Minimization recommendations described in this
   document.

      OpenNTPD

7.  References

7.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

   [RFC5905]  Mills, D., Martin, J., Ed., Burbank, J., and W. Kasch,
              "Network Time Protocol Version 4: Protocol and Algorithms
              Specification", RFC 5905, DOI 10.17487/RFC5905, June 2010,
              <http://www.rfc-editor.org/info/rfc5905>.

7.2.  Informative References

   [RFC4086]  Eastlake 3rd, D., Schiller, J., and S. Crocker,
              "Randomness Requirements for Security", BCP 106, RFC 4086,
              DOI 10.17487/RFC4086, June 2005,
              <http://www.rfc-editor.org/info/rfc4086>.

   [RFC6528]  Gont, F. and S. Bellovin, "Defending against Sequence
              Number Attacks", RFC 6528, DOI 10.17487/RFC6528, February
              2012, <http://www.rfc-editor.org/info/rfc6528>.

   [RFC6973]  Cooper, A., Tschofenig, H., Aboba, B., Peterson, J.,
              Morris, J., Hansen, M., and R. Smith, "Privacy
              Considerations for Internet Protocols", RFC 6973,
              DOI 10.17487/RFC6973, July 2013,
              <http://www.rfc-editor.org/info/rfc6973>.

7.3.  URIs

   [1] http://cvsweb.openbsd.org/cgi-bin/cvsweb/src/usr.sbin/ntpd/
       client.c?rev=1.1







Franke & Malhotra       Expires January 28, 2018                [Page 5]

Internet-Draft        NTP Client Data Minimization             July 2017


Appendix A.  Acknowledgements

   The authors would like to gratefully acknowledge Henning Brauer for
   pioneering NTP data minimization techniques as early as June 2004 [1]
   as part of an NTP implementation for the OpenBSD Project.

   The authors would like to thank Prof. Sharon Goldberg and Miroslav
   Lichvar for encouraging standardisation of the approach described in
   this document.

Authors' Addresses

   Daniel Fox Franke
   Akamai Technologies, Inc.
   150 Broadway
   Cambridge, MA  02142
   United States

   Email: dafranke@akamai.com
   URI:   https://www.dfranke.us


   Aanchal Malhotra
   Boston University
   111 Cummington St
   Boston, MA/  02215
   United States

   Email: aanchal4@bu.edu






















Franke & Malhotra       Expires January 28, 2018                [Page 6]
