<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Session Initiation Protocol (SIP) User Agent Configuration</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Session Initiation Protocol (SIP) User Agent Configuration">
<meta name="keywords" content="I-D, Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">S. Lawrence, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">J. Elwell</td></tr>
<tr><td class="header">Expires: December 25, 2010</td><td class="header">Siemens Enterprise Communications</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">June 23, 2010</td></tr>
</table></td></tr></table>
<h1><br />Session Initiation Protocol (SIP) User Agent Configuration<br />draft-lawrence-sipforum-user-agent-config-03</h1>

<h3>Abstract</h3>

<p>
        This document defines procedures for how a SIP User Agent should
        locate, retrieve, and maintain current configuration information
        from a Configuration Service.
      
</p>
<p>
        This document is the product of the SIP Forum Technical Working
        Group User Agent Configuration Task Group.
      
</p>
<h3>Status of This Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on December 25, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#introduction">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#scope">1.1.</a>&nbsp;
Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#terminology">1.2.</a>&nbsp;
Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#phone.installation.examples">1.3.</a>&nbsp;
User Agent Installation Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#example.hosted.ip.service.provider">1.3.1.</a>&nbsp;
Hosted IP Service Provider Example<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#example.ip-pbx.solution">1.3.2.</a>&nbsp;
IP-PBX Example<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#high.security">1.3.3.</a>&nbsp;
Special Considerations for High Security Deployments<br />
<a href="#auto.config">2.</a>&nbsp;
Obtaining User Agent Configuration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#network.discovery">2.1.</a>&nbsp;
Network Discovery<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#link.discovery.auto">2.1.1.</a>&nbsp;
Link Layer Provisioning<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#network.discovery.auto">2.1.2.</a>&nbsp;
Network Layer Provisioning<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#domain.discovery">2.2.</a>&nbsp;
Obtaining the Configuration Service Domain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#domain.discovery.localnet">2.2.1.</a>&nbsp;
The Local Network Domain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#domain.discovery.manualname">2.2.2.</a>&nbsp;
Manual Domain Name Entry<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#configservice.url">2.3.</a>&nbsp;
Constructing the Configuration Request URL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#configservice.url.base">2.3.1.</a>&nbsp;
Obtaining a Configuration Service Base URL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#configservice.url.addparams">2.3.2.</a>&nbsp;
Adding Configuration Request Parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#provisioning.service.example">2.3.3.</a>&nbsp;
Configuration Request URI Example<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#request.http">2.4.</a>&nbsp;
Obtaining Configuration from the Configuration Service<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#request.http.authentication">2.4.1.</a>&nbsp;
Configuration Data Request Authentication<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#request.http.fail">2.4.2.</a>&nbsp;
Configuration Data Request Failure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#configuration.changes">2.5.</a>&nbsp;
Configuration Changes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#change.subscription">2.5.1.</a>&nbsp;
Configuration Change Subscriptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#change.poll">2.5.2.</a>&nbsp;
Configuration Change Polling<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stored.configuration">2.6.</a>&nbsp;
Validity of Stored Configuration Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#revalidate">2.6.1.</a>&nbsp;
Re-validating Configuration Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#backoff.retry">2.7.</a>&nbsp;
Retry Backoff Procedure<br />
<a href="#configuration.data">3.</a>&nbsp;
Configuration Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#configuration.data.items">3.1.</a>&nbsp;
Configuration Data Items<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#configuration.data.items.aor">3.1.1.</a>&nbsp;
Address-of-Record<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#configuration.data.items.realm">3.1.2.</a>&nbsp;
Realm<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#configuration.data.items.username">3.1.3.</a>&nbsp;
Username<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#configuration.data.items.digest">3.1.4.</a>&nbsp;
Digest<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#configuration.data.items.outboundproxy">3.1.5.</a>&nbsp;
OutboundProxy<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reset.to.default">3.2.</a>&nbsp;
Reset User Agent to Default Configuration<br />
<a href="#anchor1">4.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana.dhcpv4">4.1.</a>&nbsp;
DHCP SIP User Agent Configuration Domains Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana.dhcpv6">4.2.</a>&nbsp;
DHCPv6 SIP User Agent Configuration Domains Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana.unaptr">4.3.</a>&nbsp;
U-NAPTR Registration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana.reqparams">4.4.</a>&nbsp;
SIP Forum User Agent Configuration Parameter Registry<br />
<a href="#anchor4">5.</a>&nbsp;
Security Considerations<br />
<a href="#members">6.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">7.</a>&nbsp;
Normative References<br />
</p>
<br clear="all" />

<a name="introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
      A user gets a new SIP User Agent (UA); it may be a hardware device or software.  Some
      User Agents have a user interface that can accept a username, password, and domain
      name.  Other devices, like Analog Telephony Adapters (ATAs), have no user interface other
      than that provided by an attached analog phone.  How does a
      non-technical user minimally configure it so that when it is started, something
      useful happens?
    
</p>
<a name="scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Scope</h3>

<p>
        This document specifies a procedure for how a
        SIP User Agent locates, retrieves, and maintains current configuration information
        for a given SIP Service Provider.  As such, it specifies requirements to be met by both
        the User Agent, the Configuration Service at the SIP Service Provider, and the network
        infrastructure services that allow them to communicate.
      
</p>
<p>
          Nothing in this specification prohibits a User Agent from obtaining configuration
          information by any means in addition to the mechanisms specified herein.  
      
</p>
<p>
        The intent of this specification is to provide mechanisms sufficient for User Agents
        to discover an appropriate source of configuration and maintain the currency of that
        configuration.  A User Agent implementation compliant to this specification MAY
        also implement additional mechanisms necessary for particular environments,
        or for use when the services specified here are not available.
      
</p>
<p>
        The form and content of configuration data to be downloaded are outside the scope of
        this specification, although <a class='info' href='#configuration.data.items'>Section&nbsp;3.1<span> (</span><span class='info'>Configuration Data Items</span><span>)</span></a>, "<a class='info' href='#configuration.data.items'>Configuration Data Items<span> (</span><span class='info'>Configuration Data Items</span><span>)</span></a>" suggests a
        minimum set of data items likely to be required by all types of UA. 
      
</p>
<a name="terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Terminology</h3>

<p>
          The following terms are used in this document:

      </p>
<blockquote class="text"><dl>
<dt>User Agent, UA</dt>
<dd>
</dd>
<dt></dt>
<dd>
              As defined in <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261]. Note that this includes any implementation of a User
              Agent. A SIP phone is a User Agent, but the term also encompasses any other
              entity that uses SIP (for example: for a text chat, for sharing a whiteboard or
              for fax). 
        
</dd>
<dt>Soft User Agent, Soft UA</dt>
<dd>
</dd>
<dt></dt>
<dd>
              A User Agent that runs as an application within some larger system that has
              responsibility for some of the steps described in this specification.  In those
              cases the Soft UA must be able to obtain the information from the platform.  In
              all cases, the term User Agent also encompasses a Soft User Agent.
        
</dd>
<dt>SIP Service Provider, Service Provider</dt>
<dd>
</dd>
<dt></dt>
<dd>
              An entity that provides services to User Agents using the SIP protocol.  This
              specification requires that a Service Provider make configuration data and
              certain other information available in order to configure User Agents.
        
</dd>
<dt>Configuration</dt>
<dd>
</dd>
<dt></dt>
<dd>
              The set of information that establishes operational parameters for a particular User Agent.
        
</dd>
<dt>Configuration Service, CS</dt>
<dd>
</dd>
<dt></dt>
<dd>
              The source of Configuration for User Agents.
        
</dd>
<dt>Configuration Service Domain</dt>
<dd>
</dd>
<dt></dt>
<dd>
              The DNS name for the service from which a Configuration is requested.
        
</dd>
</dl></blockquote><p>

        
</p>
<p>
        The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
        "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
        interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
      
</p>
<a name="phone.installation.examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
User Agent Installation Examples</h3>

<p>
        This section is non-normative; it is a set of "user stories" - narrative descriptions of
        the user experience in different environments.  These are "black box" descriptions
        meant to include the actions to be taken by the human participants (including
        adminstrators and system operators as well as the "user" of the UA), but not how the
        network elements communicate or operate internally.  The intent is that these narratives
        provide context for the subsequent technical specifications.
      
</p>
<a name="example.hosted.ip.service.provider"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3.1"></a><h3>1.3.1.&nbsp;
Hosted IP Service Provider Example</h3>

<p>
          Configuring a new UA to use a hosted IP telephony service will
          typically proceed as follows:  The customer makes a request to their
          Service Provider to add one or more new users to their service.  The
          customer may supply further details such as a preferred username, type
          of end-point and any requests for specific functionality, depending on
          what information the Service Provider considers useful, but no
          additional information is required from the customer.
        
</p>
<p>
          The Service Provider performs any necessary provisioning actions on their equipment,
          and returns to the customer provisioning information, which may include: a domain
          name or a numeric domain identifier for the provider, a user identifier, and a
          password.  Typically, a Service Provider will supply provisioning information for
          each device to be provisioned, but may choose to supply information that can be used
          with multiple devices, or for a limited duration or with other benefits and
          restrictions.
        
</p>
<p>
          The customer enters the provisioning information into the
          UA to be configured, whereupon the UA uses this information to locate
          the configuration service, securely fetch the configuration information,
          and configure itself for operation.
        
</p>
<a name="example.ip-pbx.solution"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3.2"></a><h3>1.3.2.&nbsp;
IP-PBX Example</h3>

<p>
          Configuring a new UA in a typical business begins by provisioning a user identity in
          the PBX (add user "John Smith"), and assigning a phone number to the user.  That
          number must then be assigned to a line on a specific UA; this is usually done by
          selecting a UA and provisioning it in the PBX by its serial number (usually a MAC
          address), and then assigning the identity or phone number to a 'line' on that UA in the
          PBX configuration system.
        
</p>
<p>
          Once provisioning in the PBX is complete, the new user goes to his or her workplace
          and connnects the UA to the network.  When connected and powered up, the UA is
          provided with the user identity, phone number, and any other configuration data with
          no local user interaction - just connecting it to the network loads the configuration
          from the PBX and the UA is operational.
        
</p>
<a name="high.security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3.3"></a><h3>1.3.3.&nbsp;
Special Considerations for High Security Deployments</h3>

<p>
          To deploy a new UA in a high security scenario requires some special consideration. A
          security conscious deployment will most likely require that the SIP and other
          management interfaces, including the interface to the configuration service, are
          secured before the device is put in to service.
        
</p>
<p>
          In order to achieve any level of security, the device will need to be
          pre-configured with some security related information in the form of
          certificates. This may be achieved in a number of ways. Some examples include

        </p>
<ol class="text">
<li>
              An administrator who configures the device in a secure environment before making
              the device available to the user.
            
</li>
<li>
              Some certificates may be built into the device during the manufacturing process
              enabling the configuration service to certify information such as the manufacturer,
              UA type and MAC address. The configuration service may then be used to provision
              the device with other certificates as required.
            
</li>
<li>
              The device may have a facility for the user to provide the security information
              in the form of a security card or dongle.
            
</li>
</ol><p>
        
</p>
<p>
          All these mechanism are likely to restrict the user to a limited set of devices
          approved for use in a particular deployment.
        
</p>
<a name="auto.config"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Obtaining User Agent Configuration</h3>

<p>
      This section specifies how a User Agent connects to the network, determines what domain
      to request configuration for, obtains configuration from that domain, and is notified by
      that domain when the configuration changes.  
    
</p>
<p>
      The User Agent MAY obtain configuration information by any means in addition to those
      specified here, and MAY use such information in preference to any of the steps specified
      below, but MUST be capable of using these procedures alone in order to be compliant with
      this specification.
    
</p>
<a name="network.discovery"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Network Discovery</h3>

<p>
        A UA needs a minimum set of parameters to allow it to communicate on the network. Some
        networks allow the UA to automatically discover these parameters, while other networks
        require some or all of these parameters to be manually provisioned on the UA.
      
</p>
<a name="link.discovery.auto"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1"></a><h3>2.1.1.&nbsp;
Link Layer Provisioning</h3>

<p>
          The UA SHOULD attempt to use LLDP-MED (see <a class='info' href='#ANSI.TIA-1057-2006'>[ANSI.TIA&#8209;1057&#8209;2006]<span> (</span><span class='info'>American National Standards Institute, &ldquo;Telecommunications IP Telephony Infrastructure Link Layer Discovery Protocol for Media Endpoint Devices,&rdquo; April&nbsp;1993.</span><span>)</span></a>) for
          automatic provisioning of link layer parameters.
        
</p>
<p>
          In some deployments, failure to properly provision the link layer may result in the
          UA having incorrect layer 2 priority, degrading the quality of service, or being on
          the wrong virtual LAN (VLAN), possibly resulting in complete loss of service.
        
</p>
<a name="network.discovery.auto"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2"></a><h3>2.1.2.&nbsp;
Network Layer Provisioning</h3>

<p>
          In order to communicate using IP, the UA needs the following minimal IP
          configuration parameters:
        
</p>
<p>IP Network Parameters
          </p>
<ul class="text">
<li>UA IP Address
</li>
<li>Subnet Mask
</li>
<li>Gateway IP address
</li>
<li>DNS Server IP address(es)
</li>
</ul><p>
        
</p>
<p>
          With the exception of a Soft UA that relies on its platform to obtain the IP
          Network Parameters,

          </p>
<ul class="text">
<li>
                If the User Agent is using IP version 4 on a network technology for which
                the Dynamic Host Configuration Protocol (DHCP) <a class='info' href='#RFC2131'>RFC 2131<span> (</span><span class='info'>Droms, R., &ldquo;Dynamic Host Configuration Protocol,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2131] is
                defined, the UA MUST attempt to obtain the IP Network Parameters using
                DHCP and MUST request DHCP options XX (see <a class='info' href='#iana.dhcpv4'>Section&nbsp;4.1<span> (</span><span class='info'>DHCP SIP User Agent Configuration Domains Option</span><span>)</span></a>) and 15 <a class='info' href='#RFC2132'>RFC 2132<span> (</span><span class='info'>Alexander, S. and R. Droms, &ldquo;DHCP Options and BOOTP Vendor Extensions,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2132].  If the
                DHCP service provides a value for option XX, the domain name(s) it provides MUST be
                saved as candidates for use as the Local Network Domain (see <a class='info' href='#domain.discovery'>Section&nbsp;2.2<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>, "<a class='info' href='#domain.discovery'>Obtaining the Configuration Service Domain<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>").  If and only if no values are returned for option XX,
                the UA MUST save any values returned for option 15 for use as the Local
                Network Domain.
              
</li>
<li>
                If the User Agent is using IP version 6 on a network technology for which
                the Dynamic Host Configuration Protocol version 6 (DHCPv6) <a class='info' href='#RFC3315'>RFC 3315<span> (</span><span class='info'>Droms, R., Bound, J., Volz, B., Lemon, T., Perkins, C., and M. Carney, &ldquo;Dynamic Host Configuration Protocol for IPv6 (DHCPv6),&rdquo; July&nbsp;2003.</span><span>)</span></a> [RFC3315] is defined, the UA MAY use any standard IPv6 mechanism
                to determine the IP Network Parameters, but MUST request DHCPv6 options YY
                (see xref target='iana.dhcpv6'/>) and 21 <a class='info' href='#RFC3319'>RFC 3319<span> (</span><span class='info'>Schulzrinne, H. and B. Volz, &ldquo;Dynamic Host Configuration Protocol (DHCPv6) Options for Session Initiation Protocol (SIP) Servers,&rdquo; July&nbsp;2003.</span><span>)</span></a> [RFC3319].  If the
                DHCPv6 service provides a value for option YY, those domain names MUST be
                saved as candidates for use as the Local Network Domain (see <a class='info' href='#domain.discovery'>Section&nbsp;2.2<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>, "<a class='info' href='#domain.discovery'>Obtaining the Configuration Service Domain<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>").  If and only if no values are returned for option YY,
                the UA MUST save any values returned for option 21 for use as the Local
                Network Domain.
              
</li>
</ul><p>

        
</p>
<a name="domain.discovery"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Obtaining the Configuration Service Domain</h3>

<p>
        To obtain a configuration, the UA needs to know what domain to request it from.  This
        domain is the Configuration Service Domain; its value is a DNS name (see <a class='info' href='#RFC1034'>RFC 1034<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - concepts and facilities,&rdquo; November&nbsp;1987.</span><span>)</span></a> [RFC1034]).
      
</p>
<p>
        User control or prior configuration MAY establish a value for the Configuration
        Service Domain that takes precedence over the discovery procedure defined below.
        In the absence of user control or prior configuration, candidate
        values for the Configuration Service Domain
        are obtained as specified in <a class='info' href='#domain.discovery.localnet'>Section&nbsp;2.2.1<span> (</span><span class='info'>The Local Network Domain</span><span>)</span></a>, "<a class='info' href='#domain.discovery.localnet'>The Local Network Domain<span> (</span><span class='info'>The Local Network Domain</span><span>)</span></a>", or if that is
        unsuccessful, by the manual mechanism specified in <a class='info' href='#domain.discovery.manualname'>Section&nbsp;2.2.2<span> (</span><span class='info'>Manual Domain Name Entry</span><span>)</span></a>, "<a class='info' href='#domain.discovery.manualname'>Manual Domain Name Entry<span> (</span><span class='info'>Manual Domain Name Entry</span><span>)</span></a>".
      
</p>
<a name="domain.discovery.localnet"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.1"></a><h3>2.2.1.&nbsp;
The Local Network Domain</h3>

<p>
          The UA MUST attempt to use each value obtained for the Local Network Domain name (see
          <a class='info' href='#network.discovery.auto'>Section&nbsp;2.1.2<span> (</span><span class='info'>Network Layer Provisioning</span><span>)</span></a>, "<a class='info' href='#network.discovery.auto'>Network Layer Provisioning<span> (</span><span class='info'>Network Layer Provisioning</span><span>)</span></a>") as the
          Configuration Service Domain.  If multiple names are provided
          by DHCP and/or DHCPv6 (multiple names may be returned by these
          services if both are in use, if the UA has multiple network
          interfaces, or if the option responses have multiple values), the UA MUST attempt to use each of the names
          provided until a configuration is successfully obtained.  The
          order in which values obtained in different responses are used is not
          defined by this specification - the UA MAY use any order;
          multiple values returned within a single response MUST be tried
          in the order they were provided in that response.
        
</p>
<p>
          If the DHCP service does not provide any local domain name values, the UA SHOULD use the
          manual mechanism defined in <a class='info' href='#domain.discovery.manualname'>Section&nbsp;2.2.2<span> (</span><span class='info'>Manual Domain Name Entry</span><span>)</span></a>, "<a class='info' href='#domain.discovery.manualname'>Manual Domain Name Entry<span> (</span><span class='info'>Manual Domain Name Entry</span><span>)</span></a>".  
        
</p>
<a name="domain.discovery.manualname"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2"></a><h3>2.2.2.&nbsp;
Manual Domain Name Entry</h3>

<p>
          A UA MAY provide an interface by which a DNS name is provided
          directly by the user for the Configuration Service Name.
        
</p>
<a name="configservice.url"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Constructing the Configuration Request URL</h3>

<p>
        Using the Configuration Service Domain name obtained in <a class='info' href='#domain.discovery'>Section&nbsp;2.2<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>, "<a class='info' href='#domain.discovery'>Obtaining the Configuration Service Domain<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>", the UA MUST construct
        an HTTPS URL <a class='info' href='#RFC2818'>RFC 2818<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> [RFC2818] with which to request
        configuration.  Constructing this URL consists of two parts:

        </p>
<ul class="text">
<li>
            <a class='info' href='#configservice.url.base'>Section&nbsp;2.3.1<span> (</span><span class='info'>Obtaining a Configuration Service Base URL</span><span>)</span></a>, 
            "<a class='info' href='#configservice.url.base'>Obtaining a Configuration Service Base URL<span> (</span><span class='info'>Obtaining a Configuration Service Base URL</span><span>)</span></a>"
          
</li>
<li>
            <a class='info' href='#configservice.url.addparams'>Section&nbsp;2.3.2<span> (</span><span class='info'>Adding Configuration Request Parameters</span><span>)</span></a>,
            "<a class='info' href='#configservice.url.addparams'>Adding Configuration Request Parameters<span> (</span><span class='info'>Adding Configuration Request Parameters</span><span>)</span></a>"
          
</li>
</ul><p>
      
</p>
<a name="configservice.url.base"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.1"></a><h3>2.3.1.&nbsp;
Obtaining a Configuration Service Base URL</h3>

<p>
          The Configuration Service Domain is resolved to one or more URLs using the U-NAPTR
          DDDS application defined in <a class='info' href='#RFC4848'>RFC 4848<span> (</span><span class='info'>Daigle, L., &ldquo;Domain-Based Application Service Location Using URIs and the             Dynamic Delegation Discovery Service (DDDS),&rdquo; April&nbsp;2007.</span><span>)</span></a> [RFC4848] "Domain-Based Application Service
          Location Using URIs and the Dynamic Delegation Discovery Service
          (DDDS)".
        
</p>
<p>
          The lookup key for the U-NAPTR request is the Configuration Service Domain Name
          determined in <a class='info' href='#domain.discovery'>Section&nbsp;2.2<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>, "<a class='info' href='#domain.discovery'>Obtaining the Configuration Service Domain<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>".  The UA MUST make a DNS request for
          NAPTR records for that domain name.  From the returned records, the UA MUST select
          those whose Service field value is "SFUA.CFG"; from those
          records, the UA MUST extract the https URL of the Configuration Service from the
          Regular Expression field (see next paragraph for the construction of that field
          value).
        
</p>
<p>
          The NAPTR records for the Configuration Service Domain Name whose Service field
          value is "SFUA.CFG" MUST be configured with the Flag field set to
          "U", an empty Substitution field, and a Regular Expression
          field value of the following syntax (i.e., a regular expression to replace the domain
          name with an https URI):
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

          u-naptr-regexp = "!.*!" &lt;URI&gt; "!"

</pre></div><p>

          where &lt;URI&gt; is as defined in STD 66 <a class='info' href='#RFC3986'>RFC 3986<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> [RFC3986], the URI syntax
          specification, and where the scheme of the URI is "https".
        
</p>
<p>
          Note that the UA does not need to implement a general regular expression evaluator in
          order to process the record above correctly.  The URI value can be extracted by
          stripping the fixed value "!^.*!" from the beginning of the value,
          and "!" from the end of the value to obtain the base URL.  See
          <a class='info' href='#provisioning.service.example'>Section&nbsp;2.3.3<span> (</span><span class='info'>Configuration Request URI Example</span><span>)</span></a>, "<a class='info' href='#provisioning.service.example'>Configuration Request URI Example<span> (</span><span class='info'>Configuration Request URI Example</span><span>)</span></a>".
        
</p>
<a name="provisioning.server.redundancy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.1.1"></a><h3>2.3.1.1.&nbsp;
Configuration Service Redundancy</h3>

<p>
            Multiple Configuration Servers can be used to provide redundancy and additional
            capacity for provisioning User Agents.  If the DNS NAPTR request for the
            Configuration Service Domain Name returns multiple records with the 'SFUA.CFG'
            service tag, then the UA should treat the resulting URLs as alternatives, ordered
            according to the rules for the priority and weight as specified for NAPTR records. 
          
</p>
<p>
            In addition to redundancy provided by multiple NAPTR records, resolution of the
            host part of the https URL can produce multiple results.
          
</p>
<a name="configservice.url.base.fail"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.1.2"></a><h3>2.3.1.2.&nbsp;
Configuration Service Name to Base URL Resolution Failure</h3>

<p>
            If the DNS request to resolve the Configuration Service Name to a request URL does
            not receive any response, the UA should follow standard DNS retry procedures.
          
</p>
<p>
            If the DNS request to resolve the Configuration Domain Name to a host name returns
            a response that indicates that no matching result is available (NXDOMAIN), the UA
            SHOULD attempt to obtain another Configuration Domain Name using the procedures in
            <a class='info' href='#domain.discovery'>Section&nbsp;2.2<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>, "<a class='info' href='#domain.discovery'>Obtaining the Configuration Service Domain<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>".
          
</p>
<a name="configservice.url.addparams"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.2"></a><h3>2.3.2.&nbsp;
Adding Configuration Request Parameters</h3>

<p>
          To construct the full configuration request URL, the UA
          adds one or more parameters to the base URLs to specify what configuration the UA
          is requesting.  

        </p>
<ol class="text">
<li>
              The UA MUST add all parameters from those defined in the <a class='info' href='#configservice.url.params'>Configuration Request Parameters<span> (</span><span class='info'>Configuration Request Parameters</span><span>)</span></a> list below
              for which the UA has a value. 
              Any parameter from that set for which the UA does not have a value MUST be
              omitted.
            
</li>
<li>
              The query parameter names defined by this specification all begin with the
              prefix 'sfua-'.  All names beginning with the prefix
              'sfua-' are reserved for this specification and future
              revisions.  The UA MUST NOT include any request parameter whose name begins with
              the prefix 'sfua-' that is not defined by this specification
              (including any future revisions).
            
</li>
<li>
              Any parameter not defined by the specification is allowed, but
              MUST be ignored by any Configuration Service that does not
              recognize it.
            
</li>
</ol><p>
        
</p>
<a name="configservice.url.params"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.2.1"></a><h3>2.3.2.1.&nbsp;
Configuration Request Parameters</h3>

<p>
            </p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
                The following parameters are defined for the configuration
                request.  <a class='info' href='#iana.reqparams'>Section&nbsp;4.4<span> (</span><span class='info'>SIP Forum User Agent Configuration Parameter Registry</span><span>)</span></a> creates an IANA
                registry for these and any parameters defined in the future.
              
</dd>
<dt>sfua-id</dt>
<dd>
</dd>
<dt></dt>
<dd>
                The URN identifying the User Agent, constructed as
                specified in section 4.1 of <a class='info' href='#RFC5626'>RFC 5626<span> (</span><span class='info'>Jennings, C., Mahy, R., and F. Audet, &ldquo;Managing Client-Initiated Connections in the Session Initiation Protocol (SIP),&rdquo; October&nbsp;2009.</span><span>)</span></a> [RFC5626] "Managing Client-Initiated
                Connections in the Session Initiation Protocol (SIP)". 
              
</dd>
<dt></dt>
<dd>
                Since the procedure defined by <a class='info' href='#RFC5626'>RFC 5626<span> (</span><span class='info'>Jennings, C., Mahy, R., and F. Audet, &ldquo;Managing Client-Initiated Connections in the Session Initiation Protocol (SIP),&rdquo; October&nbsp;2009.</span><span>)</span></a> [RFC5626] allows any UA to
                construct a value for this parameter, the sfua-id parameter MUST always be
                included.
              
</dd>
<dt></dt>
<dd>
                If the UA implements <a class='info' href='#RFC5626'>RFC 5626<span> (</span><span class='info'>Jennings, C., Mahy, R., and F. Audet, &ldquo;Managing Client-Initiated Connections in the Session Initiation Protocol (SIP),&rdquo; October&nbsp;2009.</span><span>)</span></a> [RFC5626], and includes the '+sip.instance' Contact
                header field parameter in any request, when requesting configuration it MUST
                use the same value for the sfua-id parameter. 
              
</dd>
<dt>sfua-user</dt>
<dd>
</dd>
<dt></dt>
<dd>
                An identifier for a user associated with the configuration.  Note that this
                might be different than any SIP 'user' in the UA configuration: it could,
                for example, be the login name of an account on the service provider web site.
                The syntax of this parameter is that of the <a class='info' href='#RFC2617'>RFC 2617<span> (</span><span class='info'>Franks, J., Hallam-Baker, P., Hostetler, J., Lawrence, S., Leach, P., Luotonen, A., and L. Stewart, &ldquo;HTTP Authentication: Basic and Digest Access Authentication,&rdquo; June&nbsp;1999.</span><span>)</span></a> [RFC2617]
                'userid'. 
              
</dd>
<dt></dt>
<dd>
                See <a class='info' href='#request.http.authentication'>Section&nbsp;2.4.1<span> (</span><span class='info'>Configuration Data Request Authentication</span><span>)</span></a>, "<a class='info' href='#request.http.authentication'>Configuration Data Request Authentication<span> (</span><span class='info'>Configuration Data Request Authentication</span><span>)</span></a>" for how this parameter
                relates to authentication of the configuration data request.
              
</dd>
<dt>sfua-vendor</dt>
<dd>
</dd>
<dt></dt>
<dd>
                An identifier that specifies the vendor of the User Agent.  The syntax of the
                value of this parameter is that of a DNS domain.  The domain value MUST be that
                of a domain owned by the vendor. 
              
</dd>
<dt>sfua-model</dt>
<dd>
</dd>
<dt></dt>
<dd>
                An identifier that further specifies the User Agent from among those produced
                by the vendor.  The syntax of the value of this parameter is the same as the
                <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261] 'token'.  Values for this parameter are selected by the vendor. 
              
</dd>
<dt>sfua-revision</dt>
<dd>
</dd>
<dt></dt>
<dd>
                An identifier that further specifies the User Agent from among those produced
                by the vendor.  The syntax of the value of this parameter is the same as the
                <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261] 'token'.  Values for this parameter are selected by the vendor. 
              
</dd>
</dl></blockquote><p>
        
</p>
<a name="provisioning.service.example"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.3"></a><h3>2.3.3.&nbsp;
Configuration Request URI Example</h3>

<p>
          Using the rules in <a class='info' href='#domain.discovery'>Section&nbsp;2.2<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>, "<a class='info' href='#domain.discovery'>Obtaining the Configuration Service Domain<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>", the UA has determined that the
          Configuration Service Domain value is "example.net".  To obtain the base URL, the UA
          constructs the DNS NAPTR request for "example.net.", which returns the DNS records:

          <br /><hr class="insert" />
<a name="example.cs.naptr"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

NAPTR  10 10 "u" "SFUA.CFG" "!^.*$!https://p1.example.net/cfg!" ""
NAPTR 100 10 "u" "SFUA.CFG" "!^.*$!https://p2.example.net/cfg!" ""
NAPTR  90 50 "s" "SIP+D2T"  ""  _sip._tcp.example.net.
NAPTR 100 50 "s" "SIP+D2U"  ""  _sip._udp.example.net.

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Example Configuration Service NAPTR Query Results&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


          The records with the service-field "SFUA.CFG" each provide a base URL value for
          SIP UA configuration requests.
        
</p>
<p>
          Our hypothetical example communications device is a 'HypoComm' version 2.1, made by
          ExampleCorp, and has the link layer MAC address of 00:11:22:33:44:55.  It does not
          have any prior knowledge of a user identity for which to request configuration, so it
          constructs query parameters using the values it does have, combining each with the
          base URL to create these request URLs (lines wrapped for readability):
          
          <br /><hr class="insert" />
<a name="example.requri"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

https://p1.example.net/cfg
   ?sfua-id=urn:uuid:00000000-0000-1000-8000-001122334455
   &amp;sfua-vendor=examplecorp.com
   &amp;sfua-model=HypoComm
   &amp;sfua-revision=2.1
https://p2.example.net/cfg
   ?sfua-id=urn:uuid:00000000-0000-1000-8000-001122334455
   &amp;sfua-vendor=examplecorp.com
   &amp;sfua-model=HypoComm
   &amp;sfua-revision=2.1

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Example Configuration Request URLs&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

        
</p>
<a name="request.http"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Obtaining Configuration from the Configuration Service</h3>

<p>
        To request configuration using a URL constructed as specified in
        <a class='info' href='#configservice.url'>Section&nbsp;2.3<span> (</span><span class='info'>Constructing the Configuration Request URL</span><span>)</span></a>, "<a class='info' href='#configservice.url'>Constructing the Configuration Request URL<span> (</span><span class='info'>Constructing the Configuration Request URL</span><span>)</span></a>" the User Agent MUST do an HTTPS GET request to
        each of the URLs until a configuration that the UA can use is
        returned in response to one of the requests.
      
</p>
<p>
        A successful final response from the Configuration Service to a GET request for
        configuration data MUST contain configuration data for the UA in the HTTP response
        body.  Note that the full capabilities of HTTP as specified in
        <a class='info' href='#RFC2616'>RFC 2616<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> [RFC2616] are available to the CS, so responses
        such as redirection can be used by the CS as a part of the process of providing 
        configuration data.
      
</p>
<p>
        Configuration data returned in a successful response is subject to change by the CS.
        The HTTP cache control metadata (the max-age directive value from any Cache-Control
        header, and the Etag and Last-Modified header values) returned in the response that
        provides configuration data is used to determine when a configuration change has
        occured (<a class='info' href='#change.notification'>Section&nbsp;2.5.1.3<span> (</span><span class='info'>Configuration Change Notices</span><span>)</span></a>, "<a class='info' href='#change.notification'>Configuration Change Notices<span> (</span><span class='info'>Configuration Change Notices</span><span>)</span></a>") and to validate any stored configuration data (<a class='info' href='#stored.configuration'>Section&nbsp;2.6<span> (</span><span class='info'>Validity of Stored Configuration Data</span><span>)</span></a>, "<a class='info' href='#stored.configuration'>Validity of Stored Configuration Data<span> (</span><span class='info'>Validity of Stored Configuration Data</span><span>)</span></a>").

        </p>
<ul class="text">
<li>
              An HTTP response from the CS that provides configuration data MUST include cache
              control metadata sufficient to ensure that when a new configuration is available,
              the cache control information for that new data is different.
            
</li>
<li>
              The UA MUST retain all of the HTTP cache control metadata from any response that
              provides configuration data.
            
</li>
</ul><p>
      
</p>
<a name="request.http.authentication"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.1"></a><h3>2.4.1.&nbsp;
Configuration Data Request Authentication</h3>

<p>
          Because the Configuration Request URL scheme is HTTPS, the UA
          MUST always use TLS <a class='info' href='#RFC5246'>RFC 5246<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5246]
          to establish a connection with the Configuration Service.  
        
</p>
<p>
          The UA MUST provide a server_name extension in the TLS Client Hello message as
          defined in <a class='info' href='#RFC4366'>RFC 4366<span> (</span><span class='info'>Blake-Wilson, S., Nystrom, M., Hopwood, D., Mikkelsen, J., and T. Wright, &ldquo;Transport Layer Security (TLS) Extensions,&rdquo; April&nbsp;2006.</span><span>)</span></a> [RFC4366] "Transport Layer Security (TLS) Extensions", 
          whose value is the Configuration Service Domain Name (note that
          this might not be the same as the host part of the CS base URL). This allows the
          CS to identify and provide a server certificate containing the
          desired identity (allowing for a single server to serve multiple domain
          names).   
        
</p>
<p>
          A UA MUST attempt to validate the server certificate provided by
          the CS, in accordance with the rules defined in Section 3.1 of
           <a class='info' href='#RFC2818'>RFC 2818<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> [RFC2818].  Unfortunately, the validation attempt might fail (e.g.,
          because the UA might not have in firmware a trusted root CA cert to
          which the CS certificate chain can be connected or because the root
          CA cert has expired since the UA firmware was last updated).  If the
          UA is unable to validate the server certificate provided by the CS,
          the UA SHOULD store the server certificate and alert the user if
          that CS host provides a different certificate in the future.
          Although this 'trust on first use' model is not as secure as
          certificate validation, it does give some protection against 'man
          in the middle' attacks in the future.
        
</p>
<p>
          If it has one, the UA MUST provide a client certificate.  The CS MUST validate the
          UA client's certificate, if one is provided.  If the CS is unable to authenticate the
          certificate provided by the UA (for example, the UA is using a self-signed
          certificate), then the CS MAY choose to cache the certificate, provided that the UA
          successfully authenticates using HTTP authentication (see next paragraph).
          This allows a CS to treat the digest authentication credentials as a single-use
          password to authenticate the client certificate.  This 'trust on first use' model
          provides protection against future 'man in the middle' attacks, provided that the
          initial communication is not compromised.
        
</p>
<p>
          If the CS requires HTTP authentication of the configuration data
          request, the HTTP 'username' parameter used MUST be the same
          value as the sfua-user value provided in the configuration data
          request parameters.  The UA MUST implement both Basic and
          Digest authentication as specified by <a class='info' href='#RFC2617'>RFC
          2617<span> (</span><span class='info'>Franks, J., Hallam-Baker, P., Hostetler, J., Lawrence, S., Leach, P., Luotonen, A., and L. Stewart, &ldquo;HTTP Authentication: Basic and Digest Access Authentication,&rdquo; June&nbsp;1999.</span><span>)</span></a> [RFC2617].
        
</p>
<a name="request.http.fail"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.2"></a><h3>2.4.2.&nbsp;
Configuration Data Request Failure</h3>

<p>
            The HTTP configuration data request can fail in a number of ways; the error
            handling for each is defined below:

          </p>
<ul class="text">
<li>
                If a DNS request to resolve the host name in the request URL returns a
                response that indicates that no matching result is available (NXDOMAIN), the
                UA MUST remove that request URL from the list of alternatives for the
                Configuration Service Domain.
              
</li>
<li>
                If the attempt to open a TCP connection to the host in the request URL fails,
                the UA MAY attempt requests to any alternative URLs for the same configuration
                service without waiting between alternatives, but any requests to
                the same host MUST wait between requests according to the procedure defined in
                <a class='info' href='#backoff.retry'>Section&nbsp;2.7<span> (</span><span class='info'>Retry Backoff Procedure</span><span>)</span></a>, "<a class='info' href='#backoff.retry'>Retry Backoff Procedure<span> (</span><span class='info'>Retry Backoff Procedure</span><span>)</span></a>".  
              
</li>
<li>
                If the TCP connection succeeds but the TLS handshake fails, including failure
                of the UA to validate the certificate provided by the Configuration Service
                host (if the UA is capable of validation), the UA MUST remove the failed URL
                from the list of alternative URLs for this Configuration Service Domain.
              
</li>
<li>
                If the request returns a permanent HTTP failure response
                (response code >= 400, and does not contain a Retry-After
                header field), the UA MUST remove
                the failed URL from the list of alternatives for this Configuration Service
                Domain. 
              
</li>
<li>
                If the list of alternatives for this Configuration Service Domain becomes
                empty, the UA MUST attempt to obtain another Configuration
                Domain Name using the procedures in <a class='info' href='#domain.discovery'>Section&nbsp;2.2<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>, "<a class='info' href='#domain.discovery'>Obtaining the Configuration Service Domain<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>".
              
</li>
<li>
                If the UA has reached its chosen maximum number of retries
                (this specification does not specify a maximum number of
                retries, but any retries to the same host MUST follow the
                procedure defined in <a class='info' href='#backoff.retry'>Section&nbsp;2.7<span> (</span><span class='info'>Retry Backoff Procedure</span><span>)</span></a>, "<a class='info' href='#backoff.retry'>Retry Backoff Procedure<span> (</span><span class='info'>Retry Backoff Procedure</span><span>)</span></a>"), the UA MAY
                attempt to obtain another Configuration Domain Name using
                the procedures in <a class='info' href='#domain.discovery'>Section&nbsp;2.2<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>, "<a class='info' href='#domain.discovery'>Obtaining the Configuration Service Domain<span> (</span><span class='info'>Obtaining the Configuration Service Domain</span><span>)</span></a>".
              
</li>
</ul><p>
          
</p>
<a name="configuration.changes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Configuration Changes</h3>

<p>
        The configuration data provided by the CS is subject to change.  This specification
        provides for two mechanisms by which the UA discovers that a configuration change is
        available:
        </p>
<ul class="text">
<li>
            SIP Subcription by the UA to the CS for notification of changes to the
            configuration data. 
          
</li>
<li>
            HTTP polling by the UA of the configuration data URL at the CS.
          
</li>
</ul><p>
        The choice of mechanism is made by the Configuration Service and signaled to the UA in each
        HTTP response that provides configuration data.  In such a response, the CS MUST
        either:
        </p>
<ul class="text">
<li>
            Indicate that the UA is to subscribe for change notifications
            by including a Link header in the response with the link
            relation 'monitor' and SIP URI.  This choice is specified in
            <a class='info' href='#change.subscription'>Section&nbsp;2.5.1<span> (</span><span class='info'>Configuration Change Subscriptions</span><span>)</span></a> <a class='info' href='#change.subscription'>Configuration Change Subscriptions<span> (</span><span class='info'>Configuration Change Subscriptions</span><span>)</span></a>.
          
</li>
<li>
            Indicate that the UA is to poll for updates using HTTP by not
            including a Link header with the link relation 'monitor'.  This
            choice is specified in <a class='info' href='#change.poll'>Section&nbsp;2.5.2<span> (</span><span class='info'>Configuration Change Polling</span><span>)</span></a> <a class='info' href='#change.poll'>Configuration Change Polling<span> (</span><span class='info'>Configuration Change Polling</span><span>)</span></a>.
          
</li>
</ul><p>
        A User Agent MUST support both mechanisms, and use the mechanism indicated by the
        Configuration Service.
      
</p>
<a name="change.subscription"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.1"></a><h3>2.5.1.&nbsp;
Configuration Change Subscriptions</h3>

<p>
          If the CS chooses to use the SIP subscription mechanism, it MUST include a Link
          header in the HTTP configuration data response as specified by <a class='info' href='#draft-roach-sip-http-subscribe'>[draft&#8209;roach&#8209;sip&#8209;http&#8209;subscribe]<span> (</span><span class='info'>Roach, A., &ldquo;A SIP Event Package for Subscribing to Changes to an HTTP Resource,&rdquo; February&nbsp;2010.</span><span>)</span></a>; the URI value in the Link header MUST be a
          SIP URI, and the link relation ('rel' attribute) value MUST be 'monitor'.  The
          'monitor-group' relation MUST NOT be used - see below for rules regarding monitoring
          of multiple configuration data resources.  The SIP URI returned in the Link header is
          the 'configuration change subscription URI'.
        
</p>
<p>
          A UA that receives a successful configuration data response with a Link header that
          specifies a 'monitor' relation MUST attempt to maintain a subscription to the SIP URI
          from the Link header in that response for the http-monitor event package.  This
          subscription is referred to herein as a 'configuration change subscription'.
        
</p>
<p>
          The CS MUST accept properly authenticated SUBSCRIBE requests from the UA for the
          http-monitor event package at the URI it provided in the Link header of a
          configuration data response.  Authentication of the SUBSCRIBE request uses any standard
          SIP authentication mechanism with credentials supplied to the UA in the configuration
          data. 
        
</p>
<p>
          Configuration data MAY include references in the form of additional URLs at the CS
          that the UA MUST use to obtain additional data. Any response to requests for these
          additional URLs that provide configuration data MUST provide cache control data and a
          configuration change subscription URI.  The CS MAY return a unique configuration
          change subscription URI for each configuration data request, or MAY return the same
          SIP URI for different requests, so long as a change to the configuration data
          returned in any of these request results in notification on all subscriptions to the
          associated subscription URI.
        
</p>
<p>
          If the CS returns a unique configuration change subscription URI in the Link header
          of different configuration data requests:
          </p>
<ul class="text">
<li>
                The UA MUST maintain multiple subscriptions; one to each URI associated with
                configuration data the UA is using.
              
</li>
</ul><p>
        
</p>
<p>
          If the CS returns the same configuration change subscription URI in the Link header
          of different configuration data requests:
          </p>
<ul class="text">
<li>
                The UA is not required to create multiple subscriptions to the same URI.
              
</li>
<li>
                The UA MUST associate the URI with each of the configuration data requests for
                which it was returned, and any NOTIFY or other change in the status of that
                subscription affects the validity of all of the associated configuration data.
              
</li>
<li>
                The CS MUST send a NOTIFY message on the configuration change subscription
                when there is a change to any of the different configuration data resources for
                which the subscription URI was returned.
              
</li>
</ul><p>
        
</p>
<a name="change.subscription.failure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.1.1"></a><h3>2.5.1.1.&nbsp;
Change Subscription Failure</h3>

<p>
            If a configuration change SUBSCRIBE request (either the initial request or any
            attempt to refresh the subscription) is permanently rejected by the
            Configuration Service (the CS returns a failure response that is not an
            authentication challenge or redirection and does not specify a Retry-After
            header), the UA MUST consider the associated configuration data to be not
            valid and attempt to revalidate it as specified in <a class='info' href='#revalidate'>Section&nbsp;2.6.1<span> (</span><span class='info'>Re-validating Configuration Data</span><span>)</span></a>, "<a class='info' href='#revalidate'>Re-validating Configuration Data<span> (</span><span class='info'>Re-validating Configuration Data</span><span>)</span></a>".  Since
            the CS is not allowed to reject a properly authenticated request, this
            indicates a problem either with the configuration data or the CS.
          
</p>
<p>
            If a configuration change SUBSCRIBE request (either the initial
            request or any attempt to refresh the subscription) fails other
            than by being permanently rejected, the UA MUST consider the
            associated configuration data to be of unknown validity, and
            MUST retry the SUBSCRIBE request as specified in <a class='info' href='#backoff.retry'>Section&nbsp;2.7<span> (</span><span class='info'>Retry Backoff Procedure</span><span>)</span></a>, "<a class='info' href='#backoff.retry'>Retry Backoff Procedure<span> (</span><span class='info'>Retry Backoff Procedure</span><span>)</span></a>"; the maximum time between retries MUST NOT be
            more than 30 minutes, and the retries MUST continue as long as
            the configuration is used.  The UA MAY at any time return to
            any earlier step in the process of obtaining configuration
            data.
          
</p>
<a name="change.subscription.term"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.1.2"></a><h3>2.5.1.2.&nbsp;
Change Subscription Termination</h3>

<p>
            If the CS explicitly terminates the configuration change (http-monitor)
            subscription by sending a NOTIFY message with a Subscription-State header value of
            'terminated', the UA MUST consider the configuration data to be of unknown
            validity.  If the rules for interpreting and acting on the 'reason' code parameter
            as specified in section 3.2.4 of <a class='info' href='#RFC3265'>RFC 3265<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3265] allow, the UA MUST
            attempt to re-establish the subscription.  If those rules do not allow the UA to
            re-subscribe, then the UA MUST consider the data to be not valid and attempt to
            revalidate it as specified in <a class='info' href='#revalidate'>Section&nbsp;2.6.1<span> (</span><span class='info'>Re-validating Configuration Data</span><span>)</span></a>, "<a class='info' href='#revalidate'>Re-validating Configuration Data<span> (</span><span class='info'>Re-validating Configuration Data</span><span>)</span></a>". The UA MAY at any time
            return to any earlier step in the process of obtaining configuration data. 
          
</p>
<a name="change.notification"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.1.3"></a><h3>2.5.1.3.&nbsp;
Configuration Change Notices</h3>

<p>
            To inform the UA of a configuration data change, the CS MUST send a NOTIFY message to the UA
            in the configuration change subscription established by the UA as detailed in <a class='info' href='#change.subscription'>Section&nbsp;2.5.1<span> (</span><span class='info'>Configuration Change Subscriptions</span><span>)</span></a>, "<a class='info' href='#change.subscription'>Configuration Change Subscriptions<span> (</span><span class='info'>Configuration Change Subscriptions</span><span>)</span></a>".
          
</p>
<p>
            The CS MUST NOT send unsolicited (out-of-dialog) NOTIFY messages.
          
</p>
<p>
            As specified in <a class='info' href='#draft-roach-sip-http-subscribe'>[draft&#8209;roach&#8209;sip&#8209;http&#8209;subscribe]<span> (</span><span class='info'>Roach, A., &ldquo;A SIP Event Package for Subscribing to Changes to an HTTP Resource,&rdquo; February&nbsp;2010.</span><span>)</span></a>, the body of a
            NOTIFY message in the http-monitor event package is the HTTP headers that would have
            been returned in response to an HTTP HEAD request (a HEAD request returns the headers
            that would have been returned for a GET request to the same URI, but with no body).
          
</p>
<p>
            When a NOTIFY message is received by the UA in the configuration change subscription,
            the UA MUST compare the cache control data it retained when the configuration data was
            received with the HTTP header values in the NOTIFY message body.  If any of the cache
            control data in the HTTP header values differs from those in the original
            configuration data response, the UA MUST consider the stored configuration data to be
            no longer valid.  As soon as reasonably possible after the UA discovers that
            configuration data is no longer valid, the UA MUST attempt a GET
            request to the HTTPS configuration request URL which provided the configuration data
            to obtain the changed configuration data.
          
</p>
<p>
            If this HTTPS request to the URL that previously provided the
            configuration data fails, the UA MUST attempt to obtain a new URL
            as specified in <a class='info' href='#configservice.url'>Section&nbsp;2.3<span> (</span><span class='info'>Constructing the Configuration Request URL</span><span>)</span></a>, "<a class='info' href='#configservice.url'>Constructing the Configuration Request URL<span> (</span><span class='info'>Constructing the Configuration Request URL</span><span>)</span></a>".
          
</p>
<a name="change.poll"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.2"></a><h3>2.5.2.&nbsp;
Configuration Change Polling</h3>

<p>
          If the CS chooses to use the HTTP polling mechanism, it MUST NOT include a Link
          header with the relation 'monitor' in the HTTP configuration data response, and MUST
          include a Cache-Control header that specifies the max-age directive.  The max-age
          cache control directive in HTTP specifies the maximum number of seconds for which the
          returned data may be cached; this specification defines this time as being the
          maximum time the configuration data is considered valid.
        
</p>
<p>
          A short time before the validity time has passed, the UA SHOULD poll to revalidate
          the configuration data as described in <a class='info' href='#revalidate'>Section&nbsp;2.6.1<span> (</span><span class='info'>Re-validating Configuration Data</span><span>)</span></a> <a class='info' href='#revalidate'>Re-validating Configuration Data<span> (</span><span class='info'>Re-validating Configuration Data</span><span>)</span></a>.
        
</p>
<a name="stored.configuration"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6"></a><h3>2.6.&nbsp;
Validity of Stored Configuration Data</h3>

<p>
        Configuration data stored by a UA is considered valid:
        </p>
<ul class="text">
<li>
            If the CS chose to use the subscription mechanism to deliver change notices, and
            the UA has a subscription to the CS as described in <a class='info' href='#change.subscription'>Section&nbsp;2.5.1<span> (</span><span class='info'>Configuration Change Subscriptions</span><span>)</span></a>, "<a class='info' href='#change.subscription'>Configuration Change Subscriptions<span> (</span><span class='info'>Configuration Change Subscriptions</span><span>)</span></a>" on which no NOTIFY message from the CS indicating that the
            configuration data has changed has been received.
          
</li>
<li>
            If the CS chose to use the HTTP polling method, and the number of seconds since the
            configuration data response was received is less than the time specified by the
            Cache-Control max-age directive in that response.
          
</li>
</ul><p>
      
</p>
<p>
        When a UA initializes itself at any time other than immediately after receiving new
        configuration data, it MUST consider any stored configuration data to be of
        unknown validity.  
      
</p>
<p>        
        The UA MAY use configuration data that is of unknown validity, or configuration data
        that is known to be no longer valid, while attempting to revalidate that data or
        obtain new data.  There is no assurance that such configuration data is still
        useful, but the UA MAY choose to retain the data and to continue to use it.
      
</p>
<a name="revalidate"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6.1"></a><h3>2.6.1.&nbsp;
Re-validating Configuration Data</h3>

<p>        
          To revalidate stored configuration data of unknown validity, the UA MUST repeat the
          HTTPS GET request it used to obtain the stored configuration data, with the
          appropriate HTTP headers to make the request a conditional request using the cache
          control data returned in the response that provided the configuration data.  This allows the CS
          to respond either with a new configuration data response, or a 304 (Not Modified)
          response to indicate that the configuration data has not changed.
        
</p>
<p>
          If the CS responds with a 304 response, and the original response included a Link
          header with the 'monitor' relation, the SIP UA MUST assume that the value of that
          Link header is also still correct (in effect, the HTTP cache control values and the
          subscription URL are a part of the configuration data), and so the UA MUST attempt to
          create and maintain a subscription to that URL as when the configuration data was
          first obtained (<a class='info' href='#change.subscription'>Section&nbsp;2.5.1<span> (</span><span class='info'>Configuration Change Subscriptions</span><span>)</span></a>, "<a class='info' href='#change.subscription'>Configuration Change Subscriptions<span> (</span><span class='info'>Configuration Change Subscriptions</span><span>)</span></a>").  
        
</p>
<p>
          If the CS chooses to use the HTTP polling method, then any 304 response MUST include
          a Cache-Control header containing a max-age directive, and the UA MUST use this new
          value as the maximum validity time for the associated configuration data.
        
</p>
<p>
          If the HTTP request to revalidate the configuration fails, the UA MUST follow the
          procedures defined for a failure of the initial HTTP configuration data request as
          specified in <a class='info' href='#request.http.fail'>Section&nbsp;2.4.2<span> (</span><span class='info'>Configuration Data Request Failure</span><span>)</span></a>, "<a class='info' href='#request.http.fail'>Configuration Data Request Failure<span> (</span><span class='info'>Configuration Data Request Failure</span><span>)</span></a>".
        
</p>
<a name="backoff.retry"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7"></a><h3>2.7.&nbsp;
Retry Backoff Procedure</h3>

<p>
        In case of certain possible failures as described above, the appropriate response is to
        retry the failed operation.  In all of these retry cases, the following rules apply:
        </p>
<ul class="text">
<li>
              The UA SHOULD retry at least 5 times before abandoning the failed step (except as
              allowed for in specific error handling rules above).
            
</li>
<li>
              Following the first instance of a given failure, the UA MUST select an initial
              backoff timer value randomly between 2 and 8 inclusive and wait this number of
              seconds before retrying the failed request.
            
</li>
<li>
              Following any subsequent instance of a given failure, the UA MUST increase the
              backoff timer value by 2 raised to the power of the number of preceding failures
              (2^N where N is the number of previous failures), and
              wait this increased number of seconds or the maximum interval specified by
              specific error handling procedures, whichever is less, before retrying the failed
              request.
            
</li>
</ul><p>
        For example, after an initial failure, the UA chooses an initial backoff timer value of
        4 seconds, followed by retries at the following times: 6 seconds (4 +
        2^1), 10 seconds (6 + 2^2), 18
        seconds (10 + 2^3), 32 (18 + 2^4)
        seconds, and 64 (32 + 2^5) seconds.
      
</p>
<a name="configuration.data"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Configuration Data</h3>

<p>
      This document does not specify the form or content of configuration data.  As such,
      the contents of this section are non-normative.
    
</p>
<a name="configuration.data.items"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Configuration Data Items</h3>

<p>
        The configuration data for a SIP UA should, at minimum, include items with the
        following semantics.
      
</p>
<a name="configuration.data.items.aor"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Address-of-Record</h3>

<p>
          The Address-of-Record (AOR) is a SIP or SIPS URI which identifies the
          user of the device as specified in <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261].
        
</p>
<a name="configuration.data.items.realm"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Realm</h3>

<p>
          The realm is used to populate the realm parameter in the SIP
          Proxy-Authorization header as specified in <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261] when the UA receives
          an authentication challenge.
        
</p>
<a name="configuration.data.items.username"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.3"></a><h3>3.1.3.&nbsp;
Username</h3>

<p>
          The username is used to populate the username parameter in the SIP
          Proxy-Authorization header as specified in <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261] when the UA receives
          an authentication challenge.
        
</p>
<a name="configuration.data.items.digest"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.4"></a><h3>3.1.4.&nbsp;
Digest</h3>

<p>
          The digest is a string containing the digest of the username, realm and
          password as specified in <a class='info' href='#RFC2617'>RFC 2617<span> (</span><span class='info'>Franks, J., Hallam-Baker, P., Hostetler, J., Lawrence, S., Leach, P., Luotonen, A., and L. Stewart, &ldquo;HTTP Authentication: Basic and Digest Access Authentication,&rdquo; June&nbsp;1999.</span><span>)</span></a> [RFC2617] and is used to generate a response to
          an authentication challenge as specified in <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261].
        
</p>
<a name="configuration.data.items.outboundproxy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.5"></a><h3>3.1.5.&nbsp;
OutboundProxy</h3>

<p>
          The OutboundProxy if defined contains the default outbound proxy through
          which SIP requests, not explicitly routed, are routed as specified in
          <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261].
        
</p>
<a name="reset.to.default"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Reset User Agent to Default Configuration</h3>

<p>
        The earlier sections of this document define methods by which the UA can be
        automatically provisioned.  Some User Agents allow certain user specific settings
        (e.g. Contact Directory, specialized ring-tones etc.) to be set by a user, and possibly
        stored locally in the User Agent.  Since it may be necessary to later re-assign a UA,
        designers of configuration data formats may want to provide for explicit controls for
        any such locally configured settings, including the ability to explicitly delete them
        to return the UA to a completely unconfigured state.
      
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
IANA Considerations</h3>

<a name="iana.dhcpv4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
DHCP SIP User Agent Configuration Domains Option</h3>

<p>
        This specification defines DHCP option code XX, the "SIP User Agent Configuration
        Service Domains" for inclusion in the IANA registry
        "BOOTP Vendor Extensions and DHCP Options" defined by <a class='info' href='#RFC2939'>RFC 2939<span> (</span><span class='info'>Droms, R., &ldquo;Procedures and IANA Guidelines for Definition of New DHCP Options and Message Types,&rdquo; September&nbsp;2000.</span><span>)</span></a> [RFC2939].
        <a class='info' href='#comment.anchor2'>[anchor2]<span> (</span><span class='info'>Editor's Note (to be removed prior to publication): the IANA is requested to assign a value for &quot;XX&quot; and to record the assignment in the specified registry. When the assignment has been made, the RFC Editor is asked to replace &quot;XX&quot; with the assigned value throughout this document, and to remove this note.</span><span>)</span></a><a name='anchor2'></a>
      
</p>
<p>
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      XX       |     Len       |         Searchstring...       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                     Searchstring...                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div><p>

      
</p>
<p>
        In the above diagram, Searchstring is a string specifying the
        searchlist.  If the length of the searchlist exceeds the maximum
        permissible within a single option (255 octets), then multiple
        options MAY be used, as described in <a class='info' href='#RFC3396'>RFC
        3396<span> (</span><span class='info'>Lemon, T. and S. Cheshire, &ldquo;Encoding Long Options in the Dynamic Host Configuration Protocol (DHCPv4),&rdquo; November&nbsp;2002.</span><span>)</span></a> [RFC3396] "Encoding Long DHCP Options in the Dynamic Host
        Configuration Protocol (DHCPv4)".
      
</p>
<p>
        To enable the searchlist to be encoded compactly, searchstrings in
        the searchlist MUST be concatenated and encoded using the technique
        described in section 4.1.4 of <a class='info' href='#RFC1035'>RFC
        1035<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a> [RFC1035] "Domain Names - Implementation And
        Specification".  In this scheme, an entire domain name or a
        list of labels at the end of a domain name is replaced with a pointer
        to a prior occurrence of the same name.  Despite its complexity, this
        technique is valuable since the space available for encoding DHCP
        options is limited, and it is likely that a domain searchstring will
        contain repeated instances of the same domain name.  Thus the DNS
        name compression is both useful and likely to be effective.
      
</p>
<p>
        For use in this specification, the pointer refers to the offset
        within the data portion of the DHCP option (not including the
        preceding DHCP option code byte or DHCP option length byte).
      
</p>
<p>
        If multiple SIP User Agent Configuration
        Service Domains Options are present, then the data portions
        of all the SIP User Agent Configuration
        Service Domains Options are concatenated together as
        specified in RFC 3396 and the pointer indicates
        an offset within the complete aggregate block of data.
      
</p>
<p>
        For examples of encoding this option, see the section 3 of <a class='info' href='#RFC3397'>RFC 3397<span> (</span><span class='info'>Aboba, B. and S. Cheshire, &ldquo;Dynamic Host Configuration Protocol (DHCP) Domain Search Option,&rdquo; November&nbsp;2002.</span><span>)</span></a> [RFC3397] "Dynamic Host Configuration
        Protocol (DHCP) Domain Search Option", which uses the same encoding
        for option 119..
      
</p>
<a name="iana.dhcpv6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
DHCPv6 SIP User Agent Configuration Domains Option</h3>

<p>
        This specification defines DHCPv6 option code YY, the "SIP User Agent Configuration
        Service Domains" for inclusion in the IANA registry
        "Dynamic Host Configuration Protocol for IPv6 (DHCPv6), DHCP Option Codes" defined
        by RFC 3315.
        <a class='info' href='#comment.anchor3'>[anchor3]<span> (</span><span class='info'>Editor's Note (to be removed prior to publication): the IANA is requested to assign a value for &quot;YY&quot; and to record the assignment in the specified registry. When the assignment has been made, the RFC Editor is asked to replace &quot;YY&quot; with the assigned value throughout this document, and to remove this note.</span><span>)</span></a><a name='anchor3'></a>
      
</p>
<p>
        The format of the SIP User Agent Configuration
        Service Domains option is:
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     OPTION_SIP_UA_CS_LIST     |         option-len            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          searchlist                           |
   |                              ...                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div><p>

      
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>option-code</dt>
<dd>OPTION_SIP_UA_CS_LIST (YY)
</dd>
<dt>option-len</dt>
<dd>Length of the 'searchlist' field in octets
</dd>
<dt>searchlist</dt>
<dd>The specification of the list of domain names in the SIP User Agent Configuration Service Domains
</dd>
</dl></blockquote><p>
        The list of domain names in the 'searchlist' MUST be encoded as
        specified in section "Representation and use of domain names" of
        RFC 3315.
      
</p>
<a name="iana.unaptr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
U-NAPTR Registration</h3>

<p>
        This document registers the following U-NAPTR application service tag in the
        registry defined by <a class='info' href='#RFC3958'>RFC 3958<span> (</span><span class='info'>Daigle, L. and A. Newton, &ldquo;Domain-Based Application Service Location Using SRV RRs and the Dynamic Delegation Discovery Service (DDDS),&rdquo; January&nbsp;2005.</span><span>)</span></a> [RFC3958] "Domain-Based Application Service
        Location Using SRV RRs and the Dynamic Delegation Discovery Service (DDDS)": 
      
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr>
<td align="left">Application Service Tag</td>
<td align="left">SFUA.CFG</td>
</tr>
</table>
<br clear="all" />

<p>
        This tag is used to obtain the base URL of the Configuration Service from the DNS
        name of a SIP domain as specified in <a class='info' href='#configservice.url.base'>Section&nbsp;2.3.1<span> (</span><span class='info'>Obtaining a Configuration Service Base URL</span><span>)</span></a>, "<a class='info' href='#configservice.url.base'>Obtaining a Configuration Service Base URL<span> (</span><span class='info'>Obtaining a Configuration Service Base URL</span><span>)</span></a>".
      
</p>
<a name="iana.reqparams"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
SIP Forum User Agent Configuration Parameter Registry</h3>

<p>
        IANA is to establish a registry for "SIP Forum User Agent
        Configuration Parameters".  This registry records the HTTPS request
        parameters for the initial configuration data request sent by a
        User Agent to a Configuration Service as described in <a class='info' href='#configservice.url.addparams'>Section&nbsp;2.3.2<span> (</span><span class='info'>Adding Configuration Request Parameters</span><span>)</span></a>, "<a class='info' href='#configservice.url.addparams'>Adding Configuration Request Parameters<span> (</span><span class='info'>Adding Configuration Request Parameters</span><span>)</span></a>".
      
</p>
<p>
        Each entry in the registry must describe:
        </p>
<blockquote class="text"><dl>
<dt>Parameter Name</dt>
<dd>
            The name of the parameter, which MUST match the ABNF production
            for 'token' from <a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261].
          
</dd>
<dt>Value Syntax</dt>
<dd>
            The syntax of the value, if any (a parameter may just be a name
            with no asssociated value).
          
</dd>
<dt>Usage</dt>
<dd>
            The purpose served by the parameter, including any default
            method the UA should use to construct it if applicable.
          
</dd>
</dl></blockquote><p>
      
</p>
<p>
        The initial values for the registry are the parameters described in
        <a class='info' href='#configservice.url.params'>Section&nbsp;2.3.2.1<span> (</span><span class='info'>Configuration Request Parameters</span><span>)</span></a>, "<a class='info' href='#configservice.url.params'>Configuration Request Parameters<span> (</span><span class='info'>Configuration Request Parameters</span><span>)</span></a>".  The policy
        for future additions to this registry depends on the parameter name
        value: 
        </p>
<blockquote class="text">
<p>
            If the name of the parameter begins with the characters 'sfua-'
            in any case, then the policy for addition to this registry is
            "RFC Required" as described by <a class='info' href='#RFC5226'>RFC 5226<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a> [RFC5226].
          
</p>
<p>
            Any other parameter entry may be added to this
            registry using a "First Come First Served" policy as described
            by <a class='info' href='#RFC5226'>RFC 5226<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a> [RFC5226]. 
          
</p>
</blockquote><p>
      
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>
      Initial discovery of the Configuration Service Domain Name relies on a number of
      operations that are normally unsecured: a DHCP response could be provided by an
      attacker to replace the values of any of the IP Network Parameters (<a class='info' href='#network.discovery.auto'>Section&nbsp;2.1.2<span> (</span><span class='info'>Network Layer Provisioning</span><span>)</span></a>, "<a class='info' href='#network.discovery.auto'>Network Layer Provisioning<span> (</span><span class='info'>Network Layer Provisioning</span><span>)</span></a>") including the Local Network Domain which is the default choice
      for the Configuration Service Domain Name.  Confirmation by the human
      user of the Configuration Service Domain Name, especially when it differs from a
      previously used value, could be used to mitigate this (perhaps unintentional)
      potential reconfiguration.  Note that previously loaded configuration MAY constrain
      which parts of the discovery and location procedures are used: for example, the
      Configuration Service Domain Name might be fixed so that it cannot be modified by
      discovery. 
    
</p>
<p>
      The connection to the Configuration Service is made over TLS.  As the TLS server,
      the CS always provides a server certificate during the TLS handshake; if possible,
      the UA should validate that certificate and confirm that it contains as a subject
      the Configuration Service Domain Name or at least the host name from the
      Configuration Service Base URL (see <a class='info' href='#RFC2818'>RFC 2818<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> [RFC2818]).  While it may not be possible to have the
      information needed to perform a full validation of the CS server certificate prior
      to the first configuration (for example, the UA may not have a current CA
      certificate for the CA that signs the CS server certificate), implementors are
      advised to provide that information in configuration data so that it
      can be used for subsequent reconfigurations; this narrows the window of
      vulnerability to the first configuration attempt.   
    
</p>
<p>
      To secure initial configuration attempts, the CS can deny requests from unknown
      devices and/or could implement other measures such as restricting the time window
      during which it will accept an initial configuration request from a given device. A
      more secure approach would be to provide the user with a password, perhaps a
      one-time password valid only for the initial access.  In high security environments,
      the Configuration Service could require that the User Agent provide a client
      certificate for authentication in the TLS connection for configuration data
      requests.  This would necessitate some prior manual configuration of the User Agent,
      and possibly the Configuration Service, and that configuration should also include
      sufficient information for the UA to fully validate the CS certificate.
    
</p>
<p>
      The values of some or all of the request parameters sent by the UA on the initial
      request for configuration data (see <a class='info' href='#configservice.url.addparams'>Section&nbsp;2.3.2<span> (</span><span class='info'>Adding Configuration Request Parameters</span><span>)</span></a>,
      "<a class='info' href='#configservice.url.addparams'>Adding Configuration Request Parameters<span> (</span><span class='info'>Adding Configuration Request Parameters</span><span>)</span></a>") may be sensitive
      information.  Since the configuration data request is made over a TLS connection,
      the confidentiality of that information is protected on the network.
      Configuration Service implementations should take all necessary measures to
      ensure that the request parameter data is appropriately protected within the CS
      itself. 
    
</p>
<p>
      The Configuration Change Request Subscription (<a class='info' href='#change.subscription'>Section&nbsp;2.5.1<span> (</span><span class='info'>Configuration Change Subscriptions</span><span>)</span></a>, "<a class='info' href='#change.subscription'>Configuration Change Subscriptions<span> (</span><span class='info'>Configuration Change Subscriptions</span><span>)</span></a>") is established only after the configuration data has been loaded
      by the User Agent, so all security mechanisms available in SIP (including request
      digest authentication and the use of TLS) can be configured and required by either
      the CS or the UA.  Note that a configuration change notice does not actually provide
      any new configuration data, nor can it change where the UA sends a request for the
      new configuration data.  This means that an attacker cannot reconfigure a UA by
      subverting only the change notice subscription; the most the attacker can do is
      trigger checks for new data.  In order to actually modify the configuration data
      itself, the attacker must subvert the CS or the steps leading to the CS discovery
      (subject to the checks described above).
    
</p>
<p>
      Implementations of TLS typically support multiple versions of the
      Transport Layer Security protocol as well as the older Secure Sockets
      Layer (SSL) protocol.  Because of known security vulnerabilities, SIP
      UAs, SIP Service Provider, and the Configuration Service Host MUST
      NOT request, offer, or use SSL 2.0. See Appendix E.2 of <a class='info' href='#RFC5246'>RFC 5246<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5246] for further details.
    
</p>
<a name="members"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Acknowledgements</h3>

<p>
      Contributing Members of the SIP Forum User Agent Configuration Working Group

    </p>
<blockquote class="text">
<p>
        Francois Audet, Nortel Networks Inc.
      
</p>
<p>
        Eric Burger, SIP Forum
      
</p>
<p>
        Sumanth Channabasappa, Cable Television Laboratories, Inc. (CableLabs)
      
</p>
<p>
        Martin Dolly, AT&amp;T Labs
      
</p>
<p>
        John Elwell, Siemens Enterprise Communications
      
</p>
<p>
        Marek Dutkiewicz, Polycom Inc.
      
</p>
<p>
        Andy Hutton, Siemens Enterprise Communications
      
</p>
<p>
        Lincoln Lavoie, University of New Hampshire
      
</p>
<p>
        Scott Lawrence, Avaya Inc.
      
</p>
<p>
        Paul Mossman, Avaya Inc.
      
</p>
<p>
        Michael Procter, VoIP.co.uk
      
</p>
<p>
        Marc Robins, SIP Forum
      
</p>
<p>
        Henning Schulzrinne, Columbia University
      
</p>
<p>
        Rifaat Shekh-Yusef, Avaya Inc.
      
</p>
<p>
        Robert Sparks, Tekelec
      
</p>
<p>
        Simo Veikkolainen, Nokia
      
</p>
</blockquote><p>
    
</p>
<p>
      The Editor would like to also acknowledge valuable contributions by Leslie Daigle and
      Margaret Wasserman.
    
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1034">[RFC1034]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1034">Domain names - concepts and facilities</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1034, November&nbsp;1987 (<a href="ftp://ftp.isi.edu/in-notes/rfc1034.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1035">[RFC1035]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1035, November&nbsp;1987 (<a href="http://www.rfc-editor.org/rfc/rfc1035.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2131">[RFC2131]</a></td>
<td class="author-text"><a href="mailto:droms@bucknell.edu">Droms, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2131">Dynamic Host Configuration Protocol</a>,&rdquo; RFC&nbsp;2131, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2131.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2131.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2131.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2132">[RFC2132]</a></td>
<td class="author-text"><a href="mailto:sca@engr.sgi.com">Alexander, S.</a> and <a href="mailto:droms@bucknell.edu">R. Droms</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2132">DHCP Options and BOOTP Vendor Extensions</a>,&rdquo; RFC&nbsp;2132, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2132.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2132.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2132.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2616.txt">TXT</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc2616.ps">PS</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2617">[RFC2617]</a></td>
<td class="author-text"><a href="mailto:john@math.nwu.edu">Franks, J.</a>, <a href="mailto:pbaker@verisign.com">Hallam-Baker, P.</a>, <a href="mailto:jeff@AbiSource.com">Hostetler, J.</a>, <a href="mailto:lawrence@agranat.com">Lawrence, S.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, Luotonen, A., and <a href="mailto:stewart@OpenMarket.com">L. Stewart</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and Digest Access Authentication</a>,&rdquo; RFC&nbsp;2617, June&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2617.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2617.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2617.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2818">[RFC2818]</a></td>
<td class="author-text">Rescorla, E., &ldquo;<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>,&rdquo; RFC&nbsp;2818, May&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2818.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2939">[RFC2939]</a></td>
<td class="author-text">Droms, R., &ldquo;<a href="http://tools.ietf.org/html/rfc2939">Procedures and IANA Guidelines for Definition of New DHCP Options and Message Types</a>,&rdquo; BCP&nbsp;43, RFC&nbsp;2939, September&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2939.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3265">[RFC3265]</a></td>
<td class="author-text">Roach, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3265">Session Initiation Protocol (SIP)-Specific Event Notification</a>,&rdquo; RFC&nbsp;3265, June&nbsp;2002 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc3265.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3315">[RFC3315]</a></td>
<td class="author-text">Droms, R., Bound, J., Volz, B., Lemon, T., Perkins, C., and M. Carney, &ldquo;<a href="http://tools.ietf.org/html/rfc3315">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>,&rdquo; RFC&nbsp;3315, July&nbsp;2003 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc3315.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3319">[RFC3319]</a></td>
<td class="author-text">Schulzrinne, H. and B. Volz, &ldquo;<a href="http://tools.ietf.org/html/rfc3319">Dynamic Host Configuration Protocol (DHCPv6) Options for Session Initiation Protocol (SIP) Servers</a>,&rdquo; RFC&nbsp;3319, July&nbsp;2003 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc3319.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3396">[RFC3396]</a></td>
<td class="author-text">Lemon, T. and S. Cheshire, &ldquo;<a href="http://tools.ietf.org/html/rfc3396">Encoding Long Options in the Dynamic Host Configuration Protocol (DHCPv4)</a>,&rdquo; RFC&nbsp;3396, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3396.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3397">[RFC3397]</a></td>
<td class="author-text">Aboba, B. and S. Cheshire, &ldquo;<a href="http://tools.ietf.org/html/rfc3397">Dynamic Host Configuration Protocol (DHCP) Domain Search Option</a>,&rdquo; RFC&nbsp;3397, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3397.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3958">[RFC3958]</a></td>
<td class="author-text">Daigle, L. and A. Newton, &ldquo;<a href="http://tools.ietf.org/html/rfc3958">Domain-Based Application Service Location Using SRV RRs and the Dynamic Delegation Discovery Service (DDDS)</a>,&rdquo; RFC&nbsp;3958, January&nbsp;2005 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc3958.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3986">[RFC3986]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>,&rdquo; STD&nbsp;66, RFC&nbsp;3986, January&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc3986.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3986.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3986.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4366">[RFC4366]</a></td>
<td class="author-text">Blake-Wilson, S., Nystrom, M., Hopwood, D., Mikkelsen, J., and T. Wright, &ldquo;<a href="http://tools.ietf.org/html/rfc4366">Transport Layer Security (TLS) Extensions</a>,&rdquo; RFC&nbsp;4366, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4366.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4848">[RFC4848]</a></td>
<td class="author-text">Daigle, L., &ldquo;<a href="http://tools.ietf.org/html/rfc4848">Domain-Based Application Service Location Using URIs and the
            Dynamic Delegation Discovery Service (DDDS)</a>,&rdquo; RFC&nbsp;4848, April&nbsp;2007 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc4848.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5226">[RFC5226]</a></td>
<td class="author-text">Narten, T. and H. Alvestrand, &ldquo;<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;5226, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5226.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5626">[RFC5626]</a></td>
<td class="author-text">Jennings, C., Mahy, R., and F. Audet, &ldquo;<a href="http://tools.ietf.org/html/rfc5626">Managing Client-Initiated Connections in the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;5626, October&nbsp;2009 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc5626.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[RFC5246]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5246.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="draft-roach-sip-http-subscribe">[draft-roach-sip-http-subscribe]</a></td>
<td class="author-text"><a href="mailto:adam@nostrum.com">Roach, A.</a>, &ldquo;<a href="http://tools.ietf.org/html/draft-roach-sip-http-subscribe">A SIP Event Package for Subscribing to Changes to an HTTP Resource</a>,&rdquo; February&nbsp;2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="ANSI.TIA-1057-2006">[ANSI.TIA-1057-2006]</a></td>
<td class="author-text">American National Standards Institute, &ldquo;Telecommunications IP Telephony Infrastructure Link Layer Discovery Protocol for Media Endpoint Devices,&rdquo; April&nbsp;1993.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Scott Lawrence (editor)</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:scott-ietf@skrb.org">scott-ietf@skrb.org</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">John Elwell</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Siemens Enterprise Communications</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+44 1908 855608</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:john.elwell@siemens-enterprise.com">john.elwell@siemens-enterprise.com</a></td></tr>
</table>
</body></html>
