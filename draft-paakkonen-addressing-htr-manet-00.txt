
                                                         Pekka P„„kk÷nen
Document: draft-paakkonen-addressing-htr-manet-00.txt      Mika Rantonen
Expires: June 2004                                     Juhani Latvakoski
                                                         VTT Electronics               
                                                           December 2003

             IPv6 addressing in a heterogeneous MANET-network 
              draft-paakkonen-addressing-htr-manet-00.txt


Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC 2026.

   Internet-Drafts are working documents of the Internet Engineering            
   Task Force (IETF), its areas, and its working groups. Note that  
   other groups may also distribute working documents as Internet-
   Drafts.    
 
   Internet-Drafts are draft documents valid for a maximum of six  
   months and may be updated, replaced, or obsoleted by other documents 
   at any time. It is inappropriate to use Internet- Drafts as 
   reference material or to cite them other than as "work in progress." 

   The list of current Internet-Drafts can be accessed at       
   http://www.ietf.org/1id-abstracts.html 

   The list of Internet-Draft Shadow Directories can be accessed at           
   http://www.ietf.org/shadow.html 

Copyright Notice

  Copyright (C) The Internet Society (2003). All Rights Reserved.

Abstract

This document presents IPv6 addressing related to end-to-end 
connectivity in a Mobile Ad hoc Network with heterogeneous nodes. 
Internet connectivity for the mobile ad hoc network has to be provided
by an Access Router. The nodes in such a network could only have IPv6 
functionality, or contain support for Mobile IPv6 (MIPv6) or facilitate
ad hoc routing by using a MANET-based routing protocol. End-to-end 
connectivity means that the nodes must be able to communicate with each 
other locally and over the Internet. The draft focuses on the Ad hoc 
On-demand Distance Vector (AODV) as a MANET-based routing protocol.    

Table of contents

Abstract                                                               i

1. Introduction                                                        i

2. Terminology                                                         2

3. Terms                                                               2


P„„kk÷nen et al.      Expires July 2004                         [Page i]

INTERNET-DRAFT        End-to-end connectivity              December 2003

4. IPv6/MIPv6 addressing                                               2
    4.1. Functionality it the AR.......................................4

5. MANET-addressing                                                    4
    5.1. Duplicate Address Detection (DAD).............................4
    5.2. Global connectivity...........................................5
    5.3. Global vs. site-local addresses...............................5
        5.3.1. AODV-MIPv6 co-operation.................................5

6. IPv6-MANET addressing                                               6
    6.1. AODV communication algorithm..................................6
    6.2. Address autoconfiguration and communication issues............6

7. NEMO addressing                                                     8
 
8. Security issues                                                     8

9. Open issues                                                         8

References                                                             9

Author's addresses                                                     9

APPENDIX A IPv6/MIPv6 addressing example                              10
    A.1. Proxy Neighbor Discovery (PND) in the AR.....................10
    A.2. Redirect ICMP message........................................11

APPENDIX B Global connectivity via next hop routing                   11

Full Copyright Statement                                              13

1. Introduction

This document describes IPv6 addressing, which is related to the       
end-to-end connectivity in a heterogeneous Mobile Ad hoc NETwork 
(MANET). The heterogeneity means that the nodes in the MANET-network may 
contain different capabilities, which has been illustrated in figure 1. 
First of all nodes with only IPv6 functionality might be present. Also 
Mobile IPv6 (MIPv6) [1] enabled nodes might be present, either MIPv6 
Corresponding Nodes (MIPv6_CN) or MIPv6 Mobile Nodes (MIPv6_MN). 
MIPv6_CNs have MIPv6 Route Optimization (RO) capability, but don't 
support mobility [1]. MIPv6_MNs have MIPv6 mobility extensions [1]. 
These nodes are referred in this document to as IPv6/MIPv6-nodes. MANET 
routing protocol supported nodes might also be present, which in 
addition have similarly different capabilities as the IPv6/MIPv6-nodes 
(IPv6/ MIPv6_CN/ MIPv6_MN). In this document Ad hoc On-demand Distance 
Vector (AODV) routing protocol functionality has been focused on. The 
nodes of the MANET-network have to be able to communicate with each 
other, and also with a Corresponding Node (CN) of the Internet 
(end-to-end connectivity).




P„„kk÷nen et al.      Expires July 2004                         [Page 1]

INTERNET-DRAFT        End-to-end connectivity              December 2003

                                   CN       HA_MN
                                    |         |
                                    |         |         
                           _________|_________|________                                                                                     
                           \                          /
                             \          Internet     /---------HA_MR 
                              \_____________________/       
                    ______________________|__________________________
                    (                     |                         )
                    (                   AR/MR --------MANETnode     )
                    (                     /  \           |     |    )
                    (                   / |   \          |     |    )
                    (                 /   |    \         |     |    )
                    (               /     |     \        |   MANET  )
                    (             /       |      \       |   node   )
                    (           /         |       \      |   /      )
                    (        IPv6------MIPv6_CN---MIPv6_MN /        )
                    (        node                                   )
                    (                                               )                                          
                    (               Heterogeneous MANET-            )
                    (                 network                       )
                    (_______________________________________________)

Figure 1. Heterogeneity in a hybrid MANET-network.

If the heterogeneous MANET-network needs global Internet connectivity, 
it has to have one or more Access Routers (AR), which is/are connected
to the Internet. This AR is static if the MANET-network doesn't move
in relation to the Internet topology. Network Mobility might also be 
supported as defined in the NEMO working group [2]. In this case the 
ARs are considered as Mobile Routers (MR), which maintain Internet 
connectivity by using bi-directional tunneling with their corresponding
Home Agent (HA), when the mobile network is away from home. 

IPv6 addressing related to IPv6/MIPv6-nodes can be referred 
to as IPv6/MIPv6-addressing, and IPv6 addressing related to MANET-nodes
MANET-addressing. IPv6-MANET addressing comprises communication between
IPv6/MIPv6-nodes and MANET-nodes. The heterogeneous nodes of the 
mobile ad hoc network should also be able to communicate with a 
Corresponding Node (CN) of the Internet outside of the MANET-network, 
which can be referred to as global communication. The CN might also be
an IPv6-node, a MIPv6_CN or a MIPv6_MN. End-to-end connectivity in a 
heterogeneous MANET-network consists of the different local and global 
communication use cases between the heterogeneous nodes. This document
describes the IPv6 addressing related to end-to-end connectivity in 
such a heterogeneous multi-hop MANET-network.       
    
The structure of the document is as follows:

Chapter 3 describes terms used in the document. The next three chapters
deal with the IPv6 addressing related to the heterogeneous 
MANET-network. NEMO addressing is focused on in chapter 7. Chapter 
8 discusses security issues, and chapter 9 presents issues for further

P„„kk÷nen et al.      Expires July 2004                         [Page 2]

INTERNET-DRAFT        End-to-end connectivity              December 2003

development.   

2. Terminology

The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in RFC 2119 [3].

3. Terms

This document uses mobility related terms as defined in [15], and 
network mobility related terms as defined in [16]. In addition the 
following terms are used:

Access Router (AR) 

   AR provides IP connectivity for the nodes by default routing, and 
   acts as an Internet gateway. The AR could also be considered as a 
   Mobile Router (MR) if network mobility is supported by it.

Flat Routing 

   Flat routing considers the ad hoc network without subnet partitioning

Hierarchical Routing

   The ad hoc network is considered as logically separated subnets.

IPv6-node 

   Node with plain IPv6 functionality [1]. Could also be considered 
   as a Fixed Node (FN), because an IPv6-node doesn't support mobility.

Mobile IPv6 Corresponding Node (MIPv6_CN) 
 
   Mobile IPv6 node with Route Optimization capabilities as defined 
   in [1].

Mobile IPv6 Mobile Node (MIPv6_MN)  

   Mobile IPv6 node with mobility support as defined in [1]. 
 
4. IPv6/MIPv6 addressing 

The IPv6/MIPv6 nodes configure a link-local address which may be used 
only if the destination is on a local link. Global addresses are needed
if the nodes need to communicate over the local link or over the 
Internet. Either stateless [4] or stateful [5] address 
autoconfiguration could be used for global address generation. In this 
document stateless address autoconfiguration has been focused on. 

In case of stateless address autoconfiguration, the AR sends Router
Advertisements (RA), and includes an IPv6 prefix to the Prefix 

P„„kk÷nen et al.      Expires July 2004                         [Page 3]

INTERNET-DRAFT        End-to-end connectivity              December 2003

Information -option [6], which the IPv6/MIPv6-nodes attach to the 
interface-ID to create a global IPv6 address [7]. To enable default 
routing for the nodes, the Router Lifetime field of the Router 
Advertisement (RA) MUST be non-zero [6]. When the nodes receive a RA 
with a non-zero Router Lifetime field, an entry is added to the default
router list [6]. (Implementation note: Some platforms create a Routing
Table (RT) entry for the AR's link-local address (::/0 -> AR's 
link-local address) ). If the Router Lifetime would be zero, default 
routing would be disabled, and outside communication with a CN of the 
Internet would not be possible. 
    
The IPv6 prefix is advertised as ON-link by setting the L-flag in the
Prefix Information -option of the RA [6]. When a IPv6/MIPv6-node 
considers the IPv6 prefix to be ON-link, it sends the packets for the
destination to the interface. (Implementation note: On some platforms 
an RT entry is created for the IPv6 prefix towards the interface of the 
AR (IPv6 prefix -> ethx) ). The ON-link prefix causes the IPv6/MIPv6-
nodes to send packets to the interface for destinations, which have 
configured an IPv6 address from the IPv6 prefix (local destinations).
If the L-flag is not set, it "conveys no information concerning 
on-link determination and MUST NOT be interpreted to mean that 
addresses covered by the prefix are off-link" [6]. This causes the 
IPv6/MIPv6-nodes to use the default router for all destinations. For
clarity in this document the ON-link model is used, when the L-flag is
set, and the OFF-link model is used, when the L-flag is not set.   

Figure 2 describes an example of a situation in which the AR 
advertises an IPv6 Prefix, with a Router Lifetime of 5000 in the ON-link 
addressing model. It causes the IPv6/MIPv6-node to add entries for the 
default router and IPv6 prefix to the Routing Table (RT). In the example
the default router list has been implemented by using the RT. 

          AR
          |
          |
          |     Router Advertisement
          |  ||   Router Lifetime = 5000
          |  ||   Prefix Information Option
          | \  /     L-flag = 1
          |  \/      A-flag = 1
          |          Prefix = IPv6 Prefix
          |       Source Link-layer Address Option
          |          Link-layer address of AR
          |
     IPv6/MIPv6-node
        
       RT: ::/0 -> AR's link-local address   
           IPv6 Prefix -> ethx

Figure 2. Stateless address autoconfiguration.

When the AR advertises the IPv6 prefix with the ON-link model, it causes
the communicating nodes to send packets directly to each other (to the 

P„„kk÷nen et al.      Expires July 2004                         [Page 4]

INTERNET-DRAFT        End-to-end connectivity              December 2003

interface). The ON-link addressing model might be a problem with certain
access technologies. For example consider a case when IEEE 802.11b 
Wireless LAN (WLAN) is used in the ad-hoc mode, and the IPv6/MIPv6 nodes
communicate locally on the same link. If the global addresses are used, 
communication isn't possible if the nodes are positioned in such a way 
in which the nodes are not on each other's WLAN communication range. 
This is caused by the distance between the nodes (direct radio 
connectivity isn't possible), when the nodes send packets directly to 
each other (to the interface). The communication could however be 
enabled by advertising the IPv6 prefix as OFF-link or by executing Proxy 
Neighbor Discovery in the AR, if the AR is spatially positioned in such 
a way, that it is able to provide routing for the nodes (i.e. AR is in 
the radio communication range of both nodes). This would route the 
packets via the AR. In this particular case, routing via the AR is also 
the downside of the OFF-link model, when the peers are in the radio 
communication range of each other (unoptimal routing). Specific details 
on how the ON-link addressing model, Proxy Neighbor Discovery (PND) and 
Redirect ICMP messages relate to the ad hoc mode of WLAN are described 
in Appendix A.      

4.1. Functionality in the AR

The access technology used and the network topology of the Access 
Network SHOULD be taken into account when making the choice of the 
ON-link addressing model of the IPv6 prefix in the AR. As described in 
appendix A the OFF-link model could be used for WLAN environments which 
use the ad-hoc mode (if the PND function is not used in the AR in the 
ON-link model). But if the WLAN infrastructure mode with access points 
would be used the choice of the addressing model could be different. 
The PND function MAY be executed with the ON-link model with some 
access technologies as described in appendix A.  

The access technology SHOULD also be taken into account, when making  
the choice of enabling/disabling Redirect ICMP message sending in the 
AR. As described in appendix A the sending of Redirect-ICMP messages 
MAY be disabled in the AR, when WLAN is used in the ad-hoc mode. 

5. MANET-addressing

The MANET-nodes configure a MANET-address, which is used for 
communication. Either a site-local or global address could be 
configured (although the use of the site-local address has been 
deprecated by the IETF [8]). To create a unique MANET-address, 
Duplicate Address Detection (DAD) must be used.    

5.1. Duplicate Address Detection (DAD)

The main purpose of the DAD procedure is to guarantee the uniqueness of 
the IPv6 address to be used in the MANET. The uniqueness test messages 
(Address Request (AREQ), Address Reply (AREP)) have to disseminate over 
the MANET. The DAD described in [9] could be used, and the DAD could 
also be improved as described in [10]. The latter solution performs the 
DAD only on the interface-ID part of the MANET-address to be created, 

P„„kk÷nen et al.      Expires July 2004                         [Page 5]

INTERNET-DRAFT        End-to-end connectivity              December 2003

and also reduces the unnecessary forwarding of the AREQ-message.  

5.2. Global connectivity

To enable global connectivity for a MANET-node, the MANET-node must have 
a globally unique address, the packets from the Internet must be 
routable to the MANET-node, and the MANET-node must be able to send 
packets to the Internet. The MANET-nodes have to configure a global 
MANET-address by acquiring an IPv6 prefix from the AR, which is attached 
to the interface-ID of the node. This functionality could be achieved as 
described in [11]. In this case the nodes configure three routing table 
entries to enable global routing (default-route/0 -> AR; AR -> next-hop 
towards AR; next-hop  -> ethx). Appendix B describes how global 
connectivity could be achieved via next-hop routing by using a reactive 
MANET-protocol (AODV). In this case only two routing table entries are 
needed (default-route/0 -> next-hop; next-hop -> ethx).  

5.3. Global vs. site-local addresses

When the AODV-nodes communicate with each other, route discovery for 
on-demand routing protocols are used as described in [12]. This means 
that the route is discovered on-demand based on the current ad hoc 
network topology.      

The MANET-node may use either a site-local address or a global address 
configured via IPv6 prefix discovery as a MANET-address, which means 
that both addresses cannot be used at the same time. If the site-local 
address is used as a MANET-address, Internet communication is not 
possible, because packets with a site-local source address cannot be 
routed to the Internet. This means also that it is not possible to 
communicate with local MANET-nodes, which are away from home and use 
the home address as the source address for local communication. 

The site-local address can be used in multiple sites and the address 
itself doesn't contain an indication about a particular site. This kind 
of ambiguousness presents problems to the application developers and 
multi-sited routers. This has led the IETF to deprecating the use of 
site-local address [8], and search for alternative solutions [13]. This 
discourages further the use of site-local addresses instead of global 
addresses. It remains to be seen how the alternative addressing solution 
can be used with AODV [13].  

5.3.1. AODV-MIPv6 co-operation

A typical way for a MIPv6_MN to choose a default router and configure a 
COA is to receive RAs sent by the AR. If AODV is used as a MANET-routing 
protocol, the default router and COA are configured via a 
reactive IPv6 Prefix discovery sequence. It is desirable for an AODV 
supported MIPv6_MN to use its home address when at home, and its COA 
when away from home to avoid unnecessary tunneling. To enable this, the 
choice of being in the home or foreign network should be done after the 
IPv6 Prefix discovery sequence by comparing the received IPv6 Prefix to 
the home network prefix similarly as the IPv6 prefixes advertised with 

P„„kk÷nen et al.      Expires July 2004                         [Page 6]

INTERNET-DRAFT        End-to-end connectivity              December 2003

RAs are used for movement detection in standard MIPv6 networks. 
If the home network prefix is equal to the IPv6 Prefix, the MIPv6_MN 
uses the configured address as its home address and refreshes the route 
for it. Otherwise the address is used as a COA, which is registered 
after the route refresh sequence to the HA of the MIPv6_MN. If the 
MIPv6_MN moves away from the home MANET-network, and continues to use 
the configured MANET-address as its home address, its HA has to defend 
the home address by answering to AODV's DAD messages, so that no other 
node can configure the same address in the MANET-network. This 
functionality should be similar as the standard MIPv6 home address 
defending at the HA [1].

6. IPv6-MANET addressing 

The MANET-nodes should be able to communicate with local IPv6/MIPv6-
nodes and CNs in the Internet. This chapter describes IPv6 addressing 
issues related to such use cases.

6.1. AODV communication algorithm

The following communication algorithm supports hierarchical routing 
for COAs and flat routing for site-local addresses:

1. If the destination is a site-local MANET-address or the destination's 
   IPv6-prefix is equal with the IPv6 Prefix received via IPv6 Prefix 
   Discovery => execute route discovery

2. Otherwise send packets via the default router 

The flat routing approach has to be used for the site-local addresses, 
because site-local addresses don't contain any information about a 
specific subnet. The need for route discovery to COAs prior to 
communication is based on the IPv6 Prefix. In this case the packets 
between multiple MANETs using COAs would flow via the ARs of the 
different MANETs.
 
In [11] it has been defined that the MANET-node MAY use route discovery 
always when sending packets whether or not the destination is in the 
Internet or not. If in this case the CN is in the Internet and no answer 
to the RREQ is received, the CN is deduced to be outside the MANET, and 
the default router is used. The algorithm presented in this document 
uses the default router immediately, when packets are sent to local 
IPv6/MIPv6-nodes or CNs in the Internet. This means that the initial 
route discovery phase is not needed, which results in faster 
communication initiation with the peer compared to the solution 
presented in [11]. There is also no need to add destination entries to 
the routing table via the default router, (destination -> 
default-router) which are needed, if route discovery is used always 
when initiating communication with a random node at the first time. 

6.2. Address autoconfiguration and communication issues

IPv6/MIPv6-node related DAD guarantees that the interface-ID of the 

P„„kk÷nen et al.      Expires July 2004                         [Page 7]

INTERNET-DRAFT        End-to-end connectivity              December 2003

IPv6-address is unique on a link [4]. The IPv6/MIPv6-nodes discover 
the IPv6 prefix via the RAs sent by the AR, which is attached to the 
interface-ID to configure a unique IPv6 address. Also a link-local 
address is created by attaching a well-known link-local prefix 
(fe80::/64) to the interface-ID [4][7]. MANET-address related DAD 
guarantees that the interface-ID is unique in the MANET [10]. The IPv6 
prefix used in the MANET is received via IPv6 Prefix discovery, which 
is attached to the MANET related interface-ID to create a unique IPv6 
address.           

It is possible that equal interface-IDs are configured in a 
heterogeneous MANET-network, because the scope of the DAD-procedures 
related to the interface-IDs overlap. To guarantee unique global IPv6 
addresses, the IPv6 prefixes used in the different autoconfiguration 
procedures have to be different.   

End-to-end connectivity between heterogeneous nodes is described in 
figure 3. Because the IPv6 prefixes have to be different, it doesn't 
matter which addressing model is used with the IPv6-MANET communication. 
Also PND is not required in the AR, because the IPv6-MIPv6-nodes send 
always packets for the MANET-node via its configured default router 
(::/0 -> AR's link-local address). The MANET-node also uses its 
configured default router for communication with the IPv6/MIPv6-node 
(::/0 -> next hop towards MR) without using the route discovery 
procedure, because the IPv6 prefixes are different. Global addresses 
have to be used always when the default router is used, in case the CN 
would be in the Internet instead of being in a local IPv6/MIPv6-node. If 
the IPv6/MIPv6-node and MANET-node are on the same link and in the radio 
communication range of each other, the only possible way for these nodes 
to communicate directly with each other is by using link-local addresses
, because the default router is used in other situations for routing 
between the nodes.     






















P„„kk÷nen et al.      Expires July 2004                         [Page 8]

INTERNET-DRAFT        End-to-end connectivity              December 2003

                                   CN       HA_MN
                                    |         |
                                    |         |         
                           _________|_________|________                                                                                     
                           \                          /
                             \          Internet     /---------HA_MR 
                              \_____________________/       
               ___________________|____________________________________
              (                     |                                  )
              (                   AR/MR  RT: IPv6-prefix -> ethx       )
              (                  /\  /\      MANET1-node -> ethx       )
              (                  /     \     MANET2-node -> MANET1-node)
              (                 /    MANET1-node                       )
              (                /         \         RT: ::/0 -> AR      )
              (               /           \            MANET2 -> ethx  )
              (              \/           \/                           )
              (     IPv6/MIPv6<----------->MANET2-node                 )
              (        node    link-local                              )
              (                 addresses                              ) 
              (  RT: ::/0 -> AR               RT: ::/0 -> next-hop     ) 
              (                                   towards AR           )
              (___________________________________next-hop -> ethx_____)                                               
    
Figure 3. End-to-end connectivity in a MANET-network with heterogeneous 
          nodes.

If the AR sends Redirect ICMP-messages and the AODV-node and NEMO-node 
are on the same link, the Redirect-messages cause the same problem, 
which is present in IPv6/MIPv6-communication, but only for communication 
from the IPv6/MIPv6-node to the AODV-node.

7. NEMO addressing

As mentioned before the AR could also be a MR, which would make the 
heterogeneous MANET-network mobile. In this case the NEMO bi-directional 
tunneling used on the MR's egress interface is transparent to the 
end-to-end connectivity of the nodes in the MANET-network, because 
seamless mobility is supported by the NEMO-approach i.e. the IP 
addresses configured for the nodes of the mobile network don't change
when the network moves. 
 
In any case the AR/MR needs two IPv6 prefixes for the autoconfiguration 
of both MANET and IPv6/MIPv6-nodes. These prefixes have to be either 
statically configured for the AR/MR, or delegated dynamically from some 
network entity for example via DHCPv6 [5] [14].

8. Security issues

Security issues have not been considered in this document, but should be 
taken into account in a future version of this document.

9. Open issues


P„„kk÷nen et al.      Expires July 2004                         [Page 9]

INTERNET-DRAFT        End-to-end connectivity              December 2003 

The source address selection of a node in the MANET-network is an issue 
for further work. For example when a MIPv6_MN communicates with a local 
IPv6-node, the COAs should be used for communication to avoid tunneling 
via the HA_MN (instead of using home addresses). Security issues should 
also be taken into account in the future.    

References

[1]  D. B. Johnson, C. E. Perkins, J. Arkko "Mobility Support in IPv6" 
     <draft-ietf-mobileip-ipv6-24.txt>, Internet Draft, June 2003.
[2]  NEtwork MObility working group website URL: 
     http://www.ietf.org/html.charters/nemo-charter.html.
[3]  S. Bradner "Key words for use in RFCs to Indicate Requirement 
     Levels" BCP 14, RFC 2119, March 1997.
[4]  S. Thomson and T. Narten, "IPv6 Stateless Address 
     Autoconfiguration", RFC 2462, December 1998. 
[5]  R. Droms et al. "Dynamic Host Configuration Protocol for IPv6 
     (DHCPv6)", RFC 3315, July 2003.          
[6]  T. Narten, E. Nordmark and W. Simpson, "Neighbor Discovery for IP 
     Version 6 (IPv6)", RFC 2461, December 1998. 
[7]  R. Hinden, S. Deering "IP Version 6 Addressing Architecture" 
     <draft-ietf-ipv6-addr-arch-v4-00.txt>, Internet Draft October 2003.  
[8]  C. Huitema, B. Carpenter "Deprecating Site Local Addresses" 
     <draft-ietf-ipv6-deprecate-site-local-02.txt>, Internet Draft, 
     November 2003.
[9]  C.E. Perkins et al. "IP Address Autoconfiguration for Ad Hoc 
     Networks" <draft-ietf-manet-autoconf-01.txt>, Internet draft, 
     November 2001.
[10] M. Rantonen, J. Keisala "IP Address Autoconfiguration with DAD
     minimization for Ad Hoc Networks" 
     <draft-rantonen-manet-idaddress-dad-adhocnet-00.txt>, Internet 
     draft, August 2003.
[11] R. Wakikawa et al. "Global Connectivity for IPv6 Mobile Ad Hoc
     Networks" <draft-wakikawa-manet-globalv6-02.txt> Internet draft,
     November 2002.
[12] C.E. Perkins, E.M. Belding Royer, S. Das "Ad hoc On-Demand 
     Distance Vector (AODV) Routing" RFC 3561.
[13] R. Hinden, B. Haberman "Unique Local IPv6 Unicast Addresses" 
     <draft-ietf-ipv6-unique-local-addr-01.txt>, Internet draft, 
     September 2003.
[14] R. Droms "DHCPv6 Prefix Delegation for NEMO" 
     <draft-droms-nemo-dhcpv6-pd-00.txt>, Internet draft, June 2003.
[15] J. Manner, M. Kojo "Mobility Related Terminology" 
     <draft-ietf-seamoby-mobility-terminology-04.txt>, Internet draft
     April 2003.
[16] T. Ernst, H. Lach "Network Mobility Support Terminology" 
     <draft-ietf-nemo-terminology-00.txt>, Internet draft, May 2003.

Author's addresses

Pekka P„„kk÷nen
VTT Technical Research Centre Of Finland (VTT Electronics)
Kaitov„yl„ 1 

P„„kk÷nen et al.      Expires July 2004                        [Page 10]

INTERNET-DRAFT        End-to-end connectivity              December 2003

90571 Oulu
Finland
email: pekka.paakkonen@vtt.fi

Mika Rantonen
VTT Technical Research Centre Of Finland (VTT Electronics)
Kaitov„yl„ 1 
90571 Oulu
Finland
email: mika.rantonen@vtt.fi

Juhani Latvakoski
VTT Technical Research Centre Of Finland (VTT Electronics)
Kaitov„yl„ 1 
90571 Oulu
Finland
email: juhani.latvakoski@vtt.fi

Appendix A: IPv6/MIPv6 addressing example 

This appendix describes how Proxy Neighbor Discovery and Redirect ICMP
messages are related to the ad-hoc mode of the IEEE WLAN 802.11b access
technology. 

A.1. Proxy Neighbor Discovery (PND) in the AR

PND MAY be used with certain access technologies, when the ON-link 
addressing model is used in the AR. Figure 4 describes a situation,
in which the peers cannot communicate directly with each other, but the
AR is able to provide routing for the nodes (the circles represent the
wireless communication ranges of the nodes). The PND function means that
the AR answers on behalf of the destination with a Neighbor Advertisement
(NA) to the Neighbor Solicitation (NS) message sent by the source 
(steps 1 and 2). The NA contains the link-layer address of the AR instead
of the destination. This causes the source to send packets for the 
destination to the AR, which routes the packets to the final destination 
(steps 3 and 4). This means that the AR accepts packets not explicitly 
addressed to it. In the NA sent by the AR the Override-flag is set to 
zero, so that the NA sent by the real destination with the Override-flag
set overrides the NA sent by the AR. This feature causes the source to 
send packets to the real destination when the peers are within each 
other's communication range. 
  ________________________________________________________________
 (                           [        )                           ]
 (                           [        )                           ]
 (         4. IPv6 packet    [        )  1.NS  3.IPv6 packet      ]
 (   |-----------------------[---AR<--)----------------------|    ]
 (  \/                       [    |   )                      |    ]
 (  Node2                    [    |---)------------------->Node1  ]
 (___________________________[________)    2.NA                   ]
                             [____________________________________]

Figure 4. Proxy Neighbor Discovery (PND).  

P„„kk÷nen et al.      Expires July 2004                        [Page 11]

INTERNET-DRAFT        End-to-end connectivity              December 2003

Consider the local mobility of the nodes in figure 4. The nodes may be
mobile in such a way that they may or may not be in each other's 
communication range during a UDP/TCP session. In this case the IP 
addresses don't change, because only one AR is present which sends RAs.
Reachability of the neighbor (destination) is dependent on the upper 
layer information and Neighbor Unreachability Detection (NUD) as defined 
in [6].         

A downside of the PND function is that the AR has to know the IP and 
link-layer addresses of the peers. Also security problems are present,
because a malicious AR might execute PND for the destination. The 
advantage of the PND in the ON-link addressing model is that the 
traffic between the local nodes are sent directly between the nodes, 
when the nodes are in each other's communication range. In the 
OFF-link addressing model the traffic would always goes via the AR.

A.2. Redirect ICMP message

Another thing related to some access technologies is the sending of the 
Redirect ICMP-messages. When the source sends packets via the AR to the 
destination, the AR discovers that the destination is in fact on the 
same link as the source, and sends a Redirect ICMP message to the 
source. The Redirect-message contains the link-layer address of the 
destination, which causes the source to send packets to the real 
destination instead of the routing via the AR, because the source 
updates the link-layer address of the destination's IP address in the 
neighbor cache [6]. If the peers are not within the radio communication
range of each other (figure 4) and the AR routes the packets between the
peers, communication ceases between the peers. This situation occurs 
when the IPv6 prefix is advertised as OFF-link or the PND function is 
used with the ON-link model in the AR. Figure 5 describes a situation in 
which the AR sends a Redirect-message with the destination's 
link-layer-address (LL-address), which causes the source to update its 
neighbor cache.
 
          AR-----Destination
          |
          |
          |  ||    Redirect ICMP-message
          |  ||     Target link-layer address
          | \  /     Destination's LL-address
          |  \/  
          | 
     IPv6/MIPv6-node

        Neighbor cache: IPv6 address -> AR's LL-address/
                                        Destination's 
                                        LL-address

Figure 5. Redirect ICMP messages.

Appendix B: Global connectivity via next-hop routing 


P„„kk÷nen et al.      Expires July 2004                        [Page 12]

INTERNET-DRAFT        End-to-end connectivity              December 2003

This appendix describes how global connectivity could be achieved with 
AODV by using next-hop routing, and is similar to the one described in 
[11]. This mechanism has been tested in a testbed and has been 
described in figure 6. 

                    AR
                    /|\      RT: Int.node -> eth0
1.RREQ (I-flag set)  |        5. AODV-node -> Int.node
2.RREP (I-flag set)  |
             4.RREQ  |
             6.RREP  |
                    \|/
                 Int.node    RT: 5.AODV-node -> eth0 
                    /|\          3.MR ->eth0
1.RREQ (I-flag set)  |           3.::/0 -> AR
2.RREP (I-flag set)  | 
             4.RREQ  |
             6.RREP  |
                    \|/      RT: 3. AR -> Int.node
                 AODV-node       3. ::/0 -> Int.node
                                 Int.node -> eth0

Figure 6. Global connectivity via next-hop routing.

The global connectivity is enabled with IPv6 prefix discovery 
(steps 1-3) and route refresh sequences (steps 4-6). IPv6 prefix 
discovery is used for the address autoconfiguration purposes to enable 
global connectivity for the AODV-node, and the route refresh procedure 
maintains AODV-node reachability from the AR i.e. from the Internet. 

The IPv6 Prefix discovery sequence begins when the AODV-node sends a 
RREQ with the I-flag set to the ALL_MANET_GW_MCAST-multicast address 
[11] from its configured site-local MANET-address (step1 in figure 6). 
The site-local addresses's uniqueness has been tested in the DAD 
procedure. The AR returns the IPv6 Prefix by sending a RREP with the 
I-flag set to the AODV-node's MANET-address (step2). When the AODV-node 
and intermediate nodes receive this RREP, a RT entry for the default 
router and AR towards the next-hop towards the AR are created (step3). 
The AR's address is a global address configured on the ingress interface 
of the AR. After this the AODV-node attaches the IPv6 Prefix to the 
interface-ID configured during the MANET-related DAD to create a unique 
global IPv6 address. This enables global connectivity for the AODV-node. 
    
In the route refresh sequence the AODV-node sends a RREQ to the default 
router's address from its configured global IPv6 address (step4). The 
default router's address is a global address configured on the ingress 
interface of the AR. When the AR and intermediate nodes receive the 
RREQ, they create an entry for the AODV-node's global address towards 
the next-hop towards the AODV-node (step5). This enables AODV-node's 
reachability from the Internet. Finally the AR sends a RREP in response 
to the RREQ (step6). The AODV-node has to execute the route refresh 
sequence in certain time periods in order to maintain reachability from 
the AR [11]. If the route cannot be refreshed i.e. the AODV-node loses 

P„„kk÷nen et al.      Expires July 2004                        [Page 13]

INTERNET-DRAFT        End-to-end connectivity              December 2003

reachability to the AR, the AODV-node has to return to using the 
site-local MANET-address, because the AR might not be present anymore to 
provide default routing and the validity of the IPv6 prefix has expired.
    
In [11] it has been proposed to implement default routing via the global 
address of the AR. In that kind of configuration the furthermost 
AODV-node of figure 6 would require three RT entries (::/0 -> AR ; 
AR -> next-hop towards AR ; next-hop -> ethx) for default routing. This 
isn't implementable on the Linux platform, because the next-hop router 
must have a RT entry towards the interface as described in figure 6. 
This is the reason default routing had to be provided via a next-hop as 
describes in this appendix.

Full Copyright Statement

   Copyright (C) The Internet Society (2003).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

