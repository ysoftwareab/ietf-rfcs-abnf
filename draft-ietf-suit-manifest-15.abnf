current-list = components
current-list = [ components[idx] for idx in component-index ]
current-list = [ components[component-index] ]
NAMESPACE_CBOR_PEN = UUID5(NAMESPACE_OID, h'D86F452B06010401')
NAMESPACE_CBOR_PEN = 47fbdabb-f2e4-55f0-bb39-3620c2f6df4e

SUIT_Envelope_Tagged = #6.107(SUIT_Envelope)
SUIT_Envelope = {
     ? suit-delegation => bstr .cbor SUIT_Delegation,
suit-authentication-wrapper => bstr .cbor SUIT_Authentication,
suit-manifest  => bstr .cbor SUIT_Manifest,
SUIT_Authentication = [
       bstr .cbor SUIT_Digest,
       * bstr .cbor SUIT_Authentication_Block
SUIT_Digest = [
     suit-digest-algorithm-id : suit-cose-hash-algs,
     suit-digest-bytes : bstr,
     * $$SUIT_Digest-extensions
SUIT_Severable_Manifest_Members = (
     ? suit-payload-fetch => bstr .cbor SUIT_Command_Sequence,
     ? suit-install => bstr .cbor SUIT_Command_Sequence,
     ? suit-text => bstr .cbor SUIT_Text_Map,
     ? suit-coswid => bstr .cbor concise-software-identity,
     * $$SUIT_severable-members-extensions,
SUIT_Integrated_Payload = (suit-integrated-payload-key => bstr)
suit-integrated-payload-key = tstr

SUIT_Manifest_Tagged = #6.1070(SUIT_Manifest)

SUIT_Manifest = {
suit-manifest-version         => 1,
suit-manifest-sequence-number => uint,
suit-common                   => bstr .cbor SUIT_Common,
SUIT_Unseverable_Members = (
     ? suit-validate => bstr .cbor SUIT_Command_Sequence,
     ? suit-load => bstr .cbor SUIT_Command_Sequence,
     ? suit-run => bstr .cbor SUIT_Command_Sequence,
     * $$unseverable-manifest-member-extensions,
SUIT_Severable_Members_Choice = (
     ? suit-payload-fetch => \
       bstr .cbor SUIT_Command_Sequence / SUIT_Digest,
     ? suit-install => bstr .cbor SUIT_Command_Sequence / SUIT_Digest,
     ? suit-text => bstr .cbor SUIT_Command_Sequence / SUIT_Digest,
     * $$severable-manifest-members-choice-extensions
SUIT_Common = {
       ? suit-components             => SUIT_Components,
       ? suit-common-sequence        => bstr .cbor SUIT_Common_Sequence,
       * $$SUIT_Common-extensions,
SUIT_Components           = [ + SUIT_Component_Identifier ]

SUIT_Dependency = {
suit-dependency-digest => SUIT_Digest,
SUIT_Component_Identifier =  [* bstr]

SUIT_Common_Sequence = [
       + ( SUIT_Condition // SUIT_Common_Commands )
SUIT_Command_Sequence = [ + (
       SUIT_Condition // SUIT_Directive // SUIT_Command_Custom
SUIT_Command_Custom = (suit-command-custom, bstr/tstr/int/nil)
SUIT_Directive_Try_Each_Argument = [
       2* bstr .cbor SUIT_Command_Sequence,
       ?nil
SUIT_Rep_Policy = uint .bits suit-reporting-bits

suit-reporting-bits = &(
       suit-send-record-success : 0,
       suit-send-record-failure : 1,
       suit-send-sysinfo-success : 2,
       suit-send-sysinfo-failure : 3
cbor-pen = #6.112(bstr)

SUIT_Text_Map = {
       SUIT_Text_Keys,
       * SUIT_Component_Identifier => {
           SUIT_Text_Component_Keys
       }
SUIT_Text_Component_Keys = (
       ? suit-text-vendor-name           => tstr,
       ? suit-text-model-name            => tstr,
       ? suit-text-vendor-domain         => tstr,
       ? suit-text-model-info            => tstr,
       ? suit-text-component-description => tstr,
       ? suit-text-component-version     => tstr,
       * $$suit-text-component-key-extensions
SUIT_Text_Keys = (
       ? suit-text-manifest-description => tstr,
       ? suit-text-update-description   => tstr,
       ? suit-text-manifest-json-source => tstr,
       ? suit-text-manifest-yaml-source => tstr,
       * $$suit-text-key-extensions
suit-authentication-wrapper = 2
suit-manifest = 3

cose-alg-sha-256 = -16

cose-alg-shake128 = -18
cose-alg-sha-384 = -43
cose-alg-sha-512 = -44
cose-alg-shake256 = -45

suit-manifest-version = 1
suit-manifest-sequence-number = 2
suit-common = 3
suit-reference-uri = 4
suit-payload-fetch = 8
suit-install = 9
suit-validate = 10
suit-load = 11
suit-run = 12
suit-text = 13

suit-components = 2
suit-common-sequence = 4

suit-command-custom = nint

suit-condition-vendor-identifier = 1
suit-condition-class-identifier  = 2
suit-condition-image-match       = 3
suit-condition-component-slot    = 5

suit-condition-abort                    = 14
suit-condition-device-identifier        = 24

suit-directive-set-component-index      = 12
suit-directive-try-each                 = 15
suit-directive-override-parameters      = 20
suit-directive-fetch                    = 21
suit-directive-copy                     = 22
suit-directive-run                      = 23

suit-directive-swap                     = 31
suit-directive-run-sequence             = 32

suit-parameter-vendor-identifier = 1
suit-parameter-class-identifier  = 2
suit-parameter-image-digest      = 3
suit-parameter-component-slot    = 5

suit-parameter-strict-order      = 12
suit-parameter-soft-failure      = 13
suit-parameter-image-size        = 14

suit-parameter-uri               = 21
suit-parameter-source-component  = 22
suit-parameter-run-args          = 23

suit-parameter-device-identifier = 24

suit-parameter-custom = nint

suit-text-manifest-description  = 1
suit-text-update-description    = 2
suit-text-manifest-json-source  = 3
suit-text-manifest-yaml-source  = 4

suit-text-vendor-name           = 1
suit-text-model-name            = 2
suit-text-vendor-domain         = 3
suit-text-model-info            = 4
suit-text-component-description = 5
suit-text-component-version     = 6
