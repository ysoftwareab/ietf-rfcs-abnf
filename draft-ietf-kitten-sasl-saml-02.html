<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>A SASL and GSS-API Mechanism for SAML </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Applicability for non-HTTP Use Cases">
<link href="#rfc.section.4" rel="Chapter" title="4 SAML SASL Mechanism Specification">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Advertisement">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Initiation">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Server Redirect">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Client Empty Response and other">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Outcome and parameters">
<link href="#rfc.section.5" rel="Chapter" title="5 SAML GSS-API Mechanism Specification">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 GSS-API Principal Name Types for SAML">
<link href="#rfc.section.6" rel="Chapter" title="6 Channel Binding">
<link href="#rfc.section.7" rel="Chapter" title="7 Examples">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 XMPP">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 IMAP">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Man in the middle and Tunneling Attacks">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Binding SAML subject identifiers to Authorization Identities">
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 User Privacy">
<link href="#rfc.section.8.4" rel="Chapter" title="8.4 Collusion between RPs">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Acknowledgments">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Changes">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Security Assertion Markup Language (SAML) has found its usage on the Internet for Web Single Sign-On. Simple Authentication and Security Layer (SASL) and the Generic Security Service Application Program Interface (GSS-API) are application frameworks to generalize authentication. This memo specifies a SASL mechanism and a GSS-API mechanism for SAML 2.0 that allows the integration of existing SAML Identity Providers with applications using SASL and GSS-API.  " />
  <meta name="description" content="Security Assertion Markup Language (SAML) has found its usage on the Internet for Web Single Sign-On. Simple Authentication and Security Layer (SASL) and the Generic Security Service Application Program Interface (GSS-API) are application frameworks to generalize authentication. This memo specifies a SASL mechanism and a GSS-API mechanism for SAML 2.0 that allows the integration of existing SAML Identity Providers with applications using SASL and GSS-API.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">K. Wierenga</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Cisco Systems, Inc.</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">E. Lear</td>
</tr>
<tr>
<td class="left">Expires: August 29, 2011</td>
<td class="right">Cisco Systems GmbH</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">S. Josefsson</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">SJD AB</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">February 25, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">A SASL and GSS-API Mechanism for SAML <br />
  <span class="filename">draft-ietf-kitten-sasl-saml-02.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Security Assertion Markup Language (SAML) has found its usage on the Internet for Web Single Sign-On. Simple Authentication and Security Layer (SASL) and the Generic Security Service Application Program Interface (GSS-API) are application frameworks to generalize authentication. This memo specifies a SASL mechanism and a GSS-API mechanism for SAML 2.0 that allows the integration of existing SAML Identity Providers with applications using SASL and GSS-API.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 29, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Applicability for non-HTTP Use Cases</a>
</li>
<li>4.   <a href="#rfc.section.4">SAML SASL Mechanism Specification</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Advertisement</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Initiation</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Server Redirect</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Client Empty Response and other</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Outcome and parameters</a>
</li>
<li>5.   <a href="#rfc.section.5">SAML GSS-API Mechanism Specification</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">GSS-API Principal Name Types for SAML</a>
</li>
<li>6.   <a href="#rfc.section.6">Channel Binding</a>
</li>
<li>7.   <a href="#rfc.section.7">Examples</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">XMPP</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">IMAP</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Man in the middle and Tunneling Attacks</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Binding SAML subject identifiers to Authorization Identities</a>
</li>
<li>8.3.   <a href="#rfc.section.8.3">User Privacy</a>
</li>
<li>8.4.   <a href="#rfc.section.8.4">Collusion between RPs</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li>10.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Acknowledgments</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Changes</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Security Assertion Markup Language (SAML) 2.0 <a href="#OASIS.saml-core-2.0-os">[OASIS.saml-core-2.0-os]</a> is a modular specification that provides various means for a user to be identified to a relying party (RP) through the exchange of (typically signed) assertions issued by an identity provider (IdP).  It includes a number of protocols, protocol bindings <a href="#OASIS.saml-bindings-2.0-os">[OASIS.saml-bindings-2.0-os]</a>, and interoperability profiles <a href="#OASIS.saml-profiles-2.0-os">[OASIS.saml-profiles-2.0-os]</a> designed for different use cases.  </p>
<p id="rfc.section.1.p.2">Simple Authentication and Security Layer (SASL) <a href="#RFC4422">[RFC4422]</a> is a generalized mechanism for identifying and authenticating a user and for optionally negotiating a security layer for subsequent protocol interactions. SASL is used by application protocols like <a href="#RFC3501">IMAP</a> <cite title="NONE">[RFC3501]</cite> and <a href="#RFC3920">XMPP</a> <cite title="NONE">[RFC3920]</cite>. The effect is to make modular authentication, so that newer authentication mechanisms can be added as needed. This memo specifies just such a mechanism.  </p>
<p id="rfc.section.1.p.3">The <a href="#RFC2743">Generic Security Service Application Program Interface (GSS-API)</a> <cite title="NONE">[RFC2743]</cite> provides a framework for applications to support multiple authentication mechanisms through a unified programming interface.  This document defines a pure SASL mechanism for SAML, but it conforms to the new bridge between SASL and the GSS-API called <a href="#RFC5801">GS2</a> <cite title="NONE">[RFC5801]</cite>.  This means that this document defines both a SASL mechanism and a GSS-API mechanism.  We want to point out that the GSS-API interface is optional for SASL implementers, and the GSS-API considerations can be avoided in environments that uses SASL directly without GSS-API.  </p>
<p id="rfc.section.1.p.4">As currently envisioned, this mechanism is to allow the interworking between SASL and SAML in order to assert identity and other attributes to relying parties. As such, while servers (as relying parties) will advertise SASL mechanisms (including SAML), clients will select the SAML SASL mechanism as their SASL mechanism of choice. </p>
<p id="rfc.section.1.p.5">The SAML mechanism described in this memo aims to re-use the available SAML deployment to a maximum extent and therefore does not establish a separate authentication, integrity and confidentiality mechanism.  The mechanisms assumes a security layer, such as Transport Layer Security (TLS), to protect against some attacks.</p>
<p><a href="#overview">Figure 1</a> describes the interworking between SAML and SASL: this document requires enhancements to the Relying Party and to the Client (as the two SASL communication end points) but no changes to the SAML Identity Provider are necessary. To accomplish this goal some indirect messaging is tunneled within SASL, and some use of external methods is made.</p>
<div id="#rfc.figure.1"></div>
<div id="#overview"></div>
<pre> 


                                    +-----------+
                                    |           |
                                   &gt;|  Relying  |
                                  / |  Party    |
                                //  |           |
                              //    +-----------+
                   SAML/    //            ^
                   HTTPs  //           +--|--+
                        //             | S|  |
                       /             S | A|  |
                     //              A | M|  |
                   //                S | L|  |
                 //                  L |  |  |
               //                      |  |  |
             &lt;/                        +--|--+
      +------------+                      v
      |            |                 +----------+
      |  SAML      |     HTTPs       |          |
      |  Identity  |&lt;---------------&gt;|  Client  |
      |  Provider  |                 |          |
      +------------+                 +----------+

</pre>
<p></p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.2.p.2">The reader is assumed to be familiar with the terms used in the SAML 2.0 specification.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Applicability for non-HTTP Use Cases</h1>
<p id="rfc.section.3.p.1">While SAML itself is merely a markup language, its common use case these days is with HTTP.  What follows is a typical flow: </p>
<p></p>

<ol>
<li>The browser requests a resource of a Relying Party (RP) (via an HTTP request).</li>
<li>The RP sends an HTTP redirect as described in Section 10.3 of <a href="#RFC2616">[RFC2616]</a>  to the browser to the Identity Provider (IdP) or an IdP discovery service with an authentication request that contains the name of resource being requested, some sort of a cookie and a return URL, </li>
<li>The user authenticates to the IdP and perhaps authorizes the authentication to the service provider. </li>
<li>In its authentication response, the IdP redirects the browser back to the RP with an authentication assertion (stating that the IdP vouches that the subject has successfully authenticated), optionally along with some additional attributes. </li>
<li>RP now has sufficient identity information to approve access to the resource or not, and acts accordingly.  The authentication is concluded. </li>
</ol>

<p> </p>
<p id="rfc.section.3.p.3">When considering this flow in the context of SASL, we note that while the RP and the client both must change their code to implement this SASL mechanism, the IdP must remain untouched.  The  RP already has some sort of session (probably a TCP connection) established with the client. However, it may be necessary to redirect a SASL client to another application or handler.  This will be discussed below.  The steps are shown from below:</p>
<p></p>

<ol>
<li>The Relying Party or SASL server advertises support for the SASL SAML20 mechanism to the client </li>
<li>The client initiates a SASL authentication with SAML20 and sends a domain</li>
<li>The Relying Party transmits an authentication request encoded using a Universal Resource Identifier (URI) as described in RFC 3986 <a href="#RFC3986">[RFC3986]</a> and a redirect to the IdP corresponding to the domain</li>
<li>The SASL client now sends an empty response, as authentication continues via the normal SAML flow. </li>
<li>At this point the SASL client MUST construct a URL containing the content received in the previous message from the RP. This URL is transmitted to the IdP either by the SASL client application or an appropriate handler, such as a browser.</li>
<li>Next the client authenticates to the IdP. The manner in which the end user is authenticated to the IdP and any policies surrounding such authentication is out of scope for SAML and hence for this draft. This step happens out of band from SASL.</li>
<li>The IdP will convey information about the success or failure of the authentication back to the the RP in the form of an Authentication Statement or failure, using a indirect response via the client browser or the handler. This step happens out of band from SASL.</li>
<li>The SASL Server sends an appropriate SASL response to the client, along with an optional list of attributes</li>
</ol>

<p> </p>
<p id="rfc.section.3.p.5">Please note: What is described here is the case in which the client has not previously authenticated. If the client can handle SAML internally it is possible that the client already holds a valid SAML authentication token so that the user does not need to be involved in the process anymore, but that would still be external to SASL.  </p>
<p id="rfc.section.3.p.6">With all of this in mind, the flow appears as follows: </p>
<div id="#rfc.figure.2"></div>
<div id="#flow"></div>
<pre> 


         SASL Serv.       Client          IdP
            |&gt;-----(1)-----&gt;|              | Advertisement
            |               |              |
            |&lt;-----(2)-----&lt;|              | Initiation
            |               |              |
            |&gt;-----(3)-----&gt;|              | Authentication Request
            |               |              |
            |&lt;-----(4)-----&lt;|              | Empty Response
            |               |              |
            |               |&lt; - - - - - -&gt;| Client&lt;&gt;IDP 
            |               |              | Authentication
            |               |              |
            |&lt;- - - - - - - - - - - - - - -| Authentication Statement
            |               |              |
            |&gt;-----(6)-----&gt;|              | SASL completion with
            |               |              | status
            |               |              |

       ----- = SASL
       - - - = HTTP or HTTPs (external to SASL)
       

 
</pre>
<p></p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> SAML SASL Mechanism Specification</h1>
<p id="rfc.section.4.p.1">Based on the previous figure, the following operations are performed with the SAML SASL mechanism.  </p>
<p id="rfc.section.4.p.2">The mechanism is "client first" as discussed in section 3 of <a href="#RFC4422">[RFC4422]</a> which means that the initial server challenge will be empty if the protocol does not support an initial client response.  </p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#advertisement" id="advertisement">Advertisement</a>
</h1>
<p id="rfc.section.4.1.p.1">To advertise that a server supports SAML 2.0, during application session initiation, it displays the name "SAML20" in the list of supported SASL mechanisms.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#initiation" id="initiation">Initiation</a>
</h1>
<p id="rfc.section.4.2.p.1">A client initiates a "SAML20" authentication with SASL by sending the GS2 header followed by the authentication identifier.  The GS2 header carries the optional authorization identity.  </p>
<div id="#rfc.figure.3"></div>
<pre>
    
     initial-response = gs2-header Idp-Identifier
     IdP-Identifier = domain ; domain name with corresponding IdP
    
   </pre>
<p id="rfc.section.4.2.p.2">The "gs2-header" is specified in <a href="#RFC5801">[RFC5801]</a>, and it is used as follows.  The "gs2-nonstd-flag" MUST NOT be present.  Regarding the channel binding "gs2-cb-flag" field, see Section 5.  The "gs2- authzid" carries the optional authorization identity.  Domain name is specified in <a href="#RFC1035">[RFC1035]</a>.  </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#1stresponse" id="1stresponse">Server Redirect</a>
</h1>
<p id="rfc.section.4.3.p.1">The SASL Server transmits a URI to the IdP that corresponds to the domain the user provided, with a SAML authentication request in the form of a SAML assertion as one of the parameters.  Note: The SASL server may have a static mapping of domain to corresponding IdP or alternatively a DNS-lookup mechanism could be envisioned, but that is out-of-scope for this document</p>
<div id="#rfc.figure.4"></div>
<pre>
    
     redirect-url = URI
    
   </pre>
<p id="rfc.section.4.3.p.2">As before, URI is specified in <a href="#RFC3986">[RFC3986]</a>.  </p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#empty" id="empty">Client Empty Response and other</a>
</h1>
<p id="rfc.section.4.4.p.1">The SASL client hands the URI it received from the server in the previous step to either a browser or other appropriate handler to continue authentication externally while sending an empty response to the SASL server.  The URI is encoded according to Section 3.4 of the <a href="#OASIS.saml-bindings-2.0-os">SAML bindings 2.0 specification</a> <cite title="NONE">[OASIS.saml-bindings-2.0-os]</cite>.  </p>
<div id="#rfc.figure.5"></div>
<pre>
    
     empty-response = ""
    
   </pre>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> <a href="#outcome" id="outcome">Outcome and parameters</a>
</h1>
<p id="rfc.section.4.5.p.1">The SAML authentication having completed externally, the SASL server will transmit the outcome of the authentication exchange as success or failure.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#gss-api" id="gss-api">SAML GSS-API Mechanism Specification</a>
</h1>
<p id="rfc.section.5.p.1">This section and its sub-sections and all normative references of it not referenced elsewhere in this document are INFORMATIONAL for SASL implementors, but they are NORMATIVE for GSS-API implementors.  </p>
<p id="rfc.section.5.p.2">The SAML SASL mechanism is actually also a GSS-API mechanism.  The messages are the same, but </p>
<p id="rfc.section.5.p.3">a) the GS2 header on the client's first message and channel binding data is excluded when SAML is used as a GSS-API mechanism, and </p>
<p id="rfc.section.5.p.4">b) the RFC2743 section 3.1 initial context token header is prefixed to the client's first authentication message (context token).  </p>
<p id="rfc.section.5.p.5">The GSS-API mechanism OID for SAML is 1.3.6.1.4.1.11591.4.8.  </p>
<p id="rfc.section.5.p.6">SAML20 security contexts always have the mutual_state flag (GSS_C_MUTUAL_FLAG) set to TRUE.  SAML does not support credential delegation, therefore SAML security contexts alway have the deleg_state flag (GSS_C_DELEG_FLAG) set to FALSE.  </p>
<p id="rfc.section.5.p.7">The SAML mechanism does not support per-message tokens or GSS_Pseudo_random.  </p>
<p id="rfc.section.5.p.8">Note that the GSS-API mechanism MUST only be used by the client when a secure channel with server authentication (e.g., TLS) is available.  </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#gss-api-name-types" id="gss-api-name-types">GSS-API Principal Name Types for SAML</a>
</h1>
<p id="rfc.section.5.1.p.1">SAML supports standard generic name syntaxes for acceptors such as GSS_C_NT_HOSTBASED_SERVICE (see <a href="#RFC2743">[RFC2743]</a>, Section 4.1).  SAML supports only a single name type for initiators: GSS_C_NT_USER_NAME.  GSS_C_NT_USER_NAME is the default name type for SAML.  The query, display, and exported name syntaxes for SAML principal names are all the same.  There are no SAML-specific name syntaxes -- applications should use generic GSS-API name types such as GSS_C_NT_USER_NAME and GSS_C_NT_HOSTBASED_SERVICE (see <a href="#RFC2743">[RFC2743]</a>, Section 4).  The exported name token does, of course, conform to <a href="#RFC2743">[RFC2743]</a>, Section 3.2.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#channel-binding" id="channel-binding">Channel Binding</a>
</h1>
<p id="rfc.section.6.p.1">The "gs2-cb-flag" MUST use "n" because channel binding data cannot be integrity protected by the SAML negotiation. FIXME: Transfer channel binding in SAML assertion? </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#examples" id="examples">Examples</a>
</h1>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#examples-xmpp" id="examples-xmpp">XMPP</a>
</h1>
<p id="rfc.section.7.1.p.1">Suppose the user has an identity at the SAML IdP saml.example.org and a Jabber Identifier (JID) "somenode@example.com", and wishes to authenticate his XMPP connection to xmpp.example.com. The authentication on the wire would then look something like the following: </p>
<p id="rfc.section.7.1.p.2">Step 1: Client initiates stream to server: </p>
<div id="#rfc.figure.6"></div>
<pre>

&lt;stream:stream xmlns='jabber:client'
xmlns:stream='http://etherx.jabber.org/streams'
to='example.com' version='1.0'&gt;

</pre>
<p id="rfc.section.7.1.p.3">Step 2: Server responds with a stream tag sent to client: </p>
<div id="#rfc.figure.7"></div>
<pre>

&lt;stream:stream
xmlns='jabber:client' xmlns:stream='http://etherx.jabber.org/streams'
id='some_id' from='example.com' version='1.0'&gt;

</pre>
<p id="rfc.section.7.1.p.4">Step 3: Server informs client of available authentication mechanisms:</p>
<div id="#rfc.figure.8"></div>
<pre>

&lt;stream:features&gt; 
 &lt;mechanisms xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
  &lt;mechanism&gt;DIGEST-MD5&lt;/mechanism&gt; 
  &lt;mechanism&gt;PLAIN&lt;/mechanism&gt;
  &lt;mechanism&gt;SAML20&lt;/mechanism&gt; 
 &lt;/mechanisms&gt; 
&lt;/stream:features&gt;

</pre>
<p id="rfc.section.7.1.p.5">Step 4: Client selects an authentication mechanism and provides the initial client response containing the <a href="#RFC4648">BASE64</a> <cite title="NONE">[RFC4648]</cite> encoded gs2-header and domain: </p>
<div id="#rfc.figure.9"></div>
<pre>

&lt;auth xmlns='urn:ietf:params:xml:ns:xmpp-sasl' mechanism='SAML20'&gt;
biwsZXhhbXBsZS5vcmc&lt;/auth&gt;

</pre>
<p id="rfc.section.7.1.p.6">The decoded string is: n,,example.org</p>
<p id="rfc.section.7.1.p.7">Step 5: Server sends a BASE64 encoded challenge to client in the form of an HTTP Redirect to the SAML IdP corresponding to example.org (https://saml.example.org) with the SAML Authentication Request as specified in the redirection url: </p>
<div id="#rfc.figure.10"></div>
<pre>

aHR0cHM6Ly9zYW1sLmV4YW1wbGUub3JnL1NBTUwvQnJvd3Nlcj9TQU1MUmVx
dWVzdD1QSE5oYld4d09rRjFkR2h1VW1WeGRXVnpkQ0I0Yld4dWN6cHpZVzFz
Y0QwaWRYSnVPbTloYzJsek9tNWhiV1Z6T25Sak9sTkJUVXc2TWk0d09uQnli
M1J2WTI5c0lnMEtJQ0FnSUVsRVBTSmZZbVZqTkRJMFptRTFNVEF6TkRJNE9U
QTVZVE13Wm1ZeFpUTXhNVFk0TXpJM1pqYzVORGMwT1RnMElpQldaWEp6YVc5
dVBTSXlMakFpRFFvZ0lDQWdTWE56ZFdWSmJuTjBZVzUwUFNJeU1EQTNMVEV5
TFRFd1ZERXhPak01T2pNMFdpSWdSbTl5WTJWQmRYUm9iajBpWm1Gc2MyVWlE
UW9nSUNBZ1NYTlFZWE56YVhabFBTSm1ZV3h6WlNJTkNpQWdJQ0JRY205MGIy
TnZiRUpwYm1ScGJtYzlJblZ5YmpwdllYTnBjenB1WVcxbGN6cDBZenBUUVUx
TU9qSXVNRHBpYVc1a2FXNW5jenBJVkZSUUxWQlBVMVFpRFFvZ0lDQWdRWE56
WlhKMGFXOXVRMjl1YzNWdFpYSlRaWEoyYVdObFZWSk1QUTBLSUNBZ0lDQWdJ
Q0FpYUhSMGNITTZMeTk0YlhCd0xtVjRZVzF3YkdVdVkyOXRMMU5CVFV3dlFY
TnpaWEowYVc5dVEyOXVjM1Z0WlhKVFpYSjJhV05sSWo0TkNpQThjMkZ0YkRw
SmMzTjFaWElnZUcxc2JuTTZjMkZ0YkQwaWRYSnVPbTloYzJsek9tNWhiV1Z6
T25Sak9sTkJUVXc2TWk0d09tRnpjMlZ5ZEdsdmJpSStEUW9nSUNBZ0lHaDBk
SEJ6T2k4dmVHMXdjQzVsZUdGdGNHeGxMbU52YlEwS0lEd3ZjMkZ0YkRwSmMz
TjFaWEkrRFFvZ1BITmhiV3h3T2s1aGJXVkpSRkJ2YkdsamVTQjRiV3h1Y3pw
ellXMXNjRDBpZFhKdU9tOWhjMmx6T201aGJXVnpPblJqT2xOQlRVdzZNaTR3
T25CeWIzUnZZMjlzSWcwS0lDQWdJQ0JHYjNKdFlYUTlJblZ5YmpwdllYTnBj
enB1WVcxbGN6cDBZenBUUVUxTU9qSXVNRHB1WVcxbGFXUXRabTl5YldGME9u
Qmxjbk5wYzNSbGJuUWlEUW9nSUNBZ0lGTlFUbUZ0WlZGMVlXeHBabWxsY2ow
aWVHMXdjQzVsZUdGdGNHeGxMbU52YlNJZ1FXeHNiM2REY21WaGRHVTlJblJ5
ZFdVaUlDOCtEUW9nUEhOaGJXeHdPbEpsY1hWbGMzUmxaRUYxZEdodVEyOXVk
R1Y0ZEEwS0lDQWdJQ0I0Yld4dWN6cHpZVzFzY0QwaWRYSnVPbTloYzJsek9t
NWhiV1Z6T25Sak9sTkJUVXc2TWk0d09uQnliM1J2WTI5c0lpQU5DaUFnSUNB
Z0lDQWdRMjl0Y0dGeWFYTnZiajBpWlhoaFkzUWlQZzBLSUNBOGMyRnRiRHBC
ZFhSb2JrTnZiblJsZUhSRGJHRnpjMUpsWmcwS0lDQWdJQ0FnZUcxc2JuTTZj
MkZ0YkQwaWRYSnVPbTloYzJsek9tNWhiV1Z6T25Sak9sTkJUVXc2TWk0d09t
RnpjMlZ5ZEdsdmJpSStEUW9nb0NBZ0lDQjFjbTQ2YjJGemFYTTZibUZ0WlhN
NmRHTTZVMEZOVERveUxqQTZZV002WTJ4aGMzTmxjenBRWVhOemQyOXlaRkJ5
YjNSbFkzUmxaRlJ5WVc1emNHOXlkQTBLSUNBOEwzTmhiV3c2UVhWMGFHNURi
MjUwWlhoMFEyeGhjM05TWldZK0RRb2dQQzl6WVcxc2NEcFNaWEYxWlhOMFpX
UkJkWFJvYmtOdmJuUmxlSFErSUEwS1BDOXpZVzFzY0RwQmRYUm9ibEpsY1hW
bGMzUSs=

</pre>
<p id="rfc.section.7.1.p.8">The decoded challenge is:</p>
<div id="#rfc.figure.11"></div>
<pre>

https://saml.example.org/SAML/Browser?SAMLRequest=PHNhbWxwOk
F1dGhuUmVxdWVzdCB4bWxuczpzYW1scD0idXJuOm9hc2lzOm5hbWVzOnRjOl
NBTUw6Mi4wOnByb3RvY29sIg0KICAgIElEPSJfYmVjNDI0ZmE1MTAzNDI4OT
A5YTMwZmYxZTMxMTY4MzI3Zjc5NDc0OTg0IiBWZXJzaW9uPSIyLjAiDQogIC
AgSXNzdWVJbnN0YW50PSIyMDA3LTEyLTEwVDExOjM5OjM0WiIgRm9yY2VBdX
Robj0iZmFsc2UiDQogICAgSXNQYXNzaXZlPSJmYWxzZSINCiAgICBQcm90b2
NvbEJpbmRpbmc9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpiaW5kaW
5nczpIVFRQLVBPU1QiDQogICAgQXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVV
JMPQ0KICAgICAgICAiaHR0cHM6Ly94bXBwLmV4YW1wbGUuY29tL1NBTUwvQX
NzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlIj4NCiA8c2FtbDpJc3N1ZXIgeG1sbn
M6c2FtbD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOmFzc2VydGlvbi
I+DQogICAgIGh0dHBzOi8veG1wcC5leGFtcGxlLmNvbQ0KIDwvc2FtbDpJc3
N1ZXI+DQogPHNhbWxwOk5hbWVJRFBvbGljeSB4bWxuczpzYW1scD0idXJuOm
9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIg0KICAgICBGb3JtYX
Q9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpuYW1laWQtZm9ybWF0On
BlcnNpc3RlbnQiDQogICAgIFNQTmFtZVF1YWxpZmllcj0ieG1wcC5leGFtcG
xlLmNvbSIgQWxsb3dDcmVhdGU9InRydWUiIC8+DQogPHNhbWxwOlJlcXVlc3
RlZEF1dGhuQ29udGV4dA0KICAgICB4bWxuczpzYW1scD0idXJuOm9hc2lzOm
5hbWVzOnRjOlNBTUw6Mi4wOnByb3RvY29sIiANCiAgICAgICAgQ29tcGFyaX
Nvbj0iZXhhY3QiPg0KICA8c2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZg0KIC
AgICAgeG1sbnM6c2FtbD0idXJuOm9hc2lzOm5hbWVzOnRjOlNBTUw6Mi4wOm
Fzc2VydGlvbiI+DQogICAgICAgICAgIHVybjpvYXNpczpuYW1lczp0YzpTQU
1MOjIuMDphYzpjbGFzc2VzOlBhc3N3b3JkUHJvdGVjdGVkVHJhbnNwb3J0DQ
ogIDwvc2FtbDpBdXRobkNvbnRleHRDbGFzc1JlZj4NCiA8L3NhbWxwOlJlcX
Vlc3RlZEF1dGhuQ29udGV4dD4gDQo8L3NhbWxwOkF1dGhuUmVxdWVzdD4=

</pre>
<p id="rfc.section.7.1.p.9">Where the decoded SAMLRequest looks like:</p>
<div id="#rfc.figure.12"></div>
<pre>

&lt;samlp:AuthnRequest xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
    ID="_bec424fa5103428909a30ff1e31168327f79474984" Version="2.0"
    IssueInstant="2007-12-10T11:39:34Z" ForceAuthn="false"
    IsPassive="false"
    ProtocolBinding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
    AssertionConsumerServiceURL=
        "https://xmpp.example.com/SAML/AssertionConsumerService"&gt;
 &lt;saml:Issuer xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"&gt;
     https://xmpp.example.com
 &lt;/saml:Issuer&gt;
 &lt;samlp:NameIDPolicy xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
     Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"
     SPNameQualifier="xmpp.example.com" AllowCreate="true" /&gt;
 &lt;samlp:RequestedAuthnContext
     xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" 
        Comparison="exact"&gt;
  &lt;saml:AuthnContextClassRef
      xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"&gt;
      urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport
  &lt;/saml:AuthnContextClassRef&gt;
 &lt;/samlp:RequestedAuthnContext&gt; 
&lt;/samlp:AuthnRequest&gt;

</pre>
<p id="rfc.section.7.1.p.10">Step 5 (alt): Server returns error to client:</p>
<div id="#rfc.figure.13"></div>
<pre>

&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt; 
 &lt;incorrect-encoding/&gt;
&lt;/failure&gt; 
&lt;/stream:stream&gt;

</pre>
<p id="rfc.section.7.1.p.11">Step 6: Client sends a BASE64 encoded empty response to the challenge:</p>
<div id="#rfc.figure.14"></div>
<pre>

&lt;response xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt;
 =
&lt;/response&gt;

</pre>
<p id="rfc.section.7.1.p.12">[ The client now sends the URL to a browser for processing. The browser engages in a normal SAML authentication flow (external to SASL), like redirection to the Identity Provider (https://saml.example.org), the user logs into https://saml.example.org, and agrees to authenticate to xmpp.example.com.  A redirect is passed back to the client browser who sends the AuthN response to the server, containing the subject-identifier as an attribute. If the AuthN response doesn't contain the JID, the server maps the subject-identifier received from the IdP to a JID] </p>
<p id="rfc.section.7.1.p.13">Step 7: Server informs client of successful authentication: </p>
<div id="#rfc.figure.15"></div>
<pre>

&lt;success xmlns='urn:ietf:params:xml:ns:xmpp-sasl'/&gt;

</pre>
<p id="rfc.section.7.1.p.14">Step 7 (alt): Server informs client of failed authentication: </p>
<div id="#rfc.figure.16"></div>
<pre>

&lt;failure xmlns='urn:ietf:params:xml:ns:xmpp-sasl'&gt; 
 &lt;temporary-auth-failure/&gt;
&lt;/failure&gt; 
&lt;/stream:stream&gt;

</pre>
<p id="rfc.section.7.1.p.15">Step 8: Client initiates a new stream to server: </p>
<div id="#rfc.figure.17"></div>
<pre>

&lt;stream:stream xmlns='jabber:client'
xmlns:stream='http://etherx.jabber.org/streams'
to='example.com' version='1.0'&gt;

</pre>
<p id="rfc.section.7.1.p.16">Step 9: Server responds by sending a stream header to client along with any additional features (or an empty features element): </p>
<div id="#rfc.figure.18"></div>
<pre>

&lt;stream:stream xmlns='jabber:client'
xmlns:stream='http://etherx.jabber.org/streams'
id='c2s_345' from='example.com' version='1.0'&gt; 
&lt;stream:features&gt; 
 &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'/&gt; 
 &lt;session xmlns='urn:ietf:params:xml:ns:xmpp-session'/&gt; 
&lt;/stream:features&gt;

</pre>
<p id="rfc.section.7.1.p.17">Step 10: Client binds a resource:</p>
<div id="#rfc.figure.19"></div>
<pre>

   &lt;iq type='set' id='bind_1'&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;resource&gt;someresource&lt;/resource&gt;
     &lt;/bind&gt;
   &lt;/iq&gt;
 
</pre>
<p id="rfc.section.7.1.p.18">Step 11: Server informs client of successful resource binding:</p>
<div id="#rfc.figure.20"></div>
<pre>

   &lt;iq type='result' id='bind_1'&gt;
     &lt;bind xmlns='urn:ietf:params:xml:ns:xmpp-bind'&gt;
       &lt;jid&gt;somenode@example.com/someresource&lt;/jid&gt;
     &lt;/bind&gt;
   &lt;/iq&gt;

</pre>
<p id="rfc.section.7.1.p.19">Please note: line breaks were added to the base64 for clarity.</p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> <a href="#examples-imap" id="examples-imap">IMAP</a>
</h1>
<p id="rfc.section.7.2.p.1">The following describes an IMAP exchange.  Lines beginning with 'S:' indicate data sent by the server, and lines starting with 'C:' indicate data sent by the client.  Long lines are wrapped for readability.</p>
<div id="#rfc.figure.21"></div>
<pre>
S: * OK IMAP4rev1
C: . CAPABILITY
S: * CAPABILITY IMAP4rev1 STARTTLS
S: . OK CAPABILITY Completed
C: . STARTTLS
S: . OK Begin TLS negotiation now
C: . CAPABILITY
S: * CAPABILITY IMAP4rev1 AUTH=SAML20
S: . OK CAPABILITY Completed
C: . AUTHENTICATE SAML20
S: + 
C: biwsZXhhbXBsZS5vcmc
S: + aHR0cHM6Ly9zYW1sLmV4YW1wbGUub3JnL1NBTUwvQnJvd3Nlcj9TQU1MUmVx
dWVzdD1QSE5oYld4d09rRjFkR2h1VW1WeGRXVnpkQ0I0Yld4dWN6cHpZVzFz
Y0QwaWRYSnVPbTloYzJsek9tNWhiV1Z6T25Sak9sTkJUVXc2TWk0d09uQnli
M1J2WTI5c0lnMEtJQ0FnSUVsRVBTSmZZbVZqTkRJMFptRTFNVEF6TkRJNE9U
QTVZVE13Wm1ZeFpUTXhNVFk0TXpJM1pqYzVORGMwT1RnMElpQldaWEp6YVc5
dVBTSXlMakFpRFFvZ0lDQWdTWE56ZFdWSmJuTjBZVzUwUFNJeU1EQTNMVEV5
TFRFd1ZERXhPak01T2pNMFdpSWdSbTl5WTJWQmRYUm9iajBpWm1Gc2MyVWlE
UW9nSUNBZ1NYTlFZWE56YVhabFBTSm1ZV3h6WlNJTkNpQWdJQ0JRY205MGIy
TnZiRUpwYm1ScGJtYzlJblZ5YmpwdllYTnBjenB1WVcxbGN6cDBZenBUUVUx
TU9qSXVNRHBpYVc1a2FXNW5jenBJVkZSUUxWQlBVMVFpRFFvZ0lDQWdRWE56
WlhKMGFXOXVRMjl1YzNWdFpYSlRaWEoyYVdObFZWSk1QUTBLSUNBZ0lDQWdJ
Q0FpYUhSMGNITTZMeTk0YlhCd0xtVjRZVzF3YkdVdVkyOXRMMU5CVFV3dlFY
TnpaWEowYVc5dVEyOXVjM1Z0WlhKVFpYSjJhV05sSWo0TkNpQThjMkZ0YkRw
SmMzTjFaWElnZUcxc2JuTTZjMkZ0YkQwaWRYSnVPbTloYzJsek9tNWhiV1Z6
T25Sak9sTkJUVXc2TWk0d09tRnpjMlZ5ZEdsdmJpSStEUW9nSUNBZ0lHaDBk
SEJ6T2k4dmVHMXdjQzVsZUdGdGNHeGxMbU52YlEwS0lEd3ZjMkZ0YkRwSmMz
TjFaWEkrRFFvZ1BITmhiV3h3T2s1aGJXVkpSRkJ2YkdsamVTQjRiV3h1Y3pw
ellXMXNjRDBpZFhKdU9tOWhjMmx6T201aGJXVnpPblJqT2xOQlRVdzZNaTR3
T25CeWIzUnZZMjlzSWcwS0lDQWdJQ0JHYjNKdFlYUTlJblZ5YmpwdllYTnBj
enB1WVcxbGN6cDBZenBUUVUxTU9qSXVNRHB1WVcxbGFXUXRabTl5YldGME9u
Qmxjbk5wYzNSbGJuUWlEUW9nSUNBZ0lGTlFUbUZ0WlZGMVlXeHBabWxsY2ow
aWVHMXdjQzVsZUdGdGNHeGxMbU52YlNJZ1FXeHNiM2REY21WaGRHVTlJblJ5
ZFdVaUlDOCtEUW9nUEhOaGJXeHdPbEpsY1hWbGMzUmxaRUYxZEdodVEyOXVk
R1Y0ZEEwS0lDQWdJQ0I0Yld4dWN6cHpZVzFzY0QwaWRYSnVPbTloYzJsek9t
NWhiV1Z6T25Sak9sTkJUVXc2TWk0d09uQnliM1J2WTI5c0lpQU5DaUFnSUNB
Z0lDQWdRMjl0Y0dGeWFYTnZiajBpWlhoaFkzUWlQZzBLSUNBOGMyRnRiRHBC
ZFhSb2JrTnZiblJsZUhSRGJHRnpjMUpsWmcwS0lDQWdJQ0FnZUcxc2JuTTZj
MkZ0YkQwaWRYSnVPbTloYzJsek9tNWhiV1Z6T25Sak9sTkJUVXc2TWk0d09t
RnpjMlZ5ZEdsdmJpSStEUW9nb0NBZ0lDQjFjbTQ2YjJGemFYTTZibUZ0WlhN
NmRHTTZVMEZOVERveUxqQTZZV002WTJ4aGMzTmxjenBRWVhOemQyOXlaRkJ5
YjNSbFkzUmxaRlJ5WVc1emNHOXlkQTBLSUNBOEwzTmhiV3c2UVhWMGFHNURi
MjUwWlhoMFEyeGhjM05TWldZK0RRb2dQQzl6WVcxc2NEcFNaWEYxWlhOMFpX
UkJkWFJvYmtOdmJuUmxlSFErSUEwS1BDOXpZVzFzY0RwQmRYUm9ibEpsY1hW
bGMzUSs=
C: 
S: . OK Success (tls protection)
</pre>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Security Considerations</h1>
<p id="rfc.section.8.p.1">This section will address only security considerations associated with the use of SAML with SASL applications.  For considerations relating to SAML in general, the reader is referred to the SAML specification and to other literature.  Similarly, for general SASL Security Considerations, the reader is referred to that specification.  </p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> Man in the middle and Tunneling Attacks</h1>
<p id="rfc.section.8.1.p.1">This mechanism is vulnerable to man in the middle and tunneling attacks unless a client always verify the server identity before proceeding with authentication.  Typically TLS is used to provide a secure channel with server authentication.  </p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> Binding SAML subject identifiers to Authorization Identities</h1>
<p id="rfc.section.8.2.p.1">As specified in <a href="#RFC4422">[RFC4422]</a>, the server is responsible for binding credentials to a specific authorization identity.  It is therefore necessary that only specific trusted IdPs be allowed. This is typical part of SAML trust establishment between RP's and IdP.  </p>
<h1 id="rfc.section.8.3">
<a href="#rfc.section.8.3">8.3.</a> User Privacy</h1>
<p id="rfc.section.8.3.p.1">The IdP is aware of each RP that a user logs into.  There is nothing in the protocol to hide this information from the IdP.  It is not a requirement to track the visits, but there is nothing that prohibits the collection of information.  SASL servers should be aware that SAML IdPs will track - to some extent - user access to their services.  </p>
<h1 id="rfc.section.8.4">
<a href="#rfc.section.8.4">8.4.</a> Collusion between RPs</h1>
<p id="rfc.section.8.4.p.1">It is possible for RPs to link data that they have collected on you.  By using the same identifier to log into every RP, collusion between RPs is possible.  In SAML, targeted identity was introduced.  Targeted identity allows the IdP to transform the identifier the user typed in to an opaque identifier.  This way the RP would never see the actual user identifier, but a randomly generated identifier.  This is an option the user has to understand and decide to use if the IdP is supporting it.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> IANA Considerations</h1>
<p id="rfc.section.9.p.1">The IANA is requested to register the following SASL profile: </p>
<p></p>
<p id="rfc.section.9.p.3">SASL mechanism profile: SAML20</p>
<p id="rfc.section.9.p.4">Security Considerations: See this document</p>
<p id="rfc.section.9.p.5">Published Specification: See this document</p>
<p id="rfc.section.9.p.6">For further information: Contact the authors of this document.</p>
<p id="rfc.section.9.p.7">Owner/Change controller: the IETF</p>
<p id="rfc.section.9.p.8">Note: None</p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1035">[RFC1035]</b></td>
<td class="top">
<a title="USC/ISI">Mockapetris, P.</a>, "<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>", STD 13, RFC 1035, November 1987.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2743">[RFC2743]</b></td>
<td class="top">
<a href="mailto:jlinn@rsasecurity.com" title="RSA Laboratories">Linn, J.</a>, "<a href="http://tools.ietf.org/html/rfc2743">Generic Security Service Application Program Interface Version 2, Update 1</a>", RFC 2743, January 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3986">[RFC3986]</b></td>
<td class="top">
<a href="mailto:timbl@w3.org" title="World Wide Web Consortium">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com" title="Day Software">Fielding, R.</a> and <a href="mailto:LMM@acm.org" title="Adobe Systems Incorporated">L. Masinter</a>, "<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4422">[RFC4422]</b></td>
<td class="top">
<a>Melnikov, A.</a> and <a>K. Zeilenga</a>, "<a href="http://tools.ietf.org/html/rfc4422">Simple Authentication and Security Layer (SASL)</a>", RFC 4422, June 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4648">[RFC4648]</b></td>
<td class="top">
<a>Josefsson, S.</a>, "<a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>", RFC 4648, October 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5801">[RFC5801]</b></td>
<td class="top">
<a>Josefsson, S.</a> and <a>N. Williams</a>, "<a href="http://tools.ietf.org/html/rfc5801">Using Generic Security Service Application Program Interface (GSS-API) Mechanisms in Simple Authentication and Security Layer (SASL): The GS2 Mechanism Family</a>", RFC 5801, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="OASIS.saml-core-2.0-os">[OASIS.saml-core-2.0-os]</b></td>
<td class="top">
<a href="mailto:cantor.2@osu.edu" title="Internet2">Cantor, S.</a>, <a href="mailto:John.Kemp@nokia.com" title="Nokia">Kemp, J.</a>, <a href="mailto:rphilpott@rsasecurity.com" title="RSA Security">Philpott, R.</a> and <a href="mailto:eve.maler@sun.com" title="Sun Microsystems">E. Maler</a>, "<a>Assertions and Protocol for the OASIS Security Assertion Markup Language (SAML) V2.0</a>", OASIS Standard saml-core-2.0-os, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="OASIS.saml-bindings-2.0-os">[OASIS.saml-bindings-2.0-os]</b></td>
<td class="top">
<a href="mailto:cantor.2@osu.edu" title="Internet2">Cantor, S.</a>, <a href="mailto:Frederick.Hirsch@nokia.com" title="Nokia">Hirsch, F.</a>, <a href="mailto:John.Kemp@nokia.com" title="Nokia">Kemp, J.</a>, <a href="mailto:rphilpott@rsasecurity.com" title="RSA Security">Philpott, R.</a> and <a href="mailto:eve.maler@sun.com" title="Sun Microsystems">E. Maler</a>, "<a>Bindings for the OASIS Security Assertion Markup Language (SAML) V2.0</a>", OASIS Standard saml-bindings-2.0-os, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="OASIS.saml-profiles-2.0-os">[OASIS.saml-profiles-2.0-os]</b></td>
<td class="top">
<a title="Altos Origin">Hughes, J.</a>, <a href="mailto:cantor.2@osu.edu" title="Internet2">Cantor, S.</a>, <a href="mailto:Jeff.Hodges@neustar.biz" title="NeuStar">Hodges, J.</a>, <a href="mailto:Frederick.Hirsch@nokia.com" title="Nokia">Hirsch, F.</a>, <a href="mailto:pmishra@principalidentity.com" title="Principal Identity">Mishra, P.</a>, <a href="mailto:rphilpott@rsasecurity.com" title="RSA Security">Philpott, R.</a> and <a href="mailto:eve.maler@sun.com" title="Sun Microsystems">E. Maler</a>, "<a>Profiles for the OASIS Security Assertion Markup Language (SAML) V2.0</a>", OASIS Standard OASIS.saml-profiles-2.0-os, March 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC3501">[RFC3501]</b></td>
<td class="top">
<a>Crispin, M.</a>, "<a href="http://tools.ietf.org/html/rfc3501">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>", RFC 3501, March 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3920">[RFC3920]</b></td>
<td class="top">
<a href="mailto:stpeter@jabber.org" title="Jabber Software Foundation">Saint-Andre, P.</a>, "<a href="http://tools.ietf.org/html/rfc3920">Extensible Messaging and Presence Protocol (XMPP): Core</a>", RFC 3920, October 2004.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Acknowledgments</h1>
<p id="rfc.section.Appendix A.p.1">The authors would like to thank Scott Cantor, Joe Hildebrand, Josh Howlett, Leif Johansson, Diego Lopez, Hank Mauldin, RL 'Bob' Morgan, Stefan Plug and Hannes Tschofenig for their review and contributions.  </p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> Changes</h1>
<p id="rfc.section.Appendix B.p.1">This section to be removed prior to publication.</p>
<p></p>

<ul>
<li>02 Changed IdP URI to domain per Joe Hildebrand, fixed some typos</li>
<li>00 WG -00 draft.  Updates GSS-API section, some fixes per Scott Cantor</li>
<li>01 Added authorization identity, added GSS-API specifics, added client supplied IdP</li>
<li>00 Initial Revision. </li>
</ul>

<p> </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Klaas Wierenga</span> 
	  <span class="n hidden">
		<span class="family-name">Wierenga</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span>Haarlerbergweg 13-19</span>

	  <span class="vcardline">
		<span class="locality">Amsterdam</span>,  
		<span class="region">Noord-Holland</span> 
		<span class="code">1101 CH</span>
	  </span>
	  <span class="country-name vcardline">Netherlands</span>
	</span>
	<span class="vcardline">Phone: +31 20 357 1752</span>

<span class="vcardline">EMail: <a href="mailto:klaas@cisco.com">klaas@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Eliot Lear</span> 
	  <span class="n hidden">
		<span class="family-name">Lear</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems GmbH</span>
	<span class="adr">
	  <span>Richtistrasse 7</span>

	  <span class="vcardline">
		<span class="locality">Wallisellen</span>,  
		<span class="region">ZH</span> 
		<span class="code">CH-8304</span>
	  </span>
	  <span class="country-name vcardline">Switzerland</span>
	</span>
	<span class="vcardline">Phone: +41 44 878 9200</span>

<span class="vcardline">EMail: <a href="mailto:lear@cisco.com">lear@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Simon Josefsson</span> 
	  <span class="n hidden">
		<span class="family-name">Josefsson</span>
	  </span>
	</span>
	<span class="org vcardline">SJD AB</span>
	<span class="adr">
	  <span>Hagagatan 24</span>

	  <span class="vcardline">
		<span class="locality">Stockholm</span>,  
		<span class="region"></span>
		<span class="code">113 47</span>
	  </span>
	  <span class="country-name vcardline">SE</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:simon@josefsson.org">simon@josefsson.org</a></span>

<span class="vcardline">URI: <a href="http://josefsson.org/">http://josefsson.org/</a></span>

  </address>
</div>

</body>
</html>