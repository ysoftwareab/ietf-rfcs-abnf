<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Email Policy Service Trust Processing</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Email Policy Service Trust Processing">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">J. Schaad</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Soaring Hawk Consulting</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">January 21, 2011</td></tr>
<tr><td class="header">Expires: July 25, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Email Policy Service Trust Processing<br />draft-schaad-eps-trust-00</h1>

<h3>Abstract</h3>

<p>Write Me
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on July 25, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
XML Nomenclature and Name Spaces<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Requirements Terminology<br />
<a href="#anchor4">2.</a>&nbsp;
Components<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.1.</a>&nbsp;
WS-Trust 1.3<br />
<a href="#model">3.</a>&nbsp;
Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.1.</a>&nbsp;
Sender Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.2.</a>&nbsp;
Recieving Agent Processing<br />
<a href="#getPolicy">4.</a>&nbsp;
Initial Token and Policy Acquisition<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getPolicy-Request">4.1.</a>&nbsp;
Request Policy Information<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#getPolicy-Response">4.2.</a>&nbsp;
Request Policy Information Response<br />
<a href="#sendMessage">5.</a>&nbsp;
Sending A Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sendMessage-Request">5.1.</a>&nbsp;
Send Message Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sendMessage-Response">5.2.</a>&nbsp;
Send Message Response<br />
<a href="#readMessage">6.</a>&nbsp;
Decoding A Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#readMessage-Request">6.1.</a>&nbsp;
Requesting Message Key<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#readMessage-Response">6.2.</a>&nbsp;
Requesting Message Key Response<br />
<a href="#anchor8">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor9">8.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
Normative References<br />
<a href="#anchor11">Appendix&nbsp;A.</a>&nbsp;
XML Schema<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
XML Nomenclature and Name Spaces</h3>

<p>The following name spaces are used in this document:
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Prefix</th><th align="left">Namespace</th><th align="left">Specification(s)</th></tr>
<tr>
<td align="left">eps</td>
<td align="left">http://ietf.org/2011/plasma/</td>
<td align="left">This Specification</td>
</tr>
<tr>
<td align="left">S11</td>
<td align="left">http://schemas.xmlsoap.org/soap/envelope/</td>
<td align="left"><a class='info' href='#SOAP11'>[SOAP11]<span> (</span><span class='info'>Box, D., Ehnebuske, D., Kakivaya, G., Layman, A., Mendelsohn, N., Nielsen, H., Thatte, S., and D. Winer, &ldquo;Simple Object Access Protocol (SOAP) 1.1,&rdquo; May&nbsp;2000.</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">S12</td>
<td align="left"> http://www.w3.org/2003/05/soap-envelope</td>
<td align="left"><a class='info' href='#SOAP12'>[SOAP12]<span> (</span><span class='info'>Lafon, Y., Gudgin, M., Hadley, M., Moreau, J., Mendelsohn, N., Karmarkar, A., and H. Nielsen, &ldquo;SOAP Version 1.2 Part 1: Messaging Framework (Second Edition),&rdquo; April&nbsp;2007.</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">wst</td>
<td align="left"> http://docs.oasis-open.org/ws-sx/ws-trust/200512</td>
<td align="left"><a class='info' href='#WS-TRUST'>[WS&#8209;TRUST]<span> (</span><span class='info'>Lawrence, K., Kaler, C., Nadalin, A., Goodner, M., Gudgin, M., Barbir, A., and H. Granqvist, &ldquo;WS-Trust 1.3,&rdquo; March&nbsp;2007.</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">wsu</td>
<td align="left"> http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd</td>
<td align="left"> [WS-Security]</td>
</tr>
<tr>
<td align="left">wsse</td>
<td align="left"> http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd</td>
<td align="left"> [WS-Security]</td>
</tr>
<tr>
<td align="left">wsse11</td>
<td align="left"> http://docs.oasis-open.org/wss/oasis-wss-wsecurity-secext-1.1.xsd</td>
<td align="left"> [WS-Security]</td>
</tr>
<tr>
<td align="left">ds</td>
<td align="left"> http://www.w3.org/2000/09/xmldsig#</td>
<td align="left"> [XML-Signature]</td>
</tr>
<tr>
<td align="left">xenc</td>
<td align="left"> http://www.w3.org/2001/04/xmlenc#</td>
<td align="left"> [XML-Encrypt]</td>
</tr>
<tr>
<td align="left">wsp</td>
<td align="left"> http://schemas.xmlsoap.org/ws/2004/09/policy</td>
<td align="left"> [WS-Policy]</td>
</tr>
<tr>
<td align="left">wsa</td>
<td align="left"> http://www.w3.org/2005/08/addressing</td>
<td align="left"> [WS-Addressing]</td>
</tr>
<tr>
<td align="left">xs</td>
<td align="left"> http://www.w3.org/2001/XMLSchema</td>
<td align="left"> [XML-Schema1][XML-Schema2]</td>
</tr>
</table>
<br clear="all" />

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Requirements Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Components</h3>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
WS-Trust 1.3</h3>

<p>We use WS-Trust as the basis for the protocol presented in this document.  WS-Trust is a secure messaging protocol used for security token exchange to enable the issuance and dissemination of credentials within different trust domains.  WS-Trust 1.3 is specified by OASIS in <a class='info' href='#WS-TRUST'>[WS&#8209;TRUST]<span> (</span><span class='info'>Lawrence, K., Kaler, C., Nadalin, A., Goodner, M., Gudgin, M., Barbir, A., and H. Granqvist, &ldquo;WS-Trust 1.3,&rdquo; March&nbsp;2007.</span><span>)</span></a>.  WS-Trust is built on SOAP (see <a class='info' href='#SOAP12'>[SOAP12]<span> (</span><span class='info'>Lafon, Y., Gudgin, M., Hadley, M., Moreau, J., Mendelsohn, N., Karmarkar, A., and H. Nielsen, &ldquo;SOAP Version 1.2 Part 1: Messaging Framework (Second Edition),&rdquo; April&nbsp;2007.</span><span>)</span></a>) to provide a messaging structure.
</p>
<p>Implementers of this protocol MUST implement the HTTP binding.
</p>
<p>Implementers of this protocol MUST implement SOAP 1.2.  Support for SOAP 1.1 <a class='info' href='#SOAP11'>[SOAP11]<span> (</span><span class='info'>Box, D., Ehnebuske, D., Kakivaya, G., Layman, A., Mendelsohn, N., Nielsen, H., Thatte, S., and D. Winer, &ldquo;Simple Object Access Protocol (SOAP) 1.1,&rdquo; May&nbsp;2000.</span><span>)</span></a> is OPTIONAL.
</p>
<a name="model"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Model</h3>

<p>To be supplied from the problem statement document.
</p><br /><hr class="insert" />
<a name="fig1"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>

        (1)(3)     +----------+
      +-----------&gt;|Sending   |&lt;------------+
      |            |Agent     |             |
 (2)  v            +----------+             v
+----------+           ^               +---------+
|Email     |           |               |Mail     |
|Policy    |&lt;----------+               |Transfer |
|Service   |                           |Agent    |
+----------+                           +---------+
 ()   ^            +----------+             ^
      |            |Receiving |             |
      +-----------&gt;|Agent     |&lt;------------+
        ()()       +----------+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Message Access Control Actors&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>List the boxes above and give some info about them.
      </p>
<blockquote class="text"><dl>
<dt>Email Policy Service</dt>
<dd> is the gateway controller for accessing a message.  Although it is represented as a single box in the diagram, there is no reason for it to be in practice.  Each of the three protocols could be talking to different instances of a common system.  This would allow for a server to operated by Company A, but be placed in Company B's network thus reducing the traffic sent between the two networks.
</dd>
<dt>Mail Transfer Agent</dt>
<dd> is the entity or set of entities that is used to move the message from the sender to the receiver.  Although this document describes the process in terms of mail, any method can be used to transfer the message.
</dd>
<dt>Receiving Agent</dt>
<dd> is the entity that consumes the message.
</dd>
<dt>Sending Agent</dt>
<dd> is the entity that originates the message.
</dd>
</dl></blockquote><p>
      
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Sender Processing</h3>

<p>We layout the general steps that need to be taken by the sender of an EPS message.  The numbers in the steps below refer to the numbers in the upper half of <a class='info' href='#fig1'>Figure&nbsp;1<span> (</span><span class='info'>Message Access Control Actors</span><span>)</span></a>.  A more detailed description of the processing is found in <a class='info' href='#getPolicy'>Section&nbsp;4<span> (</span><span class='info'>Initial Token and Policy Acquisition</span><span>)</span></a> for obtaining the security policies that can be applied to a messages and <a class='info' href='#sendMessage'>Section&nbsp;5<span> (</span><span class='info'>Sending A Message</span><span>)</span></a> for sending a message.  
</p>
<p>
          </p>
<ol class="text">
<li>The Sending Agent sends a message to one or more Email Policy Services in order to obtain the set of policies that it can apply to a message along with a security token to be used in proving the authorization.  Details of the message send can be found in <a class='info' href='#getPolicy-Request'>Section&nbsp;4.1<span> (</span><span class='info'>Request Policy Information</span><span>)</span></a>.
</li>
<li>The Email Policy Service examines the set of policies that it understands and checks to see if the requester is authorized to send messages with the policy.
</li>
<li>The Email Policy Service returns the set of policies and an security token to the Sending Agent.  Details of the message sent can be found in <a class='info' href='#getPolicy-Response'>Section&nbsp;4.2<span> (</span><span class='info'>Request Policy Information Response</span><span>)</span></a>.
</li>
<li>The Sending Agent selects the Email Policy(s) to be applied to the message, along with the set of recipients for the message.
</li>
<li>The Sending Agent relays the selected information to the Email Policy Service along with the security token.  Details of this message can be found in <a class='info' href='#sendMessage-Request'>Section&nbsp;5.1<span> (</span><span class='info'>Send Message Request</span><span>)</span></a>.
</li>
<li>The Email Policy Service creates the recipient info attribute as defined in <a class='info' href='#EPS-ASN'>[EPS&#8209;ASN]<span> (</span><span class='info'>Schaad, J., &ldquo;Email Policy Service ASN.1 Processing,&rdquo; Jan&nbsp;2011.</span><span>)</span></a>.
</li>
<li>The Email Policy Service returns the created attribute to the Sending Agent.  Details of this message can be found in <a class='info' href='#sendMessage-Response'>Section&nbsp;5.2<span> (</span><span class='info'>Send Message Response</span><span>)</span></a>.
</li>
<li>The Sending Agent composes the CMS EnvelopedData content type placing the returned attribute into a KEKRecipientInfo structure and then send the message to the Mail Transport Agent.
</li>
</ol><p>
        
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Recieving Agent Processing</h3>

<p>We layout the general steps that need to be taken by the sender of an EPS message.  The numbers in the steps below refer to the numbers in the lower half of <a class='info' href='#fig1'>Figure&nbsp;1<span> (</span><span class='info'>Message Access Control Actors</span><span>)</span></a>.  A more detailed description of the processing is found in <a class='info' href='#readMessage'>Section&nbsp;6<span> (</span><span class='info'>Decoding A Message</span><span>)</span></a>.
</p>
<p>
          </p>
<ol class="text">
<li>The Receiving Agent obtains the message from the Mail Transport Agent.
</li>
<li>The Receiving Agent starts to decode the message and in that process locates an EvelopedData content type which has a KEKRecipientInfo structure with a XXXX attribute.
</li>
<li>The Receiving Agent processes the SignedData content of the XXXX attribute to determine that communicating with it falls within accepted policy.
</li>
<li>The Receiving Agent transmits the content of the XXXX attribute to the referenced Email Policy Service.  The details of this message can be found in <a class='info' href='#readMessage-Request'>Section&nbsp;6.1<span> (</span><span class='info'>Requesting Message Key</span><span>)</span></a>.
</li>
<li>The Email Policy Service decrypts the content of the message and applies the policy to the credentials provided by the Receiving Agent.
</li>
<li>If the policy passes, the Email Policy Service returns the appropriate key or RecipientInfo structure to the Receiving Agent.  Details of this message can be found in <a class='info' href='#readMessage-Response'>Section&nbsp;6.2<span> (</span><span class='info'>Requesting Message Key Response</span><span>)</span></a>.
</li>
<li>The Receiving Agent proceeds to decrypt the message and perform normal processing.
</li>
</ol><p>
        
</p>
<a name="getPolicy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Initial Token and Policy Acquisition</h3>

<p>The first step in the process is for the sending agent to acquire the set of policies that it is permitted to use in labeling a message.  This is done by a request and response.  For this purpose we define two new uri values to be used in the wst:RequestType field:
        </p>
<blockquote class="text"><dl>
<dt>urn:ietf:params:ns:eps-xml:RequestSendToken</dt>
<dd> is used to identify a request to receive a set of security policies that can be used along with a security token to identify the sending agent when sending a message.
</dd>
</dl></blockquote><p>
      
</p>
<p>It is assumed that the Email Policy Server will do an exhaustive set of tests to check which security policies are usable by the sending agent in order to label messages.  As this is going to be a computationally intensive operation, the process is expected to be done infrequently compared to sending messages.  The data and security token returned is therefore expected to be good for a period of time.  In situations where changes to privileges change and it is important that the system correctly enforce them, then a subsequence check on just the label presented at the time the mail message is sent.
</p>
<a name="getPolicy-Request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Request Policy Information</h3>

<p>Send a wst:RequestSecurityToken message to the Email Policy Service.  The request will contain at least the following elements:
          </p>
<blockquote class="text">
<p>A wst:RequestType containing a urn:ietf:params:ns:eps-xml:#RequestSendToken URI MUST be included.
</p>
</blockquote><p>
        
</p>
<p>An example of a message requesting the set of policy information is:
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;s12:Envelope&gt;
  &lt;s12:Body&gt;
    &lt;wst:RequestSecurityToken&gt;
      &lt;wst:RequestType&gt;
      urn:ietf:params:xml:ns:eps-xml:#RequestSendToken
      &lt;/wst:RequestType&gt;
    &lt;/wst:RequestSecurityToken&gt;
  &lt;/s12:Body&gt;
&lt;/s12:Envelope&gt;
</pre></div><p>


          In this example the identity information of the requester is implicit from the transport protocol used.
</p>
<a name="getPolicy-Response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Request Policy Information Response</h3>

<p>Receive a wst:RequestSecurityTokenResponse message with the following elements:
          </p>
<blockquote class="text">
<p>A wst:RequestedSecruityToken element containing the security token MUST be included.  The format of the security token is not specified and is implementation specific, it is not expected that .  Examples of items that could be used as security tokens are SAML statements, encrypted record numbers in a server database. 
</p>
<p>A eps:PolicySet containing the set of policies that the server has been ascertained are acceptable for the querier to use in labeling email messages MUST be included.
</p>
<p>A wst:Lifetime giving the life time of the token SHOULD be included.  It is not expected that this should be determinable from the token itself and thus must be independently provided.  There is no guarantee that the token will be good during the lifetime as it make get revoked due to changes in credentials, however the client is permitted to act as if it where.  The token provided may be used for duration.  If this element is absent, it should be assumed that the token is either a one time token or of limited duration.
</p>
</blockquote><p>
        
</p>
<p>An example of a message returning the set of policy information is:
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;s12:Envelope&gt;
  &lt;s12:Body&gt;
    &lt;wst:RequestSecurityTokenResponse&gt;
      &lt;wst:RequestedSecurityToken&gt;
        &lt;me:CustomToken&gt;ABCDEFGHIJKLMN
        &lt;/me:CustomToken&gt;
      &lt;/wst:RequestedSecurityToken&gt;
      &lt;wst:RequestedProofToken&gt;
        &lt;wst:BinarySecret&gt;PGRGFCDE&lt;/wst:BinarySecret&gt;
      &lt;/wst:RequestedProofToken&gt;
      &lt;eps:PolicySet&gt;
        &lt;eps:Policy&gt;
          &lt;eps:Name&gt;Policy Name #1&lt;/eps:Name&gt;
          &lt;eps:Identifier&gt;
            http://this.is.a.com/policyX
          &lt;/eps:Identifier&gt;
          &lt;eps:ReferencePoint&gt;
            http://Point.com/serverName
          &lt;/eps:ReferencePoint&gt;
          &lt;eps:ReferencePoint&gt;
        http://ietf.org/email-policy-servers/ad-hoc/PolicyServer
          &lt;/eps:ReferencePoint&gt;
          &lt;eps:Options&gt;
            &lt;eps:Option name="Category"&gt;
              &lt;eps:OptionValue value="1"&gt;Non-classified
              &lt;/eps:OptionValue&gt;
              &lt;eps:OptionValue value="2"&gt;Restricted
              &lt;/eps:OptionValue&gt;
              &lt;eps:OptionValue value="3"&gt;Classified
              &lt;/eps:OptionValue&gt;
              &lt;eps:OptionValue value="4"&gt;Don't Read Me
              &lt;/eps:OptionValue&gt;
            &lt;/eps:Option&gt;
          &lt;/eps:Options&gt;
        &lt;/eps:Policy&gt;
        &lt;eps:Policy&gt;
          &lt;eps:Name&gt;Ad Hoc Corperate Policy&lt;/eps:Name&gt;
          &lt;eps:Identifier&gt;
            http://ietf.org/email-policies/ad-hoc
          &lt;/eps:Identifier&gt;
          &lt;eps:ReferencePoint&gt;
        http://ietf.org/email-policies/ad-hoc/PolicyServer
          &lt;/eps:ReferencePoint&gt;
        &lt;/eps:Policy&gt;
        &lt;eps:Policy&gt;
          &lt;eps:Name&gt;IETF Basic Policy 1&lt;/eps:Name&gt;
          &lt;eps:Identifier&gt;
            http://ietf.org/email-policies/basic-1
          &lt;/eps:Identifier&gt;
          &lt;eps:ReferencePoint&gt;
        http://ietf.org/email-policy-servers/ad-hoc/PolicyServer
          &lt;/eps:ReferencePoint&gt;
          &lt;eps:AllowNameList value="yes"/&gt;
        &lt;/eps:Policy&gt;
      &lt;/eps:PolicySet&gt;
    &lt;/wst:RequestSecurityTokenResponse&gt;
  &lt;/s12:Body&gt;
&lt;/s12:Envelope&gt;
</pre></div><p>


          In this example, the Email Policy Service is returning three different policies that can be used along with a security token and a key to be used with the token when sending a message.
        
</p>
<a name="sendMessage"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Sending A Message</h3>

<p>When the sending agent is ready to build the list of recipient info structures, it builds a request message containing the label, the key encryption key and other information required for decryption to send to the Email Policy Service.  It will then get back a response containing a CMS SignedData object to be included in a KEKRecipientInfo object.
</p>
<p>To identify this operation we have defined a new uri urn:ietf:params:ns:eps-xml:RequestSendToken.
</p>
<a name="sendMessage-Request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Send Message Request</h3>

<p>The process we are looking at is:
          Send a wst:RequestSecurityToken to the Email Policy Service. The request MUST contain at least the following elements:
          </p>
<blockquote class="text">
<p>A wst:RequestType containing a urn:ietf:params:ns:eps-xml:RequestSendToken URI.
</p>
<p>Put in the previously assigned tokens as if you were doing a token renewal.
</p>
<p>An eps:SendMessage as defined in this document.
</p>
</blockquote><p>
        
</p>
<p>An example of a message returning the set of policy information is:
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;s12:Envelope&gt;
  &lt;s12:Body&gt;
    &lt;wst:RequestSecurityToken&gt;
      &lt;wst:RequestType&gt;
        urn:ietf:params:ns:eps-xml:RequestSendToken
      &lt;/wst:RequestType&gt;
      &lt;eps:SendMessageRequest&gt;
        &lt;eps:RecipientData&gt;
          &lt;eps:CompoundLabel action="or"&gt;
            &lt;eps:Label
              name="http://ietf.org/policies/basic1"&gt;
              &lt;eps:addressList&gt;
                jimsch@example.com;
                patrick@example.com;
                paul@example.com
            &lt;/eps:addressList&gt;&lt;/eps:Label&gt;
            &lt;eps:CompoundLabel action="and"&gt;
              &lt;eps:Label
        name="http://this.is.a.com/policyX?Category=4"/&gt;
              &lt;eps:Label name="http://ietf.org/policies"/&gt;
            &lt;/eps:CompoundLabel&gt;
          &lt;/eps:CompoundLabel&gt;
          &lt;eps:Recipient name="trevor@microsoft.com"&gt;
            &lt;eps:Key&gt;
              &lt;eps:Identifier&gt;....&lt;/eps:Identifier&gt;
              &lt;eps:RecipientInfo&gt;....&lt;/eps:RecipientInfo&gt;
            &lt;/eps:Key&gt;
            &lt;eps:Key&gt;
              &lt;eps:Identifier&gt;....&lt;/eps:Identifier&gt;
              &lt;eps:RecipientInfo&gt;....&lt;/eps:RecipientInfo&gt;
            &lt;/eps:Key&gt;
          &lt;/eps:Recipient&gt;
          &lt;eps:DefaultRecipient&gt;
            &lt;eps:Identifier&gt;....&lt;/eps:Identifier&gt;
            &lt;wst:BinarySecret&gt;&lt;/wst:BinarySecret&gt;
          &lt;/eps:DefaultRecipient&gt;
        &lt;/eps:RecipientData&gt;
      &lt;/eps:SendMessageRequest&gt;
    &lt;/wst:RequestSecurityToken&gt;
  &lt;/s12:Body&gt;
&lt;/s12:Envelope&gt;
</pre></div><p>


        
</p>
<a name="sendMessage-Response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Send Message Response</h3>

<p>Receive a wst:RequestSecurityTokenResponse from the Email Policy Service.  The response MUST contain at least the following elements:
          </p>
<blockquote class="text">
<p>An eps:SendMessageResponse as defined in this document.
</p>
</blockquote><p>
        
</p>
<p>An example of a message returning the set of policy information is:
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;s12:Envelope&gt;
  &lt;s12:Body&gt;
    &lt;wst:RequestSecurityTokenResponse&gt;
      &lt;eps:SignedDataBlob/&gt;
    &lt;/wst:RequestSecurityTokenResponse&gt;
  &lt;/s12:Body&gt;
&lt;/s12:Envelope&gt;
</pre></div><p>


        
</p>
<a name="readMessage"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Decoding A Message</h3>

<p>When the receiving agent is ready to decrypt the message, it identifies that there is a KEKRecipientInfo object which contains a key attribute identified by id-keyatt-eps-token.  It validates that communicating with the Email Policy Service is within local policy and then sends a request to the service to obtain the encryption key for the message.
</p>
<p>To identify this operation we have defined a new uri urn:ietf:params:ns:eps-xml:RequestReadToken.
</p>
<p>In some cases the recipient of a message is not authorized to use the same set of labels for sending a message.  For this purpose a token can be returned in the message along with the key so that recipient of the can reply to the message using the same set of security labels.
</p>
<a name="readMessage-Request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Requesting Message Key</h3>

<p>Send a wst:RequestSecurityToken message to the EMail Policy Server.  The request MUST contain at least the following elements:
          </p>
<blockquote class="text">
<p>A wst:RequestType containing a urn:ietf:params:ns:eps-xml:RequestReadToken URI.
</p>
<p>A eps:ReadMessageRequest defined in this document.
</p>
</blockquote><p>
        
</p>
<p>An example of a message returning the set of policy information is:
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;s12:Envelope&gt;
  &lt;s12:Body&gt;
    &lt;wst:RequestSecurityToken&gt;
      &lt;wst:RequestType&gt;
        urn:ietf:params:ns:eps-xml:RequestReadToken
      &lt;/wst:RequestType&gt;
      &lt;eps:SignedDataBlob/&gt;
    &lt;/wst:RequestSecurityToken&gt;
  &lt;/s12:Body&gt;
&lt;/s12:Envelope&gt;
</pre></div><p>


        
</p>
<a name="readMessage-Response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Requesting Message Key Response</h3>

<p>Receive a wst:RequestSecurityTokenResponse message from the Email Policy Server.  The response contains the following elements:
          </p>
<blockquote class="text">
<p>An eps:ReadMessageResponse.
</p>
</blockquote><p>
        
</p>
<p>An example of a message returning the set of policy information is:
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;s12:Envelope&gt;
  &lt;s12:Body&gt;
    &lt;wst:RequestSecurityTokenResponse&gt;
      &lt;wst:RequestedSecurityToken&gt;
        &lt;me:CustomToken&gt;....&lt;/me:CustomToken&gt;
      &lt;/wst:RequestedSecurityToken&gt;
      &lt;wst:RequestedProofToken&gt;
        &lt;wst:BinarySecret&gt;&lt;/wst:BinarySecret&gt;
      &lt;/wst:RequestedProofToken&gt;
      &lt;eps:Key&gt;...&lt;/eps:Key&gt;
      &lt;eps:Key&gt;...&lt;/eps:Key&gt;
      &lt;eps:PolicySet&gt;....&lt;/eps:PolicySet&gt;
    &lt;/wst:RequestSecurityTokenResponse&gt;
  &lt;/s12:Body&gt;
&lt;/s12:Envelope&gt;
</pre></div><p>


        
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>To be supplied after we have a better idea of what the document looks like.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>We should have at least one name space to be registered.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="EPS-ASN">[EPS-ASN]</a></td>
<td class="author-text">Schaad, J., &ldquo;Email Policy Service ASN.1 Processing,&rdquo; Work In Pgoress&nbsp;draft-eps-smime-00, Jan&nbsp;2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="SOAP11">[SOAP11]</a></td>
<td class="author-text">Box, D., Ehnebuske, D., Kakivaya, G., Layman, A., Mendelsohn, N., Nielsen, H., Thatte, S., and D. Winer, &ldquo;<a href="http://www.w3.org/TR/2000/NOTE-SOAP-20000508">Simple Object Access Protocol (SOAP) 1.1</a>,&rdquo; W3C NOTE&nbsp;NOTE-SOAP-20000508, May&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="SOAP12">[SOAP12]</a></td>
<td class="author-text">Lafon, Y., Gudgin, M., Hadley, M., Moreau, J., Mendelsohn, N., Karmarkar, A., and H. Nielsen, &ldquo;<a href="http://www.w3.org/TR/2007/REC-soap12-part1-20070427">SOAP Version 1.2 Part 1: Messaging Framework (Second Edition)</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-soap12-part1-20070427, April&nbsp;2007 (<a href="http://www.w3.org/TR/2007/REC-soap12-part1-20070427">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="WS-TRUST">[WS-TRUST]</a></td>
<td class="author-text">Lawrence, K., Kaler, C., Nadalin, A., Goodner, M., Gudgin, M., Barbir, A., and H. Granqvist, &ldquo;<a href="http://docs.oasis-open.org/ws-sx/ws-trust/200512/ws-trust-1.3-os.html">WS-Trust 1.3</a>,&rdquo; OASIS Standard&nbsp;ws-trust-200512, March&nbsp;2007 (<a href="http://docs.oasis-open.org/ws-sx/ws-trust/200512/ws-trust-1.3-os.html">HTML</a>).</td></tr>
</table>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
XML Schema</h3>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jim Schaad</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Soaring Hawk Consulting</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ietf@augustcellars.com">ietf@augustcellars.com</a></td></tr>
</table>
</body></html>
