<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>(strong) AuCPace, an augmented PAKE</title>
<meta content="Bjoern Haase" name="author">
<meta content="
       This document describes AuCPace which is an augmented PAKE protocol for two
      parties. 
      The protocol was tailored for constrained devices and smooth migration for compatibility
      with legacy user credential databases. It is designed to be 
      compatible with any group of both prime- and non-prime order 
      and comes with  a security proof providing composability guarantees.
       
    " name="description">
<meta content="xml2rfc 3.12.0" name="generator">
<meta content="draft-haase-aucpace-05" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.7.1
    pycountry 22.1.10
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-haase-aucpace-05-ppx0jsd1.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">(strong) AuCPace, an augmented PAKE</td>
<td class="right">January 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Haase</td>
<td class="center">Expires 26 July 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-haase-aucpace-05</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-01-22" class="published">22 January 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-07-26">26 July 2022</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">B. Haase</div>
<div class="org">Endress + Hauser Liquid Analysis</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">(strong) AuCPace, an augmented PAKE</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes AuCPace which is an augmented PAKE protocol for two
      parties. 
      The protocol was tailored for constrained devices and smooth migration for compatibility
      with legacy user credential databases. It is designed to be 
      compatible with any group of both prime- and non-prime order 
      and comes with  a security proof providing composability guarantees.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 26 July 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-outcome-of-the-cfrg-pake-se" class="xref">Outcome of the CFRG PAKE selection process</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-key-design-objectives-for-a" class="xref">Key design objectives for AuCPace</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-requirements-notation" class="xref">Requirements Notation</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-definitions-for-aucpace" class="xref">Definitions for AuCPace</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-setup" class="xref">Setup</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-access-to-server-side-passw" class="xref">Access to server-side password verifiers databases</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-user-credential-database-an" class="xref">User credential database and password verifier types</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-encoding-of-passwords-and-u" class="xref">Encoding of passwords and user names</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-aucpace-database-interface-" class="xref">AuCPace database interface for retrieving password verifiers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-derivation-of-the-salt-valu" class="xref">Derivation of the salt value for strong AuCPace</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-specification-of-the-worklo" class="xref">Specification of the workload parameter sigma</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="xref">4.6</a>.  <a href="#name-result-of-the-database-para" class="xref">Result of the database parameter lookup</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-authentication-session" class="xref">Authentication session</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-authentication-protocol-flo" class="xref">Authentication Protocol Flow</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-aucpace" class="xref">AuCPace</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-authentication-of-transacti" class="xref">Authentication of transactions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-transaction-protocol-flow" class="xref">Transaction Protocol Flow</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-aucpace-authenticated-trans" class="xref">AuCPace authenticated transactions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-ciphersuites" class="xref">Ciphersuites</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-cpace-x25519-elligator2_sha" class="xref">CPACE-X25519-ELLIGATOR2_SHA512-SHA512</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-aucpace25519-test-vectors" class="xref">AuCPace25519 Test Vectors</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#appendix-A.1" class="xref">A.1</a>.  <a href="#name-inverse-x25519-test-vectors" class="xref">Inverse X25519 test vectors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#appendix-A.2" class="xref">A.2</a>.  <a href="#name-strong-aucpace25519-salt-te" class="xref">Strong AuCPace25519 salt test vectors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#appendix-A.3" class="xref">A.3</a>.  <a href="#name-test-vectors-for-aucpace-pa" class="xref">Test vectors for AuCPace password verifier</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-B" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document describes AuCPace which is an augmented password-authenticated key-establishment (PAKE) 
      protocol for two
      parties.  Both sides the client B and the server A establish a high-entropy session key SK, based on 
      a secret (password) which may be of low entropy for the client B and a password-verifier stored on the server.

      The protocol is designed such that disclosing the secret to offline dictionary attacks is prevented. 
      Upon server compromise (stealing A's database), the adversary must first succeed with a dictionary search 
      for the clear-text password before being able to impersonate the client.<a href="#section-1-1" class="pilcrow">¶</a></p>
<div id="selectionProcess">
<section id="section-1.1">
        <h3 id="name-outcome-of-the-cfrg-pake-se">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-outcome-of-the-cfrg-pake-se" class="section-name selfRef">Outcome of the CFRG PAKE selection process</a>
        </h3>
<p id="section-1.1-1"> 
      AuCPace was one of the two finalists of the CFRG PAKE selection process 
      for the augmented pake protocol use-case in which ultimately OPAQUE was selected as general recommendation of 
      the CFRG working group. 
      OPAQUE and strong AuCPace share the security model and security guarantees but come with specific 
      advantages and drawbacks.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2"> 
       The key advantage of OPAQUE in comparison with AuCPace 
      is that one communication round less than AuCPace is required, allowing for easier integration into TLS 1.3.
      Applications where the number of communication round-trips are considered critical are encouraged to consider OPAQUE.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">        
      The key advantages of AuCPace in comparison are much smaller password verifiers and the possibility to run AuCPace
      in conjunction with legacy-style password dictionaries that store the conventional triples 
      of (username, salt, password hash). Moreover AuCPace provides a certain level of resilience with respect to
      adversaries with access to large-scale quantum computers ("quantum annoying property") which OPAQUE does not
      provide.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="objectives">
<section id="section-1.2">
        <h3 id="name-key-design-objectives-for-a">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-key-design-objectives-for-a" class="section-name selfRef">Key design objectives for AuCPace</a>
        </h3>
<p id="section-1.2-1"> 
      The AuCPace protocol was specifically tailored for constrained server devices. As such, the computationally 
      complex password
      hash operation is refered to the clients.  AuCPace is also designed for enabling a 
      smooth migration of legacy user credential databases.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2"> AuCPace is designed to be 
      compatible with any group of both prime- and non-prime order 
      and comes with  a security proof providing composability guarantees.
      AuCPace uses CPace as a building block which is described in a separate
      internet draft document.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<p id="section-1.2-3"> AuCPace moreover designed to provide flexibility and a smooth migration process 
      for applications that today don't use a PAKE protocol for authentication but work with
      conventional password verifier databases instead.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="notation">
<section id="section-2">
      <h2 id="name-requirements-notation">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-requirements-notation" class="section-name selfRef">Requirements Notation</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
        NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
        "MAY", and "OPTIONAL" in this document are to be interpreted as
        described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span>
        when, and only when, they
        appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="definition">
<section id="section-3">
      <h2 id="name-definitions-for-aucpace">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-definitions-for-aucpace" class="section-name selfRef">Definitions for AuCPace</a>
      </h2>
<div id="setup">
<section id="section-3.1">
        <h3 id="name-setup">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-setup" class="section-name selfRef">Setup</a>
        </h3>
<p id="section-3.1-1">Let C be a group in which there exists a subgroup of prime order p where 
          the computational simultaneous Diffie-Hellman (SDH)
          problem is hard. C has order p*c where p is a large prime;
          c  will be called the cofactor. Let I be the unit element in
          C, e.g., the point at infinity in if C is an elliptic curve group. 
          We denote the operations in the group using addition and multiplication operators, e.g. P + (P + P) = P + 2 * P = 3 * P. 
          We refer to a sequence of n additions of an element in P as scalar multiplication by n.
          With B we denote a generator of the prime-order subgroup in C that we call the base point.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2"> 
          With F we denote a field that may be associated with C, e.g. the prime base field used for representing the coordinates 
          of points on an elliptic curve.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">
          We assume that for any element P in C there is a representation modulo negation, 
          encode_group_element_mod_neg(P) as a byte string such 
          that for any Q in C with Q != P and Q != -P, encode_group_element_mod_neg(P) != encode_group_element_mod_neg(Q). 
          It is recommended that encodings of the elements P and -P share the same result string.

          Common choices would be a fixed (per-group) length encoding 
          of the x-coordinate of points on an
          elliptic curve C or its twist C' in Weierstrass form, e.g. according to <span>[<a href="#IEEE1363" class="xref">IEEE1363</a>]</span> in case of
          short Weierstrass form curves. 
          For curves in Montgomery form correspondingly the 
          u-coordinate would be encoded, as specified, e.g., by the encodeUCoordinate function from <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4"> With J we denote the group modulo negation associated to C. Note that in J the scalar multiplication operation 
           is well defined since scalar_multiply(P,s) == -scalar_multiply(-P,s) while arbitrary additions of group elements 
           are no longer available.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1-5"> 
          With J' be denote a second group modulo negation that might share the byte-string encoding function
          encode_group_element_mod_neg with J 
          such for a given byte string 
          either an element in J or J' is encoded. If the x-coordinate of an elliptic curve point group is used for the encoding,
          J' would commonly be corresponding to the group of points on
          the elliptic curve's quadratic twist. Correspondingly, with p' we denote the largest prime factor of the order 
          of J' and its cofactor with c'.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6"> Let scalar_cofactor_clearing(s) be a cofactor clearing function taking an integer input argument and 
           returning an integer as result. 
           For any s, scalar_cofactor_clearing(s) is REQUIRED to be of the form c * s1. I.e. 
           it MUST return a multiple of the cofactor. An example of such a function may be the cofactor
           clearing and clamping functions decodeScalar25519 and decodeScalar448 as used in the X25519 and X448 protocols 
           definitions of <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>.
           In case of prime-order groups with c == 1, it is RECOMMENDED to use the identity function 
           with scalar_cofactor_clearing(s) = s.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<p id="section-3.1-7">
          Let scalar_mult_cc(P,s) be a joint "scalar multiplication and cofactor clearing" function of an integer s and 
          an string-encoded value P, where P could represent an element either on J or J'. If P is an element in J or J', 
          the scalar_mult_cc function returns a string encoding of an element in J or J' respectively, such that the result of 
          scalar_mult_cc(P,s) encodes (scalar_cofactor_clearing(s) * P).<a href="#section-3.1-7" class="pilcrow">¶</a></p>
<p id="section-3.1-8"> Let si = invert_scalar_mult_cc(P,s) be a function such that for any point Z in the prime-order subgroup of J,
            invert_scalar_mult_cc(scalar_mult_cc(Q,s),s) == Q.
            A typical implemention will involve calculating the inverse in the 
            prime field mod p on the scalar generated by scalar_cofactor_clearing(s).<a href="#section-3.1-8" class="pilcrow">¶</a></p>
<p id="section-3.1-9">
          Let scalar_mult_ccv(P,s) be a "scalar multiplication cofactor clearing and verify" function of an integer s and an 
          encoding of a group element P. Unlike scalar_mult_cc, scalar_mult_ccv additionally
          carries out a verification that checks that the computational simultaneous Diffie-Hellman problem (SDH) is hard in the
          subgroup (in J or J') generated by the encoded element SP = scalar_mult_cc(P,s).
          In case that the verification fails (SP might be of low order or on the wrong curve), 
          scalar_mult_ccv is REQUIRED to return the encoding of the identity element I.
          Otherwise scalar_mult_ccv(P,S) is REQUIRED to return the result of scalar_mult_cc(P,s).
 
          A common choice for scalar_mult_ccv for Montgomery curves with twist security would be the 
          X25519 and X448 Diffie-Hellman functions as specified in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>.
          For curves in short Weierstrass form, scalar_mult_ccv could be implemented by the combination of a point verification
          of the input point with a scalar multiplication. Here scalar_mult_ccv SHALL return the encoding of the neutral 
          element I if the input point P was not on the curve C.<a href="#section-3.1-9" class="pilcrow">¶</a></p>
<p id="section-3.1-10">
          Let P=map_to_group_mod_neg(r) be a mapping operation that maps a string r to an encoding 
          of an element P in J. 
          Common choices
          would be the combination of map_to_base and map_to_curve methods as defined in 
          the hash2curve draft <span>[<a href="#HASH2CURVE" class="xref">HASH2CURVE</a>]</span>.
          Note that we don't require and RECOMMEND cofactor clearing here 
          since this complexity is already included in the definition of the scalar multiplication operation calar_mult_cc above. 
          Additionally requiring cofactor clearing also in map_to_group_mod_neg() would result in efficiency loss.<a href="#section-3.1-10" class="pilcrow">¶</a></p>
<p id="section-3.1-11">|| denotes concatenation of strings. We also let len(S) denote the
          length of a string in bytes. Finally, let nil represent an empty string, i.e.,
          len(nil) = 0.<a href="#section-3.1-11" class="pilcrow">¶</a></p>
<p id="section-3.1-12">[f,g,h] denotes alternatives where exactly one of the comma-separated options is to be chosen.<a href="#section-3.1-12" class="pilcrow">¶</a></p>
<p id="section-3.1-13"> Let H(m) be a hash function from
          arbitrary strings m to bit strings of a fixed length. Common choices
          for H are SHA256 or SHA512 <span>[<a href="#RFC6234" class="xref">RFC6234</a>]</span>. H is assumed to segment messages m into blocks m_i of byte length H_block.
          E.g. the blocks used in SHA512 have a size of 128 bytes.<a href="#section-3.1-13" class="pilcrow">¶</a></p>
<p id="section-3.1-14"> Let strip_sign_information(P) be function that takes a string encoding of an element P in J and strips any information
            regarding the sign of P, such that strip_sign_information(P) = strip_sign_information(-P). 
            For short Weierstrass (Montgomery) curves this function will return a string 
            encoding the x-coordinate.
            The purpose of defining this function is for allowing for x-coordinate only scalar multiplication algorithms. 
            The sign is to be stripped before generating the intermediate session key ISK.<a href="#section-3.1-14" class="pilcrow">¶</a></p>
<p id="section-3.1-15"> With ISK we denote the intermediate session key output string provided by CPace that is 
            generated by a hash operation on the Diffie-Hellman result.<a href="#section-3.1-15" class="pilcrow">¶</a></p>
<p id="section-3.1-16">MAC(msg,key) is a message authentication code. Common examples are HMAC_SHA512, a block cipher based MAC
           or a hash-function based tag.<a href="#section-3.1-16" class="pilcrow">¶</a></p>
<p id="section-3.1-17">AEAD(msg,key) is used for denoting an authenticated encryption scheme. A common example would be AES128GCM or Salsa20Poly1305.<a href="#section-3.1-17" class="pilcrow">¶</a></p>
<p id="section-3.1-18">KDF(Q) is a key-derivation function that takes a string and derives key of length L. Common choices for KDF are 
           HMAC_SHA512.<a href="#section-3.1-18" class="pilcrow">¶</a></p>
<p id="section-3.1-19"> With DSI we denote domain-separation identifier strings that may be prepended to the inputs of Hash and KDF functions.<a href="#section-3.1-19" class="pilcrow">¶</a></p>
<p id="section-3.1-20"> Let IHF(salt, username, pw, sigma)  be an iterated 
          hash function that takes a salt value, a user name and a password as input. IHF is designed to slow down 
          brute-force attackers as controlled by a workload parameter set sigma. State of the art 
          iterated hash functions are designed
          for requiring a large amount of memory for its operation and will be referred to as memory-hard hash functions (MHF).
          Scrypt <span>[<a href="#RFC7914" class="xref">RFC7914</a>]</span> or Argon2
          are common examples of a MHF primitive.<a href="#section-3.1-20" class="pilcrow">¶</a></p>
<p id="section-3.1-21"> With PRS we denote a string that is a required input of the CPace subprotocol and generated by the AuCPace protocol.<a href="#section-3.1-21" class="pilcrow">¶</a></p>
<p id="section-3.1-22">Let A and B be two parties. A and B may also have digital
          representations of the parties' identities such as Media Access Control addresses
          or other names (hostnames, usernames, etc). We denote the parties' representation and the parties themselves both
          by using the identifiers A and B.<a href="#section-3.1-22" class="pilcrow">¶</a></p>
<p id="section-3.1-23"> With CI we denote a string that is a required input of the CPace subprotocol. CI is generated together with PRS by the
            AuCPace augmentation layer. 
            CI SHALL be formed by the concatenation of the identifiers A and B and 
            an associated data string AD, CI = A || B || AD;<a href="#section-3.1-23" class="pilcrow">¶</a></p>
<p id="section-3.1-24"> With uad we denote an optional string that is specifying user-associated data in a password file entry, 
            such as authorization rights or permissions or account expiration dates.
            Specification of this string is outside of the scope of the AuCPace protocol.<a href="#section-3.1-24" class="pilcrow">¶</a></p>
<p id="section-3.1-25">Let sid be a session id byte string chosen for each protocol session before protocol execution; 
           The length len(sid) SHOULD be larger or equal to 16 bytes.<a href="#section-3.1-25" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-4">
      <h2 id="name-access-to-server-side-passw">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-access-to-server-side-passw" class="section-name selfRef">Access to server-side password verifiers databases</a>
      </h2>
<p id="section-4-1"> AuCPace is an asymmetric PAKE protocol. I.e. while one party, the client B, is in possession of a clear-text password pw,
             the other party, the server A, is not given access to the cleartext password but only to a password verifier. The
             way how such a password verifier is maintained by a server party is essential for the AuCPace protocol construction.<a href="#section-4-1" class="pilcrow">¶</a></p>
<section id="section-4.1">
        <h3 id="name-user-credential-database-an">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-user-credential-database-an" class="section-name selfRef">User credential database and password verifier types</a>
        </h3>
<p id="section-4.1-1"> 
             With respect to the use of user credantial databases, AuCPace is flexible and supports 
             three different database types.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2"> Firstly, the conventional approach as used for logins without a PAKE protocol is supported
            (as used e.g. for the password over https:/ approach). 
            Here the server stores 
            a tuple of four elements in his password database file, (username, uad, salt, w) with 
            w = IHF(salt, username, pw, sigma) ). With uad, we denote
            user-accociated data such as permissions. The salt value is a nonce used for the IHF function.
            Upon a login request, the user transmits the username and the clear-text password pw to the server. 
            The server looks up the database,
            retrieves the salt value, calculates the IHF function with the given inputs and compares the result with the
            registered password verifier w. We refer to this setting as "legacy password verifier database" (LPVD) setting.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3"> Secondly, AuCPace supports an AuCPace password verifier database setting (APVD) setting. Here the database is already
            adapted for use in conjunction with AuCPace. This setting differs from 
            LPVD by the fact that instead of the direct output of the IHF, w = IHF(salt, username, pw, sigma), 
            an AuCPace password verifier W
            is maintained in the database. W is calculated from the legacy-style value w 
            by W = scalar_mult_cc(B,w). It is possible to calculate W from a LPVD entry on the fly and without knowledge of
            the clear-text password upon a remote login request. It is also easily possible to migrate 
            the format of a LPVD database to an APVD database by calling the scalar multiplication function for each entry.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4"> Thirdly, AuCPace supports the *strong* AuCPace password verifier database setting (sAPVD) setting, which differs from
            APVD and LPVD by the fact that the salt entry in the database, as used for the IHF, 
            is replaced by a salt-derivation parameter q, as 
            will be detailed below.
            With this strong AuCPace verifier type, the AuCPace protocol provides the additional security guarantee 
            of pre-computation attack
            resistance. Note that migrating LPVD or APVD database records to sAPVD entries is *not* possible, because calculating
            the strong sAPVD password verifiers requires the clear-text passwords.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
</section>
<section id="section-4.2">
        <h3 id="name-encoding-of-passwords-and-u">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-encoding-of-passwords-and-u" class="section-name selfRef">Encoding of passwords and user names</a>
        </h3>
<p id="section-4.2-1"> For AuCPace usernames and passwords are encoded as strings according to the definitions of 
             <span>[<a href="#RFC8265" class="xref">RFC8265</a>]</span>, i.e. case-preserving unicode encoding SHALL be employed.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-4.3">
        <h3 id="name-aucpace-database-interface-">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-aucpace-database-interface-" class="section-name selfRef">AuCPace database interface for retrieving password verifiers</a>
        </h3>
<p id="section-4.3-1"> In the course of the authentication protocoll, the AuCPace server implementation will need to interface to an 
             user credential database for retrieving password verifiers.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">
            Database lookup is implemented by use of string-encoded user names.
            AuCPace needs an interface equivalent to a function
            pvr = lookup_pw_verifier_record(username). I.e. a lookup returns a password verfier record pvr, 
            based on a username string. 
            It is REQUIRED that for the purpose of pvr record lookup in databases and for the database contents,
            the "case preservation" according to 
            <span>[<a href="#RFC8265" class="xref">RFC8265</a>]</span> is employed, both for the string encoding of the username and the
            password.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3"> The content in the pvr records will depend on the application scenarios, LPVD, APVD and sAPVD as defined above.
              Password verifier records pvr as returned from the database are REQUIRED to be composed of the 
              following components.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.3-4.1">
            <p id="section-4.3-4.1.1"> A password verifier from either one of the following two options (w or W).<a href="#section-4.3-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-4.1.2.1"> LPVD case: A binary encoding of the actual password verifier that has been calculated as a function of the
                            username, the password, a salt value by use of an iterated hash function 
                            pv = w = IHF(username,password,salt, sigma).<a href="#section-4.3-4.1.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.3-4.1.2.2"> APVD and sAPVD cases:
                            An encoding of an element in J, W = scalarmult_cc(B,w), which has been calculated by
                            a scalar multiplication using the base point B. The secret scalar, w, has been calculated 
                            by an iterated hash function just as in the case above, w = IHF(username,password,salt, sigma).<a href="#section-4.3-4.1.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal ulEmpty" id="section-4.3-4.2"> sigma, a binary encoding specifying the type and the workload parametrization of the iterated hash function IHF that
                     has been used for calculating w or W.<a href="#section-4.3-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal ulEmpty" id="section-4.3-4.3">
            <p id="section-4.3-4.3.1"> A salt derivation entry which is either<a href="#section-4.3-4.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-4.3.2.1"> LPVD and APVD cases: a binary string encoding of the salt value itself or,<a href="#section-4.3-4.3.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.3-4.3.2.2"> sAPVD case: an encoding of a secret scalar q for a group scalar multiplication such that
                             the salt value used for calculating w or W could be calculated from the tuple 
                             salt = strong_AuCPace_salt_derivation(q,username,password).<a href="#section-4.3-4.3.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="section-4.3-5"> In case that a database lookup on a server yields a legacy password database record 
                 (LPVD case that includes an entry w), the AuCPace
                 implementation SHALL convert this record into a AuCPace database record (APVD case) 
                 by replacing w with W=scalarmult_cc(B,w).<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6"> The AuCPace application protocol, thus, only needs to consider the two different APVD and sAPVD
                 scenarios. In case of the APVD scenario, the salt value used for the IHF execution is returned by the database
                 lookup, while in the sAPVD case the salt value is replaced by the secret scalar.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
</section>
<section id="section-4.4">
        <h3 id="name-derivation-of-the-salt-valu">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-derivation-of-the-salt-valu" class="section-name selfRef">Derivation of the salt value for strong AuCPace</a>
        </h3>
<p id="section-4.4-1"> For strong AuCPace the salt value used for the IHF is not explicitly included in the password verifier record pvr.
                 Instead only the parameter q is stored. q serves for deriving the salt value.
                 In order to determine the salt value, strong AuCPace uses  a function 
                 salt = strong_AuCPace_salt_derivation(q,username,password). 
                 This function implements the following sequence of operations.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.4-2.1"> First Z, an element in J, is calculated by use of a Z = map_username_password_to_J(username || password).
                             function, e.g. by use of a hash function such as SHA512 and a mapping such as Elligator2.<a href="#section-4.4-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal ulEmpty" id="section-4.4-2.2"> The salt value is then determined by applying the scalar q and the group element Z to the
                             scalar multiplication function, salt = strip_sign_information(scalarmult_cc(Z,q)).<a href="#section-4.4-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.4-3">
                  Deriving the salt value, thus, requires access to all of, username, clear text password and secret key q. If the
                  database is stolen, an adversary is not able to derive the salt value without having access to the clear-text 
                  password.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4"> Note that the method above which derives the salt directly from Z and q will typically only be used when creating a new
                 password database entry. The AuCPace protocol uses a secret scalar r for, masking the value of Z. The
                 approach exploits the relation q * Z == ((Z * r) * q) * (1/r). More explicitly the sequence is as follows:<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.4-5.1"> The client, B, having access to the username and the clear-text password calculates Z. It aims at deriving
                       the salt value.<a href="#section-4.4-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal ulEmpty" id="section-4.4-5.2"> B samples a fresh scalar r and calculates U = scalarmult_cc(Z,r). B sends U to A.<a href="#section-4.4-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal ulEmpty" id="section-4.4-5.3"> A fetches q from the database and calculates UQ = scalarmult_cc(U,q). A sends UQ back to A.<a href="#section-4.4-5.3" class="pilcrow">¶</a>
</li>
          <li class="normal ulEmpty" id="section-4.4-5.4"> B retrieves the salt by inverting the blinding with the scalar r using
                       salt = strip_sign_information(invert_cofactor_cleared_scalar(UQ,r)).<a href="#section-4.4-5.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-4.5">
        <h3 id="name-specification-of-the-worklo">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-specification-of-the-worklo" class="section-name selfRef">Specification of the workload parameter sigma</a>
        </h3>
<p id="section-4.5-1">  AuCPace does not require the use of a specific iterated hash function IHF. 
                 Still it is strongly RECOMMENDED to use AuCPace in conjunction with state-of-the 
                 art memory-hard hash functions MHF with a secure workload parametrization. 
                 The workload parameter sigma shall encode all of the following.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.5-2.1"> The algorithm family, such as Argon2i, scrypt or PBKDF2-HMAC-SHA256.<a href="#section-4.5-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal ulEmpty" id="section-4.5-2.2"> The workload parameter specification, e.g. the iteration count for PBKDF2 or the parameters N,r and p of the
                       scrypt algorithm.<a href="#section-4.5-2.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<div id="lookup_result">
<section id="section-4.6">
        <h3 id="name-result-of-the-database-para">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-result-of-the-database-para" class="section-name selfRef">Result of the database parameter lookup</a>
        </h3>
<p id="section-4.6-1">  Summing up, the lookup process for user credential data for AuCPace SHALL provide
                 all of the following information in the course of the session establishment protocol.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.6-2.1"> The iterated hash function specification sigma.<a href="#section-4.6-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal ulEmpty" id="section-4.6-2.2"> A salt-derivation parameter and its type. The salt derivationn parameter is 
                       either a salt scalar q or the salt value itself.
                       Correspondingly the type of the salt-derivation parameter is either "AuCPace" or "strong AuCPace".<a href="#section-4.6-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal ulEmpty" id="section-4.6-2.3"> An AuCPace password verifier W = scalarmult_cc(B,IHF(salt, username, pw, sigma)).<a href="#section-4.6-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.6-3"> For handling the case of failed lookups, if a given user name does not have an entry, the database shall define
                a default parameter set sigma_default and a default salt-derivation parameter for password hashing. Moreover
                and a secret string database_seed shall be chosen specifically for each distinct server A.
                In case of failed lookups the following procedure SHALL be used. A random value w shall be sampled. The password
                verifier W shall be calculated as W = map_to_group(w). The parameters q or salt shall be respectively calculated as 
                [q,salt] = H(name || database_seed).<a href="#section-4.6-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
<div id="session">
<section id="section-5">
      <h2 id="name-authentication-session">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-authentication-session" class="section-name selfRef">Authentication session</a>
      </h2>
<div id="flow">
<section id="section-5.1">
        <h3 id="name-authentication-protocol-flo">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-authentication-protocol-flo" class="section-name selfRef">Authentication Protocol Flow</a>
        </h3>
<p id="section-5.1-1">AuCPace is a protocol run between two parties, A and B, 
           for establishing a shared secret key 
           with explicit mutual authentication. AuCPace is implemented
           by four messages as indicated by the numbers in the figure
           below.

           The roles of the two parties are different. Party B, the client,
           is provided a user name and a password as input. Party A, the server,
           has access to a user credentials database that stores password verifiers.

           Both parties share a channel identifier string CI characterizing the
           communication channel (e.g. information on IP addresses and port numbers
           of both sides).<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2"> The channel identifier, CI, SHOULD include an encoding of the identities of both parties A and B if these are available
            prior to starting the communication protocol.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">
           Both sides also share a common subsession ID (ssid) string.

          ssid could be pre-established by a higher-level protocol 
          invocing AuCPace. If no such ssid is available from a higher-level
          protocol, a suitable approach is 
          including ssid in the first message from B to A as shown 
          in the figure below.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-4">
<pre>
                A                  B
                |       ssid       |
                |&lt;1----------------| (sample ssid)

       ---------- AuCPace protocol -----------
 In: ssid       |                  | In: name, passw.
                |     name,U       |     ssid
                |&lt;1----------------|
 DB lookup      |                  |
                |[UQ,salt],X,sigma |
 det. CI,PRS    |----------------2&gt;| det. CI,PRS
       ---------------------------------------
In: CI, PRS,   || (CPace substep)  || In: CI, PRS,
    ssid       ||                  ||     ssid
               ||        Ya        ||
               ||----------------2&gt;||
               ||        Yb        ||
  Output: ISK  ||&lt;3----------------|| Output: ISK
       ---------------------------------------
     expl.auth. |        Tb        | expl.auth.
                |&lt;3----------------|
                |        Ta        |
                |----------------4&gt;|
     Output: SK |                  | Output: SK

</pre><a href="#section-5.1-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="aucpace">
<section id="section-5.2">
        <h3 id="name-aucpace">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-aucpace" class="section-name selfRef">AuCPace</a>
        </h3>
<p id="section-5.2-1"> Both parties start with agreed values on the ssid string. The server side has access to a user credentials database.
            The client side holds a user name, a clear-text password to be used for the authentication session.
            Both sides share an encoding CI specifying the communication channel, such as IP addresses and port numbers.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2"> To begin, B calculates an element Z = map_username_password_to_J(username || password) in J.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3"> B then picks r randomly and uniformly according to the requirements for 
            group J  scalars and calculates U = scalar_mult_cc(Z,r).<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2-4"> B then sends (name,U) to A.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.2-5"> A then queries its database for the user name and retrieves the information as specified in 
            section <a href="#lookup_result" class="xref">Section 4.6</a> , i.e. the set (W,sigma,salt-derivation parameter [q,salt]).
            (Note that according to the specification of the database lookup, such a set is provided, even if there is no
            database entry for the given user name.)<a href="#section-5.2-5" class="pilcrow">¶</a></p>
<p id="section-5.2-6"> A picks x randomly and uniformly according to the requirements for group J scalaras and calculates X = scalarmult_cc(B,x) and
            WX = scalarmult_ccv(W,x). A MUST abort if WX is the neutral element (this indicates an 
            error in the database contents).<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<p id="section-5.2-7"> A strips the sign information from WX to obtain WXs. A picks ya randomly and uniformly. A then calculates 
            G = map_to_group_mod_neg(DSI1 || WXs || ZPAD || ssid || CI) and
           Ya = scalar_mult_cc(G,ya). I.e. WXs takes over the role of CPace's PRS string.<a href="#section-5.2-7" class="pilcrow">¶</a></p>
<p id="section-5.2-8">  The following operations will variate, depending on the type of salt-derivation entry in the database.<a href="#section-5.2-8" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-5.2-9.1"> If the salt derivation parameter is for strong AuCPace, A calculates UQ = scalarmult_cc(U,q) and sends 
                 (UQ,X,sigma,Ya) to
                 B. B then calculates salt as salt = strip_sign_information(inverse_scalarmult_cc(UQ,r)).<a href="#section-5.2-9.1" class="pilcrow">¶</a>
</li>
          <li class="normal ulEmpty" id="section-5.2-9.2"> If the salt derivation parameter is for AuCPace, A sends (salt,X,sigma,Ya) to
                 B.<a href="#section-5.2-9.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.2-10"> B then calculates w = IHF(salt, username, pw, sigma) and XW = scalarmult_ccv(X,w). B MUST abort, if XW is the neutral
            element I.<a href="#section-5.2-10" class="pilcrow">¶</a></p>
<p id="section-5.2-11"> B strips the sign information from XW to obtain XWs. B picks yb randomly and uniformly. 
            B then calculates 
            G = map_to_group_mod_neg(DSI1 || XWs || ZPAD || ssid || CI) and
           Yb = scalar_mult_cc(G,yb). B then calculates K = scalar_mult_ccv(Ya,yb). 
           B MUST abort if K is the encoding of the neutral element I.
           Otherwise B sends Yb to A and proceeds as follows.

           B strips the sign information from K, Ya and Yb  to obtain the strings Ks, Yas and Ybs by 
           using the strip_sign_information() function.
           B calculates ISK = H(DSI2 || ssid || Ks || Yas || Ybs).<a href="#section-5.2-11" class="pilcrow">¶</a></p>
<p id="section-5.2-12"> B calculates Tb = MAC(ISK,DSI4) and Ta_v = MAC(ISK,DSI3) and sends (Yb,Tb) to A.<a href="#section-5.2-12" class="pilcrow">¶</a></p>
<p id="section-5.2-13"> Upon reception of Yb, A calculates K = scalar_mult_ccv(Yb,ya). A MUST abort if K is the neutral element I.
            If K is different from I, A strips the sign information from K, Ya and Yb and 
            calculates ISK = H(DSI2 || ssid || Ks || Yas || Ybs).<a href="#section-5.2-13" class="pilcrow">¶</a></p>
<p id="section-5.2-14"> A calculates Tb_v = MAC(ISK,DSI4) and Ta = MAC(ISK,DSI3). If the received authentication tag Tb did not
           match the verification value Tb_v A MUST abort. Otherwise A sends Ta to B and returns the session key 
           SK = KDF(DSI5 || ISK || ssid).<a href="#section-5.2-14" class="pilcrow">¶</a></p>
<p id="section-5.2-15">When B receives T_a it compares this to the verification value Ta_v. B MUST abort if Ta != Ta_v. Otherwise
           B returns the session key SK = KDF(DSI5 || ISK || ssid).<a href="#section-5.2-15" class="pilcrow">¶</a></p>
<p id="section-5.2-16">Upon completion of this protocol, the session key SK returned by A and B will be identical by both
           parties if and only if the supplied input parameters ssid and CI match on both sides and the password verifier
           in the server database for the user was calculated from the clear-text password used by B.<a href="#section-5.2-16" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="passwordChange">
<section id="section-6">
      <h2 id="name-authentication-of-transacti">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-authentication-of-transacti" class="section-name selfRef">Authentication of transactions</a>
      </h2>
<p id="section-6-1">The AuCPace protocol could also be used for interactive "transactions" that require
           explicit authentication by use of a password. One example of such a transaction
           is the request for change of the user's password verifier which involves two components.
           Firstly, verification of the transaction with the old password and, secondly, the
           transfer of a payload MT containing a new password verifier for the database.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">
           Another example would be transactions that require special privileges and need
           explicit password-based authentication (e.g. as in "sudo" commands on unix operating systems).<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">
           The common feature of such transactions is the confidential transfer of a transaction 
           payload MT from the client to the server and the authentication of the transaction based on
           proven knowledge of a password. Upon sucessful authentication, the transaction as specified by MT is
           processed and a response MR is generated. The server then transfers MR to the client by use of an AEAD scheme.<a href="#section-6-3" class="pilcrow">¶</a></p>
<div id="flowPasswordChange">
<section id="section-6.1">
        <h3 id="name-transaction-protocol-flow">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-transaction-protocol-flow" class="section-name selfRef">Transaction Protocol Flow</a>
        </h3>
<p id="section-6.1-1">
           The protocol flow corresponds to the session key generation above with the difference that the
           authenticator messages Ta and Tb are replaced by two transaction messages TMa and TMb.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">           
           Before starting the protocol, the client has setup a transaction message MT.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3"> As above, the channel identifier, CI, SHOULD include an encoding of the identities of both parties A and B if these are available
            prior to starting the communication protocol.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">
           Both sides also share a common subsession ID (ssid) string.

          ssid could be pre-established by a higher-level protocol 
          invocing AuCPace. If no such ssid is available from a higher-level
          protocol, a suitable approach is 
          including ssid in the first message from B to A as shown 
          in the figure below.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1-5">
<pre>
                A                  B
                |       ssid       |
                |&lt;1----------------| (sample ssid)

       ---------- AuCPace protocol -----------
 In: ssid       |                  | In: name, passw.
                |     name,U       |     ssid, MT
                |&lt;1----------------|
 DB lookup      |                  |
                |[UQ,salt],X,sigma |
 det. CI,PRS    |----------------2&gt;| det. CI,PRS
       ---------------------------------------
In: CI, PRS,   || (CPace substep)  || In: CI, PRS,
    ssid       ||                  ||     ssid
               ||        Ya        ||
               ||----------------2&gt;||
               ||        Yb        ||
  Output: ISK  ||&lt;3----------------|| Output: ISK
       ---------------------------------------
     expl.auth. |       TMb        | expl.auth.
                |&lt;3----------------|
    process TMb |       TMa        |
                |----------------4&gt;|
                |                  | process TMa

</pre><a href="#section-6.1-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="aucpaceTransaction">
<section id="section-6.2">
        <h3 id="name-aucpace-authenticated-trans">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-aucpace-authenticated-trans" class="section-name selfRef">AuCPace authenticated transactions</a>
        </h3>
<p id="section-6.2-1">
        The protocol flow is identical to the case of session key generation except for the fact that the authenticators Ta and Tb
        are replaced by TMa and TMb.
        TMa is generated by TMb = AEAD(MT,ISK), i.e. the payload MT is encrypted and authenticated by use of ISK.
        If verification of the authentication tag of TMb succeeds on the server the transaction message is decrypted and
        executed. E.g. upon a password change transaction message, the new password verifier would be written to the database of the server.
        The result of the transaction execution is encoded in a response message MR and TMa is calculated as
        TMa = AEAD(MR,ISK). The client authenticates TMa and returns the decrypted response message MR upon success.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Ciphersuites">
<section id="section-7">
      <h2 id="name-ciphersuites">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-ciphersuites" class="section-name selfRef">Ciphersuites</a>
      </h2>
<p id="section-7-1">
            This section documents AuCPace ciphersuite configurations. A ciphersuite
            is REQUIRED to specify all of,<a href="#section-7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1">a group modulo negation J with an associated encode_group_element_mod_neg function<a href="#section-7-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.2">scalar_mult_cc(P,s) and scalar_mult_ccv(P,s) functions operating on encodings of 
                      elements P in J<a href="#section-7-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.3"> a mapping function map_to_group_mod_neg(r) converting byte strings r into elements in J<a href="#section-7-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.4"> a strip_sign_information(Q) function operating on string representations of elements Q<a href="#section-7-2.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.5"> a hash function H for generating the intermediate session key ISK<a href="#section-7-2.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.6"> A message authentication code MAC for authentication tag generation.<a href="#section-7-2.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.7"> A key derivation function KDF for generating the final session key SK<a href="#section-7-2.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.8"> and domain separation strings DSI1, DSI2, DSI3, DSI4, DSI5<a href="#section-7-2.8" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-7-3">
            Currently, detailed specifications are available for 
            CPACE-X25519-ELLIGATOR2_SHA512-SHA512.<a href="#section-7-3" class="pilcrow">¶</a></p>
<span id="name-cpace-ciphersuites"></span><div id="cpace_ciphersuites">
<table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-cpace-ciphersuites" class="selfRef">CPace Ciphersuites</a>
        </caption>
<thead>
          <tr>
            <th class="text-center" rowspan="1" colspan="1">J</th>
            <th class="text-center" rowspan="1" colspan="1">map_to_group_mod_neg</th>
            <th class="text-center" rowspan="1" colspan="1">KDF</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">X25519</td>
            <td class="text-center" rowspan="1" colspan="1">ELLIGATOR2_SHA512 </td>
            <td class="text-center" rowspan="1" colspan="1">SHA512 <span>[<a href="#RFC6234" class="xref">RFC6234</a>]</span>
</td>
          </tr>
        </tbody>
      </table>
</div>
<section id="section-7.1">
        <h3 id="name-cpace-x25519-elligator2_sha">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-cpace-x25519-elligator2_sha" class="section-name selfRef">CPACE-X25519-ELLIGATOR2_SHA512-SHA512</a>
        </h3>
<p id="section-7.1-1">      
      This cipher suite targets particularly constrained targets and implements specific optimizations.
      It uses the group of points on the Montgomery curve Curve25519 for constructing J. The base field F is the 
      prime field built upon the prime p = 2^255 - 19.
      The Diffie-Hellmann protocol X25519 and the group are specified in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>. 
      The encode_group_element_mod_neg(P) is implemented by the encodeUCoordinate(P) function defined in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>. 
      The neutral element I is encoded as a 32 byte zero-filled string.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2"> The domain separation strings are defined as DSI1 = "CPace25519-1", DSI2 = "CPace25519-2", DSI3 = "AuCPace25-Ta", 
         DSI4 = "AuCPace25-Tb", DSI5 = "AuCPace25519".  
         (ASCII encoding without ANSI-C style trailing zeros).<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3"> Both, scalar_mult_cc and scalar_mult_ccv, are implemented by the X25519 function specified in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4"> The secret scalars ya and yb used for X25519 shall be sampled as uniformly distributed 32 byte strings.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5"> The QI = inverse_scalarmult_cc(Q,s) function is implemented as follows.<a href="#section-7.1-5" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-7.1-6.1"> cs = scalar_cofactor_clearing(s)<a href="#section-7.1-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal ulEmpty" id="section-7.1-6.2"> csi = 1 / (8 * cs) % p.<a href="#section-7.1-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal ulEmpty" id="section-7.1-6.3"> QI = UNCLAMPED_X25519(Q, 8 * si).<a href="#section-7.1-6.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-7.1-7">
         Where the unclamped X25519 function ommits the setting of bit #254 in the scalar from <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>.<a href="#section-7.1-7" class="pilcrow">¶</a></p>
<p id="section-7.1-8"> The map_to_group_mod_neg function for the CPace substep 
         is implemented as follows. First the byte length of the ZPAD zero-padding string is determined
         such that len(ZPAD) = max(0, H_block_SHA512 - len(DSI1 || PRS)), with H_block_SHA512 = 128 bytes. 
         Then a byte string u is calculated by use of u = SHA512(DSI1||PRS||ZPAD||sid||CI). The resulting string is interpreted
         as 512-bit integer in little-endian format according to the definition of decodeLittleEndian() from <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>. 
         The resulting integer is then reduced to the base field as input to the Elligator2 map specified in <span>[<a href="#HASH2CURVE" class="xref">HASH2CURVE</a>]</span>
         to yield the secret generator G = Elligator2(u).<a href="#section-7.1-8" class="pilcrow">¶</a></p>
<p id="section-7.1-9"> The map_to_group_mod_neg function used for the strong AuCPace substep for calculating the field element Z 
         is implemented accordingly. First the byte length of the ZPAD zero-padding string is determined
         such that len(ZPAD) = max(0, H_block_SHA512 - len(DSI5 || password)), with H_block_SHA512 = 128 bytes. 
         Then a byte string u is calculated by use of u = SHA512(DSI5||password||ZPAD||username). 
         The resulting string is interpreted
         as 512-bit integer in little-endian format according to the definition of decodeLittleEndian() from <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>. 
         The resulting integer is then reduced to the base field as input to the Elligator2 map specified in <span>[<a href="#HASH2CURVE" class="xref">HASH2CURVE</a>]</span>
         to yield the secret generator Z = Elligator2(u).<a href="#section-7.1-9" class="pilcrow">¶</a></p>
<p id="section-7.1-10"> AuCPace25519 calculates an intermediate session key ISK of 64 bytes length by a single invocation of SHA512(DSI2||ISK). 
         Since the encoding does not incorporate the sign
         from the very beginning Qs = strip_sign_information(Q) == Q for this cipher suite.<a href="#section-7.1-10" class="pilcrow">¶</a></p>
<p id="section-7.1-11"> AuCPace25519 calculates authentication tags and session key SK from ISK of 64 bytes length by a single 
         invocation of Ta = SHA512(DSI3||ISK),
         Tb = SHA512(DSI4||ISK) and SK = SHA512(DSI5||ISK).<a href="#section-7.1-11" class="pilcrow">¶</a></p>
<p id="section-7.1-12"> The following sage code could be used as reference implementation for the mapping and key derivation functions.<a href="#section-7.1-12" class="pilcrow">¶</a></p>
<div id="section-7.1-13">
<pre class="sourcecode">&lt;CODE BEGINS&gt;

def littleEndianStringToInteger(k):
    bytes = [ord(b) for b in k]
    return sum((bytes[i] &lt;&lt; (8 * i)) for i in range(len(bytes)))

def map_to_group_mod_neg_CPace25519(sid, PRS, CI):
    m = hashlib.sha512()
    p = 2^255 - 19

    H_block_SHA512 = 128
    DSI1 = b"CPace25519-1"
    ZPAD_len = max(0,H_block_SHA512 - len(CI) - len(PRS))
    ZPAD = ZPAD_len * "\0"

    m.update(DSI1)
    m.update(PRS)
    m.update(ZPAD)
    m.update(sid)
    m.update(CI)
    u = littleEndianStringToInteger(m.digest())
    return map_to_curve_elligator2_curve25519(u % p)

def map_to_group_mod_neg_StrongAuCPace25519(username, password):
    # Map username and password to field element Z
    DSI = b"AuCPace25519"
    F = GF(2^255 - 19)
    m = hashlib.sha512()
    H_block_SHA512 = 128
    ZPAD_len = max(0,H_block_SHA512 - len(DSI) - len(password))
    ZPAD = ZPAD_len * "\0"
    m.update(DSI)
    m.update(password)
    m.update(ZPAD)
    m.update(username)
    u = littleEndianStringToInteger(m.digest())
    u = F(u)
    Z = map_to_curve_elligator2_curve25519(u)
    return Z

def Inverse_X25519(u_string,scalar_string):
    OrderSubgroup = 2^252 + 27742317777372353535851937790883648493
    SF = GF(OrderSubgroup)
    coFactor = SF(8)
    scalar = clampScalar25519(scalar_string)
    inverse_scalar = 1 /  (SF(scalar) * coFactor)
    inverse_scalar_shifted = Integer(inverse_scalar) * 8
    return X25519(u_string,inverse_scalar_shifted,withClamping=0)

def generate_ISK_CPace25519(sid,K,Ya,Yb):
    m = hashlib.sha512(b"CPace25519-2")
    m.update(sid)
    m.update(K)
    m.update(Ya)
    m.update(Yb)
    return m.digest()

def MAC_SK_AuCPace25519(ISK):
    DSI3 = b"AuCPace25-Ta"
    DSI4 = b"AuCPace25-Tb"
    DSI5 = b"AuCPace25519"
    m = hashlib.sha512(DSI3)
    m.update(ISK)
    Ta = m.digest()
    Ta = Ta[:16]

    m = hashlib.sha512(DSI4)
    m.update(ISK)
    Tb = m.digest()
    Tb = Tb[:16]

    m = hashlib.sha512(DSI5)
    m.update(ISK)
    SK = m.digest()

    return (Ta,Tb,SK)


&lt;CODE ENDS&gt;</pre><a href="#section-7.1-13" class="pilcrow">¶</a>
</div>
<p id="section-7.1-14">

        Due to its use in Ed25519 <span>[<a href="#RFC8032" class="xref">RFC8032</a>]</span>, SHA512 is considered to be the natural hash choice for Curve25519.
        The 512 bit output of SHA512 moreover allows for removing any statistical bias stemming from the non-canonical base field
        representations, such that the overhead of the HKDF_extract/HKDF_expand sequences from <span>[<a href="#HASH2CURVE" class="xref">HASH2CURVE</a>]</span> 
        are considered not necessary (in line with the assessments regarding Curve25519 in <span>[<a href="#HASH2CURVE" class="xref">HASH2CURVE</a>]</span>).<a href="#section-7.1-14" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">A security proof covering AuCPace is found in <span>[<a href="#HL18" class="xref">HL18</a>]</span>.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Elements received from a peer MUST be checked by a proper implementation of the scalar_mult_ccv method. 
          Failure to properly validate group elements can lead to attacks. The Curve25519-based cipher suite employs
          the twist security feature of the curve for point validation. 
          As such, it is mandatory to check that all low-order points on both
          the curve and the twist are
          mapped on the neutral element by the X25519 function. Corresponding test vectors are provided in the 
          appendix.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">The choices of random numbers MUST be uniform. Randomly generated values (e.g., ya, r, q and yb)
          MUST NOT be reused.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">User credential database lookups for AuCPace might not be executed in non-constant time. In this
         case, AuCPace does not provide full confidentiality with respect to hiding the presence or abscence
         of a given user's entry in the database. The fact that in case of abscence of a record
        random values are provided instead should be considered only a mitigation regarding user-enumeration attacks.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">If AuCPace is used as a building block of higher-level protocols, it is RECOMMENDED that ssid
         is generated by the higher-level protocol and passed to AuCPace. It is RECOMMENDED that ssid, 
         is generated by sampling ephemeral random strings.<a href="#section-8-5" class="pilcrow">¶</a></p>
<p id="section-8-6">AuCPace generates the session key SK by a hash function operation on the intermediate session key ISK. 
         If SK is possibly to be used for many different sub-protocols and purposes, such
         as e.g. in TLS1.3, it is RECOMMENDED to apply SK to a stronger KDF function, such as HKDF from <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>.<a href="#section-8-6" class="pilcrow">¶</a></p>
<p id="section-8-7">In case that side-channel attacks are to be considered practical for a given application, it is RECOMMENDED to focus
         side-channel protections such as masking and redundant execution (faults) on the process of calculating
         the secret generator G. The most critical aspect to consider is the processing of the first block of the hash that includes 
         the PRS string. The CPace protocol construction considers the fact that side-channel protections of hash functions might 
         be particularly resource hungry. For this reason, AuCPace aims at minimizing the number of hash functions invocations in the 
         specified mapping method.<a href="#section-8-7" class="pilcrow">¶</a></p>
<p id="section-8-8">AuCPace is designed also for compatibility with legacy-style user-credential databases which directly store the 
         output of iterated hash functions w = IHF(salt, username, pw, sigma). If AuCPace is used in this configuration, AuCPace
         provides only the security guarantees of a balanced PAKE. I.e. in this case, user impersonation attacks become feasible
         if the user credential database is stolen. It is RECOMMENDED to migrate legacy-style databases to an AuCPace format,
         by replacing w with W = scalarmult_cc(B,w).<a href="#section-8-8" class="pilcrow">¶</a></p>
<p id="section-8-9">It is RECOMMENDED to use password verifiers for "strong AuCPace" on such a migrated database upon user password changes
         in order to obtain pre-computation attack resistance.<a href="#section-8-9" class="pilcrow">¶</a></p>
<p id="section-8-10">The Map2Point primitive used for (strong) AuCPace and for the CPace substep needs to be be probabilistically invertible
         according to the definition of <span>[<a href="#CPaceAnalysis" class="xref">CPaceAnalysis</a>]</span>. Use of Elligator2 (for Montgomery or Edwards curves) or 
         simplified SWU <span>[<a href="#HASH2CURVE" class="xref">HASH2CURVE</a>]</span> (otherwise) is recommended for this purpose.<a href="#section-8-10" class="pilcrow">¶</a></p>
<p id="section-8-11">AuCPace is proven secure under the hardness of the strong computational simultaneous Diffie-Hellmann (SDH) problem in the group J 
         as defined in <span>[<a href="#CPaceAnalysis" class="xref">CPaceAnalysis</a>]</span>. 
         Still, even for the event that large-scale quantum computers (LSQC) will become available, AuCPace forces an active 
         adversary to solve one instance of the CDH problem per password guess. 
         Using the wording suggested by Steve Thomas on the CFRG mailing list,
         AuCPace is "quantum-annoying".<a href="#section-8-11" class="pilcrow">¶</a></p>
<p id="section-8-12"> Strong AuCPace is pre-computation attack resistant under the CDH and the gap One-More-DH assumption, modelling the
             hash2curve primitive as random oracle hashing to the group. 
             If the map2point primitive used is probabilistically invertible, the analysis from           
             <span>[<a href="#CPaceAnalysis" class="xref">CPaceAnalysis</a>]</span> applies for instantiating the OPRF used in strong AuCPace 
             also using single-coordinate Diffie-Hellman using X25519 and inverse X25519.<a href="#section-8-12" class="pilcrow">¶</a></p>
<p id="section-8-13">    
             While the
             rest of the AuCPace protocol is quantum-annoying, solving a single discrete logarithm problem will reveal
             the salt-derivation parameter q as used in strong AuCPace to the adversary. This will allow for pre-computing a 
             rainbow table for
             a given user name. I.e. the pre-computation attack resistance property will be lost and security guarantees 
             of strong AuCPace and AuCPace would become equivalent.
             (In order maintain strong AuCPace's pre-computation attack guarantees, a post-quantum instance
             of an olibvious pseudo-random function (OPRF) would have to be found and used as replacement of the 
             Diffie-Hellman OPRF construction employed by strong AuCPace.)<a href="#section-8-13" class="pilcrow">¶</a></p>
</section>
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-9-1">No IANA action is required.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
<section id="section-10">
      <h2 id="name-acknowledgments">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-10-1"> Thanks
         to the members of the CFRG for
        comments and advice.<a href="#section-10-1" class="pilcrow">¶</a></p>
</section>
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd><dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5869">https://www.rfc-editor.org/info/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6234">[RFC6234]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span> and <span class="refAuthor">T. Hansen</span>, <span class="refTitle">"US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)"</span>, <span class="seriesInfo">RFC 6234</span>, <span class="seriesInfo">DOI 10.17487/RFC6234</span>, <time datetime="2011-05" class="refDate">May 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6234">https://www.rfc-editor.org/info/rfc6234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7748">[RFC7748]</dt>
        <dd>
<span class="refAuthor">Langley, A.</span>, <span class="refAuthor">Hamburg, M.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7748">https://www.rfc-editor.org/info/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7914">[RFC7914]</dt>
        <dd>
<span class="refAuthor">Percival, C.</span> and <span class="refAuthor">S. Josefsson</span>, <span class="refTitle">"The scrypt Password-Based Key Derivation Function"</span>, <span class="seriesInfo">RFC 7914</span>, <span class="seriesInfo">DOI 10.17487/RFC7914</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7914">https://www.rfc-editor.org/info/rfc7914</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8032">[RFC8032]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span> and <span class="refAuthor">I. Liusvaara</span>, <span class="refTitle">"Edwards-Curve Digital Signature Algorithm (EdDSA)"</span>, <span class="seriesInfo">RFC 8032</span>, <span class="seriesInfo">DOI 10.17487/RFC8032</span>, <time datetime="2017-01" class="refDate">January 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8032">https://www.rfc-editor.org/info/rfc8032</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HASH2CURVE">[HASH2CURVE]</dt>
        <dd>
<span class="refAuthor">Faz-Hernandez, A.</span>, <span class="refAuthor">Scott, S.</span>, <span class="refAuthor">Sullivan, N.</span>, <span class="refAuthor">Wahby, R.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"draft-irtf-cfrg-hash-to-curve-05"</span>, <time datetime="2019" class="refDate">2019</time>. <span class="annotation">IRTF draft standard
          </span>
        </dd>
<dd class="break"></dd>
<dt id="IEEE1363">[IEEE1363]</dt>
      <dd>
<span class="refAuthor">IEEE</span>, <span class="refTitle">""Standard Specifications for Public Key Cryptography", IEEE 1363"</span>, <time datetime="2000" class="refDate">2000</time>. <span class="annotation">IEEE 1363
          </span>
        </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="HL18">[HL18]</dt>
        <dd>
<span class="refAuthor">Haase, B.</span> and <span class="refAuthor">B. Labrique</span>, <span class="refTitle">"AuCPace. PAKE protocol tailored for the use in the internet of things."</span>, <time datetime="2018-02" class="refDate">February 2018</time>. <span class="annotation">eprint.iacr.org/2018/286
          </span>
        </dd>
<dd class="break"></dd>
<dt id="CPaceAnalysis">[CPaceAnalysis]</dt>
        <dd>
<span class="refAuthor">Abdalla, M.</span>, <span class="refAuthor">Haase, B.</span>, and <span class="refAuthor">J. Hesse</span>, <span class="refTitle">"Security analysis of CPace."</span>, <time datetime="2021-01" class="refDate">January 2021</time>. <span class="annotation">eprint.iacr.org/2021/114
          </span>
        </dd>
<dd class="break"></dd><dt id="RFC8265">[RFC8265]</dt>
        <dd>
<span class="refAuthor">Saint-Andre, P.</span> and <span class="refAuthor">A. Melnikov</span>, <span class="refTitle">"Preparation, Enforcement, and Comparison of Internationalized Strings Representing Usernames and Passwords"</span>, <span class="seriesInfo">RFC 8265</span>, <span class="seriesInfo">DOI 10.17487/RFC8265</span>, <time datetime="2017-10" class="refDate">October 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8265">https://www.rfc-editor.org/info/rfc8265</a>&gt;</span>. </dd>
<dd class="break"></dd></dl>
</section>
</section>
<section id="appendix-A">
      <h2 id="name-aucpace25519-test-vectors">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-aucpace25519-test-vectors" class="section-name selfRef">AuCPace25519 Test Vectors</a>
      </h2>
<p id="appendix-A-1"></p>
<section id="appendix-A.1">
        <h3 id="name-inverse-x25519-test-vectors">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-inverse-x25519-test-vectors" class="section-name selfRef">Inverse X25519 test vectors</a>
        </h3>
<div class="alignLeft art-text artwork" id="appendix-A.1-1">
<pre>
######################## /inverse X25519 ##########################

Z :
0x5d7189be6192ffccdb80902ac26c5d38592822a761c7268007200a232a4cd841
r (random scalar input for X25519):
0xe8a70b556490ecdbd52c2927464d4eff557807496af234fc496c9f4221bd4423
U = X25519(Z,r):
0x3e6377b3410a60d0ca65190963ad6dce3aeae178aafad369dc2a59c59acc3ceb
IU = inverse_X25519(U)
0x5d7189be6192ffccdb80902ac26c5d38592822a761c7268007200a232a4cd841

Z :
0x73583bc520f4b9e1245e29b92e6b12dc1c8bc0d9b018a1e2626875db2774974
r (random scalar input for X25519):
0xe22cb510bd45fc6cbcb929353777925d152c2a9a5b924715d7480aad8b64d447
U = X25519(Z,r):
0x545040a9ac1cc13a627dddc0ab4ef0b9128d54476aa98727bd45a86ea2d6de24
IU = inverse_X25519(U)
0x73583bc520f4b9e1245e29b92e6b12dc1c8bc0d9b018a1e2626875db2774974

######################## inverse X25519/ ##########################

</pre><a href="#appendix-A.1-1" class="pilcrow">¶</a>
</div>
</section>
<section id="appendix-A.2">
        <h3 id="name-strong-aucpace25519-salt-te">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-strong-aucpace25519-salt-te" class="section-name selfRef">Strong AuCPace25519 salt test vectors</a>
        </h3>
<div class="alignLeft art-text artwork" id="appendix-A.2-1">
<pre>

############ /salt derivation for strong AuCPace ##################

DSI5 = 417543506163653235353139 string ('AuCPace25519') of len(12)
pw   = 70617373776f7264 ('password') string of len(8)
ZPAD = 108 zero bytes
name = 757365726e616d65 ('username') string of len(8)
u = SHA512(DSI||password||ZPAD||username) as 512 bit int:
 0xfec497749d249426e4895e05d0bb4f565aa4423f33d19e6b20aa3837eb77d16e
 &lt;&lt;256
 + 0xb8f5b1b51c1557c088356d7ca09bd78f259f1d5f4041d466f4edd40f041a0bb3

u as reduced base field element coordinate:
  0xa242d046f835586749962599c699e609a00f2c0f15f584dce322c5bf7e327be

Z = Elligator2(u) as base field element coordinate:
  0x3c01681e4c6d4a43b527c789bcf6046b53ac14c516dfbbbb0f8916826b537f4b

salt-derivation parameter q:
0xf40546b4544bae5fcc564dc917407ee02300312c8fd558a0b37f48322277962e

ZQ = X25519(Z,q):
0x77412819cad958e14d4a4c09c129456b90733fd13f337ffed6c0a30f7c3a9a50


Blinding scalar r:
0x1698d57693a684a957ae0492bade0dfd6a261dfa2bb4a74c6b0b8b84acf082a8
U = X25519(Z,r):
0xaf2a058fbd974a6122f8316323060d808705701971666121477eba97386a977
UQ = X25519(U,q):
0x610270daff540b5b7adec057e0f8fa1bfe7687649d95f65560a77a2be70e6cb5
ZQ = inverse_X25519(Z,r)
0x77412819cad958e14d4a4c09c129456b90733fd13f337ffed6c0a30f7c3a9a50

############ salt derivation for strong AuCPace/ ##################

</pre><a href="#appendix-A.2-1" class="pilcrow">¶</a>
</div>
</section>
<section id="appendix-A.3">
        <h3 id="name-test-vectors-for-aucpace-pa">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-test-vectors-for-aucpace-pa" class="section-name selfRef">Test vectors for AuCPace password verifier</a>
        </h3>
<div class="alignLeft art-text artwork" id="appendix-A.3-1">
<pre>
###################### /Password verifier #########################
Inputs:

Password: 'password', length 8
User Name: 'username', length 8

Z for username, password:
0x3c01681e4c6d4a43b527c789bcf6046b53ac14c516dfbbbb0f8916826b537f4b
q:
0xf40546b4544bae5fcc564dc917407ee02300312c8fd558a0b37f48322277962e

Salt value salt = X25519(Z,q):
0x77412819cad958e14d4a4c09c129456b90733fd13f337ffed6c0a30f7c3a9a50

####################################################################

Concatenated input to scrypt as password parameter:
'passwordusername', length 16

Salt value Z^q:
0x77412819cad958e14d4a4c09c129456b90733fd13f337ffed6c0a30f7c3a9a50
Password hash w from scrypt with N=1&lt;&lt;15, r=8, p=1
0xd832084ac895c20b4893ba4541daeb41ee8ae6cf99788ac8fda4a125734eb5f2
Password verifier W = X25519(B,w)
0x12511fcfc70fe9c3a8e72b347d7de52927fc253b83edc8271a5e90ecdf958f57
Server private key x =
0x8b2389da423eb4f8979245d5b4527f92eacc1f3ad11581822d56498c44d4aba4
Server Public key X = X25519(B,x)
0x3e97ae1689d3b1c9fbd82e0cc036118f44279f58537a6b13b2db87e62682afd7
Shared secret XW = X25519(W,x)
0x3e97ae1689d3b1c9fbd82e0cc036118f44279f58537a6b13b2db87e62682afd7
###################### Password verifier/ #########################

</pre><a href="#appendix-A.3-1" class="pilcrow">¶</a>
</div>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Bjoern Haase</span></div>
<div dir="auto" class="left"><span class="org">Endress + Hauser Liquid Analysis</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:bjoern.m.haase@web.de" class="email">bjoern.m.haase@web.de</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
