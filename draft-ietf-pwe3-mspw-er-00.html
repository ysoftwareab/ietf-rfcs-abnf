<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Explicit Path Routing for Dynamic Multi-Segment Pseudowires</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Explicit Path in MS-PW Signaling">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Explicit Route TLV (ER-TLV)">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Explicit Route Hop TLV (ER-Hop TLV)">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 ER-Hop Semantics">
<link href="#rfc.section.2.3.1" rel="Chapter" title="2.3.1 ER-Hop 1: IPv4 Prefix">
<link href="#rfc.section.2.3.2" rel="Chapter" title="2.3.2 ER-Hop 2: IPv6 Prefix">
<link href="#rfc.section.2.3.3" rel="Chapter" title="2.3.3 ER-Hop 3: L2 PW Address">
<link href="#rfc.section.3" rel="Chapter" title="3 Explicit Route TLV Processing">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Next-Hop Selection">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Adding ER Hops to the Explicit Route TLV">
<link href="#rfc.section.4" rel="Chapter" title="4 IANA Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Acknoledgements">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Dynamic Multi-Segment Pseudowire (MS-PW) setup through an explicit path may be required to provide a simple solution for 1:1 protection with diverse primary and backup MS-PWs for a service, or to enable controlled signaling (strict or loose) for special MS-PWs. This document describes the extensions and procedures necessary for setting up of dynamic MS-PWs through explicit path routing." />
  <meta name="description" content="Dynamic Multi-Segment Pseudowire (MS-PW) setup through an explicit path may be required to provide a simple solution for 1:1 protection with diverse primary and backup MS-PWs for a service, or to enable controlled signaling (strict or loose) for special MS-PWs. This document describes the extensions and procedures necessary for setting up of dynamic MS-PWs through explicit path routing." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">P. Dutta</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">M. Bocci</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Alcatel-Lucent</td>
</tr>
<tr>
<td class="left">Expires: March 25, 2012</td>
<td class="right">L. Martini</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Cisco Systems</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">September 22, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Explicit Path Routing for Dynamic Multi-Segment Pseudowires<br />
  <span class="filename">draft-ietf-pwe3-mspw-er-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Dynamic Multi-Segment Pseudowire (MS-PW) setup through an explicit path may be required to provide a simple solution for 1:1 protection with diverse primary and backup MS-PWs for a service, or to enable controlled signaling (strict or loose) for special MS-PWs. This document describes the extensions and procedures necessary for setting up of dynamic MS-PWs through explicit path routing.</p>
<h1><a>Requirements Language</a></h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in<a href="#RFC2119">[RFC2119]</a>.</p>
<p>This document uses the terminology defined in <a href="#I-D.ietf-pwe3-dynamic-ms-pw">[I-D.ietf-pwe3-dynamic-ms-pw]</a><a href="#RFC4447">,</a> <cite title="NONE">[RFC4447]</cite><a href="#RFC5036">and </a> <cite title="NONE">[RFC5036]</cite></p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 25, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Explicit Path in MS-PW Signaling</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Explicit Route TLV (ER-TLV)</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Explicit Route Hop TLV (ER-Hop TLV)</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">ER-Hop Semantics</a>
</li>
<li>2.3.1.   <a href="#rfc.section.2.3.1">ER-Hop 1: IPv4 Prefix</a>
</li>
<li>2.3.2.   <a href="#rfc.section.2.3.2">ER-Hop 2: IPv6 Prefix</a>
</li>
<li>2.3.3.   <a href="#rfc.section.2.3.3">ER-Hop 3: L2 PW Address</a>
</li>
<li>3.   <a href="#rfc.section.3">Explicit Route TLV Processing</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Next-Hop Selection</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Adding ER Hops to the Explicit Route TLV</a>
</li>
<li>4.   <a href="#rfc.section.4">IANA Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Acknoledgements</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Procedures for dynamically establishing MS-PWs through automatically selected paths are defined in <a href="#I-D.ietf-pwe3-dynamic-ms-pw">[I-D.ietf-pwe3-dynamic-ms-pw]</a>. For 1:1 protection of MS-PWs with primary and backup paths it is required to set-up MS-PWs through a diverse set of S-PEs (Switching Provider-Edge Devices) to remove any single points of failure at PW level. <a href="#I-D.ietf-pwe3-dynamic-ms-pw">[I-D.ietf-pwe3-dynamic-ms-pw]</a> allows this through BGP based mechanisms. This draft proposes an additional mechanism that allows the ST-PE (Source Terminating PEs) to explicitly choose the path that a PW will take through the intervening S-PEs. Explicit path routing of dynamic MS-PWs may also be required for controlled set-up of dynamic MS-PWs and efficient network resource management. This documents defined extensions and procedures to <a href="#I-D.ietf-pwe3-dynamic-ms-pw">[I-D.ietf-pwe3-dynamic-ms-pw]</a> required for setting up of dynamic MS-PWs through explicit paths. Procedures for dynamically establishing MS-PWs through automatically selected paths are defined in <a href="#I-D.ietf-pwe3-dynamic-ms-pw">[I-D.ietf-pwe3-dynamic-ms-pw]</a>. For 1:1 protection of MS-PWs with primary and backup paths it is required to set-up MS-PWs through a diverse set of S-PEs to remove any single points of failure at PW level. <a href="#I-D.ietf-pwe3-dynamic-ms-pw">[I-D.ietf-pwe3-dynamic-ms-pw]</a> allows this through BGP based mechanisms.</p>
<p id="rfc.section.1.p.2">This draft proposes an additional mechanism that allows the ST-PE to explicitly choose the path that a PW will take through the intervening S-PEs. Explicit path routing of dynamic MS-PWs may also be required for controlled set-up of dynamic MS-PWs and efficient network resource management. This documents defined extensions and procedures to <a href="#I-D.ietf-pwe3-dynamic-ms-pw">[I-D.ietf-pwe3-dynamic-ms-pw]</a> required for setting up of dynamic MS-PWs through explicit paths.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Explicit Path in MS-PW Signaling</h1>
<p id="rfc.section.2.p.1">This section describes the LDP (Label Distribution Protocol) extensions required for signaling explicit paths in dynamic MS-PW set-up messages.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Explicit Route TLV (ER-TLV)</h1>
<p id="rfc.section.2.1.p.1">The ER-TLV is an object that specifies the path to be taken by the MS-PW being established. It is composed of one or more Explicit Route Hop TLVs (ER-Hop TLVs) defined in Section 2.2. Note that Explicit Route TLV definition is very generic and may be also used outside of MS-PW applications. Such applications are out of scope of this document.</p>
<p id="rfc.section.2.1.p.2">The ER-TLV format is defined as follows:</p>
<div id="#rfc.figure.1"></div>
<pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|0|         Type = 0x0800     |      Length                   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          ER-Hop TLV 1                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          ER-Hop TLV 2                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   ~                          ............                         ~
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          ER-Hop TLV n                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Type
         A fourteen-bit field carrying the value of the ER-TLV
         Type = 0x0800.

   Length
         Specifies the length of the value field in bytes.

   ER-Hop TLVs
         One or more ER-Hop TLVs defined in Section 3.2.
</pre>
<p></p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Explicit Route Hop TLV (ER-Hop TLV)</h1>
<p id="rfc.section.2.2.p.1">The contents of an ER-TLV are a series of variable length ER-Hop TLVs. Each hop contains the identification of an &#8220;Abstract Node&#8221; that represents the hop to be traversed.</p>
<p id="rfc.section.2.2.p.2">Each ER-Hop TLV has the form:</p>
<div id="#rfc.figure.2"></div>
<pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|0|                 Type      |      Length                   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |L|                                  Content //                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   ER-Hop Type

         A fourteen-bit field carrying the type of the ER-Hop contents.
         Currently defined values are:

         Value  Type
         ------ ------------------------
         0x0801 IPv4 prefix
         0x0802 IPv6 prefix
         0x0805 L2 PW address of PW Switching Point
         

   Length
         Specifies the length of the value field in bytes.

   L bit
         The L bit in the ER-Hop is a one-bit attribute.  If the L bit
         is set, then the value of the attribute is "loose." Otherwise,
         the value of the attribute is "strict."  For brevity, we say
         that if the value of the ER-Hop attribute is loose then it is 
         a "loose ER-Hop."  Otherwise, it's a "strict ER-Hop." Further,
         we say that the abstract node of a strict or loose ER-Hop is a
         strict or a loose node, respectively.  Loose and strict nodes
         are always interpreted relative to their prior abstract nodes.
         The path between a strict node and its prior node MUST include
         only network nodes from the strict node and its prior abstract
         node.

         The path between a loose node and its prior node MAY include
         other network nodes, which are not part of the strict node or
         its prior abstract node.

   Contents
         A variable length field containing a node or abstract node
         which is one of the consecutive nodes that make up the
         explicitly routed PW.
</pre>
<p></p>
<p id="rfc.section.2.2.p.4">Details of ER Hop semantics are defined in section 2.3.</p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> ER-Hop Semantics</h1>
<p></p>
<h1 id="rfc.section.2.3.1">
<a href="#rfc.section.2.3.1">2.3.1.</a> ER-Hop 1: IPv4 Prefix</h1>
<p id="rfc.section.2.3.1.p.1">The abstract node represented by this ER-Hop is the set of nodes, which have an IP address, which lies within this prefix. Note that a prefix length of 32 indicates a single IPv4 node.</p>
<div id="#rfc.figure.3"></div>
<pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|0|         Type = 0x0801     |      Length = 8               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |L|      Reserved                               |    PreLen     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    IPv4 Address (4 bytes)                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Type
         A fourteen-bit field carrying the value of the ER-Hop 1, IPv4
         Address, Type = 0x0801

   Length
         Specifies the length of the value field in bytes = 8.

   L Bit
         Set to indicate Loose hop.
         Cleared to indicate a strict hop.

   Reserved
         Zero on transmission.  Ignored on receipt.

   PreLen
         Prefix Length 1-32

   IP Address
         A four-byte field indicating the IP Address.
</pre>
<p></p>
<h1 id="rfc.section.2.3.2">
<a href="#rfc.section.2.3.2">2.3.2.</a> ER-Hop 2: IPv6 Prefix</h1>
<div id="#rfc.figure.4"></div>
<pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|0|          0x0802           |      Length = 20              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |L|             Reserved                        |    PreLen     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                  IPV6 address                                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                  IPV6 address (continued)                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                  IPV6 address (continued)                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                  IPV6 address (continued)                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Type
         A fourteen-bit field carrying the value of the ER-Hop 2, IPv6
         Address, Type = 0x0802

   Length
         Specifies the length of the value field in bytes = 20.

   L Bit
         Set to indicate Loose hop.
         Cleared to indicate a strict hop.

   Reserved
         Zero on transmission.  Ignored on receipt.

   PreLen
         Prefix Length 1-128

   IPv6 address
         A 128-bit unicast host addresses.
</pre>
<p></p>
<h1 id="rfc.section.2.3.3">
<a href="#rfc.section.2.3.3">2.3.3.</a> ER-Hop 3: L2 PW Address</h1>
<p id="rfc.section.2.3.3.p.1">The L2 PW Address follows attachment circuit addressing which is derived from <a href="#RFC5003">[RFC5003]</a> AII type 2, as shown here:</p>
<div id="#rfc.figure.5"></div>
<pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |0|0|          0x0802           |      Length = 18              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |L|             Reserved                        |    PreLen     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  AII Type=02  |    Length     |        Global ID              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Global ID (contd.)      |        Prefix                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |       Prefix (contd.)         |        AC ID                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      AC ID                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


    Type
         A fourteen-bit field carrying the value of the ER-Hop 3, L2 PW 
         Address, Type = 0x0805

   Length
         Specifies the length of the value field in bytes = 18.

   L Bit
         Set to indicate Loose hop.
         Cleared to indicate a strict hop.

   Reserved
         Zero on transmission.  Ignored on receipt.

   PreLen
         Prefix Length 1-96

   L2 PW Address
         An AII Address as defined in [RFC5003].
</pre>
<p></p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Explicit Route TLV Processing</h1>
<p></p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#nexthopselection" id="nexthopselection">Next-Hop Selection</a>
</h1>
<p id="rfc.section.3.1.p.1">A PW Label Mapping Message containing an explicit route TLV must determine the next hop for this path. Selection of this next hop may involve a selection from a set of possible alternatives. The mechanism for making a selection from this set is implementation dependent and is outside of the scope of this specification. Selection of particular paths is also outside of the scope of this specification, but it is assumed that each node will make a best effort attempt to determine a loop-free path. Note that such best efforts may be overridden by local policy.</p>
<p id="rfc.section.3.1.p.2">To determine the next hop for the path, a node performs the following steps:</p>
<p></p>

<ol>
<li>If a node receiving the Label Mapping Message including an ER- Hop Type that is not supported MUST not progress the Label Mapping message to downstream LSR and MUST send back an &#8220;Unknown TLV&#8221; Notification.</li>
<li>The node receiving the Label Mapping Message must first evaluate the first ER-Hop. If the L bit is not set in the first ER-Hop and if the node is not part of the abstract node described by the first ER-Hop, it has received the message in error, and should return a "Bad Initial ER-Hop Error" status. If the L bit is set and the local node is not part of the abstract node described by the first ER-Hop, the node selects a next hop that is along the path to the abstract node described by the first ER-Hop. If there is no first ER-Hop, the message is also in error and the system should return a "Bad Explicit Routing TLV Error" status using a Notification Message sent upstream.</li>
<li>If there is no second ER-Hop, this indicates the end of the explicit route. The explicit route TLV should be removed from the Label Mapping Message. This node may or may not be the end of the PW. Processing continues with section 3.2, where a new explicit route TLV may be added to the Label Mapping Message.</li>
<li>If the node is also a part of the abstract node described by the second ER-Hop, then the node deletes the first ER-Hop and continues processing with step 2, above. Note that this makes the second ER-Hop into the first ER-Hop of the next iteration.</li>
<li>The node determines if it is topologically adjacent to the abstract node described by the second ER-Hop. If so, the node selects a particular next hop which is a member of the abstract node. The node then deletes the first ER-Hop and continues processing with section 3.2.</li>
<li>Next, the node selects a next hop within the abstract node of the first ER-Hop that is along the path to the abstract node of the second ER-Hop. If no such path exists then there are two cases:<ol style="list-style-type: lower-alpha">
<li>If the second ER-Hop is a strict ER-Hop, then there is an error and the node should return a "Bad Strict Node Error" status.</li>
<li>Otherwise, if the second ER-Hop is a loose ER-Hop, then the node selects any next hop that is along the path to the next abstract node. If no path exists within the MPLS domain, then there is an error, and the node should return a "Bad Loose Node Error" status.</li>
</ol>
</li>
<li>Finally, the node replaces the first ER-Hop with any ER-Hop that denotes an abstract node containing the next hop. This is necessary so that when the explicit route is received by the next hop, it will be accepted.</li>
<li>Progress the Label Mapping Message to the next hop.</li>
</ol>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#AddingERHops" id="AddingERHops">Adding ER Hops to the Explicit Route TLV</a>
</h1>
<p id="rfc.section.3.2.p.1">After selecting a next hop, the node may alter the explicit route in the following ways.</p>
<p id="rfc.section.3.2.p.2">If, as part of executing the algorithm in <a href="#nexthopselection">Section 3.1</a>, the explicit route TLV is removed, the node may add a new explicit route TLV.</p>
<p id="rfc.section.3.2.p.3">Otherwise, if the node is a member of the abstract node for the first ER-Hop, then a series of ER-Hops may be inserted before the First ER-Hop or may replace the first ER-Hop. Each ER-Hop in this series must denote an abstract node that is a subset of the current abstract node.</p>
<p id="rfc.section.3.2.p.4">Alternately, if the first ER-Hop is a loose ER-Hop, an arbitrary series of ER-Hops may be inserted prior to the first ER-Hop.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> IANA Considerations</h1>
<p id="rfc.section.4.p.1">RFC5036 <a href="#RFC5036">[RFC5036]</a> defines the LDP TLV name space which is maintained by IANA as &#8220;LDP TLV Registry&#8221;. TLV types for the Explicit Route TLV, IPv4 Prefix ER-Hop TLV, and the IPv6 Prefix ER-Hop TLV are already defined in the LDP TLV Registry.</p>
<p id="rfc.section.4.p.2">This draft proposes one new TLV type:t.</p>
<p id="rfc.section.4.p.3">TLV Type (Suggested)</p>
<p id="rfc.section.4.p.4">-------------------------------------- ----------</p>
<p id="rfc.section.4.p.5">L2 PW Address of Switching Point 0x0805</p>
<p></p>
<p></p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.5.p.1">This document introduces no new security considerations over <a href="#RFC5036">[RFC5036]</a>, <a href="#RFC4447">[RFC4447]</a> and <a href="#I-D.ietf-pwe3-dynamic-ms-pw">[I-D.ietf-pwe3-dynamic-ms-pw]</a>.</p>
<p></p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Acknoledgements</h1>
<p id="rfc.section.6.p.1">The authors gratefully acknowledge the input of Lizhong Jin.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5003">[RFC5003]</b></td>
<td class="top">
<a>Metz, C.</a>, <a>Martini, L.</a>, <a>Balus, F.</a> and <a>J. Sugimoto</a>, "<a href="http://tools.ietf.org/html/rfc5003">Attachment Individual Identifier (AII) Types for Aggregation</a>", RFC 5003, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4447">[RFC4447]</b></td>
<td class="top">
<a>Martini, L.</a>, <a>Rosen, E.</a>, <a>El-Aawar, N.</a>, <a>Smith, T.</a> and <a>G. Heron</a>, "<a href="http://tools.ietf.org/html/rfc4447">Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)</a>", RFC 4447, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-pwe3-dynamic-ms-pw">[I-D.ietf-pwe3-dynamic-ms-pw]</b></td>
<td class="top">
<a>Martini, L</a>, <a>Bocci, M</a> and <a>F Balus</a>, "<a href="http://tools.ietf.org/html/draft-ietf-pwe3-dynamic-ms-pw-14">Dynamic Placement of Multi Segment Pseudowires</a>", Internet-Draft draft-ietf-pwe3-dynamic-ms-pw-14, July 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5036">[RFC5036]</b></td>
<td class="top">
<a>Andersson, L.</a>, <a>Minei, I.</a> and <a>B. Thomas</a>, "<a href="http://tools.ietf.org/html/rfc5036">LDP Specification</a>", RFC 5036, October 2007.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Pranjal Dutta</span> 
	  <span class="n hidden">
		<span class="family-name">Dutta</span>
	  </span>
	</span>
	<span class="org vcardline">Alcatel-Lucent</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:pranjal.dutta@alcatel-lucent.com">pranjal.dutta@alcatel-lucent.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Matthew Bocci</span> 
	  <span class="n hidden">
		<span class="family-name">Bocci</span>
	  </span>
	</span>
	<span class="org vcardline">Alcatel-Lucent</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:matthew.bocci@alcatel-lucent.com">matthew.bocci@alcatel-lucent.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Luca Martini</span> 
	  <span class="n hidden">
		<span class="family-name">Martini</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:lmartini@cisco.com">lmartini@cisco.com</a></span>

  </address>
</div>

</body>
</html>