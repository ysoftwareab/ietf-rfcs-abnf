<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Guidance on End-to-End E-mail Security</title>
<meta content="Daniel Kahn Gillmor" name="author">
<meta content="
       End-to-end cryptographic protections for e-mail messages can provide useful security.
However, the standards for providing cryptographic protection are extremely flexible.
That flexibility can trap users and cause surprising failures.
This document offers guidance for mail user agent implementers that need to compose or interpret e-mail messages with end-to-end cryptographic protection.
It provides a useful set of vocabulary as well as suggestions to avoid common failures. 
    " name="description">
<meta content="xml2rfc 3.12.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-lamps-e2e-mail-guidance-02" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.7.1
    pycountry 22.1.10
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/e2e-mail-guidance-ymk1v9po.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Guidance on End-to-End E-mail Security</td>
<td class="right">January 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Gillmor</td>
<td class="center">Expires 29 July 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">lamps</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-lamps-e2e-mail-guidance-02</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-01-25" class="published">25 January 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-07-29">29 July 2022</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">D.K. Gillmor, <span class="editor">Ed.</span>
</div>
<div class="org">ACLU</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Guidance on End-to-End E-mail Security</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">End-to-end cryptographic protections for e-mail messages can provide useful security.
However, the standards for providing cryptographic protection are extremely flexible.
That flexibility can trap users and cause surprising failures.
This document offers guidance for mail user agent implementers that need to compose or interpret e-mail messages with end-to-end cryptographic protection.
It provides a useful set of vocabulary as well as suggestions to avoid common failures.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 29 July 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-requirements-language" class="xref">Requirements Language</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2.2.1">
                    <p id="section-toc.1-1.1.2.2.2.1.1" class="keepWithNext"><a href="#section-1.2.1" class="xref">1.2.1</a>.  <a href="#name-structural-headers" class="xref">Structural Headers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2.2.2">
                    <p id="section-toc.1-1.1.2.2.2.2.1" class="keepWithNext"><a href="#section-1.2.2" class="xref">1.2.2</a>.  <a href="#name-user-facing-headers" class="xref">User-Facing Headers</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-usability" class="xref">Usability</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-simplicity" class="xref">Simplicity</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-e-mail-users-want-a-familia" class="xref">E-mail Users Want a Familiar Experience</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-warning-about-failure-vs-an" class="xref">Warning About Failure vs. Announcing Success</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-types-of-protection" class="xref">Types of Protection</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-cryptographic-mime-message-" class="xref">Cryptographic MIME Message Structure</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-cryptographic-layers" class="xref">Cryptographic Layers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-s-mime-cryptographic-layers" class="xref">S/MIME Cryptographic Layers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-pgp-mime-cryptographic-laye" class="xref">PGP/MIME Cryptographic Layers</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-cryptographic-envelope" class="xref">Cryptographic Envelope</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-cryptographic-payload" class="xref">Cryptographic Payload</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-types-of-cryptographic-enve" class="xref">Types of Cryptographic Envelope</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="xref">4.4.1</a>.  <a href="#name-simple-cryptographic-envelo" class="xref">Simple Cryptographic Envelopes</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.2">
                    <p id="section-toc.1-1.4.2.4.2.2.1"><a href="#section-4.4.2" class="xref">4.4.2</a>.  <a href="#name-multilayer-cryptographic-en" class="xref">Multilayer Cryptographic Envelopes</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-errant-crytptographic-layer" class="xref">Errant Crytptographic Layers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.1">
                    <p id="section-toc.1-1.4.2.5.2.1.1"><a href="#section-4.5.1" class="xref">4.5.1</a>.  <a href="#name-mailing-list-wrapping" class="xref">Mailing List Wrapping</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.2">
                    <p id="section-toc.1-1.4.2.5.2.2.1"><a href="#section-4.5.2" class="xref">4.5.2</a>.  <a href="#name-a-baroque-example" class="xref">A Baroque Example</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-message-composition" class="xref">Message Composition</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-message-composition-algorit" class="xref">Message Composition Algorithm</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-encryption-outside-signatur" class="xref">Encryption Outside, Signature Inside</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-avoid-offering-encrypted-on" class="xref">Avoid Offering Encrypted-only Messages</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-composing-a-reply-message" class="xref">Composing a Reply Message</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-message-interpretation" class="xref">Message Interpretation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-rendering-well-formed-messa" class="xref">Rendering Well-formed Messages</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-errant-cryptographic-layers" class="xref">Errant Cryptographic Layers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="xref">6.2.1</a>.  <a href="#name-errant-signing-layer" class="xref">Errant Signing Layer</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a href="#section-6.2.2" class="xref">6.2.2</a>.  <a href="#name-errant-encryption-layer" class="xref">Errant Encryption Layer</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-forwarded-messages-with-cry" class="xref">Forwarded Messages with Cryptographic Protection</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-signature-failures" class="xref">Signature failures</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-reasoning-about-message-par" class="xref">Reasoning about Message Parts</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-main-body-part" class="xref">Main Body Part</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-attachments" class="xref">Attachments</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-mime-part-examples" class="xref">MIME Part Examples</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-certificate-management" class="xref">Certificate Management</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-peer-certificates" class="xref">Peer Certificates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="xref">8.1.1</a>.  <a href="#name-cert-discovery-from-incomin" class="xref">Cert Discovery from Incoming Messages</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.2">
                    <p id="section-toc.1-1.8.2.1.2.2.1"><a href="#section-8.1.2" class="xref">8.1.2</a>.  <a href="#name-certificate-directories" class="xref">Certificate Directories</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.3">
                    <p id="section-toc.1-1.8.2.1.2.3.1"><a href="#section-8.1.3" class="xref">8.1.3</a>.  <a href="#name-peer-certificate-selection" class="xref">Peer Certificate Selection</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.4">
                    <p id="section-toc.1-1.8.2.1.2.4.1"><a href="#section-8.1.4" class="xref">8.1.4</a>.  <a href="#name-checking-for-revocation" class="xref">Checking for Revocation</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-local-certificates" class="xref">Local Certificates</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="xref">8.2.1</a>.  <a href="#name-getting-a-certificate-for-t" class="xref">Getting a Certificate for the User</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.2">
                    <p id="section-toc.1-1.8.2.2.2.2.1"><a href="#section-8.2.2" class="xref">8.2.2</a>.  <a href="#name-local-certificate-maintenan" class="xref">Local Certificate Maintenance</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.3">
                    <p id="section-toc.1-1.8.2.2.2.3.1"><a href="#section-8.2.3" class="xref">8.2.3</a>.  <a href="#name-shipping-certificates-in-ou" class="xref">Shipping Certificates in Outbound Messages</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-certificate-authorities" class="xref">Certificate Authorities</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-common-pitfalls-and-guideli" class="xref">Common Pitfalls and Guidelines</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-acknowledgements" class="xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="xref">13.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="xref">13.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-test-vectors" class="xref">Test Vectors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-document-considerations" class="xref">Document Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#appendix-B.1" class="xref">B.1</a>.  <a href="#name-document-history" class="xref">Document History</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1.2.1">
                    <p id="section-toc.1-1.15.2.1.2.1.1"><a href="#appendix-B.1.1" class="xref">B.1.1</a>.  <a href="#name-substantive-changes-from-dr" class="xref">Substantive changes from draft-ietf-...-01 to draft-ietf-...-02</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1.2.2">
                    <p id="section-toc.1-1.15.2.1.2.2.1"><a href="#appendix-B.1.2" class="xref">B.1.2</a>.  <a href="#name-substantive-changes-from-dra" class="xref">Substantive changes from draft-ietf-...-00 to draft-ietf-...-01</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1.2.3">
                    <p id="section-toc.1-1.15.2.1.2.3.1"><a href="#appendix-B.1.3" class="xref">B.1.3</a>.  <a href="#name-substantive-changes-from-draf" class="xref">Substantive changes from draft-dkg-...-01 to draft-ietf-...-00</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1.2.4">
                    <p id="section-toc.1-1.15.2.1.2.4.1"><a href="#appendix-B.1.4" class="xref">B.1.4</a>.  <a href="#name-substantive-changes-from-draft" class="xref">Substantive changes from draft-dkg-...-00 to draft-dkg-...-01</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-C" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">E-mail end-to-end security using S/MIME (<span>[<a href="#RFC8551" class="xref">RFC8551</a>]</span>) and PGP/MIME (<span>[<a href="#RFC3156" class="xref">RFC3156</a>]</span>) cryptographic standards can provide integrity, authentication and confidentiality to MIME (<span>[<a href="#RFC4289" class="xref">RFC4289</a>]</span>) e-mail messages.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">However, there are many ways that a receiving mail user agent can misinterpret or accidentally break these security guarantees (e.g., <span>[<a href="#EFAIL" class="xref">EFAIL</a>]</span>).<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">A mail user agent that interprets a message with end-to-end cryptographic protections needs to do so defensively, staying alert to different ways that these protections can be bypassed by mangling (either malicious or accidental) or a failed user experience.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">A mail user agent that generates a message with end-to-end cryptographic protections should be aware of these defensive interpretation strategies, and should compose any new outbound message conservatively if they want the protections to remain intact.<a href="#section-1-4" class="pilcrow">¶</a></p>
<div id="requirements-language">
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 (<span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> and <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span>) when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-1.2">
        <h3 id="name-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.2-1">For the purposes of this document, we define the following concepts:<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-2.1">
            <em>MUA</em> is short for Mail User Agent; an e-mail client.<a href="#section-1.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.2">
            <em>Protection</em> of message data refers to cryptographic encryption and/or signatures, providing confidentiality, authenticity, and/or integrity.<a href="#section-1.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.3">
            <em>Cryptographic Layer</em>, <em>Cryptographic Envelope</em>, <em>Cryptographic Payload</em>, and <em>Errant Cryptographic Layer</em> are defined in <a href="#cryptographic-structure" class="xref">Section 4</a><a href="#section-1.2-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.4">A <em>well-formed</em> e-mail message with cryptographic protection has both a <em>Cryptographic Envelope</em> and a <em>Cryptographic Payload</em>.<a href="#section-1.2-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.5">
            <em>Structural Headers</em> are documented in <a href="#structural-headers" class="xref">Section 1.2.1</a>.<a href="#section-1.2-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.6">
            <em>User-Facing Headers</em> are documented in <a href="#user-facing-headers" class="xref">Section 1.2.2</a>.<a href="#section-1.2-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.7">
            <em>Main Body Part</em> is the part (or parts) that are typically rendered to the user as the message itself (not "as an attachment).  See <a href="#main-body-part" class="xref">Section 7.1</a>.<a href="#section-1.2-2.7" class="pilcrow">¶</a>
</li>
        </ul>
<div id="structural-headers">
<section id="section-1.2.1">
          <h4 id="name-structural-headers">
<a href="#section-1.2.1" class="section-number selfRef">1.2.1. </a><a href="#name-structural-headers" class="section-name selfRef">Structural Headers</a>
          </h4>
<p id="section-1.2.1-1">A message header whose name begins with <code>Content-</code> is referred to in this document as a "structural" header.<a href="#section-1.2.1-1" class="pilcrow">¶</a></p>
<p id="section-1.2.1-2">These headers indicate something about the specific MIME part they are attached to, and cannot be transferred or copied to other parts without endangering the readability of the message.<a href="#section-1.2.1-2" class="pilcrow">¶</a></p>
<p id="section-1.2.1-3">This includes (but is not limited to):<a href="#section-1.2.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2.1-4.1">
              <code>Content-Type</code><a href="#section-1.2.1-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-1.2.1-4.2">
              <code>Content-Transfer-Encoding</code><a href="#section-1.2.1-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-1.2.1-4.3">
              <code>Content-Disposition</code><a href="#section-1.2.1-4.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-1.2.1-5">FIXME: are there any non-<code>Content-*</code> headers we should consider as structural?<a href="#section-1.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="user-facing-headers">
<section id="section-1.2.2">
          <h4 id="name-user-facing-headers">
<a href="#section-1.2.2" class="section-number selfRef">1.2.2. </a><a href="#name-user-facing-headers" class="section-name selfRef">User-Facing Headers</a>
          </h4>
<p id="section-1.2.2-1">Of all the headers that an e-mail message may contain, only a handful are typically presented directly to the user.
The user-facing headers are:<a href="#section-1.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2.2-2.1">
              <code>Subject</code><a href="#section-1.2.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-1.2.2-2.2">
              <code>From</code><a href="#section-1.2.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-1.2.2-2.3">
              <code>To</code><a href="#section-1.2.2-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-1.2.2-2.4">
              <code>Cc</code><a href="#section-1.2.2-2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-1.2.2-2.5">
              <code>Date</code><a href="#section-1.2.2-2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-1.2.2-2.6">
              <code>Reply-To</code><a href="#section-1.2.2-2.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-1.2.2-2.7">
              <code>Followup-To</code><a href="#section-1.2.2-2.7" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-1.2.2-3">The above is a complete list.  No other headers are considered "user-facing".<a href="#section-1.2.2-3" class="pilcrow">¶</a></p>
<p id="section-1.2.2-4">Other headers may affect the visible rendering of the message (e.g., <code>References</code> and <code>In-Reply-To</code> may affect the placement of a message in a threaded discussion), but they are not directly displayed to the user and so are not considered "user-facing".<a href="#section-1.2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="usability">
<section id="section-2">
      <h2 id="name-usability">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-usability" class="section-name selfRef">Usability</a>
      </h2>
<p id="section-2-1">Any MUA that enables its user to transition from unprotected messages to messages with end-to-end cryptographic protection needs to consider how the user understands this transition.
That said, the primary goal of the user of an MUA is communication -- so interface elements that get in the way of communication should be avoided where possible.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Furthermore, it is likely is that the user will continue to encounter unprotected messages, and may need to send unprotected messages (for example, if a given recipient cannot handle cryptographic protections).
This means that the MUA needs to provide the user with some guidance, so that they understand what protections any given message or conversation has.
But the user should not be overwhelmed with choices or presented with unactionable information.<a href="#section-2-2" class="pilcrow">¶</a></p>
<div id="simplicity">
<section id="section-2.1">
        <h3 id="name-simplicity">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-simplicity" class="section-name selfRef">Simplicity</a>
        </h3>
<p id="section-2.1-1">The end user (the operator of the MUA) is unlikely to understand complex end-to-end cryptographic protections on any e-mail message, so keep it simple.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">For clarity to the user, any cryptographic protections should apply to the message as a whole, not just to some subparts.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">This is true for message composition: the standard message composition user interface of an MUA should offer minimal controls which indicate which types of protection to apply to the new message as a whole.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">This is also true for message interpretation: the standard message rendering user interface of an MUA should offer a minimal, clear indicator about the end-to-end cryptographic status of the message as a whole.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="similar-ux">
<section id="section-2.2">
        <h3 id="name-e-mail-users-want-a-familia">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-e-mail-users-want-a-familia" class="section-name selfRef">E-mail Users Want a Familiar Experience</a>
        </h3>
<p id="section-2.2-1">A person communicating over the Internet today often has many options for reaching their desired correspondent, including web-based bulletin boards, contact forms, and instant messaging services.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">E-mail offers a few distinctions from these other systems, most notably features like:<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2-3.1">Ubiquity: Most correspondents will have an e-mail address, while not everyone is present on every alternate messaging service,<a href="#section-2.2-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.2-3.2">Federation: interaction between users on distinct domains who have not agreed on a common communications provider is still possible, and<a href="#section-2.2-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.2-3.3">User Control: the user can interact with the e-mail system using a MUA of their choosing, including automation and other control over their preferred and/or customized workflow.<a href="#section-2.2-3.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.2-4">Other systems (like some popular instant messaging applications, such as WhatsApp and Signal Private Messenger) offer built-in end-to-end cryptographic protections by default, which are simpler for the user to understand.
("All the messages I see on Signal are confidential and integrity-protected" is a clean user story)<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2-5">A user of e-mail is likely using e-mail instead of other systems because of the distinctions outlined above.
When adding end-to-end cryptographic protection to an e-mail endpoint, care should be taken not to negate any of the distinct features of e-mail as a whole.
If these features are violated to provide end-to-end crypto, the user may just as well choose one of the other systems that don't have the drawbacks that e-mail has.
Implmenters should try to provide end-to-end protections that retain the familiar experience of e-mail itself.<a href="#section-2.2-5" class="pilcrow">¶</a></p>
<p id="section-2.2-6">Furthermore, an e-mail user is likely to regularly interact with other e-mail correspondents who <em>cannot</em> handle or produce end-to-end cryptographic protections.
Care should be taken that enabling cryptography in a MUA does not inadvertently limit the ability of the user to interact with legacy correspondents.<a href="#section-2.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-indicators">
<section id="section-2.3">
        <h3 id="name-warning-about-failure-vs-an">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-warning-about-failure-vs-an" class="section-name selfRef">Warning About Failure vs. Announcing Success</a>
        </h3>
<p id="section-2.3-1">Moving the web from http to https offers useful historical similarities to adding end-to-end encryption to e-mail.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">In particular, the indicators of what is "secure" vs. "insecure" for web browsers have changed over time.
For example, years ago the default experience was http, and https sites were flagged with "secure" indicators like a lock icon.
In 2018, some browsers reversed that process by downplaying https, and instead visibly marking http as "not secure" (see <span>[<a href="#chrome-indicators" class="xref">chrome-indicators</a>]</span>).<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">By analogy, when the user of a MUA first enables end-to-end cryptographic protection, it's likely that they will want to see which messages <em>have</em> protection.
But a user whose e-mail communications are entirely end-to-end protected might instead want to know which messages do <em>not</em> have the expected protections.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.3-4">Note also that some messages are expected to be confidential, but other messages are expected to be public -- the types of protection (see <a href="#types-of-protection" class="xref">Section 3</a>) that apply to each particular message will be different.
And the types of protection that are <em>expected</em> to be present in any context might differ (for example, by sender, by thread, or by date).<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<p id="section-2.3-5">It is out of scope for this document to define expectations about protections for any given message, but an implementer who cares about usable experience should be deliberate and judicious about the expectations their interface assumes that the user has in a given context.<a href="#section-2.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="types-of-protection">
<section id="section-3">
      <h2 id="name-types-of-protection">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-types-of-protection" class="section-name selfRef">Types of Protection</a>
      </h2>
<p id="section-3-1">A given message might be:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">signed,<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.2">encrypted,<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.3">both signed and encrypted, or<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.4">none of the above.<a href="#section-3-2.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-3-3">Given that many e-mail messages offer no cryptographic protections, the user needs to be able to detect which protections are present for any given message.<a href="#section-3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cryptographic-structure">
<section id="section-4">
      <h2 id="name-cryptographic-mime-message-">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-cryptographic-mime-message-" class="section-name selfRef">Cryptographic MIME Message Structure</a>
      </h2>
<p id="section-4-1">Implementations use the structure of an e-mail message to protect the headers.
This section establishes some conventions about how to think about message structure.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="cryptographic-layer">
<section id="section-4.1">
        <h3 id="name-cryptographic-layers">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-cryptographic-layers" class="section-name selfRef">Cryptographic Layers</a>
        </h3>
<p id="section-4.1-1">"Cryptographic Layer" refers to a MIME substructure that supplies some cryptographic protections to an internal MIME subtree.
The internal subtree is known as the "protected part" though of course it may itself be a multipart object.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">In the diagrams below, <span class="unicode">"↧" (DOWNWARDS ARROW FROM BAR, U+21A7)</span> indicates "decrypts to", and <span class="unicode">"⇩" (DOWNWARDS WHITE ARROW, U+21E9)</span> indicates "unwraps to".<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<div id="smime-cryptographic-layers">
<section id="section-4.1.1">
          <h4 id="name-s-mime-cryptographic-layers">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-s-mime-cryptographic-layers" class="section-name selfRef">S/MIME Cryptographic Layers</a>
          </h4>
<p id="section-4.1.1-1">For S/MIME <span>[<a href="#RFC8551" class="xref">RFC8551</a>]</span>, there are four forms of Cryptographic Layers: multipart/signed, PKCS#7 signed-data, PKCS7 enveloped-data, PKCS7 authEnveloped-data.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<div id="smime-multipart-signed">
<section id="section-4.1.1.1">
            <h5 id="name-s-mime-multipart-signed-cry">
<a href="#section-4.1.1.1" class="section-number selfRef">4.1.1.1. </a><a href="#name-s-mime-multipart-signed-cry" class="section-name selfRef">S/MIME Multipart Signed Cryptographic Layer</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-4.1.1.1-1">
<pre>
└┬╴multipart/signed; protocol="application/pkcs7-signature"
 ├─╴[protected part]
 └─╴application/pkcs7-signature
</pre><a href="#section-4.1.1.1-1" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1.1-2">This MIME layer offers authentication and integrity.<a href="#section-4.1.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="smime-pkcs7-signed-data">
<section id="section-4.1.1.2">
            <h5 id="name-s-mime-pkcs7-signed-data-cr">
<a href="#section-4.1.1.2" class="section-number selfRef">4.1.1.2. </a><a href="#name-s-mime-pkcs7-signed-data-cr" class="section-name selfRef">S/MIME PKCS7 signed-data Cryptographic Layer</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-4.1.1.2-1">
<pre>
└─╴application/pkcs7-mime; smime-type="signed-data"
 ⇩ (unwraps to)
 └─╴[protected part]
</pre><a href="#section-4.1.1.2-1" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1.2-2">This MIME layer offers authentication and integrity.<a href="#section-4.1.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="smime-pkcs7-enveloped-data">
<section id="section-4.1.1.3">
            <h5 id="name-s-mime-pkcs7-enveloped-data">
<a href="#section-4.1.1.3" class="section-number selfRef">4.1.1.3. </a><a href="#name-s-mime-pkcs7-enveloped-data" class="section-name selfRef">S/MIME PKCS7 enveloped-data Cryptographic Layer</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-4.1.1.3-1">
<pre>
└─╴application/pkcs7-mime; smime-type="enveloped-data"
 ↧ (decrypts to)
 └─╴[protected part]
</pre><a href="#section-4.1.1.3-1" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1.3-2">This MIME layer offers confidentiality.<a href="#section-4.1.1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="smime-pkcs7-authenveloped-data">
<section id="section-4.1.1.4">
            <h5 id="name-s-mime-pkcs7-authenveloped-">
<a href="#section-4.1.1.4" class="section-number selfRef">4.1.1.4. </a><a href="#name-s-mime-pkcs7-authenveloped-" class="section-name selfRef">S/MIME PKCS7 authEnveloped-data Cryptographic Layer</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-4.1.1.4-1">
<pre>
└─╴application/pkcs7-mime; smime-type="authEnveloped-data"
 ↧ (decrypts to)
 └─╴[protected part]
</pre><a href="#section-4.1.1.4-1" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1.4-2">This MIME layer offers confidentiality and integrity.<a href="#section-4.1.1.4-2" class="pilcrow">¶</a></p>
<p id="section-4.1.1.4-3">Note that <code>enveloped-data</code> (<a href="#smime-pkcs7-enveloped-data" class="xref">Section 4.1.1.3</a>) and <code>authEnveloped-data</code> (<a href="#smime-pkcs7-authenveloped-data" class="xref">Section 4.1.1.4</a>) have identical message structure and semantics.
The only difference between the two is ciphertext malleability.<a href="#section-4.1.1.4-3" class="pilcrow">¶</a></p>
<p id="section-4.1.1.4-4">The examples in this document only include <code>enveloped-data</code>, but the implications for that layer apply to <code>authEnveloped-data</code> as well.<a href="#section-4.1.1.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pkcs7-compression-is-not-a-cryptographic-layer">
<section id="section-4.1.1.5">
            <h5 id="name-pkcs7-compression-is-not-a-">
<a href="#section-4.1.1.5" class="section-number selfRef">4.1.1.5. </a><a href="#name-pkcs7-compression-is-not-a-" class="section-name selfRef">PKCS7 Compression is NOT a Cryptographic Layer</a>
            </h5>
<p id="section-4.1.1.5-1">The Cryptographic Message Syntax (CMS) provides a MIME compression layer (<code>smime-type="compressed-data"</code>), as defined in <span>[<a href="#RFC3274" class="xref">RFC3274</a>]</span>.
While the compression layer is technically a part of CMS, it is not considered a Cryptographic Layer for the purposes of this document.<a href="#section-4.1.1.5-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="pgpmime-cryptographic-layers">
<section id="section-4.1.2">
          <h4 id="name-pgp-mime-cryptographic-laye">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-pgp-mime-cryptographic-laye" class="section-name selfRef">PGP/MIME Cryptographic Layers</a>
          </h4>
<p id="section-4.1.2-1">For PGP/MIME <span>[<a href="#RFC3156" class="xref">RFC3156</a>]</span> there are two forms of Cryptographic Layers, signing and encryption.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<div id="pgpmime-multipart-signed">
<section id="section-4.1.2.1">
            <h5 id="name-pgp-mime-signing-cryptograp">
<a href="#section-4.1.2.1" class="section-number selfRef">4.1.2.1. </a><a href="#name-pgp-mime-signing-cryptograp" class="section-name selfRef">PGP/MIME Signing Cryptographic Layer (multipart/signed)</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-4.1.2.1-1">
<pre>
└┬╴multipart/signed; protocol="application/pgp-signature"
 ├─╴[protected part]
 └─╴application/pgp-signature
</pre><a href="#section-4.1.2.1-1" class="pilcrow">¶</a>
</div>
<p id="section-4.1.2.1-2">This MIME layer offers authenticity and integrity.<a href="#section-4.1.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pgpmime-multipart-encrypted">
<section id="section-4.1.2.2">
            <h5 id="name-pgp-mime-encryption-cryptog">
<a href="#section-4.1.2.2" class="section-number selfRef">4.1.2.2. </a><a href="#name-pgp-mime-encryption-cryptog" class="section-name selfRef">PGP/MIME Encryption Cryptographic Layer (multipart/encrypted)</a>
            </h5>
<div class="alignLeft art-text artwork" id="section-4.1.2.2-1">
<pre>
└┬╴multipart/encrypted
 ├─╴application/pgp-encrypted
 └─╴application/octet-stream
  ↧ (decrypts to)
  └─╴[protected part]
</pre><a href="#section-4.1.2.2-1" class="pilcrow">¶</a>
</div>
<p id="section-4.1.2.2-2">This MIME layer can offer any of:<a href="#section-4.1.2.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.2.2-3.1">confidentiality (via a Symmetrically Encrypted Data Packet, see Section 5.7 of <span>[<a href="#RFC4880" class="xref">RFC4880</a>]</span>; a MUA MUST NOT generate this form due to ciphertext malleability)<a href="#section-4.1.2.2-3.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.1.2.2-3.2">confidentiality and integrity (via a Symmetrically Encrypted Integrity Protected Data Packet (SEIPD), see section 5.13 of <span>[<a href="#RFC4880" class="xref">RFC4880</a>]</span>), or<a href="#section-4.1.2.2-3.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-4.1.2.2-3.3">confidentiality, integrity, and authenticity all together (by including an OpenPGP Signature Packet within the SEIPD).<a href="#section-4.1.2.2-3.3" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="cryptographic-envelope">
<section id="section-4.2">
        <h3 id="name-cryptographic-envelope">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-cryptographic-envelope" class="section-name selfRef">Cryptographic Envelope</a>
        </h3>
<p id="section-4.2-1">The Cryptographic Envelope is the largest contiguous set of Cryptographic Layers of an e-mail message starting with the outermost MIME type (that is, with the Content-Type of the message itself).<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">If the Content-Type of the message itself is not a Cryptographic Layer, then the message has no cryptographic envelope.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">"Contiguous" in the definition above indicates that if a Cryptographic Layer is the protected part of another Cryptographic Layer, the layers together comprise a single Cryptographic Envelope.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">Note that if a non-Cryptographic Layer intervenes, all Cryptographic Layers within the non-Cryptographic Layer <em>are not</em> part of the Cryptographic Envelope.
They are Errant Cryptographic Layers (see <a href="#errant-cryptographic-layers" class="xref">Section 4.5</a>).<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2-5">Note also that the ordering of the Cryptographic Layers implies different cryptographic properties.
A signed-then-encrypted message is different than an encrypted-then-signed message.
See <a href="#sign-then-encrypt" class="xref">Section 5.2</a>.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cryptographic-payload">
<section id="section-4.3">
        <h3 id="name-cryptographic-payload">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-cryptographic-payload" class="section-name selfRef">Cryptographic Payload</a>
        </h3>
<p id="section-4.3-1">The Cryptographic Payload of a message is the first non-Cryptographic Layer -- the "protected part" -- within the Cryptographic Envelope.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="types-of-cryptographic-envelope">
<section id="section-4.4">
        <h3 id="name-types-of-cryptographic-enve">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-types-of-cryptographic-enve" class="section-name selfRef">Types of Cryptographic Envelope</a>
        </h3>
<div id="simple-cryptographic-envelopes">
<section id="section-4.4.1">
          <h4 id="name-simple-cryptographic-envelo">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-simple-cryptographic-envelo" class="section-name selfRef">Simple Cryptographic Envelopes</a>
          </h4>
<p id="section-4.4.1-1">As described above, if the "protected part" identified in the sction above is not itself a Cryptographic Layer, that part <em>is</em> the Cryptographic Payload.<a href="#section-4.4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.4.1-2">If the application wants to generate a message that is both encrypted and signed, it MAY use the simple MIME structure from <a href="#pgpmime-multipart-encrypted" class="xref">Section 4.1.2.2</a> by ensuring that the <span>[<a href="#RFC4880" class="xref">RFC4880</a>]</span> Encrypted Message within the <code>application/octet-stream</code> part contains an <span>[<a href="#RFC4880" class="xref">RFC4880</a>]</span> Signed Message (the final option described in <a href="#pgpmime-multipart-encrypted" class="xref">Section 4.1.2.2</a>.<a href="#section-4.4.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="multilayer-cryptographic-envelopes">
<section id="section-4.4.2">
          <h4 id="name-multilayer-cryptographic-en">
<a href="#section-4.4.2" class="section-number selfRef">4.4.2. </a><a href="#name-multilayer-cryptographic-en" class="section-name selfRef">Multilayer Cryptographic Envelopes</a>
          </h4>
<p id="section-4.4.2-1">It is possible to construct a Cryptographic Envelope consisting of multiple layers with either S/MIME or PGP/MIME , for example using the following structure:<a href="#section-4.4.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4.2-2">
<pre>
A └─╴application/pkcs7-mime; smime-type="enveloped-data"
B  ↧ (decrypts to)
C  └─╴application/pkcs7-mime; smime-type="signed-data"
D   ⇩ (unwraps to)
E   └─╴[protected part]
</pre><a href="#section-4.4.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.4.2-3">When handling such a message, the properties of the Cryptographic Envelope are derived from the series <code>A</code>, <code>C</code>.<a href="#section-4.4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.4.2-4">As noted in <a href="#simple-cryptographic-envelopes" class="xref">Section 4.4.1</a>, PGP/MIME applications also have a simpler MIME construction available with the same cryptographic properties.<a href="#section-4.4.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="errant-cryptographic-layers">
<section id="section-4.5">
        <h3 id="name-errant-crytptographic-layer">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-errant-crytptographic-layer" class="section-name selfRef">Errant Crytptographic Layers</a>
        </h3>
<p id="section-4.5-1">Due to confusion, malice, or well-intentioned tampering, a message may contain a Cryptographic Layer that is not part of the Cryptographic Envelope.
Such a layer is an Errant Cryptographic Layer.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">An Errant Cryptographic Layer SHOULD NOT contribute to the message's overall cryptographic state.<a href="#section-4.5-2" class="pilcrow">¶</a></p>
<p id="section-4.5-3">Guidance for dealing with Errant Cryptographic Layers can be found in <a href="#errant-layers" class="xref">Section 6.2</a>.<a href="#section-4.5-3" class="pilcrow">¶</a></p>
<div id="mailing-list-wrapping">
<section id="section-4.5.1">
          <h4 id="name-mailing-list-wrapping">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-mailing-list-wrapping" class="section-name selfRef">Mailing List Wrapping</a>
          </h4>
<p id="section-4.5.1-1">Some mailing list software will re-wrap a well-formed signed message before re-sending to add a footer, resulting in the following structure seen by recipients of the e-mail:<a href="#section-4.5.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.1-2">
<pre>
H └┬╴multipart/mixed
I  ├┬╴multipart/signed
J  │├─╴text/plain
K  │└─╴application/pgp-signature
L  └─╴text/plain
</pre><a href="#section-4.5.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.5.1-3">In this message, <code>L</code> is the footer added by the mailing list.  <code>I</code> is now an Errant Cryptographic Layer.<a href="#section-4.5.1-3" class="pilcrow">¶</a></p>
<p id="section-4.5.1-4">Note that this message has no Cryptographic Envelope at all.<a href="#section-4.5.1-4" class="pilcrow">¶</a></p>
<p id="section-4.5.1-5">It is NOT RECOMMENDED to produce e-mail messages with this structure, because the data in part <code>L</code> may appear to the user as though it were part of <code>J</code>, though they have different cryptographic properties.
In particular, if the user believes that the message is signed, but cannot distinguish <code>L</code> from <code>J</code> then the author of <code>L</code> can effectively tamper with content of the signed message, breaking the user's expectation of integrity and authenticity.<a href="#section-4.5.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="baroque-example">
<section id="section-4.5.2">
          <h4 id="name-a-baroque-example">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-a-baroque-example" class="section-name selfRef">A Baroque Example</a>
          </h4>
<p id="section-4.5.2-1">Consider a message with the following overcomplicated structure:<a href="#section-4.5.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.2-2">
<pre>
M └┬╴multipart/encrypted
N  ├─╴application/pgp-encrypted
O  └─╴application/octet-stream
P   ↧ (decrypts to)
Q   └┬╴multipart/signed
R    ├┬╴multipart/mixed
S    │├┬╴multipart/signed
T    ││├─╴text/plain
U    ││└─╴application/pgp-signature
V    │└─╴text/plain
W    └─╴application/pgp-signature
</pre><a href="#section-4.5.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.5.2-3">The 3 Cryptographic Layers in such a message are rooted in parts <code>M</code>, <code>Q</code>, and <code>S</code>.
But the Cryptographic Envelope of the message consists only of the properties derived from the series <code>M</code>, <code>Q</code>.
The Cryptographic Payload of the message is part <code>R</code>.
Part <code>S</code> is an Errant Cryptographic Layer.<a href="#section-4.5.2-3" class="pilcrow">¶</a></p>
<p id="section-4.5.2-4">Note that this message has both a Cryptographic Envelope <em>and</em> an Errant Cryptographic Layer.<a href="#section-4.5.2-4" class="pilcrow">¶</a></p>
<p id="section-4.5.2-5">It is NOT RECOMMENDED to generate messages with such complicated structures.
Even if a receiving MUA can parse this structure properly, it is nearly impossible to render in a way that the user can reason about the cryptographic properties of part <code>T</code> compared to part <code>V</code>.<a href="#section-4.5.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="message-composition">
<section id="section-5">
      <h2 id="name-message-composition">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-message-composition" class="section-name selfRef">Message Composition</a>
      </h2>
<p id="section-5-1">This section describes the ideal composition of an e-mail message with end-to-end cryptographic protection.
A message composed with this form is most likely to achieve its end-to-end security goals.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="composition">
<section id="section-5.1">
        <h3 id="name-message-composition-algorit">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-message-composition-algorit" class="section-name selfRef">Message Composition Algorithm</a>
        </h3>
<p id="section-5.1-1">This section roughly describes the steps that a MUA should use to compose a cryptographically-protected message that has a proper cryptographic envelope and payload.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The message composition algorithm takes three parameters:<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-3.1">
            <code>origbody</code>: the traditional unprotected message body as a well-formed MIME tree (possibly just a single MIME leaf part).
As a well-formed MIME tree, <code>origbody</code> already has structural headers present (see <a href="#structural-headers" class="xref">Section 1.2.1</a>).<a href="#section-5.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-3.2">
            <code>origheaders</code>: the intended non-structural headers for the message, represented here as a list of <code>(h,v)</code> pairs, where <code>h</code> is a header field name and <code>v</code> is the associated value.<a href="#section-5.1-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-3.3">
            <code>crypto</code>: The series of cryptographic protections to apply (for example, "sign with the secret key corresponding to X.509 certificate X, then encrypt to X.509 certificates X and Y").
This is a routine that accepts a MIME tree as input (the Cryptographic Payload), wraps the input in the appropriate Cryptographic Envelope, and returns the resultant MIME tree as output.<a href="#section-5.1-3.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.1-4">The algorithm returns a MIME object that is ready to be injected into the mail system:<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-5.1">Apply <code>crypto</code> to <code>origbody</code>, yielding MIME tree <code>output</code><a href="#section-5.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-5.2">
            <p id="section-5.1-5.2.1">For each header name and value <code>(h,v)</code> in <code>origheaders</code>:<a href="#section-5.1-5.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-5.2.2.1">Add header <code>h</code> of <code>output</code> with value <code>v</code><a href="#section-5.1-5.2.2.1" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-5.1-5.3">Return <code>output</code><a href="#section-5.1-5.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="sign-then-encrypt">
<section id="section-5.2">
        <h3 id="name-encryption-outside-signatur">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-encryption-outside-signatur" class="section-name selfRef">Encryption Outside, Signature Inside</a>
        </h3>
<p id="section-5.2-1">Users expect any message that is both signed and encrypted to be signed <em>inside</em> the encryption, and not the other way around.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Putting the signature inside the encryption has two advantages:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-3.1">The details of the signature remain confidential, visible only to the parties capable of decryption.<a href="#section-5.2-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.2-3.2">Any mail transport agent that modifies the message is unlikely to be able to accidentally break the signature.<a href="#section-5.2-3.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.2-4">A MUA SHOULD NOT generate an encrypted and signed message where the only signature is outside the encryption.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="avoid-offering-encrypted-only-messages">
<section id="section-5.3">
        <h3 id="name-avoid-offering-encrypted-on">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-avoid-offering-encrypted-on" class="section-name selfRef">Avoid Offering Encrypted-only Messages</a>
        </h3>
<p id="section-5.3-1">When generating an e-mail, the user has options about what forms of end-to-end cryptographic protections to apply to it.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">In some cases, offering any end-to-end cryptographic protection is harmful: it may confuse the recipient and offer no benefit.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">In other cases, signing a message is useful (authenticity and integrity are desirable) but encryption is either impossible (for example, if the sender does not know how to encrypt to all recipients) or meaningless (for example, an e-mail message to a mailing list that is intended to be be published to a public archive).<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<p id="section-5.3-4">In other cases, full end-to-end confidentiality, authenticity, and integrity are desirable.<a href="#section-5.3-4" class="pilcrow">¶</a></p>
<p id="section-5.3-5">It is unclear what the use case is for an e-mail message with end-to-end confidentiality but without authenticity or integrity.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
<p id="section-5.3-6">A reasonable MUA will keep its message composition interface simple, so when presenting the user with a choice of cryptographic protection, it SHOULD offer no more than three choices:<a href="#section-5.3-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-7.1">no end-to-end cryptographic protection<a href="#section-5.3-7.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-7.2">signing-only<a href="#section-5.3-7.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-7.3">signed and encrypted<a href="#section-5.3-7.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="composing-reply">
<section id="section-5.4">
        <h3 id="name-composing-a-reply-message">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-composing-a-reply-message" class="section-name selfRef">Composing a Reply Message</a>
        </h3>
<p id="section-5.4-1">When replying to a message, most MUAs compose an initial draft of the reply that contains quoted text from the original message.
A responsible MUA will take precautions to avoid leaking the cleartext of an encrypted message in such a reply.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">If the original message was end-to-end encrypted, the replying MUA MUST either:<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4-3.1">compose the reply with end-to-end encryption, or<a href="#section-5.4-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.4-3.2">avoid including quoted text from the original message.<a href="#section-5.4-3.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.4-4">In general, MUAs SHOULD prefer the first option: to compose an encrypted reply.
This is what users expect.<a href="#section-5.4-4" class="pilcrow">¶</a></p>
<p id="section-5.4-5">However, in some circumstances, the replying MUA cannot compose an encrypted reply.
For example, the MUA might not have a valid, unexpired, encryption-capable certificate for all recipients.
This can also happen during composition when a user adds a new recipient into the reply, or manually toggles the cryptographic protections to remove encryption.<a href="#section-5.4-5" class="pilcrow">¶</a></p>
<p id="section-5.4-6">In this circumstance, the composing MUA SHOULD strip the quoted text from the original message.<a href="#section-5.4-6" class="pilcrow">¶</a></p>
<p id="section-5.4-7">Note additional nuance about replies to malformed messages that contain encryption in <a href="#reply-to-errant-encryption" class="xref">Section 6.2.2.1</a>.<a href="#section-5.4-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-interpretation">
<section id="section-6">
      <h2 id="name-message-interpretation">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-message-interpretation" class="section-name selfRef">Message Interpretation</a>
      </h2>
<p id="section-6-1">Despite the best efforts of well-intentioned senders to create e-mail messages with well-formed end-to-end cryptographic protection, receiving MUAs will inevitably encounter some messages with malformed end-to-end cryptographic protection.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">This section offers guidance on dealing with both well-formed and malformed messages containing Cryptographic Layers.<a href="#section-6-2" class="pilcrow">¶</a></p>
<div id="well-formed">
<section id="section-6.1">
        <h3 id="name-rendering-well-formed-messa">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-rendering-well-formed-messa" class="section-name selfRef">Rendering Well-formed Messages</a>
        </h3>
<p id="section-6.1-1">A message is well-formed when it has a Cryptographic Envelope, a Cryptographic Payload, and no Errant Cryptographic Layers.
Rendering a well-formed message is straightforward.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">The receiving MUA should evaluate and summarize the cryptographic properties of the Cryptographic Envelope, and display that status to the user in a secure, strictly-controlled part of the UI.
In particular, the part of the UI used to render the cryptographic summary of the message MUST NOT be spoofable, modifiable, or otherwise controllable by the received message itself.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">Aside from this cryptographic summary, the message itself should be rendered as though the Cryptographic Payload is the body of the message.
The Cryptographic Layers themselves SHOULD not be rendered otherwise.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="errant-layers">
<section id="section-6.2">
        <h3 id="name-errant-cryptographic-layers">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-errant-cryptographic-layers" class="section-name selfRef">Errant Cryptographic Layers</a>
        </h3>
<p id="section-6.2-1">If an incoming message has any Errant Cryptographic Layers, the interpreting MUA SHOULD ignore those layers when rendering the cryptographic summary of the message to the user.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<div id="errant-signing-layer">
<section id="section-6.2.1">
          <h4 id="name-errant-signing-layer">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-errant-signing-layer" class="section-name selfRef">Errant Signing Layer</a>
          </h4>
<p id="section-6.2.1-1">When rendering a message with an Errant Cryptographic Layer that provides authenticity and integrity (via signatures), the message should be rendered by replacing the Cryptographic layer with the part it encloses.<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.1-2">For example, a message with this structure:<a href="#section-6.2.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2.1-3">
<pre>
A └┬╴multipart/mixed
B  ├╴text/plain
C  ├┬╴multipart/signed
D  │├─╴image/jpeg
E  │└─╴application/pgp-signature
F  └─╴text/plain
</pre><a href="#section-6.2.1-3" class="pilcrow">¶</a>
</div>
<p id="section-6.2.1-4">Should be rendered identically to this:<a href="#section-6.2.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2.1-5">
<pre>
A └┬╴multipart/mixed
B  ├─╴text/plain
D  ├─╴image/jpeg
F  └─╴text/plain
</pre><a href="#section-6.2.1-5" class="pilcrow">¶</a>
</div>
<p id="section-6.2.1-6">In such a situation, an MUA SHOULD NOT indicate in the cryptographic summary that the message is signed.<a href="#section-6.2.1-6" class="pilcrow">¶</a></p>
<div id="exception-mailing-list-footers">
<section id="section-6.2.1.1">
            <h5 id="name-exception-mailing-list-foot">
<a href="#section-6.2.1.1" class="section-number selfRef">6.2.1.1. </a><a href="#name-exception-mailing-list-foot" class="section-name selfRef">Exception: Mailing List Footers</a>
            </h5>
<p id="section-6.2.1.1-1">The use case described in <a href="#mailing-list-wrapping" class="xref">Section 4.5.1</a> is common enough in some contexts, that a MUA MAY decide to handle it as a special exception.<a href="#section-6.2.1.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.1.1-2">If the MUA determines that the message comes from a mailing list (it has a <code>List-ID</code> header), and it has a structure that appends a footer to a signing-only Cryptographic Layer with a valid signature, such as:<a href="#section-6.2.1.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2.1.1-3">
<pre>
H └┬╴multipart/mixed
I  ├┬╴multipart/signed
J  │├─╴[protected part, may be arbitrary MIME subtree]
K  │└─╴application/{pgp,pkcs7}-signature
L  └─╴[footer, typically text/plain]
</pre><a href="#section-6.2.1.1-3" class="pilcrow">¶</a>
</div>
<p id="section-6.2.1.1-4">or:<a href="#section-6.2.1.1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2.1.1-5">
<pre>
H └┬╴multipart/mixed
I  ├─╴application/pkcs7-mime; smime-type="signed-data"
   │⇩ (unwraps to)
J  │└─╴[protected part, may be an arbitrary MIME subtree]
L  └─╴[footer, typically text/plain]
</pre><a href="#section-6.2.1.1-5" class="pilcrow">¶</a>
</div>
<p id="section-6.2.1.1-6">Then, the MUA MAY indicate to the user that this is a signed message that has been wrapped by the mailing list.<a href="#section-6.2.1.1-6" class="pilcrow">¶</a></p>
<p id="section-6.2.1.1-7">In this case, the MUA MUST distinguish the footer (part <code>L</code>) from the protected part (part <code>J</code>) when rendering any information about the signature.<a href="#section-6.2.1.1-7" class="pilcrow">¶</a></p>
<p id="section-6.2.1.1-8">One way to do this is to offer the user two different views of the message: the "mailing list" view, which hides any cryptographic summary but shows the footer:<a href="#section-6.2.1.1-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2.1.1-9">
<pre>
Cryptographic Protections: none
H └┬╴multipart/mixed
J  ├─╴[protected part, may be arbitrary MIME subtree]
L  └─╴[footer, typically text/plain]
</pre><a href="#section-6.2.1.1-9" class="pilcrow">¶</a>
</div>
<p id="section-6.2.1.1-10">or the "sender's view", which shows the cryptographic summary but hides the footer:<a href="#section-6.2.1.1-10" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2.1.1-11">
<pre>
Cryptographic Protections: signed [details from part I]
J └─╴[protected part, may be arbitrary MIME subtree]
</pre><a href="#section-6.2.1.1-11" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="errant-encryption-layer">
<section id="section-6.2.2">
          <h4 id="name-errant-encryption-layer">
<a href="#section-6.2.2" class="section-number selfRef">6.2.2. </a><a href="#name-errant-encryption-layer" class="section-name selfRef">Errant Encryption Layer</a>
          </h4>
<p id="section-6.2.2-1">An MUA may encounter a message with an Errant Cryptographic Layer that offers confidentiality (encryption), and the MUA is capable of decrypting it.<a href="#section-6.2.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2.2-2">The user wants to be able to see the contents of any message that they receive, so an MUA in this situation SHOULD decrypt the part.<a href="#section-6.2.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2.2-3">In this case, though, the MUA MUST NOT indicate in the message's cryptographic summary that the message itself was encrypted.
Such an indication could be taken to mean that other (non-encrypted) parts of the message arrived with cryptographic confidentiality.<a href="#section-6.2.2-3" class="pilcrow">¶</a></p>
<div id="reply-to-errant-encryption">
<section id="section-6.2.2.1">
            <h5 id="name-replying-to-a-message-with-">
<a href="#section-6.2.2.1" class="section-number selfRef">6.2.2.1. </a><a href="#name-replying-to-a-message-with-" class="section-name selfRef">Replying to a Message with an Errant Encryption Layer</a>
            </h5>
<p id="section-6.2.2.1-1">Note that there is an asymmetry here between rendering and replying to a message with an Errant Encryption Layer.<a href="#section-6.2.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.2.1-2">When rendering, the MUA does not indicate that the message was encrypted, even if some subpart of it was decrypted for rendering.<a href="#section-6.2.2.1-2" class="pilcrow">¶</a></p>
<p id="section-6.2.2.1-3">But when composing a reply that contains quoted text from the decrypted subpart, the reply message SHOULD be marked for encryption, as noted in {#composing-reply}.<a href="#section-6.2.2.1-3" class="pilcrow">¶</a></p>
<p id="section-6.2.2.1-4">Alternately, if the reply message cannot be encrypted (or if the user elects to not encrypt the reply), the composed reply MUST NOT include any material from the decrypted subpart.<a href="#section-6.2.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="forwarded-messages-with-cryptographic-protection">
<section id="section-6.3">
        <h3 id="name-forwarded-messages-with-cry">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-forwarded-messages-with-cry" class="section-name selfRef">Forwarded Messages with Cryptographic Protection</a>
        </h3>
<p id="section-6.3-1">An incoming e-mail message may include an attached forwarded message, typically as a MIME subpart with <code>Content-Type: message/rfc822</code> (<span>[<a href="#RFC5322" class="xref">RFC5322</a>]</span>) or <code>Content-Type: message/global</code> (<span>[<a href="#RFC5355" class="xref">RFC5355</a>]</span>).<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">Regardless of the cryptographic protections and structure of the incoming message, the internal forwarded message may have its own Cryptographic Envelope.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">The Cryptographic Layers that are part of the Cryptographic Envelope of the forwarded message are not Errant Cryptographic Layers of the surrounding message -- they are simply layers that apply to the forwarded message itself.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<p id="section-6.3-4">The rendering MUA MUST NOT conflate the cryptographic protections of the forwarded message with the cryptographic protections of the incoming message.<a href="#section-6.3-4" class="pilcrow">¶</a></p>
<p id="section-6.3-5">The rendering MUA MAY render a cryptograpic summary of the protections afforded to the forwarded message by its own Cryptographic Envelope, as long as that rendering is unambiguously tied to the forwarded message itself.<a href="#section-6.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="signature-failures">
<section id="section-6.4">
        <h3 id="name-signature-failures">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-signature-failures" class="section-name selfRef">Signature failures</a>
        </h3>
<p id="section-6.4-1">A cryptographic signature may fail in multiple ways.
A receiving MUA that discovers a failed signature should treat the message as though the signature did not exist.
This is similar to the standard guidance for about failed DKIM signatures (see section 6.1 of <span>[<a href="#RFC6376" class="xref">RFC6376</a>]</span>).<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">A MUA SHOULD NOT render a message with a failed signature as more dangerous or more dubious than a comparable message without any signature at all.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
<p id="section-6.4-3">A MUA that encounters an encrypted-and-signed message where the signature is invalid SHOULD treat the message the same way that it would treat a message that is encryption-only.<a href="#section-6.4-3" class="pilcrow">¶</a></p>
<p id="section-6.4-4">Some different ways that a signature may be invalid on a given message:<a href="#section-6.4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4-5.1">the signature is not cryptographically valid (the math fails).<a href="#section-6.4-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.4-5.2">the signature relies on suspect cryptographic primitives (e.g. over a legacy digest algorithm, or was made by a weak key, e.g., 1024-bit R.SA)<a href="#section-6.4-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.4-5.3">the signature is made by a certificate which the receiving MUA does not have access to.<a href="#section-6.4-5.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.4-5.4">the certificate that made the signature was revoked.<a href="#section-6.4-5.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.4-5.5">the certificate that made the signature was expired at the time that the signature was made.<a href="#section-6.4-5.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.4-5.6">the certificate that made the signature does not correspond to the author of the message. (for X.509, there is no subjectAltName of type RFC822Name whose value matches an e-mail address found in <code>From:</code> or <code>Sender:</code>)<a href="#section-6.4-5.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.4-5.7">the certificate that made the signature was not issued by an authority that the MUA user is willing to rely on for certifying the sender's e-mail address.<a href="#section-6.4-5.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.4-5.8">the signature indicates that it was made at a time much before or much after from the date of the message itself.<a href="#section-6.4-5.8" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.4-6">A valid signature must pass all these tests, but of course invalid signatures may be invalid in more than one of the ways listed above.<a href="#section-6.4-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="reasoning-about-message-parts">
<section id="section-7">
      <h2 id="name-reasoning-about-message-par">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-reasoning-about-message-par" class="section-name selfRef">Reasoning about Message Parts</a>
      </h2>
<p id="section-7-1">When generating or rendering messages, it is useful to know what parts of the message are likely to be displayed, and how.
This section introduces some common terms that can be applied to parts within the Cryptographic Payload.<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="main-body-part">
<section id="section-7.1">
        <h3 id="name-main-body-part">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-main-body-part" class="section-name selfRef">Main Body Part</a>
        </h3>
<p id="section-7.1-1">When an e-mail message is composed or rendered to the user there is typically one main view that presents a (mostly textual) part of the message.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">While the message itself may be constructed of several distinct MIME parts in a tree, but the part that is rendered to the user is the "Main Body Part".<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">When rendering a message, one of the primary jobs of the recieving MUA is identifying which part (or parts) is the Main Body Part.
Typically, this is found by traversing the MIME tree of the message looking for a leaf node that has a primary content type of <code>text</code> (e.g. <code>text/plain</code> or <code>text/html</code>) and is not <code>Content-Disposition: attachment</code>.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4">MIME tree traversal follows the first child of every <code>multipart</code> node, with the exception of <code>multipart/alternative</code>.
When traversing a <code>multipart/alternative</code> node, all children should be scanned, with preference given to the last child node with a MIME type that the MUA is capable of rendering directly.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5">A MUA MAY offer the user a mechanism to prefer a particular MIME type within <code>multipart/alternative</code> instead of the last renderable child.
For example, a user may explicitly prefer a <code>text/plain</code> alternative part over <code>text/html</code>.<a href="#section-7.1-5" class="pilcrow">¶</a></p>
<p id="section-7.1-6">Note that due to uncertainty about the capabilities and configuration of the receiving MUA, the composing MUA SHOULD consider that multiple parts might be rendered as the Main Body Part when the message is ultimately viewed.<a href="#section-7.1-6" class="pilcrow">¶</a></p>
<p id="section-7.1-7">When composing a message, an originating MUA operating on behalf of an active user can identify which part (or parts) are the "main" parts: these are the parts the MUA generates from the user's editor.
Tooling that automatically generates e-mail messages should also have a reasonable estimate of which part (or parts) are the "main" parts, as they can be programmatically identified by the message author.<a href="#section-7.1-7" class="pilcrow">¶</a></p>
<p id="section-7.1-8">For a filtering program that attempts to transform an outbound message without any special knowledge about which parts are Main Body Parts, it can identify the likely parts by following the same routine as a receiving MUA.<a href="#section-7.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="attachments">
<section id="section-7.2">
        <h3 id="name-attachments">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-attachments" class="section-name selfRef">Attachments</a>
        </h3>
<p id="section-7.2-1">A message may contain one or more separated MIME parts that are intended for download or extraction.
Such a part is commonly called an "attachment", and is commonly identified by having <code>Content-Disposition: attachment</code>, and is a subpart of a <code>multipart/mixed</code> or <code>multipart/related</code> container.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">An MUA MAY identify a subpart as an attachment, or permit extraction of a subpart even when the subpart does not have <code>Content-Disposition: attachment</code>.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2-3">For end-to-end encrypted messages, attachments <em>MUST</em> be included within the Cryptographic Payload.
If an attachment is found outside the Cryptographic Payload, then the message is not well-formed (see <a href="#well-formed" class="xref">Section 6.1</a>).<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<p id="section-7.2-4">Some MUAs have tried to compose messages where each attachment is placed in its own cryptographic envelope.
Such a message is problematic for several reasons:<a href="#section-7.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7.2-5.1">The attachments can be stripped, replaced, or reordered without breaking any cryptographic integrity mechanism.<a href="#section-7.2-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-7.2-5.2">The resulting message may have a mix of cryptographic statuses (e.g. if a signature on one part fails but another succeeds, or if one part is encrypted and another is not).
This mix of statuses is difficult to represent to the user in a comprehensible way.<a href="#section-7.2-5.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="mime-part-examples">
<section id="section-7.3">
        <h3 id="name-mime-part-examples">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-mime-part-examples" class="section-name selfRef">MIME Part Examples</a>
        </h3>
<p id="section-7.3-1">Consider a common message with the folloiwing MIME structure:<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-2">
<pre>
M └─╴application/pkcs7-mime
   ↧ (decrypts to)
N  └─╴application/pkcs7-mime
    ⇩ (unwraps to)
O   └┬╴multipart/mixed
P    ├┬╴multipart/alternative
Q    │├─╴text/plain
R    │└─╴text/html
S    └─╴image/png
</pre><a href="#section-7.3-2" class="pilcrow">¶</a>
</div>
<p id="section-7.3-3">Parts M and N comprise the Cryptographic Envelope.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
<p id="section-7.3-4">Parts Q and R are both Main Body Parts.<a href="#section-7.3-4" class="pilcrow">¶</a></p>
<p id="section-7.3-5">If part S is <code>Content-Disposition: attachment</code>, then it is an attachment.
If part S has no <code>Content-Disposition</code> header, it is potentially ambiguous whether it is an attachment or not.<a href="#section-7.3-5" class="pilcrow">¶</a></p>
<p id="section-7.3-6">Consider also this alternate structure:<a href="#section-7.3-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-7">
<pre>
M └─╴application/pkcs7-mime
   ↧ (decrypts to)
N  └─╴application/pkcs7-mime
    ⇩ (unwraps to)
O   └┬╴multipart/alternative
P    ├─╴text/plain
Q    └┬╴multipart/related
R     ├─╴text/html
S     └─╴image/png
</pre><a href="#section-7.3-7" class="pilcrow">¶</a>
</div>
<p id="section-7.3-8">In this case, parts M and N are still the Cryptographic Envelope.<a href="#section-7.3-8" class="pilcrow">¶</a></p>
<p id="section-7.3-9">Parts P and R (the first two leaf nodes within each subtree of part O) are the Main Body Parts.<a href="#section-7.3-9" class="pilcrow">¶</a></p>
<p id="section-7.3-10">Part S is more likely not to be an attachment, as the subtree layout suggests that it is only relevant for the HTML version of the message.
For example, it might be rendered as an image within the HTML alternative.<a href="#section-7.3-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="cert-management">
<section id="section-8">
      <h2 id="name-certificate-management">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-certificate-management" class="section-name selfRef">Certificate Management</a>
      </h2>
<p id="section-8-1">A cryptographically-capable MUA typically maintains knowledge about certificates for the user's own account(s), as well as certificates for the peers that it communicates with.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="peer-certificates">
<section id="section-8.1">
        <h3 id="name-peer-certificates">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-peer-certificates" class="section-name selfRef">Peer Certificates</a>
        </h3>
<p id="section-8.1-1">Most certificates that a cryptographically-capable MUA will use will be certificates belonging to the parties that the user communicates with through the MUA.
This section discusses how to manage the certificates that belong to such a peer.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">The MUA will need to be able to discover X.509 certificates for each peer, cache them, and select among them when composing an encrypted message.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<div id="peer-discovery-incoming">
<section id="section-8.1.1">
          <h4 id="name-cert-discovery-from-incomin">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-cert-discovery-from-incomin" class="section-name selfRef">Cert Discovery from Incoming Messages</a>
          </h4>
<p id="section-8.1.1-1">TODO: incoming PKCS#7 messages tend to have a bundle of certificates in them.
How should these certs be handled?<a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1.1-2">TODO: point to Autocrypt certificate discovery mechanism<a href="#section-8.1.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1.1-3">TODO: point to OpenPGP embedded certificate subpacket proposal<a href="#section-8.1.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1.1-4">TODO: compare mechanisms, explain where each case is useful.<a href="#section-8.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="peer-discovery--directory">
<section id="section-8.1.2">
          <h4 id="name-certificate-directories">
<a href="#section-8.1.2" class="section-number selfRef">8.1.2. </a><a href="#name-certificate-directories" class="section-name selfRef">Certificate Directories</a>
          </h4>
<p id="section-8.1.2-1">Some MUAs may have the capability to look up peer certificates in a directory.<a href="#section-8.1.2-1" class="pilcrow">¶</a></p>
<p id="section-8.1.2-2">TODO: more information here about X.509 directories -- LDAP?<a href="#section-8.1.2-2" class="pilcrow">¶</a></p>
<p id="section-8.1.2-3">TODO: mention WKD for OpenPGP certificates?<a href="#section-8.1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="peer-cert-selection">
<section id="section-8.1.3">
          <h4 id="name-peer-certificate-selection">
<a href="#section-8.1.3" class="section-number selfRef">8.1.3. </a><a href="#name-peer-certificate-selection" class="section-name selfRef">Peer Certificate Selection</a>
          </h4>
<p id="section-8.1.3-1">When composing an encrypted message, the MUA needs to select a certificate for each recipient that is capable of encryption.<a href="#section-8.1.3-1" class="pilcrow">¶</a></p>
<p id="section-8.1.3-2">To select such a certificate for a given destination e-mail address, the MUA should look through all of its known certificates and verify that <em>all</em> of the conditions below are met:<a href="#section-8.1.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.3-3.1">The certificate must be valid, not expired or revoked.<a href="#section-8.1.3-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8.1.3-3.2">It must have a subjectAltName of type rFC822Name whose contents exactly match the destination address.<a href="#section-8.1.3-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8.1.3-3.3">
              <p id="section-8.1.3-3.3.1">The algorithm OID in the certificate's SPKI is known to the MUA and capable of encryption.
Examples include (TODO: need OIDs)<a href="#section-8.1.3-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.1.3-3.3.2.1">RSA, with keyUsage present and the "key encipherment" bit set<a href="#section-8.1.3-3.3.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-8.1.3-3.3.2.2">EC Public Key, with keyUsage present and the "key agreement" bit set<a href="#section-8.1.3-3.3.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-8.1.3-3.3.2.3">EC DH, with keyUsage present and the "key agreement" bit set<a href="#section-8.1.3-3.3.2.3" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-8.1.3-3.4">If extendedKeyUsage is present, it contains at least one of the following OIDs: e-mail protection, anyExtendedKeyUsage.<a href="#section-8.1.3-3.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.3-4">TODO: If OID is EC Public Key and keyUsage is absent, what should happen?<a href="#section-8.1.3-4" class="pilcrow">¶</a></p>
<p id="section-8.1.3-5">TODO: what if multiple certificates meet all of these criteria for a given recipient?<a href="#section-8.1.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cert-revocation">
<section id="section-8.1.4">
          <h4 id="name-checking-for-revocation">
<a href="#section-8.1.4" class="section-number selfRef">8.1.4. </a><a href="#name-checking-for-revocation" class="section-name selfRef">Checking for Revocation</a>
          </h4>
<p id="section-8.1.4-1">TODO: discuss how/when to check for peer certificate revocation<a href="#section-8.1.4-1" class="pilcrow">¶</a></p>
<p id="section-8.1.4-2">TODO: privacy concerns: what information leaks to whom when checking peer cert revocations?<a href="#section-8.1.4-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="local-certificates">
<section id="section-8.2">
        <h3 id="name-local-certificates">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-local-certificates" class="section-name selfRef">Local Certificates</a>
        </h3>
<p id="section-8.2-1">The MUA also needs to know about one or more certificates associated with the user's e-mail account.
It is typically expected to have access to the secret key material associated with the public keys in those certificates.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<div id="local-certificate-setup">
<section id="section-8.2.1">
          <h4 id="name-getting-a-certificate-for-t">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-getting-a-certificate-for-t" class="section-name selfRef">Getting a Certificate for the User</a>
          </h4>
<p id="section-8.2.1-1">TODO: mention ACME SMIME?<a href="#section-8.2.1-1" class="pilcrow">¶</a></p>
<p id="section-8.2.1-2">TODO: mention automatic self-signed certs e.g. OpenPGP?<a href="#section-8.2.1-2" class="pilcrow">¶</a></p>
<p id="section-8.2.1-3">TODO: SHOULD generate secret key material locally, and MUST NOT accept secret key material from an untrusted third party as the basis for the user's certificate.<a href="#section-8.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="local-cert-maintenance">
<section id="section-8.2.2">
          <h4 id="name-local-certificate-maintenan">
<a href="#section-8.2.2" class="section-number selfRef">8.2.2. </a><a href="#name-local-certificate-maintenan" class="section-name selfRef">Local Certificate Maintenance</a>
          </h4>
<p id="section-8.2.2-1">The MUA should warn the user when/if:<a href="#section-8.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.2-2.1">The user's own certificate set does not include a valid, unexpired encryption-capable X.509 certificate, and a valid, unexpired signature-capable X.509 certificate.<a href="#section-8.2.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8.2.2-2.2">Any of the user's own certificates is due to expire soon (TODO: what is "soon"?)<a href="#section-8.2.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8.2.2-2.3">Any of the user's own certificates does not match the e-mail address associated with the user's account.<a href="#section-8.2.2-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8.2.2-2.4">Any of the user's own certificates does not have a keyUsage section<a href="#section-8.2.2-2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8.2.2-2.5">Any of the user's own certificates does not contain an extendedKeyUsage extension<a href="#section-8.2.2-2.5" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.2.2-3">TODO: how does the MUA do better than warning in the cases above?
What can the MUA actually <em>do</em> here to fix problems before they happen?<a href="#section-8.2.2-3" class="pilcrow">¶</a></p>
<p id="section-8.2.2-4">TODO: discuss how/when to check for own certificate revocation, and what to do if it (or any intermediate certificate authority) is found to be revoked.<a href="#section-8.2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sending-certificates">
<section id="section-8.2.3">
          <h4 id="name-shipping-certificates-in-ou">
<a href="#section-8.2.3" class="section-number selfRef">8.2.3. </a><a href="#name-shipping-certificates-in-ou" class="section-name selfRef">Shipping Certificates in Outbound Messages</a>
          </h4>
<p id="section-8.2.3-1">TODO: What certificates should the MUA include in an outbound message so that peers can discover them?<a href="#section-8.2.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.2.3-2.1">local signing certificate so that signature can be validated<a href="#section-8.2.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8.2.3-2.2">local encryption-capable certificate(s) so that incoming messages can be encypted.<a href="#section-8.2.3-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8.2.3-2.3">On an encrypted message to multiple recipients, the encryption-capable peer certs of the other recipients (to enable "reply all")?<a href="#section-8.2.3-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8.2.3-2.4">intermediate certificates to chain all of the above to some set of root authorities?<a href="#section-8.2.3-2.4" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="cert-authorities">
<section id="section-8.3">
        <h3 id="name-certificate-authorities">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-certificate-authorities" class="section-name selfRef">Certificate Authorities</a>
        </h3>
<p id="section-8.3-1">TODO: how should the MUA select root certificate authorities?<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">TODO: should the MUA cache intermediate CAs?<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">TODO: should the MUA share such a cache with other PKI clients (e.g., web browsers)?
Are there distinctions between a CA for S/MIME and for the web?<a href="#section-8.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="common-pitfalls">
<section id="section-9">
      <h2 id="name-common-pitfalls-and-guideli">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-common-pitfalls-and-guideli" class="section-name selfRef">Common Pitfalls and Guidelines</a>
      </h2>
<p id="section-9-1">This section highlights a few "pitfalls" and guidelines based on these discussions and lessons learned.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">FIXME: some possible additional commentary on:<a href="#section-9-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9-3.1">indexing and search of encrypted messages<a href="#section-9-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.2">managing access to cryptographic secret keys that require user interaction<a href="#section-9-3.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.3">secure deletion<a href="#section-9-3.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.4">inline PGP, ugh<a href="#section-9-3.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.5">storage of composed/sent messages<a href="#section-9-3.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.6">encrypt-to-self during composition<a href="#section-9-3.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.7">cached signature validation<a href="#section-9-3.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.8">interaction between encryption and Bcc<a href="#section-9-3.8" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.9">aggregated cryptographic status of threads/conversations ?<a href="#section-9-3.9" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.10">Draft messages<a href="#section-9-3.10" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-9-3.11">copies to the Sent folder<a href="#section-9-3.11" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="iana-considerations">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">MAYBE: provide an indicator in the IANA header registry for which headers are "structural" and which are "user-facing"?
This is probably unnecessary.<a href="#section-10-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-11">
      <h2 id="name-security-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-11-1">This entire document addresses security considerations about end-to-end cryptographic protections for e-mail messages.<a href="#section-11-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="acknowledgements">
<section id="section-12">
      <h2 id="name-acknowledgements">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-12-1">The set of constructs and recommendations in this document are derived from discussions with many different implementers, including
Alexey Melnikov,
Bernie Hoeneisen,
Bjarni Runar Einarsson,
David Bremner,
Deb Cooley,
Holger Krekel,
Jameson Rollins,
Jonathan Hammell,
juga,
Patrick Brunschwig,
Santosh Chokhani, and
Vincent Breitmoser.<a href="#section-12-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-13">
      <h2 id="name-references">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-13.1">
        <h3 id="name-normative-references">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3156">[RFC3156]</dt>
        <dd>
<span class="refAuthor">Elkins, M.</span>, <span class="refAuthor">Del Torto, D.</span>, <span class="refAuthor">Levien, R.</span>, and <span class="refAuthor">T. Roessler</span>, <span class="refTitle">"MIME Security with OpenPGP"</span>, <span class="seriesInfo">RFC 3156</span>, <span class="seriesInfo">DOI 10.17487/RFC3156</span>, <time datetime="2001-08" class="refDate">August 2001</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3156">https://www.rfc-editor.org/info/rfc3156</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4289">[RFC4289]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span> and <span class="refAuthor">J. Klensin</span>, <span class="refTitle">"Multipurpose Internet Mail Extensions (MIME) Part Four: Registration Procedures"</span>, <span class="seriesInfo">BCP 13</span>, <span class="seriesInfo">RFC 4289</span>, <span class="seriesInfo">DOI 10.17487/RFC4289</span>, <time datetime="2005-12" class="refDate">December 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4289">https://www.rfc-editor.org/info/rfc4289</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8551">[RFC8551]</dt>
      <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refAuthor">Ramsdell, B.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 4.0 Message Specification"</span>, <span class="seriesInfo">RFC 8551</span>, <span class="seriesInfo">DOI 10.17487/RFC8551</span>, <time datetime="2019-04" class="refDate">April 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8551">https://www.rfc-editor.org/info/rfc8551</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-13.2">
        <h3 id="name-informative-references">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="chrome-indicators">[chrome-indicators]</dt>
        <dd>
<span class="refAuthor">Schechter, E.</span>, <span class="refTitle">"Evolving Chrome's security indicators"</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://blog.chromium.org/2018/05/evolving-chromes-security-indicators.html">https://blog.chromium.org/2018/05/evolving-chromes-security-indicators.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="EFAIL">[EFAIL]</dt>
        <dd>
<span class="refTitle">"EFAIL"</span>, <span>n.d.</span>, <span>&lt;<a href="https://efail.de">https://efail.de</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.draft-bre-openpgp-samples-01">[I-D.draft-bre-openpgp-samples-01]</dt>
        <dd>
<span class="refAuthor">Einarsson, B. R.</span>, <span class="refAuthor">"juga"</span>, and <span class="refAuthor">D. K. Gillmor</span>, <span class="refTitle">"OpenPGP Example Keys and Certificates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-bre-openpgp-samples-01</span>, <time datetime="2019-12-20" class="refDate">20 December 2019</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-bre-openpgp-samples-01.txt">https://www.ietf.org/archive/id/draft-bre-openpgp-samples-01.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.draft-ietf-lamps-samples-05">[I-D.draft-ietf-lamps-samples-05]</dt>
        <dd>
<span class="refAuthor">Gillmor, D. K.</span>, <span class="refTitle">"S/MIME Example Keys and Certificates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lamps-samples-05</span>, <time datetime="2021-08-05" class="refDate">5 August 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-lamps-samples-05.txt">https://www.ietf.org/archive/id/draft-ietf-lamps-samples-05.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3274">[RFC3274]</dt>
        <dd>
<span class="refAuthor">Gutmann, P.</span>, <span class="refTitle">"Compressed Data Content Type for Cryptographic Message Syntax (CMS)"</span>, <span class="seriesInfo">RFC 3274</span>, <span class="seriesInfo">DOI 10.17487/RFC3274</span>, <time datetime="2002-06" class="refDate">June 2002</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3274">https://www.rfc-editor.org/info/rfc3274</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4880">[RFC4880]</dt>
        <dd>
<span class="refAuthor">Callas, J.</span>, <span class="refAuthor">Donnerhacke, L.</span>, <span class="refAuthor">Finney, H.</span>, <span class="refAuthor">Shaw, D.</span>, and <span class="refAuthor">R. Thayer</span>, <span class="refTitle">"OpenPGP Message Format"</span>, <span class="seriesInfo">RFC 4880</span>, <span class="seriesInfo">DOI 10.17487/RFC4880</span>, <time datetime="2007-11" class="refDate">November 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4880">https://www.rfc-editor.org/info/rfc4880</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5322">[RFC5322]</dt>
        <dd>
<span class="refAuthor">Resnick, P., Ed.</span>, <span class="refTitle">"Internet Message Format"</span>, <span class="seriesInfo">RFC 5322</span>, <span class="seriesInfo">DOI 10.17487/RFC5322</span>, <time datetime="2008-10" class="refDate">October 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5322">https://www.rfc-editor.org/info/rfc5322</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5355">[RFC5355]</dt>
        <dd>
<span class="refAuthor">Stillman, M., Ed.</span>, <span class="refAuthor">Gopal, R.</span>, <span class="refAuthor">Guttman, E.</span>, <span class="refAuthor">Sengodan, S.</span>, and <span class="refAuthor">M. Holdrege</span>, <span class="refTitle">"Threats Introduced by Reliable Server Pooling (RSerPool) and Requirements for Security in Response to Threats"</span>, <span class="seriesInfo">RFC 5355</span>, <span class="seriesInfo">DOI 10.17487/RFC5355</span>, <time datetime="2008-09" class="refDate">September 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5355">https://www.rfc-editor.org/info/rfc5355</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6376">[RFC6376]</dt>
      <dd>
<span class="refAuthor">Crocker, D., Ed.</span>, <span class="refAuthor">Hansen, T., Ed.</span>, and <span class="refAuthor">M. Kucherawy, Ed.</span>, <span class="refTitle">"DomainKeys Identified Mail (DKIM) Signatures"</span>, <span class="seriesInfo">STD 76</span>, <span class="seriesInfo">RFC 6376</span>, <span class="seriesInfo">DOI 10.17487/RFC6376</span>, <time datetime="2011-09" class="refDate">September 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6376">https://www.rfc-editor.org/info/rfc6376</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="test-vectors">
<section id="appendix-A">
      <h2 id="name-test-vectors">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-test-vectors" class="section-name selfRef">Test Vectors</a>
      </h2>
<p id="appendix-A-1">FIXME: This document should contain examples of well-formed and malformed messages using cryptographic key material and certificates from <span>[<a href="#I-D.draft-bre-openpgp-samples-01" class="xref">I-D.draft-bre-openpgp-samples-01</a>]</span> and  <span>[<a href="#I-D.draft-ietf-lamps-samples-05" class="xref">I-D.draft-ietf-lamps-samples-05</a>]</span>.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">It may also include example renderings of these messages.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="document-considerations">
<section id="appendix-B">
      <h2 id="name-document-considerations">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-document-considerations" class="section-name selfRef">Document Considerations</a>
      </h2>
<p id="appendix-B-1">[ RFC Editor: please remove this section before publication ]<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">This document is built from markdown using <a href="https://rubygems.org/gems/kramdown-rfc2629">ruby-kramdown-rfc2629</a>, and tracked using <a href="https://git-scm.com/">git</a>.
The markdown source under development can be found in the file <code>e2e-mail-guidance.md</code> in the <code>main</code> branch of the <a href="https://gitlab.com/dkg/e2e-mail-guidance">git repository</a>.<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<p id="appendix-B-3">You may also be interested in <a href="https://dkg.gitlab.io/e2e-mail-guidance/">the latest editor's copy</a>.<a href="#appendix-B-3" class="pilcrow">¶</a></p>
<p id="appendix-B-4">Minor editorial changes can be suggested via merge requests at https://gitlab.com/dkg/e2e-mail-guidance or by e-mail to the editor.
Please direct all significant commentary to the public <a href="https://www.ietf.org/mailman/listinfo/spasm">IETF LAMPS mailing list, spasm@ietf.org</a>.<a href="#appendix-B-4" class="pilcrow">¶</a></p>
<div id="document-history">
<section id="appendix-B.1">
        <h3 id="name-document-history">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-document-history" class="section-name selfRef">Document History</a>
        </h3>
<div id="substantive-changes-from-draft-ietf-01-to-draft-ietf-02">
<section id="appendix-B.1.1">
          <h4 id="name-substantive-changes-from-dr">
<a href="#appendix-B.1.1" class="section-number selfRef">B.1.1. </a><a href="#name-substantive-changes-from-dr" class="section-name selfRef">Substantive changes from draft-ietf-...-01 to draft-ietf-...-02</a>
          </h4>
<ul class="normal">
<li class="normal" id="appendix-B.1.1-1.1">Added definition of "user-facing" headers<a href="#appendix-B.1.1-1.1" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="substantive-changes-from-draft-ietf-00-to-draft-ietf-01">
<section id="appendix-B.1.2">
          <h4 id="name-substantive-changes-from-dra">
<a href="#appendix-B.1.2" class="section-number selfRef">B.1.2. </a><a href="#name-substantive-changes-from-dra" class="section-name selfRef">Substantive changes from draft-ietf-...-00 to draft-ietf-...-01</a>
          </h4>
<ul class="normal">
<li class="normal" id="appendix-B.1.2-1.1">Added section about distinguishing Main Body Parts and Attachments<a href="#appendix-B.1.2-1.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-B.1.2-1.2">Updated document considerations section, including reference to auto-built editor's copy<a href="#appendix-B.1.2-1.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="substantive-changes-from-draft-dkg-01-to-draft-ietf-00">
<section id="appendix-B.1.3">
          <h4 id="name-substantive-changes-from-draf">
<a href="#appendix-B.1.3" class="section-number selfRef">B.1.3. </a><a href="#name-substantive-changes-from-draf" class="section-name selfRef">Substantive changes from draft-dkg-...-01 to draft-ietf-...-00</a>
          </h4>
<ul class="normal">
<li class="normal" id="appendix-B.1.3-1.1">WG adopted draft<a href="#appendix-B.1.3-1.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-B.1.3-1.2">moved Document History and Document Considerations sections to end of appendix, to avoid section renumbering when removed<a href="#appendix-B.1.3-1.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="substantive-changes-from-draft-dkg-00-to-draft-dkg-01">
<section id="appendix-B.1.4">
          <h4 id="name-substantive-changes-from-draft">
<a href="#appendix-B.1.4" class="section-number selfRef">B.1.4. </a><a href="#name-substantive-changes-from-draft" class="section-name selfRef">Substantive changes from draft-dkg-...-00 to draft-dkg-...-01</a>
          </h4>
<ul class="normal">
<li class="normal" id="appendix-B.1.4-1.1">consideration of success/failure indicators for usability<a href="#appendix-B.1.4-1.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-B.1.4-1.2">clarify extendedKeyUsage and keyUsage algorithm-specific details<a href="#appendix-B.1.4-1.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-B.1.4-1.3">initial section on certificate management<a href="#appendix-B.1.4-1.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-B.1.4-1.4">added more TODO items<a href="#appendix-B.1.4-1.4" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Daniel Kahn Gillmor (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">American Civil Liberties Union</span></div>
<div dir="auto" class="left"><span class="street-address">125 Broad St.</span></div>
<div dir="auto" class="left">
<span class="locality">New York, NY</span>,  <span class="postal-code">10004</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dkg@fifthhorseman.net" class="email">dkg@fifthhorseman.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
