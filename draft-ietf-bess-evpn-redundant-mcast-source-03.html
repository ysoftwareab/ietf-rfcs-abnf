<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Multicast Source Redundancy in EVPN Networks</title>
<meta content="Jorge Rabadan" name="author">
<meta content="Jayant Kotalwar" name="author">
<meta content="Senthil Sathappan" name="author">
<meta content="Zhaohui Zhang" name="author">
<meta content="Wen Lin" name="author">
<meta content="Eric C. Rosen" name="author">
<meta content="
       EVPN supports intra and inter-subnet IP multicast forwarding.
      However, EVPN (or conventional IP multicast techniques for that matter)
      do not have a solution for the case where: a) a given multicast group
      carries more than one flow (i.e., more than one source), and b) it is
      desired that each receiver gets only one of the several flows. Existing
      multicast techniques assume there are no redundant sources sending the
      same flow to the same IP multicast group, and, in case there were
      redundant sources, the receiver's application would deal with the
      received duplicated packets. This document extends the existing EVPN
      specifications and assumes that IP Multicast source redundancy may
      exist. It also assumes that, in case two or more sources send the same
      IP Multicast flows into the tenant domain, the EVPN PEs need to avoid
      that the receivers get packet duplication by following the described
      procedures. 
    " name="description">
<meta content="xml2rfc 3.12.0" name="generator">
<meta content="draft-ietf-bess-evpn-redundant-mcast-source-03" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.7.1
    pycountry 22.1.10
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-ietf-bess-evpn-redundant-mcast-source-03-2pjz8u36.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">EVPN Redundant Sources</td>
<td class="right">February 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Rabadan, et al.</td>
<td class="center">Expires 10 August 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">BESS Workgroup</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-bess-evpn-redundant-mcast-source-03</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-02-06" class="published">6 February 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-08-10">10 August 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">J. Rabadan, <span class="editor">Ed.</span>
</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">J. Kotalwar</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">S. Sathappan</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">Z. Zhang</div>
<div class="org">Juniper</div>
</div>
<div class="author">
      <div class="author-name">W. Lin</div>
<div class="org">Juniper</div>
</div>
<div class="author">
      <div class="author-name">E. Rosen</div>
<div class="org">Individual</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Multicast Source Redundancy in EVPN Networks</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">EVPN supports intra and inter-subnet IP multicast forwarding.
      However, EVPN (or conventional IP multicast techniques for that matter)
      do not have a solution for the case where: a) a given multicast group
      carries more than one flow (i.e., more than one source), and b) it is
      desired that each receiver gets only one of the several flows. Existing
      multicast techniques assume there are no redundant sources sending the
      same flow to the same IP multicast group, and, in case there were
      redundant sources, the receiver's application would deal with the
      received duplicated packets. This document extends the existing EVPN
      specifications and assumes that IP Multicast source redundancy may
      exist. It also assumes that, in case two or more sources send the same
      IP Multicast flows into the tenant domain, the EVPN PEs need to avoid
      that the receivers get packet duplication by following the described
      procedures.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 10 August 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-background-on-ip-multicast-" class="xref">Background on IP Multicast Delivery in EVPN Networks</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2.2.1">
                    <p id="section-toc.1-1.1.2.2.2.1.1" class="keepWithNext"><a href="#section-1.2.1" class="xref">1.2.1</a>.  <a href="#name-intra-subnet-ip-multicast-f" class="xref">Intra-subnet IP Multicast Forwarding</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2.2.2">
                    <p id="section-toc.1-1.1.2.2.2.2.1" class="keepWithNext"><a href="#section-1.2.2" class="xref">1.2.2</a>.  <a href="#name-inter-subnet-ip-multicast-f" class="xref">Inter-subnet IP Multicast Forwarding</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1"><a href="#section-1.3" class="xref">1.3</a>.  <a href="#name-multi-homed-ip-multicast-so" class="xref">Multi-Homed IP Multicast Sources in EVPN</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.4">
                <p id="section-toc.1-1.1.2.4.1"><a href="#section-1.4" class="xref">1.4</a>.  <a href="#name-the-need-for-redundant-ip-m" class="xref">The Need for Redundant IP Multicast Sources in EVPN</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-solution-overview" class="xref">Solution Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-bgp-evpn-extensions" class="xref">BGP EVPN Extensions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-warm-standby-ws-solution-fo" class="xref">Warm Standby (WS) Solution for Redundant G-Sources</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-ws-example-in-an-oism-netwo" class="xref">WS Example in an OISM Network</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-ws-example-in-a-single-bd-t" class="xref">WS Example in a Single-BD Tenant Network</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-hot-standby-hs-solution-for" class="xref">Hot Standby (HS) Solution for Redundant G-Sources</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-extensions-for-the-advertis" class="xref">Extensions for the Advertisement of DCB Labels</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-use-of-bfd-in-the-hs-soluti" class="xref">Use of BFD in the HS Solution</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-hs-example-in-an-oism-netwo" class="xref">HS Example in an OISM Network</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-hs-example-in-a-single-bd-t" class="xref">HS Example in a Single-BD Tenant Network</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-contributors" class="xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-C" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="sect-1">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Intra and Inter-subnet IP Multicast forwarding are supported in EVPN
      networks. <span>[<a href="#I-D.ietf-bess-evpn-igmp-mld-proxy" class="xref">I-D.ietf-bess-evpn-igmp-mld-proxy</a>]</span> describes
      the procedures required to optimize the delivery of IP Multicast flows
      when Sources and Receivers are connected to the same EVPN BD (Broadcast
      Domain), whereas <span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span> specifies
      the procedures to support Inter-subnet IP Multicast in a tenant network.
      Inter-subnet IP Multicast means that IP Multicast Source and Receivers
      of the same multicast flow are connected to different BDs of the same
      tenant.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2"><span>[<a href="#I-D.ietf-bess-evpn-igmp-mld-proxy" class="xref">I-D.ietf-bess-evpn-igmp-mld-proxy</a>]</span>, <span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span> or conventional IP multicast
      techniques do not have a solution for the case where a given multicast
      group carries more than one flow (i.e., more than one source) and it is
      desired that each receiver gets only one of the several flows. Multicast
      techniques assume there are no redundant sources sending the same flows
      to the same IP multicast group, and, in case there were redundant
      sources, the receiver's application would deal with the received
      duplicated packets.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">As a workaround in conventional IP multicast (PIM or MVPN networks),
      if all the redundant sources are given the same IP address, each
      receiver will get only one flow. The reason is that, in conventional IP
      multicast, (S,G) state is always created by the RP (Rendezvous Point),
      and sometimes by the Last Hop Router (LHR). The (S,G) state always binds
      the (S,G) flow to a source-specific tree, rooted at the source IP
      address. If multiple sources have the same IP address, one may end up
      with multiple (S,G) trees. However, the way the trees are constructed
      ensures that any given LHR or RP is on at most one of them. The use of
      an anycast address assigned to multiple sources may be useful for warm
      standby redundancy solutions. However, on one hand, it's not really
      helpful for hot standby redundancy solutions and on the other hand,
      configuring the same IP address (in particular IPv4 address) in multiple
      sources may bring issues if the sources need to be reached by IP unicast
      traffic or if the sources are attached to the same Broadcast Domain.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">In addition, in the scenario where several G-sources are attached via
      EVPN/OISM, there is not necessarily any (S,G) state created for the
      redundant sources. The LHRs may have only (*,G) state, and there may not
      be an RP (creating (S,G) state) either. Therefore, this document extends
      the above two specifications and assumes that IP Multicast source
      redundancy may exist. It also assumes that, in case two or more sources
      send the same IP Multicast flows into the tenant domain, the EVPN PEs
      need to avoid that the receivers get packet duplication.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">The solution provides support for Warm Standby (WS) and Hot Standby
      (HS) redundancy. WS is defined as the redundancy scenario in which the
      upstream PEs attached to the redundant sources of the same tenant, make
      sure that only one source of the same flow can send multicast to the
      interested downstream PEs at the same time. In HS the upstream PEs
      forward the redundant multicast flows to the downstream PEs, and the
      downstream PEs make sure only one flow is forwarded to the interested
      attached receivers.<a href="#section-1-5" class="pilcrow">¶</a></p>
<div id="sect-1.1">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
        "OPTIONAL" in this document are to be interpreted as described in BCP
        14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only
        when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-2.1">PIM: Protocol Independent Multicast.<a href="#section-1.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.2">MVPN: Multicast Virtual Private Networks.<a href="#section-1.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.3">OISM: Optimized Inter-Subnet Multicast, as in <span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span>.<a href="#section-1.1-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.4">Broadcast Domain (BD): an emulated ethernet, such that two
            systems on the same BD will receive each other's link-local
            broadcasts. In this document, BD also refers to the instantiation
            of a Broadcast Domain on an EVPN PE. An EVPN PE can be attached to
            one or multiple BDs of the same tenant.<a href="#section-1.1-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.5">Designated Forwarder (DF): as defined in <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>, an ethernet segment may be multi-homed
            (attached to more than one PE). An ethernet segment may also
            contain multiple BDs, of one or more EVIs. For each such EVI, one
            of the PEs attached to the segment becomes that EVI's DF for that
            segment. Since a BD may belong to only one EVI, we can speak
            unambiguously of the BD's DF for a given segment.<a href="#section-1.1-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.6">Upstream PE: in this document an Upstream PE is referred to as
            the EVPN PE that is connected to the IP Multicast source or
            closest to it. It receives the IP Multicast flows on local ACs
            (Attachment Circuits).<a href="#section-1.1-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.7">Downstream PE: in this document a Downstream PE is referred to
            as the EVPN PE that is connected to the IP Multicast receivers and
            gets the IP Multicast flows from remote EVPN PEs.<a href="#section-1.1-2.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.8">G-traffic: any frame with an IP payload whose IP Destination
            Address (IP DA) is a multicast group G.<a href="#section-1.1-2.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.9">G-source: any system sourcing IP multicast traffic to G.<a href="#section-1.1-2.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.10">SFG: Single Flow Group, i.e., a multicast group address G which
            represents traffic that contains only a single flow. However,
            multiple sources - with the same or different IP - may be
            transmitting an SFG.<a href="#section-1.1-2.10" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.11">Redundant G-source: a host or router that transmits an SFG in a
            tenant network where there are more hosts or routers transmitting
            the same SFG. Redundant G-sources for the same SFG SHOULD have
            different IP addresses, although they MAY have the same IP address
            when in different BDs of the same tenant network. Redundant
            G-sources are assumed NOT to be "bursty" in this document (typical
            example are Broadcast TV G-sources or similar).<a href="#section-1.1-2.11" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.12">P-tunnel: Provider tunnel refers to the type of tree a given
            upstream EVPN PE uses to forward multicast traffic to downstream
            PEs. Examples of P-tunnels supported in this document are Ingress
            Replication (IR), Assisted Replication (AR), Bit Indexed Explicit
            Replication (BIER), multicast Label Distribution Protocol (mLDP)
            or Point to Multi-Point Resource Reservation protocol with Traffic
            Engineering extensions (P2MP RSVP-TE).<a href="#section-1.1-2.12" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.13">Inclusive Multicast Tree or Inclusive Provider Multicast
            Service Interface (I-PMSI): defined in <span>[<a href="#RFC6513" class="xref">RFC6513</a>]</span>,
            in this document it is applicable only to EVPN and refers to the
            default multicast tree for a given BD. All the EVPN PEs that are
            attached to a specific BD belong to the I-PMSI for the BD. The
            I-PMSI trees are signaled by EVPN Inclusive Multicast Ethernet Tag
            (IMET) routes.<a href="#section-1.1-2.13" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.14">
            <p id="section-1.1-2.14.1">Selective Multicast Tree or Selective Provider Multicast
            Service Interface (S-PMSI): defined in <span>[<a href="#RFC6513" class="xref">RFC6513</a>]</span>,
            in this document it is applicable only to EVPN and refers to the
            multicast tree to which only the interested PEs of a given BD
            belong to. There are two types of EVPN S-PMSIs:<a href="#section-1.1-2.14.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-2.14.2.1">EVPN S-PMSIs that require the advertisement of S-PMSI AD
                routes from the upstream PE, as in <span>[<a href="#EVPN-BUM" class="xref">EVPN-BUM</a>]</span>.
                The interested downstream PEs join the S-PMSI tree as in <span>[<a href="#EVPN-BUM" class="xref">EVPN-BUM</a>]</span>.<a href="#section-1.1-2.14.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-1.1-2.14.2.2">EVPN S-PMSIs that don't require the advertisement of S-PMSI
                AD routes. They use the forwarding information of the IMET
                routes, but upstream PEs send IP Multicast flows only to
                downstream PEs issuing Selective Multicast Ethernet Tag (SMET)
                routes for the flow. These S-PMSIs are only supported with the
                following P-tunnels: Ingress Replication (IR), Assisted
                Replication (AR) and BIER.<a href="#section-1.1-2.14.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="section-1.1-3">This document also assumes familiarity with the terminology of
        <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>, <span>[<a href="#RFC4364" class="xref">RFC4364</a>]</span>, <span>[<a href="#RFC6513" class="xref">RFC6513</a>]</span>, <span>[<a href="#RFC6514" class="xref">RFC6514</a>]</span>, <span>[<a href="#I-D.ietf-bess-evpn-igmp-mld-proxy" class="xref">I-D.ietf-bess-evpn-igmp-mld-proxy</a>]</span>, <span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span>, <span>[<a href="#EVPN-RT5" class="xref">EVPN-RT5</a>]</span> and
        <span>[<a href="#EVPN-BUM" class="xref">EVPN-BUM</a>]</span>.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-1.2">
<section id="section-1.2">
        <h3 id="name-background-on-ip-multicast-">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-background-on-ip-multicast-" class="section-name selfRef">Background on IP Multicast Delivery in EVPN Networks</a>
        </h3>
<p id="section-1.2-1">IP Multicast is all about forwarding a single copy of a packet from
        a source S to a group of receivers G along a multicast tree. That
        multicast tree can be created in an EVPN tenant domain where S and the
        receivers for G are connected to the same BD or different BD. In the
        former case, we refer to Intra-subnet IP Multicast forwarding, whereas
        the latter case will be referred to as Inter-subnet IP Multicast
        forwarding.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<div id="sect-1.2.1">
<section id="section-1.2.1">
          <h4 id="name-intra-subnet-ip-multicast-f">
<a href="#section-1.2.1" class="section-number selfRef">1.2.1. </a><a href="#name-intra-subnet-ip-multicast-f" class="section-name selfRef">Intra-subnet IP Multicast Forwarding</a>
          </h4>
<p id="section-1.2.1-1">When the source S1 and receivers interested in G1 are attached to
          the same BD, the EVPN network can deliver the IP Multicast traffic
          to the receivers in two different ways (<a href="#ure-intra-subnet-ip-multicast" class="xref">Figure 1</a>):<a href="#section-1.2.1-1" class="pilcrow">¶</a></p>
<span id="name-intra-subnet-ip-multicast"></span><div id="ure-intra-subnet-ip-multicast">
<figure id="figure-1">
            <div class="alignLeft art-text artwork" id="section-1.2.1-2.1">
<pre>
                  S1  +                        S1  +
        (a)       +   |              (b)       +   |
                  |   | (S1,G1)                |   | (S1,G1)
              PE1 |   |                    PE1 |   |
              +-----+ v                    +-----+ v
              |+---+|                      |+---+|
              ||BD1||                      ||BD1||
              |+---+|                      |+---+|
              +-----+                      +-----+
         +-------|-------+            +-------|
         |       |       |            |       |
         v       v       v            v       v
      +-----+ +-----+ +-----+      +-----+ +-----+ +-----+
      |+---+| |-----| |-----|      |+---+| |+---+| |+---+|
      ||BD1|| ||BD1|| ||BD1||      ||BD1|| ||BD1|| ||BD1||
      |+---+| |-----| |-----|      |+---+| |+---+| |+---+|
      +-----+ +-----+ +-----+      +-----+ +-----+ +-----+
      PE2|    PE3|    PE4|         PE2|    PE3|    PE4
       - | - - - | -     |          - | - - - | -
      |  |       |  |    |         |  |       |  |
         v       v       v            v       v
      |  R1      R2 |    R3        |  R1      R2 |    R3
       - - - G1- - -                - - - G1- - -
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-intra-subnet-ip-multicast" class="selfRef">Intra-subnet IP Multicast</a>
            </figcaption></figure>
</div>
<p id="section-1.2.1-3">Model (a) illustrated in <a href="#ure-intra-subnet-ip-multicast" class="xref">Figure 1</a> is referred to as "IP
          Multicast delivery as BUM traffic". This way of delivering IP
          Multicast traffic does not require any extensions to <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>, however, it sends the IP Multicast flows to
          non-interested receivers, such as e.g., R3 in <a href="#ure-intra-subnet-ip-multicast" class="xref">Figure 1</a>. In this example,
          downstream PEs can snoop IGMP/MLD messages from the receivers so
          that layer-2 multicast state is created and, for instance, PE4 can
          avoid sending (S1,G1) to R3, since R3 is not interested in
          (S1,G1).<a href="#section-1.2.1-3" class="pilcrow">¶</a></p>
<p id="section-1.2.1-4">Model (b) in <a href="#ure-intra-subnet-ip-multicast" class="xref">Figure 1</a> uses
          an S-PMSI to optimize the delivery of the (S1,G1) flow. For
          instance, assuming PE1 uses IR, PE1 sends (S1,G1) only to the
          downstream PEs that issued an SMET route for (S1,G1), that is, PE2
          and PE3. In case PE1 uses any P-tunnel different than IR, AR or
          BIER, PE1 will advertise an S-PMSI A-D route for (S1,G1) and PE2/PE2
          will join that tree.<a href="#section-1.2.1-4" class="pilcrow">¶</a></p>
<p id="section-1.2.1-5">Procedures for Model (b) are specified in <span>[<a href="#I-D.ietf-bess-evpn-igmp-mld-proxy" class="xref">I-D.ietf-bess-evpn-igmp-mld-proxy</a>]</span>.<a href="#section-1.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-1.2.2">
<section id="section-1.2.2">
          <h4 id="name-inter-subnet-ip-multicast-f">
<a href="#section-1.2.2" class="section-number selfRef">1.2.2. </a><a href="#name-inter-subnet-ip-multicast-f" class="section-name selfRef">Inter-subnet IP Multicast Forwarding</a>
          </h4>
<p id="section-1.2.2-1">If the source and receivers are attached to different BDs of the
          same tenant domain, the EVPN network can also use Inclusive or
          Selective Trees as depicted in <a href="#ure-inter-subnet-ip-multicast" class="xref">Figure 2</a>, models (a) and (b)
          respectively.<a href="#section-1.2.2-1" class="pilcrow">¶</a></p>
<span id="name-inter-subnet-ip-multicast"></span><div id="ure-inter-subnet-ip-multicast">
<figure id="figure-2">
            <div class="alignLeft art-text artwork" id="section-1.2.2-2.1">
<pre>
                  S1  +                     S1  +
        (a)       +   |              (b)    +   |
                  |   | (S1,G1)             |   | (S1,G1)
              PE1 |   |                 PE1 |   |
              +-----+ v                 +-----+ v
              |+---+|                   |+---+|
              ||BD1||                   ||BD1||
              |+---+|                   |+---+|
              +-----+                   +-----+
         +-------|-------+         +-------|
         |       |       |         |       |
         v       v       v         v       v
      +-----+ +-----+ +-----+   +-----+ +-----+ +-----+
      |+---+| |+---+| |+---+|   |+---+| |+---+| |+---+|
      ||SBD|| ||SBD|| ||SBD||   ||SBD|| ||SBD|| ||SBD||
      |+-|-+| |+-|-+| |+---+|   |+-|-+| |+-|-+| |+---+|
      | VRF | | VRF | | VRF |   | VRF | | VRF | | VRF |
      |+-v-+| |+-v-+| |+---+|   |+-v-+| |+-v-+| |+---+|
      ||BD2|| ||BD3|| ||BD4||   ||BD2|| ||BD3|| ||BD4||
      |+-|-+| |+-|-+| |+---+|   |+-|-+| |+-|-+| |+---+|
      +--|--+ +--|--+ +-----+   +--|--+ +--|--+ +-----+
      PE2|    PE3|    PE4       PE2|    PE3|    PE4
       - | - - - | -             - | - - - | -
      |  |       |  |           |  |       |  |
         v       v                 v       v
      |  R1      R2 |    R3     |  R1      R2 |    R3
       - - - G1- - -             - - - G1- - -
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-inter-subnet-ip-multicast" class="selfRef">Inter-subnet IP Multicast</a>
            </figcaption></figure>
</div>
<p id="section-1.2.2-3"><span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span> specifies the
          procedures to optimize the Inter-subnet Multicast forwarding in an
          EVPN network. The IP Multicast flows are always sent in the context
          of the source BD. As described in <span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span>, if the downstream PE is not
          attached to the source BD, the IP Multicast flow is received on the
          SBD (Supplementary Broadcast Domain), as in the example in <a href="#ure-inter-subnet-ip-multicast" class="xref">Figure 2</a>.<a href="#section-1.2.2-3" class="pilcrow">¶</a></p>
<p id="section-1.2.2-4"><span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span> supports Inclusive
          or Selective Multicast Trees, and as explained in <a href="#sect-1.2.1" class="xref">Section 1.2.1</a>, the Selective Multicast Trees are setup in a
          different way, depending on the P-tunnel being used by the source
          BD. As an example, model (a) in <a href="#ure-inter-subnet-ip-multicast" class="xref">Figure 2</a> illustrates the use of an
          Inclusive Multicast Tree for BD1 on PE1. Since the downstream PEs
          are not attached to BD1, they will all receive (S1,G1) in the
          context of the SBD and will locally route the flow to the local ACs.
          Model (b) uses a similar forwarding model, however PE1 sends the
          (S1,G1) flow in a Selective Multicast Tree. If the P-tunnel is IR,
          AR or BIER, PE1 does not need to advertise an S-PMSI A-D route.<a href="#section-1.2.2-4" class="pilcrow">¶</a></p>
<p id="section-1.2.2-5"><span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span> is a superset of
          the procedures in <span>[<a href="#I-D.ietf-bess-evpn-igmp-mld-proxy" class="xref">I-D.ietf-bess-evpn-igmp-mld-proxy</a>]</span>, in which sources and
          receivers can be in the same or different BD of the same tenant.
          <span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span> ensures every upstream
          PE attached to a source will learn of all other PEs (attached to the
          same Tenant Domain) that have interest in a particular set of flows.
          This is because the downstream PEs advertise SMET routes for a set
          of flows with the SBD's Route Target and they are imported by all
          the Upstream PEs of the tenant. As a result of that, inter-subnet
          multicasting can be done within the Tenant Domain, without requiring
          any Rendezvous Points (RP), shared trees, UMH selection or any other
          complex aspects of conventional multicast routing techniques.<a href="#section-1.2.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-1.3">
<section id="section-1.3">
        <h3 id="name-multi-homed-ip-multicast-so">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-multi-homed-ip-multicast-so" class="section-name selfRef">Multi-Homed IP Multicast Sources in EVPN</a>
        </h3>
<p id="section-1.3-1">Contrary to conventional multicast routing technologies,
        multi-homing PEs attached to the same source can never create IP
        Multicast packet duplication if the PEs use a multi-homed Ethernet
        Segment (ES). <a href="#ure-all-active-multi-homing-and-oism" class="xref">Figure 3</a>
        illustrates this by showing two multi-homing PEs (PE1 and PE2) that
        are attached to the same source (S1). We assume that S1 is connected
        to an all-active ES by a layer-2 switch (SW1) with a Link Aggregation
        Group (LAG) to PE1 and PE2.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<span id="name-all-active-multi-homing-and"></span><div id="ure-all-active-multi-homing-and-oism">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-1.3-2.1">
<pre>
                                  S1
                                  |
                                  v
                               +-----+
                               | SW1 |
                               +-----+
                         +----  |   |
                  (S1,G1)| +----+   +----+
      IGMP               | | all-active  |
      J(S1,G1)     PE1   v |    ES-1     |    PE2
      +----&gt;   +-----------|---+     +---|-----------+
               | +---+   +---+ |     | +---+         |
       R1  &lt;-----|BD2|   |BD1| |     | |BD1|         |
               | +---+---+---+ |     | +---+---+     |
          +----|     |VRF|  |  |     |     |VRF|     |----+
          |    | +---+---+  |  |     | +---+---+     |    |
          |    | |SBD|      |  |     | |SBD|         |    |
          |    | +---+      |  |     | +---+         |    |
          |    +------------|--+     +---------------+    |
          |                 |                             |
          |                 |                             |
          |                 |                             |
          |  EVPN           |               ^             |
          |  OISM           v    PE3        | SMET        |
          |              +---------------+  | (*,G1)      |
          |              | +---+         |  |             |
          |              | |SBD|         |                |
          |              | +---+---+     |                |
          +--------------|     |VRF|     |----------------+
                         | +---+---+---+ |
                         | |BD2|   |BD3| |
                         | +-|-+   +-|-+ |
                         +---|-------|---+
                         ^   |       |   ^
                IGMP     |   v       v   | IGMP
                 J(*,G1) |  R2       R3  | J(S1,G1)
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-all-active-multi-homing-and" class="selfRef">All-active Multi-homing and OISM</a>
          </figcaption></figure>
</div>
<p id="section-1.3-3">When receiving the (S1,G1) flow from S1, SW1 will choose only one
        link to send the flow, as per <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>. Assuming PE1
        is the receiving PE on BD1, the IP Multicast flow will be forwarded as
        soon as BD1 creates multicast state for (S1,G1) or (*,G1). In the
        example of <a href="#ure-all-active-multi-homing-and-oism" class="xref">Figure 3</a>,
        receivers R1, R2 and R3 are interested in the multicast flow to G1. R1
        will receive (S1,G1) directly via the IRB interface as per <span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span>. Upon receiving IGMP reports
        from R2 and R3, PE3 will issue an SMET (*,G1) route that will create
        state in PE1's BD1. PE1 will therefore forward the IP Multicast flow
        to PE3's SBD and PE3 will forward to R2 and R3, as per <span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span> procedures.<a href="#section-1.3-3" class="pilcrow">¶</a></p>
<p id="section-1.3-4">When IP Multicast source multi-homing is required, EVPN multi-homed
        Ethernet Segments MUST be used. EVPN multi-homing guarantees that only
        one Upstream PE will forward a given multicast flow at the time,
        avoiding packet duplication at the Downstream PEs. In addition, the
        SMET route for a given flow creates state in all the multi-homing
        Upstream PEs. Therefore, in case of failure on the Upstream PE
        forwarding the flow, the backup Upstream PE can forward the flow
        immediately.<a href="#section-1.3-4" class="pilcrow">¶</a></p>
<p id="section-1.3-5">This document assumes that multi-homing PEs attached to the same
        source always use multi-homed Ethernet Segments.<a href="#section-1.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-1.4">
<section id="section-1.4">
        <h3 id="name-the-need-for-redundant-ip-m">
<a href="#section-1.4" class="section-number selfRef">1.4. </a><a href="#name-the-need-for-redundant-ip-m" class="section-name selfRef">The Need for Redundant IP Multicast Sources in EVPN</a>
        </h3>
<p id="section-1.4-1">While multi-homing PEs to the same IP Multicast G-source provides
        certain level of resiliency, multicast applications are often critical
        in the Operator's network and greater level of redundancy is required.
        This document assumes that:<a href="#section-1.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="a" class="normal type-a" id="section-1.4-2">
<li id="section-1.4-2.1">Redundant G-sources for an SFG may exist in the EVPN tenant
            network. A Redundant G-source is a host or a router that sends an
            SFG in a tenant network where there is another host or router
            sending traffic to the same SFG.<a href="#section-1.4-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-1.4-2.2">Those redundant G-sources may be in the same BD or different
            BDs of the tenant. There must not be restrictions imposed on the
            location of the receiver systems either.<a href="#section-1.4-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-1.4-2.3">The redundant G-sources can be single-homed to only one EVPN PE
            or multi-homed to multiple EVPN PEs.<a href="#section-1.4-2.3" class="pilcrow">¶</a>
</li>
          <li id="section-1.4-2.4">The EVPN PEs must avoid duplication of the same SFG on the
            receiver systems.<a href="#section-1.4-2.4" class="pilcrow">¶</a>
</li>
        </ol>
</section>
</div>
</section>
</div>
<div id="sect-2">
<section id="section-2">
      <h2 id="name-solution-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-solution-overview" class="section-name selfRef">Solution Overview</a>
      </h2>
<p id="section-2-1">An SFG is represented as (*,G) if any source that issues multicast
      traffic to G is a redundant G-source. Alternatively, this document
      allows an SFG to be represented as (S,G), where S is a prefix of any
      length. In this case, a source is considered a redundant G-source for
      the SFG if it is contained in the prefix. This document allows variable
      length prefixes in the Sources advertised in S-PMSI A-D routes only for
      the particular application of redundant G-sources.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">There are two redundant G-source solutions described in this
      document:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">Warm Standby (WS) Solution<a href="#section-2-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-3.2">Hot Standby (HS) Solution<a href="#section-2-3.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-4">The WS solution is considered an upstream-PE-based solution (since
      downstream PEs do not participate in the procedures), in which all the
      upstream PEs attached to redundant G-sources for an SFG represented by
      (*,G) or (S,G) will elect a "Single Forwarder" (SF) among themselves.
      Once a SF is elected, the upstream PEs add an Reverse Path Forwarding
      (RPF) check to the (*,G) or (S,G) state for the SFG:<a href="#section-2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-5.1">A non-SF upstream PE discards any (*,G)/(S,G) packets received
          over a local AC.<a href="#section-2-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.2">The SF accepts and forwards any (*,G)/(S,G) packets it receives
          over a single local AC (for the SFG). In case (*,G)/(S,G) packets
          for the SFG are received over multiple local ACs, they will be
          discarded in all the local ACs but one. The procedure to choose the
          local AC that accepts packets is a local implementation matter.<a href="#section-2-5.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-6">A failure on the SF will result in the election of a new SF. The
      Election requires BGP extensions on the existing EVPN routes. These
      extensions and associated procedures are described in <a href="#sect-3" class="xref">Section 3</a> and <a href="#sect-4" class="xref">Section 4</a> respectively.<a href="#section-2-6" class="pilcrow">¶</a></p>
<p id="section-2-7">In the HS solution the downstream PEs are the ones avoiding the SFG
      duplication. The upstream PEs are aware of the locally attached
      G-sources and add a unique Ethernet Segment Identifier label (ESI-label)
      per SFG to the SFG packets forwarded to downstream PEs. The downstream
      PEs pull the SFG from all the upstream PEs attached to the redundant
      G-sources and avoid duplication on the receiver systems by adding an RPF
      check to the (*,G) state for the SFG:<a href="#section-2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-8.1">A downstream PE discards any (*,G) packets it receives from the
          "wrong G-source".<a href="#section-2-8.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-8.2">The wrong G-source is identified in the data path by an ESI-label
          that is different than the ESI-label used for the selected G-
          source.<a href="#section-2-8.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-8.3">Note that the ESI-label is used here for "ingress filtering" (at
          the egress/downstream PE) as opposed to the <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>
          "egress filtering" (at the egress/downstream PE) used in the
          split-horizon procedures. In <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span> the ESI-label
          indicates what egress ACs must be skipped when forwarding BUM
          traffic to the egress. In this document, the ESI-label indicates
          what ingress traffic must be discarded at the downstream PE.<a href="#section-2-8.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-9">The use of ESI-labels for SFGs forwarded by upstream PEs require some
      control plane and data plane extensions in the procedures used by <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span> for multi-homing. Upon failure of the selected
      G-source, the downstream PE will switch over to a different selected
      G-source, and will therefore change the RPF check for the (*,G) state.
      The extensions and associated procedures are described in <a href="#sect-3" class="xref">Section 3</a> and <a href="#sect-5" class="xref">Section 5</a> respectively.<a href="#section-2-9" class="pilcrow">¶</a></p>
<p id="section-2-10">An operator should use the HS solution if they require a fast
      fail-over time and the additional bandwidth consumption is acceptable
      (SFG packets are received multiple times on the downstream PEs).
      Otherwise the operator should use the WS solution, at the expense of a
      slower fail-over time in case of a G-source or upstream PE failure.
      Besides bandwidth efficiency, another advantage of the WS solution is
      that only the upstream PEs attached to the redundant G-sources for the
      same SFG need to be upgraded to support the new procedures.<a href="#section-2-10" class="pilcrow">¶</a></p>
<p id="section-2-11">This document does not impose the support of both solutions on a
      system. If one solution is supported, the support of the other solution
      is OPTIONAL.<a href="#section-2-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-3">
<section id="section-3">
      <h2 id="name-bgp-evpn-extensions">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-bgp-evpn-extensions" class="section-name selfRef">BGP EVPN Extensions</a>
      </h2>
<p id="section-3-1">This document makes use of the following BGP EVPN extensions:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
<li id="section-3-2.1">
          <p id="section-3-2.1.1">SFG flag in the Multicast Flags Extended Community<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
<p id="section-3-2.1.2">The Single Flow Group (SFG) flag is a new bit
          requested to IANA out of the registry Multicast Flags Extended
          Community Flag Values. This new flag is set for S-PMSI A-D routes
          that carry a (*,G)/(S,G) SFG in the NLRI.<a href="#section-3-2.1.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.2">
          <p id="section-3-2.2.1">ESI Label Extended Community is used in S-PMSI A-D routes<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
<p id="section-3-2.2.2">The HS solution requires the advertisement of one or
          more ESI Label Extended Communities <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span> that
          encode the Ethernet Segment Identifier(s) associated to an S-PMSI
          A-D (*,G)/(S,G) route that advertises the presence of an SFG. Only
          the ESI Label value in the extended community is relevant to the
          procedures in this document. The Flags field in the extended
          community will be advertised as 0x00 and ignored on reception. <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span> specifies that the ESI Label Extended Community
          is advertised along with the A-D per ES route. This documents
          extends the use of this extended community so that it can be
          advertised multiple times (with different ESI values) along with the
          S-PMSI A-D route.<a href="#section-3-2.2.2" class="pilcrow">¶</a></p>
</li>
      </ol>
</section>
</div>
<div id="sect-4">
<section id="section-4">
      <h2 id="name-warm-standby-ws-solution-fo">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-warm-standby-ws-solution-fo" class="section-name selfRef">Warm Standby (WS) Solution for Redundant G-Sources</a>
      </h2>
<p id="section-4-1">The general procedure is described as follows:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-2">
<li id="section-4-2.1">
          <p id="section-4-2.1.1">Configuration of the upstream PEs<a href="#section-4-2.1.1" class="pilcrow">¶</a></p>
<p id="section-4-2.1.2">Upstream PEs (possibly attached to redundant
          G-sources) need to be configured to know which groups are carrying
          only flows from redundant G-sources, that is, the SFGs in the tenant
          domain. They will also be configured to know which local BDs may be
          attached to a redundant G-source. The SFGs can be configured for any
          source, E.g., SFG for "*", or for a prefix that contains multiple
          sources that will issue the same SFG, i.e., "10.0.0.0/30". In the
          latter case sources 10.0.0.1 and 10.0.0.2 are considered as
          Redundant G-sources, whereas 10.0.0.10 is not considered a redundant
          G-source for the same SFG.<a href="#section-4-2.1.2" class="pilcrow">¶</a></p>
<p id="section-4-2.1.3">As an
          example:<a href="#section-4-2.1.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1.4.1">PE1 is configured to know that G1 is an SFG for any source
              and redundant G-sources for G1 may be attached to BD1 or
              BD2.<a href="#section-4-2.1.4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4-2.1.4.2">Or PE1 can also be configured to know that G1 is an SFG for
              the sources contained in 10.0.0.0/30, and those redundant
              G-sources may be attached to BD1 or BD2.<a href="#section-4-2.1.4.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li id="section-4-2.2">
          <p id="section-4-2.2.1">Signaling the location of a G-source for a given SFG<a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
<p id="section-4-2.2.2">Upon receiving G-traffic for a configured SFG on a
          BD, an upstream PE configured to follow this procedure, e.g., PE1:<a href="#section-4-2.2.2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.2.3.1">Originates an S-PMSI A-D (*,G)/(S,G) route for the SFG. An
              (*,G) route is advertised if the SFG is configured for any
              source, and an (S,G) route is advertised (where the Source can
              have any length) if the SFG is configured for a prefix.<a href="#section-4-2.2.3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4-2.2.3.2">The S-PMSI A-D route is imported by all the PEs attached to
              the tenant domain. In order to do that, the route will use the
              SBD-RT (Supplementary Broadcast Domain Route-Target) in addition
              to the BD-RT of the BD over which the G-traffic is received. The
              route SHOULD also carry a DF Election Extended Community (EC)
              and a flag indicating that it conveys an SFG. The DF Election EC
              and its use is specified in <span>[<a href="#RFC8584" class="xref">RFC8584</a>]</span>.<a href="#section-4-2.2.3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4-2.2.3.3">
              <p id="section-4-2.2.3.3.1">The above S-PMSI A-D route MAY be advertised with or without
              PMSI Tunnel Attribute (PTA):<a href="#section-4-2.2.3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.2.3.3.2.1">With no PTA if an I-PMSI or S-PMSI A-D with IR/AR/BIER
                  are to be used.<a href="#section-4-2.2.3.3.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-4-2.2.3.3.2.2">With PTA in any other case.<a href="#section-4-2.2.3.3.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-4-2.2.3.4">The S-PMSI A-D route is triggered by the first packet of the
              SFG and withdrawn when the flow is not received anymore.
              Detecting when the G-source is no longer active is a local
              implementation matter. The use of a timer is RECOMMENDED. The
              timer is started when the traffic to G1 is not received. Upon
              expiration of the timer, the PE will withdraw the route<a href="#section-4-2.2.3.4" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li id="section-4-2.3">
          <p id="section-4-2.3.1">Single Forwarder (SF) Election<a href="#section-4-2.3.1" class="pilcrow">¶</a></p>
<p id="section-4-2.3.2">If the PE
          with a local G-source receives one or more S-PMSI A-D routes for the
          same SFG from a remote PE, it will run a Single Forwarder (SF)
          Election based on the information encoded in the DF Election EC. Two
          S-PMSI A-D routes are considered for the same SFG if they are
          advertised for the same tenant, and their Multicast Source Length,
          Multicast Source, Multicast Group Length and Multicast Group fields
          match.<a href="#section-4-2.3.2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-2.3.3">
<li id="section-4-2.3.3.1">A given DF Alg can only be used if all the PEs running the DF
              Alg have consistent input. For example, in an OISM network, if
              the redundant G-sources for an SFG are attached to BDs with
              different Ethernet Tags, the Default DF Election Alg MUST NOT be
              used.<a href="#section-4-2.3.3.1" class="pilcrow">¶</a>
</li>
            <li id="section-4-2.3.3.2">In case the there is a mismatch in the DF Election Alg or
              capabilities advertised by two PEs competing for the SF, the
              lowest PE IP address (given by the Originator Address in the S-
              PMSI A-D route) will be used as a tie-breaker.<a href="#section-4-2.3.3.2" class="pilcrow">¶</a>
</li>
          </ol>
</li>
        <li id="section-4-2.4">
          <p id="section-4-2.4.1">RPF check on the PEs attached to a redundant G-source<a href="#section-4-2.4.1" class="pilcrow">¶</a></p>
<p id="section-4-2.4.2">All the PEs with a local G-source for the SFG will
          add an RPF check to the (*,G)/(S,G) state for the SFG. That RPF
          check depends on the SF Election result:<a href="#section-4-2.4.2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-2.4.3">
<li id="section-4-2.4.3.1">The non-SF PEs discard any (*,G)/(S,G) packets for the SFG
              received over a local AC.<a href="#section-4-2.4.3.1" class="pilcrow">¶</a>
</li>
            <li id="section-4-2.4.3.2">The SF accepts any (*,G)/(S,G) packets for the SFG it
              receives over one (and only one) local AC.<a href="#section-4-2.4.3.2" class="pilcrow">¶</a>
</li>
          </ol>
</li>
      </ol>
<p id="section-4-3">The solution above provides redundancy for SFGs and it does not
      require an upgrade of the downstream PEs (PEs where there is certainty
      that no redundant G-sources are connected). Other G-sources for non-SFGs
      may exist in the same tenant domain. This document does not change the
      existing procedures for non-SFG G-sources.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">The redundant G-sources can be single-homed or multi-homed to a BD in
      the tenant domain. Multi-homing does not change the above
      procedures.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5"><a href="#sect-4.1" class="xref">Section 4.1</a> and <a href="#sect-4.2" class="xref">Section 4.2</a> show two
      examples of the WS solution.<a href="#section-4-5" class="pilcrow">¶</a></p>
<div id="sect-4.1">
<section id="section-4.1">
        <h3 id="name-ws-example-in-an-oism-netwo">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-ws-example-in-an-oism-netwo" class="section-name selfRef">WS Example in an OISM Network</a>
        </h3>
<p id="section-4.1-1"><a href="#ure-ws-solution-for-redundant-g-sources" class="xref">Figure 4</a>
        illustrates an example in which S1 and S2 are redundant G- sources for
        the SFG (*,G1).<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<span id="name-ws-solution-for-redundant-g"></span><div id="ure-ws-solution-for-redundant-g-sources">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-4.1-2.1">
<pre>
                     S1 (Single               S2
                     |   Forwarder)           |
              (S1,G1)|                 (S2,G1)|
                     |                        |
            PE1      |               PE2      |
            +--------v---+           +--------v---+
     S-PMSI |      +---+ |           |      +---+ | S-PMSI
     (*,G1) |  +---|BD1| |           |  +---|BD2| | (*,G1)
    Pref200 |  |VRF+---+ |           |  |VRF+---+ | Pref100
      |SFG  |+---+  | |  |           |+---+  |    |  SFG|
      | +----|SBD|--+ |  |-----------||SBD|--+    |---+ |
      v |   |+---+    |  |           |+---+       |   | v
        |   +---------|--+           +------------+   |
 SMET   |             |                               | SMET
 (*,G1) |             |   (S1,G1)                     | (*,G1)
        |    +--------+------------------+            |
    ^   |    |                           |            |   ^
    |   |    |                EVPN       |            |   |
    |   |    |                OISM       |            |   |
    |   |    |                           |            |   |
    PE3 |    |           PE4             |            | PE5
    +--------v---+       +------------+  |   +------------+
    |      +---+ |       |      +---+ |  |   |      +---+ |
    |  +---|SBD| |-------|  +---|SBD| |--|---|  +---|SBD| |
    |  |VRF+---+ |       |  |VRF+---+ |  |   |  |VRF+---+ |
    |+---+  |    |       |+---+  |    |  |   |+---+  |    |
    ||BD3|--+    |       ||BD4|--+    |  +---&gt;|BD1|--+    |
    |+---+       |       |+---+       |      |+---+       |
    +------------+       +------------+      +------------+
      |  ^                                     |  ^
      |  | IGMP                                |  | IGMP
      R1 | J(*,G1)                             R3 | J(*,G1)
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-ws-solution-for-redundant-g" class="selfRef">WS Solution for Redundant G-Sources</a>
          </figcaption></figure>
</div>
<p id="section-4.1-3">The WS solution works as follows:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.1-4">
<li id="section-4.1-4.1">
            <p id="section-4.1-4.1.1">Configuration of the upstream PEs, PE1 and PE2<a href="#section-4.1-4.1.1" class="pilcrow">¶</a></p>
<p id="section-4.1-4.1.2"> PE1 and PE2 are configured to know that G1 is an
            SFG for any source and redundant G-sources for G1 may be attached
            to BD1 or BD2, respectively.<a href="#section-4.1-4.1.2" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.1-4.2">
            <p id="section-4.1-4.2.1">Signaling the location of S1 and S2 for (*,G1)<a href="#section-4.1-4.2.1" class="pilcrow">¶</a></p>
<p id="section-4.1-4.2.2"> Upon receiving (S1,G1) traffic on a local AC, PE1
            and PE2 originate S-PMSI A-D (*,G1) routes with the SBD-RT, DF
            Election Extended Community (EC) and a flag indicating that it
            conveys an SFG.<a href="#section-4.1-4.2.2" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.1-4.3">
            <p id="section-4.1-4.3.1">Single Forwarder (SF) Election<a href="#section-4.1-4.3.1" class="pilcrow">¶</a></p>
<p id="section-4.1-4.3.2"> Based on
            the DF Election EC content, PE1 and PE2 elect an SF for (*,G1).
            Assuming both PEs agree on e.g., Preference based Election as the
            algorithm to use <span>[<a href="#DF-PREF" class="xref">DF-PREF</a>]</span>, and PE1 has a higher
            preference, PE1 becomes the SF for (*,G1).<a href="#section-4.1-4.3.2" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.1-4.4">
            <p id="section-4.1-4.4.1">RPF check on the PEs attached to a redundant G-source<a href="#section-4.1-4.4.1" class="pilcrow">¶</a></p>
<ol start="1" type="a" class="normal type-a" id="section-4.1-4.4.2">
<li id="section-4.1-4.4.2.1">The non-SF, PE2, discards any (*,G1) packets received over
                a local AC.<a href="#section-4.1-4.4.2.1" class="pilcrow">¶</a>
</li>
              <li id="section-4.1-4.4.2.2">The SF, PE1 accepts (*,G1) packets it receives over one
                (and only one) local AC.<a href="#section-4.1-4.4.2.2" class="pilcrow">¶</a>
</li>
            </ol>
</li>
        </ol>
<p id="section-4.1-5">The end result is that, upon receiving reports for (*,G1) or
        (S,G1), the downstream PEs (PE3 and PE5) will issue SMET routes and
        will pull the multicast SFG from PE1, and PE1 only. Upon a failure on
        S1, the AC connected to S1 or PE1 itself will trigger the S-PMSI A-D
        (*,G1) withdrawal from PE1 and PE2 will be promoted to SF.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-4.2">
<section id="section-4.2">
        <h3 id="name-ws-example-in-a-single-bd-t">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-ws-example-in-a-single-bd-t" class="section-name selfRef">WS Example in a Single-BD Tenant Network</a>
        </h3>
<p id="section-4.2-1"><a href="#ure-ws-solution-for-redundant-g-sources-in-the-same-bd" class="xref">Figure 5</a>
        illustrates an example in which S1 and S2 are redundant G-sources for
        the SFG (*,G1), however, now all the G-sources and receivers are
        connected to the same BD1 and there is no SBD.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<span id="name-ws-solution-for-redundant-g-"></span><div id="ure-ws-solution-for-redundant-g-sources-in-the-same-bd">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="section-4.2-2.1">
<pre>
                     S1 (Single               S2
                     |   Forwarder)           |
              (S1,G1)|                 (S2,G1)|
                     |                        |
            PE1      |               PE2      |
            +--------v---+           +--------v---+
    S-PMSI  |      +---+ |           |      +---+ | S-PMSI
    (*,G1)  |      |BD1| |           |      |BD1| | (*,G1)
    Pref200 |      +---+ |           |      +---+ | Pref100
     |SFG   |         |  |           |            |  SFG|
     |  +---|         |  |-----------|            |---+ |
     v  |   |         |  |           |            |   | v
        |   +---------|--+           +------------+   |
 SMET   |             |                               | SMET
 (*,G1) |             |     (S1,G1)                   | (*,G1)
        |    +--------+------------------------+      |
    ^   |    |                                 |      |   ^
    |   |    |                EVPN             |      |   |
    |   |    |                                 |      |   |
    |   |    |                                 |      |   |
    PE3 |    |           PE4                   |      | PE5
    +--------v---+       +------------+      +-|----------+
    |      +---+ |       |      +---+ |      | |    +---+ |
    |      |BD1| |-------|      |BD1| |------| +---&gt;|BD1| |
    |      +---+ |       |      +---+ |      |      +---+ |
    |            |       |            |      |            |
    |            |       |            |      |            |
    |            |       |            |      |            |
    +------------+       +------------+      +------------+
      |  ^                                     |  ^
      |  | IGMP                                |  | IGMP
      R1 | J(*,G1)                             R3 | J(*,G1)
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-ws-solution-for-redundant-g-" class="selfRef">WS Solution for Redundant G-Sources in the same BD</a>
          </figcaption></figure>
</div>
<p id="section-4.2-3">The same procedure as in <a href="#sect-4.1" class="xref">Section 4.1</a> is valid here,
        being this a sub-case of the one in <a href="#sect-4.1" class="xref">Section 4.1</a>. Upon
        receiving traffic for the SFG G1, PE1 and PE2 advertise the S-PMSI A-D
        routes with BD1-RT only, since there is no SBD.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-5">
<section id="section-5">
      <h2 id="name-hot-standby-hs-solution-for">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-hot-standby-hs-solution-for" class="section-name selfRef">Hot Standby (HS) Solution for Redundant G-Sources</a>
      </h2>
<p id="section-5-1">If fast-failover is required upon the failure of a G-source or PE
      attached to the G-source and the extra bandwidth consumption in the
      tenant network is not an issue, the HS solution should be used. The
      procedure is as follows:<a href="#section-5-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-2">
<li id="section-5-2.1">
          <p id="section-5-2.1.1">Configuration of the PEs<a href="#section-5-2.1.1" class="pilcrow">¶</a></p>
<p id="section-5-2.1.2">As in the WS
          case, the upstream PEs where redundant G-sources may exist need to
          be configured to know which groups (for any source or a prefix
          containing the intended sources) are carrying only flows from
          redundant G-sources, that is, the SFGs in the tenant domain.<a href="#section-5-2.1.2" class="pilcrow">¶</a></p>
<p id="section-5-2.1.3">In addition (and this is not done in WS mode), the
          individual redundant G-sources for an SFG need to be associated with
          an Ethernet Segment (ES) on the upstream PEs. This is irrespective
          of the redundant G-source being multi-homed or single-homed. Even
          for single-homed redundant G-sources the HS procedure relies on the
          ESI labels for the RPF check on downstream PEs. The term "S-ESI" is
          used in this document to refer to an ESI associated to a redundant
          G-source.<a href="#section-5-2.1.3" class="pilcrow">¶</a></p>
<p id="section-5-2.1.4">Contrary to what is specified in
          the WS method (that is transparent to the downstream PEs), the
          support of the HS procedure is required not only on the upstream PEs
          but also on all downstream PEs connected to the receivers in the
          tenant network. The downstream PEs do not need to be configured to
          know the connected SFGs or their ESIs, since they get that
          information from the upstream PEs. The downstream PEs will locally
          select an ESI for a given SFG, and will program an RPF check to the
          (*,G)/(S,G) state for the SFG that will discard (*,G)/(S,G) packets
          from the rest of the ESIs. The selection of the ESI for the SFG is
          based on local policy.<a href="#section-5-2.1.4" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-2.2">
          <p id="section-5-2.2.1">Signaling the location of a G-source for a given SFG and its
          association to the local ESIs<a href="#section-5-2.2.1" class="pilcrow">¶</a></p>
<p id="section-5-2.2.2"> Based on the
          configuration in step 1, an upstream PE configured to follow the HS
          procedures:<a href="#section-5-2.2.2" class="pilcrow">¶</a></p>
<ol start="1" type="a" class="normal type-a" id="section-5-2.2.3">
<li id="section-5-2.2.3.1">Advertises an S-PMSI A-D (*,G)/(S,G) route per each
              configured SFG. These routes need to be imported by all the PEs
              of the tenant domain, therefore they will carry the BD-RT and
              SBD-RT (if the SBD exists). The route also carries the ESI Label
              Extended Communities needed to convey all the S-ESIs associated
              to the SFG in the PE.<a href="#section-5-2.2.3.1" class="pilcrow">¶</a>
</li>
            <li id="section-5-2.2.3.2">The S-PMSI A-D route will convey a PTA in the same cases as
              in the WS procedure.<a href="#section-5-2.2.3.2" class="pilcrow">¶</a>
</li>
            <li id="section-5-2.2.3.3">The S-PMSI A-D (*,G)/(S,G) route is triggered by the
              configuration of the SFG and not by the reception of
              G-traffic.<a href="#section-5-2.2.3.3" class="pilcrow">¶</a>
</li>
          </ol>
</li>
        <li id="section-5-2.3">
          <p id="section-5-2.3.1">Distribution of DCB (Domain-wide Common Block) ESI-labels and
          G-source ES routes<a href="#section-5-2.3.1" class="pilcrow">¶</a></p>
<p id="section-5-2.3.2"> An upstream PE advertises
          the corresponding ES, A-D per EVI and A-D per ES routes for the
          local S-ESIs.<a href="#section-5-2.3.2" class="pilcrow">¶</a></p>
<ol start="1" type="a" class="normal type-a" id="section-5-2.3.3">
<li id="section-5-2.3.3.1">ES routes are used for regular DF Election for the S-ES. This
              document does not introduce any change in the procedures related
              to the ES routes.<a href="#section-5-2.3.3.1" class="pilcrow">¶</a>
</li>
            <li id="section-5-2.3.3.2">The A-D per EVI and A-D per ES routes MUST include the SBD-RT
              since they have to be imported by all the PEs in the tenant
              domain.<a href="#section-5-2.3.3.2" class="pilcrow">¶</a>
</li>
            <li id="section-5-2.3.3.3">The A-D per ES routes convey the S-ESI labels that the
              downstream PEs use to add the RPF check for the (*,G)/(S,G)
              associated to the SFGs. This RPF check requires that all the
              packets for a given G-source are received with the same S-ESI
              label value on the downstream PEs. For example, if two redundant
              G-sources are multi-homed to PE1 and PE2 via S-ES-1 and S-ES-2,
              PE1 and PE2 MUST allocate the same ESI label "Lx" for S-ES-1 and
              they MUST allocate the same ESI label "Ly" for S-ES-2. In
              addition, Lx and Ly MUST be different. These ESI labels are
              Domain-wide Common Block (DCB) labels and follow the allocation
              procedures in <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span>.<a href="#section-5-2.3.3.3" class="pilcrow">¶</a>
</li>
          </ol>
</li>
        <li id="section-5-2.4">
          <p id="section-5-2.4.1">Processing of A-D per ES/EVI routes and RPF check on the
          downstream PEs<a href="#section-5-2.4.1" class="pilcrow">¶</a></p>
<p id="section-5-2.4.2">The A-D per ES/EVI routes are
          received and imported in all the PEs in the tenant domain. The
          processing of the A-D per ES/EVI routes on a given PE depends on its
          configuration:<a href="#section-5-2.4.2" class="pilcrow">¶</a></p>
<ol start="1" type="a" class="normal type-a" id="section-5-2.4.3">
<li id="section-5-2.4.3.1">The PEs attached to the same BD of the BD-RT that is included
              in the A-D per ES/EVI routes will process the routes as in <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span> and <span>[<a href="#RFC8584" class="xref">RFC8584</a>]</span>. If the
              receiving PE is attached to the same ES as indicated in the
              route, <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span> split-horizon procedures will be
              followed and the DF Election candidate list may be modified as
              in <span>[<a href="#RFC8584" class="xref">RFC8584</a>]</span> if the ES supports the AC-DF
              capability.<a href="#section-5-2.4.3.1" class="pilcrow">¶</a>
</li>
            <li id="section-5-2.4.3.2">The PEs that are not attached to the BD-RT but are attached
              to the SBD of the received SBD-RT, will import the A-D per
              ES/EVI routes and use them for redundant G-source mass
              withdrawal, as explained later.<a href="#section-5-2.4.3.2" class="pilcrow">¶</a>
</li>
            <li id="section-5-2.4.3.3">Upon importing A-D per ES routes corresponding to different
              S-ESes, a PE MUST select a primary S-ES and add an RPF check to
              the (*,G)/(S,G) state in the BD or SBD. This RPF check will
              discard all ingress packets to (*,G)/(S,G) that are not received
              with the ESI-label of the primary S-ES. The selection of the
              primary S-ES is a matter of local policy.<a href="#section-5-2.4.3.3" class="pilcrow">¶</a>
</li>
          </ol>
</li>
        <li id="section-5-2.5">
          <p id="section-5-2.5.1">G-traffic forwarding for redundant G-sources and fault
          detection<a href="#section-5-2.5.1" class="pilcrow">¶</a></p>
<p id="section-5-2.5.2">Assuming there is (*,G) or (S,G)
          state for the SFG with OIF (Ouput Interface) list entries associated
          to remote EVPN PEs, upon receiving G-traffic on a S-ES, the upstream
          PE will add a S-ESI label at the bottom of the stack before
          forwarding the traffic to the remote EVPN PEs. This label is
          allocated from a DCB as described in step 3. If P2MP or BIER PMSIs
          are used, this is not adding any new data path procedures on the
          upstream PEs (except that the ESI-label is allocated from a DCB as
          described in <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span>). However, if
          IR/AR are used, this document extends the <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>
          procedures by pushing the S-ESI labels not only on packets sent to
          the PEs that shared the ES but also to the rest of the PEs in the
          tenant domain. This allows the downstream PEs to receive all the
          multicast packets from the redundant G-sources with a S-ESI label
          (irrespective of the PMSI type and the local ESes), and discard any
          packet that conveys a S-ESI label different from the primary S-ESI
          label (that is, the label associated to the selected primary S-ES),
          as discussed in step 4.<a href="#section-5-2.5.2" class="pilcrow">¶</a></p>
<p id="section-5-2.5.3">If the last A-D per
          EVI or the last A-D per ES route for the primary S-ES is withdrawn,
          the downstream PE will immediately select a new primary S-ES and
          will change the RPF check. Note that if the S-ES is re-used for
          multiple tenant domains by the upstream PEs, the withdrawal of all
          the A-D per-ES routes for a S-ES provides a mass withdrawal
          capability that makes a downstream PE to change the RPF check in all
          the tenant domains using the same S-ES.<a href="#section-5-2.5.3" class="pilcrow">¶</a></p>
<p id="section-5-2.5.4">The
          withdrawal of the last S-PMSI A-D route for a given (*,G)/(S,G) that
          represents a SFG SHOULD make the downstream PE remove the S-ESI
          label based RPF check on (*,G)/(S,G).<a href="#section-5-2.5.4" class="pilcrow">¶</a></p>
</li>
      </ol>
<div id="sect-5.1">
<section id="section-5.1">
        <h3 id="name-extensions-for-the-advertis">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-extensions-for-the-advertis" class="section-name selfRef">Extensions for the Advertisement of DCB Labels</a>
        </h3>
<p id="section-5.1-1">DCB Labels are specified in <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span> and this document
        makes use of them for the procedures described in <a href="#sect-5" class="xref">Section 5</a>. <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span> assumes that DCB
        labels can only be used along with MP2MP/P2MP/BIER tunnels and that,
        if the PMSI label is signaled as a DCB label, then the ESI label used
        for multi-homing is also a DCB label. This document extends the use of
        the DCB allocation for ESI labels so that:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="a" class="normal type-a" id="section-5.1-2">
<li id="section-5.1-2.1">DCB-allocated ESI labels MAY be used along with IR tunnels,
            and<a href="#section-5.1-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.1-2.2">DCB-allocated ESI labels MAY be used by PEs that do not use
            DCB-allocated PMSI labels.<a href="#section-5.1-2.2" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.1-3">This control plane extension is indicated by adding the
        DCB-flag or the Context Label Space ID Extended Community to the A-D
        per ES route(s) advertised for the S-ES. The DCB-flag is encoded in
        the ESI Label Extended Community as follows:<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<span id="name-esi-label-extended-communit"></span><div id="ESI-label">
<figure id="figure-6">
          <div class="alignLeft art-text artwork" id="section-5.1-4.1">
<pre>                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Type=0x06     | Sub-Type=0x01 | Flags(1 octet)|  Reserved=0   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Reserved=0   |          ESI Label                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-esi-label-extended-communit" class="selfRef">ESI Label Extended Community</a>
          </figcaption></figure>
</div>
<p id="section-5.1-5">This document defines the bit 5 in the Flags octet of the
        ESI Label Extended Community as the ESI-DCB-flag. When the
        ESI-DCB-flag is set, it indicates that the ESI label is a DCB
        label.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1-6">A received ESI label is considered DCB if either of these two
        conditions is met:<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<ol start="1" type="a" class="normal type-a" id="section-5.1-7">
<li id="section-5.1-7.1">The ESI label is encoded in an ESI Label Extended Community
            with the ESI-DCB-flag set.<a href="#section-5.1-7.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.1-7.2">The ESI label is signaled from a PE that advertised a PMSI
            label that is a DCB label.<a href="#section-5.1-7.2" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.1-8">As in <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span>
        this document also allows the use of context label space ID Extended
        Community. When the context label space ID extended community is
        advertised along with the ESI label in an A-D per ES route, the ESI
        label is from a context label space identified by the DCB label in the
        Extended Community.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.2">
<section id="section-5.2">
        <h3 id="name-use-of-bfd-in-the-hs-soluti">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-use-of-bfd-in-the-hs-soluti" class="section-name selfRef">Use of BFD in the HS Solution</a>
        </h3>
<p id="section-5.2-1">In addition to using the state of the A-D per EVI, A-D per ES or
        S-PMSI A-D routes to modify the RPF check on (*,G)/(S,G) as discussed
        in <a href="#sect-5" class="xref">Section 5</a>, Bidirectional Forwarding Detection (BFD)
        protocol MAY be used to find the status of the multipoint tunnels used
        to forward the SFG from the redundant G-sources.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">The BGP-BFD Attribute is advertised along with the S-PMSI A-D or
        IMET routes (depending on whether I-PMSI or S-PMSI trees are used) and
        the procedures described in <span>[<a href="#EVPN-BFD" class="xref">EVPN-BFD</a>]</span> are used to
        bootstrap multipoint BFD sessions on the downstream PEs.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-5.3">
<section id="section-5.3">
        <h3 id="name-hs-example-in-an-oism-netwo">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-hs-example-in-an-oism-netwo" class="section-name selfRef">HS Example in an OISM Network</a>
        </h3>
<p id="section-5.3-1"><a href="#ure-hs-solution-for-multi-homed-redundant-g-sources-in-oism" class="xref">Figure 7</a>
        illustrates the HS model in an OISM network. Consider S1 and S2 are
        redundant G-sources for the SFG (*,G1) in BD1 (any source using G1 is
        assumed to transmit an SFG). S1 and S2 are (all-active) multi-homed to
        upstream PEs, PE1 and PE2. The receivers are attached to downstream
        PEs, PE3 and PE5, in BD3 and BD1, respectively. S1 and S2 are assumed
        to be connected by a LAG to the multi-homing PEs, and the multicast
        traffic can use the link to either upstream PE. The diagram
        illustrates how S1 sends the G-traffic to PE1 and PE1 forwards to the
        remote interested downstream PEs, whereas S2 sends to PE2 and PE2
        forwards further. In this HS model, the interested downstream PEs will
        get duplicate G-traffic from the two G-sources for the same SFG. While
        the diagram shows that the two flows are forwarded by different
        upstream PEs, the all-active multi-homing procedures may cause that
        the two flows come from the same upstream PE. Therefore, finding out
        the upstream PE for the flow is not enough for the downstream PEs to
        program the required RPF check to avoid duplicate packets on the
        receiver.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<span id="name-hs-solution-for-multi-homed"></span><div id="ure-hs-solution-for-multi-homed-redundant-g-sources-in-oism">
<figure id="figure-7">
          <div class="alignLeft art-text artwork" id="section-5.3-2.1">
<pre>
                     S1(ESI-1)                S2(ESI-2)
                     |                        |
                     | +----------------------+
              (S1,G1)| |               (S2,G1)|
                     +----------------------+ |
            PE1      | |             PE2    | |
            +--------v---+           +--------v---+
            |      +---+ |           |      +---+ |  S-PMSI
 S-PMSI     |  +---|BD1| |           |  +---|BD1| |  (*,G1)
 (*,G1)     |  |VRF+---+ |           |  |VRF+---+ |   SFG
  SFG       |+---+  | |  |           |+---+  | |  |   ESI1,2
 ESI1,2 +---||SBD|--+ |  |-----------||SBD|--+ |  |---+  |
    |   |   |+---+    |  |   EVPN    |+---+    |  |   |  v
    v   |   +---------|--+   OISM    +---------|--+   |
        |             |                        |      |
        |             |   (S1,G1)              |      |
 SMET   |   +---------+------------------+     |      | SMET
 (*,G1) |   |                            |     |      | (*,G1)
    ^   |   | +----------------------------+---+      |   ^
    |   |   | |             (S2,G1)      | |          |   |
    |   |   | |                          | |          |   |
    PE3 |   | |          PE4             | |          | PE5
    +-------v-v--+       +------------+  | | +------------+
    |      +---+ |       |      +---+ |  | | |      +---+ |
    |  +---|SBD| +-------|  +---|SBD| |--|-|-|  +---|SBD| |
    |  |VRF+---+ |       |  |VRF+---+ |  | | |  |VRF+---+ |
    |+---+  |    |       |+---+  |    |  | | |+---+  |    |
    ||BD3|--+    |       ||BD4|--+    |  | +-&gt;|BD1|--+    |
    |+---+       |       |+---+       |  +---&gt;+---+       |
    +------------+       +------------+      +------------+
      |  ^                                     |  ^
      |  | IGMP                                |  | IGMP
      R1 | J(*,G1)                             R3 | J(*,G1)
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-hs-solution-for-multi-homed" class="selfRef">HS Solution for Multi-homed Redundant G-Sources in OISM</a>
          </figcaption></figure>
</div>
<p id="section-5.3-3">In this scenario, the HS solution works as follows:<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-4">
<li id="section-5.3-4.1">
            <p id="section-5.3-4.1.1">Configuration of the upstream PEs, PE1 and PE2<a href="#section-5.3-4.1.1" class="pilcrow">¶</a></p>
<p id="section-5.3-4.1.2">PE1 and PE2 are configured to know that G1 is an
            SFG for any source (a source prefix length could have been
            configured instead) and the redundant G-sources for G1 use S-ESIs
            ESI-1 and ESI-2 respectively. Both ESes are configured in both PEs
            and the ESI value can be configured or auto-derived. The ESI-label
            values are allocated from a DCB <span>[<a href="#I-D.ietf-bess-mvpn-evpn-aggregation-label" class="xref">I-D.ietf-bess-mvpn-evpn-aggregation-label</a>]</span> and are
            configured either locally or by a centralized controller. We
            assume ESI-1 is configured to use ESI-label-1 and ESI-2 to use
            ESI-label-2.<a href="#section-5.3-4.1.2" class="pilcrow">¶</a></p>
<p id="section-5.3-4.1.3">The downstream PEs, PE3, PE4
            and PE5 are configured to support HS mode and select the G-source
            with e.g., lowest ESI value.<a href="#section-5.3-4.1.3" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-4.2">
            <p id="section-5.3-4.2.1">PE1 and PE2 advertise S-PMSI A-D (*,G1) and ES/A-D per ES/EVI
            routes<a href="#section-5.3-4.2.1" class="pilcrow">¶</a></p>
<p id="section-5.3-4.2.2">Based on the configuration of step
            1, PE1 and PE2 advertise an S-PMSI A-D (*,G1) route each. The
            route from each of the two PEs will include TWO ESI Label Extended
            Communities with ESI-1 and ESI-2 respectively, as well as BD1-RT
            plus SBD-RT and a flag that indicates that (*,G1) is an SFG.<a href="#section-5.3-4.2.2" class="pilcrow">¶</a></p>
<p id="section-5.3-4.2.3">In addition, PE1 and PE2 advertise ES and
            A-D per ES/EVI routes for ESI-1 and ESI-2. The A-D per ES and per
            EVI routes will include the SBD-RT so that they can be imported by
            the downstream PEs that are not attached to BD1, e.g., PE3 and
            PE4. The A-D per ES routes will convey ESI-label-1 for ESI-1 (on
            both PEs) and ESI-label-2 for ESI-2 (also on both PEs).<a href="#section-5.3-4.2.3" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-4.3">
            <p id="section-5.3-4.3.1">Processing of A-D per ES/EVI routes and RPF check<a href="#section-5.3-4.3.1" class="pilcrow">¶</a></p>
<p id="section-5.3-4.3.2">PE1 and PE2 received each other's ES and A-D per
            ES/EVI routes. Regular <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span> <span>[<a href="#RFC8584" class="xref">RFC8584</a>]</span> procedures will be followed for DF Election and
            programming of the ESI-labels for egress split-horizon filtering.
            PE3/PE4 import the A-D per ES/EVI routes in the SBD. Since PE3 has
            created a (*,G1) state based on local interest, PE3 will add an
            RPF check to (*,G1) so that packets coming with ESI-label-2 are
            discarded (lowest ESI value is assumed to give the primary
            S-ES).<a href="#section-5.3-4.3.2" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-4.4">
            <p id="section-5.3-4.4.1">G-traffic forwarding and fault detection<a href="#section-5.3-4.4.1" class="pilcrow">¶</a></p>
<p id="section-5.3-4.4.2">PE1 receives G-traffic (S1,G1) on ES-1 that is
            forwarded within the context of BD1. Irrespective of the tunnel
            type, PE1 pushes ESI-label-1 at the bottom of the stack and the
            traffic gets to PE3 and PE5 with the mentioned ESI-label (PE4 has
            no local interested receivers). The G-traffic with ESI-label-1
            passes the RPF check and it is forwarded to R1. In the same way,
            PE2 sends (S2,G1) with ESI-label-2, but this G-traffic does not
            pass the RPF check and gets discarded at PE3/PE5.<a href="#section-5.3-4.4.2" class="pilcrow">¶</a></p>
<p id="section-5.3-4.4.3">If the link from S1 to PE1 fails, S1 will forward
            the (S1,G1) traffic to PE2 instead. PE1 withdraws the ES and A-D
            routes for ESI-1. Now both flows will be originated by PE2,
            however the RPF checks don't change in PE3/PE5.<a href="#section-5.3-4.4.3" class="pilcrow">¶</a></p>
<p id="section-5.3-4.4.4">If subsequently, the link from S1 to PE2 fails,
            PE2 also withdraws the ES and A-D routes for ESI-1. Since PE3 and
            PE5 have no longer A-D per ES/EVI routes for ESI-1, they
            immediately change the RPF check so that packets with ESI-label-2
            are now accepted.<a href="#section-5.3-4.4.4" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-5.3-5"><a href="#ure-hs-solution-for-single-homed-redundant-g-sources-in-oism" class="xref">Figure 8</a>
        illustrates a scenario where S1 and S2 are single-homed to PE1 and PE2
        respectively. This scenario is a sub-case of the one in <a href="#ure-hs-solution-for-multi-homed-redundant-g-sources-in-oism" class="xref">Figure 7</a>.
        Now ES-1 only exists in PE1, hence only PE1 advertises the A-D per
        ES/EVI routes for ESI-1. Similarly, ES-2 only exists in PE2 and PE2 is
        the only PE advertising A-D routes for ESI-2. The same procedures as
        in <a href="#ure-hs-solution-for-multi-homed-redundant-g-sources-in-oism" class="xref">Figure 7</a>
        applies to this use-case.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
<span id="name-hs-solution-for-single-home"></span><div id="ure-hs-solution-for-single-homed-redundant-g-sources-in-oism">
<figure id="figure-8">
          <div class="alignLeft art-text artwork" id="section-5.3-6.1">
<pre>
                     S1(ESI-1)                S2(ESI-2)
                     |                        |
              (S1,G1)|                 (S2,G1)|
                     |                        |
            PE1      |               PE2      |
            +--------v---+           +--------v---+
            |      +---+ |           |      +---+ |  S-PMSI
 S-PMSI     |  +---|BD1| |           |  +---|BD2| |  (*,G1)
 (*,G1)     |  |VRF+---+ |           |  |VRF+---+ |   SFG
  SFG       |+---+  | |  |           |+---+  | |  |   ESI2
  ESI1  +---||SBD|--+ |  |-----------||SBD|--+ |  |---+  |
    |   |   |+---+    |  |   EVPN    |+---+    |  |   |  v
    v   |   +---------|--+   OISM    +---------|--+   |
        |             |                        |      |
        |             |   (S1,G1)              |      |
 SMET   |   +---------+------------------+     |      | SMET
 (*,G1) |   |                            |     |      | (*,G1)
    ^   |   | +--------------------------------+----+ |   ^
    |   |   | |             (S2,G1)      |          | |   |
    |   |   | |                          |          | |   |
    PE3 |   | |          PE4             |          | | PE5
    +-------v-v--+       +------------+  |   +------v-----+
    |      +---+ |       |      +---+ |  |   |      +---+ |
    |  +---|SBD| |-------|  +---|SBD| |--|---|  +---|SBD| |
    |  |VRF+---+ |       |  |VRF+---+ |  |   |  |VRF+---+ |
    |+---+  |    |       |+---+  |    |  |   |+---+  |    |
    ||BD3|--+    |       ||BD4|--+    |  +---&gt;|BD1|--+    |
    |+---+       |       |+---+       |      |+---+       |
    +------------+       +------------+      +------------+
      |  ^                                     |  ^
      |  | IGMP                                |  | IGMP
      R1 | J(*,G1)                             R3 | J(*,G1)
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-hs-solution-for-single-home" class="selfRef">HS Solution for single-homed Redundant G-Sources in OISM</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sect-5.4">
<section id="section-5.4">
        <h3 id="name-hs-example-in-a-single-bd-t">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-hs-example-in-a-single-bd-t" class="section-name selfRef">HS Example in a Single-BD Tenant Network</a>
        </h3>
<p id="section-5.4-1">Irrespective of the redundant G-sources being multi-homed or
        single-homed, if the tenant network has only one BD, e.g., BD1, the
        procedures of <a href="#sect-5.2" class="xref">Section 5.2</a> still apply, only that routes
        do not include any SBD-RT and all the procedures apply to BD1
        only.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-6">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">The same Security Considerations described in <span>[<a href="#I-D.ietf-bess-evpn-irb-mcast" class="xref">I-D.ietf-bess-evpn-irb-mcast</a>]</span> are valid for this document.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">From a security perspective, out of the two methods described in this
      document, the WS method is considered lighter in terms of control plane
      and therefore its impact is low on the processing capabilities of the
      PEs. The HS method adds more burden on the control plane of all the PEs
      of the tenant with sources and receivers.<a href="#section-6-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-7">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1">IANA is requested to allocate a Bit in the Multicast Flags Extended
      Community to indicate that a given (*,G) or (S,G) in an S-PMSI A-D route
      is associated with an SFG.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-8">
      <h2 id="name-references">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-8.1">
        <h3 id="name-normative-references">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC7432">[RFC7432]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Isaac, A.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"BGP MPLS-Based Ethernet VPN"</span>, <span class="seriesInfo">RFC 7432</span>, <span class="seriesInfo">DOI 10.17487/RFC7432</span>, <time datetime="2015-02" class="refDate">February 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7432">https://www.rfc-editor.org/info/rfc7432</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6513">[RFC6513]</dt>
        <dd>
<span class="refAuthor">Rosen, E., Ed.</span> and <span class="refAuthor">R. Aggarwal, Ed.</span>, <span class="refTitle">"Multicast in MPLS/BGP IP VPNs"</span>, <span class="seriesInfo">RFC 6513</span>, <span class="seriesInfo">DOI 10.17487/RFC6513</span>, <time datetime="2012-02" class="refDate">February 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6513">https://www.rfc-editor.org/info/rfc6513</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6514">[RFC6514]</dt>
        <dd>
<span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Rosen, E.</span>, <span class="refAuthor">Morin, T.</span>, and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"BGP Encodings and Procedures for Multicast in MPLS/BGP IP VPNs"</span>, <span class="seriesInfo">RFC 6514</span>, <span class="seriesInfo">DOI 10.17487/RFC6514</span>, <time datetime="2012-02" class="refDate">February 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6514">https://www.rfc-editor.org/info/rfc6514</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-evpn-igmp-mld-proxy">[I-D.ietf-bess-evpn-igmp-mld-proxy]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Thoria, S.</span>, <span class="refAuthor">Mishra, M.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">W. Lin</span>, <span class="refTitle">"IGMP and MLD Proxy for EVPN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-igmp-mld-proxy-16</span>, <time datetime="2022-01-13" class="refDate">13 January 2022</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-bess-evpn-igmp-mld-proxy-16.txt">https://www.ietf.org/archive/id/draft-ietf-bess-evpn-igmp-mld-proxy-16.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-evpn-irb-mcast">[I-D.ietf-bess-evpn-irb-mcast]</dt>
        <dd>
<span class="refAuthor">Lin, W.</span>, <span class="refAuthor">Zhang, Z.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Rosen, E. C.</span>, <span class="refAuthor">Rabadan, J.</span>, and <span class="refAuthor">A. Sajassi</span>, <span class="refTitle">"EVPN Optimized Inter-Subnet Multicast (OISM) Forwarding"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-irb-mcast-06</span>, <time datetime="2021-05-24" class="refDate">24 May 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-bess-evpn-irb-mcast-06.txt">https://www.ietf.org/archive/id/draft-ietf-bess-evpn-irb-mcast-06.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8584">[RFC8584]</dt>
        <dd>
<span class="refAuthor">Rabadan, J., Ed.</span>, <span class="refAuthor">Mohanty, S., Ed.</span>, <span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Nagaraj, K.</span>, and <span class="refAuthor">S. Sathappan</span>, <span class="refTitle">"Framework for Ethernet VPN Designated Forwarder Election Extensibility"</span>, <span class="seriesInfo">RFC 8584</span>, <span class="seriesInfo">DOI 10.17487/RFC8584</span>, <time datetime="2019-04" class="refDate">April 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8584">https://www.rfc-editor.org/info/rfc8584</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-mvpn-evpn-aggregation-label">[I-D.ietf-bess-mvpn-evpn-aggregation-label]</dt>
      <dd>
<span class="refAuthor">Zhang, Z.</span>, <span class="refAuthor">Rosen, E.</span>, <span class="refAuthor">Lin, W.</span>, <span class="refAuthor">Li, Z.</span>, and <span class="refAuthor">I. Wijnands</span>, <span class="refTitle">"MVPN/EVPN Tunnel Aggregation with Common Labels"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-mvpn-evpn-aggregation-label-08</span>, <time datetime="2022-01-20" class="refDate">20 January 2022</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-bess-mvpn-evpn-aggregation-label-08.txt">https://www.ietf.org/archive/id/draft-ietf-bess-mvpn-evpn-aggregation-label-08.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-8.2">
        <h3 id="name-informative-references">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="EVPN-RT5">[EVPN-RT5]</dt>
        <dd>
<span class="refAuthor">Rabadan, J.</span>, <span class="refAuthor">Henderickx, W.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Lin, W.</span>, and <span class="refAuthor">A. Sajassi</span>, <span class="refTitle">"IP Prefix Advertisement in EVPN"</span>, <span class="seriesInfo">internet-draft ietf-bess-evpn-prefix-advertisement-11.txt</span>, <time datetime="2018-05" class="refDate">May 2018</time>. </dd>
<dd class="break"></dd>
<dt id="EVPN-BUM">[EVPN-BUM]</dt>
        <dd>
<span class="refAuthor">Zhang, Z.</span>, <span class="refAuthor">Lin, W.</span>, <span class="refAuthor">Rabadan, J.</span>, and <span class="refAuthor">K. Patel</span>, <span class="refTitle">"Updates on EVPN BUM Procedures"</span>, <span class="seriesInfo">internet-draft ietf-bess-evpn-bum-procedure-updates-06</span>, <time datetime="2019-06" class="refDate">June 2019</time>. </dd>
<dd class="break"></dd>
<dt id="DF-PREF">[DF-PREF]</dt>
        <dd>
<span class="refAuthor">Rabadan, J.</span>, <span class="refAuthor">Sathappan, S.</span>, <span class="refAuthor">Przygienda, T.</span>, <span class="refAuthor">Lin, W.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Sajassi, A.</span>, and <span class="refAuthor">S. Mohanty</span>, <span class="refTitle">"Preference-based EVPN DF Election"</span>, <span class="seriesInfo">internet-draft ietf-bess-evpn-pref-df-04.txt</span>, <time datetime="2019-06" class="refDate">June 2019</time>. </dd>
<dd class="break"></dd>
<dt id="RFC4364">[RFC4364]</dt>
        <dd>
<span class="refAuthor">Rosen, E.</span> and <span class="refAuthor">Y. Rekhter</span>, <span class="refTitle">"BGP/MPLS IP Virtual Private Networks (VPNs)"</span>, <span class="seriesInfo">RFC 4364</span>, <span class="seriesInfo">DOI 10.17487/RFC4364</span>, <time datetime="2006-02" class="refDate">February 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4364">https://www.rfc-editor.org/info/rfc4364</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="EVPN-BFD">[EVPN-BFD]</dt>
      <dd>
<span class="refAuthor">Govindan, V.</span>, <span class="refAuthor">Mallik, M.</span>, <span class="refAuthor">Sajassi, A.</span>, and <span class="refAuthor">G. Mirsky</span>, <span class="refTitle">"Fault Management for EVPN networks"</span>, <span class="seriesInfo">internet-draft ietf-bess-evpn-bfd-01.txt</span>, <time datetime="2020-10" class="refDate">October 2020</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="sect-9">
<section id="appendix-A">
      <h2 id="name-acknowledgments">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-A-1">The authors would like to thank Mankamana Mishra and Ali Sajassi for
      their review and valuable comments.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-10">
<section id="appendix-B">
      <h2 id="name-contributors">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-contributors" class="section-name selfRef">Contributors</a>
    </h2>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jorge Rabadan (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Nokia</span></div>
<div dir="auto" class="left"><span class="street-address">777 Middlefield Road</span></div>
<div dir="auto" class="left">
<span class="locality">Mountain View</span>, <span class="region">CA</span> <span class="postal-code">94043</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jorge.rabadan@nokia.com" class="email">jorge.rabadan@nokia.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jayant Kotalwar</span></div>
<div dir="auto" class="left"><span class="org">Nokia</span></div>
<div dir="auto" class="left"><span class="street-address">701 E. Middlefield Road<br>Mountain View, CA 94043 USA</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jayant.kotalwar@nokia.com" class="email">jayant.kotalwar@nokia.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Senthil Sathappan</span></div>
<div dir="auto" class="left"><span class="org">Nokia</span></div>
<div dir="auto" class="left"><span class="street-address">701 E. Middlefield Road<br>Mountain View, CA 94043 USA</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:senthil.sathappan@nokia.com" class="email">senthil.sathappan@nokia.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Zhaohui Zhang</span></div>
<div dir="auto" class="left"><span class="org">Juniper Networks</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:zzhang@juniper.net" class="email">zzhang@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Wen Lin</span></div>
<div dir="auto" class="left"><span class="org">Juniper Networks</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:wlin@juniper.net" class="email">wlin@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Eric C. Rosen</span></div>
<div dir="auto" class="left"><span class="org">Individual</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:erosen52@gmail.com" class="email">erosen52@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
