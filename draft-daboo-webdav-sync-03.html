<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Collection Synchronization for WebDAV</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Collection Synchronization for WebDAV">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">C. Daboo</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Apple, Inc.</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">A. Quillaud</td></tr>
<tr><td class="header">Expires: September 9, 2010</td><td class="header">Sun Microsystems</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 08, 2010</td></tr>
</table></td></tr></table>
<h1><br />Collection Synchronization for WebDAV<br />draft-daboo-webdav-sync-03</h1>

<h3>Abstract</h3>

<p>
        This specification defines an extension to WebDAV that allows efficient synchronization of the contents of a WebDAV collection.
      
</p>
<h3>Editorial Note (To be removed by RFC Editor before publication)</h3>

<p>
        Please send comments to the
        Distributed Authoring and Versioning (WebDAV) working group at <a href='mailto:w3c-dist-auth@w3.org'>mailto:w3c-dist-auth@w3.org</a>, which may be joined by sending a message with subject
        "subscribe" to <a href='mailto:w3c-dist-auth-request@w3.org'>mailto:w3c-dist-auth-request@w3.org</a>.
        Discussions of the WEBDAV working group are archived at
        <a href='http://lists.w3.org/Archives/Public/w3c-dist-auth/'>http://lists.w3.org/Archives/Public/w3c-dist-auth/</a>.
      
</p>
<h3>Status of This Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 9, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Conventions Used in This Document<br />
<a href="#sync-collection">3.</a>&nbsp;
WebDAV Synchronization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.2.</a>&nbsp;
DAV:sync-collection Report<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.3.</a>&nbsp;
Types of Changes Reported on Initial Synchronization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#change-types">3.4.</a>&nbsp;
Types of Changes Reported on Subsequent Synchronizations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.4.1.</a>&nbsp;
Changed Resource<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.4.2.</a>&nbsp;
Removed Resource<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.5.</a>&nbsp;
Truncation of Results<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#limits">3.6.</a>&nbsp;
Limiting Results<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.7.</a>&nbsp;
Example: Initial DAV:sync-collection Report<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.8.</a>&nbsp;
Example: DAV:sync-collection Report with Token<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.9.</a>&nbsp;
Example: Initial DAV:sync-collection Report with Truncation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.10.</a>&nbsp;
Example: Initial DAV:sync-collection Report with Limit<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">3.11.</a>&nbsp;
Example: DAV:sync-collection Report with Unsupported Limit<br />
<a href="#sync_property">4.</a>&nbsp;
DAV:sync-token Property<br />
<a href="#anchor14">5.</a>&nbsp;
XML Element Definitions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sync_collection_element">5.1.</a>&nbsp;
DAV:sync-collection XML Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sync_token_element">5.2.</a>&nbsp;
DAV:sync-token XML Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#multistatus_element">5.3.</a>&nbsp;
DAV:multistatus XML Element<br />
<a href="#anchor15">6.</a>&nbsp;
Security Considerations<br />
<a href="#anchor16">7.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor17">8.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#anchor20">Appendix&nbsp;A.</a>&nbsp;
Change History (to be removed prior to publication as an RFC)<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
        WebDAV <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a> defines the concept of 'collections' which are hierarchical groupings of WebDAV resources on an
        HTTP <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> server. Collections can be of arbitrary size and depth (i.e., collections within collections).
        WebDAV clients that cache resource content need a way to synchronize that data with the server (i.e., detect what has changed
        and update their cache). This can currently be done using a WebDAV PROPFIND request on a collection to list all members of a
        collection along with their DAV:getetag property values, which allows the client to determine which resources were changed, added
        or deleted. However, this does not scale well to large collections as the XML response to the PROPFIND request will grow with the
        collection size.
      
</p>
<p>
        This specification defines a new WebDAV report that results in the server returning to the client only information about those
        resources which have changed, are new or were deleted since a previous execution of the report on the collection.
      
</p>
<p>
        Additionally, a new property is added to collection resources that is used to convey a "synchronization token" that is guaranteed
        to change when resources within the collection have changed.
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions Used in This Document</h3>

<p>
        The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
      
</p>
<p>
        This document uses XML DTD fragments (<a class='info' href='#W3C.REC-xml-20081126'>[W3C.REC&#8209;xml&#8209;20081126]<span> (</span><span class='info'>Maler, E., Yergeau, F., Sperberg-McQueen, C., Paoli, J., and T. Bray, &ldquo;Extensible Markup Language (XML) 1.0 (Fifth Edition),&rdquo; November&nbsp;2008.</span><span>)</span></a>, Section 3.2) as a purely notational convention.  WebDAV request and response bodies cannot be validated by a DTD due to the specific extensibility rules defined in Section 17 of [RFC4918] and due to the fact that all XML elements defined by this specification use the XML namespace name "DAV:".  In particular:
        </p>
<ol class="text">
<li>element names use the "DAV:" namespace,
</li>
<li>element ordering is irrelevant unless explicitly stated,
</li>
<li>extension elements (elements not already defined as valid child elements) may be added anywhere, except when explicitly stated otherwise,
</li>
<li>extension attributes (attributes not already defined as valid for this element) may be added anywhere, except when explicitly stated otherwise.
</li>
</ol><p>
      
</p>
<p>
        When an XML element type in the "DAV:" namespace is referenced in this document outside of the context of an XML fragment, the string "DAV:" will be prefixed to the element type.
      
</p>
<p>
        This document inherits, and sometimes extends, DTD productions from Section 14 of <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>.
      
</p>
<a name="sync-collection"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
WebDAV Synchronization</h3>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Overview</h3>

<p>
          One way to synchronize data between two entities is to use some form of synchronization token. The token defines
          the state of the data being synchronized at a particular point in time. It can then be used to determine what has
          changed since one point in time and another.
        
</p>
<p>
          This specification defines a new WebDAV report that is used to enable client-server collection synchronization based on such a token.
        
</p>
<p>
          In order to synchronize the contents of a collection between a server and client, the server provides the client with a synchronization
          token each time the synchronization report is executed. That token represents the state of the data being synchronized at that point in time.
          The client can then present that same token back to the server at some later time and the server will return only those items that are new,
          have changed or were deleted since that token was generated. The server also returns a new token representing the new state at the time the report was run.
        
</p>
<p>
          Typically the first time a client connects to the server it will need to be informed of the entire state
          of the collection (i.e., a full list of all resources that are currently contained in the collection).
          That is done by the client sending an empty token value to the server. This indicates to the server that a full listing is required.
        
</p>
<p>
          As an alternative, the client may choose to do its first synchronization using some other mechanism on the collection (e.g. some other
          form of batch resource information retrieval such as PROPFIND, SEARCH <a class='info' href='#RFC5323'>[RFC5323]<span> (</span><span class='info'>Reschke, J., Reddy, S., Davis, J., and A. Babich, &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2008.</span><span>)</span></a>, or specialized REPORTs such as those defined in
          CalDAV <a class='info' href='#RFC4791'>[RFC4791]<span> (</span><span class='info'>Daboo, C., Desruisseaux, B., and L. Dusseault, &ldquo;Calendaring Extensions to WebDAV (CalDAV),&rdquo; March&nbsp;2007.</span><span>)</span></a> and CardDAV <a class='info' href='#I-D.ietf-vcarddav-carddav'>[I&#8209;D.ietf&#8209;vcarddav&#8209;carddav]<span> (</span><span class='info'>Daboo, C., &ldquo;vCard Extensions to WebDAV (CardDAV),&rdquo; November&nbsp;2009.</span><span>)</span></a>) and ask for the DAV:sync-token property to be returned.
          This property (defined in <a class='info' href='#sync_property'>Section&nbsp;4<span> (</span><span class='info'>DAV:sync-token Property</span><span>)</span></a>) contains the same token that can
          be used later on to issue a DAV:sync-collection report.
        
</p>
<p>
          In some cases a server may only wish to maintain a limited amount of history about changes to a collection. In that situation
          it will return an error to the client when the client presents a token that is "out of date". At that point the client has to fall
          back to synchronizing the entire collection by re-running the report request using an empty token value.
        
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
DAV:sync-collection Report</h3>

<p>
          This specification defines the DAV:sync-collection report.
        
</p>
<p>
          If this report is implemented by a WebDAV server, then the server MUST list the report in the "DAV:supported-report-set"
          property on any collection supporting synchronization.
        
</p>
<p>
          To implement the behavior for this report a server needs to keep track of changes to any resources in a collection.
          This includes noting the addition of new resources, changes to existing resources and removal of resources.
          Only internal members of the collection (as defined in <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>) are to be considered.
          The server will track each change and provide a synchronization "token" to the client that describes the state of the server
          at a specific point in time. This "token" is returned as part of the response to the "sync-collection" report. Clients include
          the last token they got from the server in the next "sync-collection" report that they execute and the server provides the changes
          from the previous state, represented by the token, to the current state, represented by the new token returned.
        
</p>
<p>
          The synchronization token itself is an "opaque" string - i.e., the actual string data has no specific meaning or syntax.
          A simple implementation of such a token would be a numeric counter that counts each change as it occurs and relates that change
          to the specific object that changed.
        
</p>
<p>
          Marshalling:
          </p>
<blockquote class="text">
<p>
              The request URI MUST identify a collection. The request body MUST be a DAV:sync-collection XML element (see
              <a class='info' href='#sync_collection_element'>Section&nbsp;5.1<span> (</span><span class='info'>DAV:sync-collection XML Element</span><span>)</span></a>), which MUST contain one DAV:sync-token XML element, and one DAV:prop XML element.
            
</p>
<p>
                The request MUST include a Depth header with a value of "1".
            
</p>
<p>
              The response body for a successful request MUST be a DAV:multistatus XML element, which MUST contain one DAV:sync-token
              element in addition to one DAV:response element for each resource that was created,
              has changed or been deleted since the last synchronization operation as specified by the DAV:sync-token provided in the request.
              A given resource MUST appear only once in the response.
            
</p>
<p>
              The content of each DAV:response element differs depending on how the resource was altered:
              </p>
<blockquote class="text">
<p>
                  For resources that have changed (i.e. are new or have been modified) the DAV:response MUST contain at least one
                  DAV:propstat element and MUST NOT contain any DAV:status element.
                
</p>
<p>
                  For resources that have been removed, the DAV:response MUST contain one DAV:status with a value set to '404 Not Found'
                  and MUST NOT contain any DAV:propstat element.
                
</p>
</blockquote>
            

<p>
                The conditions under which each type of change may occur is further described in <a class='info' href='#change-types'>Section&nbsp;3.4<span> (</span><span class='info'>Types of Changes Reported on Subsequent Synchronizations</span><span>)</span></a>.
            
</p>
</blockquote><p>
        
</p>
<p>
          Preconditions:
          </p>
<blockquote class="text">
<p>
              (DAV:valid-sync-token): The DAV:sync-token element value MUST map to a valid token previously returned by the server. A token
              may become invalid as the result of being "out of date" (out of the range of change history maintained by the server), or for
              other reasons (e.g. collection deleted, then recreated, ACL changes, etc...).
            
</p>
</blockquote><p>
        
</p>
<p>
          Postconditions:
          </p>
<blockquote class="text">
<p>
				(DAV:number-of-matches-within-limits): The number of changes reported in the response must fall within the client specified limit. This condition might be triggered if a client requests a limit on the number of responses (as per <a class='info' href='#limits'>Section&nbsp;3.6<span> (</span><span class='info'>Limiting Results</span><span>)</span></a>) but the server is unable to truncate the result set at or below that limit. 
            
</p>
</blockquote><p>
        
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Types of Changes Reported on Initial Synchronization</h3>

<p>
              When the DAV:sync-collection request does not contain a sync-token, the server MUST return
              all internal members of the collection and it MUST NOT return any removed resource.
          
</p>
<a name="change-types"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Types of Changes Reported on Subsequent Synchronizations</h3>

<p>
              When the DAV:sync-collection request contains a valid sync-token, two types
              of resource state changes can be returned (changed or removed).
              This section defines what triggers each of these to be returned. It also clarifies the case where a resource
              may have undergone multiple changes in between two synchronizations.
          
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.1"></a><h3>3.4.1.&nbsp;
Changed Resource</h3>

<p>
                A resource MUST be reported as changed if it has been mapped directly under the target collection since the request sync token was generated.
                This includes resources that have been mapped as the result of a COPY, MOVE or BIND (<a class='info' href='#I-D.ietf-webdav-bind'>[I&#8209;D.ietf&#8209;webdav&#8209;bind]<span> (</span><span class='info'>Clemm, G., Crawford, J., Reschke, J., and J. Whitehead, &ldquo;Binding Extensions to Web Distributed Authoring and Versioning (WebDAV),&rdquo; December&nbsp;2009.</span><span>)</span></a>) operation.
                This also includes collection resources that have been created.
              
</p>
<p>
                In the case where a mapping between a resource and the target collection was removed,
                then a new mapping with the same URI created, the new resource MUST be reported as changed
                while the old resource MUST NOT be reported as removed.
                For example, if a resource was deleted, then recreated using the same URI, it should be reported as a changed resource only.
              
</p>
<p>
                  A resource MUST be reported as changed if its entity tag value
                  (defined in <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>) has changed since the request sync token
                  was  generated.
              
</p>
<p>
                  A resource MAY be reported as changed if the user issuing the request was granted access
                  to this resource, due to access control changes.
              
</p>
<p>
                  Collection resources MUST NOT be returned as changed, except in the case stated above. Instead clients are expected to synchronize
                  changes in child collection resources on an individual basis.
              
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.2"></a><h3>3.4.2.&nbsp;
Removed Resource</h3>

<p>
                  A resource MUST be reported as removed if its mapping under the target collection has been removed
                  since the request sync token was generated, and it has not been re-mapped since it was removed.  This
                  includes resources that have been unmapped as the result of a MOVE or UNBIND (<a class='info' href='#I-D.ietf-webdav-bind'>[I&#8209;D.ietf&#8209;webdav&#8209;bind]<span> (</span><span class='info'>Clemm, G., Crawford, J., Reschke, J., and J. Whitehead, &ldquo;Binding Extensions to Web Distributed Authoring and Versioning (WebDAV),&rdquo; December&nbsp;2009.</span><span>)</span></a>) operation.
                  This also includes collection resources that have been removed.
              
</p>
<p>
                  If a resource was created (and possibly modified), then removed in between two synchronizations,
                  it MUST be reported as removed.
              
</p>
<p>
                  A resource MAY be reported as removed if the user issuing the request no longer has access to this resource,
                  due to access control changes.
              
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Truncation of Results</h3>

<p>
              A server MAY limit the number of resources in a response, for example, to limit the amount of work expended in processing a request, or as the result of an explicit limit set by the client. If the result set is truncated, the response MUST use status code 207, return a DAV:multistatus response body, and indicate a status of 507 (Insufficient Storage) for the request URI. That DAV:response element SHOULD include a DAV:error element with the DAV:number-of-matches-within-limits precondition, as defined in <a class='info' href='#RFC3744'>[RFC3744]<span> (</span><span class='info'>Clemm, G., Reschke, J., Sedlar, E., and J. Whitehead, &ldquo;Web Distributed Authoring and Versioning (WebDAV) Access Control Protocol,&rdquo; May&nbsp;2004.</span><span>)</span></a> (Section 9.2). DAV:response elements for all the changes being reported are also included.
          
</p>
<p>
              When truncation occurs, the DAV:sync-token value returned in the response MUST represent the correct state for the partial set of changes returned. That allows the client to use the returned DAV:sync-token to fetch the next set of changes. In this way the client can effectively "page" through the entire set of changes in a consistent manner.
          
</p>
<p>
              Clients MUST handle the 507 status on the request-URI in the response to the report.
          
</p>
<p>
              For example, consider a server that records changes using a monotonically increasing integer to represent a "revision number" and uses that quantity as the DAV:sync-token value. Assume the last DAV:sync-token used by the client was "10", and since then 20 additional changes have occurred. If the client executes a DAV:sync-collection request with a DAV:sync-token of "10", without a limit the server would return 20 DAV:response elements and a DAV:sync-token with value "30". But if the server choose to limit responses to at most 10 changes, then it would return only 10 DAV:response elements and a DAV:sync-token with value "20", together with an addition DAV:response element for the request-URI with a status code of 507. Subsequently, the client can re-issue the request with the DAV:sync-token value returned from the server and fetch the remaining 10 changes.
          
</p>
<a name="limits"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6"></a><h3>3.6.&nbsp;
Limiting Results</h3>

<p>
              A client can limit the number of results returned by the server through use of the DAV:limit element (<a class='info' href='#RFC5323'>[RFC5323]<span> (</span><span class='info'>Reschke, J., Reddy, S., Davis, J., and A. Babich, &ldquo;Web Distributed Authoring and Versioning (WebDAV) SEARCH,&rdquo; November&nbsp;2008.</span><span>)</span></a>, Section 5.17) in the request body. This is useful when clients have limited space or bandwidth for the results. If a server is unable to truncate the result at or below the requested number, then it MUST fail the request with a DAV:number-of-matches-within-limits post-condition error. When the results can be correctly limited by the server, the server MUST follow the rules above for indicating a result set truncation to the client.
          
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.7"></a><h3>3.7.&nbsp;
Example: Initial DAV:sync-collection Report</h3>

<p>
          In this example, the client is making its first synchronization request to the server, so the DAV:sync-token element in
          the request is empty. It also asks for the DAV:getetag property and for a proprietary property.
          The server responds with the items currently in the targeted collection. The current synchronization token is also returned.
        
</p>
<p>
            &gt;&gt; Request &lt;&lt;
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

REPORT /home/cyrusdaboo/ HTTP/1.1
Host: webdav.example.com
Depth: 1
Content-Type: text/xml; charset="utf-8"
Content-Length: xxxx

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;D:sync-collection xmlns:D="DAV:"&gt;
  &lt;D:sync-token/&gt;
  &lt;D:prop xmlns:R="urn:ns.example.com:boxschema"&gt;
    &lt;D:getetag/&gt;
    &lt;R:bigbox/&gt;
  &lt;/D:prop&gt;
&lt;/D:sync-collection&gt;

</pre></div>
<p>
            &gt;&gt; Response &lt;&lt;
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

HTTP/1.1 207 Multi-Status
Content-Type: text/xml; charset="utf-8"
Content-Length: xxxx

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;D:multistatus xmlns:D="DAV:"&gt;
  &lt;D:response&gt;
  &lt;D:href
&gt;http://webdav.example.com/home/cyrusdaboo/test.doc&lt;/D:href&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;D:getetag&gt;"00001-abcd1"&lt;/D:getetag&gt;
      &lt;R:bigbox xmlns:R="urn:ns.example.com:boxschema"&gt;
        &lt;R:BoxType&gt;Box type A&lt;/R:BoxType&gt;
      &lt;/R:bigbox&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;/D:response&gt;
  &lt;D:response&gt;
  &lt;D:href
&gt;http://webdav.example.com/home/cyrusdaboo/vcard.vcf&lt;/D:href&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;D:getetag&gt;"00002-abcd1"&lt;/D:getetag&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;R:bigbox xmlns:R="urn:ns.example.com:boxschema"/&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 404 Not Found&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;/D:response&gt;
  &lt;D:response&gt;
  &lt;D:href
&gt;http://webdav.example.com/home/cyrusdaboo/calendar.ics&lt;/D:href&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;D:getetag&gt;"00003-abcd1"&lt;/D:getetag&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;R:bigbox xmlns:R="urn:ns.example.com:boxschema"/&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 404 Not Found&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;/D:response&gt;
  &lt;D:sync-token&gt;1234&lt;/D:sync-token&gt;
&lt;/D:multistatus&gt;

</pre></div>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.8"></a><h3>3.8.&nbsp;
Example: DAV:sync-collection Report with Token</h3>

<p>
          In this example, the client is making a synchronization request to the server and is using the DAV:sync-token element returned
          from the last report it ran on this collection. The server responds, listing the items that have been added, changed or removed. The
          (new) current synchronization token is also returned.
        
</p>
<p>
            &gt;&gt; Request &lt;&lt;
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

REPORT /home/cyrusdaboo/ HTTP/1.1
Host: webdav.example.com
Depth: 1
Content-Type: text/xml; charset="utf-8"
Content-Length: xxxx

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;D:sync-collection xmlns:D="DAV:"&gt;
  &lt;D:sync-token&gt;1234&lt;/D:sync-token&gt;
  &lt;D:prop xmlns:R="urn:ns.example.com:boxschema"&gt;
    &lt;D:getetag/&gt;
    &lt;R:bigbox/&gt;
  &lt;/D:prop&gt;
&lt;/D:sync-collection&gt;

</pre></div>
<p>
            &gt;&gt; Response &lt;&lt;
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

HTTP/1.1 207 Multi-Status
Content-Type: text/xml; charset="utf-8"
Content-Length: xxxx

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;D:multistatus xmlns:D="DAV:"&gt;
  &lt;D:response&gt;
  &lt;D:href
&gt;http://webdav.example.com/home/cyrusdaboo/file.xml&lt;/D:href&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;D:getetag&gt;"00004-abcd1"&lt;/D:getetag&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;R:bigbox xmlns:R="urn:ns.example.com:boxschema"/&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 404 Not Found&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;/D:response&gt;
  &lt;D:response&gt;
  &lt;D:href
&gt;http://webdav.example.com/home/cyrusdaboo/vcard.vcf&lt;/D:href&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;D:getetag&gt;"00002-abcd2"&lt;/D:getetag&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;R:bigbox xmlns:R="urn:ns.example.com:boxschema"/&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 404 Not Found&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;/D:response&gt;
  &lt;D:response&gt;
  &lt;D:href
&gt;http://webdav.example.com/home/cyrusdaboo/test.doc&lt;/D:href&gt;
  &lt;D:status&gt;HTTP/1.1 404 Not Found&lt;/D:status&gt;
  &lt;/D:response&gt;
  &lt;D:sync-token&gt;1238&lt;/D:sync-token&gt;
&lt;/D:multistatus&gt;

</pre></div>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.9"></a><h3>3.9.&nbsp;
Example: Initial DAV:sync-collection Report with Truncation</h3>

<p>
          In this example, the client is making its first synchronization request to the server, so the DAV:sync-token element in
          the request is empty. It also asks for the DAV:getetag property.
          The server responds with the items currently in the targeted collection, but truncated at two items. The synchronization token for the truncated result set is returned.
        
</p>
<p>
            &gt;&gt; Request &lt;&lt;
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

REPORT /home/cyrusdaboo/ HTTP/1.1
Host: webdav.example.com
Depth: 1
Content-Type: text/xml; charset="utf-8"
Content-Length: xxxx

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;D:sync-collection xmlns:D="DAV:"&gt;
  &lt;D:sync-token/&gt;
  &lt;D:prop&gt;
    &lt;D:getetag/&gt;
  &lt;/D:prop&gt;
&lt;/D:sync-collection&gt;

</pre></div>
<p>
            &gt;&gt; Response &lt;&lt;
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

HTTP/1.1 207 Multi-Status
Content-Type: text/xml; charset="utf-8"
Content-Length: xxxx

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;D:multistatus xmlns:D="DAV:"&gt;
  &lt;D:response&gt;
  &lt;D:href
&gt;http://webdav.example.com/home/cyrusdaboo/test.doc&lt;/D:href&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;D:getetag&gt;"00001-abcd1"&lt;/D:getetag&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;/D:response&gt;
  &lt;D:response&gt;
  &lt;D:href
&gt;http://webdav.example.com/home/cyrusdaboo/vcard.vcf&lt;/D:href&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;D:getetag&gt;"00002-abcd1"&lt;/D:getetag&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;/D:response&gt;
  &lt;D:response&gt;
    &lt;D:href
&gt;http://webdav.example.com/home/cyrusdaboo/&lt;/D:href&gt;
    &lt;D:status&gt;HTTP/1.1 507 Insufficient Storage&lt;/D:status&gt;
  &lt;/D:response&gt;
  &lt;D:sync-token&gt;1233&lt;/D:sync-token&gt;
&lt;/D:multistatus&gt;

</pre></div>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.10"></a><h3>3.10.&nbsp;
Example: Initial DAV:sync-collection Report with Limit</h3>

<p>
          In this example, the client is making its first synchronization request to the server, so the DAV:sync-token element in
          the request is empty. It requests a limit of 1 for the responses returned by the server. It also asks for the DAV:getetag property.
          The server responds with the items currently in the targeted collection, but truncated at one item. The synchronization token for the truncated result set is returned.
        
</p>
<p>
            &gt;&gt; Request &lt;&lt;
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

REPORT /home/cyrusdaboo/ HTTP/1.1
Host: webdav.example.com
Depth: 1
Content-Type: text/xml; charset="utf-8"
Content-Length: xxxx

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;D:sync-collection xmlns:D="DAV:"&gt;
  &lt;D:sync-token/&gt;
  &lt;D:limit&gt;
    &lt;D:nresults&gt;1&lt;/D:nresults&gt;
  &lt;/D:limit&gt;
  &lt;D:prop&gt;
    &lt;D:getetag/&gt;
  &lt;/D:prop&gt;
&lt;/D:sync-collection&gt;

</pre></div>
<p>
            &gt;&gt; Response &lt;&lt;
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

HTTP/1.1 207 Multi-Status
Content-Type: text/xml; charset="utf-8"
Content-Length: xxxx

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;D:multistatus xmlns:D="DAV:"&gt;
  &lt;D:response&gt;
  &lt;D:href
&gt;http://webdav.example.com/home/cyrusdaboo/test.doc&lt;/D:href&gt;
  &lt;D:propstat&gt;
    &lt;D:prop&gt;
      &lt;D:getetag&gt;"00001-abcd1"&lt;/D:getetag&gt;
    &lt;/D:prop&gt;
    &lt;D:status&gt;HTTP/1.1 200 OK&lt;/D:status&gt;
  &lt;/D:propstat&gt;
  &lt;/D:response&gt;
  &lt;D:response&gt;
    &lt;D:href
&gt;http://webdav.example.com/home/cyrusdaboo/&lt;/D:href&gt;
    &lt;D:status&gt;HTTP/1.1 507 Insufficient Storage&lt;/D:status&gt;
  &lt;/D:response&gt;
  &lt;D:sync-token&gt;1232&lt;/D:sync-token&gt;
&lt;/D:multistatus&gt;

</pre></div>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.11"></a><h3>3.11.&nbsp;
Example: DAV:sync-collection Report with Unsupported Limit</h3>

<p>
          In this example, the client is making a synchronization request to the server with a valid DAV:sync-token element value. It requests a limit of 100 for the responses returned by the server. It also asks for the DAV:getetag property.
          The server is unable to limit the results to the maximum specified by the client, so it responds with a 507 status code and appropriate post-condition error code.
        
</p>
<p>
            &gt;&gt; Request &lt;&lt;
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

REPORT /home/cyrusdaboo/ HTTP/1.1
Host: webdav.example.com
Depth: 1
Content-Type: text/xml; charset="utf-8"
Content-Length: xxxx

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;D:sync-collection xmlns:D="DAV:"&gt;
  &lt;D:sync-token&gt;1232&lt;/D:sync-token&gt;
  &lt;D:limit&gt;
    &lt;D:nresults&gt;100&lt;/D:nresults&gt;
  &lt;/D:limit&gt;
  &lt;D:prop&gt;
    &lt;D:getetag/&gt;
  &lt;/D:prop&gt;
&lt;/D:sync-collection&gt;

</pre></div>
<p>
            &gt;&gt; Response &lt;&lt;
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

HTTP/1.1 507 Insufficient Storage
Content-Type: text/xml; charset="utf-8"
Content-Length: xxxx

&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;D:error xmlns:D="DAV:"&gt;
  &lt;D:number-of-matches-within-limits/&gt;
&lt;/D:error&gt;

</pre></div>
<a name="sync_property"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
DAV:sync-token Property</h3>

<p>
            </p>
<blockquote class="text"><dl>
<dt>Name:</dt>
<dd>
                    sync-token
                
</dd>
<dt>Namespace:</dt>
<dd>
                    DAV:
                
</dd>
<dt>Purpose:</dt>
<dd>
                  Contains the value of the synchronization token as it would be returned by a DAV:sync-collection report.
                
</dd>
<dt>Value:</dt>
<dd>
                    Any text.
                
</dd>
<dt>Protected:</dt>
<dd>
                    MUST be protected because this value is created and controlled by the server.
                
</dd>
<dt>COPY/MOVE behavior:</dt>
<dd>
                    This property value is dependent on the final state of the destination resource, not the value of the property on the source resource.
                
</dd>
<dt>Description:</dt>
<dd>
                    The DAV:sync-token property MUST be defined on all resources that support the DAV:sync-collection report.
                    It contains the value of the synchronization token as it would be returned by a DAV:sync-collection report on that resource at the same point in time.
                    It SHOULD NOT be returned by a PROPFIND DAV:allprop request (as defined in <a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>).
                
</dd>
<dt>Definition:</dt>
<dd>
                    <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;!ELEMENT sync-token #PCDATA&gt;

</pre></div>
                
</dd>
</dl></blockquote><p>
        
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
XML Element Definitions</h3>

<a name="sync_collection_element"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
DAV:sync-collection XML Element</h3>

<p>
          </p>
<blockquote class="text"><dl>
<dt>Name:</dt>
<dd>
              sync-collection
            
</dd>
<dt>Namespace:</dt>
<dd>
              DAV:
            
</dd>
<dt>Purpose:</dt>
<dd>
              WebDAV report used to synchronize data between client and server.
            
</dd>
<dt>Description:</dt>
<dd>
              See <a class='info' href='#sync-collection'>Section&nbsp;3<span> (</span><span class='info'>WebDAV Synchronization</span><span>)</span></a>.
            
</dd>
</dl></blockquote><p>
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;!ELEMENT sync-collection (sync-token, DAV:limit?, DAV:prop)&gt;

&lt;!-- DAV:limit defined in RFC 5323, Section 5.17 --&gt;
&lt;!-- DAV:prop defined in RFC 4918, Section 14.18 --&gt;

</pre></div>
<a name="sync_token_element"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
DAV:sync-token XML Element</h3>

<p>
            </p>
<blockquote class="text"><dl>
<dt>Name:</dt>
<dd>
                sync-token
              
</dd>
<dt>Namespace:</dt>
<dd>
                DAV:
              
</dd>
<dt>Purpose:</dt>
<dd>
                The synchronization token provided by the server and returned by the client.
              
</dd>
<dt>Description:</dt>
<dd>
                See <a class='info' href='#sync-collection'>Section&nbsp;3<span> (</span><span class='info'>WebDAV Synchronization</span><span>)</span></a>.
              
</dd>
</dl></blockquote><p>
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;!ELEMENT sync-token CDATA&gt;

</pre></div>
<a name="multistatus_element"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
DAV:multistatus XML Element</h3>

<p>
            </p>
<blockquote class="text"><dl>
<dt>Name:</dt>
<dd>
                multistatus
              
</dd>
<dt>Namespace:</dt>
<dd>
                DAV:
              
</dd>
<dt>Purpose:</dt>
<dd>
                Extends the DAV:multistatus element to include synchronization details.
              
</dd>
<dt>Description:</dt>
<dd>
                See <a class='info' href='#sync-collection'>Section&nbsp;3<span> (</span><span class='info'>WebDAV Synchronization</span><span>)</span></a>.
              
</dd>
</dl></blockquote><p>
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;!ELEMENT multistatus (DAV:response*, DAV:responsedescription?,
                       sync-token?) &gt;

&lt;!-- DAV:multistatus originally defined in RFC 4918, Section 14.16
     but overridden here to add the DAV:sync-token element --&gt;
&lt;!-- DAV:response defined in RFC 4918, Section 14.24 --&gt;
&lt;!-- DAV:responsedescription defined in RFC 4918, Section 14.25 --&gt;

</pre></div>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>
        This extension does not introduce any new security concerns than those already described in HTTP and WebDAV.
      
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>
        This document does not require any actions on the part of IANA.
      
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgments</h3>

<p>
        The following individuals contributed their ideas and support for writing this specification: Bernard Desruisseaux, Mike Douglass,
        Ciny Joy, Andrew McMillan, Julian Reschke, and Wilfredo Sanchez. We would like to thank the Calendaring and Scheduling Consortium for facilitating interoperability testing for early implementations of this specification.
      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2616.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3744">[RFC3744]</a></td>
<td class="author-text"><a href="mailto:geoffrey.clemm@us.ibm.com">Clemm, G.</a>, <a href="mailto:julian.reschke@greenbytes.de">Reschke, J.</a>, <a href="mailto:eric.sedlar@oracle.com">Sedlar, E.</a>, and <a href="mailto:ejw@cse.ucsc.edu">J. Whitehead</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3744">Web Distributed Authoring and Versioning (WebDAV) Access Control Protocol</a>,&rdquo; RFC&nbsp;3744, May&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3744.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3744.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3744.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4918">[RFC4918]</a></td>
<td class="author-text">Dusseault, L., &ldquo;<a href="http://tools.ietf.org/html/rfc4918">HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV)</a>,&rdquo; RFC&nbsp;4918, June&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4918.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5323">[RFC5323]</a></td>
<td class="author-text">Reschke, J., Reddy, S., Davis, J., and A. Babich, &ldquo;<a href="http://tools.ietf.org/html/rfc5323">Web Distributed Authoring and Versioning (WebDAV) SEARCH</a>,&rdquo; RFC&nbsp;5323, November&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5323.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-xml-20081126">[W3C.REC-xml-20081126]</a></td>
<td class="author-text">Maler, E., Yergeau, F., Sperberg-McQueen, C., Paoli, J., and T. Bray, &ldquo;<a href="http://www.w3.org/TR/2008/REC-xml-20081126">Extensible Markup Language (XML) 1.0 (Fifth Edition)</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xml-20081126, November&nbsp;2008 (<a href="http://www.w3.org/TR/2008/REC-xml-20081126">HTML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-vcarddav-carddav">[I-D.ietf-vcarddav-carddav]</a></td>
<td class="author-text">Daboo, C., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-vcarddav-carddav-10.txt">vCard Extensions to WebDAV (CardDAV)</a>,&rdquo; draft-ietf-vcarddav-carddav-10 (work in progress), November&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-vcarddav-carddav-10.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-webdav-bind">[I-D.ietf-webdav-bind]</a></td>
<td class="author-text">Clemm, G., Crawford, J., Reschke, J., and J. Whitehead, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-webdav-bind-27.txt">Binding Extensions to Web Distributed Authoring and Versioning (WebDAV)</a>,&rdquo; draft-ietf-webdav-bind-27 (work in progress), December&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-webdav-bind-27.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4791">[RFC4791]</a></td>
<td class="author-text"><a href="mailto:cyrus@daboo.name">Daboo, C.</a>, <a href="mailto:bernard.desruisseaux@oracle.com">Desruisseaux, B.</a>, and <a href="mailto:ldusseault@commerce.net">L. Dusseault</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc4791">Calendaring Extensions to WebDAV (CalDAV)</a>,&rdquo; RFC&nbsp;4791, March&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4791.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc4791.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc4791.xml">XML</a>).</td></tr>
</table>

<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Change History (to be removed prior to publication as an RFC)</h3>

<p>Changes in -03:
</p>
<ol class="text">
<li>Changed D:propstat to D:prop in marshalling.
</li>
<li>Added request for dead property in examples.
</li>
<li>Made D:prop mandatory in request so that D:response always contains at least one D:propstat
 as per WebDAV definition.
</li>
<li>Removed DAV:status from response when resource is created/modified, thus allowing to get rid of
 DAV:sync-response in favor of a regular DAV:response. As a consequence, there is no longer any
 difference in the report between created and modified resources.
</li>
<li>Resource created, then removed between 2 sync MUST be returned as removed.
</li>
<li>Added ability for server to truncate results and indicate such to the client.
</li>
<li>Added ability for client to request the server to limit the result set.
</li>
</ol><p>

</p>
<p>Changes in -02:
</p>
<ol class="text">
<li>Added definition of sync-token WebDAV property.
</li>
<li>Added references to SEARCH, CalDAV, CardDAV as alternative ways to first synchronize a collection.
</li>
<li>Added section defining under which condition each state change (new, modified, removed) should be reported. Added reference to BIND.
</li>
<li>Incorporated feedback from Julian Reschke and Ciny Joy.
</li>
<li>More details on the use of the DAV:valid-sync-token precondition.
</li>
</ol><p>

</p>
<p>Changes in -01:
</p>
<ol class="text">
<li>Updated to 4918 reference.
</li>
<li>Fixed examples to properly include DAV:status in DAV:propstat
</li>
<li>Switch to using XML conventions text from RFC5323.
</li>
</ol><p>

</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cyrus Daboo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Apple Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1 Infinite Loop</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cupertino, CA  95014</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:cyrus@daboo.name">cyrus@daboo.name</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.apple.com/">http://www.apple.com/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Arnaud Quillaud</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sun Microsystems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">180, Avenue de l'Europe</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Saint Ismier cedex,   38334</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:arnaud.quillaud@sun.com">arnaud.quillaud@sun.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.sun.com/">http://www.sun.com/</a></td></tr>
</table>
</body></html>
