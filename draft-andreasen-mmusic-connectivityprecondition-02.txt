 
 
   Internet Engineering Task Force                  Flemming Andreasen 
   MMUSIC Working Group                                      Dave Oran 
   INTERNET-DRAFT                                             Dan Wing 
   EXPIRES: August 2005                                  Cisco Systems 
                                                        February, 2005 
    
                     Connectivity Preconditions for  
               Session Description Protocol Media Streams 
        <draft-andreasen-mmusic-connectivityprecondition-02.txt> 
 
 
Status of this memo 
    
   By submitting this Internet-Draft, I certify that any applicable 
   patent or other IPR claims of which I am aware have been disclosed, 
   and any of which I become aware will be disclosed, in accordance 
   with RFC 3668. 
    
   By submitting this Internet-Draft, I accept the provisions of 
   Section 3 of RFC 3667 (BCP 78). 
    
   Internet-Drafts are working documents of the Internet Engineering 
   Task Force (IETF), its areas, and its working groups.  Note that 
   other groups may also distribute working documents as Internet-
   Drafts. 
    
   Internet-Drafts are draft documents valid for a maximum of six 
   months and may be updated, replaced, or obsoleted by other documents 
   at any time.  It is inappropriate to use Internet-Drafts as 
   reference material or cite them other than as "work in progress". 
    
   The list of current Internet-Drafts can be accessed at 
   http://www.ietf.org/ietf/lid-abstracts.txt 
    
   The list of Internet-Draft Shadow Directories can be accessed at 
   http://www.ietf.org/shadow.html 
    
Copyright Notice 
    
   Copyright (C) The Internet Society (2005).  All Rights Reserved. 
    
Abstract 
    
   This document defines a new connectivity precondition for the 
   Session Description Protocol precondition framework described in RFC 
   3312.  A connectivity precondition can be used to delay session 
   establishment or modification until media stream connectivity has 
   been verified successfully.  






 
 

INTERNET-DRAFT         Connectivity Preconditions       February, 2005 
 
 
    
1  Notational Conventions............................................2 
2  Introduction......................................................2 
3  Connectivity Precondition Definition..............................2 
 3.1  Verifying Connectivity........................................4 
4  Examples..........................................................5 
5  Security Considerations...........................................8 
6  IANA Considerations...............................................9 
7  Acknowledgements..................................................9 
8  Authors' Addresses................................................9 
9  Normative References..............................................9 
10   Informative References..........................................9 
11   Intellectual Property Statement................................10 
    
    
1  Notational Conventions 
    
   The key words "MUST", "MUST NOT", "REQUIRED", "MUST", "MUST NOT", 
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this 
   document are to be interpreted as described in [RFC2119].   
    
2  Introduction 
    
   The concept of a Session Description Protocol (SDP) [SDP] 
   precondition in the Session Initiation Protocol (SIP) [SIP] is 
   defined in [RFC3312] and [RFC3312upd].  A precondition is a 
   condition that has to be satisfied for a given media stream in order 
   for session establishment or modification to proceed.  When the 
   precondition is not met, session progress is delayed until the 
   precondition is satisfied, or the session establishment fails.  For 
   example, RFC 3312 defines the Quality of Service precondition, which 
   is used to ensure availability of network resources prior to 
   establishing (i.e. alerting) a call.   
    
   SIP sessions are typically established in order to setup one or more 
   media streams.  Even though a media stream may be negotiated 
   successfully, the actual media stream itself may fail.  For example, 
   when there is one or more Network Address Translators (NATs) or 
   firewalls in the media path, the media stream may not be received by 
   the far end.  The connectivity precondition defined in this document 
   ensures, that session progress is delayed until media stream 
   connectivity has been verified, or the session itself is abandoned.   
    
3  Connectivity Precondition Definition  
    
   The connectivity precondition type is defined by the string "cntv" 
   and hence we modify the grammar found in RFC 3312 as follows: 
    
     precondition-type  =  "cntv" | "qos" | token 
    

 
 
 
Andreasen, Oran, Wing                                         [Page 2] 

INTERNET-DRAFT         Connectivity Preconditions       February, 2005 
 
 
   RFC 3312 defines support for two kinds of status types, namely 
   segmented and end-to-end.  The connectivity precondition-type 
   defined here MUST be used with the end-to-end status type; use of 
   the segmented status type is undefined.  
    
   An entity that wishes to delay session establishment or modification 
   until media stream connectivity has been established uses this 
   precondition-type in an offer.  When a mandatory connectivity 
   precondition is received in an offer, session establishment or 
   modification MUST be delayed until the connectivity precondition has 
   been met, i.e., media stream connectivity has been established in 
   the desired direction(s).   
    
   The delay of session establishment defined here implies that 
   alerting of the called party MUST NOT occur until the precondition 
   has been satisfied.  Packets may be both sent and received on the 
   media streams in question, however such packets SHOULD be limited to 
   packets that are necessary to verify connectivity between the two 
   endpoints involved on the media stream, i.e. the underlying media 
   stream SHOULD NOT be cut through.  For example, STUN packets [STUN], 
   RTP No-Op packets and corresponding RTCP reports, as well as TCP SYN 
   and ACK packets can be exchanged on media streams that support them 
   as a way of verifying connectivity.   
    
   The direction attributes defined in RFC 3312 are interpreted as 
   follows: 
    
   * send:  This party is sending packets on the media stream to the 
     other party, and the other party has received at least one of 
     those packets, i.e., there is connectivity in the forward 
     (sending) direction.   
    
   * recv:  The other party is sending packets on the media stream to 
     this party, and this party has received at least one of those 
     packets, i.e., there is connectivity in the backwards (receiving) 
     direction.  
    
   When the media stream consists of multiple destination addresses, 
   connectivity to all of them MUST be verified in order for the 
   precondition to be met.  In the case of RTP-based media streams, 
   RTCP connectivity however is not a requirement.  
    
   Note that a "send" connectivity precondition from the offerer's 
   point of view corresponds to a "recv" connectivity precondition from 
   the answerer's point of view, and vice versa.  If media stream 
   connectivity in both directions is required before session 
   establishment or modification continues, the desired status MUST be 
   set to "sendrecv".   
    
   Connectivity preconditions may have a strength-tag of either 
   "mandatory" or "optional".  When a mandatory connectivity 
 
 
 
Andreasen, Oran, Wing                                         [Page 3] 

INTERNET-DRAFT         Connectivity Preconditions       February, 2005 
 
 
   precondition is offered, and the answerer cannot satisfy the 
   connectivity precondition, e.g., because the offer does not include 
   parameters that enable connectivity to be verified without media cut 
   through, the offer MUST be rejected as described in RFC 3312.  When 
   an optional connectivity precondition is offered, the answerer MUST 
   generate its answer SDP as soon as possible; since session progress 
   is not delayed in this case, it is not known whether the associated 
   media streams will have connectivity.  If the answerer wants to 
   delay session progress until connectivity has been verified, the 
   answerer MUST increase the strength of the connectivity precondition 
   by using a strength-tag of "mandatory" in the answer.   
    
     Note that use of a "mandatory" precondition requires the presence 
     of a SIP "Require" header with the option tag "precondition": Any 
     SIP UA that does not support a mandatory precondition will reject 
     such requests.  To get around this issue, an optional connectivity 
     precondition and the SIP "Supported" header with the option tag 
     "precondition" can be used instead.  
    
   Offers with connectivity preconditions in re-INVITEs or UPDATEs 
   follow the rules given in Section 6 of RFC 3312, i.e.: 
    
     "Both user agents SHOULD continue using the old session parameters  
     until all the mandatory preconditions are met.  At that moment,      
     the user agents can begin using the new session parameters." 
    
   It should be noted, that connectivity may not exist between two 
   entities initially, e.g., when one or both entities are behind a 
   symmetric NAT.  Subsequent packet exchanges however may create the 
   necessary address bindings in the NAT(s) thereby creating 
   connectivity.  The ICE methodology [ICE] for example ensures that 
   such bindings are created following an offer/answer exchange.  
    
3.1 Verifying Connectivity 
    
   Media stream connectivity can be ascertained in different ways and 
   this document does not mandate any particular mechanism for doing 
   so.  It is however RECOMMENDED that the No-Op RTP payload format 
   defined in [no-op] is supported by entities that support 
   connectivity preconditions.  This will ensure that all entities that 
   support the connectivity preconditions have at least one common way 
   of ascertaining connectivity.  
    
     Editor's Note: The above obviously only applies to RTP-based media 
     streams.   
    
   The above definitions of send and receive connectivity preconditions 
   beg two questions: How does the sender of a packet know the other 
   party received it, and how does the receiver of a packet know who 
   sent it (in particular, the correlation between an incoming media 
   packet and a particular SIP dialog may not be obvious).  The 
 
 
 
Andreasen, Oran, Wing                                         [Page 4] 

INTERNET-DRAFT         Connectivity Preconditions       February, 2005 
 
 
   determination depends on the exact method being used to verify 
   connectivity, however the following provides procedures for three 
   specific approaches: 
    
   * RTP No-Op [no-op]:  The sender of an RTP No-Op payload can verify 
     send connectivity by examining the RTCP report being returned.  In 
     particular, the source SSRC in the RTCP report block is used for 
     correlation.  The RTCP report block also contains the SSRC of the 
     sender of the report and the SSRC of incoming RTP No-Op packets 
     identifies the sender of the RTP packet.  Thus, once send 
     connectivity has been ascertained, receipt of an RTP No-Op packet 
     from the same SSRC provides the necessary correlation to determine 
     receive connectivity.  Alternatively, the duality of send and 
     receive preconditions can be exploited, with one side confirming 
     when his send precondition is satisfied, which in turn implies the 
     other sides recv precondition is satisfied.  
    
   * ICE [ICE]:     The STUN binding request message sent to check 
     connectivity contains a transaction ID which is returned in the 
     STUN binding response, thus send connectivity is verified easily.  
     STUN binding requests also contain a username and a password which 
     ICE communicates via SIP.  When an incoming STUN message is 
     received, it is therefore easy to determine the source of that 
     message and hence receive connectivity can be determined that way.   
    
     ICE presents the peer with a number of alternative candidate 
     addresses for a particular media stream.  Once connectivity has 
     been verified for one of those candidate addresses, connectivity 
     has been verified, regardless of whether this candidate address is 
     the one that ends up being used.  If a media stream consists of 
     multiple destination addresses, verification of a candidate 
     address for each must occur in order for the precondition to be 
     satisfied.  
    
   * TCP [TCP]:     TCP connections are bidirectional and hence there 
     is no difference between send and recv connectivity preconditions.  
     Once the TCP three-way hand shake has completed (SYN, SYN-ACK, 
     ACK), the TCP connection is established and data can be sent and 
     received by either party, i.e. both a send and a receive 
     connectivity precondition has been satisfied.  
    
4  Examples 
    
   The call flow of Figure 1 shows a basic session establishment with 
   the Session Initiation Protocol using SDP connectivity preconditions 
   and RTP No-Op.  Note that not all SDP details are provided in the 
   following.  
    
    


 
 
 
Andreasen, Oran, Wing                                         [Page 5] 

INTERNET-DRAFT         Connectivity Preconditions       February, 2005 
 
 
                  A                                            B 
    
                  |                                            | 
                  |-------------(1) INVITE SDP1--------------->| 
                  |                                            | 
                  |<------(2) 183 Session Progress SDP2--------| 
                  |                                            | 
                  |<~~~~~ Connectivity check to A ~~~~~~~~~~~~~| 
                  |                                            | 
                  |----------------(3) PRACK------------------>| 
                  |                                            | 
                  |~~~~~ Connectivity to A OK ~~~~~~~~~~~~~~~~>| 
                  |                                            | 
                  |<-----------(4) 200 OK (PRACK)--------------| 
                  |                                            | 
                  |~~~~~ Connectivity check to B ~~~~~~~~~~~~~>| 
                  |<~~~~ Connectivity to B OK ~~~~~~~~~~~~~~~~~| 
                  |                                            | 
                  |-------------(5) UPDATE SDP3--------------->| 
                  |                                            | 
                  |<--------(6) 200 OK (UPDATE) SDP4-----------| 
                  |                                            | 
                  |<-------------(7) 180 Ringing---------------| 
                  |                                            | 
                  |                                            | 
                  |                                            | 
    
                Figure 1: Example using the connectivity precondition 
    
   SDP1: A includes a mandatory end-to-end connectivity precondition 
   with a desired status of "sendrecv"; this will ensure media stream 
   connectivity in both directions before continuing with the session 
   setup.  Since media stream connectivity in either direction is 
   unknown at this point, the current status is set to "none".  A's 
   local status table (see RFC 3312) for the connectivity precondition 
   is as follows: 
    
       Direction |  Current | Desired Strength |  Confirm  
      -----------+----------+------------------+---------- 
         send    |    no    |   mandatory      |    no 
         recv    |    no    |   mandatory      |    no 
    
   and the resulting offer SDP is: 
    
     m=audio 20000 RTP/AVP 0 96 
     c=IN IP4 192.0.2.1 
     a=rtpmap:96 no-op/8000 
     a=curr:cntv e2e none 
     a=des:cntv mandatory e2e sendrecv 
    

 
 
 
Andreasen, Oran, Wing                                         [Page 6] 

INTERNET-DRAFT         Connectivity Preconditions       February, 2005 
 
 
   SDP2: When B receives the offer, B sees the mandatory sendrecv 
   connectivity precondition.  B can ascertain connectivity to A 
   ("send" from B's point of view) by use of the RTP No-Op, however B 
   wants A to inform it about connectivity in the other direction 
   ("recv" from B's point of view).  B's local status table therefore 
   looks as follows: 
    
       Direction |  Current | Desired Strength |  Confirm  
      -----------+----------+------------------+---------- 
         send    |    no    |   mandatory      |    no 
         recv    |    no    |   mandatory      |    no 
    
   Since B wants to ask A for confirmation about the "recv" (from B's 
   point of view) connectivity precondition, the resulting answer SDP 
   becomes: 
    
     m=audio 30000 RTP/AVP 0 96 
     a=rtpmap:96 no-op/8000 
     c=IN IP4 192.0.2.4 
     a=curr:cntv e2e none 
     a=des:cntv mandatory e2e sendrecv 
     a=conf:cntv e2e recv 
    
   Meanwhile, B performs a connectivity check to A, which succeeds and 
   hence B's local status table is updated as follows: 
    
       Direction |  Current | Desired Strength |  Confirm  
      -----------+----------+------------------+---------- 
         send    |    yes   |   mandatory      |    no 
         recv    |    no    |   mandatory      |    no 
    
   Since the "recv" connectivity precondition (from B's point of view) 
   is still not satisfied, session establishment remains suspended.    
    
   SDP3: When A receives the answer SDP, A notes that confirmation was 
   requested for B's "recv" connectivity precondition, which is the 
   "send" precondition from A's point of view.  A performs a 
   connectivity check to B, which succeeds, and A's local status table 
   becomes: 
    
       Direction |  Current | Desired Strength |  Confirm  
      -----------+----------+------------------+---------- 
         send    |    yes   |   mandatory      |    yes 
         recv    |    no    |   mandatory      |    no 
    
   Since B asked for confirmation about the "send" connectivity (from 
   A's point of view), A now sends an UPDATE (5) to B to confirm the 
   connectivity from A to B:  
    


 
 
 
Andreasen, Oran, Wing                                         [Page 7] 

INTERNET-DRAFT         Connectivity Preconditions       February, 2005 
 
 
     m=audio 20000 RTP/AVP 0 96 
     a=rtpmap:96 no-op/8000 
     c=IN IP4 192.0.2.1 
     a=curr:cntv e2e send 
     a=des:cntv mandatory e2e sendrecv 
    
   SDP4:  Upon receiving the updated offer, B now knows that there is 
   connectivity from A to B and updates the local status table as 
   follows ("send" from A corresponds to "recv" from B's point of 
   view):  
    
       Direction |  Current | Desired Strength |  Confirm  
      -----------+----------+------------------+---------- 
         send    |    yes   |   mandatory      |    no 
         recv    |    yes   |   mandatory      |    no 
    
   B responds with an answer (6) which contains the current status of 
   the connectivity precondition (i.e., sendrecv) from B's point of 
   view: 
    
     m=audio 30000 RTP/AVP 0 96 
     a=rtpmap:96 no-op/8000 
     c=IN IP4 192.0.2.4 
     a=curr:cntv e2e sendrecv 
     a=des:cntv mandatory e2e sendrecv 
    
   At this point in time, session establishment resumes and B returns a 
   180 (Ringing) response (7).   
    
5  Security Considerations 
    
   In addition to the general security considerations for preconditions 
   provided in RFC 3312, the following security issues, which are 
   specific to connectivity preconditions, should be considered.  
    
   Connectivity preconditions rely on mechanisms beyond SDP, e.g. RTP 
   No-Op [no-op] or STUN [stun], to establish and verify connectivity 
   between an offerer and an answerer.  An attacker that prevents those 
   mechanism from succeeding can prevent media sessions from being 
   established and hence it is RECOMMENDED that such mechanisms are 
   adequately secured by message authentication and integrity 
   protection.  Also, the mechanisms SHOULD consider how to prevent 
   denial of service attacks.  Similarly, an attacker that can forge 
   packets for these mechanisms can enable sessions to be established 
   when there in fact is no media connectivity, which may lead to a 
   poor user experience.  Authentication and integrity protection of 
   such mechanisms can prevent this type of attacks and hence use of it 
   is RECOMMENDED.  
    


 
 
 
Andreasen, Oran, Wing                                         [Page 8] 

INTERNET-DRAFT         Connectivity Preconditions       February, 2005 
 
 
6  IANA Considerations  
    
   IANA is hereby requested to register a RFC 3312 precondition type 
   called "cntv" with the name "Connectivity precondition".  The 
   reference for this precondition type is the current document.  
    
7  Acknowledgements 
    
   The concept of a "connectivity precondition" is the result of 
   discussions with numerous people over a long period of time; the 
   authors greatly appreciate these contributions.  
    
8  Authors' Addresses 
    
   Flemming Andreasen 
   Cisco Systems, Inc. 
   499 Thornall Street, 8th Floor 
   Edison, New Jersey  08837 USA 
   EMail: fandreas@cisco.com 
    
   David Oran 
   Cisco Systems, Inc. 
   7 Ladyslipper Lane 
   Acton, MA 01720  USA 
   EMail: oran@cisco.com 
    
   Dan Wing 
   Cisco Systems, Inc. 
   170 West Tasman Drive 
   San Jose, CA  95134  USA 
   EMail: dwing@cisco.com 
    
9  Normative References 
     
   [RFC3312] G. Camarillo, W. Marshall, J. Rosenberg, "Integration of 
   Resource Management and Session Initiation Protocol (SIP)", RFC 
   3312, October 2002. 
    
   [RFC2327] M. Handley and V. Jacobson, "SDP: Session Description 
   Protocol", RFC 2327, April 1998. 
    
   [SIP] J. Rosenberg, H. Schulzrinne, G. Camarillo, A. Johnston, J. 
   Peterson, R. Sparks, M. Handley, E. Schooler, "SIP: Session 
   Initiation Protocol", RFC 3261, June 2002.  
    
10 Informative References 
     
   [RFC3551] H. Schulzrinne, and S. Casner "RTP Profile for Audio and 
   Video Conferences with Minimal Control", RFC 3550, July 2003. 
    

 
 
 
Andreasen, Oran, Wing                                         [Page 9] 

INTERNET-DRAFT         Connectivity Preconditions       February, 2005 
 
 
   [no-op] F. Andreasen, D. Oran, and D. Wing, "RTP No-Op Payload 
   Format", Work in Progress 
    
   [stun] J. Rosenberg, J. Weinberger, C. Huitema, R. Mahy, "STUN - 
   Simple Traversal of User Datagram Protocol (UDP) Through Network 
   Address Translators (NATs)", RFC 3489, March 2003.  
    
   [RFC3312upd] G. Camarillo and P. Kyzivat, "Update to the Session 
   Initiation Protocol (SIP) Preconditions Framework", IETF, work in 
   progress. 
    
   [ICE] J. Rosenberg, "Interactive Connectivity Establishment (ICE): A 
   Methodology for Network Address Translator (NAT) Traversal for 
   Multimedia Session Establishment Protocols", IETF, work in progress. 
    
   [TCP]  J. Postel, "Transmission Control Protocol", RFC 793, 
   September 1981.  
    
11 Intellectual Property Statement 
    
   The IETF takes no position regarding the validity or scope of any 
   Intellectual Property Rights or other rights that might be claimed 
   to pertain to the implementation or use of the technology described 
   in this document or the extent to which any license under such 
   rights might or might not be available; nor does it represent that 
   it has made any independent effort to identify any such rights. 
   Information on the IETF's procedures with respect to rights in IETF 
   Documents can be found in BCP 78 and BCP 79. 
    
   Copies of IPR disclosures made to the IETF Secretariat and any 
   assurances of licenses to be made available, or the result of an 
   attempt made to obtain a general license or permission for the use 
   of such proprietary rights by implementers or users of this 
   specification can be obtained from the IETF on-line IPR repository 
   at http://www.ietf.org/ipr. 
    
   The IETF invites any interested party to bring to its attention any 
   copyrights, patents or patent applications, or other proprietary 
   rights that may cover technology that may be required to implement 
   this standard. Please address the information to the IETF at  
   ietf-ipr@ietf.org. 
    
Disclaimer of Validity 
    
   This document and the information contained herein are provided on 
   an "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE 
   REPRESENTS OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE 
   INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR 
   IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF 


 
 
 
Andreasen, Oran, Wing                                        [Page 10] 

INTERNET-DRAFT         Connectivity Preconditions       February, 2005 
 
 
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED 
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. 
    
Copyright Statement 
    
   Copyright (C) The Internet Society (2005). This document is subject 
   to the rights, licenses and restrictions contained in BCP 78, and 
   except as set forth therein, the authors retain all their rights. 
    
Acknowledgment 
    
   Funding for the RFC Editor function is currently provided by the 
   Internet Society. 
    




































 
 
 
Andreasen, Oran, Wing                                        [Page 11] 
