<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Better Than Nothing Mobile IPv4
    Fast Handovers</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Better Than Nothing Mobile IPv4
    Fast Handovers">
<meta name="keywords" content="I-D, Internet-Draft, mip4">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">MIP4</td><td class="header">A. Doswald, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">S. Robert</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">HEIG-VD</td></tr>
<tr><td class="header">Expires: October 10, 2008</td><td class="header">April 08, 2008</td></tr>
</table></td></tr></table>
<h1><br />Better Than Nothing Mobile IPv4
    Fast Handovers<br />draft-doswald-robert-mip4-btn-fmipv4-00.txt</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on October 10, 2008.</p>

<h3>Abstract</h3>

<p>Proposed fast handover solutions for Mobile IPv4 depend on the
      presence of Foreign Agents (FA) in the networks between which the Mobile
      Node (MN) moves to ensure their operation. However, in many situations
      the MN moves into networks without FAs. This document proposes a
      solution that includes fast handover mechanisms involving a direct
      connection to the Home Agent (HA). This solution is not a full fledged
      fast handover proposal, but rather a complement to RFC 4881: Low-Latency
      Handovers in Mobile IPv4, and RFC 4988: Mobile IPv4 Fast Handover.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#Introduction">1.</a>&nbsp;
Introduction<br />
<a href="#Terminology">2.</a>&nbsp;
Terminology<br />
<a href="#Protocol">3.</a>&nbsp;
Protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Predictive">3.1.</a>&nbsp;
Predictive Handover<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Reactive">3.2.</a>&nbsp;
Reactive Handover<br />
<a href="#handover_4881">4.</a>&nbsp;
Handover Using RFC 4881 Mechanisms<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">4.1.</a>&nbsp;
Network with FA to Network without FA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">4.2.</a>&nbsp;
Network without FA to Network without FA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.3.</a>&nbsp;
Network without FA to Network with FA<br />
<a href="#handover_4988">5.</a>&nbsp;
Handover Using RFC 4988 Mechanisms<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">5.1.</a>&nbsp;
Network with FA to Network without FA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.2.</a>&nbsp;
Network without FA to Network without FA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.3.</a>&nbsp;
Network without FA to Network with FA<br />
<a href="#Security">6.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#NAT">6.1.</a>&nbsp;
NAT Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#security_assoc">6.2.</a>&nbsp;
Security associations<br />
<a href="#IANA">7.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="Introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The mobile IPv4 specification <a class='info' href='#rfc3344'>[rfc3344]<span> (</span><span class='info'>Perkins, C., &ldquo;IP Mobility Support for IPv4,&rdquo; August&nbsp;2002.</span><span>)</span></a> allows for a Mobile Node (MN) to perform
      IPv4-layer handover when passing between different subnets whether a
      Foreign Agent (FA) is present or not. However, methods to achieve
      low-latency (or fast) handover between subnets described in <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a> and <a class='info' href='#rfc4988'>[rfc4988]<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a> only
      describe situations where FAs are present. While the presence of FAs is
      almost certainly necessary to accommodate for real-time services on a
      MN, the case will almost certainly present itself where a mobile node
      will pass onto a subnet without an FA. And while it may not me possible
      to offer a perfect service in the cases where no FAs are present, this
      document describes the methods with which such handovers may be done
      faster and with less packet loss then otherwise.
</p>
<p>The purpose of this document is not to describe a new fast-handover
      method, but rather to complement those described in <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a> and <a class='info' href='#rfc4988'>rfc4988<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a> [rfc4988], and
      as such it is assumed that the reader is familiar with the basic
      operations and terminology of those RFCs. The general new protocol
      mechanisms to be introduced are described in <a class='info' href='#Protocol'>Section&nbsp;3<span> (</span><span class='info'>Protocol</span><span>)</span></a>, <a class='info' href='#handover_4881'>Section&nbsp;4<span> (</span><span class='info'>Handover Using RFC 4881 Mechanisms</span><span>)</span></a> presents
      the adaptations using <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a> messages and
      protocol mechanisms, while <a class='info' href='#handover_4988'>Section&nbsp;5<span> (</span><span class='info'>Handover Using RFC 4988 Mechanisms</span><span>)</span></a> deals
      with handovers with the <a class='info' href='#rfc4988'>[rfc4988]<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a> scheme. Finally,
      <a class='info' href='#Security'>Section&nbsp;6<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> addresses security considerations, and
      <a class='info' href='#IANA'>Section&nbsp;7<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a> addresses IANA considerations.
</p>
<p>Some concepts are common to <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a> and <a class='info' href='#rfc4988'>[rfc4988]<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a>, but are described with different terms. The
      terms that are borrowed from one RFC, but have a different name in the
      other are described in <a class='info' href='#Terminology'>Section&nbsp;2<span> (</span><span class='info'>Terminology</span><span>)</span></a>. Terms
      introduced in this document are also described in that section.
</p>
<a name="Terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in RFC 2119 <a class='info' href='#rfc2119'>[rfc2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement           Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>In addition, this document introduces or redefines the following
      terms: </p>
<blockquote class="text">
<p>NwFA: Network with a FA that supports fast handovers.
</p>
<p>NwoFA: Network without a FA, or with an FA that doesn’t have fast
          handover capability.
</p>
<p>oFA: old Foreign Agent (as in <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a>),
          corresponds to the PAR in <a class='info' href='#rfc4988'>rfc4988<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a> [rfc4988].
</p>
<p>nFA: new Foreign Agent (as in <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a>),
          corresponds to the NAR in <a class='info' href='#rfc4988'>[rfc4988]<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<p>Handover: A process of terminating existing connectivity and
          obtaining new IP connectivity (as described in <a class='info' href='#rfc4988'>[rfc4988]<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a>), corresponds to “handoff” in <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a>.
</p>
</blockquote>

<a name="Protocol"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Protocol</h3>

<p>The protocol can roughly be divided into three parts: the handover
      from a network with an FA (NwFA) to a network without an FA (NwoFA), the
      handover from a NwoFA to another NwoFA, and the handover from a NwoFA to
      a NwFA. In all cases, to achieve better handovers the protocol relies on
      the following mechanisms: </p>
<ul class="text">
<li>The ability for the Home Agent (HA) to understand and process
          correctly fast handover messages. As the HA will play an important
          role, it should have the best possible connection to the MN.
          Therefore <a class='info' href='#rfc4433'>[rfc4433]<span> (</span><span class='info'>Kulkarni, M., Patel, A., and K. Leung, &ldquo;Mobile IPv4 Dynamic Home Agent (HA) Assignment,&rdquo; March&nbsp;2006.</span><span>)</span></a> SHOULD also be implemented
          so that the MN can dynamically be assigned to an HA with the best
          possible connection (usually the HA closest to the MN).
</li>
<li>The HA MUST maintain a dynamically created list of AP/FA
          associations for the NwoFA to NwFA handovers. The reason for this is
          simply that the HA cannot know in advance the movement of the MN,
          and so a static list of FA/AP associations cannot be set up in
          advance. The method with which the HA creates this list is not
          enforced, but it MAY implement the candidate access router protocol
          (CARD) <a class='info' href='#rfc4066'>[rfc4066]<span> (</span><span class='info'>Liebsch, M., Singh, A., Chaskar, H., Funato, D., and E. Shim, &ldquo;Candidate Access Router Discovery (CARD),&rdquo; July&nbsp;2005.</span><span>)</span></a>. The appendix A of that
          document describes how to use CARD protocol to dynamically create a
          list of neighbours. If another method is used, that method MUST
          create security associations for FA-FA and HA-FA communications (see
          <a class='info' href='#security_assoc'>Section&nbsp;6.2<span> (</span><span class='info'>Security associations</span><span>)</span></a>).
</li>
<li>The HA will buffer the messages that pass through it, which will
          be resent after the MN finishes a handover to a NwoFA, or in case of
          a reactive handover. The HA MUST, if possible, buffer the messages
          for the duration of a handover up to a certain limit. That limit may
          be set either statically or dynamically. The HA MUST maintain a
          minimal buffer of all traffic to MNs, the size of which MAY be
          dynamically adjusted to traffic intensity and traffic type. The HA
          MUST also drop the buffer corresponding to a MN if its handover
          takes too long. The suggested default time is 2 seconds, and the
          maximum value is 10 seconds. The particulars of buffer management
          are however beyond the scope of this document.
</li>
</ul><p> The handover from a NwFA to another NwFA is the standard case
      covered in <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a> and <a class='info' href='#rfc4988'>[rfc4988]<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a>. For all cases, one can distinguish the
      situation where the MN or the networkpredicts the handover (predictive
      situation) from the situation where the handover happens abruptly
      (reactive situation).
</p>
<a name="Predictive"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Predictive Handover</h3>

<p>The basic concepts for predictive handovers are simple: </p>
<ul class="text">
<li>When the mobile node is about to move to a network which does
            not support fast handovers, either because there’s no FA or
            because the FA present does not support fast handovers, the HA
            buffers the communication to the MN for the duration of the
            handover. When the MN reconnects, the HA transmits the buffer to
            the MN, followed by the normal communication.
</li>
<li>When the mobile node will moves from a network without a FA (or
            with a FA that doesn’t support fast handovers) to a network with
            an nFA that supports fast handovers, the HA tunnels information to
            the nFA in advance, which buffers it until the handover is
            completed.
</li>
</ul>

<p>The general case of a MN moving from a NwFA to a NwoFA (predictive)
        is presented in greater detail in Figure 1:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
+-----+  4: ask to buffer   +-----+
|     | ------------------&gt; | HA  |
| oFA |                     |     |
+-----+                     +-----+
 ^ |  ^                      ^  /\
2| |3 |                      |  ||
 | |  |4: trigger           7|  || 8: buffer +
 | |  |  (optional)|         |  ||    tunneled data
 | v  |            |         v  \/
+-----+            |        +-----+
| MN  |            |        | MN  |
+-----+    - - - - |- - &gt;   +-----+
          Movement |
                   |
              NwFA | NwoFA</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p></p>
<ol class="text">
<li>The MN receives a trigger (most likely signal-strength
            dependent) that it should move to a new AP.
</li>
<li>The MN sends a message to the oFA asking for a (AP-ID, AR-Info)
            tuple.
</li>
<li>The oFA responds that it has no such association.
</li>
<li>The oFA receives a trigger informing it the MN is about to
            change network. The message may be from an L2 trigger, or a
            message sent by the MN. The oFA sends a message to the HA
            requesting that it buffers data.
</li>
<li>The HA stops relaying messages, buffers them, and sends an
            acknowledgement message to the oFA. If the oFA received a trigger
            message from the MN, it acknowledges it so that the MN knows that
            it can disconnect.
</li>
<li>The MN disconnects, reconnects on the new network and obtains
            an IP addess.
</li>
<li>The MN sends a registration request to the HA, The HA sends a
            registration reply.
</li>
<li>The tunnel is established, and the HA sends buffered data + new
            data.
</li>
</ol><p> The predictive handover from a NwoFA to another NwoFA is
        similar, to only difference being that the HA also plays the role of
        the oFA. However, as it is not possible for the HA to receive L2
        triggers, the handover has to be initiated by the MN.
</p>
<p>The general predictive handover from a NwoFA to a NwFA is depicted
        in Figure 2:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
+-----+           5         +-----+
|     | &lt;-----------------&gt; | nFA |
| HA  | ------------------&gt; |     |
+-----+           6    ---&gt; +-----+
 ^ |  ^               /      ^  /\
2| |3 |4b  ----------/       |  ||
 | |  |   /     4a          7|  || 8: buffer +
 | |  |  /         |         |  ||    tunneled data
 | v  | /          |         |  \/
+-----+            |        +-----+
| MN  |            |        | MN  |
+-----+    - - - - |- - &gt;   +-----+
          Movement |
                   |
             NwoFA | NwFA</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p></p>
<ol class="text">
<li>The MN receives a trigger (most likely signal-strength
            dependent) that it should move to a new AP.
</li>
<li>The MN sends a message to the HA asking for a (AP-ID, AR-Info)
            tuple.
</li>
<li>The HA responds with AR-Info for that network
</li>
<li>The MN sends a message to initiate a fast handover. The
            recipient of the message depends on which fast handover protocol
            is used: 
<blockquote class="text"><dl>
<dt>4a.</dt>
<dd>in the case of <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a> it is the nFA
                (tunnelled via the HA)
</dd>
<dt>4b.</dt>
<dd>in the case of <a class='info' href='#rfc4988'>[rfc4988]<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a> it is the
                HA.
</dd>
</dl></blockquote>
</li>
<li>The HA and nFA negotiate to create a tunnel from the HA to the
            nFA.
</li>
<li>The HA sends an acknowledgment for the MN to the nFA. The
            message is buffered. Following messages for the MN are tunnelled
            to the nFA and buffered.
</li>
<li>The MN disconnects, reconnects to the new network, and sends a
            message to the nFA to indicate its presence.
</li>
<li>The nFA tunnels buffered data (including the acknowledge for
            the MN) and new data to the MN
</li>
<li>The MN completes registration with the HA (if necessary) and
            resumes normal operation
</li>
</ol><p> In many cases, a MN may have the option to switch to several
        networks. Although the exact mechanism a MN uses to determine to which
        network it will attach itself is beyond the scope of this document,
        the presence of an FA FA supporting fast handovers SHOULD be taken
        into consideration.
</p>
<a name="Reactive"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Reactive Handover</h3>

<p>A reactive situation occurs as the handover happens before the MN
        has time to complete a predictive handover. The reactive situation as
        the MN moves to or from a NwoFA is the following: </p>
<ol class="text">
<li>The MN is disconnected, reconnects, and obtains an IP.
</li>
<li>The MN sends a Registration request to the HA.
</li>
<li>The HA replies and sends the default buffer.
</li>
<li>Normal operation resumes.
</li>
</ol><p> The reactive situation is in fact almost identical to normal
        registration as described in <a class='info' href='#rfc3344'>[rfc3344]<span> (</span><span class='info'>Perkins, C., &ldquo;IP Mobility Support for IPv4,&rdquo; August&nbsp;2002.</span><span>)</span></a>, the only
        difference being the buffer which is maintained and sent by the HA. As
        such, its working doesn’t need to be described in terms of <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a> or <a class='info' href='#rfc4988'>[rfc4988]<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="handover_4881"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Handover Using RFC 4881 Mechanisms</h3>

<p>This section details the better than nothing fast handover protocol
      as described in <a class='info' href='#Predictive'>Section&nbsp;3.1<span> (</span><span class='info'>Predictive Handover</span><span>)</span></a> using the same message
      patterns as in <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a>. In all cases, we will
      describe the handover with both the PRE-REGISTRATION and
      POST-REGISTRATION methods if possible. The PRE-REGISTRATION method
      normally allows the MN to register its next connection in advance with
      the HA, while the POST-REGISTRATION method normally allows a tunnel to
      be created between the oFA and the nFA to ensure that the communication
      remains unbroken during handover. Unfortunately, it is not possible to
      pre-register when moving to a network without a FA, and it is not
      possible either to create a tunnel from an old network to a new one
      without both an oFA and a nFA. However, the messages used in
      PRE-REGISTRATION and POST-REGISTRATION may sent to the HA in order for
      it to buffer information or send it to a nFA. Also, unlike normal
      POST-REGISTRATION situations, it is either impossible or undesirable to
      have three party handover situations.
</p>
<p>The <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a> protocol also describes a combined
      method with the mechanisms of both PRE- and POST-REGISTRATION. This
      combined method makes no sense in a situation where at least one of the
      networks doesn’t have an FA, as both PRE- and POST-REGISTRATION messages
      have the same effect. The only difference is that POST-REGISTRATION uses
      L2-triggers to allow the handover to happen without a message from the
      MN.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Network with FA to Network without FA</h3>

<p>Moving from an NwFA to an NwoFA allows the use of both
        PRE-REGISTRATION and POST-REGISTRATION messages to communicate with
        the HA. Figure 3 presents the PRE-REGISTRATION situation:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
    MN                    oFA                   HA
     |                     |                    |
     |-------PrRtSol------&gt;|                    |
     |&lt;------PrRtAdv-------|                    |
     |                     |                    |
     |--------------RegReq (via oFA)-----------&gt;| &lt;~buffer
     |&lt;-------RegReply (error, via oFA)---------|
     |                     |                    |
     |                     |                    |
disconnect                 |                    |
     |                     |                    |
 connect                   |                    |
     |--------------- RegRequest---------------&gt;|
     |&lt;-------------- RegReply------------------|
     |&lt;==================================== deliver packets
     |                     |                    |</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 3&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p></p>
<ol class="text">
<li>Upon receiving an L2 trigger (L2-MT), the MN sends a PrRtSol
            message to the oFA containing an identifier for the new network,
            in a Generalized Link Layer and IP Address Extension. This message
            MUST have a TTL=1. When the unknown identifier is received by the
            oFA, it MUST reply with a PrRtAdv with the nFAs IP address set to
            0.0.0.0 (indicating that the oFA doesn’t have a neighbour for that
            network). The PrRtAdv MUST contain an LLA Extension identical to
            the one sent in the PrRtSol message. The PrRtAdv message may also
            be unsolicited if the oFA receives an L2-source trigger, in which
            case the MN’s identifier is contained by L2-trigger. The L2-source
            trigger MUST also contain an identifier for the target network,
            from which the oFA can determine the absence of an nFA. That
            identifier MUST be attached in an LLA Extension to the PrRtAdv
            message.
</li>
<li>The MN sends a registration request to the HA, with the care of
            address field set to 0.0.0.0. The registration request MUST also
            contain the address of the HA in an FA IPv4 address LLA
            extension.
</li>
<li>Upon receiving the registration reply, the HA starts buffering,
            and sends back a registration reply with error code 77 (invalid
            care-of address). If it cannot buffer, it sends a registration
            reply with error code 66 (insufficient resources) <a class='info' href='#rfc3344'>[rfc3344]<span> (</span><span class='info'>Perkins, C., &ldquo;IP Mobility Support for IPv4,&rdquo; August&nbsp;2002.</span><span>)</span></a>.
</li>
<li>The MN disconnects from the HA, reconnects to it on the new
            network, and completes a normal registration with the HA.
</li>
<li>When the registration with the HA is completed, it sends the
            buffer followed by normal communication.
</li>
</ol><p> The situation with POST-REGISTRATION methods is depicted in
        figure 4:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
         MN                    oFA                  HA
          |                     |                    |
          |           L2-ST ~~~&gt;|-------HRqst-------&gt;|&lt;~buffer
          |                     |&lt;------HRply--------|
          |                     |                    |
          |                     |                    |
       disconnect     L2-LD ~~~&gt;|                    |
          |                     |                    |
          |                     |                    |
          |                     |                    |
       connect                  |                    |
L2-LU ~~~&gt;|--------- RegRequest---------------------&gt;|
          |&lt;------- RegReply-------------------------|
          |&lt;=================================== deliver packets
          |                     |                    |</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 4&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p></p>
<ol class="text">
<li>The oFA receives a L2 source trigger informing it that the MN
            is about to move to a new network. The trigger contains the MN’s
            L2 address, and an identifier for the new network. The oFA is
            unable to resolve the identifier to an nFA IPv4 address.
</li>
<li>The oFA sends a Handover Request (HRqst(s)) to the HA. The H
            bit is set and the following bits (N, R, M, G, T and B) MUST be
            unset. The lifetime of 0 indicates that the tunnel to the oFA MUST
            be discontinued; other values indicate the time that the oFA is
            willing to maintain a tunnel to the HA, and that the HA SHOULD
            send data to the oFA as well as buffer it. A value of 0xffff
            indicates infinity. The message MUST include an LLA extension
            containing the MN’s L2 address and it MUST also contain the FA-HA
            authentication extension [rfc3344] to secure the HRqst
            message.
</li>
<li>The HA sends a HRply, with the H bit set, and the N and R bits
            unset, indicating that it is a HRply(s). All other bits are unset.
            The lifetime represents the time the HA will maintain the tunnel
            to the FA, unless the MN registers with it before, with any value
            beyond the one sent in the HRqst defaulting to that value. The
            message MUST contain the FA-HA authentication Extension to secure
            the HRply message.
</li>
<li>The MN disconnects from the oFA’s network, and reconnects on
            the new one. The oFA receives a L2-LD trigger, indicating that it
            should stop attempting to send data to the MN.
</li>
<li>Upon receiving a L2-LU trigger, the MN completes a normal
            registration with the HA, the HA sends the buffer followed by the
            new data to the MN. Normal operation resumes.
</li>
</ol>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Network without FA to Network without FA</h3>

<p>When a MN moves from a network without FA to another NwoFA,
        POST-REGISTRATION is impossible as the HA cannot receive a L2 trigger.
        PRE-REGISTRATION messages can however be used to inform the HA that it
        needs to buffer. The message exchange is depicted in Figure 5:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
   MN                    HA
   |                     |
   |------RtSolPr-------&gt;|
   |&lt;-----PrRtAdv--------|
   |                     |
   |------RegRequest----&gt;|&lt;~buffer
   |                     |
   |&lt;--RegReply(error)---|
   |                     |
disconnect               |
   |                     |
   |                     |
   |                     |
connect                  |
   |                     |
   |-------RegRequest---&gt;|
   |&lt;------RegReply------|
   |&lt;================ deliver packets
   |                     |</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 5&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p></p>
<ol class="text">
<li>Upon receiving an L2 trigger (L2-MT), the MN sends a PrRtSol
            message to the HA containing an identifier for the new network, in
            a Generalized Link Layer and IP Address Extension. This message
            MUST have a TTL=1. When received by the HA, it MUST reply with a
            PrRtAdv with the nFAs IP address set to 0.0.0.0 (indicating that
            the oFA doesn’t have a neighbour for that network). The LLA
            Extension MUST be identical to the one sent in the PrRtSol
            message.
</li>
<li>The MN sends a registration request to the HA, with the care of
            address field set to 0.0.0.0. The registration request MUST also
            contain the address of the HA in an FA IPv4 address LLA
            extension.
</li>
<li>Upon receiving the registration reply, the HA starts buffering,
            and sends back a registration reply with error code 77 (invalid
            care-of address). If it cannot buffer, it sends a registration
            reply with error code 66 (insufficient resources) <a class='info' href='#rfc3344'>[rfc3344]<span> (</span><span class='info'>Perkins, C., &ldquo;IP Mobility Support for IPv4,&rdquo; August&nbsp;2002.</span><span>)</span></a>.
</li>
<li>The MN disconnects from the HA, reconnects to it on the new
            network, and completes a normal registration with the HA
</li>
<li>When the registration with the HA is completed, it sends the
            buffer followed by normal communication.
</li>
</ol>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Network without FA to Network with FA</h3>

<p>This movement uses the PRE-REGISTRATION handover system, with the
        HA in the role of the oFA. Since there is no oFA, it is unlikely that
        there can be a source triggered handover, but a target triggered
        handover and a mobile triggered handover are possible. The mechanism
        is described in figure 6:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
    MN                     HA                  nFA
     |                     |                    |
     |                     |------PrRtSol------&gt;|
     |                     |&lt;-----PrRtAdv-------|
     |                     |                    |
     |-------PrRtSol------&gt;|                    |
     |&lt;------PrRtAdv-------|                    |
     |                     |                    |
     |-----------RegReq (tunneled via HA)------&gt;|
     |                     |&lt;------ RegReq------|
     |                     |----- RegReply-----&gt;|&lt;~buffer
     |                     |                    |
     |                   forward                |
     |                   packets===============&gt;|
disconnect                 |                    |
     |                     |                    |
 connect                   |                    |
     |                     |                    |
     |-----------Agent Solicitation------------&gt;|
     |&lt;=================================== deliver packets
     |                     |              (including RegReply)
     |                     |                    |</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 6&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p></p>
<ol class="text">
<li>The HA sends a PrRtSol message to the nFA, to which the nFA
            MUST respond with a PrRtAdv if the message contained the correct
            identifier in the LLA extension. These messages SHOULD be sent in
            advance of the actual handover, as the HA SHOULD try to solicit
            and cache agent advertisements for all FAs of which it is aware.
            In case of a target triggered handover, a message PrRtAdv is
            tunnelled from the nFA directly to the MN (through the HA). In
            that case the message MUST be authenticated (with an FA-MN
            authentication) to prevent attacks.
</li>
<li>The MN sends a PrRtSol message to the HA containing an
            identifier for the nFA, in a Generalized Link Layer and IP Address
            Extension. This message MUST have a TTL=1. When received by the
            HA, it MUST reply with the nFA’s PrRtAdv.
</li>
<li>The MN sends a registration request (RegReq) to the nFA,
            tunnelled via the HA.
</li>
<li>The nFA sends a RegReq to the HA. The message MUST contain the
            MN’s layer 2 address in a Generalized Link Layer and IP Address
            Extension.
</li>
<li>The HA sends a RegReply to the nFA, which MUST be buffered and
            unicast to the MN as soon as the MN connects to the nFA. The nFA
            SHOULD also buffer all data received from the HA to the MN until
            the connection is achieved before unicasting it to the MN.
</li>
<li>The MN disconnects, reconnects, and sends an agent
            solicitation.
</li>
<li>The nFA forwards the RegReply and buffer to the MN as soon as
            it receives either the agent solicitation, or a L2-LU message that
            the nFA can resolve to the MN.
</li>
</ol><p> The ‘S’ bit MAY be set in the registration message from the
        MN (in 3), in which case all data is sent both to the nFA and to the
        MN. In this case, buffering by the nFA may not be necessary, or even
        beneficial.
</p>
<p>The situation with POST-REGISTRATION methods is depicted in figure
        7:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
         MN                    nFA                  HA
          |                     |                    |
          |           L2-TT ~~~&gt;|-------HRqst-------&gt;|
          |                     |&lt;------HRply--------|
          |             buffer~&gt;|&lt;================ deliver packets
          |                     |                    |
       disconnect     L2-LD ~~~&gt;|                    |
          |                     |                    |
          |                     |                    |
          |                     |                    |
       connect                  |                    |
          |&lt;==deliver packets==&gt;|&lt;~~~ L2-LU          |
L2-LU ~~~&gt;|--------- RegRequest---------------------&gt;|
          |&lt;-------- RegReply------------------------|
          |&lt;=================================== deliver new packets
          |                     |                 (via nFA)
          |                     |                    |</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 7&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p></p>
<ol class="text">
<li>The nFA receives a L2 Target Trigger informing it that the MN
            is about to move to its network. The trigger contains the MN’s L2
            address, its home address, the address of its home agent, and an
            identifier for the old network. The nFA is unable to resolve the
            identifier to an oFA IPv4 address. <br />
<br />
 In
            order for the following messages to be transmitted, there MUST be
            a security association between the nFA and the HA. All messages
            between those agents MUST be authenticated with a HA-FA
            authentication extension <a class='info' href='#rfc3344'>[rfc3344]<span> (</span><span class='info'>Perkins, C., &ldquo;IP Mobility Support for IPv4,&rdquo; August&nbsp;2002.</span><span>)</span></a>.
</li>
<li>The nFA sends a Handover Request to the HA with the N bit set,
            and the H and R bit unset, indicating that it is an HRqst(t). The
            B bit MUST also be unset. If the T bit is set, the nFA is also
            requesting a reverse tunnel, and the lifetime field indicates the
            desired duration for the tunnel, the recommended time is 2 seconds
            (a value of 0xffff indicates infinity). If the T bit is unset, the
            lifetime must also be set to 0, indicating that the nFA doesn’t
            require reverse tunnel service. The home address and address of
            the home agent are included as they were obtained through the
            L2-TT. The HRqst(t) also contains an LLA option with the MN's L2
            address.
</li>
<li>The HA sends a HRply, with the N bit set, and the H and R bits
            unset, indicating that it is a HRply(t). Setting the T bit
            indicates that the HA is willing to tunnel information in advance
            to the nFA, and the lifetime field indicates how long the HA is
            willing to maintain the tunnel before requiring a RegRequest. If
            the T bit is unset, the lifetime MUST be 0, indicating that the HA
            is unwilling to provide tunnel service. The HRply(t) also contains
            the MN's home subnet IPv4 address, the MN's HA address, and an LLA
            option containing the MN's L2 address. <br />
<br />

            If the tunnel established at this point expires before the
            handover is complete, the nFA MAY transmit a HRqst(r) to renew the
            tunnel. The descriptions of the fields are identical to those
            described in <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a>.
</li>
<li>The MN disconnects from the old network, and reconnects on the
            new one. Upon receiving a L2-LU, the nFA sends its buffered data,
            followed by new data from the HA. It also transmits outbound data
            either with normal routing mechanisms, or with a reverse
            tunnel.
</li>
<li>Upon receiving a L2-LU trigger, the MN completes a normal
            registration with the HA. Registration should be completed as soon
            as possible, in order to have a situation where the MN can use
            normal fast-handover procedures.
</li>
</ol>

<a name="handover_4988"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Handover Using RFC 4988 Mechanisms</h3>

<p>This section details the better than nothing fast handover protocol
      as described in <a class='info' href='#Predictive'>Section&nbsp;3.1<span> (</span><span class='info'>Predictive Handover</span><span>)</span></a> using the same
      messages and message patterns as in <a class='info' href='#rfc4988'>[rfc4988]<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Network with FA to Network without FA</h3>

<p>Figure 8 shows the timeline for the predictive mode of
        operation:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
  MN                    oFA                  HA
   |                     |                    |
   |------RtSolPr-------&gt;|                    |
   |&lt;-----PrRtAdv--------|                    |
   |                     |                    |
   |------FBU-----------&gt;|--------HI---------&gt;|
   |                     |&lt;------HAck---------|
   |          &lt;--FBack---|--FBack---&gt;         |&lt;~buffer
   |                     |                    |
disconnect               |                    |
   |                     |                    |
   |                     |                    |
   |                     |                    |
connect                  |                    |
   |                     |                    |
   |--------- RegRequest---------------------&gt;|
   |&lt;-------- RegReply------------------------|
   |&lt;=================================== deliver packets
   |                     |              (including FBack)</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 8&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p></p>
<ol class="text">
<li>MN sends a RtSolPr message (either containing the wildcard, or
            with the identifiers of the access points it wishes move to).
</li>
<li>The oFA responds with a PrRtAdv with code 2 or code 3. If the
            message is sent unsolicited by the oFA, its code is 4. The LLA
            options for unknown access points have code 7.
</li>
<li>The MN sends an FBU to the oFA. The CoA field MUST contain the
            Home Agent’s IP address when attempting to connect to a NwoFA.
</li>
<li>The oFA sends a HI message to the HA. The ‘S’ bit MUST be set
            to 0 and the ‘U’ bit MUST be set to 1. The New Care-of Address
            option MUST NOT be present.
</li>
<li>The HA responds with a HAck. Valid options are 0, 128, 129 or
            130. Other options (1-4) are treated as if option 0 was
            received.
</li>
<li>The oFA sends an Fback to the MN and the HA, the new IPv4
            extension MUST NOT be present. The HA MUST buffer messages from
            this point until receiving a registration message from the MN,
            although it MAY drop packets due to space limitations or buffer
            management.
</li>
<li>Upon receiving the Fback, the MN disconnects, and reconnects to
            the new network. Upon receiving a new IP address, it completes
            normal registration procedure to the HA (RegRequest and RegReply).
            The MN doesn’t send an FBU as it would when communicating with a
            nFA.
</li>
<li>The HA forwards buffered messages (including the FBack) to the
            MN. Normal operation resumes.
</li>
</ol>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Network without FA to Network without FA</h3>

<p>Figure 9 shows the timeline for the predictive mode of
        operation:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
   MN                    HA
   |                     |
   |------RtSolPr-------&gt;|
   |&lt;-----PrRtAdv--------|
   |                     |
   |------FBU-----------&gt;|
   |                     |
   |          &lt;--FBack---|&lt;~buffer
   |                     |
disconnect               |
   |                     |
   |                     |
   |                     |
connect                  |
   |                     |
   |-------RegRequest---&gt;|
   |&lt;------RegReply------|
   |&lt;================deliver packets
   |                 (including FBack)</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 9&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p></p>
<ol class="text">
<li>MN sends a RtSolPr message with the identifiers of the access
            points it wishes move to. The wildcard option is not used in this
            situation, as the MN realises it is not attached to an FA and
            can’t expect the HA to know in which neighbourhood the MN is
            currently moving in.
</li>
<li>The HA responds with a PrRtAdv with code 2 or code 3 (codes 0,
            1 and 4 are irrelevant). The LLA options for unknown access points
            have code 7.
</li>
<li>The MN sends an FBU to the HA. The CoA field MUST contain the
            Home Agent’s IP address when attempting to connect to a NwoFA.
</li>
<li>The HA sends an Fback to the MN, the new IPv4 extension MUST
            NOT be present. The HA MUST buffer messages from this point until
            receiving a registration message from the MN, although it MAY drop
            packets due to space limitations or buffer management.
</li>
<li>Upon receiving the Fback, the MN disconnects, and reconnects to
            the new network. Upon receiving a new IP address, it completes a
            normal registration procedure to the HA (RegRequest and RegReply).
            The MN doesn’t send an FBU as it would when communicating with a
            nFA.
</li>
<li>The HA forwards buffered messages (including the FBack) to the
            MN. Normal operation resumes.
</li>
</ol>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Network without FA to Network with FA</h3>

<p>Figure 10 shows the timeline for the predictive mode of
        operation:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
   MN                     HA                  nFA
    |                     |                    |
    |------RtSolPr-------&gt;|                    |
    |&lt;-----PrRtAdv--------|                    |
    |                     |                    |
    |------FBU-----------&gt;|--------HI---------&gt;|
    |                     |&lt;------HAck---------|
    |          &lt;--FBack---|--FBack---&gt;         |&lt;~buffer
    |                     |                    |
disconnect              forward                |
    |                   packets===============&gt;|
    |                     |                    |
    |                     |                    |
connect                   |                    |
    |                     |                    |
    |--------- FBU ---------------------------&gt;|
    |&lt;=================================== deliver packets
    |                     |              (including FBack)
    |                     |&lt;-----FBU-----------|
    |-----RegRequest-----&gt;|                    |
    |&lt;----RegReply--------|                    |</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 10&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p></p>
<ol class="text">
<li>MN sends a RtSolPr message with the identifiers of the access
            points it wishes move to. The wildcard option is not used in this
            situation, as the MN realises it is not attached to an FA and
            can’t expect the HA to know in which neighbourhood the MN is
            currently moving in.
</li>
<li>The HA responds with a PrSolAdv with code 1 or code 3 (codes 0,
            2 and 4 are irrelevant).
</li>
<li>The MN sends a FBU to the HA. The CoA field MUST contain the
            nFA IP address.
</li>
<li>The HA sends a HI to the nFA, the S bit MAY be set to 1, and
            the U bit MUST be set to 1.
</li>
<li>The nFA responds with a HAck.
</li>
<li>The HA sends an FBack to the nFA and the MN.
</li>
<li>The MN disconnects, reconnects, and if necessary obtains an IP
            address.
</li>
<li>The MN sends an FBU to the nFA, which delivers buffered packets
            including the Fback.
</li>
<li>The nFA forwards the FBU to the HA, with the source and
            destination IP fields containing the addresses of the nFA and HA
            respectively. This message is sent only for consistency purposes,
            and should be silently discarded by the HA.
</li>
<li>The MN registers with the HA, and normal operation resumes.
</li>
</ol>

<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<a name="NAT"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
NAT Considerations</h3>

<p>A FA that supports fast handover MUST either have a public address
        or, if it really must be behind a NAT, there MUST be a mechanism
        whereby all mobile IP traffic is relayed to the FA. A simple way to
        accomplish this may simply be to forward all traffic on UDP port 434
        to the FA, but mechanisms such as STUN [rfc3489] may also be used. In
        any case, a FA behind a NAT MUST implement [rfc3519], in which case
        all fast handover registration messages must carry either the UDP
        Tunnel Request or UDP Tunnel Reply extension.
</p>
<a name="security_assoc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Security associations</h3>

<p>In addition to the mobile IP communications defined in <a class='info' href='#rfc3344'>[rfc3344]<span> (</span><span class='info'>Perkins, C., &ldquo;IP Mobility Support for IPv4,&rdquo; August&nbsp;2002.</span><span>)</span></a>, fast handovers (as defined in <a class='info' href='#rfc4881'>[rfc4881]<span> (</span><span class='info'>El Malki, K., &ldquo;Low-Latency Handoffs in Mobile IPv4,&rdquo; June&nbsp;2007.</span><span>)</span></a>, <a class='info' href='#rfc4988'>[rfc4988]<span> (</span><span class='info'>Koodli, R. and C. Perkins, &ldquo;Mobile IPv4 Fast Handovers,&rdquo; October&nbsp;2007.</span><span>)</span></a> and this
        document) feature extra messages that are solely between the FA and HA
        or in between two FAs. In order to prevent attacks such as traffic
        redirection and denial of service, those messages MUST be secured.
        However, having a security association between FAs and HAs may be
        problematic. For local communications, such as between neighbouring
        FAs, or for mobile IP elements belonging to a same organisation, the
        security association may simply be a statically input shared secret.
        However, this documents stipulates that the HA must be able to
        dynamically discover and create security associations with FAs (<a class='info' href='#Protocol'>Section&nbsp;3<span> (</span><span class='info'>Protocol</span><span>)</span></a>). The CARD protocol <a class='info' href='#rfc4066'>[rfc4066]<span> (</span><span class='info'>Liebsch, M., Singh, A., Chaskar, H., Funato, D., and E. Shim, &ldquo;Candidate Access Router Discovery (CARD),&rdquo; July&nbsp;2005.</span><span>)</span></a> already describes how its security
        associations are to be implemented, but other possible methods include
        using IKEv2 <a class='info' href='#rfc4306'>[rfc4306]<span> (</span><span class='info'>Kaufman, C., &ldquo;Internet Key Exchange (IKEv2) Protocol,&rdquo; December&nbsp;2005.</span><span>)</span></a> or an AAA infrastructure
        such as Diameter <a class='info' href='#rfc3588'>[rfc3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; Septemper&nbsp;2003.</span><span>)</span></a> whose use is specified
        in relation to mobile IPv4 (as described in <a class='info' href='#rfc4004'>[rfc4004]<span> (</span><span class='info'>Calhoun, P., Johansson, T., Perkins, C., Hiller, T., and P. McCann, &ldquo;Diameter Base Protocol,&rdquo; August&nbsp;2005.</span><span>)</span></a>).
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>This document does not allocate any numbers, so there are no IANA
      considerations.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="rfc2119">[rfc2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://www.ietf.org/rfc/rfc2119.txt">Key words for use in RFCs to Indicate Requirement
          Levels</a>,&rdquo; RFC&nbsp;2119, BCP&nbsp;14, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="rfc3344">[rfc3344]</a></td>
<td class="author-text">Perkins, C., &ldquo;<a href="http://tools.ietf.org/html/rfc3344">IP Mobility Support for IPv4</a>,&rdquo; RFC&nbsp;3344, August&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="rfc3519">[rfc3519]</a></td>
<td class="author-text">Levkowetz, H. and S. Vaarala, &ldquo;<a href="http://tools.ietf.org/html/rfc3519">Mobile IP Traversal of Network Address Translation (NAT)
          Devices</a>,&rdquo; RFC&nbsp;3519, April&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="rfc3588">[rfc3588]</a></td>
<td class="author-text">Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>,&rdquo; RFC&nbsp;3588, Septemper&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="rfc4004">[rfc4004]</a></td>
<td class="author-text">Calhoun, P., Johansson, T., Perkins, C., Hiller, T., and P. McCann, &ldquo;<a href="http://tools.ietf.org/html/rfc4004">Diameter Base Protocol</a>,&rdquo; RFC&nbsp;4004, August&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="rfc4066">[rfc4066]</a></td>
<td class="author-text">Liebsch, M., Singh, A., Chaskar, H., Funato, D., and E. Shim, &ldquo;<a href="http://tools.ietf.org/html/rfc4066">Candidate Access Router Discovery (CARD)</a>,&rdquo; RFC&nbsp;4066, July&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="rfc4306">[rfc4306]</a></td>
<td class="author-text">Kaufman, C., &ldquo;<a href="http://tools.ietf.org/html/rfc4306">Internet Key Exchange (IKEv2) Protocol</a>,&rdquo; RFC&nbsp;4306, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="rfc4433">[rfc4433]</a></td>
<td class="author-text">Kulkarni, M., Patel, A., and K. Leung, &ldquo;<a href="http://tools.ietf.org/html/rfc4433">Mobile IPv4 Dynamic Home Agent (HA) Assignment</a>,&rdquo; March&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="rfc4881">[rfc4881]</a></td>
<td class="author-text">El Malki, K., &ldquo;<a href="http://tools.ietf.org/html/rfc4881">Low-Latency Handoffs in Mobile IPv4</a>,&rdquo; RFC&nbsp;4881, June&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="rfc4988">[rfc4988]</a></td>
<td class="author-text">Koodli, R. and C. Perkins, &ldquo;<a href="http://tools.ietf.org/html/rfc4988">Mobile IPv4 Fast Handovers</a>,&rdquo; RFC&nbsp;4988, October&nbsp;2007.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="rfc4068">[rfc4068]</a></td>
<td class="author-text">Koodli, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4068">Fast Handovers for Mobile IPv6</a>,&rdquo; RFC&nbsp;4068, July&nbsp;2005.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Alistair Doswald (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Haute Ecole d'Ingénieurie et de Gestion
      du Canton de Vaud</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Route de Cheseaux 1</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yverdon-les-Bains, VD  1401</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">CH</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:alistair.doswald@heig-vd.ch">alistair.doswald@heig-vd.ch</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.heig-vd.ch/">http://www.heig-vd.ch/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stephan Robert</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Haute Ecole d'Ingénieurie et de Gestion
      du Canton de Vaud</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Route de Cheseaux 1</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yverdon-les-Bains, VD  1401</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">CH</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:stephan.robert@heig-vd.ch">stephan.robert@heig-vd.ch</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.heig-vd.ch/">http://www.heig-vd.ch/</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78
and at <a href='http://www.rfc-editor.org/copyright.html'>http://www.rfc-editor.org/copyright.html</a>, and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
