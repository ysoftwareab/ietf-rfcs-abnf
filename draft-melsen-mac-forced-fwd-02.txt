


Personal                                                       T. Melsen
Internet-Draft                                                  S. Blake
Expires: September 27, 2004                                     Ericsson
                                                          March 29, 2004


    MAC Forced Forwarding: An ARP proxy method for ensuring traffic
      separation between hosts sharing an Ethernet access network
                   draft-melsen-mac-forced-fwd-02.txt

Status of this Memo

   By submitting this Internet-Draft, I certify that any applicable
   patent or other IPR claims of which I am aware have been disclosed,
   and any of which I become aware will be disclosed, in accordance with
   RFC 3667.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups. Note that other
   groups may also distribute working documents as Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time. It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at http://
   www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on September 27, 2004.

Copyright Notice

   Copyright (C) The Internet Society (2004). All Rights Reserved.

Abstract

   This document describes a mechanism to ensure layer-2 separation of
   LAN stations accessing an IPv4 gateway over a shared Ethernet
   segment.

   The mechanism - called "MAC Forced Forwarding" - implements an ARP
   proxy function that prohibits MAC address resolution between hosts
   located within the same IP subnet but at different customer premises,
   and in effect directs all upstream traffic to the IP gateway. The IP
   gateway provides IP-layer connectivity between these same hosts.



Melsen & Blake         Expires September 27, 2004               [Page 1]

Internet-Draft           MAC Forced Forwarding                March 2004


Conventions used in this document

   In this document, the key words "MUST", "MUST NOT", "REQUIRED",
   "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT
   RECOMMENDED", "MAY", and "OPTIONAL" are to be interpreted as
   described in BCP 14, [RFC2119] and indicate requirement levels for
   compliant implementations.

Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  3
   1.1 Access Network Requirements  . . . . . . . . . . . . . . . . .  3
   1.2 Using Ethernet as an Access Network Technology . . . . . . . .  4
   1.3 Solution Characteristics . . . . . . . . . . . . . . . . . . .  5
   2.  Terminology  . . . . . . . . . . . . . . . . . . . . . . . . .  6
   3.  Solution Aspects . . . . . . . . . . . . . . . . . . . . . . .  6
   3.1 Obtaining the IP and MAC addresses of the Access Router  . . .  6
   3.2 Responding to ARP Requests . . . . . . . . . . . . . . . . . .  7
   3.3 Filtering Upstream Traffic . . . . . . . . . . . . . . . . . .  7
   4.  Access Router Considerations . . . . . . . . . . . . . . . . .  7
   5.  Resiliency Considerations  . . . . . . . . . . . . . . . . . .  8
   6.  Multicast Considerations . . . . . . . . . . . . . . . . . . .  8
   7.  IPv6 Considerations  . . . . . . . . . . . . . . . . . . . . .  8
   8.  Security Considerations  . . . . . . . . . . . . . . . . . . .  9
   9.  Acknowledgements . . . . . . . . . . . . . . . . . . . . . . .  9
       References . . . . . . . . . . . . . . . . . . . . . . . . . .  9
       Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . 10
       Intellectual Property and Copyright Statements . . . . . . . . 11























Melsen & Blake         Expires September 27, 2004               [Page 2]

Internet-Draft           MAC Forced Forwarding                March 2004


1. Introduction

   The main purpose of a remote access network is to provide
   connectivity between customer hosts and service provider access
   routers (AR), typically offering access to the Internet and other IP
   networks and/or IP-based applications.

   A remote access network may be decomposed into a subscriber line part
   and an aggregation network part. The subscriber line - often referred
   to as "the first mile" - is characterized by an individual physical
   connection to each customer premise. The aggregation network - "the
   second mile" - performs aggregation and concentration of customer
   traffic.

   The subscriber line and the aggregation network are interconnected by
   an Access Node (AN). Thus, the AN constitutes the border between
   individual subscriber lines and the common aggregation network. This
   is illustrated in the following figure.


        Access       Aggregation  Access    Subscriber    Customer
        Routers      Network      Nodes     Lines         Premise
                                                          Networks
        +----+           |
      --+ AR +-----------|        +----+
        +----+           |        |    +----------------[]--------
                         |--------+ AN |
                         |        |    +----------------[]--------
                         |        +----+
                         |
                         |        +----+
                         |        |    +----------------[]--------
                         |--------+ AN |
                         |        |    +----------------[]--------
                         |        +----+
                         |
                         |        +----+
                         |        |    +----------------[]--------
                         |--------+ AN |
        +----+           |        |    +----------------[]--------
      --+ AR +-----------|        +----+
        +----+           |



1.1 Access Network Requirements

   There are two basic requirements that a remote access network



Melsen & Blake         Expires September 27, 2004               [Page 3]

Internet-Draft           MAC Forced Forwarding                March 2004


   solution must satisfy:
   1.  Layer-2 traffic separation MUST be provided between customer
       premises.
   2.  High IPv4 address assignment efficiency MUST be supported.

   It is required that all traffic to and from customer hosts located at
   different premises (i.e., accessed via different subscriber lines, or
   via different access networks) be forwarded via an AR, and not
   bridged at layer-2 (Requirement 1). This enables the access network
   service provider to use the AR(s) to perform security filtering,
   policing, and accounting of all customer traffic. This implies that
   within the access network, layer-2 traffic paths should not exist
   that circumvent an AR.

   In ATM-based access networks, the separation of individual customer
   hosts' traffic is an intrinsic feature achieved by the use of ATM
   permanent virtual connections (PVCs) between the customers' access
   device (e.g., DSL modem) and the AR (typically co-located/integrated
   with access control functionality in a broadband access server
   (BRAS)). In this case, the Access Node is an ATM-based Digital
   Subscriber Line Access Multiplexer (DSLAM).

   This document, however, targets Ethernet-based access networks.
   Techniques other than ATM PVCs must be deployed to ensure the desired
   separation of traffic to and from individual customer hosts.

   Efficient address assignment is necessary to minimize consumption of
   scarce IPv4 address space (Requirement 2). See [RFC3069] for a
   discussion on why this requirement is relevant.  Address assignment
   efficiency is improved if host addresses are assigned out of one or
   more large pools, rather than by being assigned out of separate
   subnet blocks allocated to each customer premise.

1.2 Using Ethernet as an Access Network Technology

   A major aspect of using Ethernet as an access technology is that
   traffic pertaining to different customer hosts is conveyed over a
   shared broadcast network. To avoid IP routing in the access network,
   the Ethernet aggregation network is bridged via Access Nodes to
   individual Ethernet networks at the customers' premises. If the
   Access Node were a standard bridge then there would be direct
   visibility between Ethernet stations (hosts) located at different
   customers' premises due to the nature of Ethernet. Specifically,
   hosts located within the same IP subnet would have this visibility.
   This violates Requirement 1 (Section 1.1) and introduces security
   issues, as malicious end-users can attack hosts at other customers'
   premises directly at the Ethernet layer.




Melsen & Blake         Expires September 27, 2004               [Page 4]

Internet-Draft           MAC Forced Forwarding                March 2004


   Existing standardized solutions may be deployed to prevent layer-2
   visibility between stations:
   o  PPP over Ethernet [RFC2516]. The use of PPPoE creates individual
      tunnels between hosts and one or more Access Concentrators (AC)
      over a bridged Ethernet topology. Traffic always flows between an
      AC and hosts, never between hosts. The Access Node can enforce
      that upstream traffic will only go to the AC initially selected by
      the host.
   o  VLAN per customer [RFC3069]. Individual traffic streams can be
      separated in different VLANs between the AN and the AR.

   Both solutions provide layer-2 isolation between customer hosts, but
   they are not considered optimal for broadband remote access networks,
   because:
   o  PPPoE does not support efficient multicast, one of the major
      advantages of using Ethernet (instead of ATM) as an access
      technology.
   o  Using VLANs to separate individual customer hosts is not
      appealing, since that is regarded as requiring cumbersome
      provisioning. Furthermore, the basic limit of a maximum of 4096
      VLANs per-Ethernet network limits the scalability of the solution.
      This limit can be removed by deploying VLAN stacking techniques
      within the access network, but this approach only adds to the
      provisioning complexity.

1.3 Solution Characteristics

   The solution proposed in this document has the following main
   characteristics:
   1.  Traffic between individual customer hosts is isolated over the
       Ethernet access network. Traffic always flows between customer
       hosts and the AR, and never directly between customer hosts at
       different premises.
   2.  IP addresses are assigned to customer hosts in an efficient
       manner. Specifically, allocating individual IP subnets to each
       customer network is NOT a requirement for this solution to
       function.
   3.  The solution works for both dynamically assigned IP addresses
       (via DHCP) and statically assigned IP addresses.
   4.  IP over Ethernet is used as the access protocol to ensure
       efficient multicast support (for multicast streams originating
       upstream from the access network; see Section 6).
   5.  VLANs are NOT used to separate traffic pertaining to individual
       customer hosts, due to scalability and provisioning issues.







Melsen & Blake         Expires September 27, 2004               [Page 5]

Internet-Draft           MAC Forced Forwarding                March 2004


2. Terminology

   Ethernet Access Node (EAN)
      The entity interconnecting individual subscriber lines and the
      shared aggregation network, e.g., for xDSL access, the EAN is an
      Ethernet-centric DSLAM. The EAN is a special type of filtering
      bridge that does not forward Ethernet broadcast and multicast
      frames originating on a subscriber line to other subscriber lines,
      but either discards them or forwards them to an AR. The EAN also
      discards unicast Ethernet frames originating on a subscriber line
      and not addressed to an AR.

   Access Router (AR)
      The entity interconnecting the access network to the Internet or
      other IP-based networks. The AR provides connectivity between
      hosts on the access network at different customer premises. It is
      also used to provide security filtering, policing, and accounting
      of customer traffic.

3. Solution Aspects

   The basic property of the solution is that the EAN ensures that
   upstream traffic is always sent to the designated AR, even if the IP
   traffic goes between customer hosts located in the same IP subnet.

   The solution has three major aspects:
   1.  Initially, the EAN obtains the IP and MAC address of the target
       AR.
   2.  The EAN replies with this MAC address to any upstream ARP
       [RFC0826] request from customer hosts.
   3.  The EAN filters out any upstream traffic to MAC addresses other
       than the target AR.

   These aspects are discussed in the following sections.

3.1 Obtaining the IP and MAC addresses of the Access Router

   The AR is typically the default gateway of the host.

   The EAN may learn the IP address of the AR in one of two ways,
   depending on the host IP address assignment method. If each host uses
   DHCP, the AR IP address is dynamically learned by snooping the DHCP
   reply to a host. Otherwise, the AR IP address is pre-provisioned by
   the network operator. In both cases, the EAN will need to determine
   the corresponding MAC address, using ARP. This can be done
   immediately after the IP address is learned, or when the MAC address
   is first required.




Melsen & Blake         Expires September 27, 2004               [Page 6]

Internet-Draft           MAC Forced Forwarding                March 2004


   An access network may contain multiple ARs, and different hosts may
   be assigned different ARs. This implies that the EAN MUST register
   the assigned AR address on a per-host basis.

3.2 Responding to ARP Requests

   If all customer networks were assigned individual IP subnets, all
   upstream traffic would normally go to an AR (typically the default
   gateway), and the EAN could validate all upstream traffic by checking
   that the destination MAC address matched the AR.

   However, to comply with Requirement 2 of Section 1.1, residential
   customer networks are not (usually) assigned individual IP subnets.
   In other words, several hosts located at different premises are
   within the same IP subnet. Consequently, if a host wishes to
   communicate with a host at another premise, an ARP is issued to
   obtain that host's corresponding MAC address. This ARP request is
   intercepted by the EAN's ARP proxy, and responded to with an ARP
   reply, indicating the AR MAC address as the requested layer-2
   destination, in a manner similar to the "proxy ARP" mechanism
   described in [RFC1009]. In this way, the ARP table of the requesting
   host will register the AR MAC address as the layer-2 destination for
   any host within that IP subnet.

   An exception is made when a host is ARPing for another host located
   within the same premise. If this ARP request reaches the EAN, it is
   discarded, because it is assumed to be answered directly by a host
   locally within the premise.

3.3 Filtering Upstream Traffic

   Since the EAN's ARP proxy will always reply with the MAC address of
   the AR, the requesting host will never learn MAC addresses of hosts
   located at other premises. However, malicious customers or
   malfunctioning hosts may still try to send traffic using other
   destination MAC addresses. This traffic MUST be discarded by the EAN.

4. Access Router Considerations

   Traffic between hosts that belong to the same IP subnet but are
   located at different premises will always be forwarded via an AR. In
   this case, the AR will forward the traffic to the originating
   network, i.e., on the same interface from where it was received. This
   normally results in an ICMP redirect message, [RFC0792], being sent
   to the originating host. To prevent this behavior, the ICMP redirect
   function for aggregation network interfaces MUST be disabled in the
   AR.




Melsen & Blake         Expires September 27, 2004               [Page 7]

Internet-Draft           MAC Forced Forwarding                March 2004


5. Resiliency Considerations

   The operation of MAC Forced Forwarding does not interfere with or
   delay IP connectivity recovery in the event of a sustained AR failure
   when DHCP is used as the IP address allocation mechanism, or when two
   or more ARs implement VRRP [RFC2338].

   MAC Forced Forwarding is a stateful protocol. If static IP address
   assignment is used in the access network, then the EAN state database
   can be quickly recovered in the event of a transient EAN failure.
   Otherwise, transient failure of an EAN can lead to temporary loss of
   connectivity, since the DHCP and ARP messages that are snooped to
   construct the EAN state database are usually infrequent, and a
   transient failure may not be detected by either the AR(s) or the
   customer premise hosts. For high availability applications, EANs used
   in access networks using dynamic IP address assignment SHOULD employ
   resilient storage of their state database to permit timely
   restoration of connectivity in the event of a transient EAN failure.

6. Multicast Considerations

   Multicast traffic delivery for streams originating upstream from the
   access network and delivered to one or more customer premise hosts in
   an access network is supported in a scalable manner by virtue of
   Ethernet's native multicast capability. Efficiency can be enhanced if
   the EAN behaves as an IGMP snooping bridge; e.g., if it snoops on
   IGMP Membership Report and Leave Group messages originating on
   subscriber lines, to prune the set of subscriber lines on which to
   forward multicast packets.

   Support for multicast streams originating from a customer premise
   host is not discussed in this document.

7. IPv6 Considerations

   MAC Forced Forwarding is not directly applicable for IPv6 access
   networks, for the following reasons:
   1.  IPv6 access networks do not require the same efficiency of
       address allocation as IPv4 access networks. It is expected that
       customer premise networks will be allocated unique network
       prefixes (e.g., /48) accommodating large numbers of customer
       subnets and hosts.
   2.  IPv6 nodes do not use ARP, but instead use the Neighbor Discovery
       protocol [RFC2461] for layer-2 address resolution.
   3.  IPv6 nodes do not necessarily use DHCP to obtain IP addresses and
       IP gateway information, but may instead use the Stateless Address
       Autoconfiguration protocol [RFC2462].
   Furthermore, there is no practical deployment experience using a MAC



Melsen & Blake         Expires September 27, 2004               [Page 8]

Internet-Draft           MAC Forced Forwarding                March 2004


   Forced Forwarding-type approach in an IPv6 access network.

   Some principles of MAC Address Forwarding may be applicable in an
   IPv6 access network design and merit further study.

8. Security Considerations

   MAC Forced Forwarding is by its nature a security function, ensuring
   layer-2 isolation of customer hosts sharing a broadcast access
   medium. In that sense it provides security equivalent to alternative
   PVC-based solutions.  Security procedures appropriate for any shared
   access medium are equally appropriate when MAC Forced Forwarding is
   employed.  It does not introduce any additional vulnerabilities over
   those of standard Ethernet bridging.

   A MAC Forced Forwarding implementation MUST ensure that only
   authentic DHCP replies are used in the dynamic discovery of AR
   addresses. One way to accomplish this is to reject any upstream DHCP
   replies, i.e., replies originated on a subscriber line.

9. Acknowledgements

   The authors would like to thank Ulf Jonsson, Thomas Narten, James
   Carlson, Rolf Engstrand, Tomas Thyni, and Johan Kolhi for their
   helpful comments.

References

   [RFC0792]  Postel, J., "Internet Control Message Protocol", STD 5,
              RFC 792, September 1981.

   [RFC0826]  Plummer, D., "Ethernet Address Resolution Protocol: Or
              converting network protocol addresses to 48.bit Ethernet
              address for transmission on Ethernet hardware", STD 37,
              RFC 826, November 1982.

   [RFC1009]  Braden, R. and J. Postel, "Requirements for Internet
              gateways", RFC 1009, June 1987.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC2338]  Knight, S., Weaver, D., Whipple, D., Hinden, R., Mitzel,
              D., Hunt, P., Higginson, P., Shand, M. and A. Lindem,
              "Virtual Router Redundancy Protocol", RFC 2338, April
              1998.

   [RFC2461]  Narten, T., Nordmark, E. and W. Simpson, "Neighbor



Melsen & Blake         Expires September 27, 2004               [Page 9]

Internet-Draft           MAC Forced Forwarding                March 2004


              Discovery for IP Version 6 (IPv6)", RFC 2461, December
              1998.

   [RFC2462]  Thomson, S. and T. Narten, "IPv6 Stateless Address
              Autoconfiguration", RFC 2462, December 1998.

   [RFC2516]  Mamakos, L., Lidl, K., Evarts, J., Carrel, D., Simone, D.
              and R. Wheeler, "A Method for Transmitting PPP Over
              Ethernet (PPPoE)", RFC 2516, February 1999.

   [RFC3069]  McPherson, D. and B. Dykes, "VLAN Aggregation for
              Efficient IP Address Allocation", RFC 3069, February 2001.


Authors' Addresses

   Torben Melsen
   Ericsson
   Faelledvej
   Struer  DK-7600
   Denmark

   EMail: Torben.Melsen@ericsson.com


   Steven Blake
   Ericsson
   IP Infrastructure
   920 Main Campus Drive
   Suite 500
   Raleigh, NC  27606
   USA

   Phone: +1 919 472-9913
   EMail: steven.blake@ericsson.com
















Melsen & Blake         Expires September 27, 2004              [Page 10]

Internet-Draft           MAC Forced Forwarding                March 2004


Intellectual Property Statement

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights. Information
   on the IETF's procedures with respect to rights in IETF Documents can
   be found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard. Please address the information to the IETF at
   ietf-ipr@ietf.org.


Disclaimer of Validity

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Copyright Statement

   Copyright (C) The Internet Society (2004). This document is subject
   to the rights, licenses and restrictions contained in BCP 78, and
   except as set forth therein, the authors retain all their rights.


Acknowledgment

   Funding for the RFC Editor function is currently provided by the
   Internet Society.




Melsen & Blake         Expires September 27, 2004              [Page 11]


