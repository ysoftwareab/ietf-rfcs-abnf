Network Working Group		                            Bharat M Gaonkar
Internet Draft		                                    Praveen Ananthasankaran
Intended status: Experimental		                    Sudhin Jacob
Expires: September 2016		                            Juniper Networks
	                                                    March 13, 2016




		Packet Loss measurement for layer2 services
		
			draft-bhaprasud-lime-pm-00.txt
			
Abstract

This memo defines the loss measurement over a point-to-point service.
Loss will be measured over this service in single class colored and
colorless mode.


Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

     
   This Internet-Draft will expire on September 10, 2016



   Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.


Expires September 10, 2016                              [Page 1]












Table of Contents

1. Introduction.......................................3

2. Terminologies......................................3

3. Loss Measurement...................................5

3.1 Rules for loss measurement........................6

3.2 Single class colorless loss measurement...........6

3.3 Single class colored loss measurement.............8

3.4 Multi class colorless loss measurement............8

3.5 Packet Code point based loss measurement..........9

3.6 Multiclass colored loss measurement..............10

4.0 Security Considerations..........................11

5.0 IANA Considerations..............................11

6.0	References.......................................11

6.1. Normative Reference.............................11

7. Appendix..........................................12
   Authors' Addresses................................13




 Expires September 10, 2016                 	[Page 2]


 
 
 
 
 
 
 
 
 

1. Introduction

This document provides a solution to measure loss and the packet transmitted 
over a point-to-point service for a period. It calculates the loss 
unidirectional/bidirectional on a point-to-point service. This draft explains
the single class colorless which count both in profile,out profile packets
and single class colored which calculates the in profile packets.



2. Terminologies

CCM       Continuity check messages
LMM       Loss Measurement Message
LMR       Loss Measurement Reply 


Txfcf         is a 4-octet field, which carries the value of counter responsible for
              counting packets from its mep to peer mep at the time of LMM transmission.   
 
Rxfcf        is a 4-octet field, which carries the value of counter responsible for
             counting the packets received by the mep from its peer mep at the time
			 of receiving last LMM packet    

Txfcb       is a 4-octet field, which carries the value of the counter responsible
            for counting the packet transmitted by the mep to its peer mep at the time of LMR  
			transmission. 


Rxfcb       is a 4-octet field, which carries the value of the counter responsible
             for counting the packet received by mep from its peer mep at the time receiving 
			 last LMR packet.


Class    is a set of packet having multiple priorities undergrown similar treatment.                             
             

			 
			 
			 
			 
			 
			 
			 
			 

 Expires September 10, 2016                						 [Page 3]
 
 
 
 
 
 
 

3. Loss Measurement

+-----+   +------+    +------+
| PE1 |   |  P   |    | PE2  |
|     +---+      +----+      |
+-----+   +------+    +------+

Figure 1

Kindly refer the figure 1, there is point-to-point service running from PE1 to PE2.
Over the service, traffic will be flowing in both direction. The purpose of this draft is
to explain the loss measurement (uni directional or bi directional) over this service.
The mep is configured over the point-to-point service on both end that is PE1 and PE2 
where the service terminates.The loss measurement will be running over it.
The loss measurement PDU details were explained in Appendix 1. The loss measurement PDU
can be send in 10ms/100ms/1s and 10s interval. The data packets will be counted based
on the color where the measurement mode is colored. The entire packets will be counted
if the measurement mode is colorless. The in-profile packets are called as green,
out-profile packets are called as red. The green packets will have loss priority low,
red will have loss priority high, yellow/amber will have loss priority medium high.
This will not count protocol packet destined to CPU that is ccm packets



3.1 Rules for loss measurement

Rule for loss measurement

a.	When loss measurement is carried out in up mep the packets will be counted in
ingress direction after the firewall.

b.	When the loss measurement is carried out up mep direction, the packets will
be counted in egress direction after the firewall.


c.	When the loss measurement is carried out in down mep the packets will be counted
in ingress direction before the firewall.

d.	When the loss measurement is carried out in down mep the packets will be
counted in egress direction after the firewall.










 Expires September 10, 2016                 			[Page 4]
 
 
 
 
 
 
 
 


3.2 Single class colorless loss measurement 

Consider the bidirectional traffic is going over point-to-point l2 services.
Once loss measurement is running over these services one will be the client initiating
the LMM packet and the server responds to the LMM PDU by sending LMR PDU. 
The LMM packet will copy the data packet count just before the LMM transmission in 
the Txfcf counter. The other two counters Rxfcf and Txfcb are 0. In these counting all
the packets which is red, green, amber/yellow are counted and the total value is copied in
Txfcf. Then the LMM packet is transmitted to its peer mep once it reaches the other side,
the Txfcf packet counter vlaue is copied from LMM packet and it is pasted in Txfcf of
the LMR packet. The LMR packet counts the packet just before the transmission of LMR. 
The Rxfcf is the packets received from its peer mep, these packets count is copied to
Rxfcf counter and the Txfcb is the packet transmitted from its mep to its peer mep that
value is copied in to the Txfcb and the LMR packet is transmitted to its peer mep. 
Once the LMR is received by the client all the counter values are copied, 
along with another counter called Rxfcb which is the packet count value of the packets
received from its peer mep at the time of LMR packet reception based on these 
four counter values the loss measurement is carried out.


Previous LMM/LMR frame's TxFCf, RxFCb, and TxFCb values and local counter RxFCl
value at the time the previous LMM/LMR frame was received. 
These values are represented as TxFCftp,RxFCbtp, TxFCbtp, and RxFCltp, 
where tp is the reception time of the previous frame.


Frame Loss far-end = ((TxFCbtc _ TxFCbtp) _ (RxFCbtc _ RxFCbtp))

Frame Loss near-end = ((TxFCftc _ TxFCftp) _ (RxFCltc _ RxFCltp))



In colorless measurement, there will be two counters at each side one for transmission and
one for reception. This counter will store the data packet count since the inception of
loss measurement,this can be reset to 0 by a CLI or performance monitor deactivating/activating.
The loss measurement values can be stored in each predetermined interval for historical purpose. 
This can be later retrieved by CLI.






Expires September 10, 2016                 			[Page 5]










3.3 Single class colored loss measurement 


Consider the bidirectional traffic is going over point-to-point l2 services.
Once loss measurement is running over these service one will be the client initiating
the LMM packet and the server responds to the LMM PDU by sending LMR PDU.
The LMM packet will copy the data packet count just before the LMM transmission in
the Txfcf counter. The other two counters Rxfcf and Txfcb are 0. In these counting, 
all the packets, which is green called as in profile packet termed as CIR(committed information rate)
and amber/yellow which is EIR(exceeding information rate). The LMM, LMR packets will be counting 
a new set of counters for storing EIR termed as amber/yellow packet. The normal counters in LMM/LMR
will capture only the green packets. The green packets are counted and the total value is
copied in Txfcf. Then the LMM packet is transmitted to its peer mep once it reaches the other side,
the Txfcf packet counter vlaue is copied from LMM packet and it is pasted in Txfcf of the LMR packet.
The LMR packet counts the packet just before the transmission of LMR. The Rxfcf is the packets 
received from its peer mep, these packets count is copied to Rxfcf counter and the Txfcb is
the packet transmitted from its mep to its peer mep, that value is copied in to the Txfcb
and the LMR packet is transmitted to its peer mep. Once the LMR is received by the client 
all the counter values are copied, along with another counter called Rxfcb which is the packet
count value of the packets received from its peer mep at the time of LMR packet reception based
on these four counter values the loss measurement is carried out. The above part explained the 
counting the green packets, the same will be applicable for counting amber/yellow packet 
for that an additional four 32 bit counters are added along with LMM/LMR when the loss 
measurement is operating in colored mode. These counters are added as a new TLV, these 
TLV details mentioned in Appendix 1. The operation of the new counters are same except 
they will count only amber/yellow packet.




 Expires September 10, 2016                 			[Page 6]
 



 
 
 
Previous LMM/LMR frame's TxFCf, RxFCb, and TxFCb values and local counter RxFCl value at 
the time the previous LMM/LMR frame was received. These values are represented as 
TxFCftp,RxFCbtp, TxFCbtp, and RxFCltp, where tp is the reception time of the previous frame.



Frame Loss far-end = ((TxFCbtc _ TxFCbtp) _ (RxFCbtc _ RxFCbtp))

Frame Loss near-end = ((TxFCftc _ TxFCftp) _ (RxFCltc _ RxFCltp))



In colored measurement, there will be four counters at each side two for transmission and 
two for reception. This counter will store the data packet count since the inception of 
loss measurement, this can be reset to 0 by a CLI or performance monitor deactivating/activating. 
The loss measurement values can be stored in each predetermined interval for historical purpose. 
This can be later retrieved by CLI.












Expires September 10, 2016                 					[Page 7]














3.4 Multi class colorless loss measurement 


 In this each forwarding class will have two counters one of transmitting and one for receiving.
 The colorless mode it will count all the packet in the forwarding class even it is red, 
 medium high or green. The LMM/LMR packet will be send for each forwarding class. 
 The counting of packet is based on the forwarding class.

Consider the bidirectional traffic is going over point-to-point l2 services. 
Once loss measurement is running over these service in multi class colorless mode, 
so there will be multiple LMM/LMR send per forwarding class, one will be the client 
initiating the LMM packet and the server responds to the LMM PDU by sending LMR PDU. 
The LMM packet will copy the data packet count just before the LMM transmission in the 
Txfcf counter of each FC. The other two counters Rxfcf and Txfcb are 0. 
In these counting all the packets which is red, green, amber/yellow are counted and 
the total value is copied in Txfcf. Then the LMM packet is transmitted to its peer 
mep once it reaches the other side, the Txfcf packet counter vlaue is copied from LMM 
packet and it is pasted in Txfcf of the LMR packet. The LMR packet counts the packet 
just before the transmission of LMR. The Rxfcf is the packets received from its peer mep,
these packets count is copied to Rxfcf counter and the Txfcb is the packet transmitted 
from its mep to its peer mep that value is copied in to the Txfcb and the LMR packet is 
transmitted to its peer mep. Once the LMR is received by the client all the counter values
are copied, along with another counter called Rxfcb which is the packet count value of 
the packets received from its peer mep at the time of LMR packet reception based on 
these four counter values the loss measurement is carried out.



Previous LMM/LMR frame's TxFCf, RxFCb, and TxFCb values and local counter RxFCl 
value at the time the previous LMM/LMR frame was received.
 These values are represented as TxFCftp,RxFCbtp, TxFCbtp, and RxFCltp,
 where tp is the reception time of the previous frame.



Frame Loss far-end = ((TxFCbtc _ TxFCbtp) _ (RxFCbtc _ RxFCbtp))

Frame Loss near-end = ((TxFCftc _ TxFCftp) _ (RxFCltc _ RxFCltp))











Expires September 10, 2016                 			[Page 8]




















3.5 Packet Code point based loss measurement

Consider the bidirectional traffic is going over point-to-point l2 services.
Once loss measurement is running over these service one will be the client initiating
the LMM packet and the server responds to the LMM PDU by sending LMR PDU.
The LMM packet will copy the data packet count just before the LMM transmission in 
the Txfcf counter. The other two counters Rxfcf and Txfcb are 0.
The device maintains counter of all data packets received to and transmitted from 
the device based on the Packet Loss Priority(PLP) of the packet.
The PLP of the packet is obtained from the vlan header of the layer2 packet. 
The LMM packet when injected with a particular PLP value will copy the data counters
for the specific PLP. All packets are considered into this accounting except the local
 host originated and packet supposed to be consumed by the host. 
 The injected LMM packet copies the counter into the Txfcf field of the packet.
 The packet then follows the regular data path to reach the peer side.
 At the peer side, the similar accounting of data statistics is to be
 maintained based on PLP of the packets. The LMM packets received at the 
 PEER will copy the data counter into the Rxfcf field of the LMM packet. 
 The peer then replies the LMR packet after coping the Txfcb field of packets
 sent from peer towards the originator. LMR PDU received will do the same operation.
 Two such LMR framed received back can be used to computer he loss during a specific window.
 The below formula indicated the computation where tp is the 1st frame and tc is the
 2nd frame used for computation. 


 
Frame Loss far-end = ((TxFCbtc _ TxFCbtp) _ (RxFCbtc _ RxFCbtp))

Frame Loss near-end = ((TxFCftc _ TxFCftp) _ (RxFCltc _ RxFCltp))


The prerequisite for this kind of loss measurement is that the data and control packets in
the network should be vlan tagged as the accounting of statistics happen based on the Code
point filed in the vlan header. 















Expires September 10, 2016                 			[Page 9]




3.6	Multi class colored loss measurement 

Consider the bidirectional traffic is going over point-to-point l2 services.
The service here can have multiple forwarding classes supported.
Once loss measurement is running over these service one will be the client 
initiating the LMM packet and the server responds to the LMM PDU by sending 
LMR PDU. LMM PDU will be initiated for each forwarding class. 
The LMM packet will copy the data packet count just before the 
LMM transmission in the Txfcf counter. The other two counters Rxfcf 
and Txfcb are 0. In these counting, all the packets, which is green 
called as in profile packet termed as CIR(committed information rate) 
and amber/yellow which is EIR(exceeding information rate). 
The LMM, LMR packets will be counting a new set of counters for storing 
EIR termed as amber/yellow packet. The normal counters in LMM/LMR 
will capture only the green packets. The green packets are counted 
and the total value is copied in Txfcf. Then the LMM packet is transmitted
to its peer mep once it reaches the other side, the Txfcf packet counter
vlaue is copied from LMM packet and it is pasted in Txfcf of the LMR packet.
The LMR packet counts the packet just before the transmission of LMR. 
The Rxfcf is the packets received from its peer mep, these packets count
is copied to Rxfcf counter and the Txfcb is the packet transmitted from its mep
to its peer mep, that value is copied in to the Txfcb and the LMR packet is transmitted
to its peer mep. Once the LMR is received by the client all the counter values are copied,
along with another counter called Rxfcb which is the packet count value of the packets
received from its peer mep at the time of LMR packet reception based on these
four counter values the loss measurement is carried out. The above part explained 
the counting the green packets, the same will be applicable for counting amber/yellow
packet for that an additional four 32 bit counters are added along with LMM/LMR 
when the loss measurement is operating in colored mode. These counters are added as 
a new TLV, these TLV details mentioned in Appendix 1. The operation of the new counters 
are same except they will count only amber/yellow packet.








Previous LMM/LMR frame's TxFCf, RxFCb, and TxFCb values and local counter RxFCl 
value at the time the previous LMM/LMR frame was received. 
These values are represented as TxFCftp,RxFCbtp, TxFCbtp, 
and RxFCl[tp], where tp is the reception time of the previous frame.


Frame Loss far-end = ((TxFCbtc _ TxFCbtp) _(RxFCbtc _ RxFCbtp))

Frame Loss near-end = ((TxFCftc _ TxFCftp) _(RxFCltc _ RxFCltp))

In multi class colored measurement, there will be four counters at each 
side two for transmission and two for reception for each class supported by the service. 
If we support n class of service then number of counters maintained per serice would 
be 4 * n. These counters will store the data packet count since the inception of
loss measurement, this can be reset to 0 by a CLI or performance monitor 
deactivating/activating. The loss measurement values can be stored in each
 predetermined interval for historical purpose. This can be later retrieved by CLI.




 
 
 
 
  Expires September 10, 2016                 			[Page 10]
 



 
 
 

4.0 Security Considerations 


NA

5.0 IANA Considerations

NA


6.0	References


6.1. Normative Reference



[ITU-Y1731] OAM functions and mechanisms for Ethernet based networks









Expires September 10, 2016                 			[Page 11]






















7. Appendix 

The below PDU structure represents the PDU format for loss measurement packets. 

8 7 6 5 4 3 2 1 8 7 6 5 4 3 2 1 8 7 6 5 4 3 2 1 8 7 6 5 4 3 2 1
+----------------------------------------------------------------+
|Level|Version  |Opcode         |Flags          |TLV offset      |
+----------------------------------------------------------------+
|                     Txfcf                                      |
+----------------------------------------------------------------+
|                     Rxfcf                                      |
+----------------------------------------------------------------+
|                     Txfcb                                      |
+----------------------------------------------------------------+
| EIR tlv opcode| Eir packets Txfcf                              |
+----------------------------------------------------------------+
|               | Eir packet Rxfcf                               |
+----------------------------------------------------------------+
|               | Eir Packet Txfcb                               |
+--------------------------------+-------------------------------+
|               | END TLV(0)     |
+---------------+----------------+










Expires September 10, 2016                 			[Page 12]




Authors  Addresses

Bharat M Gaonkar
Juniper Networks
1133 Innovation Way
Sunnyvale, California 94089 USA
Email: gbharat@juniper.net

Praveen Ananthasankaran
Juniper Networks
1133 Innovation Way
Sunnyvale, California 94089 USA
Email: panantha@juniper.net

Sudhin Jacob(editor)
Juniper Networks
1133 Innovation Way
Sunnyvale, California 94089 USA
Email: sjacob@juniper.net

				

				
Expires September 10, 2016                 			[Page 13]