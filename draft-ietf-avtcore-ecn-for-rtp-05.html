<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Explicit Congestion Notification (ECN) for RTP over UDP</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions, Definitions and Acronyms">
<link href="#rfc.section.3" rel="Chapter" title="3 Discussion, Requirements, and Design Rationale">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Requirements">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Applicability">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Interoperability">
<link href="#rfc.section.4" rel="Chapter" title="4 Overview of Use of ECN with RTP/UDP/IP">
<link href="#rfc.section.5" rel="Chapter" title="5 RTCP Extensions for ECN feedback">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 RTP/AVPF Transport Layer ECN Feedback packet">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 RTCP XR Report block for ECN summary information">
<link href="#rfc.section.6" rel="Chapter" title="6 SDP Signalling Extensions for ECN">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Signalling ECN Capability using SDP">
<link href="#rfc.section.6.1.1" rel="Chapter" title='6.1.1 Use of "a=ecn-capable-rtp:" with the Offer/Answer Model'>
<link href="#rfc.section.6.1.2" rel="Chapter" title='6.1.2 Use of "a=ecn-capable-rtp:" with Declarative SDP'>
<link href="#rfc.section.6.1.3" rel="Chapter" title='6.1.3 General Use of the "a=ecn-capable-rtp:" Attribute'>
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 RTCP ECN Feedback SDP Parameter">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 XR Block ECN SDP Parameter">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 ICE Parameter to Signal ECN Capability">
<link href="#rfc.section.7" rel="Chapter" title="7 Use of ECN with RTP/UDP/IP">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Negotiation of ECN Capability">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Initiation of ECN Use in an RTP Session">
<link href="#rfc.section.7.2.1" rel="Chapter" title="7.2.1 Detection of ECT using RTP and RTCP">
<link href="#rfc.section.7.2.2" rel="Chapter" title="7.2.2 Detection of ECT using STUN with ICE">
<link href="#rfc.section.7.2.3" rel="Chapter" title="7.2.3 Leap of Faith ECT initiation method">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Ongoing Use of ECN Within an RTP Session">
<link href="#rfc.section.7.3.1" rel="Chapter" title="7.3.1 Transmission of ECT-marked RTP Packets">
<link href="#rfc.section.7.3.2" rel="Chapter" title="7.3.2 Reporting ECN Feedback via RTCP">
<link href="#rfc.section.7.3.3" rel="Chapter" title="7.3.3 Response to Congestion Notifications">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Detecting Failures">
<link href="#rfc.section.7.4.1" rel="Chapter" title="7.4.1 Fallback mechanisms">
<link href="#rfc.section.7.4.2" rel="Chapter" title="7.4.2 Interpretation of ECN Summary information">
<link href="#rfc.section.8" rel="Chapter" title="8 Processing ECN in RTP Translators and Mixers">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Transport Translators">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Fragmentation and Reassembly in Translators">
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Generating RTCP ECN Feedback in Media Transcoders">
<link href="#rfc.section.8.4" rel="Chapter" title="8.4 Generating RTCP ECN Feedback in Mixers">
<link href="#rfc.section.9" rel="Chapter" title="9 Implementation considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 IANA Considerations">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 SDP Attribute Registration">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 RTP/AVPF Transport Layer Feedback Message">
<link href="#rfc.section.10.3" rel="Chapter" title="10.3 RTCP Feedback SDP Parameter">
<link href="#rfc.section.10.4" rel="Chapter" title="10.4 RTCP XR Report blocks">
<link href="#rfc.section.10.5" rel="Chapter" title="10.5 RTCP XR SDP Parameter">
<link href="#rfc.section.10.6" rel="Chapter" title="10.6 STUN attribute">
<link href="#rfc.section.10.7" rel="Chapter" title="10.7 ICE Option">
<link href="#rfc.section.11" rel="Chapter" title="11 Security Considerations">
<link href="#rfc.section.12" rel="Chapter" title="12 Examples of SDP Signalling">
<link href="#rfc.section.12.1" rel="Chapter" title="12.1 Basic SDP Offer/Answer">
<link href="#rfc.section.12.2" rel="Chapter" title="12.2 Declarative Multicast SDP">
<link href="#rfc.section.13" rel="Chapter" title="13 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="14 References">
<link href="#rfc.references.1" rel="Chapter" title="14.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="14.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This memo specifies how Explicit Congestion Notification (ECN) can be used with the Real-time Transport Protocol (RTP) running over UDP, using RTP Control Protocol (RTCP) as a feedback mechanism. It defines a new RTCP Extended Report (XR) block for periodic ECN feedback, a new RTCP transport feedback message for timely reporting of congestion events, and a Session Traversal Utilities for NAT (STUN) extension used in the optional initialization method using Interactive Connectivity Establishment (ICE). Signalling and procedures for negotiation of capabilities and initialization methods are also defined." />
  <meta name="description" content="This memo specifies how Explicit Congestion Notification (ECN) can be used with the Real-time Transport Protocol (RTP) running over UDP, using RTP Control Protocol (RTCP) as a feedback mechanism. It defines a new RTCP Extended Report (XR) block for periodic ECN feedback, a new RTCP transport feedback message for timely reporting of congestion events, and a Session Traversal Utilities for NAT (STUN) extension used in the optional initialization method using Interactive Connectivity Establishment (ICE). Signalling and procedures for negotiation of capabilities and initialization methods are also defined." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Westerlund</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">I. Johansson</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Ericsson</td>
</tr>
<tr>
<td class="left">Expires: May 03, 2012</td>
<td class="right">C. . Perkins</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">University of Glasgow</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">P. O'Hanlon</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">UCL</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">K. Carlberg</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">G11</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 31, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Explicit Congestion Notification (ECN) for RTP over UDP<br />
  <span class="filename">draft-ietf-avtcore-ecn-for-rtp-05</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This memo specifies how Explicit Congestion Notification (ECN) can be used with the Real-time Transport Protocol (RTP) running over UDP, using RTP Control Protocol (RTCP) as a feedback mechanism. It defines a new RTCP Extended Report (XR) block for periodic ECN feedback, a new RTCP transport feedback message for timely reporting of congestion events, and a Session Traversal Utilities for NAT (STUN) extension used in the optional initialization method using Interactive Connectivity Establishment (ICE). Signalling and procedures for negotiation of capabilities and initialization methods are also defined.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 03, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions, Definitions and Acronyms</a>
</li>
<li>3.   <a href="#rfc.section.3">Discussion, Requirements, and Design Rationale</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Requirements</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Applicability</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Interoperability</a>
</li>
<li>4.   <a href="#rfc.section.4">Overview of Use of ECN with RTP/UDP/IP</a>
</li>
<li>5.   <a href="#rfc.section.5">RTCP Extensions for ECN feedback</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">RTP/AVPF Transport Layer ECN Feedback packet</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">RTCP XR Report block for ECN summary information</a>
</li>
<li>6.   <a href="#rfc.section.6">SDP Signalling Extensions for ECN</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Signalling ECN Capability using SDP</a>
</li>
<li>6.1.1.   <a href="#rfc.section.6.1.1">Use of "a=ecn-capable-rtp:" with the Offer/Answer Model</a>
</li>
<li>6.1.2.   <a href="#rfc.section.6.1.2">Use of "a=ecn-capable-rtp:" with Declarative SDP</a>
</li>
<li>6.1.3.   <a href="#rfc.section.6.1.3">General Use of the "a=ecn-capable-rtp:" Attribute</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">RTCP ECN Feedback SDP Parameter</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">XR Block ECN SDP Parameter</a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">ICE Parameter to Signal ECN Capability</a>
</li>
<li>7.   <a href="#rfc.section.7">Use of ECN with RTP/UDP/IP</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">Negotiation of ECN Capability</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">Initiation of ECN Use in an RTP Session</a>
</li>
<li>7.2.1.   <a href="#rfc.section.7.2.1">Detection of ECT using RTP and RTCP</a>
</li>
<li>7.2.2.   <a href="#rfc.section.7.2.2">Detection of ECT using STUN with ICE</a>
</li>
<li>7.2.3.   <a href="#rfc.section.7.2.3">Leap of Faith ECT initiation method</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">Ongoing Use of ECN Within an RTP Session</a>
</li>
<li>7.3.1.   <a href="#rfc.section.7.3.1">Transmission of ECT-marked RTP Packets</a>
</li>
<li>7.3.2.   <a href="#rfc.section.7.3.2">Reporting ECN Feedback via RTCP</a>
</li>
<li>7.3.3.   <a href="#rfc.section.7.3.3">Response to Congestion Notifications</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">Detecting Failures</a>
</li>
<li>7.4.1.   <a href="#rfc.section.7.4.1">Fallback mechanisms</a>
</li>
<li>7.4.2.   <a href="#rfc.section.7.4.2">Interpretation of ECN Summary information</a>
</li>
<li>8.   <a href="#rfc.section.8">Processing ECN in RTP Translators and Mixers</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Transport Translators</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Fragmentation and Reassembly in Translators</a>
</li>
<li>8.3.   <a href="#rfc.section.8.3">Generating RTCP ECN Feedback in Media Transcoders</a>
</li>
<li>8.4.   <a href="#rfc.section.8.4">Generating RTCP ECN Feedback in Mixers</a>
</li>
<li>9.   <a href="#rfc.section.9">Implementation considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">IANA Considerations</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">SDP Attribute Registration</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">RTP/AVPF Transport Layer Feedback Message</a>
</li>
<li>10.3.   <a href="#rfc.section.10.3">RTCP Feedback SDP Parameter</a>
</li>
<li>10.4.   <a href="#rfc.section.10.4">RTCP XR Report blocks</a>
</li>
<li>10.5.   <a href="#rfc.section.10.5">RTCP XR SDP Parameter</a>
</li>
<li>10.6.   <a href="#rfc.section.10.6">STUN attribute</a>
</li>
<li>10.7.   <a href="#rfc.section.10.7">ICE Option</a>
</li>
<li>11.   <a href="#rfc.section.11">Security Considerations</a>
</li>
<li>12.   <a href="#rfc.section.12">Examples of SDP Signalling</a>
</li>
<li>12.1.   <a href="#rfc.section.12.1">Basic SDP Offer/Answer</a>
</li>
<li>12.2.   <a href="#rfc.section.12.2">Declarative Multicast SDP</a>
</li>
<li>13.   <a href="#rfc.section.13">Acknowledgments</a>
</li>
<li>14.   <a href="#rfc.references">References</a>
</li>
<li>14.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>14.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#sec-intro" id="sec-intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This memo outlines how Explicit Congestion Notification (ECN) <a href="#RFC3168">[RFC3168]</a> can be used for <a href="#RFC3550">Real-time Transport Protocol (RTP)</a> <cite title="NONE">[RFC3550]</cite> flows running over UDP/IP which use RTP Control Protocol (RTCP) as a feedback mechanism. The solution consists of feedback of ECN congestion experienced markings to the sender using RTCP, verification of ECN functionality end-to-end, and procedures for how to initiate ECN usage.  Since the initiation process has some dependencies on the signalling mechanism used to establish the RTP session, a specification for signalling mechanisms using <a href="#RFC4566">Session Description Protocol (SDP)</a> <cite title="NONE">[RFC4566]</cite> is included.</p>
<p id="rfc.section.1.p.2">ECN is getting attention as a method to minimise the impact of congestion on real-time multimedia traffic. The use of ECN provides a way for the network to send a congestion control signal to a media transport without having to impair the media. Unlike packet loss, ECN signals unambiguously indicate congestion to the transport as quickly as feedback delays allow, and without confusing congestion with losses that might have occurred for other reasons such as transmission errors, packet-size errors, routing errors, badly implemented middleboxes, policy violations and so forth.</p>
<p id="rfc.section.1.p.3">The introduction of ECN into the Internet requires changes to both the network and transport layers. At the network layer, IP forwarding has to be updated to allow routers to mark packets, rather than discarding them in times of congestion <a href="#RFC3168">[RFC3168]</a>.  In addition, transport protocols have to be modified to inform the sender that ECN marked packets are being received, so it can respond to the congestion. The <a href="#RFC3168">Transmission Control Protocol (TCP)</a> <cite title="NONE">[RFC3168]</cite>, <a href="#RFC4960">Stream Control Transmission Protocol (SCTP)</a> <cite title="NONE">[RFC4960]</cite> and <a href="#RFC4340">Datagram Congestion Control Protocol (DCCP)</a> <cite title="NONE">[RFC4340]</cite> have been updated to support ECN, but to date there is no specification how UDP-based transports, such as <a href="#RFC3550">RTP</a> <cite title="NONE">[RFC3550]</cite>, can use ECN. This is due to the lack of feedback mechanisms directly in UDP. Instead the signaling control protocol on top of UDP needs to provide that feedback. For RTP that feedback is provided by RTCP.</p>
<p id="rfc.section.1.p.4">The remainder of this memo is structured as follows. We start by describing the conventions, definitions and acronyms used in this memo in <a href="#sec-2119">Section 2</a>, and the design rationale and applicability in <a href="#sec-rationale">Section 3</a>. <a href="#sec-overview">Section 4</a> gives an overview of how ECN is used with RTP over UDP. RTCP extensions for ECN feedback are defined in <a href="#sec-rtcp-ecn">Section 5</a>, and SDP signalling extensions in <a href="#sec-sdp-ext">Section 6</a>. The details of how ECN is used with RTP over UDP are defined in <a href="#sec-definition">Section 7</a>. In <a href="#sec-rtcp-translator-mixer">Section 8</a> we describe how ECN is handled in RTP translators and mixers. <a href="#sec-impl">Section 9</a> discusses some implementation considerations, <a href="#sec-iana">Section 10</a> lists IANA considerations, and <a href="#sec-security">Section 11</a> discusses security considerations.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#sec-2119" id="sec-2119">Conventions, Definitions and Acronyms</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<p id="rfc.section.2.p.2">Abbreviations and Definitions: </p>

<dl>
<dt>Sender:</dt>
<dd style="margin-left: 8">A sender of RTP packets carrying an encoded media stream. The sender can change how the media transmission is performed by varying the media coding or packetisation. It is one end-point of the ECN control loop.</dd>
<dt>Receiver:</dt>
<dd style="margin-left: 8">A receiver of RTP packets with the intention to consume the media stream. It sends RTCP feedback on the received stream. It is the other end-point of the ECN control loop.</dd>
<dt>ECN Capable Host:</dt>
<dd style="margin-left: 8">A sender or receiver of a media stream that is capable of setting and/or processing ECN marks.</dd>
<dt>ECN Capable Transport (ECT):</dt>
<dd style="margin-left: 8">A transport flow where both sender and receiver are ECN capable hosts. Packets sent by an ECN Capable Transport will be marked as ECT(0) or ECT(1) on transmission. See <a href="#RFC3168">[RFC3168]</a> for the definition of the ECT(0) and ECT(1) marks.</dd>
<dt>ECN-CE:</dt>
<dd style="margin-left: 8">ECN Congestion Experienced mark (see <a href="#RFC3168">[RFC3168]</a>).</dd>
<dt>ECN Capable Packets:</dt>
<dd style="margin-left: 8">Packets with ECN mark set to either ECT(0), ECT(1) or ECN-CE.</dd>
<dt>Not-ECT packets:</dt>
<dd style="margin-left: 8">Packets that are not sent by an ECN capable transport, and are not ECN-CE marked.</dd>
<dt>ECN Oblivious Relay:</dt>
<dd style="margin-left: 8">A router or middlebox that treats ECN Capable Packets no differently from Not-ECT packets.</dd>
<dt>ECN Capable Queue:</dt>
<dd style="margin-left: 8">A queue that supports ECN-CE marking of ECN-Capable Packets to indicate congestion.</dd>
<dt>ECN Blocking Middlebox:</dt>
<dd style="margin-left: 8">A middlebox that discards ECN-Capable Packets.</dd>
<dt>ECN Reverting Middlebox:</dt>
<dd style="margin-left: 8">A middlebox that changes ECN-Capable Packets to Not-ECT packets by removing the ECN mark.</dd>
</dl>
<p id="rfc.section.2.p.3">Note that RTP mixers or translators that operate in such a manner that they terminate or split the ECN control loop will take on the role of receivers or senders. This is further discussed in <a href="#sec-applicability">Section 3.2</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#sec-rationale" id="sec-rationale">Discussion, Requirements, and Design Rationale</a>
</h1>
<p id="rfc.section.3.p.1">ECN has been specified for use with <a href="#RFC3168">TCP</a> <cite title="NONE">[RFC3168]</cite>, <a href="#RFC4960">SCTP</a> <cite title="NONE">[RFC4960]</cite>, and <a href="#RFC4340">DCCP</a> <cite title="NONE">[RFC4340]</cite> transports. These are all unicast protocols which negotiate the use of ECN during the initial connection establishment handshake (supporting incremental deployment, and checking if ECN marked packets pass all middleboxes on the path). ECN-CE marks are immediately echoed back to the sender by the receiving end-point using an additional bit in feedback messages, and the sender then interprets the mark as equivalent to a packet loss for congestion control purposes.</p>
<p id="rfc.section.3.p.2">If RTP is run over TCP, SCTP, or DCCP, it can use the native ECN support provided by those protocols. This memo does not concern itself further with these use cases. However, RTP is more commonly run over UDP. This combination does not currently support ECN, and we observe that it has significant differences from the other transport protocols for which ECN has been specified. These include: </p>

<dl>
<dt>Signalling:</dt>
<dd style="margin-left: 8">RTP relies on separate signalling protocols to negotiate parameters before a session can be created, and doesn't include an in-band handshake or negotiation at session set-up time (i.e., there is no equivalent to the TCP three-way handshake in RTP).</dd>
<dt>Feedback:</dt>
<dd style="margin-left: 8">RTP does not explicitly acknowledge receipt of datagrams. Instead, the RTP Control Protocol (RTCP) provides reception quality feedback, and other back channel communication, for RTP sessions. The feedback interval is generally on the order of seconds, rather than once per network RTT (although the RTP/AVPF profile <a href="#RFC4585">[RFC4585]</a> allows more rapid feedback in most cases). RTCP is also very much oriented around counting packets, which makes byte counting congestion algorithms difficult to utilize.</dd>
<dt>Congestion Response:</dt>
<dd style="margin-left: 8">While it is possible to adapt the transmission of many audio/visual streams in response to network congestion, and such adaptation is required by <a href="#RFC3550">[RFC3550]</a>, the dynamics of the congestion response may be quite different to those of TCP or other transport protocols.</dd>
<dt>Middleboxes:</dt>
<dd style="margin-left: 8">The RTP framework explicitly supports the concept of mixers and translators, which are middleboxes that are involved in media transport functions.</dd>
<dt>Multicast:</dt>
<dd style="margin-left: 8">RTP is explicitly a group communication protocol, and was designed from the start to support IP multicast (primarily <a href="#RFC1112">Any Source Multicast (ASM)</a> <cite title="NONE">[RFC1112]</cite>, although a recent extension supports <a href="#RFC3569">Source Specific Multicast (SSM)</a> <cite title="NONE">[RFC3569]</cite> with unicast feedback <a href="#RFC5760">[RFC5760]</a>).</dd>
<dt>Application Awareness:</dt>
<dd style="margin-left: 8">When ECN support is provided within the transport protocol, the ability of the application to react to congestion is limited, since it has little visibility into the transport layer. By adding support of ECN to RTP using RTCP feedback, the application is made aware of congestion, allowing a wider range of reactions in response to that loss.</dd>
<dt>Counting vs Detecting Congestion:</dt>
<dd style="margin-left: 8">TCP and the protocols derived from it are mainly designed to respond the same whether they experience a burst of congestion indications within one RTT or just one. Whereas real-time applications may be concerned with the amount of congestion experienced, whether it is distributed smoothly or in bursts. When feedback of ECN was added to TCP <a href="#RFC3168">[RFC3168]</a>, the receiver was designed to flip the echo congestion experienced (ECE) flag to 1 for a whole RTT then flop it back to zero. Whereas ECN feedback in RTCP will need to report a count of how much congestion has been experienced within an RTCP reporting period, irrespective of round trip times.</dd>
</dl>

<p>These differences will significantly alter the shape of ECN support in RTP-over-UDP compared to ECN support in TCP, SCTP, and DCCP, but do not invalidate the need for ECN support.</p>
<p id="rfc.section.3.p.3">ECN support is more important for RTP sessions than, for instance, is the case for TCP. This is because the impact of packet loss in real-time audio-visual media flows is highly visible to users. Effective ECN support for RTP flows running over UDP will allow real-time audio-visual applications to respond to the onset of congestion before routers are forced to drop packets, allowing those applications to control how they reduce their transmission rate, and hence media quality, rather than responding to, and trying to conceal the effects of unpredictable packet loss. Furthermore, widespread deployment for ECN and active queue management in routers, should it occur, can potentially reduce unnecessary queueing delays in routers, lowering the round-trip time and benefiting interactive applications of RTP, such as voice telephony.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Requirements</h1>
<p id="rfc.section.3.1.p.1">Considering ECN, transport protocols supporting ECN, and RTP based applications one can create a set of requirements that must be satisfied to at least some degree if ECN is to used by RTP over UDP.  </p>

<ul>
<li>REQ 1: A mechanism MUST exist to negotiate and initiate the use of ECN for RTP/UDP/IP sessions so that an RTP sender will not send packets with ECT in the IP header unless it knows that all potential receivers will understand any ECN-CE indications they might receive.</li>
<li>REQ 2: A mechanism MUST exist to feed back the reception of any packets that are ECN-CE marked to the packet sender.</li>
<li>REQ 3: The provided mechanism SHOULD minimise the possibility of cheating (either by the sender or receiver).</li>
<li>REQ 4: Some detection and fallback mechanism SHOULD exist to avoid loss of communication due to the attempted usage of ECN in case an intermediate node clears ECT or drops packets that are ECT marked.</li>
<li>REQ 5: Negotiation of ECN SHOULD NOT significantly increase the time taken to negotiate and set-up the RTP session (an extra RTT before the media can flow is unlikely to be acceptable for some use cases).</li>
<li>REQ 6: Negotiation of ECN SHOULD NOT cause media clipping at the start of a session.</li>
</ul>
<p id="rfc.section.3.1.p.2">The following sections describes how these requirements can be met for RTP over UDP.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#sec-applicability" id="sec-applicability">Applicability</a>
</h1>
<p id="rfc.section.3.2.p.1">The use of ECN with RTP over UDP is dependent on negotiation of ECN capability between the sender and receiver(s), and validation of ECN support in all elements of the network path(s) traversed. RTP is used in a heterogeneous range of network environments and topologies, with various different signalling protocols. The mechanisms defined here make it possible to verify support for ECN in each of these environments, and irrespective of the topology.</p>
<p id="rfc.section.3.2.p.2">Due to the need for each RTP sender that intends to use ECN with RTP to track all participants in the RTP session, the sub-sampling of the group membership as specified by <a href="#RFC2762">"Sampling of the Group Membership in RTP"</a> <cite title="NONE">[RFC2762]</cite> MUST NOT be used.</p>
<p id="rfc.section.3.2.p.3">The use of ECN is further dependent on a capability of the RTP media flow to react to congestion signalled by ECN marked packets.  Depending on the application, media codec, and network topology, this adaptation can occur in various forms and at various nodes. As an example, the sender can change the media encoding, or the receiver can change the subscription to a layered encoding, or either reaction can be accomplished by a transcoding middlebox. RFC 5117 identifies seven topologies in which RTP sessions may be configured, and which may affect the ability to use ECN: </p>

<dl>
<dt>Topo-Point-to-Point:</dt>
<dd style="margin-left: 8">This utilises standard unicast flows. ECN may be used with RTP in this topology in an analogous manner to its use with other unicast transport protocols, with RTCP conveying ECN feedback messages.</dd>
<dt>Topo-Multicast:</dt>
<dd style="margin-left: 8">This is either an any source multicast (ASM) group <a href="#RFC3569">[RFC3569]</a> with potentially several active senders and multicast RTCP feedback, or a source specific multicast (SSM) group <a href="#RFC4607">[RFC4607]</a> with a single distribution source and unicast RTCP feedback from receivers. RTCP is designed to scale to large group sizes while avoiding feedback implosion (see Section 6.2 of <a href="#RFC3550">[RFC3550]</a>, <a href="#RFC4585">[RFC4585]</a>, and <a href="#RFC5760">[RFC5760]</a>), and can be used by a sender to determine if all its receivers, and the network paths to those receivers, support ECN (see <a href="#sec-initiation">Section 7.2</a>). It is somewhat more difficult to determine if all network paths from all senders to all receivers support ECN. Accordingly, we allow ECN to be used by an RTP sender using multicast UDP provided the sender has verified that the paths to all its known receivers support ECN, and irrespective of whether the paths from other senders to their receivers support ECN ("all its known receivers" are all the SSRCs that the RTP sender has received RTP or RTCP from the last five reporting intervals, i.e., they have not timed out). Note that group membership may change during the lifetime of a multicast RTP session, potentially introducing new receivers that are not ECN capable or have a path that doesn't support ECN. Senders must use the mechanisms described in <a href="#sec-ecn-failure">Section 7.4</a> to check that all receivers, and the network paths traversed to reach those receivers, continue to support ECN, and they need to fallback to non-ECN use if any receivers join that do not.</dd>
<dt></dt>
<dd style="margin-left: 8">SSM groups that uses <a href="#RFC5760">unicast RTCP feedback</a> <cite title="NONE">[RFC5760]</cite> do need a few extra considerations. This topology can have multiple media senders that provides traffic to the distribution source (DS) and are separated from the DS. There can also be multiple feedback targets. The requirement for using ECN for RTP in this topology is that the media sender must be provided the feedback from the receivers, it may be in aggregated form from the feedback targets. We will not mention this SSM use case in the below text specifically, but when actions are required by the media source, they do apply also to case of SSM where the RTCP feedback goes to the Feedback Target.</dd>
<dt></dt>
<dd style="margin-left: 8">This specification do support multicast, but has primarily considered smaller multicast groups and is not optimized for larger groups and their needs.</dd>
<dt>Topo-Translator:</dt>
<dd style="margin-left: 8">An RTP translator is an RTP-level middlebox that is invisible to the other participants in the RTP session (although it is usually visible in the associated signalling session). There are two types of RTP translator: those that do not modify the media stream, and are concerned with transport parameters, for example a multicast to unicast gateway; and those that do modify the media stream, for example transcoding between different media codecs. A single RTP session traverses the translator, and the translator must rewrite RTCP messages passing through it to match the changes it makes to the RTP data packets.  A legacy, ECN-unaware, RTP translator is expected to ignore the ECN bits on received packets, and to set the ECN bits to not-ECT when sending packets, so causing ECN negotiation on the path containing the translator to fail (any new RTP translator that does not wish to support ECN may do so similarly). An ECN aware RTP translator may act in one of three ways: <ul>
<li>If the translator does not modify the media stream, it should copy the ECN bits unchanged from the incoming to the outgoing datagrams, unless it is overloaded and experiencing congestion, in which case it may mark the outgoing datagrams with an ECN-CE mark. Such a translator passes RTCP feedback unchanged. See <a href="#sec-rtcp-trn-translator">Section 8.1</a>.</li>
<li>If the translator modifies the media stream to combine or split RTP packets, but does not otherwise transcode the media, it must manage the ECN bits in a way analogous to that described in Section 5.3 of <a href="#RFC3168">[RFC3168]</a>, see <a href="#sec-rtcp-ecn-translator">Section 8.2</a> for details.</li>
<li>If the translator is a media transcoder, or otherwise modifies the content of the media stream, the output RTP media stream may have radically different characteristics than the input RTP media stream. Each side of the translator must then be considered as a separate transport connection, with its own ECN processing. This requires the translator interpose itself into the ECN negotiation process, effectively splitting the connection into two parts with their own negotiation. Once negotiation has been completed, the translator must generate RTCP ECN feedback back to the source based on its own reception, and must respond to RTCP ECN feedback received from the receiver(s) (see <a href="#sec-rtcp-ecn-synthetic">Section 8.3</a>).</li>
</ul>
<p> It is recognised that ECN and RTCP processing in an RTP translator that modifies the media stream is non-trivial.</p>
</dd>
<dt>Topo-Mixer:</dt>
<dd style="margin-left: 8">A mixer is an RTP-level middlebox that aggregates multiple RTP streams, mixing them together to generate a new RTP stream. The mixer is visible to the other participants in the RTP session, and is also usually visible in the associated signalling session. The RTP flows on each side of the mixer are treated independently for ECN purposes, with the mixer generating its own RTCP ECN feedback, and responding to ECN feedback for data it sends. Since unicast transport between the mixer and any end-point are treated independently, it would seem reasonable to allow the transport on one side of the mixer to use ECN, while the transport on the other side of the mixer is not ECN capable, if this is desired. See <a href="#sec-rtcp-mixer">Section 8.4</a> for details in how mixers should process ECN.</dd>
<dt>Topo-Video-switch-MCU:</dt>
<dd style="margin-left: 8">A video switching MCU receives several RTP flows, but forwards only one of those flows onwards to the other participants at a time. The flow that is forwarded changes during the session, often based on voice activity. Since only a subset of the RTP packets generated by a sender are forwarded to the receivers, a video switching MCU can break ECN negotiation (the success of the ECN negotiation may depend on the voice activity of the participant at the instant the negotiation takes place - shout if you want ECN). It also breaks congestion feedback and response, since RTP packets are dropped by the MCU depending on voice activity rather than network congestion. This topology is widely used in legacy products, but is NOT RECOMMENDED for new implementations and SHALL NOT be used with ECN.</dd>
<dt>Topo-RTCP-terminating-MCU:</dt>
<dd style="margin-left: 8">In this scenario, each participant runs an RTP point-to-point session between itself and the MCU. Each of these sessions is treated independently for the purposes of ECN and RTCP feedback, potentially with some using ECN and some not.</dd>
<dt>Topo-Asymmetric:</dt>
<dd style="margin-left: 8">It is theoretically possible to build a middlebox that is a combination of an RTP mixer in one direction and an RTP translator in the other. To quote RFC 5117 "This topology is so problematic and it is so easy to get the RTCP processing wrong, that it is NOT RECOMMENDED to implement this topology."</dd>
</dl>

<p> These topologies may be combined within a single RTP session.</p>
<p id="rfc.section.3.2.p.4">The ECN mechanism defined in this memo is applicable to both sender and receiver controlled congestion algorithms. The mechanism ensures that both senders and receivers will know about ECN-CE markings and any packet losses. Thus the actual decision point for the congestion control is not relevant. This is a great benefit as the rate of an RTP session can be varied in a number of ways, for example a unicast media sender might use TFRC <a href="#RFC5348">[RFC5348]</a> or some other algorithm, while a multicast session could use a sender based scheme adapting to the lowest common supported rate, or a receiver driven mechanism using layered coding to support more heterogeneous paths.</p>
<p id="rfc.section.3.2.p.5">To ensure timely feedback of ECN-CE marked packets when needed, this mechanism requires support for the RTP/AVPF profile <a href="#RFC4585">[RFC4585]</a> or any of its derivatives, such as RTP/SAVPF <a href="#RFC5124">[RFC5124]</a>. The standard RTP/AVP profile <a href="#RFC3551">[RFC3551]</a> does not allow any early or immediate transmission of RTCP feedback, and has a minimal RTCP interval whose default value (5 seconds) is many times the normal RTT between sender and receiver.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> Interoperability</h1>
<p id="rfc.section.3.3.p.1">The interoperability requirements for this specification are that there is at least one common interoperability point for all implementations. Since initialization using RTP and RTCP (<a href="#sec-rtp-init-ecn">Section 7.2.1</a>) is the one method that works in all cases, although is not optimal for all uses, it is selected as mandatory to implement this initialisation method. This method requires both the RTCP XR extension and the ECN feedback format, which require the RTP/AVPF profile to ensure timely feedback.</p>
<p id="rfc.section.3.3.p.2">When one considers all the uses of ECN for RTP it is clear that there exist congestion control mechanisms that are receiver driven <a href="#sec-congestion">only</a> <cite title="NONE">[sec-congestion]</cite>. These congestion control mechanism do not require timely feedback of congestion events to the sender. If such a congestion control mechanism is combined with an initialization method that also doesn't require timely feedback using RTCP, like the leap of faith or the ICE based method then neither the ECN feedback format nor the RTP/AVPF profile would appear to be needed. However, fault detection can be greatly improved by using receiver side detection (<a href="#sec-fallback">Section 7.4.1</a>) and early reporting of such cases using the ECN feedback mechanism.</p>
<p id="rfc.section.3.3.p.3">For interoperability we mandate the implementation of the RTP/AVPF profile, with both RTCP extensions and the necessary signalling to support a common operations mode. This specification recommends the use of RTP/AVPF in all cases as negotiation of the common interoperability point requires RTP/AVPF, mixed negotiation of RTP/AVP and RTP/AVPF depending on other SDP attributes in the same media block is difficult, and the fact that fault detection can be improved when using RTP/AVPF.</p>
<p id="rfc.section.3.3.p.4">The use of the ECN feedback format is also recommended, but cases exist where its use is not required due to no need for timely feedback. These will be explicitly noted using the term "no timely feedback required", and generally occur in combination with receiver driven congestion control, and with the leap-of-faith and ICE-based initialization methods. We also note that any receiver driven congestion control solution that still requires RTCP for signalling of any adaptation information to the sender will still require RTP/AVPF for timeliness.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#sec-overview" id="sec-overview">Overview of Use of ECN with RTP/UDP/IP</a>
</h1>
<p id="rfc.section.4.p.1">The solution for using ECN with RTP over UDP/IP consists of four different pieces that together make the solution work:</p>
<p></p>

<ol>
<li>Negotiation of the capability to use ECN with RTP/UDP/IP</li>
<li>Initiation and initial verification of ECN capable transport</li>
<li>Ongoing use of ECN within an RTP session</li>
<li>Handling of dynamic behavior through failure detection, verification and fallback</li>
</ol>
<p id="rfc.section.4.p.3">Before an RTP session can be created, a signalling protocol is used to negotiate or at least configure session parameters (see <a href="#sec-signalling">Section 7.1</a>). In some topologies the signalling protocol can also be used to discover the other participants. One of the parameters that must be agreed is the capability of a participant to support ECN. Note that all participants having the capability of supporting ECN does not necessarily imply that ECN is usable in an RTP session, since there may be middleboxes on the path between the participants which don't pass ECN-marked packets (for example, a firewall that blocks traffic with the ECN bits set). This document defines the information that needs to be negotiated, and provides a mapping to SDP for use in both declarative and offer/answer contexts.</p>
<p id="rfc.section.4.p.4">When a sender joins a session for which all participants claim to support ECN, it must verify if that support is usable. There are three ways in which this verification can be done: </p>

<ul>
<li>The sender may generate a (small) subset of its RTP data packets with the ECN field set to ECT(0) or ECT(1). Each receiver will then send an RTCP feedback packet indicating the reception of the ECT marked RTP packets. Upon reception of this feedback from each receiver it knows of, the sender can consider ECN functional for its traffic. Each sender does this verification independently. When a new receiver joins an existing RTP session, it will send RTCP reports in the usual manner. If those RTCP reports include ECN information, verification will have succeeded and sources can continue to send ECT packets. If not, verification fails and each sender MUST stop using ECN (see <a href="#sec-rtp-init-ecn">Section 7.2.1</a> for details).</li>
<li>Alternatively, ECN support can be verified during an initial end-to-end STUN exchange (for example, as part of ICE connection establishment). After having verified connectivity without ECN capability an extra STUN exchange, this time with the ECN field set to ECT(0) or ECT(1), is performed on the candidate path that is about to be used. If successful the path's capability to convey ECN marked packets is verified. A new STUN attribute is defined to convey feedback that the ECT marked STUN request was received (see <a href="#sec-stun-init-ecn">Section 7.2.2</a>), along with an ICE signalling option (<a href="#sec-ice-ecn">Section 6.4</a>) to indicate that the check is to be performed.</li>
<li>Thirdly, the sender may make a leap of faith that ECN will work.  This is only recommended for applications that know they are running in controlled environments where ECN functionality has been verified through other means. In this mode it is assumed that ECN works, and the system reacts to failure indicators if the assumption proved wrong. The use of this method relies on a high confidence that ECN operation will be successful, or an application where failure is not serious. The impact on the network and other users must be considered when making a leap of faith, so there are limitations on when this method is allowed (see <a href="#sec-leap-init-ecn">Section 7.2.3</a>).</li>
</ul>

<p>The first mechanism, using RTP with RTCP feedback, has the advantage of working for all RTP sessions, but the disadvantages of potential clipping if ECN marked RTP packets are discarded by middleboxes, and slow verification of ECN support. The STUN-based mechanism is faster to verify ECN support, but only works in those scenarios supported by end-to-end STUN, such as within an ICE exchange.  The third one, leap-of-faith, has the advantage of avoiding additional tests or complexities and enabling ECN usage from the first media packet. The downside is that if the end-to-end path contains middleboxes that do not pass ECN, the impact on the application can be severe: in the worst case, all media could be lost if a middlebox that discards ECN marked packets is present. A less severe effect, but still requiring reaction, is the presence of a middlebox that re-marks ECT marked packets to non-ECT, possibly marking packets with an ECN-CE mark as non-ECT. This could result in increased levels of congestion due to non-responsiveness, and impact media quality as applications end up relying on packet loss as an indication of congestion.</p>
<p id="rfc.section.4.p.5">Once ECN support has been verified (or assumed) to work for all receivers, a sender marks all its RTP packets as ECT packets, while receivers rapidly feed back reports on any ECN-CE marks to the sender using RTCP in RTP/AVPF immediate or early feedback mode, unless no timely feedback is required. Each feedback report indicates the receipt of new ECN-CE marks since the last ECN feedback packet, and also counts the total number of ECN-CE marked packets as a cumulative sum. This is the mechanism to provide the fastest possible feedback to senders about ECN-CE marks. On receipt of an ECN-CE marked packet, the system must react to congestion as-if packet loss has been reported. <a href="#sec-ongoing">Section 7.3</a> describes the ongoing use of ECN within an RTP session.</p>
<p id="rfc.section.4.p.6">This rapid feedback is not optimised for reliability, so another mechanism, RTCP XR ECN summary reports, is used to ensure more reliable, but less timely, reporting of the ECN information. The ECN summary report contains the same information as the ECN feedback format, only packed differently for better efficiency with reports for many sources.  It is sent in a compound RTCP packet, along with regular RTCP reception reports. By using cumulative counters for observed ECN-CE, ECT, not-ECT, packet duplication, and packet loss the sender can determine what events have happened since the last report, independently of any RTCP packets having been lost.</p>
<p id="rfc.section.4.p.7">RTCP reports MUST NOT be ECT marked, since ECT marked traffic may be dropped if the path is not ECN compliant. RTCP is used to provide feedback about what has been transmitted and what ECN markings that are received, so it is important that it is received in cases when ECT marked traffic is not getting through.</p>
<p id="rfc.section.4.p.8">There are numerous reasons why the path the RTP packets take from the sender to the receiver may change, e.g., mobility, link failure followed by re-routing around it. Such an event may result in the packet being sent through a node that is ECN non-compliant, thus re-marking or dropping packets with ECT set. To prevent this from impacting the application for longer than necessary, the operation of ECN is constantly monitored by all senders (<a href="#sec-ecn-failure">Section 7.4</a>). Both the RTCP XR ECN summary reports and the ECN feedback packets allow the sender to compare the number of ECT(0), ECT(1), and non-ECT marked packets received with the number that were sent, while also reporting ECN-CE marked and lost packets. If these numbers do not agree, it can be inferred that the path does not reliably pass ECN-marked packets. A sender detecting a possible ECN non-compliance issue should then stop sending ECT marked packets to determine if that allows the packets to be correctly delivered. If the issues can be connected to ECN, then ECN usage is suspended.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#sec-rtcp-ecn" id="sec-rtcp-ecn">RTCP Extensions for ECN feedback</a>
</h1>
<p id="rfc.section.5.p.1">This memo defines two new RTCP extensions: one RTP/AVPF <a href="#RFC4585">[RFC4585]</a> transport layer feedback format for urgent ECN information, and one RTCP XR <a href="#RFC3611">[RFC3611]</a> ECN summary report block type for regular reporting of the ECN marking information.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#sec-rtcp-ecn-fb" id="sec-rtcp-ecn-fb">RTP/AVPF Transport Layer ECN Feedback packet</a>
</h1>
<p id="rfc.section.5.1.p.1">This RTP/AVPF transport layer feedback format is intended for use in RTP/AVPF early or immediate feedback modes when information needs to urgently reach the sender. Thus its main use is to report reception of an ECN-CE marked RTP packet so that the sender may perform congestion control, or to speed up the initiation procedures by rapidly reporting that the path can support ECN-marked traffic. The feedback format is also defined with <a href="#RFC5506">reduced size RTCP</a> <cite title="NONE">[RFC5506]</cite> in mind, where RTCP feedback packets may be sent without accompanying Sender or Receiver Reports that would contain the Extended Highest Sequence number and the accumulated number of packet losses. Both are important for ECN to verify functionality and keep track of when CE marking does occur.</p>
<p id="rfc.section.5.1.p.2">The RTP/AVPF transport layer feedback packet starts with the common header defined by the <a href="#RFC4585">RTP/AVPF profile</a> <cite title="NONE">[RFC4585]</cite> which is reproduced in <a href="#fig-avpf-common">Figure 1</a>. The FMT field takes the value [TBA1] to indicate that the Feedback Control Information (FCI) contains ECN Feedback report, as defined in <a href="#fig-ecn-feedback">Figure 2</a>.</p>
<div id="#rfc.figure.1"></div>
<div id="#fig-avpf-common"></div>
<pre>
 0                   1                   2                   3   
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|V=2|P| FMT=TBA1|  PT=RTPFB=205 |          length               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  SSRC of packet sender                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  SSRC of media source                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:            Feedback Control Information (FCI)                 :
:                                                               :
</pre>
<div id="#rfc.figure.2"></div>
<div id="#fig-ecn-feedback"></div>
<pre>
 0                   1                   2                   3   
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Extended Highest Sequence Number                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| ECT (0) Counter                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| ECT (1) Counter                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| ECN-CE Counter                | not-ECT Counter               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Loss Packet Counter           | Duplication Counter           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.5.1.p.3">The ECN Feedback Report contains the following fields:</p>
<p></p>

<dl>
<dt>Extended Highest Sequence Number:</dt>
<dd style="margin-left: 8">The 32-bit Extended highest sequence number received, as defined by <a href="#RFC3550">[RFC3550]</a>. Indicates the highest RTP sequence number to which this report relates.</dd>
<dt>ECT(0) Counter:</dt>
<dd style="margin-left: 8">The 32-bit cumulative number of RTP packets with ECT(0) received from this SSRC.</dd>
<dt>ECT(1) Counter:</dt>
<dd style="margin-left: 8">The 32-bit cumulative number of RTP packets with ECT(1) received from this SSRC.</dd>
<dt>ECN-CE Counter:</dt>
<dd style="margin-left: 8">The cumulative number of RTP packets received from this SSRC since the receiver joined the RTP session that were ECN-CE marked, including ECN-CE marks in any duplicate packets. The receiver should keep track of this value using a local representation that is at least 32-bits, and only include the 16-bits with least significance. In other words, the field will wrap if more than 65535 ECN-CE marked packets have been received.</dd>
<dt>not-ECT Counter:</dt>
<dd style="margin-left: 8">The cumulative number of RTP packets received from this SSRC since the receiver joined the RTP session that had an ECN field value of not-ECT. The receiver should keep track of this value using a local representation that is at least 32-bits, and only include the 16-bits with least significance. In other words, the field will wrap if more than 65535 not-ECT packets have been received.</dd>
<dt>Lost Packets Counter:</dt>
<dd style="margin-left: 8">The cumulative number of RTP packets that the receiver expected to receive minus the number of packets it actually received that are not a duplicate of an already received packet, from this SSRC since the receiver joined the RTP session. Note that packets that arrive late are not counted as lost. The receiver should keep track of this value using a local representation that is at least 32-bits, and only include the 16-bits with least significance. In other words, the field will wrap if more than 65535 packets are lost.</dd>
<dt>Duplication Counter:</dt>
<dd style="margin-left: 8">The cumulative number of RTP packets received that are a duplicate of an already received packet from this SSRC since the receiver joined the RTP session.  The receiver should keep track of this value using a local representation that is at least 32-bits, and only include the 16-bits with least significance. In other words, the field will wrap if more than 65535 duplicate packets have been received.</dd>
</dl>

<p>All fields in the ECN Feedback Report are unsigned integers in network byte order. Each ECN Feedback Report corresponds to a single RTP source (SSRC). Multiple sources can be reported by including multiple ECN Feedback Reports packets in an compound RTCP packet.</p>
<p id="rfc.section.5.1.p.5">The counters SHALL be initiated to 0 for each new SSRC received.  This to enable detection of ECN-CE marks or Packet loss on the initial report from a specific participant.</p>
<p id="rfc.section.5.1.p.6">The use of at least 32-bit counters allows even extremely high packet volume applications to not have wrapping of counters within any timescale close to the RTCP reporting intervals. However, 32-bits are not sufficiently large to disregard the fact that wrappings may happen during the life time of a long-lived RTP session. Thus handling of wrapping of these counters MUST be supported. It is recommended that implementations uses local representation of these counters that are longer than 32-bits to enable easy handling of wraps.</p>
<p id="rfc.section.5.1.p.7">There is a difference in packet duplication reports between the packet loss counter that is defined in the <a href="#RFC3550">Receiver Report Block</a> <cite title="NONE">[RFC3550]</cite> and that defined here. To avoid holding state for what RTP sequence numbers have been received, <a href="#RFC3550">[RFC3550]</a> specifies that one can count packet loss by counting the number of received packets and comparing it to the number of packets expected. As a result a packet duplication can hide a packet loss. However, when populating the ECN Feedback report, a receiver needs to track the sequence numbers actually received and count duplicates and packet loss separately to provide a more reliable indication. Reordering may however still result in that packet loss is reported in one report and then removed in the next.</p>
<p id="rfc.section.5.1.p.8">The ECN-CE counter is robust for packet duplication. Adding each received ECN-CE marked packet to the counter is not an issue, in fact it is required to ensure complete tracking of the ECN state. If one of the clones was ECN-CE marked that is still an indication of congestion. Packet duplication has potential impact on the ECN verification and thus there is a need to count the duplicates.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#sec-ecn-summary-report" id="sec-ecn-summary-report">RTCP XR Report block for ECN summary information</a>
</h1>
<p id="rfc.section.5.2.p.1">This unilateral XR report block combined with RTCP SR or RR report blocks carries the same information as the ECN Feedback Report and is be based on the same underlying information. However, the ECN Feedback Report is intended to report on an ECN-CE mark as soon as possible, while this extended report is for the regular RTCP reporting and continuous verification of the ECN functionality end-to-end.</p>
<p id="rfc.section.5.2.p.2">The ECN Summary report block consists of one RTCP XR report block header, shown in <a href="#fig-xr-header">Figure 3</a> followed by one or more ECN summary report data blocks, as defined in <a href="#fig-xr-ecn-summary">Figure 4</a>.</p>
<div id="#rfc.figure.3"></div>
<div id="#fig-xr-header"></div>
<pre>
 0                   1                   2                   3   
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    BT=[TBA2]  | Reserved      |         Block Length          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre>
<p></p>
<div id="#rfc.figure.4"></div>
<div id="#fig-xr-ecn-summary"></div>
<pre>
 0                   1                   2                   3   
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| SSRC of Media Sender                                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| ECT (0) Counter                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| ECT (1) Counter                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| ECN-CE Counter                | not-ECT Counter               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Loss Packet Counter           | Duplication Counter           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.5.2.p.4">The RTCP XR ECN Summary Report contains the following fields:</p>
<p></p>

<dl>
<dt>BT:</dt>
<dd style="margin-left: 8">Block Type identifying the ECN summary report block. Value is [TBA2].</dd>
<dt>Reserved:</dt>
<dd style="margin-left: 8">All bits SHALL be set to 0 on transmission and ignored on reception.</dd>
<dt>Block Length:</dt>
<dd style="margin-left: 8">The length of the report block. Used to indicate the number of report data blocks present in the ECN summary report. This length will be 5*n, where n is the number of ECN summary report blocks, since blocks are a fixed size. The block length MAY be zero if there is nothing to report. Receivers MUST discard reports where the block length is not a multiple of five octets, since these cannot be valid.</dd>
<dt>SSRC of Media Sender:</dt>
<dd style="margin-left: 8">The SSRC identifying the media sender this report is for.</dd>
<dt>ECT(0) Counter:</dt>
<dd style="margin-left: 8">as in <a href="#sec-rtcp-ecn-fb">Section 5.1</a>.</dd>
<dt>ECT(1) Counter:</dt>
<dd style="margin-left: 8">as in <a href="#sec-rtcp-ecn-fb">Section 5.1</a>.</dd>
<dt>ECN-CE Counter:</dt>
<dd style="margin-left: 8">as in <a href="#sec-rtcp-ecn-fb">Section 5.1</a>.</dd>
<dt>not-ECT Counter:</dt>
<dd style="margin-left: 8">as in <a href="#sec-rtcp-ecn-fb">Section 5.1</a>.</dd>
<dt>Loss Packet Counter:</dt>
<dd style="margin-left: 8">as in <a href="#sec-rtcp-ecn-fb">Section 5.1</a>.</dd>
<dt>Duplication Counter:</dt>
<dd style="margin-left: 8">as in <a href="#sec-rtcp-ecn-fb">Section 5.1</a>.</dd>
</dl>
<p id="rfc.section.5.2.p.6">The Extended Highest Sequence number counter for each SSRC is not present in RTCP XR report, in contrast to the feedback version. The reason is that this summary report will rely on the information sent in the Sender Report (SR) or Receiver Report (RR) blocks part of the same RTCP compound packet. The Extended Highest Sequence number is available from the SR or RR.</p>
<p id="rfc.section.5.2.p.7">All the SSRCs that are present in the SR or RR SHOULD also be included in the RTCP XR ECN summary report. In cases where the number of senders are so large that the combination of SR/RR and the ECN summary for all the senders exceed the MTU, then only a subset of the senders SHOULD be included so that the reports for the subset fits within the MTU. The subsets SHOULD be selected round-robin across multiple intervals so that all sources are periodically reported. In case there are no SSRCs that currently are counted as senders in the session, the report block SHALL still be sent with no report block entry and a zero report block length to continuously indicate to the other participants the receiver capability to report ECN information.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#sec-sdp-ext" id="sec-sdp-ext">SDP Signalling Extensions for ECN</a>
</h1>
<p id="rfc.section.6.p.1">This section defines a number of SDP signalling extensions used in the negotiation of the ECN for RTP support when using SDP. This includes one SDP attribute "ecn-capable-rtp" that negotiates the actual operation of ECN for RTP. Two SDP signalling parameters are defined to indicate the use of the RTCP XR ECN summary block and the RTP/AVPF feedback format for ECN. One ICE option SDP representation is also defined.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#sec-sdp-ecn" id="sec-sdp-ecn">Signalling ECN Capability using SDP</a>
</h1>
<p id="rfc.section.6.1.p.1">One new SDP attribute, "a=ecn-capable-rtp", is defined. This is a media level attribute, and MUST NOT be used at the session level. It is not subject to the character set chosen. The aim of this signalling is to indicate the capability of the sender and receivers to support ECN, and to negotiate the method of ECN initiation to be used in the session. The attribute takes a list of initiation methods, ordered in decreasing preference. The defined values for the initiation method are:</p>
<p></p>

<dl>
<dt>rtp:</dt>
<dd style="margin-left: 8">Using RTP and RTCP as defined in <a href="#sec-rtp-init-ecn">Section 7.2.1</a>.</dd>
<dt>ice:</dt>
<dd style="margin-left: 8">Using STUN within ICE as defined in <a href="#sec-stun-init-ecn">Section 7.2.2</a>.</dd>
<dt>leap:</dt>
<dd style="margin-left: 8">Using the leap of faith method as defined in <a href="#sec-leap-init-ecn">Section 7.2.3</a>.</dd>
</dl>
<p id="rfc.section.6.1.p.3">Further methods may be specified in the future, so unknown methods MUST be ignored upon reception.</p>
<p id="rfc.section.6.1.p.4">In addition, a number of OPTIONAL parameters may be included in the "a=ecn-capable-rtp" attribute as follows:</p>
<p></p>

<dl>
<dt>mode:</dt>
<dd style="margin-left: 8">This parameter signals the endpoint's capability to set and read ECN marks in UDP packets. An examination of various operating systems has shown that end-system support for ECN marking of UDP packets may be symmetric or asymmetric. By this we mean that some systems may allow end points to set the ECN bits in an outgoing UDP packet but not read them, while others may allow applications to read the ECN bits but not set them. This either/or case may produce an asymmetric support for ECN and thus should be conveyed in the SDP signalling. The "mode=setread" state is the ideal condition where an endpoint can both set and read ECN bits in UDP packets. The "mode=setonly" state indicates that an endpoint can set the ECT bit, but cannot read the ECN bits from received UDP packets to determine if upstream congestion occurred. The "mode=readonly" state indicates that the endpoint can read the ECN bits to determine if congestion has occurred for incoming packets, but it cannot set the ECT bits in outgoing UDP packets. When the "mode=" parameter is omitted it is assumed that the node has "setread" capabilities. This option can provide for an early indication that ECN cannot be used in a session. This would be case when both the offerer and answerer set the "mode=" parameter to "setonly" or both set it to "readonly".</dd>
<dt>ect:</dt>
<dd style="margin-left: 8">This parameter makes it possible to express the preferred ECT marking. This is either "random", "0", or "1", with "0" being implied if not specified. The "ect" parameter describes a receiver preference, and is useful in the case where the receiver knows it is behind a link using IP header compression, the efficiency of which would be seriously disrupted if it were to receive packets with randomly chosen ECT marks. It is RECOMMENDED that ECT(0) marking be used.</dd>
</dl>
<p id="rfc.section.6.1.p.6">The <a href="#RFC5234">ABNF</a> <cite title="NONE">[RFC5234]</cite> grammar for the "a=ecn-capable-rtp" attribute is shown in <a href="#fig.abnf">Figure 5</a>.</p>
<div id="#rfc.figure.5"></div>
<div id="#fig.abnf"></div>
<pre>   ecn-attribute  = "a=ecn-capable-rtp:" SP init-list [SP parm-list]
   init-list      = init-value *("," init-value)
   init-value     = "rtp" / "ice" / "leap" / init-ext
   init-ext       = token
   parm-list      = parm-value *(";" SP parm-value)
   parm-value     = mode / ect / parm-ext
   mode           = "mode=" ("setonly" / "setread" / "readonly")
   ect            = "ect=" ("0" / "1" / "random")
   parm-ext       = parm-name "=" parm-value-ext
   parm-name      = token
   parm-value-ext = token / quoted-string
   quoted-string  = DQUOTE *qdtext DQUOTE
   qdtext         = %x20-21 / %x23-7E / %x80-FF  
                    ; any 8-bit ASCII except &lt;"&gt;

   ; external references:
     ; token: from RFC 4566
     ; SP and DQUOTE from RFC 5234</pre>
<p></p>
<h1 id="rfc.section.6.1.1">
<a href="#rfc.section.6.1.1">6.1.1.</a> Use of "a=ecn-capable-rtp:" with the Offer/Answer Model</h1>
<p id="rfc.section.6.1.1.p.1">When SDP is used with the offer/answer model <a href="#RFC3264">[RFC3264]</a>, the party generating the SDP offer MUST insert an "a=ecn-capable-rtp" attribute into the media section of the SDP offer of each RTP session for which it wishes to use ECN.  The attribute includes one or more ECN initiation methods in a comma separated list in decreasing order of preference, with any number of optional parameters following. The answering party compares the list of initiation methods in the offer with those it supports in order of preference. If there is a match, and if the receiver wishes to attempt to use ECN in the session, it includes an "a=ecn-capable-rtp" attribute containing its single preferred choice of initiation method, and any optional parameters, in the media sections of the answer. If there is no matching initiation method capability, or if the receiver does not wish to attempt to use ECN in the session, it does not include an "a=ecn-capable-rtp" attribute in its answer. If the attribute is removed in the answer then ECN MUST NOT be used in any direction for that media flow. If there are initialization methods that are unknown, they MUST be ignored on reception and MUST NOT be included in an answer.</p>
<p id="rfc.section.6.1.1.p.2">The endpoints' capability to set and read ECN marks, as expressed by the optional "mode=" parameter, determines whether ECN support can be negotiated for flows in one or both directions:</p>
<p></p>

<ul>
<li>If the "mode=setonly" parameter is present in the "a=ecn-capable-rtp" attribute of the offer and the answering party is also "mode=setonly", then there is no common ECN capability, and the answer MUST NOT include the "a=ecn-capable-rtp" attribute. Otherwise, if the offer is "mode=setonly" then ECN may only be initiated in the direction from the offering party to the answering party.</li>
<li>If the "mode=readonly" parameter is present in the "a=ecn-capable-rtp" attribute of the offer and the answering party is "mode=readonly", then there is no common ECN capability, and the answer MUST NOT include the "a=ecn-capable-rtp" attribute. Otherwise, if the offer is "mode=readonly" then ECN may only be initiated in the direction from the answering party to the offering party.</li>
<li>If the "mode=setread" parameter is present in the "a=ecn-capable-rtp" attribute of the offer and the answering party is "setonly", then ECN may only be initiated in the direction from the answering party to the offering party. If the offering party is "mode=setread" but the answering party is "mode=readonly", then ECN may only be initiated in the direction from the offering party to the answering party. If both offer and answer are "mode=setread", then ECN may be initiated in both directions. Note that "mode=setread" is implied by the absence of a "mode=" parameter in the offer or the answer.</li>
<li>An offer that does not include a "mode=" parameter MUST be treated as-if a "mode=setread" parameter had been included.</li>
</ul>
<p id="rfc.section.6.1.1.p.4">In an RTP session using multicast and ECN, participants that intend to send RTP packets SHOULD support setting ECT marks in RTP packets (i.e., should be "mode=setonly" or "mode=setread").  Participants receiving data need the capability to read ECN marks on incoming packets. It is important that receivers can read ECN marks (are "mode=readonly" or "mode=setread"), since otherwise no sender in the multicast session will be able to enable ECN. Accordingly, receivers that are "mode=setonly" SHOULD NOT join multicast RTP sessions that use ECN. If session participants that are not aware of the ECN for RTP signalling are invited to a multicast session, and simply ignore the signalling attribute, the other party in the offer/answer exchange SHOULD terminate the SDP dialogue so that the participant leaves the session.</p>
<p id="rfc.section.6.1.1.p.5">The "ect=" parameter in the "a=ecn-capable-rtp" attribute is set independently in the offer and the answer. Its value in the offer indicates a preference for the sending behaviour of the answering party, and its value in the answer indicates a sending preference for the behaviour of the offering party. It will be the senders choice to honour the receivers preference for what to receive or not. In multicast sessions, all senders SHOULD set the ECT marks using the value declared in the "ect=" parameter.</p>
<p id="rfc.section.6.1.1.p.6">Unknown optional parameters MUST be ignored on reception, and MUST NOT be included in the answer. That way new parameters may be introduced and verified to be supported by the other end-point by having them include it in any answer.</p>
<h1 id="rfc.section.6.1.2">
<a href="#rfc.section.6.1.2">6.1.2.</a> Use of "a=ecn-capable-rtp:" with Declarative SDP</h1>
<p id="rfc.section.6.1.2.p.1">When SDP is used in a declarative manner, for example in a multicast session using the Session Announcement Protocol (SAP, <a href="#RFC2974">[RFC2974]</a>), negotiation of session description parameters is not possible. The "a=ecn-capable-rtp" attribute MAY be added to the session description to indicate that the sender will use ECN in the RTP session. The attribute MUST include a single method of initiation. Participants MUST NOT join such a session unless they have the capability to receive ECN-marked UDP packets, implement the method of initiation, and can generate RTCP ECN feedback. The mode parameter MAY also be included in declarative usage, to indicate the minimal capability is required by the consumer of the SDP. So for example in a SSM session the participants configured with a particular SDP will all be in a media receive only mode, thus mode=readonly will work as the capability of reporting on the ECN markings in the received is what is required.  However, using "mode=readonly" also in ASM sessions is reasonable, unless all senders are required to attempt to use ECN for their outgoing RTP data traffic, in which case the mode needs to be set to "setread".</p>
<h1 id="rfc.section.6.1.3">
<a href="#rfc.section.6.1.3">6.1.3.</a> General Use of the "a=ecn-capable-rtp:" Attribute</h1>
<p id="rfc.section.6.1.3.p.1">The "a=ecn-capable-rtp" attribute MAY be used with RTP media sessions using UDP/IP transport. It MUST NOT be used for RTP sessions using TCP, SCTP, or DCCP transport, or for non-RTP sessions.</p>
<p id="rfc.section.6.1.3.p.2">As described in <a href="#sec-congestion">Section 7.3.3</a>, RTP sessions using ECN require rapid RTCP ECN feedback, unless timely feedback is not required due to a receiver driven congestion control. To ensure that the sender can react to ECN-CE marked packets timely feedback is usually required. Thus, the use of the Extended RTP Profile for RTCP-Based Feedback (RTP/AVPF) <a href="#RFC4585">[RFC4585]</a> or other profile that inherits RTP/AVPF's signalling rules, MUST be signalled unless timely feedback is not required. If timely feedback is not required it is still RECOMMENDED to use RTP/AVPF. The signalling of an RTP/AVPF based profile is likely to be required even if the preferred method of initialization and the congestion control does not require timely feedback, as the common interoperable method is likely to be signalled or the improved fault reaction is desired.</p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#sec-fb-sdp-par" id="sec-fb-sdp-par">RTCP ECN Feedback SDP Parameter</a>
</h1>
<p id="rfc.section.6.2.p.1">A new "nack" feedback parameter "ecn" is defined to indicate the usage of the RTCP ECN feedback packet <a href="#sec-rtcp-ecn-fb">format</a> <cite title="NONE">[sec-rtcp-ecn-fb]</cite>. The ABNF <a href="#RFC5234">[RFC5234]</a> definition of the SDP parameter extension is:</p>
<div id="#rfc.figure.6"></div>
<pre>rtcp-fb-nack-param  = &lt;See section 4.2 of RFC 4585&gt;
rtcp-fb-nack-param /= ecn-fb-par
ecn-fb-par          = SP "ecn"
</pre>
<p id="rfc.section.6.2.p.2">The offer/answer rules for this SDP feedback parameters are specified in the <a href="#RFC4585">RTP/AVPF profile</a> <cite title="NONE">[RFC4585]</cite>.</p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#sec-xr-sdp-par" id="sec-xr-sdp-par">XR Block ECN SDP Parameter</a>
</h1>
<p id="rfc.section.6.3.p.1">A new unilateral RTCP XR block for ECN summary information is specified, thus the XR block SDP signalling also needs to be extended with a parameter. This is done in the same way as for the other XR blocks. The XR block SDP attribute as defined in Section 5.1 of the <a href="#RFC3611">RTCP XR specification</a> <cite title="NONE">[RFC3611]</cite> is defined to be extensible. As no parameter values are needed for this ECN summary block, this parameter extension consists of a simple parameter name used to indicate support and intent to use the XR block.</p>
<div id="#rfc.figure.7"></div>
<pre>xr-format       = &lt;See Section 5.1 of [RFC3611]&gt;
xr-format      /= ecn-summary-par
ecn-summary-par = "ecn-sum"
</pre>
<p id="rfc.section.6.3.p.2">For SDP declarative and offer/answer usage, see the <a href="#RFC3611">RTCP XR specification</a> <cite title="NONE">[RFC3611]</cite> and its description of how to handle unilateral parameters.</p>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> <a href="#sec-ice-ecn" id="sec-ice-ecn">ICE Parameter to Signal ECN Capability</a>
</h1>
<p id="rfc.section.6.4.p.1">One new ICE <a href="#RFC5245">[RFC5245]</a> option, "rtp+ecn", is defined. This is used with the SDP session level "a=ice-options" attribute in an SDP offer to indicate that the initiator of the ICE exchange has the capability to support ECN for RTP-over-UDP flows (via "a=ice-options: rtp+ecn"). The answering party includes this same attribute at the session level in the SDP answer if it also has the capability, and removes the attribute if it does not wish to use ECN, or doesn't have the capability to use ECN. If the ICE initiation method (<a href="#sec-stun-init-ecn">Section 7.2.2</a>) is actually going to be used, it is also needs to be explicitly negotiated using the "a=ecn-capable-rtp" attribute. This ICE option SHALL be included when the ICE initiation method is offered or declared in the SDP.</p>
<p></p>

<ul class="empty"><li>Note: This signalling mechanism is not strictly needed as long as the STUN ECN testing capability is used within the context of this document. It may however be useful if the ECN verification capability is used in additional contexts.</li></ul>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#sec-definition" id="sec-definition">Use of ECN with RTP/UDP/IP</a>
</h1>
<p id="rfc.section.7.p.1">In the detailed specification of the behaviour below, the different functions in the general case will first be discussed. In case special considerations are needed for middleboxes, multicast usage etc, those will be specially discussed in related subsections.</p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#sec-signalling" id="sec-signalling">Negotiation of ECN Capability</a>
</h1>
<p id="rfc.section.7.1.p.1">The first stage of ECN negotiation for RTP-over-UDP is to signal the capability to use ECN. An RTP system that supports ECN and uses SDP for its signalling MUST implement the SDP extension to signal ECN capability as described in <a href="#sec-sdp-ecn">Section 6.1</a>, the RTCP ECN feedback SDP parameter defined in <a href="#sec-fb-sdp-par">Section 6.2</a>, and the XR Block ECN SDP parameter defined in <a href="#sec-xr-sdp-par">Section 6.3</a>. It MAY also implement alternative ECN capability negotiation schemes, such as the ICE extension described in <a href="#sec-ice-ecn">Section 6.4</a>. Other signalling systems will need to define signalling parameters corresponding to those defined for SDP.</p>
<p id="rfc.section.7.1.p.2">The "ecn-capable-rtp" SDP attribute MUST be used when employing ECN for RTP according to this specification in systems using SDP. As the RTCP XR ECN summary report is required independently of the initialization method or congestion control scheme, the "rtcp-xr" attribute with the "ecn-sum" parameter MUST also be used. The "rtcp-fb" attribute with the "nack" parameter "ecn" MUST be used whenever the initialization method or a congestion control algorithm requires timely sender side knowledge of received CE markings. If the congestion control scheme requires additional signalling, this should be indicated as appropriate.</p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> <a href="#sec-initiation" id="sec-initiation">Initiation of ECN Use in an RTP Session</a>
</h1>
<p id="rfc.section.7.2.p.1">Once the sender and the receiver(s) have agreed that they have the capability to use ECN within a session, they may attempt to initiate ECN use. All session participants connected over the same transport MUST use the same initiation method. RTP mixers or translators can use different initiation methods to different participants that are connected over different underlying transports. The mixer or translator will need to do individual signalling with each participant to ensure it is consistent with the ECN support in those cases where it does not function as one end-point for the ECN control loop.</p>
<p id="rfc.section.7.2.p.2">At the start of the RTP session, when the first packets with ECT are sent, it is important to verify that IP packets with ECN field values of ECT or ECN-CE will reach their destination(s). There is some risk that the use of ECN will result in either reset of the ECN field, or loss of all packets with ECT or ECN-CE markings. If the path between the sender and the receivers exhibits either of these behaviours one needs to stop using ECN immediately to protect both the network and the application.</p>
<p id="rfc.section.7.2.p.3">The RTP senders and receivers SHALL NOT ECT mark their RTCP traffic at any time. This is to ensure that packet loss due to ECN marking will not effect the RTCP traffic and the necessary feedback information it carries.</p>
<p id="rfc.section.7.2.p.4">An RTP system that supports ECN MUST implement the initiation of ECN using in-band RTP and RTCP described in <a href="#sec-rtp-init-ecn">Section 7.2.1</a>. It MAY also implement other mechanisms to initiate ECN support, for example the STUN-based mechanism described in <a href="#sec-stun-init-ecn">Section 7.2.2</a>, or use the leap of faith option if the session supports the limitations provided in <a href="#sec-leap-init-ecn">Section 7.2.3</a>. If support for both in-band and out-of-band mechanisms are signalled, the sender when negotiating SHOULD offer detection of ECT using STUN with ICE with higher priority than detection of ECT using RTP and RTCP.</p>
<p id="rfc.section.7.2.p.5">No matter how ECN usage is initiated, the sender MUST continually monitor the ability of the network, and all its receivers, to support ECN, following the mechanisms described in <a href="#sec-ecn-failure">Section 7.4</a>. This is necessary because path changes or changes in the receiver population may invalidate the ability of the system to use ECN.</p>
<h1 id="rfc.section.7.2.1">
<a href="#rfc.section.7.2.1">7.2.1.</a> <a href="#sec-rtp-init-ecn" id="sec-rtp-init-ecn">Detection of ECT using RTP and RTCP</a>
</h1>
<p id="rfc.section.7.2.1.p.1">The ECN initiation phase using RTP and RTCP to detect if the network path supports ECN comprises three stages. Firstly, the RTP sender generates some small fraction of its traffic with ECT marks to act as probe for ECN support. Then, on receipt of these ECT-marked packets, the receivers send RTCP ECN feedback packets and RTCP ECN summary reports to inform the sender that their path supports ECN. Finally, the RTP sender makes the decision to use ECN or not, based on whether the paths to all RTP receivers have been verified to support ECN.</p>
<p></p>

<dl>
<dt>Generating ECN Probe Packets:</dt>
<dd style="margin-left: 8">During the ECN initiation phase, an RTP sender SHALL mark a small fraction of its RTP traffic as ECT, while leaving the reminder of the packets unmarked. The main reason for only marking some packets is to maintain usable media delivery during the ECN initiation phase in those cases where ECN is not supported by the network path. A secondary reason to send some not-ECT packets are to ensure that the receivers will send RTCP reports on this sender, even if all ECT marked packets are lost in transit. The not-ECT packets also provide a base-line to compare performance parameters against. A fourth reason for only probing with a small number of packets is to reduce the risk that significant numbers of congestion markings might be lost if ECT is cleared to Not-ECT by an ECN-Reverting Middlebox. Then any resulting lack of congestion response is likely to have little damaging effect on others. An RTP sender is RECOMMENDED to send a minimum of two packets with ECT markings per RTCP reporting interval. In case a random ECT pattern is intended to be used, at least one packet with ECT(0) and one with ECT(1) should be sent per reporting interval; in case a single ECT marking is to be used, only that ECT value SHOULD be sent. The RTP sender SHALL continue to send some ECT marked traffic as long as the ECN initiation phase continues. The sender SHOULD NOT mark all RTP packets as ECT during the ECN initiation phase.</dd>
<dt></dt>
<dd style="margin-left: 8">This memo does not mandate which RTP packets are marked with ECT during the ECN initiation phase. An implementation should insert ECT marks in RTP packets in a way that minimises the impact on media quality if those packets are lost. The choice of packets to mark is clearly very media dependent, but the use of RTP <a href="#I-D.ietf-avt-rtp-no-op">NO-OP payloads</a> <cite title="NONE">[I-D.ietf-avt-rtp-no-op]</cite>, if supported, would be an appropriate choice. For audio formats, if would make sense for the sender to mark comfort noise packets or similar. For video formats, packets containing P- or B-frames (rather than I-frames) would be an appropriate choice. No matter which RTP packets are marked, those packets MUST NOT be sent in duplicate, with and without ECT, since the RTP sequence number is used to identify packets that are received with ECN markings.</dd>
<dt>Generating RTCP ECN Feedback:</dt>
<dd style="margin-left: 8">If ECN capability has been negotiated in an RTP session, the receivers in the session MUST listen for ECT or ECN-CE marked RTP packets, and generate RTCP ECN feedback packets (<a href="#sec-rtcp-ecn-fb">Section 5.1</a>) to mark their receipt. An immediate or early (depending on the RTP/AVPF mode) ECN feedback packet SHOULD be generated on receipt of the first ECT or ECN-CE marked packet from a sender that has not previously sent any ECT traffic. Each regular RTCP report MUST also contain an ECN summary report (<a href="#sec-ecn-summary-report">Section 5.2</a>).  Reception of subsequent ECN-CE marked packets MUST result in additional early or immediate ECN feedback packets being sent unless no timely feedback is required.</dd>
<dt>Determination of ECN Support:</dt>
<dd style="margin-left: 8">RTP is a group communication protocol, where members can join and leave the group at any time. This complicates the ECN initiation phase, since the sender must wait until it believes the group membership has stabilised before it can determine if the paths to all receivers support ECN (group membership changes after the ECN initiation phase has completed are discussed in <a href="#sec-ongoing">Section 7.3</a>).</dd>
<dt></dt>
<dd style="margin-left: 8">An RTP sender shall consider the group membership to be stable after it has been in the session and sending ECT-marked probe packets for at least three RTCP reporting intervals (i.e., after sending its third regularly scheduled RTCP packet), and when a complete RTCP reporting interval has passed without changes to the group membership. ECN initiation is considered successful when the group membership is stable, and all known participants have sent one or more RTCP ECN feedback packets or RTCP XR ECN summary reports indicating correct receipt of the ECT-marked RTP packets generated by the sender.</dd>
<dt></dt>
<dd style="margin-left: 8">As an optimisation, if an RTP sender is initiating ECN usage towards a unicast address, then it MAY treat the ECN initiation as provisionally successful if it receives an RTCP ECN feedback report or an RTCP XR ECN summary report indicating successful receipt of the ECT-marked packets, with no negative indications, from a single RTP receiver (where a single RTP receiver is considered as all SSRCs used by a single RTCP CNAME). After declaring provisional success, the sender MAY generate ECT-marked packets as described in <a href="#sec-ongoing">Section 7.3</a>, provided it continues to monitor the RTCP reports for a period of three RTCP reporting intervals from the time the ECN initiation started, to check if there are any other participants in the session. Thus as long as any additional SSRC that report on the ECN usage are using the same RTCP CNAME as the previous reports and they are all indicating functional ECN the sender may continue. If other participants are detected, i.e., other RTCP CNAMEs, the sender MUST fallback to only ECT-marking a small fraction of its RTP packets, while it determines if ECN can be supported following the full procedure described above. Different RTCP CNAMEs received over an unicast transport may occur when using translators in a multi-party RTP session (e.g., when using a centralised conference bridge). <ul class="empty"><li>Note: The above optimization supports peer to peer unicast transport with several SSRCs multiplexed onto the same flow (e.g., a single participant with two video cameras, or <a href="#RFC4588">SSRC multiplexed RTP retransmission</a> <cite title="NONE">[RFC4588]</cite>). It is desirable to be able to rapidly negotiate ECN support for such a session, but the optimisation above can fail if there are implementations that use the same CNAME for different parts of a distributed implementation that have different transport characteristics (e.g., if a single logical endpoint is split across multiple hosts).</li></ul>
</dd>
<dt></dt>
<dd style="margin-left: 8">ECN initiation is considered to have failed at the instant the initiating RTP sender received an RTCP packet that doesn't contain an RTCP ECN feedback report or ECN summary report from any RTP session participant that has an RTCP RR with an extended RTP sequence number field that indicates that it should have received multiple (&gt;3) ECT marked RTP packets. This can be due to failure to support the ECN feedback format by the receiver or some middlebox, or the loss of all ECT marked packets. Both indicate a lack of ECN support.</dd>
</dl>
<p id="rfc.section.7.2.1.p.3">If the ECN negotiation succeeds, this indicates that the path can pass some ECN-marked traffic, and that the receivers support ECN feedback. This does not necessarily imply that the path can robustly convey ECN feedback; <a href="#sec-ongoing">Section 7.3</a> describes the ongoing monitoring that must be performed to ensure the path continues to robustly support ECN.</p>
<p id="rfc.section.7.2.1.p.4">When a sender or receiver detects ECN failures on paths they should log these to enable follow up and statistics gathering regarding broken paths. The logging mechanism used is implementation dependent.</p>
<h1 id="rfc.section.7.2.2">
<a href="#rfc.section.7.2.2">7.2.2.</a> <a href="#sec-stun-init-ecn" id="sec-stun-init-ecn">Detection of ECT using STUN with ICE</a>
</h1>
<p id="rfc.section.7.2.2.p.1">This section describes an OPTIONAL method that can be used to avoid media impact and also ensure an ECN capable path prior to media transmission. This method is considered in the context where the session participants are using <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite> to find working connectivity. We need to use ICE rather than STUN only, as the verification needs to happen from the media sender to the address and port on which the receiver is listening.</p>
<p id="rfc.section.7.2.2.p.2">Note that this method is only applicable to sessions when the remote destinations are unicast addresses. In addition, transport translators that do not terminate the ECN control loop and may distribute received packets to more than one other receiver must either disallow this method (and use the RTP/RTCP method instead), or implement additional handling as discussed below. This is because the ICE initialization method verifies the underlying transport to one particular address and port. If the receiver at that address and port intends to use the received packets in a multi-point session then the tested capabilities and the actual session behavior are not matched.</p>
<p id="rfc.section.7.2.2.p.3">To minimise the impact of set-up delay, and to prioritise the fact that one has a working connectivity rather than necessarily finding the best ECN capable network path, this procedure is applied after having performed a successful connectivity check for a candidate, which is nominated for usage. At that point an additional connectivity check is performed, sending the "ECN Check" attribute in a STUN packet that is ECT marked. On reception of the packet, a STUN server supporting this extension will note the received ECN field value, and send a STUN/UDP/IP packet in reply with the ECN field set to not-ECT and including an ECN check attribute. A STUN server that doesn't understand the extension, or is incapable of reading the ECN values on incoming STUN packets, should follow the rule in the STUN specification for unknown comprehension-optional attributes, and ignore the attribute, resulting in the sender receiving a STUN response without the ECN Check STUN attribute.</p>
<p id="rfc.section.7.2.2.p.4">The ECN STUN checks can be lost on the path, for example due to the ECT marking, but also various other non ECN related reasons causing packet loss. The goal is to detect when the ECT markings are rewritten or if it is the ECT marking that causes packet loss so that the path can be determined as not ECT. Other reasons for packet loss should not result in a failure to verify the path as ECT.  Therefore a number of retransmissions should be attempted. But, the sender of ECN STUN checks will also have to set a criteria for when it gives up testing for ECN capability on the path. As the ICE agent have successfully verified the path a RTT measurement for this path can be performed. To have high probability of succesfully verifying the path it is RECOMMENDED that the client retransmitt the ECN STUN check 4 times. The interval between the retransmissions will be based on the Ta timer as defined in Section 16.1 for RTP Media Streams in <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite>. The number of ECN STUN checks needing to be sent will depend on the number of ECN capable flows (N) that is to be established. The interval between each transmission of an ECN check packet MUST be Ta. In other words for a given flow being verified for ECT the RTO is set to Ta*N. The transmission for that flow is stopped when an ECN Check STUN response has been received, which don't indicate to retransmit the request due to temporary error, the maximum number of retransmissions has been sent. The ICE agent is recommended to give up on the ECN verification MAX(1.5*RTT, 20 ms) after the last ECN STUN check was sent.</p>
<p id="rfc.section.7.2.2.p.5">The STUN ECN check attribute contains one field and a flag, as shown in <a href="#fig-ECN-Check">Figure 8</a>. The flag indicates whether the echo field contains a valid value or not. The field is the ECN echo field, and when valid contains the two ECN bits from the packet it echoes back. The ECN check attribute is a comprehension optional attribute.</p>
<div id="#rfc.figure.8"></div>
<div id="#fig-ECN-Check"></div>
<pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |         Type                  |            Length             |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |           Reserved                                      |ECF|V|
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p></p>
<p></p>

<dl>
<dt>V:</dt>
<dd style="margin-left: 8">Valid (1 bit) ECN Echo value field is valid when set to 1, and invalid when set 0.</dd>
<dt>ECF:</dt>
<dd style="margin-left: 8">ECN Echo value field (2 bits) contains the ECN field value of the STUN packet it echoes back when field is valid. If invalid the content is arbitrary.</dd>
<dt>Reserved:</dt>
<dd style="margin-left: 8">Reserved bits (29 bits) SHALL be set to 0 on transmission, and SHALL be ignored on reception.</dd>
</dl>

<p>This attribute MAY be included in any STUN request to request the ECN field to be echoed back. In STUN requests the V bit SHALL be set to 0. A compliant STUN server receiving a request with the ECN Check attribute SHALL read the ECN field value of the IP/UDP packet the request was received in. Upon forming the response the server SHALL include the ECN Check attribute setting the V bit to valid and include the read value of the ECN field into the ECF field. If the STUN responder was unable to ascertain, due to temporary errors, the ECN value of the STUN request, it SHALL set the V bit in the response to 0. The STUN client may retry immediately.</p>
<p id="rfc.section.7.2.2.p.8">The ICE based initialization method does require some special consideration when used by a translator. This is especially for transport translators and translators that fragment or reassemble packets, since they do not separate the ECN control loops between the end-points and the translator. When using ICE-based initiation, such a translator must ensure that any participants joining an RTP session for which ECN has been negotiated are successfully verified in the direction from the translator to the joining participant.  Alternatively, it must correctly handle remarking of ECT RTP packets towards that participant. When a new participant joins the session, the translator will perform a check towards the new participant. If that is successfully completed the ECT properties of the session are maintained for the other senders in the session. If the check fails then the existing senders will now see a participant that fails to receive ECT. Thus the failure detection in those senders will eventually detect this. However to avoid misusing the network on the path from the translator to the new participant, the translator SHALL remark the traffic intended to be forwarded from ECT to non-ECT. Any packet intended to be forward that are ECN-CE marked SHALL be discard and not sent. In cases where the path from a new participant to the translator fails the ECT check then only that sender will not contribute any ECT marked traffic towards the translator.</p>
<h1 id="rfc.section.7.2.3">
<a href="#rfc.section.7.2.3">7.2.3.</a> <a href="#sec-leap-init-ecn" id="sec-leap-init-ecn">Leap of Faith ECT initiation method</a>
</h1>
<p id="rfc.section.7.2.3.p.1">This method for initiating ECN usage is a leap of faith that assumes that ECN will work on the used path(s). The method is to go directly to "ongoing use of ECN" as defined in <a href="#sec-ongoing">Section 7.3</a>. Thus all RTP packets MAY be marked as ECT and the failure detection MUST be used to detect any case when the assumption that the path was ECT capable is wrong. This method is only recommended for controlled environments where the whole path(s) between sender and receiver(s) has been built and verified to be ECT.</p>
<p id="rfc.section.7.2.3.p.2">If the sender marks all packets as ECT while transmitting on a path that contains an ECN-blocking middlebox, then receivers downstream of that middlebox will not receive any RTP data packets from the sender, and hence will not consider it to be an active RTP SSRC. The sender can detect this and revert to sending packets without ECT marks, since RTCP SR/RR packets from such receivers will either not include a report for sender's SSRC, or will report that no packets have been received, but this takes at least one RTCP reporting interval. It should be noted that a receiver might generate its first RTCP packet immediately on joining a unicast session, or very shortly after joining a RTP/AVPF session, before it has had chance to receive any data packets. A sender that receives RTCP SR/RR packet indicating lack of reception by a receiver SHOULD therefore wait for a second RTCP report from that receiver to be sure that the lack of reception is due to ECT-marking. Since this recovery process can take several tens of seconds, during which time the RTP session is unusable for media, it is NOT RECOMMENDED that the leap-of-faith ECT initiation method be used in environments where ECN-blocking middleboxes are likely to be present.</p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> <a href="#sec-ongoing" id="sec-ongoing">Ongoing Use of ECN Within an RTP Session</a>
</h1>
<p id="rfc.section.7.3.p.1">Once ECN has been successfully initiated for an RTP sender, that sender begins sending all RTP data packets as ECT-marked, and its receivers send ECN feedback information via RTCP packets. This section describes procedures for sending ECT-marked data, providing ECN feedback information via RTCP, and responding to ECN feedback information.</p>
<h1 id="rfc.section.7.3.1">
<a href="#rfc.section.7.3.1">7.3.1.</a> Transmission of ECT-marked RTP Packets</h1>
<p id="rfc.section.7.3.1.p.1">After a sender has successfully initiated ECN use, it SHOULD mark all the RTP data packets it sends as ECT. The sender SHOULD mark packets as ECT(0) unless the receiver expresses a preference for ECT(1) or random using the "ect" parameter in the "a=ecn-capable-rtp" attribute.</p>
<p id="rfc.section.7.3.1.p.2">The sender SHALL NOT include ECT marks on outgoing RTCP packets, and SHOULD NOT include ECT marks on any other outgoing control messages (e.g., <a href="#RFC5389">STUN</a> <cite title="NONE">[RFC5389]</cite> packets, <a href="#RFC4347">DTLS</a> <cite title="NONE">[RFC4347]</cite> handshake packets, or <a href="#RFC6189">ZRTP</a> <cite title="NONE">[RFC6189]</cite> control packets) that are multiplexed on the same UDP port. For control packets there might be exceptions, like the STUN based ECN check defined in <a href="#sec-stun-init-ecn">Section 7.2.2</a>.</p>
<h1 id="rfc.section.7.3.2">
<a href="#rfc.section.7.3.2">7.3.2.</a> Reporting ECN Feedback via RTCP</h1>
<p id="rfc.section.7.3.2.p.1">An RTP receiver that receives a packet with an ECN-CE mark, or that detects a packet loss, MUST schedule the transmission of an RTCP ECN feedback packet as soon as possible (subject to the constraints of <a href="#RFC4585">[RFC4585]</a> and <a href="#RFC3550">[RFC3550]</a>) to report this back to the sender unless no timely feedback is required. The feedback RTCP packet SHALL consist of at least one ECN feedback packet (<a href="#sec-rtcp-ecn-fb">Section 5.1</a>) reporting on the packets received since the last ECN feedback packet, and will contain (at least) an RTCP SR/RR packet and an SDES packet, unless <a href="#RFC5506">reduced size RTCP</a> <cite title="NONE">[RFC5506]</cite> is used. The RTP/AVPF profile in early or immediate feedback mode SHOULD be used where possible, to reduce the interval before feedback can be sent. To reduce the size of the feedback message, reduced size RTCP <a href="#RFC5506">[RFC5506]</a> MAY be used if supported by the end-points.  Both RTP/AVPF and reduced size RTCP MUST be negotiated in the session set-up signalling before they can be used.</p>
<p id="rfc.section.7.3.2.p.2">Every time a regular compound RTCP packet is to be transmitted, an ECN-capable RTP receiver MUST include an RTCP XR ECN summary report as described in <a href="#sec-ecn-summary-report">Section 5.2</a> as part of the compound packet.</p>
<p id="rfc.section.7.3.2.p.3">The multicast feedback implosion problem, that occurs when many receivers simultaneously send feedback to a single sender, must be considered. The RTP/AVPF transmission rules will limit the amount of feedback that can be sent, avoiding the implosion problem but also delaying feedback by varying degrees from nothing up to a full RTCP reporting interval. As a result, the full extent of a congestion situation may take some time to reach the sender, although some feedback should arrive in a reasonably timely manner, allowing the sender to react on a single or a few reports.</p>
<h1 id="rfc.section.7.3.3">
<a href="#rfc.section.7.3.3">7.3.3.</a> <a href="#sec-congestion" id="sec-congestion">Response to Congestion Notifications</a>
</h1>
<p id="rfc.section.7.3.3.p.1">The reception of RTP packets with ECN-CE marks in the IP header is a notification that congestion is being experienced. The default reaction on the reception of these ECN-CE marked packets MUST be to provide the congestion control algorithm with a congestion notification that triggers the algorithm to react as if packet loss had occurred. There should be no difference in congestion response if ECN-CE marks or packet drops are detected.</p>
<p id="rfc.section.7.3.3.p.2">We note that there MAY be other reactions to ECN-CE specified in the future. Such an alternative reaction MUST be specified and considered to be safe for deployment under any restrictions specified. A potential example for an alternative reaction could be emergency communications (such as that generated by first responders, as opposed to the general public) in networks where the user has been authorized. A more detailed description of these other reactions, as well as the types of congestion control algorithms used by end-nodes, is outside of the scope of this document.</p>
<p id="rfc.section.7.3.3.p.3">Depending on the media format, type of session, and RTP topology used, there are several different types of congestion control that can be used:</p>
<p></p>

<dl>
<dt>Sender-Driven Congestion Control:</dt>
<dd style="margin-left: 8">The sender is responsible for adapting the transmitted bit-rate in response to RTCP ECN feedback. When the sender receives the ECN feedback data it feeds this information into its congestion control or bit-rate adaptation mechanism so that it can react as if packet loss was reported. The congestion control algorithm to be used is not specified here, although TFRC <a href="#RFC5348">[RFC5348]</a> is one example that might be used.</dd>
<dt>Receiver-Driven Congestion Control:</dt>
<dd style="margin-left: 8">In a receiver driven congestion control mechanism, the receivers can react to the ECN-CE marks themselves without providing ECN-CE feedback to the sender. This may allow faster response than sender-driven congestion control in some circumstances and also scale to large number of receivers and multicast usage. One example of receiver-driven congestion control is implemented by providing the content in a layered way, with each layer providing improved media quality but also increased bandwidth usage. The receiver locally monitors the ECN-CE marks on received packets to check if it experiences congestion with the current number of layers.  If congestion is experienced, the receiver drops one layer, so reducing the resource consumption on the path towards itself.  For example, if a layered media encoding scheme such as H.264 SVC is used, the receiver may change its layer subscription, and so reduce the bit rate it receives. The receiver MUST still send RTCP XR ECN Summary to the sender, even if it can adapt without contact with the sender, so that the sender can determine if ECN is supported on the network path. The timeliness of RTCP feedback is less of a concern with receiver driven congestion control, and regular RTCP reporting of ECN summary information is sufficient (without using RTP/AVPF immediate or early feedback).</dd>
<dt>Hybrid:</dt>
<dd style="margin-left: 8">There might be mechanisms that utilize both some receiver behaviors and some sender side monitoring, thus requiring both feedback of congestion events to the sender and taking receiver decisions and possible signalling to the sender. In this case the congestion control algorithm needs to use the signalling to indicate which features of ECN for RTP are required.</dd>
</dl>
<p id="rfc.section.7.3.3.p.5">Responding to congestion indication in the case of multicast traffic is a more complex problem than for unicast traffic. The fundamental problem is diverse paths, i.e., when different receivers don't see the same path, and thus have different bottlenecks, so the receivers may get ECN-CE marked packets due to congestion at different points in the network. This is problematic for sender driven congestion control, since when receivers are heterogeneous in regards to capacity, the sender is limited to transmitting at the rate the slowest receiver can support. This often becomes a significant limitation as group size grows. Also, as group size increases the frequency of reports from each receiver decreases, which further reduces the responsiveness of the mechanism.  Receiver-driven congestion control has the advantage that each receiver can choose the appropriate rate for its network path, rather than all receivers having to settle for the lowest common rate.</p>
<p id="rfc.section.7.3.3.p.6">We note that ECN support is not a silver bullet to improving performance. The use of ECN gives the chance to respond to congestion before packets are dropped in the network, improving the user experience by allowing the RTP application to control how the quality is reduced. An application which ignores ECN Congestion Experienced feedback is not immune to congestion: the network will eventually begin to discard packets if traffic doesn't respond. It is in the best interest of an application to respond to ECN congestion feedback promptly, to avoid packet loss.</p>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> <a href="#sec-ecn-failure" id="sec-ecn-failure">Detecting Failures</a>
</h1>
<p id="rfc.section.7.4.p.1">Senders and receivers can deliberately ignore ECN-CE and thus get a benefit over behaving flows (cheating). Th ECN Nonce <a href="#RFC3540">[RFC3540]</a> is an addition to TCP that attempts to solve this issue as long as the sender acts on behalf of the network. The assumption about the senders acting on the behalf of the network may be reduced due to the nature of peer-to-peer use of RTP. Still a significant portion of RTP senders are infrastructure devices (for example, streaming media servers) that do have an interest in protecting both service quality and the network. Even though there may be cases where nonce can be applicable also for RTP, it is not included in this specification. This as a receiver interested in cheating would simple claim to not support nonce, or even ECN itself.  It is, however, worth mentioning that, as real-time media is commonly sensitive to increased delay and packet loss, it will be in both the media sender and receivers interest to minimise the number and duration of any congestion events as they will adversely affect media quality.</p>
<p id="rfc.section.7.4.p.2">RTP sessions can also suffer from path changes resulting in a non-ECN compliant node becoming part of the path. That node may perform either of two actions that has effect on the ECN and application functionality. The gravest is if the node drops packets with the ECN field set to ECT(0), ECT(1), or ECN-CE. This can be detected by the receiver when it receives an RTCP SR packet indicating that a sender has sent a number of packets that it has not received.  The sender may also detect such a middlebox based on the receiver's RTCP RR packet, when the extended sequence number is not advanced due to the failure to receive packets. If the packet loss is less than 100%, then packet loss reporting in either the ECN feedback information or RTCP RR will indicate the situation. The other action is to re-mark a packet from ECT or ECN-CE to not-ECT. That has less dire results, however it should be detected so that ECN usage can be suspended to prevent misusing the network.</p>
<p id="rfc.section.7.4.p.3">The RTCP XR ECN summary packet and the ECN feedback packet allow the sender to compare the number of ECT marked packets of different types received with the number it actually sent. The number of ECT packets received, plus the number of ECN-CE marked and lost packets, should correspond to the number of sent ECT marked packets plus the number of received duplicates. If these numbers doesn't agree there are two likely reasons, a translator changing the stream or not carrying the ECN markings forward, or that some node re-marks the packets. In both cases the usage of ECN is broken on the path. By tracking all the different possible ECN field values a sender can quickly detect if some non-compliant behavior is happening on the path.</p>
<p id="rfc.section.7.4.p.4">Thus packet losses and non-matching ECN field value statistics are possible indication of issues with using ECN over the path. The next section defines both sender and receiver reactions to these cases.</p>
<h1 id="rfc.section.7.4.1">
<a href="#rfc.section.7.4.1">7.4.1.</a> <a href="#sec-fallback" id="sec-fallback">Fallback mechanisms</a>
</h1>
<p id="rfc.section.7.4.1.p.1">Upon the detection of a potential failure, both the sender and the receiver can react to mitigate the situation.</p>
<p id="rfc.section.7.4.1.p.2">A receiver that detects a packet loss burst MAY schedule an early feedback packet that includes at least the RTCP RR and the ECN feedback message to report this to the sender. This will speed up the detection of the loss at the sender, thus triggering sender side mitigation.</p>
<p id="rfc.section.7.4.1.p.3">A sender that detects high packet loss rates for ECT-marked packets SHOULD immediately switch to sending packets as not-ECT to determine if the losses are potentially due to the ECT markings. If the losses disappear when the ECT-marking is discontinued, the RTP sender should go back to initiation procedures to attempt to verify the apparent loss of ECN capability of the used path. If a re-initiation fails then the two possible actions exist:</p>
<p></p>

<ol>
<li>Periodically retry the ECN initiation to detect if a path change occurs to a path that is ECN capable.</li>
<li>Renegotiate the session to disable ECN support. This is a choice that is suitable if the impact of ECT probing on the media quality is noticeable. If multiple initiations have been successful, but the following full usage of ECN has resulted in the fallback procedures, then disabling of the ECN support is RECOMMENDED.</li>
</ol>

<p>We foresee the possibility of flapping ECN capability due to several reasons: video switching MCU or similar middleboxes that selects to deliver media from the sender only intermittently; load balancing devices may in worst case result in that some packets take a different network path than the others; mobility solutions that switch underlying network path in a transparent way for the sender or receiver; and membership changes in a multicast group. It is however appropriate to mention that there are also issues such as re-routing of traffic due to a flappy route table or excessive reordering and other issues that are not directly ECN related but nevertheless may cause problems for ECN.</p>
<h1 id="rfc.section.7.4.2">
<a href="#rfc.section.7.4.2">7.4.2.</a> <a href="#sec-interpret" id="sec-interpret">Interpretation of ECN Summary information</a>
</h1>
<p id="rfc.section.7.4.2.p.1">This section contains discussion on how the ECN summary report information can be used to detect various types of ECN path issues.  We first review the information the RTCP reports provide on a per source (SSRC) basis:</p>
<p></p>

<dl>
<dt>ECN-CE Counter:</dt>
<dd style="margin-left: 8">The number of RTP packets received so far in the session with an ECN field set to CE.</dd>
<dt>ECT (0/1) Counters:</dt>
<dd style="margin-left: 8">The number of RTP packets received so far in the session with an ECN field set to ECT (0) and ECT (1) respectively.</dd>
<dt>not-ECT Counter:</dt>
<dd style="margin-left: 8">The number of RTP packets received so far in the session with an ECN field set to not-ECT.</dd>
<dt>Lost Packets counter:</dt>
<dd style="margin-left: 8">The number of RTP packets that where expected based on sequence numbers but never received.</dd>
<dt>Duplication Counter:</dt>
<dd style="margin-left: 8">The number of received RTP packets that are duplicates of already received ones.</dd>
<dt>Extended Highest Sequence number:</dt>
<dd style="margin-left: 8">The highest sequence number seen when sending this report, but with additional bits, to handle disambiguation when wrapping the RTP sequence number field.</dd>
</dl>

<p>The counters will be initialised to zero to provide value for the RTP stream sender from the first report. After the first report, the changes between the last received report and the previous report are determined by simply taking the values of the latest minus the previous, taking wrapping into account. This definition is also robust to packet losses, since if one report is missing, the reporting interval becomes longer, but is otherwise equally valid.</p>
<p id="rfc.section.7.4.2.p.3">In a perfect world, the number of not-ECT packets received should be equal to the number sent minus the lost packets counter, and the sum of the ECT(0), ECT(1), and ECN-CE counters should be equal to the number of ECT marked packet sent. Two issues may cause a mismatch in these statistics: severe network congestion or unresponsive congestion control might cause some ECT-marked packets to be lost, and packet duplication might result in some packets being received, and counted in the statistics, multiple times (potentially with a different ECN-mark on each copy of the duplicate).</p>
<p id="rfc.section.7.4.2.p.4">The rate of packet duplication is tracked, allowing one to take the duplication into account. The value of the ECN field for duplicates will also be counted and when comparing the figures one needs to take some fraction of packet duplicates that are non-ECT and some fraction of packet duplicates being ECT into account into the calculation. Thus when only sending non-ECT then the number of sent packets plus reported duplicates equals the number of received non-ECT. When sending only ECT then number of sent ECT packets plus duplicates will equal ECT(0), ECT(1), ECN-CE and packet loss. When sending a mix of non-ECT and ECT then there is an uncertainty if any duplicate or packet loss was an non-ECT or ECT. If the packet duplication is completely independent of the usage of ECN, then the fraction of packet duplicates should be in relation to the number of non-ECT vs ECT packet sent during the period of comparison. This relation does not hold for packet loss, where higher rates of packet loss for non-ECT is expected than for ECT traffic.</p>
<p id="rfc.section.7.4.2.p.5">Detecting clearing of ECN field: If the ratio between ECT and not-ECT transmitted in the reports has become all not-ECT, or has substantially changed towards not-ECT, then this is clearly an indication that the path results in clearing of the ECT field.</p>
<p id="rfc.section.7.4.2.p.6">Dropping of ECT packets: To determine if the packet drop ratio is different between not-ECT and ECT marked transmission requires a mix of transmitted traffic. The sender should compare if the delivery percentage (delivered / transmitted) between ECT and not-ECT is significantly different. Care must be taken if the number of packets are low in either of the categories. One must also take into account the level of CE marking. A CE marked packet would have been dropped unless it was ECT marked. Thus, the packet loss level for not-ECT should be approximately equal to the loss rate for ECT when counting the CE marked packets as lost ones. A sender performing this calculation needs to ensure that the difference is statistically significant.</p>
<p id="rfc.section.7.4.2.p.7">If erroneous behavior is detected, it should be logged to enable follow up and statistics gathering.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#sec-rtcp-translator-mixer" id="sec-rtcp-translator-mixer">Processing ECN in RTP Translators and Mixers</a>
</h1>
<p id="rfc.section.8.p.1">RTP translators and mixers that support ECN for RTP are required to process, and potentially modify or generate ECN marking in RTP packets.  They also need to process, and potentially modify or generate RTCP ECN feedback packets for the translated and/or mixed streams. This includes both downstream RTCP reports generated by the media sender, and also reports generated by the receivers, flowing upstream back towards the sender.</p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> <a href="#sec-rtcp-trn-translator" id="sec-rtcp-trn-translator">Transport Translators</a>
</h1>
<p id="rfc.section.8.1.p.1">Some translators only perform transport level translations, like copying packets from one address domain, like unicast to multicast. It may also perform relaying like copying an incoming packet to a number of unicast receivers. This section details the ECN related actions for RTP and RTCP.</p>
<p id="rfc.section.8.1.p.2">For the RTP data packets the translator, which does not modify the media stream, SHOULD copy the ECN bits unchanged from the incoming to the outgoing datagrams, unless the translator itself is overloaded and experiencing congestion, in which case it may mark the outgoing datagrams with an ECN-CE mark.</p>
<p id="rfc.section.8.1.p.3">A Transport translator does not modify RTCP packets. It however MUST perform the corresponding transport translation of the RTCP packets as it does with RTP packets being sent from the same source/end-point.</p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> <a href="#sec-rtcp-ecn-translator" id="sec-rtcp-ecn-translator">Fragmentation and Reassembly in Translators</a>
</h1>
<p id="rfc.section.8.2.p.1">An RTP translator may fragment or reassemble RTP data packets without changing the media encoding, and without reference to the congestion state of the networks it bridges. An example of this might be to combine packets of a voice-over-IP stream coded with one 20ms frame per RTP packet into new RTP packets with two 20ms frames per packet, thereby reducing the header overheads and so stream bandwidth, at the expense of an increase in latency. If multiple data packets are re-encoded into one, or vice versa, the RTP translator MUST assign new sequence numbers to the outgoing packets. Losses in the incoming RTP packet stream may also induce corresponding gaps in the outgoing RTP sequence numbers. An RTP translator MUST rewrite RTCP packets to make the corresponding changes to their sequence numbers, and to reflect the impact of the fragmentation or reassembly. This section describes how that rewriting is to be done for RTCP ECN feedback packets.  Section 7.2 of <a href="#RFC3550">[RFC3550]</a> describes general procedures for other RTCP packet types.</p>
<p id="rfc.section.8.2.p.2">The processing of arriving RTP packets for this case is as follows.  If an ECN marked packet is split into two, then both the outgoing packets MUST be ECN marked identically to the original; if several ECN marked packets are combined into one, the outgoing packet MUST be either ECN-CE marked or dropped if any of the incoming packets are ECN-CE marked. If the outgoing combined packet is not ECN-CE marked, then it MUST be ECT marked if any of the incoming packets were ECT marked.</p>
<p id="rfc.section.8.2.p.3">RTCP ECN feedback packets (<a href="#sec-rtcp-ecn-fb">Section 5.1</a>) contain seven fields that are rewritten in an RTP translator that fragments or reassembles packets: the extended highest sequence number, the duplication counter, the lost packets counter, the ECN-CE counter, and not-ECT counter, the ECT(0) counter, and the ECT(1) counter. The RTCP XR report block for ECN summary information (<a href="#sec-ecn-summary-report">Section 5.2</a>) includes all of these fields except the extended highest sequence number which is present in the report block in an SR or RR packet. The procedures for rewriting these fields are the same for both RTCP ECN feedback packet and the RTCP XR ECN summary packet.</p>
<p id="rfc.section.8.2.p.4">When receiving an RTCP ECN feedback packet for the translated stream, an RTP translator first determines the range of packets to which the report corresponds. The extended highest sequence number in the RTCP ECN feedback packet (or in the RTCP SR/RR packet contained within the compound packet, in the case of RTCP XR ECN summary reports) specifies the end sequence number of the range. For the first RTCP ECN feedback packet received, the initial extended sequence number of the range may be determined by subtracting the sum of the lost packets counter, the ECN-CE counter, the not-ECT counter, the ECT(0) counter and the ECT(1) counter minus the duplication counter, from the extended highest sequence number. For subsequent RTCP ECN feedback packets, the starting sequence number may be determined as being one after the extended highest sequence number of the previous RTCP ECN feedback packet received from the same SSRC. These values are in the sequence number space of the translated packets.</p>
<p id="rfc.section.8.2.p.5">Based on its knowledge of the translation process, the translator determines the sequence number range for the corresponding original, pre-translation, packets. The extended highest sequence number in the RTCP ECN feedback packet is rewritten to match the final sequence number in the pre-translation sequence number range.</p>
<p id="rfc.section.8.2.p.6">The translator then determines the ratio, R, of the number of packets in the translated sequence number space (numTrans) to the number of packets in the pre-translation sequence number space (numOrig) such that R = numTrans / numOrig. The counter values in the RTCP ECN feedback report are then scaled by dividing each of them by R. For example, if the translation process combines two RTP packets into one, then numOrig will be twice numTrans, giving R=0.5, and the counters in the translated RTCP ECN feedback packet will be twice those in the original.</p>
<p id="rfc.section.8.2.p.7">The ratio, R, may have a value that leads to non-integer multiples of the counters when translating the RTCP packet. For example, a VoIP translator that combines two adjacent RTP packets into one if they contain active speech data, but passes comfort noise packets unchanged, would have an R values of between 0.5 and 1.0 depending on the amount of active speech. Since the counter values in the translated RTCP report are integer values, rounding will be necessary in this case.</p>
<p id="rfc.section.8.2.p.8">When rounding counter values in the translated RTCP packet, the translator should try to ensure that they sum to the number of RTP packets in the pre-translation sequence number space (numOrig). The translator should also try to ensure that no non-zero counter is rounded to a zero value, unless the pre-translated values are zero, since that will lose information that a particular type of event has occurred. It is recognised that it may be impossible to satisfy both of these constraints; in such cases, it is better to ensure that no non-zero counter is mapped to a zero value, since this preserves congestion adaptation and helps the RTCP-based ECN initiation process.</p>
<p id="rfc.section.8.2.p.9">One should be aware of the impact this type of translators have on the measurement of packet duplication. A translator performing aggregation and most likely also an fragmenting translator will suppress any duplication happening prior to itself. Thus the reports and what is being scaled will only represent packet duplication happening from the translator to the receiver reporting on the flow.</p>
<p id="rfc.section.8.2.p.10">It should be noted that scaling the RTCP counter values in this way is meaningful only on the assumption that the level of congestion in the network is related to the number of packets being sent. This is likely to be a reasonable assumption in the type of environment where RTP translators that fragment or reassemble packets are deployed, as their entire purpose is to change the number of packets being sent to adapt to known limitations of the network, but is not necessarily valid in general.</p>
<p id="rfc.section.8.2.p.11">The rewritten RTCP ECN feedback report is sent from the other side of the translator to that which it arrived (as part of a compound RTCP packet containing other translated RTCP packets, where appropriate).</p>
<h1 id="rfc.section.8.3">
<a href="#rfc.section.8.3">8.3.</a> <a href="#sec-rtcp-ecn-synthetic" id="sec-rtcp-ecn-synthetic">Generating RTCP ECN Feedback in Media Transcoders</a>
</h1>
<p id="rfc.section.8.3.p.1">An RTP translator that acts as a media transcoder cannot directly forward RTCP packets corresponding to the transcoded stream, since those packets will relate to the non-transcoded stream, and will not be useful in relation to the transcoded RTP flow. Such a transcoder will need to interpose itself into the RTCP flow, acting as a proxy for the receiver to generate RTCP feedback in the direction of the sender relating to the pre-transcoded stream, and acting in place of the sender to generate RTCP relating to the transcoded stream, to be sent towards the receiver. This section describes how this proxying is to be done for RTCP ECN feedback packets. Section 7.2 of <a href="#RFC3550">[RFC3550]</a> describes general procedures for other RTCP packet types.</p>
<p id="rfc.section.8.3.p.2">An RTP translator acting as a media transcoder in this manner does not have its own SSRC, and hence is not visible to other entities at the RTP layer. RTCP ECN feedback packets and RTCP XR report blocks for ECN summary information that are received from downstream relate to the translated stream, and so must be processed by the translator as if it were the original media source. These reports drive the congestion control loop and media adaptation between the translator and the downstream receiver. If there are multiple downstream receivers, a logically separate transcoder instance must be used for each receiver, and must process RTCP ECN feedback and summary reports independently to the other transcoder instances. An RTP translator acting as a media transcoder in this manner MUST NOT forward RTCP ECN feedback packets or RTCP XR ECN summary reports from downstream receivers in the upstream direction.</p>
<p id="rfc.section.8.3.p.3">An RTP translator acting as a media transcoder will generate RTCP reports upstream towards the original media sender, based on the reception quality of the original media stream at the translator. The translator will run a separate congestion control loop and media adaptation between itself and the media sender for each of its downstream receivers, and must generate RTCP ECN feedback packets and RTCP XR ECN summary reports for that congestion control loop using the SSRC of that downstream receiver.</p>
<h1 id="rfc.section.8.4">
<a href="#rfc.section.8.4">8.4.</a> <a href="#sec-rtcp-mixer" id="sec-rtcp-mixer">Generating RTCP ECN Feedback in Mixers</a>
</h1>
<p id="rfc.section.8.4.p.1">An RTP mixer terminates one-or-more RTP flows, combines them into a single outgoing media stream, and transmits that new stream as a separate RTP flow. A mixer has its own SSRC, and is visible to other participants in the session at the RTP layer.</p>
<p id="rfc.section.8.4.p.2">An ECN-aware RTP mixer must generate RTCP ECN feedback packets and RTCP XR report blocks for ECN summary information relating to the RTP flows it terminates, in exactly the same way it would if it were an RTP receiver. These reports form part of the congestion control loop between the mixer and the media senders generating the streams it is mixing. A separate control loop runs between each sender and the mixer.</p>
<p id="rfc.section.8.4.p.3">An ECN-aware RTP mixer will negotiate and initiate the use of ECN on the mixed RTP flows it generates, and will accept and process RTCP ECN feedback reports and RTCP XR report blocks for ECN relating to those mixed flows as if it were a standard media sender. A congestion control loop runs between the mixer and its receivers, driven in part by the ECN reports received.</p>
<p id="rfc.section.8.4.p.4">An RTP mixer MUST NOT forward RTCP ECN feedback packets or RTCP XR ECN summary reports from downstream receivers in the upstream direction.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#sec-impl" id="sec-impl">Implementation considerations</a>
</h1>
<p id="rfc.section.9.p.1">To allow the use of ECN with RTP over UDP, an RTP implementation desiring to support receiving ECN controlled media streams must support reading the value of the ECT bits on received UDP datagrams, and an RTP implementation desiring to support sending ECN controlled media streams must support setting the ECT bits in outgoing UDP datagrams. The standard Berkeley sockets API pre-dates the specification of ECN, and does not provide the functionality which is required for this mechanism to be used with UDP flows, making this specification difficult to implement portably.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#sec-iana" id="sec-iana">IANA Considerations</a>
</h1>
<p id="rfc.section.10.p.1">Note to RFC Editor: please replace "RFC XXXX" below with the RFC number of this memo, and remove this note.</p>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> SDP Attribute Registration</h1>
<p id="rfc.section.10.1.p.1">Following the guidelines in <a href="#RFC4566">[RFC4566]</a>, the IANA is requested to register one new SDP attribute:</p>

<ul>
<li>Contact name, email address and telephone number: Authors of RFCXXXX</li>
<li>Attribute-name: ecn-capable-rtp</li>
<li>Type of attribute: media-level</li>
<li>Subject to charset: no</li>
</ul>
<p id="rfc.section.10.1.p.2">This attribute defines the ability to negotiate the use of ECT (ECN capable transport) for RTP flows running over UDP/IP. This attribute should be put in the SDP offer if the offering party wishes to receive an ECT flow. The answering party should include the attribute in the answer if it wish to receive an ECT flow. If the answerer does not include the attribute then ECT MUST be disabled in both directions.</p>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> RTP/AVPF Transport Layer Feedback Message</h1>
<p id="rfc.section.10.2.p.1">The IANA is requested to register one new RTP/AVPF Transport Layer Feedback Message in the table of FMT values for RTPFB Payload Types <a href="#RFC4585">[RFC4585]</a> as defined in <a href="#sec-rtcp-ecn-fb">Section 5.1</a>:</p>
<div id="#rfc.figure.9"></div>
<pre>
   Name:          RTCP-ECN-FB
   Long name:     RTCP ECN Feedback
   Value:         TBA1
   Reference:     RFC XXXX 
</pre>
<h1 id="rfc.section.10.3">
<a href="#rfc.section.10.3">10.3.</a> RTCP Feedback SDP Parameter</h1>
<p id="rfc.section.10.3.p.1">The IANA is requested to register one new SDP "rtcp-fb" attribute "nack" parameter "ecn" in the SDP ("ack" and "nack" Attribute Values) registry.</p>
<div id="#rfc.figure.10"></div>
<pre>   Value name:     ecn
   Long name:      Explicit Congestion Notification
   Usable with:    nack
   Reference:      RFC XXXX</pre>
<p></p>
<h1 id="rfc.section.10.4">
<a href="#rfc.section.10.4">10.4.</a> RTCP XR Report blocks</h1>
<p id="rfc.section.10.4.p.1">The IANA is requested to register one new RTCP XR Block Type as defined in <a href="#sec-ecn-summary-report">Section 5.2</a>:</p>
<div id="#rfc.figure.11"></div>
<pre>
   Block Type: TBA2
   Name:       ECN Summary Report
   Reference:  RFC XXXX
</pre>
<h1 id="rfc.section.10.5">
<a href="#rfc.section.10.5">10.5.</a> RTCP XR SDP Parameter</h1>
<p id="rfc.section.10.5.p.1">The IANA is requested to register one new RTCP XR SDP Parameter "ecn-sum" in the "RTCP XR SDP Parameters" registry.</p>
<div id="#rfc.figure.12"></div>
<pre>   Parameter name      XR block (block type and name)
   --------------      ------------------------------------
   ecn-sum             TBA2  ECN Summary Report Block</pre>
<p></p>
<h1 id="rfc.section.10.6">
<a href="#rfc.section.10.6">10.6.</a> <a href="#stun-attr" id="stun-attr">STUN attribute</a>
</h1>
<p id="rfc.section.10.6.p.1">A new STUN <a href="#RFC5389">[RFC5389]</a> attribute in the Comprehension-optional range under IETF Review (0x8000-0xFFFF) is request to be assigned to the STUN attribute defined in <a href="#sec-stun-init-ecn">Section 7.2.2</a>. The STUN attribute registry can currently be found at: http://www.iana.org/assignments/stun-parameters/stun-parameters.xhtml.</p>
<h1 id="rfc.section.10.7">
<a href="#rfc.section.10.7">10.7.</a> <a href="#ice-opt" id="ice-opt">ICE Option</a>
</h1>
<p id="rfc.section.10.7.p.1">A new ICE option "rtp+ecn" is registered in the registry that <a href="#RFC6336">"IANA Registry for Interactive Connectivity Establishment (ICE) Options"</a> <cite title="NONE">[RFC6336]</cite> creates.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#sec-security" id="sec-security">Security Considerations</a>
</h1>
<p id="rfc.section.11.p.1">The use of ECN with RTP over UDP as specified in this document has the following known security issues that need to be considered.</p>
<p id="rfc.section.11.p.2">External threats to the RTP and RTCP traffic:</p>
<p></p>

<dl>
<dt>Denial of Service affecting RTCP:</dt>
<dd style="margin-left: 8">An attacker that can modify the traffic between the media sender and a receiver can achieve either of two things: 1) Report a lot of packets as being Congestion Experience marked, thus forcing the sender into a congestion response; or 2) Ensure that the sender disable the usage of ECN by reporting failures to receive ECN by changing the counter fields. This can also be accomplished by injecting false RTCP packets to the media sender. Reporting a lot of ECN-CE marked traffic is likely the more efficient denial of service tool as that may likely force the application to use lowest possible bit-rates.  The prevention against an external threat is to integrity protect the RTCP feedback information and authenticate the sender.</dd>
<dt>Information leakage:</dt>
<dd style="margin-left: 8">The ECN feedback mechanism exposes the receivers perceived packet loss, what packets it considers to be ECN-CE marked and its calculation of the ECN-none.  This is mostly not considered as sensitive information. If it is considered sensitive the RTCP feedback should be encrypted.</dd>
<dt>Changing the ECN bits:</dt>
<dd style="margin-left: 8">An on-path attacker that sees the RTP packet flow from sender to receiver and who has the capability to change the packets can rewrite ECT into ECN-CE thus forcing the sender or receiver to take congestion control response.  This denial of service against the media quality in the RTP session is impossible for an end-point to protect itself against. Only network infrastructure nodes can detect this illicit re-marking. It will be mitigated by turning off ECN, however, if the attacker can modify its response to drop packets the same vulnerability exist.</dd>
<dt>Denial of Service affecting the session set-up signalling:</dt>
<dd style="margin-left: 8">If an attacker can modify the session signalling it can prevent the usage of ECN by removing the signalling attributes used to indicate that the initiator is capable and willing to use ECN with RTP/UDP.  This attack can be prevented by authentication and integrity protection of the signalling. We do note that any attacker that can modify the signalling has more interesting attacks they can perform than prevent the usage of ECN, like inserting itself as a middleman in the media flows enabling wire-tapping also for an off-path attacker.</dd>
</dl>
<p id="rfc.section.11.p.4">The following are threats that exist from misbehaving senders or receivers:</p>
<p></p>

<dl>
<dt>Receivers cheating:</dt>
<dd style="margin-left: 8">A receiver may attempt to cheat and fail to report reception of ECN-CE marked packets. The benefit for a receiver cheating in its reporting would be to get an unfair bit-rate share across the resource bottleneck. It is far from certain that a receiver would be able to get a significant larger share of the resources. That assumes a high enough level of aggregation that there are flows to acquire shares from. The risk of cheating is that failure to react to congestion results in packet loss and increased path delay.</dd>
<dt>Receivers misbehaving:</dt>
<dd style="margin-left: 8">A receiver may prevent the usage of ECN in an RTP session by reporting itself as non ECN capable, forcing the sender to turn off usage of ECN. In a point-to-point scenario there is little incentive to do this as it will only affect the receiver. Thus failing to utilise an optimisation. For multi-party session there exist some motivation why a receiver would misbehave as it can prevent also the other receivers from using ECN. As an insider into the session it is difficult to determine if a receiver is misbehaving or simply incapable, making it basically impossible in the incremental deployment phase of ECN for RTP usage to determine this. If additional information about the receivers and the network is known it might be possible to deduce that a receiver is misbehaving. If it can be determined that a receiver is misbehaving, the only response is to exclude it from the RTP session and ensure that is does not any longer have any valid security context to affect the session.</dd>
<dt>Misbehaving Senders:</dt>
<dd style="margin-left: 8">The enabling of ECN gives the media packets a higher degree of probability to reach the receiver compared to not-ECT marked ones on a ECN capable path. However, this is no magic bullet and failure to react to congestion will most likely only slightly delay a network buffer over-run, in which its session also will experience packet loss and increased delay. There is some possibility that the media senders traffic will push other traffic out of the way without being affected too negatively.  However, we do note that a media sender still needs to implement congestion control functions to prevent the media from being badly affected by congestion events. Thus the misbehaving sender is getting a unfair share. This can only be detected and potentially prevented by network monitoring and administrative entities. See Section 7 of <a href="#RFC3168">[RFC3168]</a> for more discussion of this issue.</dd>
</dl>
<p id="rfc.section.11.p.6">We note that the end-point security functions needed to prevent an external attacker from inferring with the signalling are source authentication and integrity protection. To prevent information leakage from the feedback packets encryption of the RTCP is also needed. For RTP there exist multiple solutions possible depending on the application context. <a href="#RFC3711">Secure RTP (SRTP)</a> <cite title="NONE">[RFC3711]</cite> does satisfy the requirement to protect this mechanism despite only providing authentication if a entity is within the security context or not. <a href="#RFC4301">IPsec</a> <cite title="NONE">[RFC4301]</cite> and <a href="#RFC4347">DTLS</a> <cite title="NONE">[RFC4347]</cite> can also provide the necessary security functions.</p>
<p id="rfc.section.11.p.7">The signalling protocols used to initiate an RTP session also need to be source authenticated and integrity protected to prevent an external attacker from modifying any signalling. Here an appropriate mechanism to protect the used signalling needs to be used. For SIP/SDP ideally <a href="#RFC5751">S/MIME</a> <cite title="NONE">[RFC5751]</cite> would be used. However, with the limited deployment a minimal mitigation strategy is to require use of <a href="#RFC3261">SIPS (SIP over TLS)</a> <cite title="NONE">[RFC3261]</cite> <a href="#RFC5630">[RFC5630]</a> to at least accomplish hop-by-hop protection.</p>
<p id="rfc.section.11.p.8">We do note that certain mitigation methods will require network functions.</p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> <a href="#sec-examples" id="sec-examples">Examples of SDP Signalling</a>
</h1>
<p id="rfc.section.12.p.1">This section contain a few different examples of the signalling mechanism defined in this specification in an SDP context. If there are discrepancies between these examples and the specification text, the specification text is definitive.</p>
<h1 id="rfc.section.12.1">
<a href="#rfc.section.12.1">12.1.</a> Basic SDP Offer/Answer</h1>
<p id="rfc.section.12.1.p.1">This example is a basic offer/answer SDP exchange, assumed done by SIP (not shown). The intention is to establish a basic audio session point to point between two users.</p>
<p id="rfc.section.12.1.p.2">The Offer:</p>
<div id="#rfc.figure.13"></div>
<pre>   v=0
   o=jdoe 3502844782 3502844782 IN IP4 10.0.1.4
   s=VoIP call
   i=SDP offer for VoIP call with ICE and ECN for RTP
   b=AS:128
   b=RR:2000
   b=RS:2500
   a=ice-pwd:YH75Fviy6338Vbrhrlp8Yh
   a=ice-ufrag:9uB6
   a=ice-options:rtp+ecn
   t=0 0
   m=audio 45664 RTP/AVPF 97 98 99
   c=IN IP4 192.0.2.3
   a=rtpmap:97 G719/48000/1
   a=fmtp:97 maxred=160
   a=rtpmap:98 AMR-WB/16000/1
   a=fmtp:98 octet-align=1; mode-change-capability=2
   a=rtpmap:99 PCMA/8000/1
   a=maxptime:160
   a=ptime:20
   a=ecn-capable-rtp: ice rtp ect=0 mode=setread
   a=rtcp-fb:* nack ecn
   a=rtcp-fb:* trr-int 1000
   a=rtcp-xr:ecn-sum
   a=rtcp-rsize
   a=candidate:1 1 UDP 2130706431 10.0.1.4 8998 typ host
   a=candidate:2 1 UDP 1694498815 192.0.2.3 45664 typ srflx raddr 
      10.0.1.4 rport 8998
 </pre>
<p id="rfc.section.12.1.p.3">This SDP offer offers a single media stream with 3 media payload types. It proposes to use ECN with RTP, with the ICE based initialization as being preferred over the RTP/RTCP one. Leap of faith is not suggested to be used. The offerer is capable of both setting and reading the ECN bits. In addition the use of both the RTCP ECN feedback packet and the RTCP XR ECN summary report are supported. ICE is also proposed with two candidates. It also supports reduced size RTCP and can to use it.</p>
<p id="rfc.section.12.1.p.4">The Answer:</p>
<div id="#rfc.figure.14"></div>
<pre>   v=0
   o=jdoe 3502844783 3502844783 IN IP4 198.51.100.235
   s=VoIP call
   i=SDP offer for VoIP call with ICE and ECN for RTP
   b=AS:128
   b=RR:2000
   b=RS:2500
   a=ice-pwd:asd88fgpdd777uzjYhagZg
   a=ice-ufrag:8hhY
   a=ice-options:rtp+ecn
   t=0 0
   m=audio 53879 RTP/AVPF 97 99
   c=IN IP4 198.51.100.235
   a=rtpmap:97 G719/48000/1
   a=fmtp:97 maxred=160
   a=rtpmap:99 PCMA/8000/1
   a=maxptime:160
   a=ptime:20
   a=ecn-capable-rtp: ice ect=0 mode=readonly
   a=rtcp-fb:* nack ecn
   a=rtcp-fb:* trr-int 1000
   a=rtcp-xr:ecn-sum
   a=candidate:1 1 UDP 2130706431 198.51.100.235 53879 typ host </pre>
<p id="rfc.section.12.1.p.5">The answer confirms that only one media stream will be used. One RTP Payload type was removed. ECN capability was confirmed, and the initialization method will be ICE. However, the answerer is only capable of reading the ECN bits, which means that ECN can only be used for RTP flowing from the offerer to the answerer. ECT always set to 0 will be used in both directions. Both the RTCP ECN feedback packet and the RTCP XR ECN summary report will be used. Reduced size RTCP will not be used as the answerer has not indicated support for it in the answer.</p>
<h1 id="rfc.section.12.2">
<a href="#rfc.section.12.2">12.2.</a> Declarative Multicast SDP</h1>
<p id="rfc.section.12.2.p.1">The below session describes an any source multicast using session with a single media stream.</p>
<div id="#rfc.figure.15"></div>
<pre>   v=0
   o=jdoe 3502844782 3502844782 IN IP4 198.51.100.235
   s=Multicast SDP session using ECN for RTP
   i=Multicasted audio chat using ECN for RTP
   b=AS:128
   t=3502892703 3502910700
   m=audio 56144 RTP/AVPF 97
   c=IN IP4 233.252.0.212/127
   a=rtpmap:97 g719/48000/1
   a=fmtp:97 maxred=160
   a=maxptime:160
   a=ptime:20
   a=ecn-capable-rtp: rtp mode=readonly; ect=0
   a=rtcp-fb:* nack ecn
   a=rtcp-fb:* trr-int 1500
   a=rtcp-xr:ecn-sum
 </pre>
<p id="rfc.section.12.2.p.2">In the above example, as this is declarative we need to require certain functionality. As it is ASM the initialization method that can work here is the RTP/RTCP based one. So that is indicated. The ECN setting and reading capability to take part of this session is at least read. If one is capable of setting that is good, but not required as one can skip using ECN for anything one sends oneself. The ECT value is recommended to be set to 0 always. The ECN usage in this session requires both ECN feedback and the XR ECN summary report, so their use is also indicated.</p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> Acknowledgments</h1>
<p id="rfc.section.13.p.1">The authors wish to thank the following persons for their reviews and comments: Thomas Belling, Bob Briscoe, Roni Even, Kevin P. Flemming, Thomas Frankkila, Christian Groves, Christer Holmgren, Cullen Jennings Tom Van Caenegem, Simo Veikkolainen, Bill Ver Steeg, Dan Wing, Qin Wu, and Lei Zhu.</p>
<h1 id="rfc.references">
<a href="#rfc.references">14.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">14.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3168">[RFC3168]</b></td>
<td class="top">
<a>Ramakrishnan, K.</a>, <a>Floyd, S.</a> and <a>D. Black</a>, "<a href="http://tools.ietf.org/html/rfc3168">The Addition of Explicit Congestion Notification (ECN) to IP</a>", RFC 3168, September 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3550">[RFC3550]</b></td>
<td class="top">
<a>Schulzrinne, H.</a>, <a>Casner, S.</a>, <a>Frederick, R.</a> and <a>V. Jacobson</a>, "<a href="http://tools.ietf.org/html/rfc3550">RTP: A Transport Protocol for Real-Time Applications</a>", STD 64, RFC 3550, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3611">[RFC3611]</b></td>
<td class="top">
<a>Friedman, T.</a>, <a>Caceres, R.</a> and <a>A. Clark</a>, "<a href="http://tools.ietf.org/html/rfc3611">RTP Control Protocol Extended Reports (RTCP XR)</a>", RFC 3611, November 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5234">[RFC5234]</b></td>
<td class="top">
<a>Crocker, D.</a> and <a>P. Overell</a>, "<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>", STD 68, RFC 5234, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5245">[RFC5245]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, "<a href="http://tools.ietf.org/html/rfc5245">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>", RFC 5245, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5348">[RFC5348]</b></td>
<td class="top">
<a>Floyd, S.</a>, <a>Handley, M.</a>, <a>Padhye, J.</a> and <a>J. Widmer</a>, "<a href="http://tools.ietf.org/html/rfc5348">TCP Friendly Rate Control (TFRC): Protocol Specification</a>", RFC 5348, September 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5389">[RFC5389]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Mahy, R.</a>, <a>Matthews, P.</a> and <a>D. Wing</a>, "<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>", RFC 5389, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6336">[RFC6336]</b></td>
<td class="top">
<a>Westerlund, M.</a> and <a>C. Perkins</a>, "<a href="http://tools.ietf.org/html/rfc6336">IANA Registry for Interactive Connectivity Establishment (ICE) Options</a>", RFC 6336, July 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">14.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1112">[RFC1112]</b></td>
<td class="top">
<a href="mailto:deering@PESCADERO.STANFORD.EDU" title="Stanford University, Computer Science Department">Deering, S.</a>, "<a href="http://tools.ietf.org/html/rfc1112">Host extensions for IP multicasting</a>", STD 5, RFC 1112, August 1989.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2762">[RFC2762]</b></td>
<td class="top">
<a href="mailto:jdrosen@dynamicsoft.com" title="dynamicsoft">Rosenberg, J.</a> and <a href="mailto:schulzrinne@cs.columbia.edu" title="Columbia University">H. Schulzrinne</a>, "<a href="http://tools.ietf.org/html/rfc2762">Sampling of the Group Membership in RTP</a>", RFC 2762, February 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2974">[RFC2974]</b></td>
<td class="top">
<a>Handley, M.</a>, <a>Perkins, C.</a> and <a>E. Whelan</a>, "<a href="http://tools.ietf.org/html/rfc2974">Session Announcement Protocol</a>", RFC 2974, October 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3264">[RFC3264]</b></td>
<td class="top">
<a>Rosenberg, J.</a> and <a>H. Schulzrinne</a>, "<a href="http://tools.ietf.org/html/rfc3264">An Offer/Answer Model with Session Description Protocol (SDP)</a>", RFC 3264, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3540">[RFC3540]</b></td>
<td class="top">
<a>Spring, N.</a>, <a>Wetherall, D.</a> and <a>D. Ely</a>, "<a href="http://tools.ietf.org/html/rfc3540">Robust Explicit Congestion Notification (ECN) Signaling with Nonces</a>", RFC 3540, June 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3551">[RFC3551]</b></td>
<td class="top">
<a>Schulzrinne, H.</a> and <a>S. Casner</a>, "<a href="http://tools.ietf.org/html/rfc3551">RTP Profile for Audio and Video Conferences with Minimal Control</a>", STD 65, RFC 3551, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3569">[RFC3569]</b></td>
<td class="top">
<a>Bhattacharyya, S.</a>, "<a href="http://tools.ietf.org/html/rfc3569">An Overview of Source-Specific Multicast (SSM)</a>", RFC 3569, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3711">[RFC3711]</b></td>
<td class="top">
<a>Baugher, M.</a>, <a>McGrew, D.</a>, <a>Naslund, M.</a>, <a>Carrara, E.</a> and <a>K. Norrman</a>, "<a href="http://tools.ietf.org/html/rfc3711">The Secure Real-time Transport Protocol (SRTP)</a>", RFC 3711, March 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5751">[RFC5751]</b></td>
<td class="top">
<a>Ramsdell, B.</a> and <a>S. Turner</a>, "<a href="http://tools.ietf.org/html/rfc5751">Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.2 Message Specification</a>", RFC 5751, January 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4301">[RFC4301]</b></td>
<td class="top">
<a>Kent, S.</a> and <a>K. Seo</a>, "<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>", RFC 4301, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4340">[RFC4340]</b></td>
<td class="top">
<a>Kohler, E.</a>, <a>Handley, M.</a> and <a>S. Floyd</a>, "<a href="http://tools.ietf.org/html/rfc4340">Datagram Congestion Control Protocol (DCCP)</a>", RFC 4340, March 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4347">[RFC4347]</b></td>
<td class="top">
<a>Rescorla, E.</a> and <a>N. Modadugu</a>, "<a href="http://tools.ietf.org/html/rfc4347">Datagram Transport Layer Security</a>", RFC 4347, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4566">[RFC4566]</b></td>
<td class="top">
<a>Handley, M.</a>, <a>Jacobson, V.</a> and <a>C. Perkins</a>, "<a href="http://tools.ietf.org/html/rfc4566">SDP: Session Description Protocol</a>", RFC 4566, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4585">[RFC4585]</b></td>
<td class="top">
<a>Ott, J.</a>, <a>Wenger, S.</a>, <a>Sato, N.</a>, <a>Burmeister, C.</a> and <a>J. Rey</a>, "<a href="http://tools.ietf.org/html/rfc4585">Extended RTP Profile for Real-time Transport Control Protocol (RTCP)-Based Feedback (RTP/AVPF)</a>", RFC 4585, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4588">[RFC4588]</b></td>
<td class="top">
<a>Rey, J.</a>, <a>Leon, D.</a>, <a>Miyazaki, A.</a>, <a>Varsa, V.</a> and <a>R. Hakenberg</a>, "<a href="http://tools.ietf.org/html/rfc4588">RTP Retransmission Payload Format</a>", RFC 4588, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4607">[RFC4607]</b></td>
<td class="top">
<a>Holbrook, H.</a> and <a>B. Cain</a>, "<a href="http://tools.ietf.org/html/rfc4607">Source-Specific Multicast for IP</a>", RFC 4607, August 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4960">[RFC4960]</b></td>
<td class="top">
<a>Stewart, R.</a>, "<a href="http://tools.ietf.org/html/rfc4960">Stream Control Transmission Protocol</a>", RFC 4960, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5124">[RFC5124]</b></td>
<td class="top">
<a>Ott, J.</a> and <a>E. Carrara</a>, "<a href="http://tools.ietf.org/html/rfc5124">Extended Secure RTP Profile for Real-time Transport Control Protocol (RTCP)-Based Feedback (RTP/SAVPF)</a>", RFC 5124, February 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5506">[RFC5506]</b></td>
<td class="top">
<a>Johansson, I.</a> and <a>M. Westerlund</a>, "<a href="http://tools.ietf.org/html/rfc5506">Support for Reduced-Size Real-Time Transport Control Protocol (RTCP): Opportunities and Consequences</a>", RFC 5506, April 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5630">[RFC5630]</b></td>
<td class="top">
<a>Audet, F.</a>, "<a href="http://tools.ietf.org/html/rfc5630">The Use of the SIPS URI Scheme in the Session Initiation Protocol (SIP)</a>", RFC 5630, October 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5760">[RFC5760]</b></td>
<td class="top">
<a>Ott, J.</a>, <a>Chesterfield, J.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc5760">RTP Control Protocol (RTCP) Extensions for Single-Source Multicast Sessions with Unicast Feedback</a>", RFC 5760, February 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-avt-rtp-no-op">[I-D.ietf-avt-rtp-no-op]</b></td>
<td class="top">
<a>Andreasen, F</a>, "<a href="http://tools.ietf.org/html/draft-ietf-avt-rtp-no-op-04">A No-Op Payload Format for RTP</a>", Internet-Draft draft-ietf-avt-rtp-no-op-04, May 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6189">[RFC6189]</b></td>
<td class="top">
<a>Zimmermann, P.</a>, <a>Johnston, A.</a> and <a>J. Callas</a>, "<a href="http://tools.ietf.org/html/rfc6189">ZRTP: Media Path Key Agreement for Unicast Secure RTP</a>", RFC 6189, April 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Magnus Westerlund</span> 
	  <span class="n hidden">
		<span class="family-name">Westerlund</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>Farogatan 6</span>

	  <span class="vcardline">
		<span class="locality">SE-164 80 Kista</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">Phone: +46 10 714 82 87</span>

<span class="vcardline">EMail: <a href="mailto:magnus.westerlund@ericsson.com">magnus.westerlund@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ingemar Johansson</span> 
	  <span class="n hidden">
		<span class="family-name">Johansson</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>Laboratoriegrand 11</span>

	  <span class="vcardline">
		<span class="locality">SE-971 28 Lulea</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">SWEDEN</span>
	</span>
	<span class="vcardline">Phone: +46 73 0783289</span>

<span class="vcardline">EMail: <a href="mailto:ingemar.s.johansson@ericsson.com">ingemar.s.johansson@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Colin Perkins</span> 
	  <span class="n hidden">
		<span class="family-name">Perkins</span>
	  </span>
	</span>
	<span class="org vcardline">University of Glasgow</span>
	<span class="adr">
	  <span>School of Computing Science</span>

	  <span class="vcardline">
		<span class="locality">Glasgow</span>,  
		<span class="region"></span>
		<span class="code">G12 8QQ</span>
	  </span>
	  <span class="country-name vcardline">United Kingdom</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:csp@csperkins.org">csp@csperkins.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Piers O'Hanlon</span> 
	  <span class="n hidden">
		<span class="family-name">O'Hanlon</span>
	  </span>
	</span>
	<span class="org vcardline">University College London</span>
	<span class="adr">
	  <span>Computer Science Department</span>
<span>Gower Street</span>

	  <span class="vcardline">
		<span class="locality">London</span>,  
		<span class="region"></span>
		<span class="code">WC1E 6BT</span>
	  </span>
	  <span class="country-name vcardline">United Kingdom</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:p.ohanlon@cs.ucl.ac.uk">p.ohanlon@cs.ucl.ac.uk</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ken Carlberg</span> 
	  <span class="n hidden">
		<span class="family-name">Carlberg</span>
	  </span>
	</span>
	<span class="org vcardline">G11</span>
	<span class="adr">
	  <span>1600 Clarendon Blvd</span>

	  <span class="vcardline">
		<span class="locality">Arlington</span>,  
		<span class="region"></span>
		<span class="code">VA</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:carlberg@g11.org.uk">carlberg@g11.org.uk</a></span>

  </address>
</div>

</body>
</html>