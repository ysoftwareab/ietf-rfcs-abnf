<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>EAP-based Authentication Service for CoAP</title>
<meta content="Rafa Marin-Lopez" name="author">
<meta content="Dan Garcia-Carrillo" name="author">
<meta content="
       
                This document specifies an authentication service that uses the Extensible Authentication Protocol (EAP) transported employing Constrained Application Protocol (CoAP) messages. As such, it defines an EAP lower-layer based on CoAP called CoAP-EAP. One of the primer goals is to authenticate a CoAP-enabled device (EAP peer) that intends to join a  security domain managed by a domain Controller (EAP authenticator). Secondly, it allows deriving key material to protect CoAP messages exchanged between them based on Object Security for Constrained RESTful Environments (OSCORE), enabling the establishment of a security association between them. This document also provides guidelines on how to generate key material for other types of security associations.
       
    " name="description">
<meta content="xml2rfc 3.9.1" name="generator">
<meta content="template" name="keyword">
<meta content="draft-ietf-ace-wg-coap-eap-03" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.9.1
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.1
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 57.4.0
    six 1.16.0
-->
<link href="/tmp/draft-ietf-ace-wg-coap-eap-03-v03-mpz0po41.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">CoAP-EAP</td>
<td class="right">July 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Marin-Lopez &amp; Garcia-Carrillo</td>
<td class="center">Expires 27 January 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">ACE Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-ace-wg-coap-eap-03</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-07-26" class="published">26 July 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-01-27">27 January 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. Marin-Lopez</div>
<div class="org">University of Murcia</div>
</div>
<div class="author">
      <div class="author-name">D. Garcia-Carrillo</div>
<div class="org">University of Oviedo</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">EAP-based Authentication Service for CoAP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
                This document specifies an authentication service that uses the Extensible Authentication Protocol (EAP) transported employing Constrained Application Protocol (CoAP) messages. As such, it defines an EAP lower-layer based on CoAP called CoAP-EAP. One of the primer goals is to authenticate a CoAP-enabled device (EAP peer) that intends to join a  security domain managed by a domain Controller (EAP authenticator). Secondly, it allows deriving key material to protect CoAP messages exchanged between them based on Object Security for Constrained RESTful Environments (OSCORE), enabling the establishment of a security association between them. This document also provides guidelines on how to generate key material for other types of security associations.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 27 January 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty compact toc ulBare">
<li class="ulEmpty compact toc ulBare" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulEmpty ulBare">
<li class="compact toc ulEmpty ulBare" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-requirements-language" class="xref">Requirements Language</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-general-architecture" class="xref">General Architecture</a></p>
</li>
          <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-coap-eap-operation" class="xref">CoAP-EAP Operation</a></p>
<ul class="compact toc ulEmpty ulBare">
<li class="compact toc ulEmpty ulBare" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-general-flow-of-operation" class="xref">General flow of operation</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-error-handling" class="xref">Error handling</a></p>
<ul class="compact toc ulEmpty ulBare">
<li class="compact toc ulEmpty ulBare" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-non-responding-endpoint" class="xref">Non-responding endpoint</a></p>
</li>
                  <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="xref">3.2.2</a>.  <a href="#name-messages-with-well-known-a" class="xref">Messages with /.well-known/a</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-managing-the-state-of-the-s" class="xref">Managing the State of the Service</a></p>
<ul class="compact toc ulEmpty ulBare">
<li class="compact toc ulEmpty ulBare" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.  <a href="#name-deleting-the-state" class="xref">Deleting the state</a></p>
</li>
                  <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="xref">3.3.2</a>.  <a href="#name-reauthentication" class="xref">Reauthentication</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-cryptosuite-negotiation-and" class="xref">Cryptosuite negotiation and key derivation</a></p>
<ul class="compact toc ulEmpty ulBare">
<li class="compact toc ulEmpty ulBare" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-cryptographic-suite-negotia" class="xref">Cryptographic suite negotiation</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-deriving-the-oscore-securit" class="xref">Deriving the OSCORE Security Context</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-deriving-dtls-psk" class="xref">Deriving DTLS PSK</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-discussion" class="xref">Discussion</a></p>
<ul class="compact toc ulEmpty ulBare">
<li class="compact toc ulEmpty ulBare" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-coap-as-eap-lower-layer" class="xref">CoAP as EAP lower layer</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-size-of-the-eap-lower-layer" class="xref">Size of the EAP lower layer vs EAP method size</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-controller-as-the-coap-clie" class="xref">Controller as the CoAP Client</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="compact toc ulEmpty ulBare">
<li class="compact toc ulEmpty ulBare" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-authorization" class="xref">Authorization</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-freshness-of-the-key-materi" class="xref">Freshness of the key material</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-channel-binding-support" class="xref">Channel Binding support</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-additional-security-conside" class="xref">Additional Security Consideration</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulEmpty ulBare">
<li class="compact toc ulEmpty ulBare" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-examples-of-use-case-scenar" class="xref">Examples of Use Case Scenario</a></p>
<ul class="compact toc ulEmpty ulBare">
<li class="compact toc ulEmpty ulBare" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#appendix-A.1" class="xref">A.1</a>.  <a href="#name-example-1-coap-eap-in-ace" class="xref">Example 1:  CoAP-EAP in ACE</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#appendix-A.2" class="xref">A.2</a>.  <a href="#name-example-2-multi-domain-with" class="xref">Example 2: Multi-domain with AAA infrastructures</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#appendix-A.3" class="xref">A.3</a>.  <a href="#name-example-3-single-domain-wit" class="xref">Example 3: Single domain with AAA infrastructure</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.10.2.4">
                <p id="section-toc.1-1.10.2.4.1"><a href="#appendix-A.4" class="xref">A.4</a>.  <a href="#name-example-4-single-domain-wit" class="xref">Example 4: Single domain without AAA infrastructure</a></p>
</li>
              <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.10.2.5">
                <p id="section-toc.1-1.10.2.5.1"><a href="#appendix-A.5" class="xref">A.5</a>.  <a href="#name-other-use-cases" class="xref">Other use cases</a></p>
<ul class="compact toc ulEmpty ulBare">
<li class="compact toc ulEmpty ulBare" id="section-toc.1-1.10.2.5.2.1">
                    <p id="section-toc.1-1.10.2.5.2.1.1"><a href="#appendix-A.5.1" class="xref">A.5.1</a>.  <a href="#name-coap-eap-for-network-access" class="xref">CoAP-EAP for network access control</a></p>
</li>
                  <li class="compact toc ulEmpty ulBare" id="section-toc.1-1.10.2.5.2.2">
                    <p id="section-toc.1-1.10.2.5.2.2.1"><a href="#appendix-A.5.2" class="xref">A.5.2</a>.  <a href="#name-coap-eap-for-service-authen" class="xref">CoAP-EAP for service authentication</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc ulBare" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
                This document specifies an authentication service that uses the Extensible Authentication Protocol (EAP) <span>[<a href="#RFC3748" class="xref">RFC3748</a>]</span> and is built on top of the Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> called CoAP-EAP.  CoAP-EAP allows authenticating two CoAP endpoints by using EAP, and to establish an OSCORE security association between them.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2"> 
                More specifically, this document specifies how CoAP can be used as a constrained, link-layer independent, EAP lower layer <span>[<a href="#RFC3748" class="xref">RFC3748</a>]</span> to transport EAP messages between a CoAP server (acting as EAP peer) and a CoAP client (acting as EAP authenticator) using CoAP messages. The CoAP client has the option of contacting a backend AAA infrastructure to complete the EAP negotiation as described in the EAP specification <span>[<a href="#RFC3748" class="xref">RFC3748</a>]</span>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">
                EAP methods transported in CoAP MUST generate cryptographic material <span>[<a href="#RFC5247" class="xref">RFC5247</a>]</span>. This way, CoAP messages are protected after the authentication. After CoAP-EAP's operation, Object Security for Constrained RESTful Environments (OSCORE) is established between endpoints of the service. In addition, using the key material derived from the authentication, this document specifies how to establish other types of security associations:<a href="#section-1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-4.1">
                        An OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> security association is established based on the cryptographic material generated from the EAP authentication.<a href="#section-1-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.2">
                        A DTLS security association MAY be established using the exported cryptographic material after a successful EAP authentication.<a href="#section-1-4.2" class="pilcrow">¶</a>
</li>
      </ul>
<section id="section-1.1">
        <h3 id="name-requirements-language">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.1-1">
                    The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">
                    Readers are expected to be familiar with the terms and concepts of described in CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>, EAP <span>[<a href="#RFC3748" class="xref">RFC3748</a>]</span>and OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-2">
      <h2 id="name-general-architecture">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-general-architecture" class="section-name selfRef">General Architecture</a>
      </h2>
<p id="section-2-1">
                <a href="#arch" class="xref">Figure 1</a> illustrates the architecture defined in this document. Basically, an IoT device, acting as the EAP peer, wants to be authenticated by using EAP to join a domain that is managed by a Controller (EAP authenticator). The IoT device will act a CoAP server for this service, and the EAP authenticator as a CoAP client. The rationale behind this decision, as expanded later, is that EAP requests go always from the EAP server to the EAP peer. Accordingly, the EAP responses go from the EAP peer to the EAP server.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2"> 
                It is worth noting that the CoAP client (EAP authenticator) MAY interact with a backend AAA infrastructure when EAP pass-through mode is used, which will place the EAP server in the AAA server that  contains the information required to authenticate the EAP peer.<a href="#section-2-2" class="pilcrow">¶</a></p>
<span id="name-coap-eap-architecture"></span><div id="arch">
<figure id="figure-1">
        <div class="artwork art-text alignLeft" id="section-2-3.1">
<pre>
                  IoT device            Controller
                +------------+        +------------+
                | EAP peer/  |        | EAP auth./ |
                | CoAP server|+------+| CoAP client|
                +------------+  CoAP  +------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-coap-eap-architecture" class="selfRef">CoAP-EAP Architecture</a>
        </figcaption></figure>
</div>
</section>
<section id="section-3">
      <h2 id="name-coap-eap-operation">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-coap-eap-operation" class="section-name selfRef">CoAP-EAP Operation</a>
      </h2>
<p id="section-3-1">
                The sequence flow can be seen in <a href="#figure1" class="xref">Figure 2</a>.  It shows how EAP-X, a generic EAP method, is used as an authentication mechanism.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">(NOTE: any EAP method that exports cryptographic material is valid. For example, EAP-MD5 cannot be used since it does not export key material).<a href="#section-3-2" class="pilcrow">¶</a></p>
<div id="flow-of-operation">
<section id="section-3.1">
        <h3 id="name-general-flow-of-operation">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-general-flow-of-operation" class="section-name selfRef">General flow of operation</a>
        </h3>
<p id="section-3.1-1">
                    The first step to run CoAP-EAP is for the IoT device to discover the Controller, and that it implements the CoAP-EAP service. 
                    To do so, we can rely on any mechanism that allows us to perform this discovery. For example, the discovery mechanism of CoAP. 

                    To access the authentication service, this document defines the well-known URI "/.well-known/a" (to be assigned by IANA). This URI is referring to the authentication service that is present in both the IoT device and the Controller.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">
                    For the rest of this section, the IoT device is referred to as the EAP peer and the Controller as the EAP authenticator.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">
                    In the CoAP-EAP flow of operation, the EAP peer always starts the authentication process by sending the first message. When the EAP peer discovers the presence of the EAP authenticator and wants to start the authentication, it sends a Non-Confirmable "POST /.well-known/a" request (Step 0). This message will carry the option called 'No-Response' <span>[<a href="#RFC7967" class="xref">RFC7967</a>]</span>. The rationale of this option is to avoid waiting for a response that is not needed. So, the use of this option will indicate to the EAP authenticator that the EAP peer is ready to start the authentication process.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4">
                    This message is the only instance where the EAP authenticator acts as a CoAP server and the EAP peer as a CoAP client. After this, the exchange continues with the EAP authenticator as a CoAP client and the EAP peer as a CoAP server. A discussion about the CoAP roles is in <a href="#controller-coap-client" class="xref">Section 5.3</a><a href="#section-3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1-5">
                    Once the EAP authenticator is aware of the intention of the EAP peer of starting an authentication process, sends a Confirmable "POST /.well-known/a" request to the EAP peer(Step 1).  

                    After receiving the first POST, the EAP peer (CoAP server) assigns a resource to the ongoing authentication process, and answers with an Acknowledgment with a piggybacked response containing the resource identifier in the Location-Path (and/or  Location-Query) Options (Step 2). The path /.well-known/a at this point will not be used. The name of the resource is selected by the CoAP server as it pleases. The only condition is that both end points have to correctly process the following message based on the selected value. As an example, the CoAP server MAY follow the the naming "/a/x". Where "a" is the general name of the authentication service; "x" represents the resource established to process the following message of the authentication. This naming, as example, will be used in the figures of this document.

                    The EAP peer (CoAP server) will only have one authentication session with that particular EAP authenticator (CoAP client) and it will not process EAP authentications in parallel (with the same EAP authenticator) to save resources.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">
                    In this exchange (Step 1 and 2), the EAP-Request/Identity (EAP Req/Id) and EAP-Response/Identity (EAP Resp/Id) messages are exchanged between the EAP authenticator and the EAP peer. Upon the reception of the EAP Req/Id message, the EAP authenticator sends this message to the EAP server. The EAP server is in charge of steering the conversation, choosing the EAP method to be used (e.g. EAP-X).  

                    In this exchange we can also see the cryptosuite negotiation. If the cryptosuite is not sent, the default cryptosuite is used. The first message (Step 1) carries, concatenated to the EAP Req/Id, a CBOR array containing a list with the cryptosuites, and the CoAP server in the next message will confirm by sending a choice. The details of the cryptosuite negotiation are discussed in <a href="#crypto-negotiation" class="xref">Section 4.1</a>.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<p id="section-3.1-7">
                    NOTE: Since only an ongoing EAP authentication is permitted per EAP authenticator and EAP is a lock-step protocol, a CoAP Token of a constant value can be used throughout the authentication process. An empty Token MAY be considered to reduce bytes.<a href="#section-3.1-7" class="pilcrow">¶</a></p>
<p id="section-3.1-8">
                    From now on, the EAP authenticator and the EAP peer will exchange EAP packets related to the EAP method, transported in the CoAP message payload (Steps 3,4,5,6). The EAP authenticator will use the POST method in a Confirmable message to send EAP requests to the EAP peer. The EAP peer will use a piggybacked response in the Acknowledgment message to carry the EAP response. EAP requests and responses are represented in <a href="#figure1" class="xref">Figure 2</a> using the nomenclature (EAP-X-Req n) and (EAP-X-Resp n) respectively. 'X' indicates the EAP method use. 'n' indicates the identifier of the EAP message, which is shown monotonically increasing from 1 in this flow of operation.<a href="#section-3.1-8" class="pilcrow">¶</a></p>
<p id="section-3.1-9">
                    When a Confirmable POST message arrives (e.g, /a/x) carrying an EAP request message, if processed correctly, returns an EAP Response. Along with the EAP response, a new resource is created (e.g, /a/y) and the ongoing resource (i.e., /a/x) is erased. This EAP response will go in a CoAP piggybacked response that will also indicate the new resource in the Location-Path  (and/or  Location-Query) Options. In case there is an error processing a legitimate message, the server will return an (4.00 Bad Request). There is a discussion about error handling in <a href="#error-handling" class="xref">Section 3.2</a>.<a href="#section-3.1-9" class="pilcrow">¶</a></p>
<p id="section-3.1-10">
                    When the authentication is completed correctly, the EAP server sends an EAP Success message, and both CoAP endpoints will share a Master Session Key (MSK)<span>[<a href="#RFC5295" class="xref">RFC5295</a>]</span>.<a href="#section-3.1-10" class="pilcrow">¶</a></p>
<p id="section-3.1-11">
                   Using the MSK, an OSCORE security association is established between EAP peer and EAP authenticator, which serves as key confirmation of the MSK and to provide integrity and authentication to the last exchange (Steps 7 and 8).

                   From that point, any exchange between both CoAP endpoints is protected with OSCORE. Before sending the EAP success to the EAP peer, the EAP authenticator can derive the OSCORE Security Context. The EAP peer can do so when it receives the message containing the EAP success, and the session liftime, to verify the message from the EAP authenticator and generate the answer (Step 8). The establishment of the OSCORE Security Context is discussed in <a href="#OSCORE" class="xref">Section 4.2</a>.

                   The Session Lifetime, in seconds, is represented with a unsigned integer in a CBOR array. The disposition of the information is the same to the cryptosuite negotiation () see <a href="#crypto-negotiation" class="xref">Section 4.1</a>).<a href="#section-3.1-11" class="pilcrow">¶</a></p>
<span id="name-coap-eap-flow-of-operation"></span><div id="figure1">
<figure id="figure-2">
          <div class="artwork art-text alignLeft" id="section-3.1-12.1">
<pre>
         EAP peer                                  EAP Auth.
      (CoAP server)                             (CoAP client)
      -------------                             -------------
           | NON [0x6af5] POST /.well-known/a        |
        0) | Token (0xab), No-Response               |
           |----------------------------------------&gt;|
           |        CON [0x7654] POST /.well-known/a |
           |                            Token (0xac) |
           |        Payload (EAP Req/Id||Cryptosuite)|
        1) |&lt;----------------------------------------|
           | ACK [0x7654]                            |
           | Token (0xac)                            |
           | 2.01 Created Location-Path [/a/x]       |
           | Payload (EAP Resp/Id||Cryptosuite)      |
        2) |----------------------------------------&gt;|
           |                  CON [0x8694] POST /a/x |
           |                            Token (0xac) |
           |                     Payload EAP-X-Req 1 |
        3) |&lt;----------------------------------------|
           | ACK [0x8694]                            |
           | Token (0xac)                            |
           | 2.01 Created Location-Path [/a/y]       |
           | Payload EAP-X-Resp 1                    |
        4) |----------------------------------------&gt;|
                              ....

           |                CON [0x9869] POST /a/y   |
           |                            Token (0xac) |
           |                   Payload EAP-X-Req (n) |
        5) |&lt;----------------------------------------|
           | ACK [0x9869]                            |
           | Token (0xac)                            |
           | 2.01 Created Location-Path [/a/z]       | MSK
           | Payload EAP-X-Resp (n)                  |  |
        6) |----------------------------------------&gt;|  v
           |                CON [0x7811] POST /a/z   |OSCORE
           |                  Token (0xac), OSCORE   |CONTEXT
 MSK       | Payload (EAP success||Session-Lifetime) |(*)
  |     7) |&lt;----------------------------------------|
  v        | ACK [0x7811]                            |
OSCORE  (*)| Token (0xac), OSCORE                    |
CONTEXT 8) |----------------------------------------&gt;|
           (*) Protected with OSCORE
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-coap-eap-flow-of-operation" class="selfRef">CoAP-EAP flow of operation</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="error-handling">
<section id="section-3.2">
        <h3 id="name-error-handling">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-error-handling" class="section-name selfRef">Error handling</a>
        </h3>
<p id="section-3.2-1">
                    This section elaborates how different errors are handled, from a non-responding endpoint, dealing lost messages and initial POST messages arriving arriving out of place.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">
                    In general, the CoAP engine, in the client and server, will take care of retransmissions, dealing with lost messages sent out of place, and sending the errors when a client is trying to access a resource that does not exist in the CoAP server.
                    But, there are cases where the messages can arrive out of place, and the CoAP engine may not recognize them as old or as a retransmission, and send them to the CoAP application.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<section id="section-3.2.1">
          <h4 id="name-non-responding-endpoint">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-non-responding-endpoint" class="section-name selfRef">Non-responding endpoint</a>
          </h4>
<p id="section-3.2.1-1">
                    When CoAP-EAP starts, a state is created that stores all information related to the process. If by any reason one of the entities becomes non-responding, the state should be only kept form a period of time before it is removed. 
                    According to CoAP, EXCHANGE_LIFETIME considers the time it takes until a client stops expecting a response to a Confirmable request. A timer is reseted every time a message is sent. If EXCHANGE_LIFETIME has passed waiting the next message, both entities will delete the CoAP-EAP state if the authentication process has not finished correctly.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3.2.2">
          <h4 id="name-messages-with-well-known-a">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-messages-with-well-known-a" class="section-name selfRef">Messages with /.well-known/a</a>
          </h4>
<p id="section-3.2.2-1">
                    The reception of messages containing /.well-known/a needs some additional considerations, as the resource is always available in both entities. This message can be sent out of the expected order by the EAP peer as well as by the EAP authenticator for reasons such as network delays.<a href="#section-3.2.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2.2-2">
                                    
                    When this message arrives to the other entity during an ongoing authentication, and it is not recognized by the CoAP engine as an old or retransmitted message, arriving to the CoAP-EAP application, we describe the behavior depending on the entity receiving this message. 
                    
                    If this message is from the EAP authenticator to the peer, being a Confirmable POST message, will honor the request and answer, in this case with a CoAP Reset message, that will indicate that, since there is an  authentication ongoing, the EAP authenticator is not in disposition of processing this message. This exchange is illustrated in <a href="#figure7" class="xref">Figure 3</a>.<a href="#section-3.2.2-2" class="pilcrow">¶</a></p>
<span id="name-well-known-a-during-ongoing"></span><div id="figure7">
<figure id="figure-3">
            <div class="artwork art-text alignLeft" id="section-3.2.2-3.1">
<pre>
        EAP peer                                  EAP Auth.
      (CoAP server)            .                (CoAP client)
      -------------            .               -------------
           |                                         |
           |        CON [0x7654] POST /.well-known/a |
           |                            Token (0xac) |
           |        Payload (EAP Req/Id||Cryptosuite)|
           |&lt;----------------------------------------|
           |                                         |
           | RST [0x7654]                            |
           | 0.00 Code                               |
           |----------------------------------------&gt;|
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-well-known-a-during-ongoing" class="selfRef">/.well-known/a during ongoing authentication from the EAP authenticator</a>
            </figcaption></figure>
</div>
<p id="section-3.2.2-4">

                    In case the message goes from the EAP peer to the authenticator, being a Non-confirmable POST message with the No-Response Option, there is no need to further process this message, and can be silently ignored. This exchange is illustrated in <a href="#figure8" class="xref">Figure 4</a>.<a href="#section-3.2.2-4" class="pilcrow">¶</a></p>
<span id="name-well-known-a-during-ongoing-"></span><div id="figure8">
<figure id="figure-4">
            <div class="artwork art-text alignLeft" id="section-3.2.2-5.1">
<pre>
        EAP peer                                  EAP Auth.
      (CoAP server)            .                (CoAP client)
      -------------            .               -------------
           |                                         |
           | NON [0x6af5] POST /.well-known/a        |
           | Token (0xab), No-Response               |
           |----------------------------------------&gt;| --+
           |                   .                     |   |
           |                   .                     |   v
                                                     (Ignored)
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-well-known-a-during-ongoing-" class="selfRef">/.well-known/a during ongoing authentication from the EAP peer</a>
            </figcaption></figure>
</div>
<p id="section-3.2.2-6">
                    When this message arrives to the CoAP-EAP application, and there is no authentication ongoing it will understand that a new authentication process is starting.

                    In case the message goes from the EAP authenticator to the peer, and no prior Non-confirmable /.well-known/a message was sent by the EAP peer, it will send a Reset message indicating that is not in disposition to process this message, as it has to be the EAP peer the one to initiate the process. This exchange is illustrated in <a href="#figure9" class="xref">Figure 5</a>.<a href="#section-3.2.2-6" class="pilcrow">¶</a></p>
<span id="name-well-known-a-with-no-ongoin"></span><div id="figure9">
<figure id="figure-5">
            <div class="artwork art-text alignLeft" id="section-3.2.2-7.1">
<pre>
        EAP peer                                  EAP Auth.
      (CoAP server)                             (CoAP client)
      -------------                            -------------
           |                                         |
           |        CON [0x7654] POST /.well-known/a |
           |                            Token (0xac) |
           |        Payload (EAP Req/Id||Cryptosuite)|
           |&lt;----------------------------------------|
           |                                         |
           | RST [0x7654]                            |
           | 0.00 Code                               |
           |----------------------------------------&gt;|
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-well-known-a-with-no-ongoin" class="selfRef">/.well-known/a with no ongoing authentication from the EAP authenticator</a>
            </figcaption></figure>
</div>
<p id="section-3.2.2-8">
                    
                    If this message is from the EAP peer to the authenticator, receiving a Non-confirmable /.well-known/a message, it will understand it as the start of the process by the EAP peer, and start a normal process of authentication as depicted in the general flow of operation in <a href="#figure1" class="xref">Figure 2</a>.<a href="#section-3.2.2-8" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="managing_boot_state">
<section id="section-3.3">
        <h3 id="name-managing-the-state-of-the-s">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-managing-the-state-of-the-s" class="section-name selfRef">Managing the State of the Service</a>
        </h3>
<p id="section-3.3-1">
                The management of the CoAP-EAP state, can be done in different ways. The Controller MAY choose to delete it as explained in <a href="#del_boot_state" class="xref">Section 3.3.1</a>. On the other hand, the IoT device may need to renew the CoAP-EAP state because the key material is close to expire, as elaborated in <a href="#reauthentication" class="xref">Section 3.3.2</a>.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<div id="del_boot_state">
<section id="section-3.3.1">
          <h4 id="name-deleting-the-state">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-deleting-the-state" class="section-name selfRef">Deleting the state</a>
          </h4>
<p id="section-3.3.1-1">
                There are situations where the current CoAP-EAP state might need to be removed. For instance due to its expiration or a forced removal if the IoT device needs to be expelled from the security domain. This exchange is illustrated in <a href="#figure4" class="xref">Figure 6</a>.

                If the Controller, which implements the CoAP client in this exchange, deems necessary the removal of the state, it can send a DELETE command to the CoAP server, referencing the last CoAP-EAP state resource given by the CoAP server, whose identifier will be the last one received with the ACK of the EAP success message (/a/z in <a href="#figure1" class="xref">Figure 2</a>)

                This message will be protected with the OSCORE security association to prevent forgery. 

                Upon reception of this message, the CoAP server sends piggybacked response to the client with the Code 2.02 Deleted, which is also protected with the OSCORE security association.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<span id="name-deleting-state"></span><div id="figure4">
<figure id="figure-6">
            <div class="artwork art-text alignLeft" id="section-3.3.1-2.1">
<pre>
        EAP peer                                  EAP Auth.
      (CoAP server)                             (CoAP client)
      -------------                             -------------
           |                                         |
           |                CON [0x7654] DELETE /a/z |
           |                            Token (0xac) |
           |                                  OSCORE |
           |&lt;----------------------------------------|
           |                                         |
           | ACK [0x7654]                            |
           | Token (0xac)                            |
           | 2.02 Deleted                            |
           | OSCORE                                  |
           |----------------------------------------&gt;|
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-deleting-state" class="selfRef">Deleting state</a>
            </figcaption></figure>
</div>
<p id="section-3.3.1-3">


                If the ACK from the CoAP server does not arrive, after the maximum retransmission attempts, the CoAP client will remove the state from its side.<a href="#section-3.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="reauthentication">
<section id="section-3.3.2">
          <h4 id="name-reauthentication">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-reauthentication" class="section-name selfRef">Reauthentication</a>
          </h4>
<p id="section-3.3.2-1">
                    When the CoAP-EAP state is close to expire, the IoT device MAY want to start a re-authentication process to renew the state. Since the initial authentication is usually taxing, it is assumed to be done only once over a long period of time.  If further EAP re-authentications for refreshing the key material are necessary, there are other methods that can be used to perform these re-authentications. For example, the EAP re-authentication protocol (ERP) <span>[<a href="#RFC6696" class="xref">RFC6696</a>]</span>, EAP-NOOB <span>[<a href="#I-D.ietf-emu-eap-noob" class="xref">I-D.ietf-emu-eap-noob</a>]</span>, or  EAP-AKA' <span>[<a href="#RFC5448" class="xref">RFC5448</a>]</span> MAY be used to avoid repeating the entire EAP exchange. 

                    The message flow for the reauthentication will be exactly the same as the one shown in <a href="#figure1" class="xref">Figure 2</a>, using a more lightweight alternative to do a re-authentication. While the re-authentication is ongoing, two different CoAP-EAP states will be active. Once the reauthentication is completed and OSCORE is exchanged using the newly derived key material, the old CoAP-EAP state is deleted. If by any reason, the reauthentication fails to complete, the old CoAP-EAP state will be available until it expires.<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
<div id="key_deriv">
<section id="section-4">
      <h2 id="name-cryptosuite-negotiation-and">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-cryptosuite-negotiation-and" class="section-name selfRef">Cryptosuite negotiation and key derivation</a>
      </h2>
<div id="crypto-negotiation">
<section id="section-4.1">
        <h3 id="name-cryptographic-suite-negotia">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-cryptographic-suite-negotia" class="section-name selfRef">Cryptographic suite negotiation</a>
        </h3>
<p id="section-4.1-1">
                   How the cryptographic suite is selected is important. OSCORE runs after the EAP authentication, using the cryptosuite selected in the cryptosuite negotiation. 

                   To negotiate the cryptosuite, the protocol follows a simple approach by sending in the first message from the Controller, a list in decreasing order or preference, with the identifiers of the supported cryptosuites. In the response to that message, the IoT device sends a response with the choice.  

                   To do this without resorting to the creation of a new CoAP option tailored to this purpose, by leveraging the fact that in the payload it is always expected at the beginning the EAP message, which by design specifies its own length. Following the EAP message, optionally there is a CBOR array that contains the cryptosuites. Be it the list of cryptosuites supported by the Controller, or the one chosen by the IoT device. An example of how the fields are arranged in the CoAP payload can be seen in <a href="#figure5" class="xref">Figure 7</a>.
                   An example of the exchange with the cryptosuite negotiation is shown in <a href="#figure6" class="xref">Figure 8</a>, where can be appreciated the disposition of both EAP-Request/Identity and Response/Identity, followed by the CBOR array. It is worth noting that the CBOR array is also expected in the EAP Success, containing the Session Lifetime.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<span id="name-how-the-cypersuites-are-sen"></span><div id="figure5">
<figure id="figure-7">
          <div class="artwork art-text alignLeft" id="section-4.1-2.1">
<pre>

            +-----+-----------+-------+------++------------+
            |Code |Identifier |Length |Data  ||Cyphersuites|
            +-----+-----------+-------+------++------------+
                        EAP Packet              CBOR Array

</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-how-the-cypersuites-are-sen" class="selfRef">How the cypersuites are sent in the CoAP payload</a>
          </figcaption></figure>
</div>
<span id="name-cryptosuite-negotition-in-t"></span><div id="figure6">
<figure id="figure-8">
          <div class="artwork art-text alignLeft" id="section-4.1-3.1">
<pre>
         EAP peer                                  EAP Auth.
      (CoAP server)                             (CoAP client)
      -------------                             -------------
           |                                         |
           |                  ...                    |
           |----------------------------------------&gt;|
           |        CON [0x7654] POST /.well-known/a |
           |                            Token (0xac) |
           |  Payload (EAP Req/Id, CBORArray[0,1,2]) |
        1) |&lt;----------------------------------------|
           | ACK [0x7654]                            |
           | Token (0xac)                            |
           | 2.01 Created Location-Path [/a/x]       |
           | Payload (EAP Resp/Id, CBORArray[0])     |
        2) |----------------------------------------&gt;|
                              ...
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-cryptosuite-negotition-in-t" class="selfRef">Cryptosuite negotition in t CoAP-EAP flow</a>
          </figcaption></figure>
</div>
<p id="section-4.1-4">
                In case there is no CBOR Array stating the cryptosuites, the default cryptosuites are applied.
                If the Controller sends a restricted list of cryptosuites that is willing to accept, and the ones supported by the IoT device are not in that list, the IoT device will respond with a 4.00 Bad Request, expressing in the Payload the cryptosuites supported. <a href="#figure10" class="xref">Figure 9</a> illustrates this exchange.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<span id="name-cryptosuite-negotition-fail"></span><div id="figure10">
<figure id="figure-9">
          <div class="artwork art-text alignLeft" id="section-4.1-5.1">
<pre>
         EAP peer                                  EAP Auth.
      (CoAP server)                             (CoAP client)
      -------------                             -------------
           |                                         |
           |                  ...                    |
           |----------------------------------------&gt;|
           |        CON [0x7654] POST /.well-known/a |
           |                            Token (0xac) |
           |    Payload (EAP Req/Id, CBORArray[1,2]) |
        1) |&lt;----------------------------------------|
           | ACK [0x7654]                            |
           | Token (0xac)                            |
           | 4.00 Bad Request                        |
           | Payload (CBORArray[0])                  |
        2) |----------------------------------------&gt;|

</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-cryptosuite-negotition-fail" class="selfRef">Cryptosuite negotition failed</a>
          </figcaption></figure>
</div>
<p id="section-4.1-6">
                To avoid a downgrading attack, we will use the proposed cryptosuite list and the choice in the key derivation process, to bind them to the generated keys as explained in <a href="#OSCORE" class="xref">Section 4.2</a>.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1-7">
                As a result of a successful EAP authentication, both the CoAP server and CoAP client share a Master Session Key (MSK). The MSK is a fresh key, so any key derived from the MSK will be also fresh. 

                The CoAP-EAP exchange finishes with the establishment of an OSCORE security association for the CoAP-EAP service. The security level for the CoAP-EAP exchanges with OSCORE is with integrity. 

                Due to the requirement of using OSCORE, the cryptosuite requirements are inherited from the ones established by OSCORE. This requires for the HKDF algorithm by default HKDF SHA-256 and the AEAD algorithm by default AES-CCM-16-64-128 to be mandatory to implement. The other cryptosuites supported and negotiated in the cryptosuite negotiation are, expressed as tuples of AEAD Algorithm and Hash Algorithm, the following:<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<ul class="ulEmpty normal">
<li class="ulEmpty normal" id="section-4.1-8.1">
                            0. AES-CCM-16-64-128, SHA-256<a href="#section-4.1-8.1" class="pilcrow">¶</a>
</li>
          <li class="ulEmpty normal" id="section-4.1-8.2">
                            1. A128GCM, SHA-256<a href="#section-4.1-8.2" class="pilcrow">¶</a>
</li>
          <li class="ulEmpty normal" id="section-4.1-8.3">
                            2. A256GCM, SHA-384<a href="#section-4.1-8.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.1-9">

                This specification uses the (HMAC)-based key derivation function (HKDF) defined in <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span> to derive the necessary key material. Since the derivation will be done using the MSK, which is considered fresh key material, we will use the HKDF-Expand function, which we will shorten here as KDF.
                In addition to the generation of the OSCORE parameters, we consider the derivation of a pre-shared key that can be used for a DTLS security association (DTLS PSK).<a href="#section-4.1-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="OSCORE">
<section id="section-4.2">
        <h3 id="name-deriving-the-oscore-securit">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-deriving-the-oscore-securit" class="section-name selfRef">Deriving the OSCORE Security Context</a>
        </h3>
<p id="section-4.2-1">
                    The derivation of the security context for OSCORE has a three purposes:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-2.1">
                            Secure the last two messages of the CoAP-EAP exchange, while establishing the OSCORE security association<a href="#section-4.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-2.2">
                            Perform key confirmation<a href="#section-4.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-2.3">
                            Prevent a downgrading attack.<a href="#section-4.2-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-3">
  

                    We can achieve this because, after a successful authentication, both the EAP authenticator and the peer share the MSK. From this MSK, necessary key material for the OSCORE context is derived. If the contexts match, both entities confirm they have the same Master Secret, and therefore they share the same MSK. We prevent a downgrading attack, by embedding into the derivation process, context information gathered from the cryptosuite negotiation. To do this, we concatenate to the label, the content of the cryptosuites negotiation (which we refer to here as CSO), using the null string for any part of the negotiation missing. If an attacker changes the value of the cryptosuite negotiation in any of the messages, the result will be different security contexts.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">
                    Key material needed to derive the OSCORE Security Context, from the MSK is done as follows:<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2-5">
                    The Master Secret can be derived by using the chosen cryptosuite and the KDF. The Master Secret can be derived as follows:<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<p id="section-4.2-6">
                      Master Secret = KDF(MSK, CSO | "OSCORE MASTER SECRET", length)<a href="#section-4.2-6" class="pilcrow">¶</a></p>
<p id="section-4.2-7">
                    where:<a href="#section-4.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-8.1">
                            The algorithms are agreed in the cryptosuite negotiation.<a href="#section-4.2-8.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-8.2">
                            The MSK exported by the EAP method. Discussion about the use of the MSK for the key derivation is done in <a href="#security_considerations" class="xref">Section 6</a>.<a href="#section-4.2-8.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-8.3">
                            CSO is the concatenation of the content of the cryptosuite negotiation, in the request and response. If any of the messages did not contain the CBOR array, the null string is used.<a href="#section-4.2-8.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-8.4">
                            "OSCORE MASTER SECRET" is the ASCII code representation of the non-NULL terminated string (excluding the double quotes around it).<a href="#section-4.2-8.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-8.5">
                            CSO and "OSCORE MASTER SECRET" are concatenated.<a href="#section-4.2-8.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-8.6">
                            length is the size of the output key material.<a href="#section-4.2-8.6" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-9">
                  The Master Salt, similarly to the Master Secret, can be derived as follows:<a href="#section-4.2-9" class="pilcrow">¶</a></p>
<p id="section-4.2-10">
                      Master Salt = KDF(MSK, CSO | "OSCORE MASTER SALT", length)<a href="#section-4.2-10" class="pilcrow">¶</a></p>
<p id="section-4.2-11">
                    where:<a href="#section-4.2-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-12.1">
                            The algorithms are agreed in the cryptosuite negotiation.<a href="#section-4.2-12.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-12.2">
                            The MSK exported by the EAP method. Discussion about the use of the MSK for the key derivation is done in <a href="#security_considerations" class="xref">Section 6</a>.<a href="#section-4.2-12.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-12.3">
                            CSO is the concatenation of the content of the cryptosuite negotiation, in the request and response. If any of the messages did not contain the CBOR array, the null string is used.<a href="#section-4.2-12.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-12.4">
                            "OSCORE MASTER SALT" is the ASCII code representation of the non-NULL terminated string (excluding the double quotes around it).<a href="#section-4.2-12.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-12.5">
                            CSO and "OSCORE MASTER SECRET" are concatenated.<a href="#section-4.2-12.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-12.6">
                            length is the size of the output key material.<a href="#section-4.2-12.6" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-13">

                Regarding the  Recipient ID and Sender ID, as their purpose is to serve as identifiers of both entities involved in the exchange, these identifiers are generated as follows:<a href="#section-4.2-13" class="pilcrow">¶</a></p>
<p id="section-4.2-14">
                      Recipient ID = KDF(MSK, "OSCORE RECIPIENT ID", length)<a href="#section-4.2-14" class="pilcrow">¶</a></p>
<p id="section-4.2-15">
                    where:<a href="#section-4.2-15" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-16.1">
                            The algorithms are agreed in the cryptosuite negotiation.<a href="#section-4.2-16.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-16.2">
                            "OSCORE RECIPIENT ID" is the ASCII code representation of the non-NULL terminated string (excluding the double quotes around it).<a href="#section-4.2-16.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-16.3">
                            length is the size of the output. This value will be the maximum allowed length according to the limits established by OSCORE to Recipient ID, depending on the chosen cryptographic algorithms <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>.<a href="#section-4.2-16.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-17">
                      For the Sender ID, analogously to the Recipient ID:<a href="#section-4.2-17" class="pilcrow">¶</a></p>
<p id="section-4.2-18">
                      Sender ID = KDF(MSK, "OSCORE SENDER ID", length)<a href="#section-4.2-18" class="pilcrow">¶</a></p>
<p id="section-4.2-19">
                    where:<a href="#section-4.2-19" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-20.1">
                            The algorithms are agreed in the cryptosuite negotiation.<a href="#section-4.2-20.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-20.2">
                            "OSCORE RECIPIENT ID" is the ASCII code representation of the non-NULL terminated string (excluding the double quotes around it).<a href="#section-4.2-20.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-20.3">
                            length is the size of the output. The maximum value allowed is established by OSCORE to Sender ID, depending on the chosen cryptographic algorithms.<a href="#section-4.2-20.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<section id="section-4.3">
        <h3 id="name-deriving-dtls-psk">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-deriving-dtls-psk" class="section-name selfRef">Deriving DTLS PSK</a>
        </h3>
<p id="section-4.3-1">
                    It is also possible to derive a pre-shared key for DTLS <span>[<a href="#RFC6347" class="xref">RFC6347</a>]</span>, refereed to here as "DTLS PSK", from the MSK between both CoAP endpoints if required. 
                    The length of the DTLS PSK will depend on the cryptosuite. To have a cryptographic material with sufficient length  we will derive a key of 32 bytes that can be later truncated if needed:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">
                       DTLS PSK = KDF(MSK, "DTLS PSK", length).<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">
                    where:<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-4.1">
                            MSK is exported by the EAP method.<a href="#section-4.3-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-4.2">
                            "DTLS PSK" is the ASCII code representation of the non-NULL terminated string (excluding the double quotes around it).<a href="#section-4.3-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.3-4.3">
                            length is the size of the output key material.<a href="#section-4.3-4.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</section>
</div>
<div id="implementation_considerations">
<section id="section-5">
      <h2 id="name-discussion">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-discussion" class="section-name selfRef">Discussion</a>
      </h2>
<section id="section-5.1">
        <h3 id="name-coap-as-eap-lower-layer">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-coap-as-eap-lower-layer" class="section-name selfRef">CoAP as EAP lower layer</a>
        </h3>
<p id="section-5.1-1"> This section discusses the suitability of the CoAP protocol as EAP lower layer, and reviews the requisites imposed by the EAP protocol to any protocol that transports EAP. What EAP expects from its lower layers can be found in section 3.1 of <span>[<a href="#RFC3748" class="xref">RFC3748</a>]</span>, which is elaborated next:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">
                    Unreliable transport. EAP does not assume that lower layers are reliable. CoAP provides a reliability mechanism through the use of Confirmable messages.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">
                 Lower layer error detection. EAP relies on lower layer error detection (e.g., CRC, Checksum, MIC, etc.). CoAP goes on top of UDP which provides a checksum mechanism over its payload.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">
                   Lower layer security. EAP does not require security services from the lower layers.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">
                    Minimum MTU.  Lower layers need to provide an EAP MTU size of 1020 octets or greater. CoAP assumes an upper bound of 1024 for its payload which covers the requirements of EAP.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1-6">
                    Ordering guarantees. EAP relies on lower layer ordering guarantees for correct operation. 

                    Regarding message ordering, every time a new message arrives at the authentication service hosted by the IoT device, a new resource is created and this is indicated in a 2.01 Created response code along with the name of the new resource via Location-Path or Location-Query. This way the application indicates that its state has advanced.   

                    Although the <span>[<a href="#RFC3748" class="xref">RFC3748</a>]</span> states: "EAP provides its own support for duplicate elimination and retransmission", EAP is also reliant on lower layer ordering guarantees. In this regard, the RFC talks about possible duplication and says: "Where the lower layer is reliable, it will provide the EAP layer with a non-duplicated stream of packets. However,  while it is desirable that lower layers provide for non-duplication, this is not a requirement". CoAP is providing a non-duplicated stream of packets and accomplish the "desirable" non-duplication. In addition, <span>[<a href="#RFC3748" class="xref">RFC3748</a>]</span> says that when EAP runs over a reliable lower layer "the authenticator retransmission timer SHOULD be set to an infinite value, so that retransmissions do not occur at the EAP layer."<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<p id="section-5.1-7">
                    NOTE: This document does not assume any specific naming schema.  The only requisite that both CoAP client and server MUST agree, is the establishment of a nomenclature indicates that the next URI used to refer to a resource, univocally points to the next expected EAP exchange.<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<p id="section-5.1-8">
                    Regarding the CoAP Token, CoAP-EAP will use one of a constant value throughout an authentication.  This is because the EAP server will not send a new EAP request until it has processed the expected EAP response. Additionally, there will be a single EAP authentication between the IoT device and the same Controller. This would also enable the possibility of using an Empty Token to reduce the number of bytes.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
<p id="section-5.1-9">
                    As we can see, CoAP can fulfill the requirements of EAP to be considered suitable as lower layer.<a href="#section-5.1-9" class="pilcrow">¶</a></p>
</section>
<section id="section-5.2">
        <h3 id="name-size-of-the-eap-lower-layer">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-size-of-the-eap-lower-layer" class="section-name selfRef">Size of the EAP lower layer vs EAP method size</a>
        </h3>
<p id="section-5.2-1">
                Regarding the impact an EAP lower layer will have to the total byte size of the whole exchange, there is a comparison with another network layer based EAP lower layer, PANA <span>[<a href="#RFC5191" class="xref">RFC5191</a>]</span> in  <span>[<a href="#coap-eap" class="xref">coap-eap</a>]</span>.

               Comparing the EAP lower layer (alone) and taking into account EAP. On the one hand, at the EAP lower layer level, the usage of CoAP gives important benefits. On the other hand, when taking into account the EAP method overload, this reduction is less but still significant if the EAP method is lightweight (authors of <span>[<a href="#coap-eap" class="xref">coap-eap</a>]</span> used EAP-PSK as a representative of a lightweight EAP method). If the EAP method is very taxing, the impact of the reduction in size of the EAP lower layer is less significant. This leads to the conclusion that possible next steps in this field could be designing new EAP methods that can be better adapted to the requirements of IoT devices and networks.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">

               However, the impact of the EAP lower layer itself cannot be ignored, hence the proposal of using CoAP as lightweight protocol for this purpose.

               Other EAP methods such as EAP-AKA'<span>[<a href="#RFC5448" class="xref">RFC5448</a>]</span> or new lightweight EAP methods such as EAP-NOOB <span>[<a href="#I-D.ietf-emu-eap-noob" class="xref">I-D.ietf-emu-eap-noob</a>]</span> or EAP-EDHOC <span>[<a href="#I-D.ingles-eap-edhoc" class="xref">I-D.ingles-eap-edhoc</a>]</span> that can benefit from a CoAP-based EAP lower layer, as well as new ones that may be proposed in the future with IoT constraints in mind.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
</section>
<div id="controller-coap-client">
<section id="section-5.3">
        <h3 id="name-controller-as-the-coap-clie">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-controller-as-the-coap-clie" class="section-name selfRef">Controller as the CoAP Client</a>
        </h3>
<p id="section-5.3-1">
                    In general, it is assumed that, since the EAP authenticator (Controller) MAY implement an AAA client to interact with the AAA infrastructure.  Hence, this endpoint will have more resources or, at least, will not be a so constrained device.

                    Due to the constrained capacities of IoT devices, to relieve them of the retransmission tasks, the Controller is set as the CoAP client, for the main exchange following the recommendations of the <span>[<a href="#I-D.ietf-lwig-coap" class="xref">I-D.ietf-lwig-coap</a>]</span> document to simplify the IoT device implementation.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security_considerations">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">
                There are some aspects to be considered such as how authorization is managed, the use of MSK as keying material and how the trust in the Controller is established. Additional considerations such as EAP channel binding as per <span>[<a href="#RFC6677" class="xref">RFC6677</a>]</span> are also discussed here.<a href="#section-6-1" class="pilcrow">¶</a></p>
<section id="section-6.1">
        <h3 id="name-authorization">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-authorization" class="section-name selfRef">Authorization</a>
        </h3>
<p id="section-6.1-1">
                       Authorization is part of bootstrapping.  It serves to establish whether the node can join and the set of conditions it has to adhere. The authorization data will be gathered from the organization that is responsible for the IoT device and sent to the EAP authenticator. 

                       In standalone mode, the authorization information will be in the Controller. If the pass-through mode is used, authorization data received from the AAA server can be delivered by the AAA protocol (e.g.  Diameter).  Providing more fine-grained authorization data can be with the transport of SAML in RADIUS <span>[<a href="#RFC7833" class="xref">RFC7833</a>]</span>.
                      
                       After bootstrapping, additional authorization information to operate in the security domain, e.g., access services offered by other nodes, can be taken care of by the solutions proposed in the ACE WG.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-6.2">
        <h3 id="name-freshness-of-the-key-materi">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-freshness-of-the-key-materi" class="section-name selfRef">Freshness of the key material</a>
        </h3>
<p id="section-6.2-1">
                    In CoAP-EAP there is no nonce exchange to provide freshness to the keys derived from the MSK. The MSK and Extended Master Session Key (EMSK) keys according to the EAP Key Management Framework <span>[<a href="#RFC5247" class="xref">RFC5247</a>]</span> are fresh key material. Since only one authentication is established per EAP authenticator, there is no need for generating additional key material. In case another authentication to be established, a re-authentication can be done, by running the process again, or using a more lightweight EAP method to derive additional key material as elaborated in <a href="#reauthentication" class="xref">Section 3.3.2</a>.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-6.3">
        <h3 id="name-channel-binding-support">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-channel-binding-support" class="section-name selfRef">Channel Binding support</a>
        </h3>
<p id="section-6.3-1">
            According to the <span>[<a href="#RFC6677" class="xref">RFC6677</a>]</span>, channel binding related with EAP, is sent through the EAP method that supports it.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">
                To satisfy the requirements of the document, we need to send the EAP lower layer identifier (To be assigned by IANA), in the EAP Lower-Layer Attribute if RADIUS is used.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
</section>
<section id="section-6.4">
        <h3 id="name-additional-security-conside">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-additional-security-conside" class="section-name selfRef">Additional Security Consideration</a>
        </h3>
<p id="section-6.4-1">
                Other security-related concerns can be how to ensure that the node joining the security domain can in fact trust the Controller. This issue is elaborated in the EAP Key Management Framework <span>[<a href="#RFC5247" class="xref">RFC5247</a>]</span>. In particular, the constrained node knows it can trust the Controller because the key that is used to establish the security association is derived from the MSK. If the Controller has the MSK, it is clear the AAA Server of the node trusted the Controller, which can be considered as a trusted party.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="IANA">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1">
                Considerations for IANA regarding this document:<a href="#section-7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1"> Assignment of EAP lower layer identifier.<a href="#section-7-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.2"> Assignment of the URI /.well-known/a<a href="#section-7-2.2" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<section id="section-8">
      <h2 id="name-acknowledgments">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-8-1">
            We would like to thank as the reviewers of this work: Carsten Bormann, Mohit Sethi, Benjamin Kaduk, Alexandre Petrescu, Pedro Moreno-Sanchez and Eduardo Ingles-Sanchez.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">
            We would also like to thank Gabriel Lopez-Millan for the first review of this document and we would like to thank Ivan Jimenez-Sanchez for the first proof-of-concept implementation of this idea.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">
            And thank for their valuables comments to Alexander Pelov and Laurent Toutain,  especially for the potential optimizations of CoAP-EAP.<a href="#section-8-3" class="pilcrow">¶</a></p>
</section>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3748">[RFC3748]</dt>
        <dd>
<span class="refAuthor">Aboba, B.</span>, <span class="refAuthor">Blunk, L.</span>, <span class="refAuthor">Vollbrecht, J.</span>, <span class="refAuthor">Carlson, J.</span>, and <span class="refAuthor">H. Levkowetz, Ed.</span>, <span class="refTitle">"Extensible Authentication Protocol (EAP)"</span>, <span class="seriesInfo">RFC 3748</span>, <span class="seriesInfo">DOI 10.17487/RFC3748</span>, <time datetime="2004-06" class="refDate">June 2004</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3748">https://www.rfc-editor.org/info/rfc3748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5247">[RFC5247]</dt>
        <dd>
<span class="refAuthor">Aboba, B.</span>, <span class="refAuthor">Simon, D.</span>, and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"Extensible Authentication Protocol (EAP) Key Management Framework"</span>, <span class="seriesInfo">RFC 5247</span>, <span class="seriesInfo">DOI 10.17487/RFC5247</span>, <time datetime="2008-08" class="refDate">August 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5247">https://www.rfc-editor.org/info/rfc5247</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5295">[RFC5295]</dt>
        <dd>
<span class="refAuthor">Salowey, J.</span>, <span class="refAuthor">Dondeti, L.</span>, <span class="refAuthor">Narayanan, V.</span>, and <span class="refAuthor">M. Nakhjiri</span>, <span class="refTitle">"Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK)"</span>, <span class="seriesInfo">RFC 5295</span>, <span class="seriesInfo">DOI 10.17487/RFC5295</span>, <time datetime="2008-08" class="refDate">August 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5295">https://www.rfc-editor.org/info/rfc5295</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5869">https://www.rfc-editor.org/info/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6677">[RFC6677]</dt>
        <dd>
<span class="refAuthor">Hartman, S., Ed.</span>, <span class="refAuthor">Clancy, T.</span>, and <span class="refAuthor">K. Hoeper</span>, <span class="refTitle">"Channel-Binding Support for Extensible Authentication Protocol (EAP) Methods"</span>, <span class="seriesInfo">RFC 6677</span>, <span class="seriesInfo">DOI 10.17487/RFC6677</span>, <time datetime="2012-07" class="refDate">July 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6677">https://www.rfc-editor.org/info/rfc6677</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7967">[RFC7967]</dt>
        <dd>
<span class="refAuthor">Bhattacharyya, A.</span>, <span class="refAuthor">Bandyopadhyay, S.</span>, <span class="refAuthor">Pal, A.</span>, and <span class="refAuthor">T. Bose</span>, <span class="refTitle">"Constrained Application Protocol (CoAP) Option for No Server Response"</span>, <span class="seriesInfo">RFC 7967</span>, <span class="seriesInfo">DOI 10.17487/RFC7967</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7967">https://www.rfc-editor.org/info/rfc7967</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
      <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8613">https://www.rfc-editor.org/info/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="coap-eap">[coap-eap]</dt>
        <dd>
<span class="refAuthor">Garcia-Carrillo, D.</span> and <span class="refAuthor">R. Marin-Lopez</span>, <span class="refTitle">"Lightweight CoAP-Based Bootstrapping Service for the Internet of Things - https://www.mdpi.com/1424-8220/16/3/358"</span>, <time datetime="2016-03" class="refDate">March 2016</time>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</dt>
        <dd>
<span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments (ACE) using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-oauth-authz-36</span>, <time datetime="2020-11-16" class="refDate">16 November 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ace-oauth-authz-36.txt">http://www.ietf.org/internet-drafts/draft-ietf-ace-oauth-authz-36.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-emu-eap-noob">[I-D.ietf-emu-eap-noob]</dt>
        <dd>
<span class="refAuthor">Aura, T.</span>, <span class="refAuthor">Sethi, M.</span>, and <span class="refAuthor">A. Peltonen</span>, <span class="refTitle">"Nimble out-of-band authentication for EAP (EAP-NOOB)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-emu-eap-noob-05</span>, <time datetime="2021-07-12" class="refDate">12 July 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-emu-eap-noob-05.txt">https://www.ietf.org/archive/id/draft-ietf-emu-eap-noob-05.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lwig-coap">[I-D.ietf-lwig-coap]</dt>
        <dd>
<span class="refAuthor">Kovatsch, M.</span>, <span class="refAuthor">Bergmann, O.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"CoAP Implementation Guidance"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lwig-coap-06</span>, <time datetime="2018-07-02" class="refDate">2 July 2018</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lwig-coap-06.txt">http://www.ietf.org/internet-drafts/draft-ietf-lwig-coap-06.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ingles-eap-edhoc">[I-D.ingles-eap-edhoc]</dt>
        <dd>
<span class="refAuthor">Sanchez, E.</span>, <span class="refAuthor">Garcia-Carrillo, D.</span>, and <span class="refAuthor">R. Marin-Lopez</span>, <span class="refTitle">"EAP method based on EDHOC Authentication"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ingles-eap-edhoc-01</span>, <time datetime="2020-11-02" class="refDate">2 November 2020</time>, <span>&lt;<a href="https://www.ietf.org/internet-drafts/draft-ingles-eap-edhoc-01.txt">https://www.ietf.org/internet-drafts/draft-ingles-eap-edhoc-01.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="lo-coap-eap">[lo-coap-eap]</dt>
        <dd>
<span class="refAuthor">Garcia-Carrillo, D.</span>, <span class="refAuthor">Marin-Lopez, R.</span>, <span class="refAuthor">Kandasamy, A.</span>, and <span class="refAuthor">A. Pelov</span>, <span class="refTitle">"A CoAP-Based Network Access Authentication Service for Low-Power Wide Area Networks: LO-CoAP-EAP - https://www.mdpi.com/1424-8220/17/11/2646"</span>, <time datetime="2017-11" class="refDate">November 2017</time>. </dd>
<dd class="break"></dd>
<dt id="RFC4764">[RFC4764]</dt>
        <dd>
<span class="refAuthor">Bersani, F.</span> and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"The EAP-PSK Protocol: A Pre-Shared Key Extensible Authentication Protocol (EAP) Method"</span>, <span class="seriesInfo">RFC 4764</span>, <span class="seriesInfo">DOI 10.17487/RFC4764</span>, <time datetime="2007-01" class="refDate">January 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4764">https://www.rfc-editor.org/info/rfc4764</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5191">[RFC5191]</dt>
        <dd>
<span class="refAuthor">Forsberg, D.</span>, <span class="refAuthor">Ohba, Y., Ed.</span>, <span class="refAuthor">Patil, B.</span>, <span class="refAuthor">Tschofenig, H.</span>, and <span class="refAuthor">A. Yegin</span>, <span class="refTitle">"Protocol for Carrying Authentication for Network Access (PANA)"</span>, <span class="seriesInfo">RFC 5191</span>, <span class="seriesInfo">DOI 10.17487/RFC5191</span>, <time datetime="2008-05" class="refDate">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5191">https://www.rfc-editor.org/info/rfc5191</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5448">[RFC5448]</dt>
        <dd>
<span class="refAuthor">Arkko, J.</span>, <span class="refAuthor">Lehtovirta, V.</span>, and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"Improved Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA')"</span>, <span class="seriesInfo">RFC 5448</span>, <span class="seriesInfo">DOI 10.17487/RFC5448</span>, <time datetime="2009-05" class="refDate">May 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5448">https://www.rfc-editor.org/info/rfc5448</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6347">[RFC6347]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span> and <span class="refAuthor">N. Modadugu</span>, <span class="refTitle">"Datagram Transport Layer Security Version 1.2"</span>, <span class="seriesInfo">RFC 6347</span>, <span class="seriesInfo">DOI 10.17487/RFC6347</span>, <time datetime="2012-01" class="refDate">January 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6347">https://www.rfc-editor.org/info/rfc6347</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6696">[RFC6696]</dt>
        <dd>
<span class="refAuthor">Cao, Z.</span>, <span class="refAuthor">He, B.</span>, <span class="refAuthor">Shi, Y.</span>, <span class="refAuthor">Wu, Q., Ed.</span>, and <span class="refAuthor">G. Zorn, Ed.</span>, <span class="refTitle">"EAP Extensions for the EAP Re-authentication Protocol (ERP)"</span>, <span class="seriesInfo">RFC 6696</span>, <span class="seriesInfo">DOI 10.17487/RFC6696</span>, <time datetime="2012-07" class="refDate">July 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6696">https://www.rfc-editor.org/info/rfc6696</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7833">[RFC7833]</dt>
        <dd>
<span class="refAuthor">Howlett, J.</span>, <span class="refAuthor">Hartman, S.</span>, and <span class="refAuthor">A. Perez-Mendez, Ed.</span>, <span class="refTitle">"A RADIUS Attribute, Binding, Profiles, Name Identifier Format, and Confirmation Methods for the Security Assertion Markup Language (SAML)"</span>, <span class="seriesInfo">RFC 7833</span>, <span class="seriesInfo">DOI 10.17487/RFC7833</span>, <time datetime="2016-05" class="refDate">May 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7833">https://www.rfc-editor.org/info/rfc7833</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8824">[RFC8824]</dt>
        <dd>
<span class="refAuthor">Minaburo, A.</span>, <span class="refAuthor">Toutain, L.</span>, and <span class="refAuthor">R. Andreasen</span>, <span class="refTitle">"Static Context Header Compression (SCHC) for the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 8824</span>, <span class="seriesInfo">DOI 10.17487/RFC8824</span>, <time datetime="2021-06" class="refDate">June 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8824">https://www.rfc-editor.org/info/rfc8824</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TS133.501">[TS133.501]</dt>
      <dd>
<span class="refAuthor">ETSI</span>, <span class="refTitle">"5G; Security architecture and procedures for 5G System - TS 133 501 V15.2.0 (2018-10)"</span>, <time datetime="2018" class="refDate">2018</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<section id="appendix-A">
      <h2 id="name-examples-of-use-case-scenar">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-examples-of-use-case-scenar" class="section-name selfRef">Examples of Use Case Scenario</a>
      </h2>
<p id="appendix-A-1">
                For a IoT device to act as a trustworthy entity within a security domain, certain key material is needed to be shared between the IoT device and the Controller.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">
                Next, we elaborate on examples of different use case scenarios about the usage of CoAP-EAP.  Generally, we are dealing with 4 entities:<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-3.1">
                        2 nodes (A and B), which are IoT devices. They are the EAP peers.<a href="#appendix-A-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-3.2">
                        1 controller (C). The controller manages a domain where nodes can be deployed. It can be considered a more powerful machine than the IoT devices.<a href="#appendix-A-3.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-3.3">
                        1 AAA server (AAA) - Optional. The AAA is an Authentication, Authorization and Accounting Server, which is not constrained. Here, the Controller acts as EAP authenticator in pass-through mode.<a href="#appendix-A-3.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="appendix-A-4">
                Generally, any IoT device wanting to join the domain managed by the Controller MUST perform a CoAP-EAP authentication with the Controller (C). This authentication MAY involve an external AAA server.  This means that A and B, once deployed, will run CoAP-EAP once, as a bootstrapping phase, to establish a security association with C. Moreover, any other entity, which wants to join and establish communications with nodes under C's domain must also do the same.

                By using EAP, we can have the flexibility of having different types of credentials. For instance, if we have a device that is not battery dependent, and not very constrained, we could use a heavier authentication method. With varied IoT devices and networks we might need to resort to more lightweight authentication methods (e.g., EAP-NOOB<span>[<a href="#I-D.ietf-emu-eap-noob" class="xref">I-D.ietf-emu-eap-noob</a>]</span>, EAP-AKA'<span>[<a href="#RFC5448" class="xref">RFC5448</a>]</span>, EAP-PSK<span>[<a href="#RFC4764" class="xref">RFC4764</a>]</span>, EAP-EDHOC<span>[<a href="#I-D.ingles-eap-edhoc" class="xref">I-D.ingles-eap-edhoc</a>]</span>, etc.) being able to adapt to different types of devices according to organization policies or devices capabilities.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<section id="appendix-A.1">
        <h3 id="name-example-1-coap-eap-in-ace">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-example-1-coap-eap-in-ace" class="section-name selfRef">Example 1:  CoAP-EAP in ACE</a>
        </h3>
<p id="appendix-A.1-1">
                    In ACE, the process of Client registration and provisioning of credentials to the client is not specified. The process of Client registration and provisioning can be achieved using CoAP-EAP. Once the process of authentication with EAP is completed, fresh key material is shared between the IoT device and the Controller. In this instance, the Controller and the Authorization Server (AS) of ACE can be co-located.<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<p id="appendix-A.1-2">
                    Next, we exemplify how CoAP-EAP can be used to perform the Client registration in a general way, to allow two IoT devices (A and B) to communicate and interact after a successful client registration.<a href="#appendix-A.1-2" class="pilcrow">¶</a></p>
<p id="appendix-A.1-3">
                    Node A wants to communicate with node B (e.g. to activate a light switch).  The overall process is divided into three phases.  Let's start with node A.  In the first phase, the node A (EAP peer) does not yet belong to Controller C's domain.  Then, it communicates with C (EAP authenticator) and authenticates with CoAP-EAP, which, optionally, communicates with the AAA server to complete the authentication process. If the authentication is successful, a fresh MSK is shared between C and node A.  This key material allows node A to establish a security association with the C. Some authorization information may be also provided in this step. In case EAP is used in standalone mode, the AS itself having information about the devices can be the entity providing said authorization information. 

                    If authentication and authorization are correct, node A is enrolled in controller C's domain for a period of time. In particular, <span>[<a href="#RFC5247" class="xref">RFC5247</a>]</span> recommends 8 hours, though the the entity providing the authorization information can establish this lifetime.  In the same manner, B needs to perform the same process with CoAP-EAP to be part of the controller C's domain.<a href="#appendix-A.1-3" class="pilcrow">¶</a></p>
<p id="appendix-A.1-4">
                    In the second phase, when node A wants to talk with node B, it contacts controller C for authorization to access node B and obtain all the required information to do that securely
                    (e.g. keys, tokens, authorization information, etc.).  This phase does NOT require the usage of CoAP-EAP.  The details of this phase are out of the scope of this document, and the ACE framework is used for this purpose <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.<a href="#appendix-A.1-4" class="pilcrow">¶</a></p>
<p id="appendix-A.1-5">
                    In the third phase, the node A can access node B with the credentials and information obtained from the controller C in the second phase. This access can be repeated without contacting the controller, while
                    the credentials given to A are still valid.  The details of this phase are out of scope of this document.<a href="#appendix-A.1-5" class="pilcrow">¶</a></p>
<p id="appendix-A.1-6">
                    It is worth noting that first phase with CoAP-EAP is required to join the controller C's domain.  Once it is performed with success, the communications are local to the controller C's domain and there is no need to perform a new EAP authentication as long as the key material is still valid. When the keys are about to expire, the IoT device can engage in a reauthentication as explained in <a href="#reauthentication" class="xref">Section 3.3.2</a>, to renew the key material.<a href="#appendix-A.1-6" class="pilcrow">¶</a></p>
</section>
<section id="appendix-A.2">
        <h3 id="name-example-2-multi-domain-with">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-example-2-multi-domain-with" class="section-name selfRef">Example 2: Multi-domain with AAA infrastructures</a>
        </h3>
<p id="appendix-A.2-1">
                We assume we have a device (A) of the domain acme.org, which uses a specific kind of credential (e.g., AKA) and intends to join the um.es domain. This user does not belong to this domain, for which first it performs a client registration using CoAP-EAP. For this, it interacts with the  controller's domain acting as EAP authenticator, which in turn communicates with a AAA infrastructure (acting as AAA client). Through the local AAA server to communicate with the home AAA server to complete the authentication and integrate the device as a trustworthy entity into the domain of controller C. In this scenario, the AS under the role of the Controller receives the key material from the AAA infrastructure<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
</section>
<section id="appendix-A.3">
        <h3 id="name-example-3-single-domain-wit">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-example-3-single-domain-wit" class="section-name selfRef">Example 3: Single domain with AAA infrastructure</a>
        </h3>
<p id="appendix-A.3-1">
                A University Campus, we have several Faculty buildings and each one has its own criteria or policies in place to manage IoT devices under an AS. All buildings belong to the same domain (e.g., um.es). All these buildings are managed with a AAA infrastructure. A new device (A) with credentials from the domain (e.g., um.es) will be able to perform the device registration with a Controller (C) of any building as long as they are managed by the same general domain.<a href="#appendix-A.3-1" class="pilcrow">¶</a></p>
</section>
<section id="appendix-A.4">
        <h3 id="name-example-4-single-domain-wit">
<a href="#appendix-A.4" class="section-number selfRef">A.4. </a><a href="#name-example-4-single-domain-wit" class="section-name selfRef">Example 4: Single domain without AAA infrastructure</a>
        </h3>
<p id="appendix-A.4-1">
                    In another case, without a AAA infrastructure, we have a Controller that has co-located the EAP server and using EAP standalone mode we can manage all the devices within the same domain locally. Client registration of a node (A) with Controller (C) can also be performed in the same manner.<a href="#appendix-A.4-1" class="pilcrow">¶</a></p>
</section>
<section id="appendix-A.5">
        <h3 id="name-other-use-cases">
<a href="#appendix-A.5" class="section-number selfRef">A.5. </a><a href="#name-other-use-cases" class="section-name selfRef">Other use cases</a>
        </h3>
<section id="appendix-A.5.1">
          <h4 id="name-coap-eap-for-network-access">
<a href="#appendix-A.5.1" class="section-number selfRef">A.5.1. </a><a href="#name-coap-eap-for-network-access" class="section-name selfRef">CoAP-EAP for network access control</a>
          </h4>
<p id="appendix-A.5.1-1">
                        One of the first steps for an IoT device life-cycle is to perform the authentication to gain access to the network. To do so, the device first has to be authenticated and granted authorization to gain access to the network. Additionally, security parameters such as credentials can be derived from the authentication process allowing the trustworthy operation of the IoT device in a particular network by joining the security domain.  

                        By using EAP, we are able to achieve this with flexibility and scalability, because of the different EAP methods available and the ability to rely on AAA infrastructures if needed to support multi-domain scenarios, which is a key feature when the IoT devices deployed under the same security domain, belong to different organizations. 

                        Given that EAP is also used for network access control, we can adapt this service for other technologies. For instance, to provide network access control to very constrained technologies (e.g., LoRa network). Authors in <span>[<a href="#lo-coap-eap" class="xref">lo-coap-eap</a>]</span> provide an study of a minimal version of CoAP-EAP for LPWAN networks with interesting results. In this specific case, we could leverage the compression by SCHC for CoAP <span>[<a href="#RFC8824" class="xref">RFC8824</a>]</span>.<a href="#appendix-A.5.1-1" class="pilcrow">¶</a></p>
</section>
<section id="appendix-A.5.2">
          <h4 id="name-coap-eap-for-service-authen">
<a href="#appendix-A.5.2" class="section-number selfRef">A.5.2. </a><a href="#name-coap-eap-for-service-authen" class="section-name selfRef">CoAP-EAP for service authentication</a>
          </h4>
<p id="appendix-A.5.2-1">
                      It is not uncommon that the infrastructure where the device is deployed and the services of the IoT device are managed by different organizations. Therefore, in addition to the authentication for network access control, we have to consider the possibility of a secondary authentication to access different services.

                      This process of authentication, for example, will provide with the necessary key material to establish a secure channel and interact with the entity in charge of granting access to different services.
                    
                      In 5G, for example, consider a primary and secondary authentication using EAP <span>[<a href="#TS133.501" class="xref">TS133.501</a>]</span>.<a href="#appendix-A.5.2-1" class="pilcrow">¶</a></p>
</section>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rafa Marin-Lopez</span></div>
<div dir="auto" class="left"><span class="org">University of Murcia</span></div>
<div dir="auto" class="left"><span class="street-address">Campus de Espinardo S/N, Faculty of Computer Science</span></div>
<div dir="auto" class="left">
<span class="postal-code">30100</span> <span class="locality">Murcia</span> </div>
<div dir="auto" class="left"><span class="country-name">Spain</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+34%20868%2088%2085%2001" class="tel">+34 868 88 85 01</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:rafa@um.es" class="email">rafa@um.es</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Dan Garcia-Carrillo</span></div>
<div dir="auto" class="left"><span class="org">University of Oviedo</span></div>
<div dir="auto" class="left"><span class="street-address">Calle Luis Ortiz Berrocal S/N, Edificio Polivalente</span></div>
<div dir="auto" class="left">
<span class="postal-code">33203</span> <span class="locality">Gijon</span> <span class="region">Asturias</span>
</div>
<div dir="auto" class="left"><span class="country-name">Spain</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:garciadan@uniovi.es" class="email">garciadan@uniovi.es</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
