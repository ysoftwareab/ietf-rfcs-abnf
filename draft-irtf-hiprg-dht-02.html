<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Host Identity Protocol Distributed Hash Table Interface</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Host Identity Protocol Distributed Hash Table Interface">
<meta name="keywords" content="I-D, Internet Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">HIP Research Group</td><td class="header">J. Ahrenholz</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">The Boeing Company</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">October 6, 2010</td></tr>
<tr><td class="header">Expires: April 9, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Host Identity Protocol Distributed Hash Table Interface<br />draft-irtf-hiprg-dht-02</h1>

<h3>Abstract</h3>

<p>This document specifies a common interface for using HIP with 
      a Distributed Hash Table service to provide a name-to-Host-Identity-Tag
      lookup service and a Host-Identity-Tag-to-address lookup service.
      
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on April 9, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#sec-opendht-interface">2.</a>&nbsp;
The OpenDHT interface<br />
<a href="#sec-lookup-services">3.</a>&nbsp;
HIP lookup services<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-hit-lookup">3.1.</a>&nbsp;
HIP name to HIT lookup<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-address-lookup">3.2.</a>&nbsp;
HIP address lookup<br />
<a href="#sec-hip-dht-resource-record">4.</a>&nbsp;
HDRR - the HIP DHT Resource Record<br />
<a href="#anchor2">5.</a>&nbsp;
Use cases<br />
<a href="#anchor3">6.</a>&nbsp;
Issues with DHT support<br />
<a href="#anchor4">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor5">8.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor6">9.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
<a href="#anchor8">Appendix&nbsp;A.</a>&nbsp;
Change Log<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">A.1.</a>&nbsp;
Changes from hiprg 01 to 02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">A.2.</a>&nbsp;
Changes from hiprg 00 to 01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">A.3.</a>&nbsp;
Changes from Version ahrenholz 06 to hiprg 00<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">A.4.</a>&nbsp;
Changes from Version 05 to 06<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">A.5.</a>&nbsp;
Changes from Version 04 to 05<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">A.6.</a>&nbsp;
Changes from Version 03 to 04<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">A.7.</a>&nbsp;
Changes from Version 02 to 03<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">A.8.</a>&nbsp;
Changes from Version 01 to 02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">A.9.</a>&nbsp;
Changes from Version 00 to 01<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The Host Identity Protocol <a class='info' href='#RFC5201'>[RFC5201]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; April&nbsp;2008.</span><span>)</span></a>
      may benefit from a lookup service based
      on Distributed Hash Tables (DHTs). The Host Identity namespace is flat,
      consisting of public keys, in contrast to the hierarchical Domain Name
      System. These keys are hashed and prefixed to form Host Identity Tags
      (HITs) which
      appear as large random numbers. As the current DNS system has been
      heavily optimized for address lookup, it may be worthwhile to
      experiment with other services such as those defined here.
      DHTs manage such data well by
      applying a hash function that distributes data across a number
      of servers. DHTs are also designed to support frequently updating
      stored values.
      For an alternative method of using HITs to lookup IP addresses 
      using DNS, see <a class='info' href='#I-D.ponomarev-hip-hit2ip'>[I&#8209;D.ponomarev&#8209;hip&#8209;hit2ip]<span> (</span><span class='info'>Ponomarev, O. and A. Gurtov, &ldquo;Embedding Host Identity Tags Data in DNS,&rdquo; July&nbsp;2009.</span><span>)</span></a>.
      
</p>
<p>One freely available implementation of a DHT is the Bamboo DHT, which
      is Java-based software that has been deployed on PlanetLab
      servers to form a free service named OpenDHT.
      OpenDHT was available via the Internet for any program
      to store and retrieve arbitrary data.
      OpenDHT used a well defined XML-RPC 
      interface, featuring put, get, and remove operations. 
      OpenLookup, while not implemented as a DHT, is another deployment
      of open source software compatible with
      this OpenDHT interface. This document discusses
      a common way for HIP to use this OpenDHT interface, so that various
      HIP experimenters may employ lookup services in an interoperable
      fashion.
    
</p>
<p>This document represents the consensus of the HIP RG. This document
    is not an IETF product and does not represent a standard.
</p>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
       NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and
       "OPTIONAL" in this document are to be interpreted as described in
       RFC 2119.
</p>
<a name="sec-opendht-interface"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
The OpenDHT interface</h3>

<p>OpenDHT was a public deployment of Bamboo DHT servers that ran on
      about 150 PlanetLab nodes, retired in July 2009. 
      While the Bamboo project provided the actual
      software running on the servers, here we will refer only to OpenDHT,
      which uses a certain defined interface for the XML-RPC calls. 
      Another service compatible with this interface is OpenLookup.
      One can run their own Bamboo nodes to set up a private ring of servers.
      
</p>
<p>OpenDHT was chosen because it was a well-known, publicly available 
      DHT used within the research community. Its interface features a simple,
      standards-based protocol that can be easily implemented by HIP
      developers. This document does not aim to dictate that only the services
      and servers described here should be used, but is rather meant to act 
      as a starting point to gain experience with these services, choosing
      tools that are readily available.
      
</p>
<p>OpenDHT stores values using (hash) keys. Keys are limited to 20 
      bytes in length, and values can be up to 1024 bytes. Values are stored 
      for a certain number of seconds, up to a maximum of 604,800 seconds
      (one week.) See the OpenDHT website: 
      <a href='http://www.opendht.org/'>http://www.opendht.org/</a>
      
</p>
<p>Three RPC operations are supported: put, get, and rm (remove). 
      Put is called with key 
      and value parameters, causing the value to be stored using the key as
      its hash index. Get is called with the key parameter, when you have a key
      and want to retrieve the value. Rm is called with a hash of the value
      to be removed along with a secret value, a hash of which was included
      in the put operation.
      
</p>
<p>
      The definitions below are taken from the OpenDHT users guide at 
      <a href='http://opendht.org/users-guide.html'>http://opendht.org/users-guide.html</a>.
      
</p>
<p style='text-align: center'>The put operation takes the following arguments:
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">field</th><th align="left">type</th></tr>
<tr>
<td align="left">application</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">client_library</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">byte array, 20 bytes max.</td>
</tr>
<tr>
<td align="left">value</td>
<td align="left">byte array, 1024 bytes max.</td>
</tr>
<tr>
<td align="left">ttl_sec</td>
<td align="left">four-byte integer, max. value 604800</td>
</tr>
<tr>
<td align="left">secret_hash</td>
<td align="left">optional SHA-1 hash of secret value</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>The server replies with an integer -- 0 for "success", 1 if
	 it is "over capacity", and 2 indicating "try again". The return code 3
	 indicates "failure" and is used for a modified OpenDHT server that
	 performs signature and HIT verification, see
	 <a class='info' href='#sec-hip-dht-resource-record'>Section&nbsp;4<span> (</span><span class='info'>HDRR - the HIP DHT Resource Record</span><span>)</span></a>.
	 
</p>
<p style='text-align: center'>The get operation takes the following arguments:
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">field</th><th align="left">type</th></tr>
<tr>
<td align="left">application</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">client_library</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">byte array, 20 bytes max.</td>
</tr>
<tr>
<td align="left">maxvals</td>
<td align="left">four-byte singed integer, max. value 2^31-1</td>
</tr>
<tr>
<td align="left">placemark</td>
<td align="left">byte array, 100 bytes max.</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>The server replies with an array of values, and a placemark
	 that can be used for fetching additional values.
	 
</p>
<p style='text-align: center'>The rm operation takes the following arguments:
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">field</th><th align="left">type</th></tr>
<tr>
<td align="left">application</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">client_library</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">byte array, 20 bytes max.</td>
</tr>
<tr>
<td align="left">value_hash</td>
<td align="left">SHA-1 hash of value to remove</td>
</tr>
<tr>
<td align="left">ttl_sec</td>
<td align="left">four-byte integer, max. value 604800</td>
</tr>
<tr>
<td align="left">secret</td>
<td align="left">secret value (SHA-1 of this was used in put)</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>The server replies with an integer -- 0 for "success", 1 if
	 it is "over capacity", and 2 indicating "try again".
	 
</p>
<p>
      
</p>
<p>
      This is the basic XML-RPC interface provided by OpenDHT. Each "field"
      from the above tables are XML tags that enclose their corresponding
      values. The key is a byte array used to index the record for storage and
      retrieval from the DHT. The value is a byte array of the data 
      being stored in the DHT.
      The Application and client_library fields are meta-data used only for
      logging purposes. The ttl_sec field specifies the number of seconds that
      the DHT should store the value. The secret_hash field allows values to
      be later removed from the DHT. The maxvals and placemark fields are for
      retrieving a maximum number of values and for iterating get results.
</p>
<p>
      The return code of 0 "success" indicates a successful put or remove
      operation. The return code of 1 "over capacity" means that a client is
      using too much storage space on the server. The return value of 2 
      "try again" indicates that the client should retry the put operation
      because a temporary problem prevented the server from
      accepting the put.
      
</p>
<p>
      In the sections that follow, specific uses for these DHT operations and 
      their XML fields are suggested for use with HIP.
      
</p>
<a name="sec-lookup-services"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
HIP lookup services</h3>

<p>This draft defines a HIT lookup and address lookup service for use 
      with HIP. The HIT lookup uses a text name to discover a peer's HIT.
      The address lookup uses a peer's HIT to discover its current addresses. 
      
</p>
<p>
      The two lookups are defined below. The abbreviated notation
      refers to the HIP parameter types; for example HIP_SIG is the HIP
      signature parameter defined by <a class='info' href='#RFC5201'>[RFC5201]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; April&nbsp;2008.</span><span>)</span></a>.
      </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      HDRR([CERT]) = get(SHA-1("name"))
      HDRR(LOCATOR, SEQ, HOST_ID, [CERT], HIP_SIG) = get(HIT_KEY)
</pre></div><p>

      
</p>
<p>Both services use a HIP DHT Resource Record 
      (HDRR) described in <a class='info' href='#sec-hip-dht-resource-record'>Section&nbsp;4<span> (</span><span class='info'>HDRR - the HIP DHT Resource Record</span><span>)</span></a>. This is
      a wrapper around data contained in TLVs, similar to a HIP control packet.
      The data contained in each HDRR differs between the two services.
      
</p>
<p>The HIT lookup service returns the Host Identity Tag of a peer given
      a name. 
      The name SHOULD be the FQDN, hostname, or some other alias.
      This HIT is found in the Sender's HIT field of the HDRR.
      The HIT is
      the hash of the public-key based Host Identity as described in
      <a class='info' href='#RFC5201'>[RFC5201]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; April&nbsp;2008.</span><span>)</span></a>.
      There are no security properties of the name, unlike the HIT.
      An optional certificate MAY be included in the record, for validating
      the name, providing some measure of security.
      Which certificates to consider trusted is a policy issue.
      This service is intended for use when legacy DNS servers
      do not support HIP resource records, or when hosts do not have
      administrative access to publish their own DNS records. Such an unmanaged
      naming service may help facilitate experimentation.
      
</p>
<p>The address lookup returns a locator and other validation data 
      in the HDRR for a given HIT. Before a HIP association can
      be initiated (not in opportunistic mode), a HIP host needs to know
      the peer's HIT and the current address at
      which the peer is reachable. Often the HIT will be pre-configured,
      available via DNS lookup using a hostname lookup 
      <a class='info' href='#RFC5205'>[RFC5205]<span> (</span><span class='info'>Nikander, P. and J. Laganier, &ldquo;Host Identity Protocol (HIP) Domain Name System (DNS) Extensions,&rdquo; April&nbsp;2008.</span><span>)</span></a>, or retrieved using the HIT lookup service
      defined in this document. 
      With HIP mobility <a class='info' href='#RFC5206'>[RFC5206]<span> (</span><span class='info'>Nikander, P., Henderson, T., Vogt, C., and J. Arkko, &ldquo;End-Host Mobility and Multihoming with the Host Identity Protocol,&rdquo; April&nbsp;2008.</span><span>)</span></a>, IP addresses may
      be used as locators and may often change. The Host
      Identity and the HIT remain relatively constant and can be used to 
      securely identify a host, so the HIT serves as a suitable DHT key for 
      storing and retrieving addresses.
      
</p>
<p>The address lookup service includes the peer's
      Host Identity and a signature over the locators. This allows the DHT
      client or server to validate the address information stored in the DHT.
      
</p>
<p>These two separate lookups are defined instead of one because the
      address record is expected to change more frequently, while the
      name-to-HIT binding should remain relatively constant. Also the client
      and server validation of the two records is different, with the HIT
      lookup using certificates verifying the name and the address lookup using
      a signature produced by the bearer of a particular Host Identity/HIT.
      
</p>
<p>
      These services reduce the amount of pre-configuration required
      at each HIP host. The address of each peer no longer
      needs to be known ahead of time, if peers also participate by
      publishing their addresses. If peers choose to publish their HITs
      with a name, peer HITs also no longer require pre-configuration.
      However, discovering an available DHT server for servicing these lookups
      will require some additional configuration.
      
</p>
<a name="sec-hit-lookup"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
HIP name to HIT lookup</h3>

<p>
      Given the SHA-1 hash of a name, a lookup returns the HIT of the peer.
      The hash of a name is used because OpenDHT keys are limited to
      20 bytes, so this allows for longer names.
      Publish, lookup, and remove operations are defined.
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      HDRR([CERT]) = get(SHA-1("name"))
      put(SHA-1("name"), HDRR([CERT]), [SHA-1(secret)])
      rm(SHA-1("name"), SHA-1(HDRR), secret)
</pre></div>
<p style='text-align: center'>HIT publish
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">field</th><th align="left">value</th><th align="left">data type</th></tr>
<tr>
<td align="left">application</td>
<td align="left">"hip-name-hit"</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">client_library</td>
<td align="left">(implementation dependent)</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">SHA-1 hash of a name</td>
<td align="left">base64 encoded</td>
</tr>
<tr>
<td align="left">value</td>
<td align="left">HDRR([CERT]), with the HIT to be published contained in the
	 Sender's HIT field of the HDRR, and an optional certificate
	 for validating the name used as the key</td>
<td align="left">base64 encoded</td>
</tr>
<tr>
<td align="left">ttl_sec</td>
<td align="left">lifetime for this record, value from 0-604800 seconds</td>
<td align="left">numeric string</td>
</tr>
<tr>
<td align="left">secret_hash</td>
<td align="left">optional SHA-1 hash of secret value</td>
<td align="left">base64 encoded</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>HIT lookup
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">field</th><th align="left">value</th><th align="left">data type</th></tr>
<tr>
<td align="left">application</td>
<td align="left">"hip-name-hit"</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">client_library</td>
<td align="left">(implementation dependent)</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">SHA-1 hash of a name</td>
<td align="left">base64 encoded</td>
</tr>
<tr>
<td align="left">maxvals</td>
<td align="left">(implementation dependent)</td>
<td align="left">numeric string</td>
</tr>
<tr>
<td align="left">placemark</td>
<td align="left">(NULL, or used from server reply)</td>
<td align="left">base64 encoded</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>HIT remove (optional)
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">field</th><th align="left">value</th><th align="left">data type</th></tr>
<tr>
<td align="left">application</td>
<td align="left">"hip-name-hit"</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">client_library</td>
<td align="left">(implementation dependent)</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">SHA-1 hash of a name</td>
<td align="left">base64 encoded</td>
</tr>
<tr>
<td align="left">value_hash</td>
<td align="left">SHA-1 hash of HDRR (value used during publish) to remove</td>
<td align="left">base64 encoded</td>
</tr>
<tr>
<td align="left">ttl_sec</td>
<td align="left">lifetime for the remove should be greater than or equal to
	 the amount of time remaining for the record</td>
<td align="left">numeric string</td>
</tr>
<tr>
<td align="left">secret</td>
<td align="left">secret value (SHA-1 of this was used in put)</td>
<td align="left">base64 encoded</td>
</tr>
</table>
<br clear="all" />

<p>The key for both HIT publish and lookup is the SHA-1 hash of the
      name. The name does not necessarily need to be associated with a
      valid DNS or host name. It does not need to be related to the Domain
      Identifier found in HI TLV.
      OpenDHT limits the keys to 20 bytes in length,
      so the SHA-1 hash is used to allow arbitrary name lengths.
      
</p>
<p>
      The value used in the publish and lookup response MUST be
      the base64-encoded
      HDRR containing the HIT, and MAY include an optional certificate.
      The HIT MUST be stored in the Sender's HIT field in the HDRR header,
      and is a 128-bit value than can
      be identified as a HIT both by its length and by the
      ORCHID prefix (<a class='info' href='#RFC4843'>[RFC4843]<span> (</span><span class='info'>Nikander, P., Laganier, J., and F. Dupont, &ldquo;An IPv6 Prefix for Overlay Routable Cryptographic Hash Identifiers (ORCHID),&rdquo; April&nbsp;2007.</span><span>)</span></a>) that it starts with.
      
</p>
<p>If a certificate is included in this HIT record, the name used
      for the DHT key MUST be listed in the certificate.
      The CERT parameter is defined in <a class='info' href='#I-D.ietf-hip-cert'>[I&#8209;D.ietf&#8209;hip&#8209;cert]<span> (</span><span class='info'>Heer, T. and S. Varjonen, &ldquo;HIP Certificates,&rdquo; September&nbsp;2010.</span><span>)</span></a>.
      The Common Name (CN)
      field from the distinguished name (DN) of the X.509.v3 certificate
      MUST be used. The server
      can hash this name to verify it matches the DHT key.
      
</p>
<p>The ttl_sec field specifies
      the number of seconds requested by the client that the entry should 
      be stored
      by the DHT server, which is implementation or policy dependent.
      
</p>
<p>The secret_hash is an optional field used with HIT publish
      if the value will later be removed with an rm operation.
      It is RECOMMENDED that clients support these rm operations for the values
      they publish.
      The secret_hash contains the base64 encoded SHA-1 hash of some secret
      value known only to the publishing host.
      A different secret value SHOULD
      be used for each put because rm requests are visible on the network.
      The max_vals and placemark fields used with the HIT lookup are
      defined by the get XML-RPC interface. 
      
</p>
<a name="sec-address-lookup"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
HIP address lookup</h3>

<p>
      Given a HIT, a lookup returns the IP address of the peer.
      The address is contained in a LOCATOR TLV inside the HDRR, along with
      other validation data.
      This interface has publish, lookup, and remove operations. A summary
      of these three operations is listed below. The abbreviated notation
      refers to the HIP parameter types; for example HIP_SIG is the HIP
      signature parameter defined by <a class='info' href='#RFC5201'>[RFC5201]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; April&nbsp;2008.</span><span>)</span></a>. The details
      of these DHT operations is then described in greater detail.
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      HDRR(LOCATOR, SEQ, HOST_ID, [CERT], HIP_SIG) = get(HIT_KEY)
      put(HIT_KEY, HDRR(LOCATOR, SEQ, HOST_ID, [CERT], HIP_SIG),
          [SHA-1(secret)])
      rm(HIT_KEY, SHA-1(HDRR), secret)
</pre></div>
<p>The HDRR is defined in 
      <a class='info' href='#sec-hip-dht-resource-record'>Section&nbsp;4<span> (</span><span class='info'>HDRR - the HIP DHT Resource Record</span><span>)</span></a>.
      It contains one or more locators that the peer wants to publish, 
      a sequence number, the peer's Host Identity, an optional certificate,
      and signature over the contents.
      
</p>
<p>The HIT_KEY is the last 100 bits of the HIT appended with 60 zero
      bits. This is the portion of the HIT used as a DHT key. The
      last 100 bits is used to avoid uneven distribution of the 
      stored values across the DHT servers.  The first 28 bits is the
      HIT's ORCHID Prefix defined by <a class='info' href='#RFC4843'>[RFC4843]<span> (</span><span class='info'>Nikander, P., Laganier, J., and F. Dupont, &ldquo;An IPv6 Prefix for Overlay Routable Cryptographic Hash Identifiers (ORCHID),&rdquo; April&nbsp;2007.</span><span>)</span></a>, and this
      prefix is dropped because it is the same for all HITs, which would cause
      this uneven distribution.
      Zero padding is appended to this 100-bit value to fill the length required
      by the DHT, 160 bits total.
      
</p>
<p style='text-align: center'>Address publish
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">field</th><th align="left">value</th><th align="left">data type</th></tr>
<tr>
<td align="left">application</td>
<td align="left">"hip-addr"</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">client_library</td>
<td align="left">(implementation dependent)</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">HIT_KEY</td>
<td align="left">base64 encoded</td>
</tr>
<tr>
<td align="left">value</td>
<td align="left">HDRR(LOCATOR, SEQ, HOST_ID, [CERT], HIP_SIG),
	 with the IP address to be published contained in the
	 LOCATOR TLV in the HDRR, along with other validation data</td>
<td align="left">base64 encoded</td>
</tr>
<tr>
<td align="left">ttl_sec</td>
<td align="left">amount of time HDRR should be valid, 
	 or the lifetime of the preferred address,
	 a value from 0-604800 seconds</td>
<td align="left">numeric string</td>
</tr>
<tr>
<td align="left">secret_hash</td>
<td align="left">optional SHA-1 hash of secret value</td>
<td align="left">base64 encoded</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>Address lookup
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">field</th><th align="left">value</th><th align="left">data type</th></tr>
<tr>
<td align="left">application</td>
<td align="left">"hip-addr"</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">client_library</td>
<td align="left">(implementation dependent)</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">HIT_KEY</td>
<td align="left">base64 encoded</td>
</tr>
<tr>
<td align="left">maxvals</td>
<td align="left">(implementation dependent)</td>
<td align="left">numeric string</td>
</tr>
<tr>
<td align="left">placemark</td>
<td align="left">(NULL, or used from server reply)</td>
<td align="left">base64 encoded</td>
</tr>
</table>
<br clear="all" />

<p style='text-align: center'>Address remove (optional)
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">field</th><th align="left">value</th><th align="left">data type</th></tr>
<tr>
<td align="left">application</td>
<td align="left">"hip-addr"</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">client_library</td>
<td align="left">(implementation dependent)</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">key</td>
<td align="left">HIT_KEY</td>
<td align="left">base64 encoded</td>
</tr>
<tr>
<td align="left">value_hash</td>
<td align="left">SHA-1 hash of HDRR (value used during publish)
	 to remove</td>
<td align="left">base64 encoded</td>
</tr>
<tr>
<td align="left">ttl_sec</td>
<td align="left">old address lifetime</td>
<td align="left">numeric string</td>
</tr>
<tr>
<td align="left">secret</td>
<td align="left">secret value (SHA-1 of this was used in put)</td>
<td align="left">base64 encoded</td>
</tr>
</table>
<br clear="all" />

<p>
      The application and client_library fields are used for logging in
      OpenDHT. The client_library may vary between different implementations,
      specifying the name of the XML-RPC library used or the application that
      directly makes XML-RPC calls.
      
</p>
<p>The key for both address publish and lookup
      is the HIT_KEY as defined above, 160 bits  
      base64 encoded <a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a>.
      The value used in the publish and lookup response is the base64
      encoded HDRR containing one or more LOCATORs.
      
</p>
<p>The ttl_sec field used with address publish includes the time-to-live,
      the number of seconds for which the entry will be stored
      by the DHT, which SHOULD be set to
      the number of seconds remaining in the address lifetime.
      
</p>
<p>The secret_hash is an optional field that MAY be used with
      address publish
      if the value will later be removed with an rm operation.
      The secret_hash contains the base64 encoded SHA-1 hash of some secret
      value that MUST be known only to the publishing host.
      Clients SHOULD include the secret_hash and remove outdated values to
      reduce the amount of data the peer needs to handle.
      A different secret value SHOULD
      be used for each put because rm requests are visible on the network.
      
</p>
<p>The max_vals and placemark fields used with address lookup are
      defined by the get XML-RPC interface. The get operation needs to know the
      maximum number of values to retrieve. The placemark is a value found
      in the server reply that causes the get to continue to retrieve values
      starting at where it left off.
      
</p>
<a name="sec-hip-dht-resource-record"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
HDRR - the HIP DHT Resource Record</h3>

<p>The HIP DHT Resource Record uses the same binary format as 
      HIP packets (defined in <a class='info' href='#RFC5201'>[RFC5201]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; April&nbsp;2008.</span><span>)</span></a>.) 
      This packet encoding is used as a convenience, even though this data
      is actually a resource record stored and retrieved by the DHT servers,
      not a packet sent on the wire by a HIP protocol daemon.
      Note that this HDRR format is different than the HIP RR used by the
      Domain Name System as defined in <a class='info' href='#RFC5205'>[RFC5205]<span> (</span><span class='info'>Nikander, P. and J. Laganier, &ldquo;Host Identity Protocol (HIP) Domain Name System (DNS) Extensions,&rdquo; April&nbsp;2008.</span><span>)</span></a>.
      The reason it is different is that it is a different record from a
      functional point of view:  in DNS, the query key is a FQDN, and the
      return value is a HIT, while here, the query key is a HIT.
      
</p>
<p>
      HIP header values for the HDRR:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  HIP Header:
    Packet Type = 20 DHT Resource Record (this value is TBD)
    SRC HIT = Sender's HIT
    DST HIT = NULL

  HDRR used with HIT lookup:
  HIP ( [CERT] )

  HDRR used with address lookup:
  HIP ( LOCATOR, SEQ, HOST_ID, [CERT], HIP_SIGNATURE )
</pre></div>
<p>
        The Initiator HIT (Sender's HIT, SRC HIT) MUST be set to the HIT that 
	the host wishes to make 
	available using the lookup service.  With the HIT lookup service,
	this is the main piece of information returned by a get operation.
	For the address lookup service, this HIT MUST be the same one used to
	derive the HIT_KEY used as the DHT key.
	The Responder HIT (Receiver's HIT, DST HIT) MUST be NULL 
        (all zeroes) since the data is intended for any host.
      
</p>
<p>
        The only other TLV used with the HIT lookup service is an optional
	CERT parameter containing a certificate for validating the name
	that is used as the DHT key. 
        The CERT parameter is defined in <a class='info' href='#I-D.ietf-hip-cert'>[I&#8209;D.ietf&#8209;hip&#8209;cert]<span> (</span><span class='info'>Heer, T. and S. Varjonen, &ldquo;HIP Certificates,&rdquo; September&nbsp;2010.</span><span>)</span></a>.
        The DHT server SHOULD use the certificate
	to verify that the client is authorized to use the name used for the
	DHT key, using the hash of the name found in the certificate. 
        The Common Name (CN)
        field from the distinguished name (DN) of the X.509.v3 certificate
        MUST be used. Which
	certificates the server considers trusted is a policy issue.
      
</p>
<p>
        The remaining parameters described here are used with the address
	lookup service.
      
</p>
<p>
        The LOCATOR parameter contains the addresses that the host wishes to
	make available using the lookup service. A host MAY publish its
	current preferred IPv4 and IPv6 locators, for example.
      
</p>
<p>
        The SEQ parameter contains an unsigned 32-bit sequence number, the
	Update ID. This
	is typically initialized to zero and incremented by one for each new
	HDRR that is published by the host. The host SHOULD retain the last
	Update ID value it used for each HIT across reboots, or perform a 
	self lookup in the DHT, since that number may be retained in the 
	DHT records and will determine the preferred address used by peers.
      
</p>
<p>
        The HOST_ID parameter contains the Host Identity that corresponds with
	the Sender's HIT. (The encoding of this parameter is defined in
        section 5.2.8 of <a class='info' href='#RFC5201'>[RFC5201]<span> (</span><span class='info'>Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;Host Identity Protocol,&rdquo; April&nbsp;2008.</span><span>)</span></a>.)
      
</p>
<p>
        The HOST_ID parameter and HIP_SIGNATURE parameter MUST be used with
	the HDRR so that HIP clients receiving the record can
	validate the sender and the included LOCATOR parameter. The HIT_KEY
	used for the DHT key will also be verified against the Host Identity.
      
</p>
<p>The client that receives the HDRR from the DHT response
      MUST perform the signature and HIT_KEY
      verification. If the signature is invalid for the given Host Identity
      or the HIT_KEY used to retrieve the record does not match
      the Host Identity, the DHT record
      retrieved MUST be ignored. Note that for client-only verification
      the DHT server does not need to be modified
      
</p>
<p>The Sender's HIT in the HDRR MUST correspond with the key used 
      for the lookup and Host Identity verification. The Receiver's HIT MUST 
      be NULL (all zeroes) in the HDRR header.
      
</p>
<p>When several HDRR records are returned by the server, the client
      SHOULD pick the most recent record as indicated by the Update ID in the
      SEQ TLV of the HDRR, and perform verification on that record. The order
      in which records are returned should not be considered.
      
</p>
<p>The DHT server MAY also verify the SIGNATURE and HOST_ID, with
      some modifications to the Bamboo DHT software and a new return code
      with the OpenDHT interface.
      The signature in the put MUST be verified using the given
      Host Identity (public key), and the HIT_KEY provided as the lookup key
      MUST match this Host Identity according to the ORCHID generation
      method defined by <a class='info' href='#RFC4843'>[RFC4843]<span> (</span><span class='info'>Nikander, P., Laganier, J., and F. Dupont, &ldquo;An IPv6 Prefix for Overlay Routable Cryptographic Hash Identifiers (ORCHID),&rdquo; April&nbsp;2007.</span><span>)</span></a>.
      If either signature or HIT verification fails, the put MUST not be
      recorded into the DHT, and the server returns a failure code.
      The failure code is an additional return code not defined by OpenDHT,
      with a value of 3.
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Use cases</h3>

<p>Below are some suggestions of when a HIP implementation MAY want to
      use the HIT and address lookup services.
      
</p>
<p>To learn of a peer's HIT, a host might first consult DNS
      using the peer's hostname if the DNS server supports the HIP 
      Resource Record defined by
      <a class='info' href='#RFC5205'>[RFC5205]<span> (</span><span class='info'>Nikander, P. and J. Laganier, &ldquo;Host Identity Protocol (HIP) Domain Name System (DNS) Extensions,&rdquo; April&nbsp;2008.</span><span>)</span></a>. Sometimes hosts do not have
      administrative authority over their DNS entries and/or the DNS
      server is not able to support HIP resource records. Hosts may want
      to associate other non-DNS names with their HITs. For these and
      other reasons, a host MAY use the HIT publish service defined
      in <a class='info' href='#sec-hit-lookup'>Section&nbsp;3.1<span> (</span><span class='info'>HIP name to HIT lookup</span><span>)</span></a>. The peer HIT may be learned
      by performing a DHT lookup of such a name.
      
</p>
<p>Once a peer HIT is learned or configured, an address lookup MAY be
      performed so that the LOCATORs can be cached and immediately available 
      for when an association is requested. Implementations might load a list
      of peer HITs on startup, resulting in several lookups that can take some
      time to complete.
      
</p>
<p>However, cached LOCATORs may quickly become obsolete, depending on
      how often the peer changes its preferred address. Performing an address
      lookup before sending the I1 may be needed. At this time the latency of
      a lookup may be intolerable, and a lookup could instead be 
      performed after the I1 retransmission timer fires -- when no R1 reply has
      been received -- to detect any change in address.
      
</p>
<p>A HIP host SHOULD publish its preferred LOCATORs upon startup, so
      other hosts may determine where it is reachable. The host SHOULD 
      periodically refresh its HDRR entry because each entry carries a
      TTL and will eventually expire. Also, when there is a
      change in preferred address, usually associated with sending UPDATE
      packets with included locator parameters, the host SHOULD update its
      HDRR with the DHT. The old HDRR SHOULD be
      removed using the rm operation, if a secret value was used in the put.
      
</p>
<p>Addresses from the private address space SHOULD NOT be published
      to the DHT. If the host is located behind a NAT, for example, the
      host could publish the address of its Rendezvous Server (RVS, from
      <a class='info' href='#RFC5204'>[RFC5204]<span> (</span><span class='info'>Laganier, J. and L. Eggert, &ldquo;Host Identity Protocol (HIP) Rendezvous Extension,&rdquo; April&nbsp;2008.</span><span>)</span></a>) to the DHT if that is how 
      it is reachable.
      In this case however, a peer could instead simply use the RVS field 
      of the
      NATted host's HIP DNS record, which would eliminate a separate DHT lookup.
      
</p>
<p>A HIP host SHOULD also publish its HIT upon startup or whenever
      a new HIT is configured, for use with the HIT lookup service, if desired.
      The host SHOULD first check if the name already exists in the DHT
      by performing a lookup, to avoid interfering with an existing 
      name-to-HIT mapping. The name-to-HIT binding
      needs to be refreshed periodically before the TTL expires.
      
</p>
<p>When publishing data to the DHT server, care should be taken to check
      the response from the server. The server may respond with an "over
      capacity" code, indicating that its resources are too burdened to honor
      the given size and TTL. The host SHOULD then select another server for
      publishing, or reduce the TTL and retry the put operation.
      
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Issues with DHT support</h3>

<p>
      The DHT put operation does not replace existing values.
      If a host does not remove its old
      HDRR before adding another, several entries may be present.
      A client performing a lookup SHOULD determine the most recent address
      based on the Update ID from the SEQ TLV of the HDRR.
      The order of values returned in the server's response may not be
      guaranteed. Before performing each put a host SHOULD remove
      its old HDRR data using the rm operation.
      
</p>
<p>
      In the case of the HIT lookup service, there is nothing preventing
      different hosts from publishing the same name. A lookup performed
      on this name will return multiple HITs that belong to different devices.
      The server may enforce a policy that requires clients to include
      a certificate when publishing a HIT, and only store HITs with a name
      that has been authorized by some trusted certificate.
      Otherwise this is an unmanaged free-for-all service,
      and it is RECOMMENDED that a host simply pick another name.
      
</p>
<p>
      Selecting an appropriate DHT server to use is not covered here.
      If a particular server becomes unavailable, the connect will timeout and
      some server selection algorithm SHOULD be performed, such as trying the
      next server in a configured list. OpenDHT formerly provided a DNS-based
      anycast service, when one performed a lookup of "opendht.nyuld.net", 
      it returned the two nearest OpenDHT servers.
      
</p>
<p>
      Because the put and get calls rely on outside servers located
      across the Internet, operations may have a latency involved that should
      be considered when using these services with HIP.
      
</p>
<p>
      The maximum size of 1024 bytes for the value field will limit the 
      maximum size of the Host Identity and certificates
      that may be used within the HDRR.
      
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p> There are two classes of attacks on this information exchange between
        host and DHT server: attacks on the validity of the information
        provided by the DHT to the host (such as a spoofed DHT response)
        and attacks on the DHT records themselves (such as polluted 
        records for a given key). Without the server performing some
	measure of verification, 
        not much can be done to prevent these attacks.
    
</p>
<p> For the HIT lookup based on name 
        (<a class='info' href='#sec-hit-lookup'>Section&nbsp;3.1<span> (</span><span class='info'>HIP name to HIT lookup</span><span>)</span></a>),
        there are no guarantees on the validity of the HIT. Users concerned
        with the validity of HITs found in the DHT SHOULD simply exchange
        HITs out-of-band with peers. Including a signature will not help
        here because the HIT that identifies the Host Identity for signing
        is not known ahead of time. A certificate MAY be included with the
	HIT which guarantees that the name used for the lookup has been
	authorized by some 3rd party authority. Which certificates are
	considered trusted is a local policy issue.
    
</p>
<p> For the address lookup based on HIT 
        (<a class='info' href='#sec-address-lookup'>Section&nbsp;3.2<span> (</span><span class='info'>HIP address lookup</span><span>)</span></a>), the validity of the 
        DHT response MUST be checked with the HOST_ID and SIGNATURE parameters
        in the HDRR. A HIP initiating host SHOULD also validate the DHT response
	after the R1 message is received during a HIP exchange.
        The Host Identity provided in the
        R1 can be hashed to obtain a HIT that MUST be checked against the
        original HIT. However, a legacy OpenDHT service without server
	modifications does not
        prevent an attacker from polluting the DHT records for a known
        HIT, thereby causing a denial-of-service attack, since server 
        validation is not performed.
    
</p>
<p> Relying solely on client validation may be harmful.
        An attacker can replay the put packets containing the signed HDRR,
        possibly causing stale or invalid information to exist in the DHT.
        If an attacker replays the signed put message and changes some aspect
        each time, and if the server is not performing signature and HIT 
        validation, there could be a multitude of invalid entries stored
        in the DHT. When a client retrieves these records it would need to
        perform signature and HIT verification on each one, which could
        cause unacceptable amounts of delay or computation.
    
</p>
<p>
        To protect against this type of attack, the DHT server SHOULD perform
	signature and HIT verification of each put operation as described
	in <a class='info' href='#sec-hip-dht-resource-record'>Section&nbsp;4<span> (</span><span class='info'>HDRR - the HIP DHT Resource Record</span><span>)</span></a>. Another option would
	be the server running HIP itself and requiring client
	authentication with a HIP association before
        accepting HDRR puts. Further validation would be only accepting
	HIT and address records from the association bound to the same HIT.
    
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>This document defines a new HIP Packet Type, the HIP Distributed
    Hash Table Resource Record (HDRR). This packet type is defined in 
    <a class='info' href='#sec-hip-dht-resource-record'>Section&nbsp;4<span> (</span><span class='info'>HDRR - the HIP DHT Resource Record</span><span>)</span></a> with a value of 20.
    
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgments</h3>

<p>
    Thanks to Tom Henderson, Samu Varjonen, Andrei Gurtov, Miika Komu,
    Kristian Slavov, Ken Rimey, and Ari Keranen for providing comments.
    Samu most notably 
    contributed the resolver packet and its suggested parameters, which
    became the HDRR here.
    
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.&nbsp;References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2045">[RFC2045]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;2045, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2045.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4843">[RFC4843]</a></td>
<td class="author-text">Nikander, P., Laganier, J., and F. Dupont, &ldquo;<a href="http://tools.ietf.org/html/rfc4843">An IPv6 Prefix for Overlay Routable Cryptographic Hash Identifiers (ORCHID)</a>,&rdquo; RFC&nbsp;4843, April&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4843.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5201">[RFC5201]</a></td>
<td class="author-text">Moskowitz, R., Nikander, P., Jokela, P., and T. Henderson, &ldquo;<a href="http://tools.ietf.org/html/rfc5201">Host Identity Protocol</a>,&rdquo; RFC&nbsp;5201, April&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5201.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5205">[RFC5205]</a></td>
<td class="author-text">Nikander, P. and J. Laganier, &ldquo;<a href="http://tools.ietf.org/html/rfc5205">Host Identity Protocol (HIP) Domain Name System (DNS) Extensions</a>,&rdquo; RFC&nbsp;5205, April&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5205.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5204">[RFC5204]</a></td>
<td class="author-text">Laganier, J. and L. Eggert, &ldquo;<a href="http://tools.ietf.org/html/rfc5204">Host Identity Protocol (HIP) Rendezvous Extension</a>,&rdquo; RFC&nbsp;5204, April&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5204.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5206">[RFC5206]</a></td>
<td class="author-text">Nikander, P., Henderson, T., Vogt, C., and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc5206">End-Host Mobility and Multihoming with the Host Identity Protocol</a>,&rdquo; RFC&nbsp;5206, April&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5206.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ponomarev-hip-hit2ip">[I-D.ponomarev-hip-hit2ip]</a></td>
<td class="author-text">Ponomarev, O. and A. Gurtov, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ponomarev-hip-hit2ip-04.txt">Embedding Host Identity Tags Data in DNS</a>,&rdquo; draft-ponomarev-hip-hit2ip-04 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ponomarev-hip-hit2ip-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-hip-cert">[I-D.ietf-hip-cert]</a></td>
<td class="author-text">Heer, T. and S. Varjonen, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-cert-04.txt">HIP Certificates</a>,&rdquo; draft-ietf-hip-cert-04 (work in progress), September&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-hip-cert-04.txt">TXT</a>).</td></tr>
</table>

<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Change Log</h3>

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Changes from hiprg 01 to 02</h3>

<p>Added RFC 2119 terminology phrase in the introduction, and
       incorporated RFC 2119 keywords throughout the text. Added clarification
       for the first occurrence of HIP parameter abbreviations. Changed intended
       status from Informational to Experimental.
       
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Changes from hiprg 00 to 01</h3>

<p>
       Incorporated comments from Ari Keranen: added references to CERT draft
       and RFC 5204. Added clarifications from OpenDHT user's guide. Simplified
       description of HIT_KEY. Dropped RFC 2119 language. Added IANA
       considerations. Other minor corrections and clarifications.
       
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Changes from Version ahrenholz 06 to hiprg 00</h3>

<p>
       Document name changed to reflect acceptance as a HIPRG document.
       Text added to introduction about document acceptance.
       
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
Changes from Version 05 to 06</h3>

<p>
       Use the HDRR format as return values for both services.
       Added optional certificates for both services.
       Added text about HIP-aware DHT server that validates HITs/signatures.
       Added SEQ TLV to HDRR, removed text about ordering. 
       Relaxed statement about DNS and referenced draft-ponomarev-hip-hit2ip.
       Added text describing why HDRR is different than DNS RR.
       Added text about handling of source/destination HITs in HDRR.
       Renamed Section 5 to "Use cases". Added failure code for put.
       Removed text about
       servers not honoring TTL. Added text clarifying what OpenLookup is.
       
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.5"></a><h3>A.5.&nbsp;
Changes from Version 04 to 05</h3>

<p>
       Reordered Sections 3.2 and 3.1, since the HIT lookup normally occurs
       before the address lookup. Added text about why two separate lookups
       are defined. Added text pertaining to the OpenDHT service retiring.
       
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.6"></a><h3>A.6.&nbsp;
Changes from Version 03 to 04</h3>

<p>
       Revised text about server treatment of TTL.
       
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.7"></a><h3>A.7.&nbsp;
Changes from Version 02 to 03</h3>

<p>
       Added text about TTL expiration, appending zero padding, HIT value
       usage. Removed text on anonymous bit. Use RFC references.
       
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.8"></a><h3>A.8.&nbsp;
Changes from Version 01 to 02</h3>

<p>sockaddr address format changed to use HIP DHT Resource Record
       containing
       the HIP LOCATOR format. The HIT prefix is dropped before using it as a 
       key. Separate "secure" service was dropped, and signatures made 
       mandatory. Legacy versus hip-aware DHT servers are
       distinguished. Text packet examples added.
       
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.9"></a><h3>A.9.&nbsp;
Changes from Version 00 to 01</h3>

<p>Removed the HIT lookup service -- using the LSI as a key to return
	a HIT as the value -- and added a HIT lookup service using names.
	
</p>
<p>Added support for OpenDHT remove. Changed all occurrences 
	of "Open DHT" to "OpenDHT".
	
</p>
<p>Added the Host Identity and a signature as a secure address lookup
	service, with text about running a modified OpenDHT server that can
	verify signed put messages based on Host Identity signatures.
	
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jeff Ahrenholz</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">The Boeing Company</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.O. Box 3707</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Seattle, WA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jeffrey.m.ahrenholz@boeing.com">jeffrey.m.ahrenholz@boeing.com</a></td></tr>
</table>
</body></html>
