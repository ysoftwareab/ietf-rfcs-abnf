<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Transmission of Syslog Messages over TCP</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Transmission of Syslog Messages over TCP">
<meta name="keywords" content="SYSLOG, SYSLOG transport TCP">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">R. Gerhards</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Adiscon GmbH</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">C. Lonvick</td></tr>
<tr><td class="header">Expires: August 3, 2011</td><td class="header">Cisco Systems, Inc</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">January 30, 2011</td></tr>
</table></td></tr></table>
<h1><br />Transmission of Syslog Messages over TCP<br />draft-gerhards-syslog-plain-tcp-07.txt</h1>

<h3>Abstract</h3>

<p>
		There have been many implementations and deployments of legacy syslog over TCP for many years.  That 
		protocol has evolved without being standardized and has proven to be quite interoperable in practice.
		
</p>
<p>
		The aim of this specification is to document three things: how to transmit standardized syslog over TCP,
		how TCP has been used as a transport for legacy syslog, and how to correlate these usages to ensure interoperability.
		
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on August 3, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#conventions">2.</a>&nbsp;
Conventions Used in This Document<br />
<a href="#using">3.</a>&nbsp;
Message Transmission<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#session">3.1.</a>&nbsp;
Session<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sessionInit">3.2.</a>&nbsp;
Session Initiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msgxfer">3.3.</a>&nbsp;
Message Transfer<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#msg">3.4.</a>&nbsp;
Retaining the Original Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sessionClose">3.5.</a>&nbsp;
Session Closure<br />
<a href="#appst">4.</a>&nbsp;
Applicability Statement<br />
<a href="#security">5.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc5426">5.1.</a>&nbsp;
Security Considerations from RFC 5426<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reliability">5.2.</a>&nbsp;
Reliability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#transportsec">5.3.</a>&nbsp;
Transport Layer Security<br />
<a href="#iana">6.</a>&nbsp;
IANA Considerations<br />
<a href="#acks">7.</a>&nbsp;
Acknowledgments<br />
<a href="#NoteToEditor">8.</a>&nbsp;
Notes to the RFC Editor and Change Log<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative<br />
<a href="#legacy">Appendix&nbsp;A.</a>&nbsp;
Applicability to Legacy syslog<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#octet-counting-legacy">A.1.</a>&nbsp;
Octet-Counting<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#octet-stuffing-legacy">A.2.</a>&nbsp;
Octet-Stuffing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#change">A.3.</a>&nbsp;
Method Change<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dealwithit">A.4.</a>&nbsp;
Dealing with legacy syslog senders<br />
<a href="#rules">Appendix&nbsp;B.</a>&nbsp;
Simplified rules for Senders and Receivers<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
		Historically, the <a class='info' href='#RFC3164'>syslog protocol<span> (</span><span class='info'>Lonvick, C., &ldquo;The BSD Syslog Protocol,&rdquo; August&nbsp;2001.</span><span>)</span></a> [RFC3164] has been run over UDP.
		This has been replaced with the <a class='info' href='#RFC5424'>standardized syslog protocol<span> (</span><span class='info'>Gerhards, R., &ldquo;The Syslog Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5424]
		in which the <a class='info' href='#RFC5425'>TLS transport<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5425] is required.  Even so, there are many
		instances of syslog running atop TCP <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>.  This specification documents how the standardized 
		syslog protocol should be run atop TCP.  The appendices give more guidance on interoperability with legacy
		devices.
		
</p>
<p>
		Two primary format options have been observed with legacy 
		syslog being transported over TCP.  These are called octet-stuffing and octet-counting.
		The octet-stuffing mechanism has some inherent problems and is not recommended for use.  However, since
		receivers should be liberal in what they receive, the description of the octet-stuffing mechanism is
		detailed in the first appendix and implementers are encouraged to implement it as an option to ensure interoperability.
		
</p>
<p>
		Diagram 1 shows how all of these syslog transports relate to each other.
		In this diagram three originators are seen, labeled A, B, and C, along with one collector.
		Originator A is using the TCP transport which is described in this document.  Originator
		B is using the UDP transport which is described in <a class='info' href='#RFC5426'>[RFC5426]<span> (</span><span class='info'>Okmianski, A., &ldquo;Transmission of Syslog Messages over UDP,&rdquo; March&nbsp;2009.</span><span>)</span></a>.  Originator
		C is using the TLS transport which is described in <a class='info' href='#RFC5425'>[RFC5425]<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a>.  The collector
		is shown with the capability to accept all three transports.
		
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 +---------------------+
 | Originator A        |
 |---------------------|
 |  syslog application |
 |                     |
 |---------------------|
 |  syslog transport   |
 |        TCP          |
 |---------------------|
           v
           |
          /                            +---------------------+
         /                             | Originator B        |
        /                              |---------------------|
       /   +----------------------+    |  syslog application |
      /    | Collector            |    |                     |
     |     |----------------------|    |---------------------|
     |     |  syslog application  |    |  syslog transport   |
     |     |                      |    |        UDP          |
     |     |----------------------|    |---------------------|
     |     |  syslog transport    |              v
     |     |  TCP |  TLS  |  UDP  |              |
     |     |----------------------|              |
     |         ^      ^       ^                  |
     |         |      |       |                  |
     \         /      |       \                  /
      ---------       |        ------------------
                      |
                      |
                      |     +---------------------+
                      |     | Originator C        |
                      |     |---------------------|
                      |     |  syslog application |
                      |     |                     |
                      |     |---------------------|
                      |     |  syslog transport   |
                      |     |        TLS          |
                      |     |---------------------|
                      |               v
                      \               /
                       ---------------

             Diagram 1.  Syslog Layers
</pre></div>
<a name="conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions Used in This Document</h3>

<p>
			The terminology defined in Section 3 of <a class='info' href='#RFC5424'>[RFC5424]<span> (</span><span class='info'>Gerhards, R., &ldquo;The Syslog Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a> is
			used throughout this specification.  The reader should be familiar with
			that to follow this discussion.
			
</p>
<p>
			This document also references devices that use the syslog message format
			as described in <a class='info' href='#RFC3164'>[RFC3164]<span> (</span><span class='info'>Lonvick, C., &ldquo;The BSD Syslog Protocol,&rdquo; August&nbsp;2001.</span><span>)</span></a>.  Devices that continue to use that 
			message format (regardless of transport) will be described as &quot;legacy
			syslog devices&quot; in this document.  Similarly, devices that use the 
			message format as described in <a class='info' href='#RFC5424'>[RFC5424]<span> (</span><span class='info'>Gerhards, R., &ldquo;The Syslog Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a> will be described
			as &quot;standardized syslog devices&quot;.
			
</p>
<a name="using"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Message Transmission</h3>

<p>
			Syslog is simplex in nature.  Traditional implementations of syslog over TCP also do not use 
			any backchannel mechanism to convey information to the transport sender, and consequently 
			do not use any application-level acknowledgement for syslog receiver to sender signaling.  
			Message receipt acknowledgement, reliability, and flow control are provided by the 
			capabilities of TCP.
			
</p>
<a name="session"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Session</h3>

<p>
			A syslog over TCP session is a TCP connection between a syslog transport sender
			and a syslog transport receiver.  The syslog transport sender is the TCP host that sends the 
			original SYN.  The syslog transport receiver is the device that receives the original
			SYN and responds with a SYN+ACK.  After initiation, messages are sent from the transport
			sender to the transport receiver.  No application-level data is transmitted
			from the transport receiver to the transport sender.  The roles of transport
			sender and receiver are fixed once the session is established, and they can
			not be reversed during the session.  However, there can be multiple sessions between
			two TCP hosts, and for each session the role of transport sender and
			transport receiver can be different based upon which device initiates the session.
			
</p>
<p>
			It is valid (but rare) for no syslog messages to be exchanged during a TCP session.
			
</p>
<p>
			If an error occurs that cannot be corrected by TCP, the host detecting the error will 
			gracefully close the TCP session.  There are no application level messages that can be
			sent to notify the other host about the state of the host syslog application.
			
</p>
<a name="sessionInit"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Session Initiation</h3>

<p>
			The TCP host that intends to act as a syslog transport receiver listens to TCP port &lt;TBD&gt;.  
			The TCP host that intends to act as the transport sender initiates a 
			TCP session to the syslog transport receiver as specified in <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>.  
			
</p>
<a name="msgxfer"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Message Transfer</h3>

<p>
			During the message transfer phase, the syslog transport sender sends a 
			stream of messages to the transport receiver.  Either of the TCP hosts may initiate 
			session closure at any time as specified in Section 3.5 
			of <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>.  In practice, this is often seen
			after a prolonged period of inactivity.
			
</p>
<p>
			Syslog messages are sent in sequence within a TCP transport stream.  One message is encapsulated inside a frame.
			This method is known as the octet-counting method.  Another method known as the octet-stuffing method
			is described in the appendix below and it must not be used to transport standardized syslog.
			
</p>
<p>
			All syslog messages must be sent as TCP "data" as per 
			<a class='info' href='#RFC0793'>Transmission Control Protocol<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> [RFC0793].
			The syslog message stream has the following <a class='info' href='#RFC5234'>ABNF<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a> [RFC5234]
			definition:
			</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    TCP-DATA = *SYSLOG-FRAME

    SYSLOG-FRAME = MSG-LEN SP SYSLOG-MSG   ; Octet-counting method

    MSG-LEN = NONZERO-DIGIT *DIGIT

    SP = %d32

    NONZERO-DIGIT = %d49-57

    DIGIT = %d48 / NONZERO-DIGIT

    SYSLOG-MSG is defined in the syslog protocol [RFC5424]

</pre></div><p>

			
</p>
<p>
			MSG-LEN is the octet count of the SYSLOG-MSG in the
			SYSLOG-FRAME.  A transport receiver must use the message length to
			delimit a syslog message.  There is no upper limit for a message
			length per se.  However, in order to establish a baseline for
			interoperability, this specification requires that a transport
			receiver must be able to process messages with a length up to and
			including 2048 octets.  Transport receivers should be able to process
			messages with lengths up to and including 8192 octets.
			
</p>
<a name="msg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Retaining the Original Message</h3>

<p>
			In this method, a modification is made to the original message for transmission.  This
			is a temporary transformation performed by the transport sender.  According to
			Section 5 of <a class='info' href='#RFC5425'>[RFC5425]<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a>, this temporary transformation must be
			reversed by the transport protocol receiver so 
			that the relay or collector will see an exact copy of the message
			generated by the originator or relay.
			
</p>
<p>
			In this octet-counting method, a count and a space character are prepended to
			each message.  This is somewhat similar to the framing used in
                        <a class='info' href='#RFC5425'>Transport Layer Security (TLS) Transport Mapping for Syslog<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5425].

			The count and space character must be removed by the transport receiver after it 
			has validated that the count is correct.
			
</p>
<a name="sessionClose"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Session Closure</h3>

<p>
			The SYSLOG session is closed when one of the TCP hosts decides to do so.  It then initiates a local TCP 
			session closure.  It does not notify its remote TCP host of its intention to close the session, nor does
			it accept any messages that are still in transit.
			
</p>
<a name="appst"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Applicability Statement</h3>

<p>
			It is still recommended to use the <a class='info' href='#RFC5425'>TLS transport<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5425] to 
			transport syslog messages.  This specification is provided to ensure interoperability 
			for transporting syslog over TCP.
			
</p>
<p>
			There are several advantages to using TCP: flow control, error recovery, and reliability, to name a few.
			These reasons and the ease of programming have lead people to use this transmission protocol to transmit syslog.
			
</p>
<p>
			One potential disadvantage is the buffering mechanism used by TCP.  Ordinarily, TCP decides when 
			enough data has been received from the application to form a segment for transmission.  This may
			be adjusted through timers but still, some application data may wait in a buffer for a relatively 
			long time.  Syslog data is not normally time-sensitive but if this delay is a concern, the 
			syslog transport sender may utilize the PUSH Flag as described in <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> to have the 
			sending TCP immediately send all buffered data.
			
</p>
<p>
			Even though it is still recommended to use the <a class='info' href='#RFC5425'>TLS transport<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5425] to
                        convey syslog messages, it is expected that people will still use the TCP transport. 
			
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>
		Using this specification on an unsecured network is not recommended.
		Several syslog security considerations are discussed in <a class='info' href='#RFC5424'>[RFC5424]<span> (</span><span class='info'>Gerhards, R., &ldquo;The Syslog Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a>.
		This section focuses on security considerations specific to the
		syslog transport over TCP.  Some of the security issues raised in
		this section can be mitigated through the use of TLS as defined in
		<a class='info' href='#RFC5425'>[RFC5425]<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a>
		
</p>
<a name="rfc5426"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Security Considerations from RFC 5426</h3>

<p>
		In many security related respects, the transmission of syslog messages over TCP is very similar
		to the transmission of syslog messages over UDP as defined in <a class='info' href='#RFC5426'>[RFC5426]<span> (</span><span class='info'>Okmianski, A., &ldquo;Transmission of Syslog Messages over UDP,&rdquo; March&nbsp;2009.</span><span>)</span></a>.
		The reader of this document is encouraged to be familiar with the following security
		threats that are described in that RFC.
			</p>
<ul class="text">
<li> Sender Authentication and Message Forgery
</li>
<li> Message Observation
</li>
<li> Replaying
</li>
<li> Message Priorization and Differentiation
</li>
<li> Denial of Service
</li>
</ul><p>
		
</p>
<a name="reliability"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Reliability</h3>

<p>
		It should be noted that the syslog transport specified in this
		document does not use application-layer acknowledgments.  TCP uses
		retransmissions to provide protection against some forms of data
		loss.  However, if the TCP connection is broken for
		some reason (or closed by the transport receiver), the syslog
		transport sender cannot always know what messages were successfully
		delivered to the syslog application at the other end.
		
</p>
<a name="transportsec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Transport Layer Security</h3>

<p>
		Implementors should be aware of vulnerabilities in the transport layer that they choose.  In some cases, these 
		vulnerabilities will be in the implementation, such as in the case of the UDP checksum error <a class='info' href='#RFC1122'>[RFC1122]<span> (</span><span class='info'>Braden, R., &ldquo;Requirements for Internet Hosts - Communication Layers,&rdquo; October&nbsp;1989.</span><span>)</span></a>.
		In other cases, the vulnerability will be in the specification, such as in the case of the SSL/TLS renegotiation as 
		described in <a class='info' href='#RFC5746'>[RFC5746]<span> (</span><span class='info'>Rescorla, E., Ray, M., Dispensa, S., and N. Oskov, &ldquo;Transport Layer Security (TLS) Renegotiation Indication Extension,&rdquo; February&nbsp;2010.</span><span>)</span></a>.
		
</p>
<p>
		Specific to this transport, implementers may wish to review any known vulnerabilities of TCP prior to writing code.
		
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
	IANA is requested to provide a TCP port for this protocol.
	
</p>
<p>
	After that port has been assigned, this section will be revised to 
	list that port.
	
</p>
<a name="acks"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgments</h3>

<p>
			The authors wish to thank David Harrington, Tom Petch, 
			and all other people who commented on various versions of this proposal.
			
</p>
<a name="NoteToEditor"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Notes to the RFC Editor and Change Log</h3>

<p>
				These are notes to the RFC editor. Please delete this section
				after the notes have been followed.
			
</p>
<p>
			   Please replace the instances of &lt;TBD> the port number assigned by IANA.
			   
</p>
<p>
			Version -07 was submitted in January, 2011.  This clarified what was really expected from what was optional.
			Appendix B was added for further clarification.  Additionally, the security Considerations section was edited
			to include a discussion about transport layer issues.
			
</p>
<p>
			Version -06 was submitted in October, 2010.  The 2119 language was removed.  Also, we
			compared notes and couldn't find any implementations that stacked multiple messages
			in a frame in the octet-counting method.  That paragraph was removed.
			
</p>
<p>
			Version -05 was submitted in September, 2010 to address some items that David Harrington
			noted as he is becoming the document shepherd.
			
</p>
<p>
			Version -04 was submitted in April, 2010 to clean up some items.
			
</p>
<p>
			Version -03 was submitted in April, 2010 based upon further review comments from Tom Petch.
			
</p>
<p>
			Version -02 was submitted in March, 2010 based upon review comments from Tom Petch.
			
</p>
<p>
			Version -01 was submitted based upon review comments from David Harrington.
			
</p>
<p>
			Version -00 was created in November, 2009.
			
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC0793">[RFC0793]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>,&rdquo; STD&nbsp;7, RFC&nbsp;793, September&nbsp;1981 (<a href="http://www.rfc-editor.org/rfc/rfc793.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5424">[RFC5424]</a></td>
<td class="author-text">Gerhards, R., &ldquo;<a href="http://tools.ietf.org/html/rfc5424">The Syslog Protocol</a>,&rdquo; RFC&nbsp;5424, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5424.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5425">[RFC5425]</a></td>
<td class="author-text">Miao, F., Ma, Y., and J. Salowey, &ldquo;<a href="http://tools.ietf.org/html/rfc5425">Transport Layer Security (TLS) Transport Mapping for Syslog</a>,&rdquo; RFC&nbsp;5425, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5425.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5426">[RFC5426]</a></td>
<td class="author-text">Okmianski, A., &ldquo;<a href="http://tools.ietf.org/html/rfc5426">Transmission of Syslog Messages over UDP</a>,&rdquo; RFC&nbsp;5426, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5426.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1122">[RFC1122]</a></td>
<td class="author-text"><a href="mailto:Braden@ISI.EDU">Braden, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1122">Requirements for Internet Hosts - Communication Layers</a>,&rdquo; STD&nbsp;3, RFC&nbsp;1122, October&nbsp;1989 (<a href="http://www.rfc-editor.org/rfc/rfc1122.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3164">[RFC3164]</a></td>
<td class="author-text">Lonvick, C., &ldquo;<a href="http://tools.ietf.org/html/rfc3164">The BSD Syslog Protocol</a>,&rdquo; RFC&nbsp;3164, August&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3164.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5746">[RFC5746]</a></td>
<td class="author-text">Rescorla, E., Ray, M., Dispensa, S., and N. Oskov, &ldquo;<a href="http://tools.ietf.org/html/rfc5746">Transport Layer Security (TLS) Renegotiation Indication Extension</a>,&rdquo; RFC&nbsp;5746, February&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5746.txt">TXT</a>).</td></tr>
</table>

<a name="legacy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Applicability to Legacy syslog</h3>

<p>
			This appendix is provided for two reasons.
			</p>
<ul class="text">
<li> to promote interoperability within the various observed legacy implementations
</li>
<li> to give advice on how a standard syslog receiver should accept messages from legacy syslog senders
</li>
</ul><p>
			
</p>
<p>
			Syslog over TCP has been around for a number of years.  Just like legacy syslog over UDP,
			several different implementations exist.  The older method of octet-stuffing
			has problems so is not recommended, but should be implemented to ensure interoperability with older
			clients or servers that may only use this method.  The newer
			method of octet-counting is reliable and, as is consistent with this specification, should be implemented.
			When implementers do implement both methods, it is recommended that the default method be octet-counting.
			
</p>
<p>
			The ABNF for this is shown here.
                        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    TCP-DATA = *SYSLOG-FRAME

    SYSLOG-FRAME = MSG-LEN SP SYSLOG-3164   ; Octet-counting method
    SYSLOG-FRAME =/ SYSLOG-3164 TRAILER     ; Octet-stuffing method

    MSG-LEN = NONZERO-DIGIT *DIGIT

    SP = %d32

    NONZERO-DIGIT = %d49-57

    DIGIT = %d48 / NONZERO-DIGIT

    TRAILER = LF | APP-DEFINED

    LF = %d10

    APP-DEFINED = 1*2OCTET

    SYSLOG-3164 is defined in Section 4 of [RFC3164]

</pre></div><p>

			
</p>
<a name="octet-counting-legacy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Octet-Counting</h3>

<p>
                        This framing allows for the transmission of all characters inside SYSLOG-MSG and is 
			similar to the framing used in <a class='info' href='#RFC5425'>[RFC5425]<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a>. 
			MSG-LEN is the octet count of the SYSLOG-MSG in the
			SYSLOG-FRAME.  A transport receiver must use the message length to
			delimit a syslog message.  The upper limit for a legacy syslog message
			length is 1024 octets.
			
</p>
<p>
			A transport receiver must assume that octet-counting framing is used
			if a syslog frame starts with a digit.
			
</p>
<a name="octet-stuffing-legacy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Octet-Stuffing</h3>

<p>
			A transport receiver must assume that octet-stuffing framing is used if a syslog frame
			starts with the USASCII character "&lt;" (%d60).
			
</p>
<p>
			In this legacy implementation of octet-stuffing, the TRAILER consists of a single
			character and most often is the USASCII LF (%d10) character.
			A transport receiver must accept the USASCII LF character as a TRAILER.
			However, other characters have also been seen occasionally, with
			USASCII NUL (%d00) being a prominent example.  Some devices also
			emit a two-character TRAILER, which is usually CR and LF.  A transport receiver may be
			configurable to accept characters other than LF.
			
</p>
<p>
			The octet-stuffing method is not recommended.
			
</p>
<p>
			The problem with octet-stuffing framing comes from the use of 
			<a class='info' href='#RFC3164'>[RFC3164]<span> (</span><span class='info'>Lonvick, C., &ldquo;The BSD Syslog Protocol,&rdquo; August&nbsp;2001.</span><span>)</span></a> messages.  In that, the traditional trailer character
			is not escaped within SYSLOG-3164 which causes problems for the receiver.  
			For example, a message in the style of <a class='info' href='#RFC3164'>[RFC3164]<span> (</span><span class='info'>Lonvick, C., &ldquo;The BSD Syslog Protocol,&rdquo; August&nbsp;2001.</span><span>)</span></a>
			containing one or more LF characters may
			be misinterpreted as multiple messages by the transport
			receiver.  There is no method to avoid this problem with the
			octet-stuffing framing.
			
</p>
<a name="change"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Method Change</h3>

<p>
			It has been observed in legacy implementations that the framing may change on a frame-by-frame
			basis.  This behavior is not recommended.  However, for interoperability, a transport receiver 
			wishing to interoperate with these legacy systems should be prepared to accept different framing 
			for each frame received. 
			
</p>
<a name="dealwithit"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
Dealing with legacy syslog senders</h3>

<p>		
			The following are recommendations on how a standardized syslog receiver should handle
			messages received from legacy syslog senders.
                        </p>
<ul class="text">
<li>The standardized syslog receiver is required to support the octet-counting method.
</li>
<li>The standardized syslog receiver should support the octet-stuffing method.
</li>
</ul><p>
                        
</p>
<p>
			When supporting the octet-counting method, the standardized syslog receiver may encounter message lengths
			that are over 1024 octets and should not fail because of that.
			
</p>
<p>
			When supporting the octet-stuffing method, the standardized syslog receiver may encounter different 
			TRAILER characters.  They should be configured with a default of LF but should have the ability to
			be configured to accept other characters.  Similarly, they may encounter messages with lengths that
			are greater then 1024 octets and should not fail because of that.
			
</p>
<a name="rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Simplified rules for Senders and Receivers</h3>

<p>
			Since there may be some confusion about sending and receiving octet-stuffing and octet-counting packets, this
			appendix will attempt to clarify the recommendation for senders and receivers.
			</p>
<ul class="text">
<li> A standardized syslog transmitter must send messages using the octet-counting mechanism.  It will never
			send messages using the octet-stuffing mechanism. 
</li>
<li> A standardized syslog receiver must be set to receive octet-counting packets.  It may also be
			allowed to receive octet-stuffing packets from legacy senders. 
</li>
<li> A legacy syslog transmitter should only use the octet-counting method.  There are, however, still
			legacy transmitters that send octet-stuffing packets. 
</li>
<li> A legacy syslog receiver must accept octet-counting messages, and should be able to accept octet-stuffing
			messages.  It should be noted here that a legacy syslog receiver should be replaced with a standardized
			syslog receiver. 
</li>
</ul><p>
			
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rainer Gerhards</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adiscon GmbH</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mozartstrasse 21</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Grossrinderfeld, BW  97950</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:rgerhards@adiscon.com">rgerhards@adiscon.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chris Lonvick</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">12515 Research Blvd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Austin, TX  78759</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:clonvick@cisco.com">clonvick@cisco.com</a></td></tr>
</table>
</body></html>
