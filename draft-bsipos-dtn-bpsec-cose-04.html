<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>DTN Bundle Protocol Security COSE Security Contexts</title>
<meta content="Brian Sipos" name="author">
<meta content="
       
This document defines a security context suitable for using CBOR Object Signing and Encryption (COSE) algorithms within Bundle Protocol Security (BPSec) integrity and confidentiality blocks.
A profile of COSE is also defined for BPSec interoperation.
       
    " name="description">
<meta content="xml2rfc 3.5.0" name="generator">
<meta content="draft-bsipos-dtn-bpsec-cose-04" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.5.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.2.3
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.2
    kitchen 1.2.6
    lxml 4.6.2
    pycountry 20.7.3
    pyflakes 2.2.0
    PyYAML 5.3.1
    requests 2.25.1
    setuptools 51.0.0
    six 1.15.0
-->
<link href="/tmp/draft-sipos-dtn-bpsec-cose-1mhje_mn.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">DTN BPSec COSE</td>
<td class="right">December 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Sipos</td>
<td class="center">Expires 25 June 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Delay-Tolerant Networking</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-bsipos-dtn-bpsec-cose-04</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-12-22" class="published">22 December 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-06-25">25 June 2021</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">B. Sipos</div>
<div class="org">RKF Engineering</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">DTN Bundle Protocol Security COSE Security Contexts</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
This document defines a security context suitable for using CBOR Object Signing and Encryption (COSE) algorithms within Bundle Protocol Security (BPSec) integrity and confidentiality blocks.
A profile of COSE is also defined for BPSec interoperation.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 25 June 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-scope" class="xref">Scope</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-pkix-environments-and-ca-po" class="xref">PKIX Environments and CA Policy</a><a href="#section-toc.1-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="xref">1.3</a>.  <a href="#name-use-of-cddl" class="xref">Use of CDDL</a><a href="#section-toc.1-1.1.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-requirements-language" class="xref">Requirements Language</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-bpsec-security-context" class="xref">BPSec Security Context</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-security-scope" class="xref">Security Scope</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-parameters" class="xref">Parameters</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-key-containers" class="xref">Key Containers</a><a href="#section-toc.1-1.3.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="xref">3.2.2</a>.  <a href="#name-aad-scope" class="xref">AAD Scope</a><a href="#section-toc.1-1.3.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-results" class="xref">Results</a><a href="#section-toc.1-1.3.2.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.  <a href="#name-integrity-messages" class="xref">Integrity Messages</a><a href="#section-toc.1-1.3.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="xref">3.3.2</a>.  <a href="#name-confidentiality-messages" class="xref">Confidentiality Messages</a><a href="#section-toc.1-1.3.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-key-considerations" class="xref">Key Considerations</a><a href="#section-toc.1-1.3.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-canonicalization-algorithms" class="xref">Canonicalization Algorithms</a><a href="#section-toc.1-1.3.2.5.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.3.2.5.2.1">
                    <p id="section-toc.1-1.3.2.5.2.1.1"><a href="#section-3.5.1" class="xref">3.5.1</a>.  <a href="#name-generating-aad" class="xref">Generating AAD</a><a href="#section-toc.1-1.3.2.5.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.5.2.2">
                    <p id="section-toc.1-1.3.2.5.2.2.1"><a href="#section-3.5.2" class="xref">3.5.2</a>.  <a href="#name-payload-data" class="xref">Payload Data</a><a href="#section-toc.1-1.3.2.5.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="xref">3.6</a>.  <a href="#name-processing" class="xref">Processing</a><a href="#section-toc.1-1.3.2.6.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.3.2.6.2.1">
                    <p id="section-toc.1-1.3.2.6.2.1.1"><a href="#section-3.6.1" class="xref">3.6.1</a>.  <a href="#name-security-source-authenticat" class="xref">Security Source Authentication</a><a href="#section-toc.1-1.3.2.6.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.6.2.2">
                    <p id="section-toc.1-1.3.2.6.2.2.1"><a href="#section-3.6.2" class="xref">3.6.2</a>.  <a href="#name-policy-recommendations" class="xref">Policy Recommendations</a><a href="#section-toc.1-1.3.2.6.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-cose-profile-for-bpsec" class="xref">COSE Profile for BPSec</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-cose-messages" class="xref">COSE Messages</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-interoperability-algorithms" class="xref">Interoperability Algorithms</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-asymmetric-key-types-and-id" class="xref">Asymmetric Key Types and Identifiers</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="xref">4.3.1</a>.  <a href="#name-pkix-certificates" class="xref">PKIX Certificates</a><a href="#section-toc.1-1.4.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-pkix-certificate-profile" class="xref">PKIX Certificate Profile</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-multiple-certificate-uses" class="xref">Multiple-Certificate Uses</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-implementation-status" class="xref">Implementation Status</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-threat-bpsec-block-replay" class="xref">Threat: BPSec Block Replay</a><a href="#section-toc.1-1.7.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-threat-untrusted-end-entity" class="xref">Threat: Untrusted End-Entity Certificate</a><a href="#section-toc.1-1.7.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-threat-certificate-validati" class="xref">Threat: Certificate Validation Vulnerabilities</a><a href="#section-toc.1-1.7.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="xref">7.4</a>.  <a href="#name-threat-bp-node-impersonatio" class="xref">Threat: BP Node Impersonation</a><a href="#section-toc.1-1.7.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="xref">7.5</a>.  <a href="#name-threat-unidentifiable-key" class="xref">Threat: Unidentifiable Key</a><a href="#section-toc.1-1.7.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.7.2.6">
                <p id="section-toc.1-1.7.2.6.1"><a href="#section-7.6" class="xref">7.6</a>.  <a href="#name-threat-non-trusted-public-k" class="xref">Threat: Non-Trusted Public Key</a><a href="#section-toc.1-1.7.2.6.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.7.2.7">
                <p id="section-toc.1-1.7.2.7.1"><a href="#section-7.7" class="xref">7.7</a>.  <a href="#name-threat-passive-leak-of-key-" class="xref">Threat: Passive Leak of Key Material</a><a href="#section-toc.1-1.7.2.7.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.7.2.8">
                <p id="section-toc.1-1.7.2.8.1"><a href="#section-7.8" class="xref">7.8</a>.  <a href="#name-threat-algorithm-vulnerabil" class="xref">Threat: Algorithm Vulnerabilities</a><a href="#section-toc.1-1.7.2.8.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-bpsec-security-contexts" class="xref">BPSec Security Contexts</a><a href="#section-toc.1-1.8.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-acknowledgments" class="xref">Acknowledgments</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.10.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.10.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-examples" class="xref">Examples</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-a.1" class="xref">A.1</a>.  <a href="#name-symmetric-key-cose_mac0" class="xref">Symmetric Key COSE_Mac0</a><a href="#section-toc.1-1.11.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-a.2" class="xref">A.2</a>.  <a href="#name-ec-keypair-cose_sign1" class="xref">EC Keypair COSE_Sign1</a><a href="#section-toc.1-1.11.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#section-a.3" class="xref">A.3</a>.  <a href="#name-rsa-keypair-cose_sign1" class="xref">RSA Keypair COSE_Sign1</a><a href="#section-toc.1-1.11.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#section-a.4" class="xref">A.4</a>.  <a href="#name-symmetric-kek-cose_encrypt" class="xref">Symmetric KEK COSE_Encrypt</a><a href="#section-toc.1-1.11.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.11.2.5">
                <p id="section-toc.1-1.11.2.5.1"><a href="#section-a.5" class="xref">A.5</a>.  <a href="#name-ec-keypair-cose_encrypt" class="xref">EC Keypair COSE_Encrypt</a><a href="#section-toc.1-1.11.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.11.2.6">
                <p id="section-toc.1-1.11.2.6.1"><a href="#section-a.6" class="xref">A.6</a>.  <a href="#name-rsa-keypair-cose_encrypt" class="xref">RSA Keypair COSE_Encrypt</a><a href="#section-toc.1-1.11.2.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-appendix.b" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a><a href="#section-toc.1-1.12.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="sec-intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
The Bundle Protocol Security (BPSec) Specification <span>[<a href="#I-D.ietf-dtn-bpsec" class="xref">I-D.ietf-dtn-bpsec</a>]</span> defines structure and encoding for Block Integrity Block (BIB) and Block Confidentiality Block (BCB) types but does not specify any security contexts to be used by either of the security block types.
The CBOR Object Signing and Encryption (COSE) specification <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span> defines a structure, encoding, and algorithms to use for cryptographic signing and encryption.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
This document describes how to use the algorithms and encodings of COSE within BPSec blocks to apply those algorithms to Bundle security in <a href="#sec-bpsec-context" class="xref">Section 3</a>.
A bare minimum of interoperability algorithms and algorithm parameters is specified by this document in <a href="#sec-COSE-profile" class="xref">Section 4</a>.
The focus of the recommended algorithms is to allow BPSec to be used in a Public Key Infrastructure (PKI) as described in <a href="#sec-pkix-env" class="xref">Section 1.2</a>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">
Examples of specific uses are provided in <a href="#sec-examples" class="xref">Appendix A</a> to aid in implementation support of the interoperability algorithms.<a href="#section-1-3" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-scope">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-scope" class="section-name selfRef">Scope</a>
        </h3>
<p id="section-1.1-1">
This document describes a profile of COSE which is tailored for use in BPSec and a method of including full COSE messages within BPSec security blocks.
This document does not address:<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-2.1">
Policies or mechanisms for issuing Public Key Infrastructure Using X.509 (PKIX) certificates; provisioning, deploying, or accessing certificates and private keys; deploying or accessing certificate revocation lists (CRLs); or configuring security parameters on an individual entity or across a network.<a href="#section-1.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.2">
Uses of COSE beyond the profile defined in this document.<a href="#section-1.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.3">
How those COSE algorithms are intended to be used within a larger security context.
Many header parameters used by COSE (e.g., key identifiers) depend on the network environment and security policy related to that environment.<a href="#section-1.1-2.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<div id="sec-pkix-env">
<section id="section-1.2">
        <h3 id="name-pkix-environments-and-ca-po">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-pkix-environments-and-ca-po" class="section-name selfRef">PKIX Environments and CA Policy</a>
        </h3>
<p id="section-1.2-1">
This specification gives requirements about how to use PKIX certificates issued by a Certificate Authority (CA), but does not define any mechanisms for how those certificates come to be.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">
To support the PKIX uses defined in this document, the CA(s) issuing certificates for BP nodes are aware of the end use of the certificate, have a mechanism for verifying ownership of a Node ID, and are issuing certificates directly for that Node ID.
BPSec security acceptors authenticate the Node ID of security sources when verifying integrity (see <a href="#sec-context-auth" class="xref">Section 3.6.1</a>) using a public key provided by a PKIX certificate (see <a href="#sec-pkix-certs" class="xref">Section 4.3.1</a>) following the certificate profile of <a href="#sec-pkix-profile" class="xref">Section 5</a>.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-1.3">
        <h3 id="name-use-of-cddl">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-use-of-cddl" class="section-name selfRef">Use of CDDL</a>
        </h3>
<p id="section-1.3-1">
This document defines CBOR structure using the Concise Data Definition Language (CDDL) of <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span>.
The entire CDDL structure can be extracted from the XML version of this document using the XPath expression:<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<div id="section-1.3-2">
<pre class="sourcecode">'//sourcecode[@type="cddl"]'</pre><a href="#section-1.3-2" class="pilcrow">¶</a>
</div>
<p id="section-1.3-3">
The following initial fragment defines the top-level symbols of this document's CDDL, including the ASB data structure with its parameter/result sockets.<a href="#section-1.3-3" class="pilcrow">¶</a></p>
<div id="section-1.3-4">
<pre class="sourcecode lang-cddl">
start = AAD-value / ext-data-asb
</pre><a href="#section-1.3-4" class="pilcrow">¶</a>
</div>
</section>
</section>
</div>
<section id="section-2">
      <h2 id="name-requirements-language">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
      </h2>
<p id="section-2-1">
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
<div id="sec-bpsec-context">
<section id="section-3">
      <h2 id="name-bpsec-security-context">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-bpsec-security-context" class="section-name selfRef">BPSec Security Context</a>
      </h2>
<p id="section-3-1">
This document specifies a single security context for use in both BPSec integrity and confidentiality blocks.
This is done to save code points allocated to this specification and to simplify the encoding of COSE-in-BPSec; the BPSec block type uniquely defines the acceptable parameters and COSE messages which can be present.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">
The COSE security context SHALL have the Security Context ID specified in <a href="#sec-iana-bpsec-ctx" class="xref">Section 8.1</a>.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">
Both types of security block can use the same parameters, defined in <a href="#sec-ASB-parameters" class="xref">Section 3.2</a>, to carry public key-related information and each type of security block allows specific COSE message results, defined in <a href="#sec-ASB-results" class="xref">Section 3.3</a>.<a href="#section-3-3" class="pilcrow">¶</a></p>
<section id="section-3.1">
        <h3 id="name-security-scope">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-security-scope" class="section-name selfRef">Security Scope</a>
        </h3>
<p id="section-3.1-1">
The scope here refers to the set of information used by the security context to cryptographically bind with the plaintext data being integrity-protected or confididentiality-protected.
This information is generically referred to as additional authenticated data (AAD), which is also the term used by COSE to describe the same data.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">
The sources for AAD within the COSE context are described below, controlled by the AAD Scope Flags parameter of <a href="#sec-ASB-param-AAD-scope" class="xref">Section 3.2.2</a>, and implemented as defined in <a href="#sec-context-AAD" class="xref">Section 3.5.1</a>.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.1-3">
          <dt id="section-3.1-3.1">Bundle Primary Block</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-3.2">
The primary block identifies a bundle and, once created, the contents of this block are immutable.
Changes to the primary block associated with the security target indicate that the target is no longer in its original bundle.
Including this data as part of AAD ensures that security target appears in the same bundle that the security source intended.<a href="#section-3.1-3.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-3.3">Target Block Metadata</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-3.4">
When the target block is a canonical block (i.e., not the primary block) it contains its block-type-specific data, which is the subject of the security operation, but also metadata identifying the block.
This metadata explicitly excludes the CRC type and value fields because the CRC is derived from the block-type-specific data.   
Including this data as part of AAD ensures that the target data appears in the same block that the security source intended.<a href="#section-3.1-3.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-3.5">Security Block Metadata</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-3.6">
The BPSec block containing the security result for which the AAD is assembled also has metadata identifying the block.
Including this data as part of AAD ensures that the security result appears in the same block that the security source intended.<a href="#section-3.1-3.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
<div id="sec-ASB-parameters">
<section id="section-3.2">
        <h3 id="name-parameters">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-parameters" class="section-name selfRef">Parameters</a>
        </h3>
<p id="section-3.2-1">
Each COSE context parameter value SHALL consist of the COSE structure indicated by <a href="#tab-ASB-parameters" class="xref">Table 1</a> in its decoded (CBOR item) form.
Each security block MAY contain any number of each parameter type.
When a parameter is not present, the security acceptor SHALL use the Default Value of <a href="#tab-ASB-parameters" class="xref">Table 1</a>.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<span id="name-cose-security-parameters"></span><div id="tab-ASB-parameters">
<table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-cose-security-parameters" class="selfRef">COSE Security Parameters</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Parameter ID</th>
              <th class="text-left" rowspan="1" colspan="1">Parameter Structure</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
              <th class="text-left" rowspan="1" colspan="1">Default Value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">COSE_Key</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>
              </td>
              <td class="text-left" rowspan="1" colspan="1">none</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">COSE_KeySet</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>
              </td>
              <td class="text-left" rowspan="1" colspan="1">none</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">3</td>
              <td class="text-left" rowspan="1" colspan="1">COSE_X509 as x5chain</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span>
              </td>
              <td class="text-left" rowspan="1" colspan="1">none</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">4</td>
              <td class="text-left" rowspan="1" colspan="1">COSE_X509 as x5bag</td>
              <td class="text-left" rowspan="1" colspan="1">
                <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span>
              </td>
              <td class="text-left" rowspan="1" colspan="1">none</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">5</td>
              <td class="text-left" rowspan="1" colspan="1">AAD_Scope</td>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#sec-ASB-param-AAD-scope" class="xref">Section 3.2.2</a> of this RFC</td>
              <td class="text-left" rowspan="1" colspan="1">0x7 (all contexts)</td>
            </tr>
          </tbody>
        </table>
</div>
<span id="name-cose-context-parameters-cdd"></span><div id="fig-params-CDDL">
<figure id="figure-1">
          <div id="section-3.2-3.1">
<pre class="sourcecode lang-cddl">
$bpsec-param-pair /= [1, COSE_Key]
$bpsec-param-pair /= [2, COSE_KeySet]
$bpsec-param-pair /= [3, x5chain: COSE_X509]
$bpsec-param-pair /= [4, x5bag: COSE_X509]
$bpsec-param-pair /= [5, AAD-scope]
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-cose-context-parameters-cdd" class="selfRef">COSE context parameters CDDL</a>
          </figcaption></figure>
</div>
<div id="sec-ASB-param-keys">
<section id="section-3.2.1">
          <h4 id="name-key-containers">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-key-containers" class="section-name selfRef">Key Containers</a>
          </h4>
<p id="section-3.2.1-1">
Implementations capable of handling asymmetric-keyed algorithms SHOULD support the public key handling parameters of <a href="#tab-ASB-parameters" class="xref">Table 1</a>.
See <a href="#sec-asym-keys" class="xref">Section 4.3</a> for a definition of how the aggregate of all public keys and certificates in security parameters apply to each security result.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-3.2.1-2">
COSE security parameters SHALL NOT contain any private key material.
The security parameters are all stored in the bundle as plaintext and are visible to any bundle handlers.<a href="#section-3.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-ASB-param-AAD-scope">
<section id="section-3.2.2">
          <h4 id="name-aad-scope">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-aad-scope" class="section-name selfRef">AAD Scope</a>
          </h4>
<p id="section-3.2.2-1">
The AAD Scope parameter controls what data is included in the AAD for both integrity and confidentiality operations.
The AAD Scope parameter SHALL be encoded as a unit value with bit flags defined in <a href="#tab-AAD-scope-flags" class="xref">Table 2</a>.
The default value for this parameter has all flags set which has the AAD include all available context.<a href="#section-3.2.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2.2-2">
A CDDL representation of this definition is included in <a href="#fig-AAD-scope-cddl" class="xref">Figure 2</a> for reference.<a href="#section-3.2.2-2" class="pilcrow">¶</a></p>
<span id="name-aad-scope-flags"></span><div id="tab-AAD-scope-flags">
<table class="center" id="table-2">
            <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-aad-scope-flags" class="selfRef">AAD Scope Flags</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Name</th>
                <th class="text-left" rowspan="1" colspan="1">Code</th>
                <th class="text-left" rowspan="1" colspan="1">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">has-primary-ctx</td>
                <td class="text-left" rowspan="1" colspan="1">0x01</td>
                <td class="text-left" rowspan="1" colspan="1">If bit is set, indicates that the primary block is included in AAD scope.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">has-target-ctx</td>
                <td class="text-left" rowspan="1" colspan="1">0x02</td>
                <td class="text-left" rowspan="1" colspan="1">If bit is set, indicates that the target block metadata is included in AAD scope.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">has-security-ctx</td>
                <td class="text-left" rowspan="1" colspan="1">0x04</td>
                <td class="text-left" rowspan="1" colspan="1">If bit is set, indicates that the security block metadata is included in AAD scope.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">Reserved</td>
                <td class="text-left" rowspan="1" colspan="1">others</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
            </tbody>
          </table>
</div>
<span id="name-aad-scope-cddl"></span><div id="fig-AAD-scope-cddl">
<figure id="figure-2">
            <div id="section-3.2.2-4.1">
<pre class="sourcecode lang-cddl">
AAD-scope = uint .bits AAD-scope-flags
AAD-scope-flags = &amp;(
    has-primary-ctx: 0,
    has-target-ctx: 1,
    has-security-ctx: 2,
)
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-aad-scope-cddl" class="selfRef">AAD Scope CDDL</a>
            </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sec-ASB-results">
<section id="section-3.3">
        <h3 id="name-results">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-results" class="section-name selfRef">Results</a>
        </h3>
<p id="section-3.3-1">
Although each COSE context result is a COSE message, the types of message allowed depend upon the security block type in which the result is present: only MAC or signature messages are allowed in a BIB and only encryption messages are allowed in a BCB.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">
The code points for Result ID values are identical to the  existing COSE message-marking tags in <span><a href="https://rfc-editor.org/rfc/rfc8152#section-2" class="relref">Section 2</a> of [<a href="#RFC8152" class="xref">RFC8152</a>]</span>.
This avoids the need for value-mapping between code points of the two registries.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">
When embedding COSE messages, the CBOR structure SHALL be directly included within the abstract security block (ASB) CBOR structure.
There is no use of embedded encoded CBOR (e.g. CBOR encoded as a byte string) in this specification.
When embedding COSE messages, the CBOR-tagged form SHALL NOT be used.
The Result ID values already provide the same information as the COSE tags (using the same code points).<a href="#section-3.3-3" class="pilcrow">¶</a></p>
<p id="section-3.3-4">
These generic requirements are formalized in the CDDL fragment of <a href="#fig-results-CDDL" class="xref">Figure 3</a>.<a href="#section-3.3-4" class="pilcrow">¶</a></p>
<span id="name-cose-context-results-cddl"></span><div id="fig-results-CDDL">
<figure id="figure-3">
          <div id="section-3.3-5.1">
<pre class="sourcecode lang-cddl">
$bpsec-result-pair /= [16, COSE_Encrypt0]
$bpsec-result-pair /= [17, COSE_Mac0]
$bpsec-result-pair /= [18, COSE_Sign1]
$bpsec-result-pair /= [96, COSE_Encrypt]
$bpsec-result-pair /= [97, COSE_Mac]
$bpsec-result-pair /= [98, COSE_Sign]
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-cose-context-results-cddl" class="selfRef">COSE context results CDDL</a>
          </figcaption></figure>
</div>
<div id="sec-ASB-results-BIB">
<section id="section-3.3.1">
          <h4 id="name-integrity-messages">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-integrity-messages" class="section-name selfRef">Integrity Messages</a>
          </h4>
<p id="section-3.3.1-1">
When used within a Block Integrity Block, the COSE context SHALL allow only the Result IDs from <a href="#tab-BIB-results" class="xref">Table 3</a>.
Each integrity result value SHALL consist of the COSE message indicated by <a href="#tab-BIB-results" class="xref">Table 3</a> in its decoded form.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<span id="name-cose-integrity-results"></span><div id="tab-BIB-results">
<table class="center" id="table-3">
            <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-cose-integrity-results" class="selfRef">COSE Integrity Results</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Result ID</th>
                <th class="text-left" rowspan="1" colspan="1">Result Structure</th>
                <th class="text-left" rowspan="1" colspan="1">Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">97</td>
                <td class="text-left" rowspan="1" colspan="1">COSE_Mac</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>
                </td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">17</td>
                <td class="text-left" rowspan="1" colspan="1">COSE_Mac0</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>
                </td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">98</td>
                <td class="text-left" rowspan="1" colspan="1">COSE_Sign</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>
                </td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">18</td>
                <td class="text-left" rowspan="1" colspan="1">COSE_Sign1</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>
                </td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-3.3.1-3">
Each integrity result SHALL use the "detached" payload form with nil payload value.
The integrity result for COSE_Mac and COSE_Mac0 messages are computed by the procedure in <span><a href="https://rfc-editor.org/rfc/rfc8152#section-6.3" class="relref">Section 6.3</a> of [<a href="#RFC8152" class="xref">RFC8152</a>]</span>.
The integrity result for COSE_Sign and COSE_Sign1 messages are computed by the procedure in <span><a href="https://rfc-editor.org/rfc/rfc8152#section-4.4" class="relref">Section 4.4</a> of [<a href="#RFC8152" class="xref">RFC8152</a>]</span>.<a href="#section-3.3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.3.1-4">
The COSE "protected attributes from the application" used for a signature or MAC result SHALL be the encoded data defined in <a href="#sec-context-AAD" class="xref">Section 3.5.1</a>.
The COSE payload used for a signature or MAC result SHALL be either the block-type-specific data of the target, if the target is not the primary block, or an empty byte string if the target is the primary block.<a href="#section-3.3.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-ASB-results-BCB">
<section id="section-3.3.2">
          <h4 id="name-confidentiality-messages">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-confidentiality-messages" class="section-name selfRef">Confidentiality Messages</a>
          </h4>
<p id="section-3.3.2-1">
When used within a Block Confidentiality Block, COSE context SHALL allow only the Result IDs from <a href="#tab-BCB-results" class="xref">Table 4</a>.
Each confidentiality result value SHALL consist of the COSE message indicated by <a href="#tab-BCB-results" class="xref">Table 4</a> in its decoded form.<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
<span id="name-cose-confidentiality-result"></span><div id="tab-BCB-results">
<table class="center" id="table-4">
            <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-cose-confidentiality-result" class="selfRef">COSE Confidentiality Results</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Result ID</th>
                <th class="text-left" rowspan="1" colspan="1">Result Structure</th>
                <th class="text-left" rowspan="1" colspan="1">Reference</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">96</td>
                <td class="text-left" rowspan="1" colspan="1">COSE_Encrypt</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>
                </td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">COSE_Encrypt0</td>
                <td class="text-left" rowspan="1" colspan="1">
                  <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>
                </td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-3.3.2-3">
Only algorithms which support Authenticated Encryption with Authenticated Data (AEAD) SHALL be usable in the first (content) layer of a confidentiality result.
Because COSE encryption with AEAD appends the authentication tag with the ciphertext, the size of the block-type-specific-data will grow after an encryption operation.
Security acceptors MUST NOT assume that the size of the plaintext is the same as the size of the ciphertext.<a href="#section-3.3.2-3" class="pilcrow">¶</a></p>
<p id="section-3.3.2-4">
Each confidentiality result SHALL use the "detached" payload form with nil payload value.
The confidentiality result for COSE_Encrypt and COSE_Encrypt0 messages are computed by the procedure in <span><a href="https://rfc-editor.org/rfc/rfc8152#section-5.3" class="relref">Section 5.3</a> of [<a href="#RFC8152" class="xref">RFC8152</a>]</span>.<a href="#section-3.3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.3.2-5">
The COSE "protected attributes from the application" used for an encryption result SHALL be the encoded data defined in <a href="#sec-context-AAD" class="xref">Section 3.5.1</a>.
The COSE payload used for an encryption result SHALL be the block-type-specific data of the target.
Because confidentiality of the primary block is disallowed by BPSec, there is no logic here for handling a BCB with a target on the primary block.<a href="#section-3.3.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-3.4">
        <h3 id="name-key-considerations">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-key-considerations" class="section-name selfRef">Key Considerations</a>
        </h3>
<p id="section-3.4-1">
This specification does not impose any additional key requirements beyond those already specified for each COSE algorithim required in <a href="#sec-COSE-profile" class="xref">Section 4</a>.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3.5">
        <h3 id="name-canonicalization-algorithms">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-canonicalization-algorithms" class="section-name selfRef">Canonicalization Algorithms</a>
        </h3>
<p id="section-3.5-1">
Generating or processing COSE messages for the COSE context follows the profile defined in <a href="#sec-COSE-profile" class="xref">Section 4</a> with the "protected attributes from the application" (i.e., the "external_aad" item) generated as defined in <a href="#sec-context-AAD" class="xref">Section 3.5.1</a>.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<div id="sec-context-AAD">
<section id="section-3.5.1">
          <h4 id="name-generating-aad">
<a href="#section-3.5.1" class="section-number selfRef">3.5.1. </a><a href="#name-generating-aad" class="section-name selfRef">Generating AAD</a>
          </h4>
<p id="section-3.5.1-1">
The AAD used for both integrity and confidentiality messages SHALL be the determistically encoded form of a CBOR array containing the following:<a href="#section-3.5.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.5.1-2">
            <li id="section-3.5.1-2.1">
The first item SHALL be either: the CBOR array (unencoded) form of the primary block of the bundle if the AAD Scope has the has-primary-ctx flag set, otherwise the null value.<a href="#section-3.5.1-2.1" class="pilcrow">¶</a>
</li>
            <li id="section-3.5.1-2.2">
The second item SHALL be either: a CBOR array containing the first three fields of the target block (i.e., the block type code, block number, and control flags) if the AAD Scope has the has-target-ctx flag set, otherwise the null value.<a href="#section-3.5.1-2.2" class="pilcrow">¶</a>
</li>
            <li id="section-3.5.1-2.3">
The third item SHALL be either: a CBOR array containing the first three fields of the security block containing the result (i.e., the block type code, block number, and control flags) if the AAD Scope has the has-security-ctx flag set, otherwise the null value.<a href="#section-3.5.1-2.3" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-3.5.1-3">
A CDDL representation of this data is shown below in <a href="#fig-AAD-CDDL" class="xref">Figure 4</a>.<a href="#section-3.5.1-3" class="pilcrow">¶</a></p>
<span id="name-cose-context-aad-cddl"></span><div id="fig-AAD-CDDL">
<figure id="figure-4">
            <div id="section-3.5.1-4.1">
<pre class="sourcecode lang-cddl">
AAD-value = bstr .cbor AAD-structure
AAD-structure = [
    primary-ctx:  null / primary-block,  ; if has-primary-ctx is set
    target-ctx:   null / block-metadata, ; if has-target-ctx is set
    security-ctx: null / block-metadata  ; if has-security-ctx is set
]
; The first three fields of BP "canonical-block-structure"
block-metadata = [
    block-type-code: uint,
    block-number: uint,
    block-control-flags,
]
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-cose-context-aad-cddl" class="selfRef">COSE context AAD CDDL</a>
            </figcaption></figure>
</div>
</section>
</div>
<section id="section-3.5.2">
          <h4 id="name-payload-data">
<a href="#section-3.5.2" class="section-number selfRef">3.5.2. </a><a href="#name-payload-data" class="section-name selfRef">Payload Data</a>
          </h4>
<p id="section-3.5.2-1">
When correlating between BPSec target block-type-specific-data and COSE plaintext or payload, any byte string SHALL be handled in its decoded (CBOR item) form.
This means any CBOR header or tag in a source encoding are ignored for the purposes of security processing.
This also means that if the source byte string was encoded in a non-conforming way, for example in indefinite-length form or with a non-minimum-size lengnth, the security processing always treats it in a determistically encoded CBOR form.<a href="#section-3.5.2-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-3.6">
        <h3 id="name-processing">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-processing" class="section-name selfRef">Processing</a>
        </h3>
<p id="section-3.6-1">
This section describes block-level requirements for handling COSE security data.<a href="#section-3.6-1" class="pilcrow">¶</a></p>
<p id="section-3.6-2">
Security results generated for BIB or BCB results SHALL conform to the COSE profile of <a href="#sec-COSE-profile" class="xref">Section 4</a>.
Security acceptors SHOULD<a href="#section-3.6-2" class="pilcrow">¶</a></p>
<div id="sec-context-auth">
<section id="section-3.6.1">
          <h4 id="name-security-source-authenticat">
<a href="#section-3.6.1" class="section-number selfRef">3.6.1. </a><a href="#name-security-source-authenticat" class="section-name selfRef">Security Source Authentication</a>
          </h4>
<p id="section-3.6.1-1">
This section explains how the certificate profile of <a href="#sec-pkix-profile" class="xref">Section 5</a> is used by a security acceptor to both validate an end-entity certificate and to use that certificate to authenticate the security source for the COSE security context.<a href="#section-3.6.1-1" class="pilcrow">¶</a></p>
<p id="section-3.6.1-2">
Because of the standard policy of using separate certificates for transport, signing, and encryption (see <a href="#sec-pkix-multiple-certs" class="xref">Section 5.1</a>) a single Node ID is likely to be associated with mulitple certificates, and any or all of those certificates can be present as security parameters (see <a href="#sec-ASB-param-keys" class="xref">Section 3.2.1</a>).
When present, a security acceptor SHALL use an "x5t" identifier from a COSE recipient to identify an end-entity certificate to use for result processing.
Security acceptors SHALL NOT assume that a validated certificate containing a NODE-ID matching a security source is enough to associate a certificate with a COSE message or recipient.<a href="#section-3.6.1-2" class="pilcrow">¶</a></p>
<div id="sec-context-auth-valid-cert">
<section id="section-3.6.1.1">
            <h5 id="name-certificate-path-and-purpos">
<a href="#section-3.6.1.1" class="section-number selfRef">3.6.1.1. </a><a href="#name-certificate-path-and-purpos" class="section-name selfRef">Certificate Path and Purpose Validation</a>
            </h5>
<p id="section-3.6.1.1-1">
For each end-entity certificate referenced by a COSE context result, the security acceptor SHALL perform the certification path validation of <span>[<a href="#RFC5280" class="xref">RFC5280</a>]</span> up to one of the acceptor's trusted CA certificates.
If enabled by local policy, the entity SHALL perform an OCSP check of each certificate providing OCSP authoritiy information in accordance with <span>[<a href="#RFC6960" class="xref">RFC6960</a>]</span>.
If certificate validation fails or if security policy disallows a certificate for any reason, the acceptor SHALL treat the associated security result as failed.
Leaving out part of the certification chain can cause the entity to fail to validate a certificate if the left-out certificates are unknown to the entity (see <a href="#sec-threat-untrust-cert" class="xref">Section 7.2</a>).<a href="#section-3.6.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.6.1.1-2">
For each end-entity certificate referenced by a COSE context result, the security acceptor SHALL apply security policy to the Key Usage extension (if present) and Extended Key Usage extension (if present) in accordance with <span><a href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.12" class="relref">Section 4.2.1.12</a> of [<a href="#RFC5280" class="xref">RFC5280</a>]</span> and the profile in <a href="#sec-pkix-profile" class="xref">Section 5</a>.<a href="#section-3.6.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-context-auth-valid-nodeid">
<section id="section-3.6.1.2">
            <h5 id="name-node-id-authentication">
<a href="#section-3.6.1.2" class="section-number selfRef">3.6.1.2. </a><a href="#name-node-id-authentication" class="section-name selfRef">Node ID Authentication</a>
            </h5>
<p id="section-3.6.1.2-1">
If required by security policy, for each end-entity certificate referenced by a COSE context result the security acceptor SHALL validate the certificate NODE-ID in accordance with <span><a href="https://rfc-editor.org/rfc/rfc6125#section-6" class="relref">Section 6</a> of [<a href="#RFC6125" class="xref">RFC6125</a>]</span> using the NODE-ID reference identifier from either the Security Source (if present) or the Bundle Source (as the implied security source).
If the NODE-ID validation result is Failure or if the result is Absent and security policy requires an authenticated Node ID, the security acceptor SHALL treat the result as failed.<a href="#section-3.6.1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-context-auth-policy-rec">
<section id="section-3.6.2">
          <h4 id="name-policy-recommendations">
<a href="#section-3.6.2" class="section-number selfRef">3.6.2. </a><a href="#name-policy-recommendations" class="section-name selfRef">Policy Recommendations</a>
          </h4>
<p id="section-3.6.2-1">
A RECOMMENDED security policy is to enable the use of OCSP checking when internet connectivity is present.
A RECOMMENDED security policy is that if an Extended Key Usage is present that it needs to contain "id-kp-bundleSecurity" to be usable as an end-entity certificate for with COSE security results.
A RECOMMENDED security policy is to require a validated Node ID (of <a href="#sec-context-auth-valid-nodeid" class="xref">Section 3.6.1.2</a>) and to ignore any other identifiers in the end-entity certificate.<a href="#section-3.6.2-1" class="pilcrow">¶</a></p>
<p id="section-3.6.2-2">
This policy relies on and informs the certificate requirements in <a href="#sec-pkix-certs" class="xref">Section 4.3.1</a>.
This policy assumes that a DTN-aware CA (see <a href="#sec-pkix-env" class="xref">Section 1.2</a>) will only issue a certificate for a Node ID when it has verified that the private key holder actually controls the DTN node; this is needed to avoid the threat identified in <a href="#sec-threat-node-impersonation" class="xref">Section 7.4</a>.
This policy requires that a certificate contain a NODE-ID and allows the certificate to also contain network-level identifiers.
A tailored policy on a more controlled network could relax the requirement on Node ID validation and/or Extended Key Usage presence.<a href="#section-3.6.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</section>
</div>
<div id="sec-COSE-profile">
<section id="section-4">
      <h2 id="name-cose-profile-for-bpsec">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-cose-profile-for-bpsec" class="section-name selfRef">COSE Profile for BPSec</a>
      </h2>
<p id="section-4-1">
This section contains requirements which apply to the use of COSE within BPSec across any security context use.<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="sec-COSE-messages">
<section id="section-4.1">
        <h3 id="name-cose-messages">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-cose-messages" class="section-name selfRef">COSE Messages</a>
        </h3>
<p id="section-4.1-1">
When generating a BPSec result, security sources SHALL use encode COSE labels with a uint value.
When processing a BPSec result, security acceptors MAY handle COSE labels with with a tstr value.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">
When used in a BPSec result, each COSE message SHALL contain an explicit algorithm identifier in the lower (content) layers.
When available and not implied by the bundle source, a COSE message SHALL contain a key identifier in the highest (recipient) layer.
See <a href="#sec-asym-keys" class="xref">Section 4.3</a> for specifics about asymmetric key identifiers.
When a key identifier is not available, BPSec acceptors SHALL use the Security Source (if available) and the Bundle Source to imply which keys can be used for security operations.
Using implied keys has an interoperability risk, see <a href="#sec-threat-unident-key" class="xref">Section 7.5</a> for details.
A BPSec security operation always occurs within the context of the immutable primary block with its parameters (specifically the Source Node ID) and the security block with its optional Security Source.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">
The algorithms required by this profile focuses on networks using shared symmetric-keys, with recommended algorithms for Elliptic Curve (EC) keypairs and RSA keypairs.
The focus of this profile is to enable interoperation between security sources and acceptors on an open network, where more explicit COSE parameters make it easier for BPSec acceptors to avoid assumptions and avoid out-of-band parameters.
The requirements of this profile still allow the use of potentially not-easily-interoperable algorithms and message/recipient configurations for use by private networks, where message size is more important than explicit COSE parameters.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-interop-alg">
<section id="section-4.2">
        <h3 id="name-interoperability-algorithms">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-interoperability-algorithms" class="section-name selfRef">Interoperability Algorithms</a>
        </h3>
<p id="section-4.2-1">
[NOTE: The required list is identical to the <span>[<a href="#I-D.ietf-dtn-bpsec-interop-sc" class="xref">I-D.ietf-dtn-bpsec-interop-sc</a>]</span> list.]
The set of integrity algorithms needed for interoperability is listed here.
The full set of COSE algorithms available is managed at <span>[<a href="#IANA-COSE" class="xref">IANA-COSE</a>]</span>.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">
Implementations conforming to this specification SHALL support the symmetric keyed and key-encryption algorithms of <a href="#tab-interop" class="xref">Table 5</a>.
Implementations capable of doing so SHOULD support the asymmetric keyed and key-encryption algorithms of <a href="#tab-interop" class="xref">Table 5</a>.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<span id="name-interoperability-algorithms-2"></span><div id="tab-interop">
<table class="center" id="table-5">
          <caption>
<a href="#table-5" class="selfRef">Table 5</a>:
<a href="#name-interoperability-algorithms-2" class="selfRef">Interoperability Algorithms</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">BPSec Block</th>
              <th class="text-left" rowspan="1" colspan="1">COSE Layer</th>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Code</th>
              <th class="text-left" rowspan="1" colspan="1">Implementation Requirements</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Integrity</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">HMAC 256/256</td>
              <td class="text-left" rowspan="1" colspan="1">5</td>
              <td class="text-left" rowspan="1" colspan="1">Required</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Integrity</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">ES256</td>
              <td class="text-left" rowspan="1" colspan="1">-7</td>
              <td class="text-left" rowspan="1" colspan="1">Recommended</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Integrity</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">EdDSA</td>
              <td class="text-left" rowspan="1" colspan="1">-8</td>
              <td class="text-left" rowspan="1" colspan="1">Recommended</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Integrity</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">PS256</td>
              <td class="text-left" rowspan="1" colspan="1">-37</td>
              <td class="text-left" rowspan="1" colspan="1">Recommended</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Confidentiality</td>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">A256GCM</td>
              <td class="text-left" rowspan="1" colspan="1">3</td>
              <td class="text-left" rowspan="1" colspan="1">Required</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Confidentiality</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">A256KW</td>
              <td class="text-left" rowspan="1" colspan="1">-5</td>
              <td class="text-left" rowspan="1" colspan="1">Required</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Confidentiality</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">ECDH-ES + A256KW</td>
              <td class="text-left" rowspan="1" colspan="1">-31</td>
              <td class="text-left" rowspan="1" colspan="1">Recommended</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">Confidentiality</td>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">RSAES-OAEP w/ SHA-256</td>
              <td class="text-left" rowspan="1" colspan="1">-41</td>
              <td class="text-left" rowspan="1" colspan="1">Recommended</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-4.2-4">
The following are recommended key and recipient uses within COSE/BPSec:<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-4.2-5">
          <dt id="section-4.2-5.1">Symmetric Key Integrity:</dt>
          <dd style="margin-left: 1.5em" id="section-4.2-5.2">
When generating a BIB result from a symmetric key, implementations SHOULD use either a COSE_Mac0 or a COSE_Mac using the private key directly.
When a COSE_Mac is used with a direct key, the recipient layer SHALL include a key identifier.<a href="#section-4.2-5.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-4.2-5.3">EC Keypair Integrity:</dt>
          <dd style="margin-left: 1.5em" id="section-4.2-5.4">
When generating a BIB result from an EC keypair, implementations SHOULD use either a COSE_Sign1 or a COSE_Sign using the private key directly.
When a COSE_Sign is used with an EC keypair, the recipient layer SHALL include a public key identifier (see <a href="#sec-asym-keys" class="xref">Section 4.3</a>).<a href="#section-4.2-5.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-4.2-5.5">RSA Keypair Integrity:</dt>
          <dd style="margin-left: 1.5em" id="section-4.2-5.6">
When generating a BIB result from an RSA keypair, implementations SHOULD use either a COSE_Sign1 or a COSE_Sign using the private key directly.
When a COSE_Sign is used with an RSA keypair, the recipient layer SHALL include a public key identifier (see <a href="#sec-asym-keys" class="xref">Section 4.3</a>).
When a COSE_Sign or COSE_Sign1 is used with an RSA keypair, the signature uses a PSS salt in accordance with <span><a href="https://rfc-editor.org/rfc/rfc8230#section-2" class="relref">Section 2</a> of [<a href="#RFC8230" class="xref">RFC8230</a>]</span>.<a href="#section-4.2-5.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-4.2-5.7">Symmetric Key Confidentiality:</dt>
          <dd style="margin-left: 1.5em" id="section-4.2-5.8">
When generating a BCB result from an symmetric key, implementations SHOULD use a COSE_Encrypt message with a recipient containing a key-wrapped CEK.
When generating a BCB result from a symmetric key, implementations SHOULD NOT use COSE_Encrypt0 or COSE_Encrypt with direct content encryption key (CEK).
Doing so risks key overuse and the vulnerabilities associated with large amount of ciphertext from the same key.
When a COSE_Encrypt is used with an overall key-encryption key (KEK), the recipient layer SHALL include a key identifier for the KEK.<a href="#section-4.2-5.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-4.2-5.9">EC Keypair Confidentiality:</dt>
          <dd style="margin-left: 1.5em" id="section-4.2-5.10">
When generating a BCB result from an EC keypair, implementations SHOULD use a COSE_Encrypt message with a recipient containing a key-wrapped CEK.
When a COSE_Encrypt is used with an EC keypair, the recipient layer SHALL include a public key identifier (see <a href="#sec-asym-keys" class="xref">Section 4.3</a>).
When a COSE_Encrypt is used with an EC keypair, the security source SHALL generate an ephemeral EC keypair for each security operation.
When processing a COSE_Encrypt with an EC keypair, the security acceptor SHALL process all KDF and HMAC context data from the recipient headers in accordance with <span><a href="https://rfc-editor.org/rfc/rfc8152#section-11.2" class="relref">Section 11.2</a> of [<a href="#RFC8152" class="xref">RFC8152</a>]</span> even though the source is not required to provide any of those parameters.<a href="#section-4.2-5.10" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-4.2-5.11">RSA Keypair Confidentiality:</dt>
          <dd style="margin-left: 1.5em" id="section-4.2-5.12">
When generating a BCB result from an RSA keypair, implementations SHOULD use a COSE_Encrypt message with a recipient containing a key-wrapped CEK.
When a COSE_Encrypt is used with an RSA keypair, the recipient layer SHALL include a public key identifier (see <a href="#sec-asym-keys" class="xref">Section 4.3</a>).<a href="#section-4.2-5.12" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-asym-keys">
<section id="section-4.3">
        <h3 id="name-asymmetric-key-types-and-id">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-asymmetric-key-types-and-id" class="section-name selfRef">Asymmetric Key Types and Identifiers</a>
        </h3>
<p id="section-4.3-1">
This section applies when a BIB uses a public key for verification, or when a BCB uses a public key for encryption.
When using asymmetric keyed algorithms, the security source SHALL include a public key identifier as a recipient header.
The public key identifier SHALL be either a "kid" <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>, an "x5t" <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span>, or an equivalent identifier.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">
When a BIB result contains a "kid" identifier, the security source SHOULD include an appropriate COSE public key in the security parameters.
When BIB result contains a "x5t" identifier, the security source SHOULD include an appropriate PKIX certificate chain in the security parameters.
For a BIB, if all potential security acceptors are known to possess related public key and/or certificate data then the public key parameters can be omitted.
Risks of not including related data are described in <a href="#sec-threat-unident-key" class="xref">Section 7.5</a> and <a href="#sec-threat-notrust-key" class="xref">Section 7.6</a>.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">
When present, public keys and certificates SHOULD be included as ASB parameters rather than within ASB results.
This provides size efficiency when multiple security results are present because they will all be from the same security source and likely share the same public key material.
Security acceptors SHALL still process public keys or certificates present in a result as applying to that individual result.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">
Security acceptors SHALL aggregate all public keys from all parameters within a single BIB or BCB, independent of encoded type or order of parameters.
Because each context contains a single set of security parameters which apply to all results in the same context, security acceptors SHALL treat all public keys as being related to the security source itself and potentially applying to every result.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<div id="sec-pkix-certs">
<section id="section-4.3.1">
          <h4 id="name-pkix-certificates">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-pkix-certificates" class="section-name selfRef">PKIX Certificates</a>
          </h4>
<p id="section-4.3.1-1">
When PKIX certificates are present as parameters, security sources SHOULD include the entire certification chain to the root CA.
When PKIX certificates are used by security acceptors and the end-entity certificate is not explicitly trusted (i.e. pinned), the security acceptor SHALL perform the certification path validation of <span>[<a href="#RFC5280" class="xref">RFC5280</a>]</span> up to one or more trusted CA certificates.
Leaving out part of the certification chain can cause the security acceptor to fail to validate a BIB if the left-out certificates are unknown to the acceptor (see <a href="#sec-threat-notrust-key" class="xref">Section 7.6</a>).<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<p id="section-4.3.1-2">
The end entity certificate associated with a BPSec security source SHALL adhere to the profile of <a href="#sec-pkix-profile" class="xref">Section 5</a>.<a href="#section-4.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sec-pkix-profile">
<section id="section-5">
      <h2 id="name-pkix-certificate-profile">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-pkix-certificate-profile" class="section-name selfRef">PKIX Certificate Profile</a>
      </h2>
<p id="section-5-1">
All end-entity certificates used for BPSec SHALL conform to <span>[<a href="#RFC5280" class="xref">RFC5280</a>]</span>, or any updates or successors to that profile.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">
This profile requires Version 3 certificates due to the extensions used by this profile.
Security acceptors SHALL reject as invalid Version 1 and Version 2 end-entity certificates.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">
Security acceptors SHALL accept certificates that contain an empty Subject field or contain a Subject without a Common Name.
Identity information in end-entity certificates is contained entirely in the subjectAltName extension as a NODE-ID, as defined in <span>[<a href="#I-D.ietf-dtn-tcpclv4" class="xref">I-D.ietf-dtn-tcpclv4</a>]</span>.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">
All end-entity and CA certificates used for BPSec SHOULD contain both a Subject Key Identifier and an Authority Key Identifier extension in accordance with <span>[<a href="#RFC5280" class="xref">RFC5280</a>]</span>.
Security acceptors SHOULD NOT rely on either a Subject Key Identifier and an Authority Key Identifier being present in any received certificate.
Including key identifiers simplifies the work of an entity needing to assemble a certification chain.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">
A BPSec end-entity certificate SHALL contain a NODE-ID which authenticates the Node ID of the security source.
The identifier type NODE-ID is defined in <span>[<a href="#I-D.ietf-dtn-tcpclv4" class="xref">I-D.ietf-dtn-tcpclv4</a>]</span>.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">
When allowed by CA policy, a BPSec end-entity certificate SHOULD contain a PKIX Extended Key Usage extension in accordance with <span><a href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.12" class="relref">Section 4.2.1.12</a> of [<a href="#RFC5280" class="xref">RFC5280</a>]</span>.
When the PKIX Extended Key Usage extension is present, it SHALL contain a key purpose "id-kp-bundleSecurity" as defined in <span>[<a href="#I-D.ietf-dtn-tcpclv4" class="xref">I-D.ietf-dtn-tcpclv4</a>]</span>.
The "id-kp-bundleSecurity" purpose MAY be combined with other purposes in the same certificate.<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">
When allowed by CA policy, a BPSec end-entity certificate SHALL contain a PKIX Key Usage extension in accordance with <span><a href="https://rfc-editor.org/rfc/rfc5280#section-4.2.1.3" class="relref">Section 4.2.1.3</a> of [<a href="#RFC5280" class="xref">RFC5280</a>]</span>.
The PKIX Key Usage bits which are consistent with COSE security are: digitalSignature, nonRepudiation, keyEncipherment, and keyAgreement.
The specific algorithms used by COSE messages in security results determine which of those key uses are exercised.
See <a href="#sec-pkix-multiple-certs" class="xref">Section 5.1</a> for discussion of key use policies across multiple certificates.<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">
A BPSec end-entity certificate MAY contain an Online Certificate Status Protocol (OCSP) URI within an Authority Information Access extension in accordance with <span><a href="https://rfc-editor.org/rfc/rfc5280#section-4.2.2.1" class="relref">Section 4.2.2.1</a> of [<a href="#RFC5280" class="xref">RFC5280</a>]</span>.
Security acceptors are not expected to have continuous internet connectivity sufficient to perform OCSP verification.<a href="#section-5-8" class="pilcrow">¶</a></p>
<div id="sec-pkix-multiple-certs">
<section id="section-5.1">
        <h3 id="name-multiple-certificate-uses">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-multiple-certificate-uses" class="section-name selfRef">Multiple-Certificate Uses</a>
        </h3>
<p id="section-5.1-1">
A RECOMMENDED security policy is to limit asymmetric keys (and thus public key certificates) to single uses among the following:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.1-2">
          <dt id="section-5.1-2.1">Bundle transport:</dt>
          <dd style="margin-left: 1.5em" id="section-5.1-2.2">With key uses as defined in the convergence layer specification(s).<a href="#section-5.1-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.3">Block signing:</dt>
          <dd style="margin-left: 1.5em" id="section-5.1-2.4">With key use digitalSignature and/or nonRepudiation<a href="#section-5.1-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.5">Block encryption:</dt>
          <dd style="margin-left: 1.5em" id="section-5.1-2.6">With key use keyEncipherment and/or keyAgreement<a href="#section-5.1-2.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.1-3">
This policy is the same one recommended by <span><a href="https://rfc-editor.org/rfc/rfc8551#section-6" class="relref">Section 6</a> of [<a href="#RFC8551" class="xref">RFC8551</a>]</span> for email security and by Section 5.2 of <span>[<a href="#NIST-SP800-57" class="xref">NIST-SP800-57</a>]</span> more generally.
Effectively this means that a BP node uses separate certificates for transport (e.g., as a TCPCL entity), BIB signing (as a security source), and BCB encryption (as a security acceptor).<a href="#section-5.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-6">
      <h2 id="name-implementation-status">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-implementation-status" class="section-name selfRef">Implementation Status</a>
      </h2>
<p id="section-6-1">
[NOTE to the RFC Editor: please remove this section before publication, as well as the reference to <span>[<a href="#RFC7942" class="xref">RFC7942</a>]</span> and <span>[<a href="#github-dtn-bpsec-cose" class="xref">github-dtn-bpsec-cose</a>]</span>.]<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">
This section records the status of known implementations of the
protocol defined by this specification at the time of posting of
this Internet-Draft, and is based on a proposal described in
<span>[<a href="#RFC7942" class="xref">RFC7942</a>]</span>.
The description of implementations in this section is
intended to assist the IETF in its decision processes in progressing
drafts to RFCs. Please note that the listing of any individual
implementation here does not imply endorsement by the IETF.
Furthermore, no effort has been spent to verify the information
presented here that was supplied by IETF contributors. This is not
intended as, and must not be construed to be, a catalog of available
implementations or their features. Readers are advised to note that
other implementations can exist.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">
An example implementation of COSE over Blocks has been created as a GitHub project <span>[<a href="#github-dtn-bpsec-cose" class="xref">github-dtn-bpsec-cose</a>]</span> and is intended to use as a proof-of-concept and as a possible source of interoperability testing.
This example implementation only handles CBOR encoding/decoding and cryptographic functions, it does not construct actual BIB or BCB and does not integrate with a BP Agent.<a href="#section-6-3" class="pilcrow">¶</a></p>
</section>
<div id="sec-security">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">
This section separates security considerations into threat categories based on guidance of BCP 72 <span>[<a href="#RFC3552" class="xref">RFC3552</a>]</span>.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">
All of the security considerations of the underlying BPSec <span>[<a href="#I-D.ietf-dtn-bpsec" class="xref">I-D.ietf-dtn-bpsec</a>]</span> apply to these new security contexts.<a href="#section-7-2" class="pilcrow">¶</a></p>
<section id="section-7.1">
        <h3 id="name-threat-bpsec-block-replay">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-threat-bpsec-block-replay" class="section-name selfRef">Threat: BPSec Block Replay</a>
        </h3>
<p id="section-7.1-1">
The bundle's primary block contains fields which uniquely identify a bundle: the Source Node ID, Creation Timestamp, and fragment parameters (see <span><a href="https://tools.ietf.org/html/draft-ietf-dtn-bpbis-30#section-4.2.2" class="relref">Section 4.2.2</a> of [<a href="#I-D.ietf-dtn-bpbis" class="xref">I-D.ietf-dtn-bpbis</a>]</span>).
These same fields are used to correlate Administrative Records with the bundles for which the records were generated.
Including the primary block in the AAD for BPSec integrity and confidentiality binds the verification of the secured block to its parent bundle and disallows replay of any block with its BIB or BCB.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">
This profile of COSE limits the encryption algorithms to only AEAD in order to include the context of the encrypted data as AAD.
If an agent mistakenly allows the use of non-AEAD encryption when decrypting and verifying a BCB, the possibility of block replay attack is present.<a href="#section-7.1-2" class="pilcrow">¶</a></p>
</section>
<div id="sec-threat-untrust-cert">
<section id="section-7.2">
        <h3 id="name-threat-untrusted-end-entity">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-threat-untrusted-end-entity" class="section-name selfRef">Threat: Untrusted End-Entity Certificate</a>
        </h3>
<p id="section-7.2-1">
The profile in <a href="#sec-context-auth" class="xref">Section 3.6.1</a> uses end-entity certificates chained up to a trusted root CA.
A security source can include a certificate set which does not contain the full chain, possibly excluding intermediate or root CAs.
In an environment where security acceptors are known to already contain needed root and intermediate CAs there is no need to include those CAs, but this has a risk of an acceptor not actually having one of the needed CAs.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-7.3">
        <h3 id="name-threat-certificate-validati">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-threat-certificate-validati" class="section-name selfRef">Threat: Certificate Validation Vulnerabilities</a>
        </h3>
<p id="section-7.3-1">
Even when a security acceptor is operating properly an attacker can attempt to exploit vulnerabilities within certificate check algorithms or configuration to authenticate using an invalid certificate.
An invalid certificate exploit could lead to higher-level security issues and/or denial of service to the Node ID being impersonated.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">
There are many reasons, described in <span>[<a href="#RFC5280" class="xref">RFC5280</a>]</span> and <span>[<a href="#RFC6125" class="xref">RFC6125</a>]</span>, why a certificate can fail to validate, including using the certificate outside of its valid time interval, using purposes for which it was not authorized, or using it after it has been revoked by its CA.
Validating a certificate is a complex task and can require network connectivity outside of the primary BP convergence layer network path(s) if a mechanism such as OCSP <span>[<a href="#RFC6960" class="xref">RFC6960</a>]</span> is used by the CA.
The configuration and use of particular certificate validation methods are outside of the scope of this document.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
</section>
<div id="sec-threat-node-impersonation">
<section id="section-7.4">
        <h3 id="name-threat-bp-node-impersonatio">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-threat-bp-node-impersonatio" class="section-name selfRef">Threat: BP Node Impersonation</a>
        </h3>
<p id="section-7.4-1">
When certificates are referenced by BIB results it is possible that the certificate does not contain a NODE-ID or does contain one but has a mismatch with the actual security source (see <a href="#sec-pkix-env" class="xref">Section 1.2</a>).
Having a CA-validated certificate does not alone guarantee the identity of the security source from which the certificate is provided; additional validation procedures in <a href="#sec-pkix-certs" class="xref">Section 4.3.1</a> bind the Node ID based on the contents of the certificate.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-threat-unident-key">
<section id="section-7.5">
        <h3 id="name-threat-unidentifiable-key">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-threat-unidentifiable-key" class="section-name selfRef">Threat: Unidentifiable Key</a>
        </h3>
<p id="section-7.5-1">
The profile in <a href="#sec-interop-alg" class="xref">Section 4.2</a> recommends key identifiers when possible and the parameters in section <a href="#sec-ASB-parameters" class="xref">Section 3.2</a> allow encoding public keys where available.
If the application using a COSE Integrity or COSE Confidentiality context leaves out key identification data (in a COSE recipient structure), the security acceptor for those BPSec blocks only has the primary block available to use when verifying or decrypting the target block.
This leads to a situation, identified in BPSec Security Considerations, where a signature is verified to be valid but not from the expected Security Source.<a href="#section-7.5-1" class="pilcrow">¶</a></p>
<p id="section-7.5-2">
Because the key identifier headers are unprotected (see <a href="#sec-asym-keys" class="xref">Section 4.3</a>), there is still the possibility that an active attacker removes or alters key identifier(s) in the result.
This can cause the security acceptor to not be able to properly verify a valid signature or not use the correct private key to decrypt valid ciphertext.<a href="#section-7.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-threat-notrust-key">
<section id="section-7.6">
        <h3 id="name-threat-non-trusted-public-k">
<a href="#section-7.6" class="section-number selfRef">7.6. </a><a href="#name-threat-non-trusted-public-k" class="section-name selfRef">Threat: Non-Trusted Public Key</a>
        </h3>
<p id="section-7.6-1">
The profile in <a href="#sec-interop-alg" class="xref">Section 4.2</a> allows the use of PKIX which typically involves end-entity certificates chained up to a trusted root CA.
This allows a BIB to contain end-entity certificates not previously known to a security acceptor but still trust the certificate by verifying it up to a trusted CA.
In an environment where security acceptors are known to already contain needed root and intermediate CAs there is no need to include those CAs in a proper chain within the security parameters, but this has a risk of an acceptor not actually having one of the needed CAs.<a href="#section-7.6-1" class="pilcrow">¶</a></p>
<p id="section-7.6-2">
Because the security parameters are not included as AAD, there is still the possibility that an active attacker removes or alters certification chain data in the parameters.
This can cause the security acceptor to be able to verify a valid signature but not trust the public key used to perform the verification.<a href="#section-7.6-2" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-7.7">
        <h3 id="name-threat-passive-leak-of-key-">
<a href="#section-7.7" class="section-number selfRef">7.7. </a><a href="#name-threat-passive-leak-of-key-" class="section-name selfRef">Threat: Passive Leak of Key Material</a>
        </h3>
<p id="section-7.7-1">
It is important that the key requirements of <a href="#sec-ASB-parameters" class="xref">Section 3.2</a> apply only to public keys and PKIX certificates.
Including non-public key material in ASB parameters will expose that material in the bundle data and over the bundle convergence layer during transport.<a href="#section-7.7-1" class="pilcrow">¶</a></p>
</section>
<section id="section-7.8">
        <h3 id="name-threat-algorithm-vulnerabil">
<a href="#section-7.8" class="section-number selfRef">7.8. </a><a href="#name-threat-algorithm-vulnerabil" class="section-name selfRef">Threat: Algorithm Vulnerabilities</a>
        </h3>
<p id="section-7.8-1">
Because this use of COSE leaves the specific algorithms chosen for BIB and BCB use up to the applications securing bundle data, it is important to use only COSE algorithms which are marked as recommended in the IANA registry <span>[<a href="#IANA-COSE" class="xref">IANA-COSE</a>]</span>.<a href="#section-7.8-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="sec-iana">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">
Registration procedures referred to in this section are defined in <span>[<a href="#RFC8126" class="xref">RFC8126</a>]</span>.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="sec-iana-bpsec-ctx">
<section id="section-8.1">
        <h3 id="name-bpsec-security-contexts">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-bpsec-security-contexts" class="section-name selfRef">BPSec Security Contexts</a>
        </h3>
<p id="section-8.1-1">
Within the "Bundle Protocol" registry <span>[<a href="#IANA-BUNDLE" class="xref">IANA-BUNDLE</a>]</span>, the following entry has been added to the "BPSec Security Context Identifiers" sub-registry.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<table class="center" id="table-6">
          <caption><a href="#table-6" class="selfRef">Table 6</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">TBD-COSE</td>
              <td class="text-left" rowspan="1" colspan="1">COSE</td>
              <td class="text-left" rowspan="1" colspan="1">This specification.</td>
            </tr>
          </tbody>
        </table>
</section>
</div>
</section>
</div>
<div id="sec-doc-ack">
<section id="section-9">
      <h2 id="name-acknowledgments">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-9-1">
The interoperability minimum algorithms and parameters are based on the draft <span>[<a href="#I-D.ietf-dtn-bpsec-interop-sc" class="xref">I-D.ietf-dtn-bpsec-interop-sc</a>]</span>.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="IANA-BUNDLE">[IANA-BUNDLE]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Bundle Protocol"</span>, <span>&lt;<a href="https://www.iana.org/assignments/bundle/">https://www.iana.org/assignments/bundle/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IANA-COSE">[IANA-COSE]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE)"</span>, <span>&lt;<a href="https://www.iana.org/assignments/cose/">https://www.iana.org/assignments/cose/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5280">[RFC5280]</dt>
        <dd>
<span class="refAuthor">Cooper, D.</span><span class="refAuthor">, Santesson, S.</span><span class="refAuthor">, Farrell, S.</span><span class="refAuthor">, Boeyen, S.</span><span class="refAuthor">, Housley, R.</span><span class="refAuthor">, and W. Polk</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"</span>, <span class="seriesInfo">RFC 5280</span>, <span class="seriesInfo">DOI 10.17487/RFC5280</span>, <time datetime="2008-05" class="refDate">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5280">https://www.rfc-editor.org/info/rfc5280</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6125">[RFC6125]</dt>
        <dd>
<span class="refAuthor">Saint-Andre, P.</span><span class="refAuthor"> and J. Hodges</span>, <span class="refTitle">"Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)"</span>, <span class="seriesInfo">RFC 6125</span>, <span class="seriesInfo">DOI 10.17487/RFC6125</span>, <time datetime="2011-03" class="refDate">March 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6125">https://www.rfc-editor.org/info/rfc6125</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6960">[RFC6960]</dt>
        <dd>
<span class="refAuthor">Santesson, S.</span><span class="refAuthor">, Myers, M.</span><span class="refAuthor">, Ankney, R.</span><span class="refAuthor">, Malpani, A.</span><span class="refAuthor">, Galperin, S.</span><span class="refAuthor">, and C. Adams</span>, <span class="refTitle">"X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP"</span>, <span class="seriesInfo">RFC 6960</span>, <span class="seriesInfo">DOI 10.17487/RFC6960</span>, <time datetime="2013-06" class="refDate">June 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6960">https://www.rfc-editor.org/info/rfc6960</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8126">[RFC8126]</dt>
        <dd>
<span class="refAuthor">Cotton, M.</span><span class="refAuthor">, Leiba, B.</span><span class="refAuthor">, and T. Narten</span>, <span class="refTitle">"Guidelines for Writing an IANA Considerations Section in RFCs"</span>, <span class="seriesInfo">BCP 26</span>, <span class="seriesInfo">RFC 8126</span>, <span class="seriesInfo">DOI 10.17487/RFC8126</span>, <time datetime="2017-06" class="refDate">June 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8126">https://www.rfc-editor.org/info/rfc8126</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8152">[RFC8152]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE)"</span>, <span class="seriesInfo">RFC 8152</span>, <span class="seriesInfo">DOI 10.17487/RFC8152</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8152">https://www.rfc-editor.org/info/rfc8152</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8230">[RFC8230]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refTitle">"Using RSA Algorithms with CBOR Object Signing and Encryption (COSE) Messages"</span>, <span class="seriesInfo">RFC 8230</span>, <span class="seriesInfo">DOI 10.17487/RFC8230</span>, <time datetime="2017-09" class="refDate">September 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8230">https://www.rfc-editor.org/info/rfc8230</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8551">[RFC8551]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span><span class="refAuthor">, Ramsdell, B.</span><span class="refAuthor">, and S. Turner</span>, <span class="refTitle">"Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 4.0 Message Specification"</span>, <span class="seriesInfo">RFC 8551</span>, <span class="seriesInfo">DOI 10.17487/RFC8551</span>, <time datetime="2019-04" class="refDate">April 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8551">https://www.rfc-editor.org/info/rfc8551</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span><span class="refAuthor">, Vigano, C.</span><span class="refAuthor">, and C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8610">https://www.rfc-editor.org/info/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-dtn-bpsec">[I-D.ietf-dtn-bpsec]</dt>
        <dd>
<span class="refAuthor">Birrane, E.</span><span class="refAuthor"> and K. McKeever</span>, <span class="refTitle">"Bundle Protocol Security Specification"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-dtn-bpsec-25</span>, <time datetime="2020-12-01" class="refDate">1 December 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-dtn-bpsec-25">https://tools.ietf.org/html/draft-ietf-dtn-bpsec-25</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-dtn-tcpclv4">[I-D.ietf-dtn-tcpclv4]</dt>
        <dd>
<span class="refAuthor">Sipos, B.</span><span class="refAuthor">, Demmer, M.</span><span class="refAuthor">, Ott, J.</span><span class="refAuthor">, and S. Perreault</span>, <span class="refTitle">"Delay-Tolerant Networking TCP Convergence Layer Protocol Version 4"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-dtn-tcpclv4-24</span>, <time datetime="2020-12-07" class="refDate">7 December 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-dtn-tcpclv4-24">https://tools.ietf.org/html/draft-ietf-dtn-tcpclv4-24</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-x509">[I-D.ietf-cose-x509]</dt>
      <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Header parameters for carrying and referencing X.509 certificates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-x509-08</span>, <time datetime="2020-12-14" class="refDate">14 December 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-cose-x509-08">https://tools.ietf.org/html/draft-ietf-cose-x509-08</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="NIST-SP800-57">[NIST-SP800-57]</dt>
        <dd>
<span class="refAuthor">National Institute of Standards and Technology</span>, <span class="refTitle">"Recommendation for Key Management - Part 1: General"</span>, <span class="refContent">NIST Special Publication 800-57 Revision 4, DOI 10.6028/NIST.SP.800-57pt1r5</span>, <time datetime="2020-05" class="refDate">May 2020</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57pt1r5.pdf">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-57pt1r5.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3552">[RFC3552]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span><span class="refAuthor"> and B. Korver</span>, <span class="refTitle">"Guidelines for Writing RFC Text on Security Considerations"</span>, <span class="seriesInfo">BCP 72</span>, <span class="seriesInfo">RFC 3552</span>, <span class="seriesInfo">DOI 10.17487/RFC3552</span>, <time datetime="2003-07" class="refDate">July 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3552">https://www.rfc-editor.org/info/rfc3552</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7942">[RFC7942]</dt>
        <dd>
<span class="refAuthor">Sheffer, Y.</span><span class="refAuthor"> and A. Farrel</span>, <span class="refTitle">"Improving Awareness of Running Code: The Implementation Status Section"</span>, <span class="seriesInfo">BCP 205</span>, <span class="seriesInfo">RFC 7942</span>, <span class="seriesInfo">DOI 10.17487/RFC7942</span>, <time datetime="2016-07" class="refDate">July 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7942">https://www.rfc-editor.org/info/rfc7942</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-dtn-bpbis">[I-D.ietf-dtn-bpbis]</dt>
        <dd>
<span class="refAuthor">Burleigh, S.</span><span class="refAuthor">, Fall, K.</span><span class="refAuthor">, and E. Birrane</span>, <span class="refTitle">"Bundle Protocol Version 7"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-dtn-bpbis-30</span>, <time datetime="2020-12-10" class="refDate">10 December 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-dtn-bpbis-30">https://tools.ietf.org/html/draft-ietf-dtn-bpbis-30</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-dtn-bpsec-interop-sc">[I-D.ietf-dtn-bpsec-interop-sc]</dt>
        <dd>
<span class="refAuthor">Birrane, E.</span>, <span class="refTitle">"BPSec Default Security Contexts"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-dtn-bpsec-interop-sc-02</span>, <time datetime="2020-11-01" class="refDate">1 November 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-dtn-bpsec-interop-sc-02">https://tools.ietf.org/html/draft-ietf-dtn-bpsec-interop-sc-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="github-dtn-bpsec-cose">[github-dtn-bpsec-cose]</dt>
      <dd>
<span class="refAuthor">Sipos, B.</span>, <span class="refTitle">"DTN Bundle Protocol Security COSE Security Contexts"</span>, <span>&lt;<a href="https://github.com/BSipos-RKF/dtn-bpsec-cose/">https://github.com/BSipos-RKF/dtn-bpsec-cose/</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="sec-examples">
<section id="section-appendix.a">
      <h2 id="name-examples">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
      </h2>
<p id="section-appendix.a-1">
These examples are intended to have the correct structure of COSE security blocks but in some cases use simplified algorithm parameters or smaller key sizes than are required by the actual COSE profile defined in this documents.
Each example indicates how it differs from the actual profile if there is a meaningful difference.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<p id="section-appendix.a-2">
All of these examples operate within the context of the bundle primary block of <a href="#fig-ex-primary-block" class="xref">Figure 5</a> with a security target block of <a href="#fig-ex-target-block" class="xref">Figure 6</a>.
All example figures use the extended diagnostic notation <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span>.<a href="#section-appendix.a-2" class="pilcrow">¶</a></p>
<span id="name-primary-block-cbor-diagnost"></span><div id="fig-ex-primary-block">
<figure id="figure-5">
        <div id="section-appendix.a-3.1">
<pre class="sourcecode lang-cbor">
[
  7, / BP version /
  0, / flags /
  0, / CRC type /
  [1, "//dst/svc"], / destination /
  [1, "//src/"], / source /
  [1, "//src/"], / report-to /
  [0, 40], / timestamp /
  1000000 / lifetime /
]
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-primary-block-cbor-diagnost" class="selfRef">Primary block CBOR diagnostic</a>
        </figcaption></figure>
</div>
<span id="name-target-block-cbor-diagnosti"></span><div id="fig-ex-target-block">
<figure id="figure-6">
        <div id="section-appendix.a-4.1">
<pre class="sourcecode lang-cbor">
[
  7, / type code - bundle age /
  2, / block num /
  0, / flags /
  0, / CRC type /
  &lt;&lt;300&gt;&gt; / type-specific-data: age /
]
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-target-block-cbor-diagnosti" class="selfRef">Target block CBOR diagnostic</a>
        </figcaption></figure>
</div>
<p id="section-appendix.a-5">
All of the examples also operate within a security block containing the AAD Scope parameter with only "has-primary-ctx" and "has-target-ctx" flags set.
This results in a consistent AAD-value as shown in <a href="#fig-ex-AAD-value" class="xref">Figure 7</a>, which is used as the bytestring for COSE external_aad in all of the examples.
Note that the AAD-value is itself a bytestring which happens to contain encoded CBOR.<a href="#section-appendix.a-5" class="pilcrow">¶</a></p>
<span id="name-example-scope-aad-value-cbo"></span><div id="fig-ex-AAD-value">
<figure id="figure-7">
        <div id="section-appendix.a-6.1">
<pre class="sourcecode lang-cbor">
&lt;&lt;[
  [ 7, 0, 0, [ 1, "//dst/svc" ], [ 1, "//src/" ], [ 1, "//src/" ],
    [ 0, 40 ], 1000000 ], / primary-ctx /
  [ 7, 2, 0 ], / target-ctx /
  null / security-ctx /
]&gt;&gt;
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-example-scope-aad-value-cbo" class="selfRef">Example scope AAD-value CBOR diagnostic</a>
        </figcaption></figure>
</div>
<p id="section-appendix.a-7">
The only differences between these examples which use EC or RSA keypairs and a use of a PKIX public key certificate are: the parameters would have an x5chain parameter instead of a COSE_Key type, and the recipient would contain an "x5t" value instead of a "kid" value.
Neither of these is a change to a protected header so, given the same private key, there would be no change to the signature or wrapped-key data.<a href="#section-appendix.a-7" class="pilcrow">¶</a></p>
<section id="section-a.1">
        <h2 id="name-symmetric-key-cose_mac0">
<a href="#section-a.1" class="section-number selfRef">A.1. </a><a href="#name-symmetric-key-cose_mac0" class="section-name selfRef">Symmetric Key COSE_Mac0</a>
        </h2>
<p id="section-a.1-1">
This is an example of a MAC with recipient having a 256-bit symmetric key identified by a "kid".<a href="#section-a.1-1" class="pilcrow">¶</a></p>
<span id="name-symmetric-key"></span><figure id="figure-8">
          <div id="section-a.1-2.1">
<pre class="sourcecode lang-cbor">
[
  {
    / kty / 1: 4, / symmetric /
    / kid / 2: 'ExampleMAC',
    / k / -1: h'13bf9cead057c0aca2c9e52471ca4b19ddfaf4c0784e3f3e8e39
99dbae4ce45c'
  }
]
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-symmetric-key" class="selfRef">Symmetric Key</a>
          </figcaption></figure>
<p id="section-a.1-3">
The external_aad is the encoded data from <a href="#fig-ex-AAD-value" class="xref">Figure 7</a>.
The payload is the encoded target block-type-specific data from <a href="#fig-ex-target-block" class="xref">Figure 6</a>.<a href="#section-a.1-3" class="pilcrow">¶</a></p>
<span id="name-mac_structure-cbor-diagnost"></span><div id="fig-ex-mac-struct">
<figure id="figure-9">
          <div id="section-a.1-4.1">
<pre class="sourcecode lang-cbor">
[
  "MAC0", / context /
  h'a10105', / protected /
  h'83880700008201692f2f6473742f7376638201662f2f7372632f8201662f2f73
72632f820018281a000f424083070200f6', / external_aad /
  h'19012c' / payload /
]
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-mac_structure-cbor-diagnost" class="selfRef">MAC_structure CBOR diagnostic</a>
          </figcaption></figure>
</div>
<span id="name-abstract-security-block-cbo"></span><div id="fig-ex-mac-asb">
<figure id="figure-10">
          <div id="section-a.1-5.1">
<pre class="sourcecode lang-cbor">
[
  [2], / targets /
  0, / security context TBD /
  1, / flags: params-present /
  [ / parameters /
    [
      5, / AAD-scope /
      0x03 / has-primary-ctx | has-target-ctx /
    ]
  ],
  [
    [ / target block #2 /
      [ / result /
        17, / COSE_Mac0 tag /
        [
          &lt;&lt;{ / protected /
             / alg / 1:5 / HMAC 256//256 /
          }&gt;&gt;,
          { / unprotected /
            / kid / 4:'ExampleMAC'
          },
          null, / payload /
          h'190264a1e6a9734990e552660df3c4641efb88fd6439aba866577c7b
6d174b87' / tag /
        ]
      ]
    ]
  ]
]
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-abstract-security-block-cbo" class="selfRef">Abstract Security Block CBOR diagnostic</a>
          </figcaption></figure>
</div>
</section>
<section id="section-a.2">
        <h2 id="name-ec-keypair-cose_sign1">
<a href="#section-a.2" class="section-number selfRef">A.2. </a><a href="#name-ec-keypair-cose_sign1" class="section-name selfRef">EC Keypair COSE_Sign1</a>
        </h2>
<p id="section-a.2-1">
This is an example of a signature with a recipient having a P-256 curve EC keypair identified by a "kid".
The associated public key is included as a security parameter.<a href="#section-a.2-1" class="pilcrow">¶</a></p>
<span id="name-example-keys"></span><figure id="figure-11">
          <div id="section-a.2-2.1">
<pre class="sourcecode lang-cbor">
[
  { / signing private key /
    / kty / 1: 2, / EC2 /
    / kid / 2: 'ExampleEC2',
    / crv / -1: 1, / P-256 /
    / x / -2: h'44c1fa63b84f172b50541339c50beb0e630241ecb4eebbddb8b5
e4fe0a1787a8',
    / y / -3: h'059451c7630d95d0b550acbd02e979b3f4f74e645b74715fafbc
1639960a0c7a',
    / d / -4: h'dd6e7d8c4c0e0c0bd3ae1b4a2fa86b9a09b7efee4a233772cf51
89786ea63842'
  }
]
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-example-keys" class="selfRef">Example Keys</a>
          </figcaption></figure>
<p id="section-a.2-3">
The external_aad is the encoded data from <a href="#fig-ex-AAD-value" class="xref">Figure 7</a>.
The payload is the encoded target block-type-specific data from <a href="#fig-ex-target-block" class="xref">Figure 6</a>.<a href="#section-a.2-3" class="pilcrow">¶</a></p>
<span id="name-sig_structure-cbor-diagnost"></span><div id="fig-ex-sign-ec2-struct">
<figure id="figure-12">
          <div id="section-a.2-4.1">
<pre class="sourcecode lang-cbor">
[
  "Signature1", / context /
  h'a10126', / protected /
  h'83880700008201692f2f6473742f7376638201662f2f7372632f8201662f2f73
72632f820018281a000f424083070200f6', / external_aad /
  h'19012c' / payload /
]
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-sig_structure-cbor-diagnost" class="selfRef">Sig_structure CBOR diagnostic</a>
          </figcaption></figure>
</div>
<span id="name-abstract-security-block-cbor"></span><div id="fig-ex-sign-ec2-asb">
<figure id="figure-13">
          <div id="section-a.2-5.1">
<pre class="sourcecode lang-cbor">
[
  [2], / targets /
  0, / security context TBD /
  1, / flags: params-present /
  [ / parameters /
    [
      1, / COSE key /
      { / public key /
        / kty / 1: 2, / EC2 /
        / kid / 2: 'ExampleEC2',
        / crv / -1: 1, / P-256 /
        / x / -2: h'44c1fa63b84f172b50541339c50beb0e630241ecb4eebbdd
b8b5e4fe0a1787a8',
        / y / -3: h'059451c7630d95d0b550acbd02e979b3f4f74e645b74715f
afbc1639960a0c7a'
      }
    ],
    [
      5, / AAD-scope /
      0x03 / has-primary-ctx | has-target-ctx /
    ]
  ],
  [
    [ / target block #2 /
      [ / result /
        18, / COSE_Sign1 tag /
        [
          &lt;&lt;{ / protected /
             / alg / 1:-7 / ES256 /
          }&gt;&gt;,
          { / unprotected /
            / kid / 4:'ExampleEC2'
          },
          null, / payload /
          h'eb085c162bac4ec45c974766b897ee227b189fa257a8fb195c830f04
f6d6a90318b3e915938e4d32c1baace8aa0bf983f52efcbf1b127b296e72673f3d73
3023' / signature /
        ]
      ]
    ]
  ]
]
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-abstract-security-block-cbor" class="selfRef">Abstract Security Block CBOR diagnostic</a>
          </figcaption></figure>
</div>
</section>
<section id="section-a.3">
        <h2 id="name-rsa-keypair-cose_sign1">
<a href="#section-a.3" class="section-number selfRef">A.3. </a><a href="#name-rsa-keypair-cose_sign1" class="section-name selfRef">RSA Keypair COSE_Sign1</a>
        </h2>
<p id="section-a.3-1">
This is an example of a signature with a recipient having a 1024-bit RSA keypair identified by a "kid".
The associated public key is included as a security parameter.<a href="#section-a.3-1" class="pilcrow">¶</a></p>
<p id="section-a.3-2">
This key strength is not supposed to be a secure configuration, only intended to explain the procedure.
This signature uses a random salt, so the full signature output is not deterministic.<a href="#section-a.3-2" class="pilcrow">¶</a></p>
<span id="name-example-keys-2"></span><figure id="figure-14">
          <div id="section-a.3-3.1">
<pre class="sourcecode lang-cbor">
[
  { / signing private key /
    / kty / 1: 3, / RSA /
    / kid / 2: 'ExampleRSA',
    / n / -1: h'b0b5fd85f52c91844007443c9f9371980025f76d51fc9c676812
31da610cb291ba637ce813bffdb2e9c653258607389ec97dad3db295fded67744ed6
20707db36804e74e56a494030a73608fc8d92f2f0578d2d85cc201ef0ff22d7835d2
d147d3b90a6884276235a01c2be99dfc597f79554362fc1eb03639cac5ccaddb29
25',
    / e / -2: h'010001',
    / d / -3: h'9b5d26ad6445ef1aab80b809e4f329684e9912d556c4166f041d
1b1fb93c04b4037ffd0dbe6f8a8a86e70bab6e0f6344983a9ada27ed9ff7de816fde
eb5e7be48e607ce5fda4581ca6338a9e019fb3689b28934192b6a190cdda910abb5a
86a2f7b6f9cd5011049d8de52ddfef73aa06df401c55623ec196720f54920deb4f
01',
    / p / -4: h'db22d94e7784a27b568cbf985307ea8d6430ff6b88c18a7086fd
4f57a326572f2250c39e48a6f8e2201661c2dfe12c7386835b649714d050aa36123e
c3d00e75',
    / q / -5: h'ce7016adc5f326b7520397c5978ee2f50e69279983d54c5d76f0
5bcd61de0879d7056c923540dff9cbae95dcc0e5e86b52b3c902dc9669c8021c6955
7effb9f1',
    / dP / -6: h'6a6fcaccea106a3b2e16bf18e57b7ad9a2488a4758ed68a8af6
86a194f0d585b7477760c738d6665aee0302bcf4237ad0530d83b4b86b887f5a4bdc
7eea427e1',
    / dQ / -7: h'28a4cae245b1dcb285142e027a1768b9c4af915b59285a93a04
22c60e05edd9e57663afd023d169bd0ad3bd62da8563d231840802ebbf271ad70b89
05ba3af91',
    / qInv / -8: h'07b5a61733896270a6bd2bb1654194c54e2bc0e061b543a4e
d9fa73c4bc79c87148aa92a451c4ab8262b6377a9c7b97f869160ca6f5d853ee4b65
f4f92865ca3'
  }
]
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a>:
<a href="#name-example-keys-2" class="selfRef">Example Keys</a>
          </figcaption></figure>
<p id="section-a.3-4">
The external_aad is the encoded data from <a href="#fig-ex-AAD-value" class="xref">Figure 7</a>.
The payload is the encoded target block-type-specific data from <a href="#fig-ex-target-block" class="xref">Figure 6</a>.<a href="#section-a.3-4" class="pilcrow">¶</a></p>
<span id="name-sig_structure-cbor-diagnosti"></span><div id="fig-ex-sign-rsa-struct">
<figure id="figure-15">
          <div id="section-a.3-5.1">
<pre class="sourcecode lang-cbor">
[
  "Signature1", / context /
  h'a1013824', / protected /
  h'83880700008201692f2f6473742f7376638201662f2f7372632f8201662f2f73
72632f820018281a000f424083070200f6', / external_aad /
  h'19012c' / payload /
]
</pre>
</div>
<figcaption><a href="#figure-15" class="selfRef">Figure 15</a>:
<a href="#name-sig_structure-cbor-diagnosti" class="selfRef">Sig_structure CBOR diagnostic</a>
          </figcaption></figure>
</div>
<span id="name-abstract-security-block-cbor-"></span><div id="fig-ex-sign-rsa-asb">
<figure id="figure-16">
          <div id="section-a.3-6.1">
<pre class="sourcecode lang-cbor">
[
  [2], / targets /
  0, / security context TBD /
  1, / flags: params-present /
  [ / parameters /
    [
      1, / COSE key /
      { / public key /
        / kty / 1: 3, / RSA /
        / kid / 2: 'ExampleRSA',
        / n / -1: h'b0b5fd85f52c91844007443c9f9371980025f76d51fc9c67
681231da610cb291ba637ce813bffdb2e9c653258607389ec97dad3db295fded6774
4ed620707db36804e74e56a494030a73608fc8d92f2f0578d2d85cc201ef0ff22d78
35d2d147d3b90a6884276235a01c2be99dfc597f79554362fc1eb03639cac5ccaddb
2925',
        / e / -2: h'010001'
      }
    ],
    [
      5, / AAD-scope /
      0x03 / has-primary-ctx | has-target-ctx /
    ]
  ],
  [
    [ / target block #2 /
      [ / result /
        18, / COSE_Sign1 tag /
        [
          &lt;&lt;{ / protected /
             / alg / 1:-37 / PS256 /
          }&gt;&gt;,
          { / unprotected /
            / kid / 4:'ExampleRSA'
          },
          null, / payload /
          h'2229cec7cd4e77e55b7ef39e0305931527e3075e7cad4969ecf1bdc5
cb8662435128718c7ba465d2251a770a6c48ddc62f515fca43482ae137fffa67c86b
c60b3b838875621b276235bdc4269f45fd0c08fdd607650d03ae75b86364f7f5f2cc
442d60e72bff7939478deba7e3492ea96f8ac1f953583df897138f66c16bc2
07' / signature /
        ]
      ]
    ]
  ]
]
</pre>
</div>
<figcaption><a href="#figure-16" class="selfRef">Figure 16</a>:
<a href="#name-abstract-security-block-cbor-" class="selfRef">Abstract Security Block CBOR diagnostic</a>
          </figcaption></figure>
</div>
</section>
<section id="section-a.4">
        <h2 id="name-symmetric-kek-cose_encrypt">
<a href="#section-a.4" class="section-number selfRef">A.4. </a><a href="#name-symmetric-kek-cose_encrypt" class="section-name selfRef">Symmetric KEK COSE_Encrypt</a>
        </h2>
<p id="section-a.4-1">
This is an example of an encryption with a random CEK and an explicit key-encryption key (KEK) identified by a "kid".
The keys used are shown in <a href="#fig-ex-encrypt-symm-keys" class="xref">Figure 17</a>.<a href="#section-a.4-1" class="pilcrow">¶</a></p>
<span id="name-example-keys-3"></span><div id="fig-ex-encrypt-symm-keys">
<figure id="figure-17">
          <div id="section-a.4-2.1">
<pre class="sourcecode lang-cbor">
[
  {
    / kty / 1: 4, / symmetric /
    / kid / 2: 'ExampleKEK',
    / k / -1: h'0e8a982b921d1086241798032fedc1f883eab72e4e43bb2d11cf
ae38ad7a972e'
  },
  {
    / kty / 1: 4, / symmetric /
    / kid / 2: 'ExampleCEK',
    / k / -1: h'13bf9cead057c0aca2c9e52471ca4b19ddfaf4c0784e3f3e8e39
99dbae4ce45c'
  }
]
</pre>
</div>
<figcaption><a href="#figure-17" class="selfRef">Figure 17</a>:
<a href="#name-example-keys-3" class="selfRef">Example Keys</a>
          </figcaption></figure>
</div>
<p id="section-a.4-3">
The external_aad is the encoded data from <a href="#fig-ex-AAD-value" class="xref">Figure 7</a>.
The payload is the encoded target block-type-specific data from <a href="#fig-ex-target-block" class="xref">Figure 6</a>.<a href="#section-a.4-3" class="pilcrow">¶</a></p>
<span id="name-enc_structure-cbor-diagnost"></span><div id="fig-ex-encrypt-symm-struct">
<figure id="figure-18">
          <div id="section-a.4-4.1">
<pre class="sourcecode lang-cbor">
[
  "Encrypt", / context /
  h'a10103', / protected /
  h'83880700008201692f2f6473742f7376638201662f2f7372632f8201662f2f73
72632f820018281a000f424083070200f6' / external_aad /
]
</pre>
</div>
<figcaption><a href="#figure-18" class="selfRef">Figure 18</a>:
<a href="#name-enc_structure-cbor-diagnost" class="selfRef">Enc_structure CBOR diagnostic</a>
          </figcaption></figure>
</div>
<span id="name-abstract-security-block-cbor-d"></span><div id="fig-ex-encrypt-symm-asb">
<figure id="figure-19">
          <div id="section-a.4-5.1">
<pre class="sourcecode lang-cbor">
[
  [2], / targets /
  0, / security context TBD /
  1, / flags: params-present /
  [ / parameters /
    [
      5, / AAD-scope /
      0x03 / has-primary-ctx | has-target-ctx /
    ]
  ],
  [
    [ / target block #2 /
      [ / result /
        96, / COSE_Encrypt tag /
        [
          &lt;&lt;{ / protected /
             / alg / 1:3 / A256GCM /
          }&gt;&gt;,
          { / unprotected /
            / iv / 5: h'6f3093eba5d85143c3dc484a'
          },
          null, / payload /
          [
            [ / recipient /
              h'', / protected /
              { / unprotected /
                / alg / 1:-5, / A256KW /
                / kid / 4:'ExampleKEK'
              },
              h'917f2045e1169502756252bf119a94cdac6a9d8944245b5a9a26
d403a6331159e3d691a708e9984d' / key-wrapped /
            ]
          ]
        ]
      ]
    ]
  ]
]
</pre>
</div>
<figcaption><a href="#figure-19" class="selfRef">Figure 19</a>:
<a href="#name-abstract-security-block-cbor-d" class="selfRef">Abstract Security Block CBOR diagnostic</a>
          </figcaption></figure>
</div>
<span id="name-encrypted-target-block-cbor"></span><div id="fig-ex-encrypt-symm-final">
<figure id="figure-20">
          <div id="section-a.4-6.1">
<pre class="sourcecode lang-cbor">
[
  7, / type code - bundle age /
  2, / block num /
  0, / flags /
  0, / CRC type /
  h'63bb162d8ee2e8175cfc340b6df978864907a2' / ciphertext /
]
</pre>
</div>
<figcaption><a href="#figure-20" class="selfRef">Figure 20</a>:
<a href="#name-encrypted-target-block-cbor" class="selfRef">Encrypted Target block CBOR diagnostic</a>
          </figcaption></figure>
</div>
</section>
<section id="section-a.5">
        <h2 id="name-ec-keypair-cose_encrypt">
<a href="#section-a.5" class="section-number selfRef">A.5. </a><a href="#name-ec-keypair-cose_encrypt" class="section-name selfRef">EC Keypair COSE_Encrypt</a>
        </h2>
<p id="section-a.5-1">
This is an example of an encryption with an P-256 curve ephemeral sender keypair and a static recipient keypair identified by a "kid".
The keys used are shown in <a href="#fig-ex-encrypt-ec2-keys" class="xref">Figure 21</a>.<a href="#section-a.5-1" class="pilcrow">¶</a></p>
<span id="name-example-keys-4"></span><div id="fig-ex-encrypt-ec2-keys">
<figure id="figure-21">
          <div id="section-a.5-2.1">
<pre class="sourcecode lang-cbor">
[
  { / sender ephemeral private key /
    / kty / 1: 2, / EC2 /
    / crv / -1: 1, / P-256 /
    / x / -2: h'fedaba748882050d1bef8ba992911898f554450952070aeb4788
ca57d1df6bcc',
    / y / -3: h'ceaa8e7ff4751a4f81c70e98f1713378b0bd82a1414a2f493c1c
9c0670f28d62',
    / d / -4: h'a2e4ed4f2e21842999b0e9ebdaad7465efd5c29bd5761f5c2088
0f9d9c3b122a'
  },
  { / recipient private key /
    / kty / 1: 2, / EC2 /
    / kid / 2: 'ExampleEC2',
    / crv / -1: 1, / P-256 /
    / x / -2: h'44c1fa63b84f172b50541339c50beb0e630241ecb4eebbddb8b5
e4fe0a1787a8',
    / y / -3: h'059451c7630d95d0b550acbd02e979b3f4f74e645b74715fafbc
1639960a0c7a',
    / d / -4: h'dd6e7d8c4c0e0c0bd3ae1b4a2fa86b9a09b7efee4a233772cf51
89786ea63842'
  },
  {
    / kty / 1: 4, / symmetric /
    / kid / 2: 'ExampleCEK',
    / k / -1: h'13bf9cead057c0aca2c9e52471ca4b19ddfaf4c0784e3f3e8e39
99dbae4ce45c'
  }
]
</pre>
</div>
<figcaption><a href="#figure-21" class="selfRef">Figure 21</a>:
<a href="#name-example-keys-4" class="selfRef">Example Keys</a>
          </figcaption></figure>
</div>
<p id="section-a.5-3">
The external_aad is the encoded data from <a href="#fig-ex-AAD-value" class="xref">Figure 7</a>.
The payload is the encoded target block-type-specific data from <a href="#fig-ex-target-block" class="xref">Figure 6</a>.<a href="#section-a.5-3" class="pilcrow">¶</a></p>
<span id="name-enc_structure-cbor-diagnosti"></span><div id="fig-ex-encrypt-ec2-struct">
<figure id="figure-22">
          <div id="section-a.5-4.1">
<pre class="sourcecode lang-cbor">
[
  "Encrypt", / context /
  h'a10103', / protected /
  h'83880700008201692f2f6473742f7376638201662f2f7372632f8201662f2f73
72632f820018281a000f424083070200f6' / external_aad /
]
</pre>
</div>
<figcaption><a href="#figure-22" class="selfRef">Figure 22</a>:
<a href="#name-enc_structure-cbor-diagnosti" class="selfRef">Enc_structure CBOR diagnostic</a>
          </figcaption></figure>
</div>
<span id="name-abstract-security-block-cbor-di"></span><div id="fig-ex-encrypt-ec2-asb">
<figure id="figure-23">
          <div id="section-a.5-5.1">
<pre class="sourcecode lang-cbor">
[
  [2], / targets /
  0, / security context TBD /
  1, / flags: params-present /
  [ / parameters /
    [
      1, / COSE key /
      { / public key /
        / kty / 1: 2, / EC2 /
        / kid / 2: 'ExampleEC2',
        / crv / -1: 1, / P-256 /
        / x / -2: h'44c1fa63b84f172b50541339c50beb0e630241ecb4eebbdd
b8b5e4fe0a1787a8',
        / y / -3: h'059451c7630d95d0b550acbd02e979b3f4f74e645b74715f
afbc1639960a0c7a'
      }
    ],
    [
      5, / AAD-scope /
      0x03 / has-primary-ctx | has-target-ctx /
    ]
  ],
  [
    [ / target block #2 /
      [ / result /
        96, / COSE_Encrypt tag /
        [
          &lt;&lt;{ / protected /
             / alg / 1:3 / A256GCM /
          }&gt;&gt;,
          { / unprotected /
            / iv / 5: h'6f3093eba5d85143c3dc484a'
          },
          null, / payload /
          [
            [ / recipient /
              h'', / protected /
              { / unprotected /
                / alg / 1:-31, / ECDH-ES + A256KW /
                / kid / 4:'ExampleEC2',
                / ephemeral key / -1:{
                  1:2,
                  -1:1,
                  -2:h'fedaba748882050d1bef8ba992911898f554450952070
aeb4788ca57d1df6bcc',
                  -3:h'ceaa8e7ff4751a4f81c70e98f1713378b0bd82a1414a2
f493c1c9c0670f28d62'
                },
                / PartyU nonce / -22:h'e6bd83a5a06841c2ea1dd4eebaaa
f252'
              },
              h'e20b6fd9b46cdaae9e67ccf4893706802a7acb0c3b3a792b3fcb
a110f2f27d7972934f4e6497ac89' / key-wrapped /
            ]
          ]
        ]
      ]
    ]
  ]
]
</pre>
</div>
<figcaption><a href="#figure-23" class="selfRef">Figure 23</a>:
<a href="#name-abstract-security-block-cbor-di" class="selfRef">Abstract Security Block CBOR diagnostic</a>
          </figcaption></figure>
</div>
<span id="name-encrypted-target-block-cbor-"></span><div id="fig-ex-encrypt-ec2-final">
<figure id="figure-24">
          <div id="section-a.5-6.1">
<pre class="sourcecode lang-cbor">
[
  7, / type code - bundle age /
  2, / block num /
  0, / flags /
  0, / CRC type /
  h'63bb162d8ee2e8175cfc340b6df978864907a2' / ciphertext /
]
</pre>
</div>
<figcaption><a href="#figure-24" class="selfRef">Figure 24</a>:
<a href="#name-encrypted-target-block-cbor-" class="selfRef">Encrypted Target block CBOR diagnostic</a>
          </figcaption></figure>
</div>
</section>
<section id="section-a.6">
        <h2 id="name-rsa-keypair-cose_encrypt">
<a href="#section-a.6" class="section-number selfRef">A.6. </a><a href="#name-rsa-keypair-cose_encrypt" class="section-name selfRef">RSA Keypair COSE_Encrypt</a>
        </h2>
<p id="section-a.6-1">
This is an example of an encrypion with a recipient having a 1024-bit RSA keypair identified by a "kid".
The associated public key is included as a security parameter.<a href="#section-a.6-1" class="pilcrow">¶</a></p>
<p id="section-a.6-2">
This key strength is not supposed to be a secure configuration, only intended to explain the procedure.
This padding scheme uses a random salt, so the full layer-2 ciphertext output is not deterministic.<a href="#section-a.6-2" class="pilcrow">¶</a></p>
<span id="name-example-keys-5"></span><div id="fig-ex-encrypt-rsa-keys">
<figure id="figure-25">
          <div id="section-a.6-3.1">
<pre class="sourcecode lang-cbor">
[
  { / recipient private key /
    / kty / 1: 3, / RSA /
    / kid / 2: 'ExampleRSA',
    / n / -1: h'b0b5fd85f52c91844007443c9f9371980025f76d51fc9c676812
31da610cb291ba637ce813bffdb2e9c653258607389ec97dad3db295fded67744ed6
20707db36804e74e56a494030a73608fc8d92f2f0578d2d85cc201ef0ff22d7835d2
d147d3b90a6884276235a01c2be99dfc597f79554362fc1eb03639cac5ccaddb29
25',
    / e / -2: h'010001',
    / d / -3: h'9b5d26ad6445ef1aab80b809e4f329684e9912d556c4166f041d
1b1fb93c04b4037ffd0dbe6f8a8a86e70bab6e0f6344983a9ada27ed9ff7de816fde
eb5e7be48e607ce5fda4581ca6338a9e019fb3689b28934192b6a190cdda910abb5a
86a2f7b6f9cd5011049d8de52ddfef73aa06df401c55623ec196720f54920deb4f
01',
    / p / -4: h'db22d94e7784a27b568cbf985307ea8d6430ff6b88c18a7086fd
4f57a326572f2250c39e48a6f8e2201661c2dfe12c7386835b649714d050aa36123e
c3d00e75',
    / q / -5: h'ce7016adc5f326b7520397c5978ee2f50e69279983d54c5d76f0
5bcd61de0879d7056c923540dff9cbae95dcc0e5e86b52b3c902dc9669c8021c6955
7effb9f1',
    / dP / -6: h'6a6fcaccea106a3b2e16bf18e57b7ad9a2488a4758ed68a8af6
86a194f0d585b7477760c738d6665aee0302bcf4237ad0530d83b4b86b887f5a4bdc
7eea427e1',
    / dQ / -7: h'28a4cae245b1dcb285142e027a1768b9c4af915b59285a93a04
22c60e05edd9e57663afd023d169bd0ad3bd62da8563d231840802ebbf271ad70b89
05ba3af91',
    / qInv / -8: h'07b5a61733896270a6bd2bb1654194c54e2bc0e061b543a4e
d9fa73c4bc79c87148aa92a451c4ab8262b6377a9c7b97f869160ca6f5d853ee4b65
f4f92865ca3'
  },
  {
    / kty / 1: 4, / symmetric /
    / kid / 2: 'ExampleCEK',
    / k / -1: h'13bf9cead057c0aca2c9e52471ca4b19ddfaf4c0784e3f3e8e39
99dbae4ce45c'
  }
]
</pre>
</div>
<figcaption><a href="#figure-25" class="selfRef">Figure 25</a>:
<a href="#name-example-keys-5" class="selfRef">Example Keys</a>
          </figcaption></figure>
</div>
<p id="section-a.6-4">
The external_aad is the encoded data from <a href="#fig-ex-AAD-value" class="xref">Figure 7</a>.
The payload is the encoded target block-type-specific data from <a href="#fig-ex-target-block" class="xref">Figure 6</a>.<a href="#section-a.6-4" class="pilcrow">¶</a></p>
<span id="name-enc_structure-cbor-diagnostic"></span><div id="fig-ex-encrypt-rsa-struct">
<figure id="figure-26">
          <div id="section-a.6-5.1">
<pre class="sourcecode lang-cbor">
[
  "Encrypt", / context /
  h'a10103', / protected /
  h'83880700008201692f2f6473742f7376638201662f2f7372632f8201662f2f73
72632f820018281a000f424083070200f6' / external_aad /
]
</pre>
</div>
<figcaption><a href="#figure-26" class="selfRef">Figure 26</a>:
<a href="#name-enc_structure-cbor-diagnostic" class="selfRef">Enc_structure CBOR diagnostic</a>
          </figcaption></figure>
</div>
<span id="name-abstract-security-block-cbor-dia"></span><div id="fig-ex-encrypt-rsa-asb">
<figure id="figure-27">
          <div id="section-a.6-6.1">
<pre class="sourcecode lang-cbor">
[
  [2], / targets /
  0, / security context TBD /
  1, / flags: params-present /
  [ / parameters /
    [
      1, / COSE key /
      { / public key /
        / kty / 1: 3, / RSA /
        / kid / 2: 'ExampleRSA',
        / n / -1: h'b0b5fd85f52c91844007443c9f9371980025f76d51fc9c67
681231da610cb291ba637ce813bffdb2e9c653258607389ec97dad3db295fded6774
4ed620707db36804e74e56a494030a73608fc8d92f2f0578d2d85cc201ef0ff22d78
35d2d147d3b90a6884276235a01c2be99dfc597f79554362fc1eb03639cac5ccaddb
2925',
        / e / -2: h'010001'
      }
    ],
    [
      5, / AAD-scope /
      0x03 / has-primary-ctx | has-target-ctx /
    ]
  ],
  [
    [ / target block #2 /
      [ / result /
        96, / COSE_Encrypt tag /
        [
          &lt;&lt;{ / protected /
             / alg / 1:3 / A256GCM /
          }&gt;&gt;,
          { / unprotected /
            / iv / 5: h'6f3093eba5d85143c3dc484a'
          },
          null, / payload /
          [
            [ / recipient /
              h'', / protected /
              { / unprotected /
                / alg / 1:-41, / RSAES-OAEP w SHA-256 /
                / kid / 4:'ExampleRSA'
              },
              h'69e76a39b908090f55b1048c95bd1683d9ce702fd9ed4a149650
72fd411936ade41a36a9f62921635d14406eb0e1fa3c02ca0d957a4a44006aa3c03e
326867964b166f8731ebcb20d413fd8f26c57c337689dc42235bfd2b928619b0d4f2
7ec118c608ad9d18c881bc5124833483ded5f5fb079805f3e299fa45f756ecc4c3
e6' / key-wrapped /
            ]
          ]
        ]
      ]
    ]
  ]
]
</pre>
</div>
<figcaption><a href="#figure-27" class="selfRef">Figure 27</a>:
<a href="#name-abstract-security-block-cbor-dia" class="selfRef">Abstract Security Block CBOR diagnostic</a>
          </figcaption></figure>
</div>
<span id="name-encrypted-target-block-cbor-d"></span><div id="fig-ex-encrypt-rsa-final">
<figure id="figure-28">
          <div id="section-a.6-7.1">
<pre class="sourcecode lang-cbor">
[
  7, / type code - bundle age /
  2, / block num /
  0, / flags /
  0, / CRC type /
  h'63bb162d8ee2e8175cfc340b6df978864907a2' / ciphertext /
]
</pre>
</div>
<figcaption><a href="#figure-28" class="selfRef">Figure 28</a>:
<a href="#name-encrypted-target-block-cbor-d" class="selfRef">Encrypted Target block CBOR diagnostic</a>
          </figcaption></figure>
</div>
</section>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.b">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Brian Sipos</span></div>
<div dir="auto" class="left"><span class="org">RKF Engineering Solutions, LLC</span></div>
<div dir="auto" class="left"><span class="street-address">7500 Old Georgetown Road<br>Suite 1275</span></div>
<div dir="auto" class="left">
<span class="locality">Bethesda</span>, <span class="region">MD</span> <span class="postal-code">20814-6198</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:BSipos@rkf-eng.com" class="email">BSipos@rkf-eng.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
