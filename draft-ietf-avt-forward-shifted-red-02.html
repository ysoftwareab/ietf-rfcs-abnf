<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Forward-shifted RTP Redundancy Payload Support</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Forward-shifted RTP Redundancy Payload Support">
<meta name="keywords" content="Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Audio Video Transport WG</td><td class="header">Q. Xie</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">TRG</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfcRFC 2198'>RFC 2198</a></td><td class="header">October 07, 2008</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: April 10, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Forward-shifted RTP Redundancy Payload Support<br />draft-ietf-avt-forward-shifted-red-02.txt</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 10, 2009.</p>

<h3>Abstract</h3>

<p> This document defines a simple enhancement to RFC 2198 to support
RTP sessions with forward-shifted redundant encodings, i.e., redundant
data sent before the corresponding primary data. Forward-shifted
redundancy can be used to conceal losses of a large number of
consecutive media frames (e.g., consecutive loss of seconds or even tens 
of seconds of media).
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Conventions<br />
<a href="#anchor2">2.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Sending Redundant Data Inband vs. Out-of-band<br />
<a href="#anchor4">3.</a>&nbsp;
Allowing Forward-shifted Redundant Data<br />
<a href="#fwdred-sect">4.</a>&nbsp;
Registration of Media Type "fwdred"<br />
<a href="#anchor5">5.</a>&nbsp;
Mapping Media Type Parameters into SDP<br />
<a href="#anchor6">6.</a>&nbsp;
Usage in Offer/Answer<br />
<a href="#anchor7">7.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor8">8.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
Normative References<br />
<a href="#ANTI_SHADOW">Appendix&nbsp;A.</a>&nbsp;
Anti-shadow Loss Concealment Using Forward-shifted Redundancy<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">A.1.</a>&nbsp;
Sender Side Operations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">A.2.</a>&nbsp;
Receiver Side Operations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">A.2.1.</a>&nbsp;
Normal Mode Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">A.2.2.</a>&nbsp;
Anti-shadow Mode Operation<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Conventions</h3>

<p> The keywords MUST, MUST NOT, REQUIRED, SHALL, SHALL NOT, SHOULD,
SHOULD NOT, RECOMMENDED, NOT RECOMMENDED, MAY, and OPTIONAL, when they
appear in this document, are to be interpreted as described in RFC
2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement       Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>. 
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p> This document defines a simple enhancement to RFC 2198 <a class='info' href='#RFC2198'>[RFC2198]<span> (</span><span class='info'>Perkins, C., Kouvelas, I., Hodson, O., Hardman, V., Handley, M., Bolot, J., Vega-Garcia, A., and S. Fosse-Parisis, &ldquo;RTP Payload for Redundant Audio Data,&rdquo; September&nbsp;1997.</span><span>)</span></a> to support RTP sessions with forward-shifted
redundant encodings, i.e., redundant data is sent before the
corresponding primary data. 
</p>
<p> Forward-shifted redundancy can be used to conceal losses of a
large number of consecutive media frames (e.g., consecutive loss of 
seconds of media). Such capability is highly desirable,
especially in wireless mobile communication environments where the
radio signal to a mobile wireless media receiver can be temporarily
blocked by tall buildings, mountains, tunnels, etc. In other words, the
receiver enters into a shadow of the radio coverage. No new data will
be received when the receiver is in a shadow. 
</p>
<p> In some extreme cases, the receiver may have to spend seconds or
even tens of seconds in a shadow. The traditional backward-shifted
redundant encoding scheme (i.e., redundant data is sent after the
primary data), as currently supported by RFC 2198 <a class='info' href='#RFC2198'>[RFC2198]<span> (</span><span class='info'>Perkins, C., Kouvelas, I., Hodson, O., Hardman, V., Handley, M., Bolot, J., Vega-Garcia, A., and S. Fosse-Parisis, &ldquo;RTP Payload for Redundant Audio Data,&rdquo; September&nbsp;1997.</span><span>)</span></a>, is known to be ineffective in dealing with such
consecutive frame losses.  
</p>
<p> In contrast, the forward-shifted redundancy, when used in
combination with the anti-shadow loss management at the receiver (as
described in <a class='info' href='#ANTI_SHADOW'>Appendix&nbsp;A<span> (</span><span class='info'>Anti-shadow Loss Concealment Using Forward-shifted Redundancy</span><span>)</span></a>), can effectively prevent
service interruptions when a mobile receiver runs into such a
shadow. 
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Sending Redundant Data Inband vs. Out-of-band</h3>

<p> Regardless of the direction of time shift (e.g., forward-shifting
or backward-shifting as in RFC 2198) or the encoding scheme (e.g.,
FEC, or non-FEC), there is always the option of sending the redundant
data and the primary data either in the same RTP session (i.e.,
inband) or in separate RTP sessions (i.e., out-of-band). There are
pros and cons for either approach, as outlined below.  
</p>
<p> Inband Approach: 
  </p>
<blockquote class="text"><dl>
<dt>o</dt>
<dd> Pro: A single RTP session is faster to setup and
   easier to manage. 
</dd>
<dt>o</dt>
<dd> Pro: A single RTP session presents a simpler
   problem for NAT/firewall traversal. 
</dd>
<dt>o</dt>
<dd> Pro: Less overall overhead - one RTP/UDP/IP
   overhead. 
</dd>
<dt>o</dt>
<dd> Con: Lack of flexibility - difficult for middle
   boxes such as gateways to add/remove the redundant data.  
</dd>
<dt>o</dt>
<dd> Con: Need more specification - special payload
   formats need to be defined to carry the redundant data inband.
   
</dd>
</dl></blockquote><p>

</p>
<p> Out-of-band Approach: 
  </p>
<blockquote class="text"><dl>
<dt>o</dt>
<dd> Pro: Flexibility - redundant data can be more
   easily added, removed, or replaced by a middle box such as a
   gateway. 
</dd>
<dt>o</dt>
<dd> Pro: Little or none specification - no new payload
   format is needed. 
</dd>
<dt>o</dt>
<dd> Con: Multiple RTP sessions may take longer to
   setup and more complexity to manage. 
</dd>
<dt>o</dt>
<dd> Con: Multiple RTP sessions NAT/firewall traverse
   are harder to address. 
</dd>
<dt>o</dt>
<dd> Con: Bigger overall overhead - more than one
   RTP/UDP/IP overhead. 
</dd>
</dl></blockquote><p>

</p>
<p> It is noteworthy that the specification of inband payload formats
such as this and RFC 2198 does not preclude a deployment from using
the out-of-band approach. Rather, it gives the deployment the choose
to use whichever approach deemed most beneficiary under a given
circumstance.  
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Allowing Forward-shifted Redundant Data</h3>

<p> In RFC 2198, the timestamp offset in the additional header
corresponding to a redundant block is defined as a 14 bits unsigned
offset of timestamp relative to timestamp given in the RTP header.  As
stated in RFC 2198:  
   </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  "The use of an unsigned offset implies that redundant data must be
  sent after the primary data, and is hence a time to be subtracted
  from the current timestamp to determine the timestamp of the data
  for which this block is the redundancy."
</pre></div><p>


This effectively prevents RFC 2198 from being used to support
forward-shifted redundant blocks. 
</p>
<p> In order to support the use of forward-shifted redundant blocks,
the media type "fwdred" which allows an optional MIME parameter,
"forwardshift", is introduced for indicating the capability and
willingness of using forward-shifted redundancy and the base value of
timestamp forward-shifting. The base value of "forwardshift" is an
integer equal or greater than '0'. 
</p>
<p> In an RTP session which uses forward-shifted redundant encodings,
the timestamp of a redundant block in a received RTP packet is
determined as follows:
   </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  timestamp of redundant block = timestamp in RTP header
                      - timestamp offset in additional header
                      + forward shift base value
</pre></div><p>


</p>
<a name="fwdred-sect"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Registration of Media Type "fwdred"</h3>

<p> (The definition is based on media type "red" defined in RFC 2198
<a class='info' href='#RFC2198'>[RFC2198]<span> (</span><span class='info'>Perkins, C., Kouvelas, I., Hodson, O., Hardman, V., Handley, M., Bolot, J., Vega-Garcia, A., and S. Fosse-Parisis, &ldquo;RTP Payload for Redundant Audio Data,&rdquo; September&nbsp;1997.</span><span>)</span></a>, with the addition of the optional
"forwardshift" parameter.)

</p>
<blockquote class="text"><dl>
<dt>Type name:</dt>
<dd> audio 
</dd>
<dt>Subtype names:</dt>
<dd> fwdred 
</dd>
<dt>Required parameters:</dt>
<dd> none 
</dd>
<dt>Optional parameters:</dt>
<dd>
</dd>
<blockquote class="text"><dl>
<dt>forwardshift:</dt>
<dd> An unsigned integer can be specified
     as value.

     <br />

     If this parameter is present with a value greater than '0', it
     indicates that the sender of this parameter will
     use forward shifting with a base value as specified when sending out
     redundant data. 
     <br />
<br />

     If this parameter is absent or present with a value of '0', it
     indicates that the sender of this parameter will not use forward
     shifting when sending its redundant data, i.e., the sender
     will have the same behaviors as defined in RFC 2198.
 
</dd>
</dl></blockquote>
<dt>Encoding considerations:</dt>
<dd> 
   
   This media type is framed binary data (see RFC 4288, Section 4.8)
   and is only defined for transfer of RTP redundant data frames 
   specified in RFC 2198.  
</dd>
<dt>Security considerations:</dt>
<dd> 
   See Section 6 "Security Considerations" of RFC 2198. 
</dd>
<dt>Interoperability considerations:</dt>
<dd> None. 
</dd>
<dt>Published specification:</dt>
<dd> 
   
   RTP redundant data frame format is specified in RFC 2198. 
</dd>
<dt>Applications that use this media type:</dt>
<dd>
   
   It is expected that real-time audio/video applications that want
   protection against losses of a large number of consecutive frames
   will be interested in using this type. 
</dd>
<dt>Additional information:</dt>
<dd> none 
</dd>
<dt>Person & email address to contact for further
		information:</dt>
<dd>
   
   Qiaobing Xie &lt;Qiaobing.Xie@motorola.com> 
</dd>
<dt>Intended usage:</dt>
<dd> COMMON 
</dd>
<dt>Restrictions on usage:</dt>
<dd>
   
   This media type depends on RTP framing, and hence is only defined
   for transfer via RTP (RFC 3550 <a class='info' href='#RFC3550'>[RFC3550]<span> (</span><span class='info'>Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;RTP: A Transport Protocol for Real-Time       Applications,&rdquo; July&nbsp;2003.</span><span>)</span></a>).  Transfer
   within other framing protocols is not defined at this time.  
</dd>
<dt>Author:</dt>
<dd>
   
   Qiaobing Xie 
</dd>
<dt>Change controller:</dt>
<dd>
   
   IETF Audio/Video Transport working group delegated from the IESG. 
</dd>
</dl></blockquote><p>

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Mapping Media Type Parameters into SDP</h3>

<p> The information carried in the MIME media type specification has a
specific mapping to fields in the Session Description Protocol (SDP)
<a class='info' href='#RFC4566'>[RFC4566]<span> (</span><span class='info'>Handley, M., Jacobson, V., and C. Perkins, &ldquo;SDP: Session Description Protocol,&rdquo; July&nbsp;2006.</span><span>)</span></a>, which is commonly used to describe RTP
sessions. When SDP is used to specify sessions employing the
forward-shifted redundant format, the mapping is as
follows: 

  </p>
<ul class="text">
<li> The media type ("audio") goes in SDP "m=" as the media name. 
</li>
<li> The media subtype ("fwdred") goes in SDP "a=rtpmap" as the encoding
  name. 
</li>
<li> The optional parameter "forwardshift" goes in the SDP "a=fmtp"
  attribute by copying it directly from the MIME media type string as
  "forwardshift=value".  
</li>
</ul><p>

</p>
<p> Example of usage of indicating forward-shifted (by 5.1 sec) redundancy:
   </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  m=audio 12345 RTP/AVP 121 0 5
  a=rtpmap:121 fwdred/8000/1
  a=fmtp:121 0/5 forwardshift=40800
</pre></div><p>


</p>
<p> Example of usage of indicating sending redundancy without
forward-shifting (equivalent to RFC 2198): 
   </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  m=audio 12345 RTP/AVP 121 0 5
  a=rtpmap:121 fwdred/8000/1
  a=fmtp:121 0/5 forwardshift=0
</pre></div><p>


</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Usage in Offer/Answer</h3>

<p> The optional "forwardshift" SDP parameter specified in this
document is declarative, and all reasonable values are expected to be
supported. 
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p> The registration of the new MIME subtype "fwdred", as described in
<a class='info' href='#fwdred-sect'>Section&nbsp;4<span> (</span><span class='info'>Registration of Media Type &quot;fwdred&quot;</span><span>)</span></a>, is required. 
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>See Section 6 "Security Considerations" of RFC 2198 
<a class='info' href='#RFC2198'>[RFC2198]<span> (</span><span class='info'>Perkins, C., Kouvelas, I., Hodson, O., Hardman, V., Handley, M., Bolot, J., Vega-Garcia, A., and S. Fosse-Parisis, &ldquo;RTP Payload for Redundant Audio Data,&rdquo; September&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement
      Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2198">[RFC2198]</a></td>
<td class="author-text">Perkins, C., Kouvelas, I., Hodson, O., Hardman, V., Handley, M., Bolot, J., Vega-Garcia, A., and S. Fosse-Parisis, &ldquo;<a href="http://tools.ietf.org/html/rfc2198">RTP Payload for Redundant Audio Data</a>,&rdquo; RFC&nbsp;2198, September&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3550">[RFC3550]</a></td>
<td class="author-text">Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;<a href="http://tools.ietf.org/html/rfc3550">RTP: A Transport Protocol for Real-Time
      Applications</a>,&rdquo; RFC&nbsp;3550, July&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4566">[RFC4566]</a></td>
<td class="author-text">Handley, M., Jacobson, V., and C. Perkins, &ldquo;<a href="http://tools.ietf.org/html/rfc4566">SDP: Session Description Protocol</a>,&rdquo; RFC&nbsp;4566, July&nbsp;2006.</td></tr>
</table>

<a name="ANTI_SHADOW"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Anti-shadow Loss Concealment Using Forward-shifted Redundancy</h3>

<p> It is not unusual in a wireless mobile communication environment
that the radio signal to a mobile wireless media receiver can be
temporarily blocked by tall buildings, mountains, tunnels, etc. for a
period of time. In other words, the receiver enters into a shadow of
the radio coverage. When the receiver is in such a shadow no new data
will be received. In some extreme cases, the receiver may have to spend
seconds or even tens of seconds in such a shadow.  
</p>
<p> Without special design considerations to compensate the loss of
data due to shadowing, a mobile user may experience an unacceptable
level of service interruptions. And traditional redundant encoding
schemes (including RFC 2198 and most FEC schemes) are known to be
ineffective in dealing with such losses of consecutive frames.  
</p>
<p> However, the employment of forward-shifted redundancy, in
combination with the anti-shadow loss concealment at the receiver, as
described here, can effectively prevent service interruptions due to
the effect of shadowing. 
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Sender Side Operations</h3>

<p> For anti-shadow loss management, the RTP sender simply adds a
forward-shifted redundant stream (called anti-shadow or AS stream)
while transmitting the primary media stream. The amount of
forward-shifting, which should remain constant for the duration of the
session, will determine the maximal length of shadows that can be
completely concealed at the receiver, as explained below.  
</p>
<p> Except for the fast that it is forward-shifted relative to the
primary stream (i.e., the redundant data is sent ahead of the
corresponding primary data), the design decision and trade-offs on the
quality, encoding, bandwidth overhead, etc. of the redundant stream is
not different from the traditional RTP payload redundant scheme. 
</p>
<p> The following diagram illustrates a segment of the transmission
sequence of a forward-shifted redundant RTP session, in which the AS
stream is forward-shifted by 155 frames. If, for simplicity here, we
assume the value of timestamp is incremented by 1 between two
consecutive frames, this forward-shifted redundancy can then be
indicated with:
   </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    forwardshift=155
</pre></div><p>

and the setting of timestamp offset to 0 in all the additional
headers. This can mean a 3.1 second of forward shifting if each frame
represents 20 ms of original media,

   </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                   Primary stream    AS stream

       ...               |                |
                         v                v
       Pkt k+8        [ 111 ]          [ 266 ]
                         |                |
                         v                v
       Pkt k+7        [ 110 ]          [ 265 ]
                         |                |
                         v                v
   ^   Pkt k+6        [ 109 ]          [ 264 ]
   |                     |                |
   |                     v                v
       Pkt k+5        [ 108 ]          [ 263 ]
   T                     |                |
   I                     v                v
   M   Pkt k+4        [ 107 ]          [ 262 ]
   E                     |                |
                         v                v
       Pkt k+3        [ 106 ]          [ 261 ]
                         |                |
                         v                v
       Pkt k+2        [ 105 ]          [ 260 ]
                         |                |
                         v                v
       Pkt k+1        [ 104 ]          [ 259 ]
                         |                |
                         v                v
       Pkt k          [ 103 ]          [ 258 ]
                         |                |
                         v                v

                           Transmit first

   Figure 1. An example of forward-shifted redundant RTP packet
                           transmission.

</pre></div><p>


</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Receiver Side Operations</h3>

<p> The anti-shadow receiver is illustrated in the following diagram. 

   </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                               +---------+
                             normal mode   sw1 | media   |     media
  Primary stream ======================o___o==&gt;| decoder |===&gt; output
  AS stream     ----                           +---------+     device
                   |             AS mode o
                   |       +---------+   |
                   |       | anti-   |   |
                   -------&gt;| shadow  |----
                           | buffer  |
                           +---------+
                                |
                                V
                           expired frames
                           discarded

              Figure 2. Anti-shadow RTP receiver.
</pre></div><p>

The anti-shadow receiver operates between two modes - "normal mode"
and "AS mode".  When the receiver is not in a shadow (it can easily
tell that if it is still receiving new data), the receiver operates in
the normal mode. Otherwise, it operates in the AS mode.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2.1"></a><h3>A.2.1.&nbsp;
Normal Mode Operation</h3>

<p> In the normal mode, after receiving a new RTP packet that contains
the primary data and forward-shifted AS data, the receiver passes the
primary data directly to the appropriate media decoder for play-out (a
de-jittering buffer may be used before the play-out, but for
simplicity we assume none is used here), while the received AS data is
stored in an anti-shadow buffer. 
</p>
<p> Moreover, data stored in the anti-shadow buffer will be
continuously checked to determine whether it has expired. If a
redundant data in the anti-shadow buffer is found to have a timestamp
older (i.e., smaller) than that of the last primary frame passed to
the media decoder, it will be considered expired and be purged from
the anti-shadowing buffer.  
</p>
<p> The following example illustrates the operation of the anti-shadow
buffer in normal mode. We use the same assumption as in Figure 1, and
assume that the initial timestamp value is 103 when the session
starts.

   </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

          Timestamp     Timestamp
  Time      being      of media in
 (in ms)  played out    AS buffer         Note
------------------------------------------------------------------
  t &lt; 0                 --             (buffer empty)
   ...
  t=0       103         258            (hold 1 AS frame)
  t=20      104         258-259        (hold 2 AS frames)
  t=40      105         258-260        (hold 3 AS frames)

   ...
  t=3080    257         258-412        (full, hold 154 AS frames)
  t=3100    258         259-413        (full, frame 258 purged)
  t=3120    259         260-414        (full, frame 259 purged)
   ...

  t=6240    415         416-570        (always holds 3.08 sec
                                        worth of redundant data)
   ...


 Figure 3. Example of anti-shadow buffer operation in normal mode.

</pre></div><p>


</p>
<p> At the beginning of the session (t=0), the anti-shadow buffer will
be empty. When the first primary frame is received, the play-out will
start immediately, and the first received AS frame is stored in the
anti-shadow buffer. And with the arriving of more forward-shifted
redundant frames, the anti-shadow buffer will gradually be filled up.

</p>
<p> For the example shown in Figure 1, after 3.08 seconds (the amount
of the forward-shifting minus one frame) from the start of the
session, the anti-shadow buffer will be full, holding exactly 3.08
seconds worth of redundant data, with the oldest frame corresponding
to t=3.1 sec and youngest frame corresponding to t=6.18 sec.  
</p>
<p> And it is not difficult to see that in normal mode because of the
continuous purge of expired frames and the addition of new frames, the
anti-shadowing buffer will always be full holding the next
forward-shift amount of redundant frames.  
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2.2"></a><h3>A.2.2.&nbsp;
Anti-shadow Mode Operation</h3>

<p> When the receiver enters a shadow (or any other conditions that
prevent the receiver from getting new media data), the receiver
switches to the anti-shadow mode, in which it simply continues the
play-out from the forward-shifted redundant data stored in the
anti-shadow buffer. 
</p>
<p> For the example in Figure 3, if the receiver enters a shadow at
t=3120, it can continue the play-out by using the forward-shifted
redundant frames (ts=260-414) from the anti-shadow buffer. As far as
the receiver can move out of the shadow by t=6240, there will be no
service interruption.  
</p>
<p> When the shadow condition ends (meaning new data starts to arrive
again), the receiver immediately switches back to normal mode of
operation, playing out from newly arrived primary frames. And at the
same time, the arrival of new AS frames will start to re-fill the
anti-shadow buffer.  
</p>
<p> However, if the duration of the shadow is longer than the
amount of forward-shifting, the receiver will run out of media
frames from its anti-shadow buffer. At that point, service interruption will
occur. 
</p>
<p> Anti-shadow loss concealment described above can be readily
applied to the streaming of pre-recorded media. Because of the need of
generating the forward-shifted anti-shadow redundant stream, to apply
anti-shadow loss concealment to the streaming of live media will
require the insertion of a delay equal to or greater than the amount
of forward-shifting at the source of media.  
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Qiaobing Xie</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">The Resource Group</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1700 Pennsylvania Ave. NW</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Washington, DC  20006</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1-224-465-5954</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Qiaobing.Xie@gmail.com">Qiaobing.Xie@gmail.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
