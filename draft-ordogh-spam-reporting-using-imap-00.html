<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Spam reporting using IMAP: SREP</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 The SREP command">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Directives">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Abuse types">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 References">
<link href="#rfc.section.1.4" rel="Chapter" title="1.4 Part identifiers">
<link href="#rfc.section.1.5" rel="Chapter" title="1.5 Request Action">
<link href="#rfc.section.1.6" rel="Chapter" title="1.6 Responses and Results">
<link href="#rfc.section.1.7" rel="Chapter" title="1.7 Formal Syntax">
<link href="#rfc.section.1.8" rel="Chapter" title="1.8 Examples to report spam">
<link href="#rfc.section.1.9" rel="Chapter" title="1.9 Examples to report messages as no longer spam">
<link href="#rfc.section.1.10" rel="Chapter" title="1.10 Example flows">
<link href="#rfc.section.1.10.1" rel="Chapter" title="1.10.1 The server simply flags a message">
<link href="#rfc.section.2" rel="Chapter" title="2 Acknowledgements">
<link href="#rfc.section.3" rel="Chapter" title="3 IANA Considerations">
<link href="#rfc.section.4" rel="Chapter" title="4 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="5 References">
<link href="#rfc.references.1" rel="Chapter" title="5.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="5.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The Internet Message Access Protocol " />
  <meta name="description" content="The Internet Message Access Protocol " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">Z. O. Ordogh</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Research In Motion Limited</td>
</tr>
<tr>
<td class="left">Intended status: Experimental Protocol</td>
<td class="right">August 26, 2011</td>
</tr>
<tr>
<td class="left">Expires: February 27, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Spam reporting using IMAP: SREP<br />
  <span class="filename">draft-ordogh-spam-reporting-using-imap-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The Internet Message Access Protocol <a href="#IMAP4">[IMAP4]</a> does not support reporting spam on its own.  There are a number of solutions available based on the multipart/report content type defined in <a href="#REPORT">[REPORT]</a>.  However, these solutions require including the message contents and hence, consume bandwidth to transmit the entire message.  In bandwidth-constrained environments - such as mobile networks - it is highly desirable to send only a minimum set of information - a reference - instead of the entire message.  Furthermore, it is desirable to permit individual server implementations to handle spam in any way these systems choose to: do nothing, flag, recommend deletion or relocation, perform deletion or relocation, and, involve any choice of spam aggregator services in the decision process, such as <a href="#OMA-SPAMREP">[OMA-SPAMREP]</a>.  Solutions that exist today employ manipulating proprietary flags in the IMAP storage to achieve the bare minimum, however more advanced solutions cannot be developed by using flags only; the IMAP server needs to be involved actively in the spam reporting process.</p>
<p>This document specifies the syntax of the SREP command, which allows a client to inform the server that the user considered a message (or parts thereof) spam, or, that the user no longer considers a message (or parts thereof) spam.  Since all information about the message is readily available on the server, the command also allows the server to implement a more intelligent and accurate decision logic, which may be invoked when the spam is reported and the server can respond with its decision to the client.</p>
<p>Additionally, this document contains example flows, illustrating various decisions that the server may choose to evaluate, including invoking a service based on <a href="#OMA-SPAMREP">[OMA-SPAMREP]</a>.</p>
<p>This document focuses only on the client-server interactions and the scope is limited to messages that either exist on the IMAP server, or, exist elsewhere and the IMAP server is configured to access them.  Consequently, deposit-time filtering, messages that have been deleted, or, exist in an external storage but are accessible via an access protocol unknown to the IMAP server are out of scope.</p>
<h1><a>Conventions Used In This Document</a></h1>
<p>In examples, "C:" and "S:" indicate lines sent by the client or the server, respectively.</p>
<p>The key words "MUST", "MUST NOT", "SHOULD", "SHOULD NOT", and "MAY" in this document are to be interpreted as described in [IMAP4].</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on February 27, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may contain material from IETF Documents or IETF Contributions published or made publicly available before November 10, 2008.  The person(s) controlling the copyright in some of this material may not have granted the IETF Trust the right to allow modifications of such material outside the IETF Standards Process. Without obtaining an adequate license from the person(s) controlling the copyright in such materials, this document may not be modified outside the IETF Standards Process, and derivative works of it may not be created outside the IETF Standards Process, except to format it for publication as an RFC or to translate it into languages other than English.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">The SREP command</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Directives</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Abuse types</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">References</a>
</li>
<li>1.4.   <a href="#rfc.section.1.4">Part identifiers</a>
</li>
<li>1.5.   <a href="#rfc.section.1.5">Request Action</a>
</li>
<li>1.6.   <a href="#rfc.section.1.6">Responses and Results</a>
</li>
<li>1.7.   <a href="#rfc.section.1.7">Formal Syntax</a>
</li>
<li>1.8.   <a href="#rfc.section.1.8">Examples to report spam</a>
</li>
<li>1.9.   <a href="#rfc.section.1.9">Examples to report messages as no longer spam</a>
</li>
<li>1.10.   <a href="#rfc.section.1.10">Example flows</a>
</li>
<li>1.10.1.   <a href="#rfc.section.1.10.1">The server simply flags a message</a>
</li>
<li>2.   <a href="#rfc.section.2">Acknowledgements</a>
</li>
<li>3.   <a href="#rfc.section.3">IANA Considerations</a>
</li>
<li>4.   <a href="#rfc.section.4">Security Considerations</a>
</li>
<li>5.   <a href="#rfc.references">References</a>
</li>
<li>5.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>5.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Command" id="Command">The SREP command</a>
</h1>
<p id="rfc.section.1.p.1">The SREP command follows the conventions of <a href="#IMAP4">[IMAP4]</a>.</p>
<p id="rfc.section.1.p.2">Arguments: </p>

<ul class="empty">
<li>directive; see <a href="#Directives">Section 1.1</a>
</li>
<li>OPTIONAL abuse type; see <a href="#AbuseTypes">Section 1.2</a>
</li>
<li>reference; see <a href="#References">Section 1.3</a>
</li>
<li>OPTIONAL list of part identifiers; see <a href="#PartIDs">Section 1.4</a>
</li>
<li>request action; see <a href="#RequestAction">Section 1.5</a>
</li>
</ul>

<p> </p>
<p id="rfc.section.1.p.3">Responses; see <a href="#Responses">Section 1.6</a>: </p>

<ul class="empty">
<li>OPTIONAL OK response: RELOCATE</li>
<li>OPTIONAL OK response: RELOCATED</li>
<li>OPTIONAL OK response: DELETE</li>
<li>OPTIONAL OK response: DELETED</li>
<li>OPTIONAL OK response: KEYWORD</li>
</ul>

<p> </p>
<p id="rfc.section.1.p.4">Result: </p>

<ul class="empty">
<li>OK - command completed successfully</li>
<li>NO - the server cannot access one or more messages (deleted or unauthorized)</li>
<li>BAD - there was an error during processing the command (syntax or unsupported parameter)</li>
</ul>

<p> </p>
<p id="rfc.section.1.p.5">The formal syntax of the SREP command is defined in <a href="#FormalSyntax">Section 1.7</a>.</p>
<p id="rfc.section.1.p.6">The SREP command allows: </p>

<ul class="empty">
<li>- reporting spam; i.e. set the spam condition, and,</li>
<li>- reporting that a message (that was reported spam earlier) is no longer spam; i.e. clear the spam condition.</li>
</ul>

<p> </p>
<p id="rfc.section.1.p.7">The SREP command may be used with any IMAP4 server implementation that returns "SREP" as one of the supported capabilities in response to the CAPABILITY command.  If the server does not indicate support for the SREP capability, the client MUST NOT use the SREP command.</p>
<p id="rfc.section.1.p.8">The SREP command may result in ambiguity, therefore the client MUST NOT send any commands before the result of the SREP command has been received, see Section 5.5 in [IMAP].</p>
<p id="rfc.section.1.p.9">The command MAY be issued on one or more messages at a time, in the currently selected mailbox.</p>
<p id="rfc.section.1.p.10">The command MAY be extended in the future with new parameters (actions, directives, reference types, etc).  Servers MUST be able to recognize parameters unknown to them and respond with a BAD response in case they encounter such a parameter.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#Directives" id="Directives">Directives</a>
</h1>
<p id="rfc.section.1.1.p.1">The directive argument tells the server whether a message is being reported as a spam, or, it is being reported as no longer a spam. The SREP command MUST include the directive.  To report a spam, the directive MUST be SET.  To report that a message is no longer considered to be a spam, the directive MUST be CLEAR.</p>
<p id="rfc.section.1.1.p.2">Extensions are permitted, as defined in <a href="#FormalSyntax">Section 1.7</a>.  </p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#AbuseTypes" id="AbuseTypes">Abuse types</a>
</h1>
<p id="rfc.section.1.2.p.1">The client may have additional information about the spam regarding the nature of the abuse.  When such information is available, the client SHOULD include the abuse type argument in the request.  When such information is not available, the client MUST omit the abuse type argument from the request.  When the directive argument is CLEAR, the client MUST omit the abuse type argument from the request.  This specification defines the following abuse types: </p>
<p></p>

<ol>
<li>Phishing (forgery, link manipulation, etc.): an attempt to divulge information from the recipient by masquerading the sender and/or the content(s) of the message as a trustworthy form of communication.</li>
<li>Malware (virus, spyware, etc.): a malicious piece of software code embedded or attached to the message specifically designed to disrupt normal operation, gather sensitive information, gain unauthorized access, and/or perform other abusive behavior upon execution.</li>
</ol>

<p> </p>
<p id="rfc.section.1.2.p.3">Extensions are permitted, as defined in <a href="#FormalSyntax">Section 1.7</a>.  </p>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> <a href="#References" id="References">References</a>
</h1>
<p id="rfc.section.1.3.p.1">The reference argument consists of a reference type and a reference value.  In general, the reference type MUST indicate the format of the reference while the reference value MUST contain a value corresponding to the indicated reference format.  To use a unique identifier specified in <a href="#IMAP4">[IMAP4]</a>, the reference type MUST be UID and the reference value MUST be a number expressing the unique identifier of the message.  To use a sequence set specified in <a href="#IMAP4">[IMAP4]</a>, the reference type MUST be SEQ and the reference value MUST be sequence numbers corresponding to the specified message sequence number set.  To use an authorized URL specified in <a href="#URLAUTH">[URLAUTH]</a>, the reference type MUST be URLAUTH and the reference value MUST be an URLAUTH-authorized URL, authorizing the entire message.  </p>
<p id="rfc.section.1.3.p.2">Extensions are permitted, as defined in <a href="#FormalSyntax">Section 1.7</a>.  </p>
<h1 id="rfc.section.1.4">
<a href="#rfc.section.1.4">1.4.</a> <a href="#PartIDs" id="PartIDs">Part identifiers</a>
</h1>
<p id="rfc.section.1.4.p.1">When the reference identifies one and only one message, the list of part identifiers MAY be included to improve the accuracy of spam detection.  When the reference identifies more than one message, the list of part identifiers MUST be omitted.</p>
<p id="rfc.section.1.4.p.2">The list of part identifiers is a parenthesized list of part identifiers.  Part identifiers MAY identify header fields or bodies.  Header field identifiers MUST be prefixed with the word 'header' and the dot ('.') character MUST be used as the separator character.  Header fields MUST be identified by the name of the header field.</p>
<p id="rfc.section.1.4.p.3">Example: </p>

<ul class="empty"><li>The 'From' header field is identified as 'header.from'.</li></ul>

<p> </p>
<p id="rfc.section.1.4.p.4">Body identifiers MUST be prefixed with the word 'body' and the dot ('.') character MUST be used as the separator character.  Bodies MUST be identified by their positions within the message hierarcy, where the first position is 1 and the main level is 1.  To refer the entire body of a message (or all bodies of a multipart message), the separator character, the position MUST be omitted.</p>
<p id="rfc.section.1.4.p.5">Examples: <a href="#FormalSyntax">Section 1.7</a>.  </p>

<ul class="empty">
<li>- The entire body of a message (or all bodies of a multipart message) is identified as 'body'.</li>
<li>- Considering a simple multipart message, the part following the first boundary is identified as 'body.1'.</li>
<li>- Considering a multipart message that includes an email attachment following the second boundary, and the email attachment containing text following the first boundary, the text within the email message is identified as 'body.2.1'.</li>
</ul>

<p> The formal syntax of the part-id-list is defined in </p>
<h1 id="rfc.section.1.5">
<a href="#rfc.section.1.5">1.5.</a> <a href="#RequestAction" id="RequestAction">Request Action</a>
</h1>
<p id="rfc.section.1.5.p.1">The request action argument explicitly tells the server what to do with the the message.  To request a specific action from the server explicitly, the SREP command MUST include the request action argument.  To not request a specific action, the SREP command MUST NOT include the request action argument; in this case, the server MUST decide the course of action.  The client MAY specify either one of the following actions: <a href="#Responses">Section 1.6</a>).  NOTE: While the DELETE action does not seem appropriate in case the directive argument is CLEAR, it is permitted.  The formal syntax of the request action argument is defined in <a href="#FormalSyntax">Section 1.7</a>.  </p>

<ul class="empty">
<li>- The KEYWORD the client requests that only keyword(s) should be added to the message. The server MUST add the appropriate keyword.</li>
<li>- The RELOCATE the client requests that the message should be relocated. The server MUST relocate the message by copying the message to the destination mailbox removing the original as if another connected client requested this action.</li>
<li>- The DELETE the client requests that the message should be deleted. The server MUST delete the message as if another client performed this action.</li>
</ul>

<p> The server MUST ignore the destination mailbox in case it is nil, or, the request action is KEYWORD or DELETE.  It is assumed that the server is pre-configured with the location where user's spam messages are stored. If the server is not configured with such information and the destination mailbox in a RELOCATE action is nil, or, destination mailbox in a RELOCATE action is otherwise inaccessible to the user (does not exist, insufficient permission, etc) the the server MUST reject the request (see BAD response in </p>
<h1 id="rfc.section.1.6">
<a href="#rfc.section.1.6">1.6.</a> <a href="#Responses" id="Responses">Responses and Results</a>
</h1>
<p id="rfc.section.1.6.p.1">The SREP command MAY result in system flag changes, keyword changes, message relocation, message removal, or a combination of these.</p>
<p id="rfc.section.1.6.p.2">The result of the command MUST be either OK, NO or BAD: </p>

<ul class="empty">
<li>- The OK result MUST be returned only in case the server completed the command successfully.</li>
<li>- The NO result MUST be returned only in case the server processed the command successfully, but there is a problem with the referenced message(s) that prevents the server from completing the requested actions, such as one or more messages do not exist on the server, one or more messages are not properly authorized by URLAUTH, etc.</li>
<li>- The BAD result MUST be returned only in case the server cannot process the command, or a configuration error is preventing the server from completing the requested actions.</li>
</ul>

<p> </p>
<p id="rfc.section.1.6.p.3">When the result is OK, the response to a SET directive MUST be either KEYWORD, RELOCATE, RELOCATED, DELETE, or DELETED.</p>
<p id="rfc.section.1.6.p.4">When the result is OK, the response to a CLEAR directive MUST be either KEYWORD, RELOCATE, or  RELOCATED.</p>
<p id="rfc.section.1.6.p.5">The server responses are: </p>

<ul class="empty">
<li>- The KEYWORD response occurs in case of an explicit request from the client, or, in case the server decided that only the keywords should be updated either because it does not wish to give any hint to the client, or, because it does not have sufficient information. The client MAY decide what to do with the message.</li>
<li>- The RELOCATE response occurs in case the server decided that the message should be relocated, however leaves this action to the client. The client MAY decide what to do with the message.</li>
<li>- The RELOCATED response occurs in case of an explicit request from the client, or, in case the server decided that the message should be relocated and it performed relocation of the message to the appropriate location before the response was sent. The server MUST relocate the message by copying the message to the appropriate location and removing the original as if another connected client requested this action.</li>
<li>- The DELETE response occurs in case the server decided that the message should be deleted, however leaves this action to the client. The client MAY decide what to do with the message.</li>
<li>- The DELETED response occurs in case of an explicit request from the client, or, in case the server decided that the message should be deleted, and performed deletion of the message before the response was sent. The server MUST delete the message as if another client performed this action.</li>
</ul>

<p> </p>
<p id="rfc.section.1.6.p.6">The KEYWORD, RELOCATE and DELETE responses MUST include the list of flags/keywords that have been added or removed.  Added keywords MUST be prefixed with a plus sign ('+'), while removed keywords MUST be prefixed with a minus sign ('-').  The RELOCATED and DELETED responses MUST NOT include keywords.  The formal syntax of the actions is defined in <a href="#FormalSyntax">Section 1.7</a>.  </p>
<h1 id="rfc.section.1.7">
<a href="#rfc.section.1.7">1.7.</a> <a href="#FormalSyntax" id="FormalSyntax">Formal Syntax</a>
</h1>
<p id="rfc.section.1.7.p.1">This document extends the formal syntax defined in <a href="#IMAP4">[IMAP4]</a> using the Augmented Backus-Naur Form (ABNF) notation specified in <a href="#ABNF">[ABNF]</a>.  </p>
<div id="#rfc.figure.1"></div>
<p></p>
<pre>

directive           = "SET" / "CLEAR" / directive-ext
directive-ext       = atom
                      ; New directives MUST begin with "X" or be
                      ; registered with IANA as standard or
                      ; standards-track
abuse-type          = "AT" SP abuse-type-id
abuse-type-id       = 1*DIGIT
                      ; New abuse types MUST be registered with
                      ; IANA as standard or standards-track
reference           = reference-type SP reference-value
reference-type      = "UID" / "SEQ" / "URLAUTH" / reference-type-ext
reference-type-ext  = atom
                      ; New reference types MUST begin with "X"
                      ; or be registered with IANA as standard or
                      ; standards-track
reference-value     = uniqueid /           ; see [IMAP]
                      sequence-set /       ; see [IMAP]
                      authorized-url /     ; see [URLAUTH]
                      reference-value-ext
authorized-url      = authimapurlfull /    ; see [URLAUTH]
                      authimapurlrump      ; see [URLAUTH]
reference-value-ext = atom
                      ; New reference values MUST correspond to
                      ; reference-type-ext
part-id-list        = "(" part-id *(SP part-id) ")"
part-id             = header-id / body-id
header-id           = "header." header-fld-name
                      ; see header-fld-name in [IMAP]
body-id             = "body" *(. 1*DIGIT)
request-action      = "DO" SP req-action SP destination-box
req-action          = "KEYWORD" /
                      "RELOCATE" /
                      "DELETE"
destination-box     = mailbox / nil
resp-text-code      = resp-spam-actions    ; responses specific to
                                           ; this command, extending
                                           ; the resp-text-code
                                           ; defined in [IMAP]
resp-spam-actions   = "KEYWORD" /
                      "RELOCATE" /
                      "RELOCATED" /
                      "DELETE" /
                      "DELETED"


</pre>
<p></p>
<h1 id="rfc.section.1.8">
<a href="#rfc.section.1.8">1.8.</a> Examples to report spam</h1>
<p id="rfc.section.1.8.p.1">Report single message as spam; no identified parts; server only flags the message and hints that it should be moved: </p>

<ul class="empty">
<li>C: Z020 SREP SET SEQ 10</li>
<li>S: Z020 OK [RELOCATE +$OMAEVVM10-spam-user-identified] SREP Completed.</li>
</ul>

<p> </p>
<p id="rfc.section.1.8.p.2">Report single message as spam; header and body identified; server adds the appropriate flags and hints that it should be deleted: </p>

<ul class="empty">
<li>C: Z040 SREP SET SEQ 9 (header.from body.2)</li>
<li>S: Z040 OK [DELETE (+$OMAEVVM10-spam-user-identified-field.from +$OMAEVVM10-spam-user-identified-body.2)] SREP Completed.</li>
</ul>

<p> </p>
<p id="rfc.section.1.8.p.3">Report single message as spam; no identified parts; server moves the message (may clear/set flags too, but that is irrelevant because the client will need to reconcile anyway).  </p>

<ul class="empty">
<li>C: Z060 SREP SET SEQ 8</li>
<li>S: Z060 OK [RELOCATED] SREP Completed.</li>
</ul>

<p> </p>
<p id="rfc.section.1.8.p.4">Report single message as spam; no identified parts; server deletes the message.  </p>

<ul class="empty">
<li>C: Z080 SREP SET SEQ 6</li>
<li>S: Z080 OK [DELETED] SREP Completed.</li>
</ul>

<p> </p>
<p id="rfc.section.1.8.p.5">Report single message as spam; no identified parts; client requests explicitly to delete the message, server deletes the message as the client requested.  </p>

<ul class="empty">
<li>C: Z100 SREP SET SEQ 4 DO DELETE NIL</li>
<li>S: Z100 OK [DELETED] SREP Completed.</li>
</ul>

<p> </p>
<h1 id="rfc.section.1.9">
<a href="#rfc.section.1.9">1.9.</a> Examples to report messages as no longer spam</h1>
<p id="rfc.section.1.9.p.1">Report single message as no longer spam; no identified parts; server only clears the appropriate flags from the message.  </p>

<ul class="empty">
<li>C: Z020 SREP CLEAR SEQ 10</li>
<li>S: A020 OK [KEYWORD -$OMAEVVM10-spam-user-identified] SREP Completed.</li>
</ul>

<p> </p>
<p id="rfc.section.1.9.p.2">Report single message as no longer spam; earlier the header and body were identified as spam; the server clears the appropriate flags.  </p>

<ul class="empty">
<li>C: Z040 SREP CLEAR SEQ 9</li>
<li>S: A040 OK [KEYWORD (-$OMAEVVM10-spam-user-identified-field.from -$OMAEVVM10-spam-user-identified-body.2)] SREP Completed.</li>
</ul>

<p> </p>
<p id="rfc.section.1.9.p.3">Report single message as no longer spam; no identified parts; server moves the message (may set/clear flags, too but that is irrelevant because the client will need to reconcile anyway).  </p>

<ul class="empty">
<li>C: Z060 SREP CLEAR SEQ 8</li>
<li>S: A060 OK [RELOCATED] SREP Completed.</li>
</ul>

<p> </p>
<h1 id="rfc.section.1.10">
<a href="#rfc.section.1.10">1.10.</a> Example flows</h1>
<p id="rfc.section.1.10.p.1">The new command specified in this document allows a client to save significant bandwidth by sending only reference(s) instead of full-blown spam reports that most if the time include the entire message.  By doing so, the responsibility of recording metadata and handling the message designated as spam has been shifted to the server side.  It is not the purpose of IMAP servers to deal with various aspects of spam reporting, such as creating and storing metadata, making the metadata available when new messages arrive, etc.  IMAP servers should take advantage of an aggregator service and perform the exchanges related to spam reporting in the background, delegating the work to the aggregator service.  Spam aggregator services are expected to collect and store metadata in very large volumes, evaluate the stored metadata and support queries to decide whether an incoming message is a spam or not.  Open Mobile Alliance (OMA) specified the <a href="#OMA-SPAMREP">[OMA-SPAMREP]</a> enabler release that supports deploying such aggregator services.  </p>
<p id="rfc.section.1.10.p.2">The flows in the following sub-sections illustrate informative examples for various scenarios that may be triggered by the SREP command defined in <a href="#Command">Section 1</a>.  </p>
<h1 id="rfc.section.1.10.1">
<a href="#rfc.section.1.10.1">1.10.1.</a> The server simply flags a message</h1>
<div id="#rfc.figure.2"></div>
<p></p>

<ol>
<li>The user finds a voicemail that he/she deems to be spam.</li>
<li>He invokes the appropriate functions on the client to report the message as spam.</li>
<li>The client reports the spam using the appropriate command to the server: SREP SET SEQ 10</li>
<li>The server prepares the message referenced by the command for inquiry.</li>
<li>The server queries its internal database for precedence.</li>
<li>The server gets a 'not found' response from the internal database.</li>
<li>The server queries an external database for precedence, such as an aggregator service based on <a href="#OMA-SPAMREP">[OMA-SPAMREP]</a>.</li>
<li>The server gets a 'not found' response from the external database as well.</li>
<li>No records of the message are found; the server prepares the message to be recorded for future reference.</li>
<li>The server reports the message as spam to its internal database.</li>
<li>The server gets an 'ok' response from the internal database.</li>
<li>The server reports the message as spam to external database, such as an aggregator service based on <a href="#OMA-SPAMREP">[OMA-SPAMREP]</a>.</li>
<li>The server gets an 'ok' response from the external database.</li>
<li>The server checks the user's preferences and finds no guidance about handing the spam, so</li>
<li>... it checks the service provider policies - and yet again, finds no instructions.</li>
<li>In the end, lacking any sort of guidance, the end the server stores a keyword for the message, and</li>
<li>... informs that client about that using the appropriate response: OK [KEYWORD +$OMAEVVM10-spam-user-identified] Completed.</li>
<li>The client updates its representation of the voicemail repository and</li>
<li>... the message turns red on the user interface.</li>
<li>The user cheers.</li>
</ol>

<p> </p>

<p></p>
<pre>

User     Client     Server     Server    Aggregator
                                 DB      Service DB
 |----      |          |          |          |
 |    | 1   |          |          |          |
 |&lt;---      |          |          |          |
 |    2     |          |          |          |
 |---------&gt;|    3     |          |          |
 |          |---------&gt;|          |          |
 |          |          |----      |          |
 |          |          |    | 4   |          |
 |          |          |&lt;---      |          |
 |          |          |    5     |          |
 |          |          |---------&gt;|          |
 |          |          |    6     |          |
 |          |          |&lt;---------|          |
 |          |          |          7          |
 |          |          |--------------------&gt;|
 |          |          |          8          |
 |          |          |&lt;--------------------|
 |          |          |----      |          |
 |          |          |    | 9   |          |
 |          |          |&lt;---      |          |
 |          |          |    10    |          |
 |          |          |---------&gt;|          |
 |          |          |    11    |          |
 |          |          |&lt;---------|          |
 |          |          |          12         |
 |          |          |--------------------&gt;|
 |          |          |          13         |
 |          |          |&lt;--------------------|
 |          |          |----      |          |
 |          |          |    | 14  |          |
 |          |          |&lt;---      |          |
 |          |          |----      |          |
 |          |          |    | 15  |          |
 |          |          |&lt;---      |          |
 |          |          |----      |          |
 |          |          |    | 16  |          |
 |          |    17    |&lt;---      |          |
 |          |&lt;---------|          |          |
 |          |----      |          |          |
 |          |    |  18 |          |          |
 |    19    |&lt;---      |          |          |
 |&lt;---------|          |          |          |
 |----      |          |          |          |
 |    | 20  |          |          |          |
 |&lt;---      |          |          |          |
 |          |          |          |          |
 
</pre>
<p></p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.2.p.1">The author acknowledges and appreciates the work and comments from Josh Soref, Gaelle Martin-Cocher, Suresh Chitturi, Clara Severino and Christophe Le Thierry D'Ennequin.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.3.p.1">This document constitutes registration of the SREP capability in the imap4-capabilities registry.  </p>
<p id="rfc.section.3.p.2">SREP command directives are registered by publishing a standards track or IESG-approved experimental RFC.  The registry is currently located at: http://www.iana.org/assignments/spam-directive-registry </p>
<p id="rfc.section.3.p.3">SREP command abuse types are registered by publishing a standards track or IESG-approved experimental RFC.  The registry is currently located at: http://www.iana.org/assignments/spam-abuse-type-registry </p>
<p id="rfc.section.3.p.4">SREP command reference types are registered by publishing a standards track or IESG-approved experimental RFC.  The registry is currently located at: http://www.iana.org/assignments/spam-reference-type-registry </p>
<p id="rfc.section.3.p.5">All registries are case insensitive.  </p>
<div id="#rfc.figure.3"></div>
<p id="rfc.section.3.p.6">This document constitutes the following registrations with IANA: </p>

<p></p>
<pre>

      IMAP SREP Directive Registry

      Directive           Reference
      ---------           ---------
      SET                 [this document]
      CLEAR               [this document]
 
</pre>
<p></p>
<div id="#rfc.figure.4"></div>
<p></p>
<pre>

      IMAP SREP Abuse Type Registry

      Abuse Type                       Reference
      ----------                       ---------
      1 - Phishing                     [this document]
      2 - Malware                      [this document]
 
</pre>
<p></p>
<div id="#rfc.figure.5"></div>
<p></p>
<pre>

      IMAP SREP Reference Type Registry

      Reference Type      Reference
      --------------      ---------------
      UID                 [this document]
      SEQ                 [this document]
      URLAUTH             [this document]
 
</pre>
<p></p>
<p id="rfc.section.3.p.7">Note to RFC Editor: replace "[this document]" with the RFC number before publication.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.4.p.1">When an aggregator service is actively involved in a deployment, the service provider MUST ensure that: </p>

<ul class="empty">
<li>- a mutual trust relation is in place between the IMAP server and the aggregator service, and,</li>
<li>- the aggregator service does not leak any information.</li>
</ul>

<p> </p>
<p id="rfc.section.4.p.2">See additional security considerations in <a href="#IMAP4">[IMAP4]</a> and <a href="#URLAUTH">[URLAUTH]</a>, respectively.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">5.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">5.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="ABNF">[ABNF]</b></td>
<td class="top">
<a href="mailto:dcrocker@bbiw.net" title="Brandenburg InternetWorking">Crocker, D.</a> and <a href="mailto:dcrocker@bbiw.net" title="THUS plc.">P. Overell</a>, "<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>", RFC 5234, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="IMAP4">[IMAP4]</b></td>
<td class="top">
<a href="mailto:MRC@CAC.Washington.EDU" title="Networks and Distributed Computing, University of Washington">Crispin, M.</a>, "<a href="http://tools.ietf.org/html/rfc3501">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>", RFC 3501, March 2003.</td>
</tr>
<tr>
<td class="reference"><b id="URLAUTH">[URLAUTH]</b></td>
<td class="top">
<a href="mailto:MRC@CAC.Washington.EDU" title="Networks and Distributed Computing, University of Washington">Crispin, M.</a>, "<a href="http://tools.ietf.org/html/rfc4467">Internet Message Access Protocol (IMAP) - URLAUTH Extension</a>", RFC 4467, May 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">5.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="REPORT">[REPORT]</b></td>
<td class="top">
<a href="mailto:GregV@ieee.org" title="Lucent Technologies">Vaudreuil, G.</a>, "<a href="http://tools.ietf.org/html/rfc3462">The Multipart/Report Content Type for the Reporting of Mail System Administrative Messages</a>", RFC 3462, January 2003.</td>
</tr>
<tr>
<td class="reference"><b id="OMA-SPAMREP">[OMA-SPAMREP]</b></td>
<td class="top">
<a>Open Mobile Alliance</a>, "<a>Mobile Spam Reporting 1.0, OMA-ERP-SpamRep-V1_0</a>", .</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Zoltan Ordogh</span> 
	  <span class="n hidden">
		<span class="family-name">Ordogh</span>
	  </span>
	</span>
	<span class="org vcardline">Research In Motion Limited</span>
	<span class="adr">
	  <span>1875 Buckhorn Gate</span>

	  <span class="vcardline">
		<span class="locality">Mississauga</span>,  
		<span class="region">Ontario</span> 
		<span class="code">L4W 5P1</span>
	  </span>
	  <span class="country-name vcardline">Canada</span>
	</span>
	<span class="vcardline">Phone: +19056294746x15674</span>

<span class="vcardline">EMail: <a href="mailto:zordogh@rim.com">zordogh@rim.com</a></span>

  </address>
</div>

</body>
</html>