service-type-with-NA = srvtype-string "." NA-string
restricted-string    = DIGIT / ALPHA / "+" / "-"
srvtype-string       = 1*restricted-string
NA-string            = 1*restricted-string

SL_LIFETIME_DEFAULT = 0xFFFF,   /* use CONFIG_INTERVAL_1 */
SL_LIFETIME_NONE = 0            /* register indefinitely */
SL_CHAR_ASCII = 3, SL_CHAR_LATIN1 = 4, SL_CHAR_UTF8 = 6
SL_TYPE_RESULT = 1, SL_ATTR_RESULT = 2, SL_SRV_RESULT = 3,
SL_SCOPE_RESULT = 4
SL_STR_VAL = 1, SL_INT_VAL = 2,  SL_OPAQUE_VAL = 3,
SL_BOOL_VAL = 4
SLP_OK                     = 0,
SLP_LANG_NOT_SUPPORTED     = 0x01,
SLP_PROTOCOL_PARSE_ERR     = 0x02,
SLP_INVALID_REGISTRATION   = 0x03,
SLP_SCOPE_NOT_SUPPORTED    = 0x04,
SLP_CHARSET_NOT_UNDERSTOOD = 0x05,
SLP_AUTHENTICATION_INVALID = 0x06,

SLP_NOT_SUPPORTED_YET            = 0x10,
SLP_REQUEST_TIMED_OUT            = 0x11,
SLP_COULD_NOT_INIT_NET_RESOURCES = 0x12,
SLP_COULD_NOT_ALLOCATE_MEMORY    = 0x13,
SLP_PARAMETER_BAD                = 0x14,
SLP_INTERNAL_NET_ERROR           = 0x15,
SLP_INTERNAL_SYSTEM_ERROR        = 0x16
SL_Srv_IgnoreCache    = 0x01, /* Will ignore UA caches            */
SL_Srv_DoNotResolve   = 0x02, /* Will not resolve URL domain name */
                                   /* to struct sockaddr_in            */
SL_Srv_ForceMulticast = 0x04  /* Will not use DA, will multicast  */
err = SL_Register(
            sh,                              /* supply the SrvHandle   */
            "service:http://myhost.sun.com", /* supply the URL         */
            "en", 0,                         /* reg in English         */
            CHAR_ASCII,                      /* reg in UTF8            */
            "(SCOPE=ENGINEERING),"           /* declare attributes     */
            "(HOME PAGES="
              "schedule/index.html::Schedule::"
                 "This site contains updated time lines for all the work in"
                 "the F.L.O.R.B. project,"
              "snort/releases.html::Bob Snort's Home::"
                 "Release engineer Bob posts results of all the builds here,"
              "specs/index.html::Specs galore::"
                 "Technical specifications for the F.L.O.R.B. and X872"
                 "projects.)",
               SL_LIFETIME_DEFAULT);          /* use default lifetime   */

pr = SL_GetService(sh, "http/engineering/HOME PAGE ="
              "specs/index.html::Specs galore::"
                 "Technical specifications for the F.L.O.R.B. and X872"
                 "projects./");

white = SPACE / TAB / CR / LF

query = listquery /         ; conjunction query
              generalquery /      ; complex query
              *white              ; ie. the query matches everything

predicate   = srvtype [ "." na ] "/" scope "/" query "/"

schemechar  = DIGIT / ALPHA / "+" / "-"

srvtype     = 1*schemechar

na          = 1*schemechar
                      ; omit na when it is "IANA", the default

scope       = ; Any string with the following restrictions:
                    ; "/", ",", and ":" are not allowed in this
                    ; string. "LOCAL" and "REMOTE" scope strings are
                    ; reserved.

safe-char   = ; Any character with the following restrictions:
                    ; "(", ")", ",", "=", "!", ">", "<", "/", "*"
                    ; are not allowed.  They must be escaped (see
                    ; Section 6.3.1.).

attr-tag    = 1*safe-char

safer-char  = ; As safe-char but SPACE is also not allowed.

keyword     = 1*safer-char

query-item  =  keyword / attr-tag comp-op value

comp-op     = "!=" / "==" / "<" / "<=" / ">" / ">="

value       = string / integer / boolean / opaque / partial-str

string      = 1*safe-char

integer     = [-] 1*DIGIT
                      ; The integer MUST fall within the range of
                      ; values a 32 bit integer may take, ie.
                      ; "-2147483648" to "2147483647".

boolean     = "TRUE" / "FALSE"
                      ; These values are the only exception to the
                      ; Internationalization rules in Section 8.0.
                      ; Independent of the translation of the
                      ; attributes, the boolean values remain the
                      ; indicated strings.

rad64-char  = ALPHA / DIGIT / "+" / "-" / white-sp

opaque      = 1*DIGIT ":" 4*rad64-char
                      ; The digits define the original length of the
                      ; opaque value. The restricted character string
                      ; is the radix-64 encoding of the opaque value.
                      ; See [RFC 1521], Section 5.2.

                      ; NOTE:  White space is ignored in decoding
                      ; radix-64 values.

partial-str = ["*"] string ["*"]
                      ; If preceded by a "*", it matches all string
                      ; values ending with the string.  If followed
                      ; by a "*", it matches all string values which
                      ; begin with the string.  If both followed and
                      ; preceded by a "*", it matches all string
                      ; values which contain the string.  Refer to
                      ; section 3.8 for examples.

list-query = 1#query-item

general-query   = "(" "&" general-query query-item-list ")" /
                        "(" "|" general-query query-item-list ")" /
                        "(" query-item ")"

query-item-list = general-query /
                        general-query query-item-list


attr-reg-list = 1#attr-reg
attr-reg      = keyword / "(" attr-tag = 1#value ")

attr-dereg-list = 1#attr-dereg
attr-dereg      = keyword / attr-tag

attr_select_list = 1#attr-select
attr_select      = keyword / attr-tag / partial-tag
partial_tag      = 1*safe-char "*"

config-file    = [discovery-opts] [policy] [timing]

discovery-opts = [da-discovery] [scope-discovery]

da-discovery   = "DA-DISCOVERY" "=" *disc-opts CRLF

disc-opts      = ["NO-DYNAMIC"] /
                       ["DHCP"]       /
                       ["STATIC"]     /
                       ["STRICT"]

scope-discovery= "SCOPE-DISCOVERY" "=" *disc-opts CRLF

da-list        = "DA" "=" da-def *(break da-def) CRLF

da-def         = fqdn /
                       dotted-decimal-ipv4 /
                       dotted-decimal-ipv6

break          = CRLF 1*SPACE
                       ; Note - terms not beginning on the first
                       ; column of the configuration file are
                       ; considered continuations of a pervious
                       ; configuration parameter's definition.

scope-list     = "SCOPE" "=" scope-def *(break scope-def) CRLF

scope-chars    = ALPHA / DIGIT / "+" / "-"

scope-def      = 1*scope-chars

policy         = *policy-options

policy-options = ["USE-BROADCAST" CRLF]  /
                       ["MULTICAST-RADIUS" "=" radius] /
                       ["MTU" "=" size]

radius         = 1..32
                     ; That is, an integer from 1 to 32

size           = *DIGIT
                     ; This is the maximum transmission unit for
                     ; the link layer used.  The recommended default
                     ; for SLP is 1400.
timing         = *timing-opts
timing-opts    = ["TIME-0-CACHE-REPLIES" "=" seconds] /
                       ["TIME-1-REG-LIFETIME"  "=" seconds] /
                       ["TIME-2-RETRY-MCAST-Q" "=" times]   /
                       ["TIME-3-WAIT-MCAST-Q"  "=" seconds] /
                       ["TIME-4-WAIT-REGISTER" "=" seconds] /
                       ["TIME-5-RETRY-DA-DISC" "=" times]   /
                       ["TIME-6-QUIT-DA-WAIT"  "=" seconds] /
                       ["TIME-7-QUIT-DA-DISC"  "=" seconds] /
                       ["TIME-8-QUIT-SA-Q"     "=" seconds] /
                       ["TIME-9-DA-HEARTBEAT"  "=" seconds] /
                       ["TIME-10-WAIT-REG-DA-PASSIVE" "=" seconds] /
                       ["TIME-11-WAIT-REG-DA-ACTIVE"  "=" seconds] /
                       ["TIME-12-QUIT-IDLE-CONNECTS"  "=" seconds]
                     ; Please refer to [SLP] for the definitions of
                     ; these configuration options.

