<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Server Identity Verification in Application Protocols</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Server Identity Verification in Application Protocols">
<meta name="keywords" content="Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">None</td><td class="header">P. Saint-Andre</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Cisco</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">K. Zeilenga</td></tr>
<tr><td class="header">Expires: April 5, 2010</td><td class="header">Isode Limited</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">J. Hodges</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">PayPal</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">R. Morgan</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Internet2</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 02, 2009</td></tr>
</table></td></tr></table>
<h1><br />Server Identity Verification in Application Protocols<br />draft-saintandre-tls-server-id-check-02</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 5, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>Technologies such as Transport Layer Security (TLS) and IPsec enable a secure connection between two entities (a "client" and a "server") using X.509 certificates.  This document specifies recommended procedures for checking the identity of the server in such an interaction.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#conventions">2.</a>&nbsp;
Conventions<br />
<a href="#verify">3.</a>&nbsp;
Verification Process<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#verify-overview">3.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#verify-rules">3.2.</a>&nbsp;
Comparison Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#verify-rules-domain">3.2.1.</a>&nbsp;
Domain Names<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#verify-rules-ip">3.2.2.</a>&nbsp;
IP Addresses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#verify-rules-email">3.2.3.</a>&nbsp;
Email Addresses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#verify-rules-sip">3.2.4.</a>&nbsp;
SIP Addresses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#verify-rules-xmpp">3.2.5.</a>&nbsp;
XMPP Addresses<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#verify-outcome">3.3.</a>&nbsp;
Outcome<br />
<a href="#security">4.</a>&nbsp;
Security Considerations<br />
<a href="#iana">5.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">6.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">6.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">6.2.</a>&nbsp;
Informative References<br />
<a href="#prior">Appendix&nbsp;A.</a>&nbsp;
Prior Art<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#prior-imap">A.1.</a>&nbsp;
IMAP, POP3, and ACAP (1999)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#prior-http">A.2.</a>&nbsp;
HTTP (2000)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#prior-ldap">A.3.</a>&nbsp;
LDAP (2000/2006)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#prior-smtp">A.4.</a>&nbsp;
SMTP (2002/2007)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#prior-xmpp">A.5.</a>&nbsp;
XMPP (2004)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#prior-nntp">A.6.</a>&nbsp;
NNTP (2006)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#prior-netconf">A.7.</a>&nbsp;
NETCONF (2006/2009)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#prior-syslog">A.8.</a>&nbsp;
Syslog (2009)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#prior-sip">A.9.</a>&nbsp;
SIP (2009)<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Technologies such as Transport Layer Security <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> and <a class='info' href='#IPSEC'>[IPSEC]<span> (</span><span class='info'>Kent, S. and K. Seo, &ldquo;Security Architecture for the Internet Protocol,&rdquo; December&nbsp;2005.</span><span>)</span></a> enable a secure connection between two entities using the Internet X.509 Public Key Infrastructure (PKI) as described in <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.  In such interactions, the entity that initiates the connection is called a "client" and the entity that receives the connection is called a "server".
</p>
<p></p>
<blockquote class="text">
<p>Note: The terms "client" and "server" as used here refer to security roles, not application roles; a server in the context of TLS or IPSec might be a "client" (i.e., a user agent) in the context of an application protocol as deployed on the Internet.
</p>
</blockquote>

<p>If a client wishes to connect to a server securely, it needs to check the identity of the server so that it can determine if the server is what it claims to be, verify that there is no attacker in the middle, and enforce other relevant security considerations.  Typically this checking is done by correlating the information presented in the server's certificate with information available about the server contained in the Domain Name System (DNS) or provided by a human user.
</p>
<p>Different application protocols that make use of the client-server pattern for security purposes have traditionally specified their own procedures for checking server identities.  Examples include but are not limited to:
</p>
<p>
        </p>
<ul class="text">
<li>The Hypertext Transfer Protocol <a class='info' href='#HTTP'>[HTTP]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, for which see also <a class='info' href='#HTTP-TLS'>[HTTP&#8209;TLS]<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a>
</li>
<li>The Internet Message Access Protocol <a class='info' href='#IMAP'>[IMAP]<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a> and the Post Office Protocol <a class='info' href='#POP3'>[POP3]<span> (</span><span class='info'>Myers, J. and M. Rose, &ldquo;Post Office Protocol - Version 3,&rdquo; May&nbsp;1996.</span><span>)</span></a>, for which see also <a class='info' href='#USINGTLS'>[USINGTLS]<span> (</span><span class='info'>Newman, C., &ldquo;Using TLS with IMAP, POP3 and ACAP,&rdquo; June&nbsp;1999.</span><span>)</span></a>
</li>
<li>The Lightweight Directory Access Protocol <a class='info' href='#LDAP'>[LDAP]<span> (</span><span class='info'>Sermersheim, J., &ldquo;Lightweight Directory Access Protocol (LDAP): The Protocol,&rdquo; June&nbsp;2006.</span><span>)</span></a>, for which see also <a class='info' href='#LDAP-AUTH'>[LDAP&#8209;AUTH]<span> (</span><span class='info'>Harrison, R., &ldquo;Lightweight Directory Access Protocol (LDAP): Authentication Methods and Security Mechanisms,&rdquo; June&nbsp;2006.</span><span>)</span></a> and its predecessor <a class='info' href='#LDAP-TLS'>[LDAP&#8209;TLS]<span> (</span><span class='info'>Hodges, J., Morgan, R., and M. Wahl, &ldquo;Lightweight Directory Access Protocol (v3): Extension for Transport Layer Security,&rdquo; May&nbsp;2000.</span><span>)</span></a>
</li>
<li>The NETCONF Configuration Protocol <a class='info' href='#NETCONF'>[NETCONF]<span> (</span><span class='info'>Enns, R., &ldquo;NETCONF Configuration Protocol,&rdquo; December&nbsp;2006.</span><span>)</span></a>, for which see also <a class='info' href='#NETCONF-SSH'>[NETCONF&#8209;SSH]<span> (</span><span class='info'>Wasserman, M. and T. Goddard, &ldquo;Using the NETCONF Configuration Protocol over Secure SHell (SSH),&rdquo; December&nbsp;2006.</span><span>)</span></a> and <a class='info' href='#NETCONF-TLS'>[NETCONF&#8209;TLS]<span> (</span><span class='info'>Badra, M., &ldquo;NETCONF over Transport Layer Security (TLS),&rdquo; May&nbsp;2009.</span><span>)</span></a>
</li>
<li>The Network News Transfer Protocol <a class='info' href='#NNTP'>[NNTP]<span> (</span><span class='info'>Feather, C., &ldquo;Network News Transfer Protocol (NNTP),&rdquo; October&nbsp;2006.</span><span>)</span></a>, for which see also <a class='info' href='#NNTP-TLS'>[NNTP&#8209;TLS]<span> (</span><span class='info'>Murchison, K., Vinocur, J., and C. Newman, &ldquo;Using Transport Layer Security (TLS) with Network News Transfer Protocol (NNTP),&rdquo; October&nbsp;2006.</span><span>)</span></a>
</li>
<li>The Session Initiation Protocol <a class='info' href='#SIP'>[SIP]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, for which see also <a class='info' href='#SIP-CERTS'>[SIP&#8209;CERTS]<span> (</span><span class='info'>Gurbani, V., Lawrence, S., and B. Laboratories, &ldquo;Domain Certificates in the Session Initiation Protocol (SIP),&rdquo; May&nbsp;2009.</span><span>)</span></a>
</li>
<li>The Simple Mail Transfer Protocol <a class='info' href='#SMTP'>[SMTP]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a>, for which see also <a class='info' href='#SMTP-AUTH'>[SMTP&#8209;AUTH]<span> (</span><span class='info'>Siemborski, R. and A. Melnikov, &ldquo;SMTP Service Extension for Authentication,&rdquo; July&nbsp;2007.</span><span>)</span></a> and <a class='info' href='#SMTP-TLS'>[SMTP&#8209;TLS]<span> (</span><span class='info'>Hoffman, P., &ldquo;SMTP Service Extension for Secure SMTP over Transport Layer Security,&rdquo; February&nbsp;2002.</span><span>)</span></a>
</li>
<li>The Syslog Protocol <a class='info' href='#SYSLOG'>[SYSLOG]<span> (</span><span class='info'>Gerhards, R., &ldquo;The Syslog Protocol,&rdquo; March&nbsp;2009.</span><span>)</span></a>, for which see also <a class='info' href='#SYSLOG-TLS'>[SYSLOG&#8209;TLS]<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a>
</li>
<li>The Extensible Messaging and Presence Protocol <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a>, for which see also <a class='info' href='#XMPPBIS'>[XMPPBIS]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; September&nbsp;2009.</span><span>)</span></a>
</li>
</ul><p>
      
</p>
<p>Unfortunately, this divergence of approaches has caused some confusion among developers and protocol designers.  Therefore this document specifies recommended identity checking procedures for application protocols produced within the Internet Standards Process, for the purpose of codifying secure authentication practices.
</p>
<p>Note: This document is currently limited in scope to the presentation of identities in X.509 certificates as issued in the context of the Public Key Infrastructure (PKI) and as applied to Transport Layer Security <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a>; a future version of this document might address X.509 certificates as issued outside the context of the PKI, non-X.509 public keys such as OpenPGP keys, presentation of identities in ways other than in the certificate itself (e.g., certificate fingerprints for Secure Shell as described in <a class='info' href='#SSH'>[SSH]<span> (</span><span class='info'>Ylonen, T. and C. Lonvick, &ldquo;The Secure Shell (SSH) Protocol Architecture,&rdquo; January&nbsp;2006.</span><span>)</span></a> or for Datagram Transport Layer Security DTLS and Secure Real-time Transport Protocol as described in <a class='info' href='#DTLS-SRTP'>[DTLS&#8209;SRTP]<span> (</span><span class='info'>McGrew, D. and E. Rescorla, &ldquo;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for  Secure Real-time Transport Protocol (SRTP),&rdquo; February&nbsp;2009.</span><span>)</span></a>), and applications that use security technologies other than TLS.
</p>
<a name="conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions</h3>

<p>The following capitalized keywords are to be interpreted as described in <a class='info' href='#TERMS'>[TERMS]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>: "MUST", "SHALL", "REQUIRED"; "MUST NOT", "SHALL NOT"; "SHOULD", "RECOMMENDED"; "SHOULD NOT", "NOT RECOMMENDED"; "MAY", "OPTIONAL".
</p>
<p>Most security-related terms are to be understood in the sense defined in <a class='info' href='#SECTERMS'>[SECTERMS]<span> (</span><span class='info'>Shirey, R., &ldquo;Internet Security Glossary, Version 2,&rdquo; August&nbsp;2007.</span><span>)</span></a>; such terms include, but are not limited to, "attack", "authentication", "authorization", "certificate", "credential", "fingerprint", "identity", "self-signed certificate", "trust", "trust anchor", "trust chain", "validate", and "verify".
</p>
<p>In addition, we define the following terms to assist in understanding the process of verifying server identity:
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>identity set:</dt>
<dd>The set of identities that are presented by the server to the client (in the form of the server's X.509 certificate) when the client attempts to establish a secure connection to the server.
</dd>
<dt>identity type:</dt>
<dd>The "natural kind" of identity to which a presented identity or reference identity belongs.  For example, the reference identity might be a domain name, an IPv4 or IPv6 address, an email address, a SIP address, an XMPP address, or some other type (this specification does not yet provide a complete taxonomy of identity types).  In the case of domain names, the reference identity MUST NOT contain the wildcard character '*' (ASCII 42) in the left-most (least significant) domain name component or component fragment.
</dd>
<dt>presented identity:</dt>
<dd>A single member of the identity set.
</dd>
<dt>reference identity:</dt>
<dd>The client's conception of the server's identity before it attempts to establish a secure connection to the server, i.e. the identity that the client expects the server to present and to which the client makes reference when attempting to verify the server's identity.  It is either the address to which the client connected or the explicit value of the TLS "server_name" extension as specified in <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a>.   The reference identity might be based on a DNS lookup, user configuration, or some other mechanism.
</dd>
</dl></blockquote><p>
      
</p>
<a name="verify"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Verification Process</h3>

<p>When a client connects to a server, it MUST verify the server's identity in order to prevent certain passive and active attacks against the connection.  By "verify identity" we mean that the client needs to establish that at least one of the presented identities matches the reference identity.
</p>
<a name="verify-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Overview</h3>

<p>At a high level, the client verifies the server identity in accordance with the following rules:
</p>
<p>
          </p>
<ol class="text">
<li>Before connecting to the server, the client determines the identity type of the reference identity.
</li>
<li>During the process of attempting to establish a secure connection, the server MUST present its identity set to the client in the form of an X.509 certificate <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</li>
<li>Upon being presented with the server's identity set, the client MUST check the reference identity against the presented identities for the purpose of finding a match.  To do so, the client iterates through all of the subjectAltName extensions it recognizes in the server's certificate (potentially in an application-specific preference order) and compares the value of each extension against the reference identity until it has either produced a match or exhausted the identities in the identity set (comparison rules for matching particular identity types are provided under <a class='info' href='#verify-rules'>Section&nbsp;3.2<span> (</span><span class='info'>Comparison Rules</span><span>)</span></a>, including fallbacks to several subjectName fields).
</li>
<li>Before attempting to find a match in relation to a particular presented identity, the client MAY map the reference identity to a different identity type.  Such a mapping MAY be performed for any available subjectAltName type to which the reference identity can be mapped; however, the reference identity SHOULD be mapped only to types for which the mapping is either inherently secure (e.g., extracting the DNS name from a URI to compare with a subjectAltName of type dNSName or SRVName) or for which the mapping is performed in a secure manner (e.g., using <a class='info' href='#DNSSEC'>[DNSSEC]<span> (</span><span class='info'>Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;DNS Security Introduction and Requirements,&rdquo; March&nbsp;2005.</span><span>)</span></a>, or using a user-configured or admin-configured lookup table for host-to-address or address-to-host translations).
</li>
<li>If the identity set has more than one member, a match with any of the presented identities is acceptable.
</li>
</ol><p>
        
</p>
<p></p>
<blockquote class="text">
<p>Note: Beyond the server identity check described in this section, clients might complete further checking to ensure that the server is authorized to provide the service it is requested to provide.  The client might need to make use of local policy information in making this determination.
</p>
</blockquote>

<a name="verify-rules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Comparison Rules</h3>

<a name="verify-rules-domain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
Domain Names</h3>

<p>If the reference identity is a domain name as defined by <a class='info' href='#RFC1034'>[RFC1034]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - concepts and facilities,&rdquo; November&nbsp;1987.</span><span>)</span></a> and <a class='info' href='#RFC1035'>[RFC1035]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a> for "traditional" domain names or by <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> for internationalized domain names, then the client can match the reference identity against subjectAltName extensions of type dNSName and SRVName <a class='info' href='#SRVNAME'>[SRVNAME]<span> (</span><span class='info'>Santesson, S., &ldquo;Internet X.509 Public Key Infrastructure Subject Alternative Name for Expression of Service Name,&rdquo; August&nbsp;2007.</span><span>)</span></a> according to the following rules.
</p>
<p>If the reference identity is a "traditional" domain name, then matching of reference identity against the presented identity is performed by comparing the set of domain components using a case-insensitive ASCII comparison.
</p>
<p>If the reference identity is an internationalized domain name, then an implementation MUST convert the reference identity to the ASCII Compatible Encoding (ACE) format as specified in Section 4 of <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> before comparison with subjectAltName values of type dNSName; specifically, the conversion operation specified in Section 4 of <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> MUST be performed as follows:
</p>
<p>
            </p>
<ul class="text">
<li>In step 1, the domain name SHALL be considered a "stored string".
</li>
<li>In step 3, set the flag called "UseSTD3ASCIIRules".
</li>
<li>In step 4, process each label with the "ToASCII" operation.
</li>
<li>In step 5, change all label separators to U+002E (full stop).
</li>
</ul><p>
          
</p>
<p>After performing the "to-ASCII" conversion with regard to an internationalized domain name, the DNS labels and names MUST be compared for equality according to the rules specified in Section 3 of <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>.
</p>
<p>Unless otherwise specified by an application protocol, the dNSName MAY contain one instance of the wildcard character '*'.  The wildcard character applies only to the left-most domain name component and matches any single component (thus a dNSName of *.example.com matches foo.example.com but not bar.foo.example.com or example.com itself).  The wildcard character is not allowed in component fragments (thus a dNSName of baz*.example.net is not allowed and shall not be taken to match baz1.example.net and baz2.example.net).
</p>
<p>In addition to checking the subjectAltName extensions of type dNSName and SRVNAME, the client MAY as a fallback check the value of the Common Name (CN) (see <a class='info' href='#LDAP-SCHEMA'>[LDAP&#8209;SCHEMA]<span> (</span><span class='info'>Sciberras, A., &ldquo;Lightweight Directory Access Protocol (LDAP): Schema for User Applications,&rdquo; June&nbsp;2006.</span><span>)</span></a>) as presented in the subjectName component of the server's X.509 certificate.  In existing certificates, the CN is often used for encapsulating a domain name; for example, consider the following subjectName:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
cn=www.example.com, ou=Web Services, c=GB
</pre></div>
<p>Here the Common Name is "www.example.com" and the client could choose to compare the reference identity against that CN.
</p>
<p>When comparing the referenced identity against the Common Name, the client MUST follow the comparison rules described above for subjectAltName extensions of type dNSName and SRVName, with the exception that no wildcard matching is allowed.
</p>
<p>In order to match domain names, a client MUST NOT check Relative Distinguished Names (RDNs) other than the Common Name; in particular, this means that a series of Domain Component (DC) attributes MUST NOT be checked (because the order of Domain Components is not guaranteed, certain attacks are possible if DC attributes are checked).
</p>
<a name="verify-rules-ip"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
IP Addresses</h3>

<p>If the reference identity is an IP address as defined by <a class='info' href='#IP'>[IP]<span> (</span><span class='info'>Postel, J., &ldquo;Internet Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> or <a class='info' href='#IPv6'>[IPv6]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>, then the client can match the reference identity against subjectAltName extensions of type iPaddress according to the following rules.
</p>
<p>The reference identity MUST be converted to the "network byte order" octet string representation; for IP Version 4 the octet string will contain exactly four octets, and for IP Version 6 the octet string will contain exactly sixteen octets.  The client then compares this octet string, where a match occurs if the reference identity and presented identity octet strings are identical.
</p>
<a name="verify-rules-email"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.3"></a><h3>3.2.3.&nbsp;
Email Addresses</h3>

<p>If the reference identity is an email address as defined by <a class='info' href='#EMAIL'>[EMAIL]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>, then the client SHOULD compare the reference identity against the value of the "rfc822Name" subjectAltName extension described in <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</p>
<p>The client MAY also compare the reference identity against the value of the "E" attribute of the subjectName as described in <a class='info' href='#CRMF'>[CRMF]<span> (</span><span class='info'>Schaad, J., &ldquo;Internet X.509 Public Key Infrastructure Certificate Request Message Format (CRMF),&rdquo; September&nbsp;2005.</span><span>)</span></a>.
</p>
<a name="verify-rules-sip"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.4"></a><h3>3.2.4.&nbsp;
SIP Addresses</h3>

<p>If the reference identity is a SIP address as defined by <a class='info' href='#SIP'>[SIP]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, then the client SHOULD compare map the reference identity to a domain name or email address and proceed as described for those identity types, or proceed as described in <a class='info' href='#SIP-CERTS'>[SIP&#8209;CERTS]<span> (</span><span class='info'>Gurbani, V., Lawrence, S., and B. Laboratories, &ldquo;Domain Certificates in the Session Initiation Protocol (SIP),&rdquo; May&nbsp;2009.</span><span>)</span></a>.
</p>
<a name="verify-rules-xmpp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.5"></a><h3>3.2.5.&nbsp;
XMPP Addresses</h3>

<p>If the reference identity is an XMPP address ("JabberID") as defined by <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a>, then the client SHOULD compare the reference identity against the value of the following subjectAltName extensions, in this order: SRVName, dNSName, and (as defined in <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a>) "id-on-xmppAddr".
</p>
<a name="verify-outcome"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Outcome</h3>

<p>The outcome of the checking procedure is one of the following:
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt>Case #1:</dt>
<dd>The client finds at least one presented identity that matches the reference identity; the entity MUST use this as the validated identity of the server.
</dd>
<dt>Case #2:</dt>
<dd>The client finds no subjectAltName that matches the reference identity but a human user has permanently accepted the certificate during a previous connection attempt; the client MUST verify that the cached certificate was presented and MUST notify the user if the certificate has changed since the last time that a secure connection was successfully negotiated.
</dd>
<dt>Case #3:</dt>
<dd>The client finds no subjectAltName that matches the reference identity and a human user has not permanently accepted the certificate during a previous connection attempt; the client MUST NOT use the presented identity (if any) as the validated identity of the server and instead MUST proceed as described in the next section.  Instead, if the client is a user-oriented application, then it MUST either (1) automatically terminate the connection with a bad certificate error or (2) show the certificate (including the entire certificate chain) to the user and give the user the choice of terminating the connecting or accepting the certificate temporarily (i.e., for this connection attempt only) or permanently (i.e., for all future connection attempts) and then continuing with the connection; if a user permanently accepts a certificate in this way, the client MUST cache the certificate (or some non-forgeable representation such as a hash value) and in future connection attempts behave as in Case #2.  (It is the resposibility of the human user to verify the hash value or fingerprint of the certificate with the peer over a trusted communication layer.)  If the client is an automated application, then it SHOULD terminate the connection with a bad certificate error and log the error to an appropriate audit log; an automated application MAY provide a configuration setting that disables this check, but MUST provide a setting that enables the check.
</dd>
</dl></blockquote><p>
        
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>This entire document discusses security.
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>This document has no actions for the IANA.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="IDNA">[IDNA]</a></td>
<td class="author-text">Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;<a href="http://tools.ietf.org/html/rfc3490">Internationalizing Domain Names in Applications (IDNA)</a>,&rdquo; RFC&nbsp;3490, March&nbsp;2003 (<a href="ftp://ftp.isi.edu/in-notes/rfc3490.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IP">[IP]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc791">Internet Protocol</a>,&rdquo; STD&nbsp;5, RFC&nbsp;791, September&nbsp;1981 (<a href="ftp://ftp.isi.edu/in-notes/rfc791.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IPv6">[IPv6]</a></td>
<td class="author-text"><a href="mailto:deering@cisco.com">Deering, S.</a> and <a href="mailto:hinden@iprg.nokia.com">R. Hinden</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>,&rdquo; RFC&nbsp;2460, December&nbsp;1998 (<a href="ftp://ftp.isi.edu/in-notes/rfc2460.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2460.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2460.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TERMS">[TERMS]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="X509">[X509]</a></td>
<td class="author-text">Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;5280, May&nbsp;2008 (<a href="ftp://ftp.isi.edu/in-notes/rfc5280.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CRMF">[CRMF]</a></td>
<td class="author-text">Schaad, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4211">Internet X.509 Public Key Infrastructure Certificate Request Message Format (CRMF)</a>,&rdquo; RFC&nbsp;4211, September&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4211.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="DNSSEC">[DNSSEC]</a></td>
<td class="author-text">Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;<a href="http://tools.ietf.org/html/rfc4033">DNS Security Introduction and Requirements</a>,&rdquo; RFC&nbsp;4033, March&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4033.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="DTLS-SRTP">[DTLS-SRTP]</a></td>
<td class="author-text">McGrew, D. and E. Rescorla, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-avt-dtls-srtp-07.txt">Datagram Transport Layer Security (DTLS) Extension to Establish Keys for  Secure Real-time Transport Protocol (SRTP)</a>,&rdquo; draft-ietf-avt-dtls-srtp-07 (work in progress), February&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-avt-dtls-srtp-07.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="EMAIL">[EMAIL]</a></td>
<td class="author-text"><a href="mailto:presnick@qualcomm.com">Resnick, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc5322">Internet Message Format</a>,&rdquo; RFC&nbsp;5322, October&nbsp;2008 (<a href="ftp://ftp.isi.edu/in-notes/rfc5322.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc5322.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc5322.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="HTTP">[HTTP]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2616.txt">TXT</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc2616.ps">PS</a>, <a href="ftp://ftp.isi.edu/in-notes/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="HTTP-TLS">[HTTP-TLS]</a></td>
<td class="author-text">Rescorla, E., &ldquo;<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>,&rdquo; RFC&nbsp;2818, May&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2818.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IMAP">[IMAP]</a></td>
<td class="author-text">Crispin, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3501">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>,&rdquo; RFC&nbsp;3501, March&nbsp;2003 (<a href="ftp://ftp.isi.edu/in-notes/rfc3501.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IPSEC">[IPSEC]</a></td>
<td class="author-text">Kent, S. and K. Seo, &ldquo;<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>,&rdquo; RFC&nbsp;4301, December&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4301.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="LDAP">[LDAP]</a></td>
<td class="author-text">Sermersheim, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4511">Lightweight Directory Access Protocol (LDAP): The Protocol</a>,&rdquo; RFC&nbsp;4511, June&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4511.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="LDAP-AUTH">[LDAP-AUTH]</a></td>
<td class="author-text">Harrison, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4513">Lightweight Directory Access Protocol (LDAP): Authentication Methods and Security Mechanisms</a>,&rdquo; RFC&nbsp;4513, June&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4513.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="LDAP-SCHEMA">[LDAP-SCHEMA]</a></td>
<td class="author-text">Sciberras, A., &ldquo;<a href="http://tools.ietf.org/html/rfc4519">Lightweight Directory Access Protocol (LDAP): Schema for User Applications</a>,&rdquo; RFC&nbsp;4519, June&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4519.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="LDAP-TLS">[LDAP-TLS]</a></td>
<td class="author-text">Hodges, J., Morgan, R., and M. Wahl, &ldquo;<a href="http://tools.ietf.org/html/rfc2830">Lightweight Directory Access Protocol (v3): Extension for Transport Layer Security</a>,&rdquo; RFC&nbsp;2830, May&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2830.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="NETCONF">[NETCONF]</a></td>
<td class="author-text">Enns, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4741">NETCONF Configuration Protocol</a>,&rdquo; RFC&nbsp;4741, December&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4741.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="NETCONF-SSH">[NETCONF-SSH]</a></td>
<td class="author-text">Wasserman, M. and T. Goddard, &ldquo;<a href="http://tools.ietf.org/html/rfc4742">Using the NETCONF Configuration Protocol over Secure SHell (SSH)</a>,&rdquo; RFC&nbsp;4742, December&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4742.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="NETCONF-TLS">[NETCONF-TLS]</a></td>
<td class="author-text">Badra, M., &ldquo;<a href="http://tools.ietf.org/html/rfc5539">NETCONF over Transport Layer Security (TLS)</a>,&rdquo; RFC&nbsp;5539, May&nbsp;2009 (<a href="ftp://ftp.isi.edu/in-notes/rfc5539.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="NNTP">[NNTP]</a></td>
<td class="author-text">Feather, C., &ldquo;<a href="http://tools.ietf.org/html/rfc3977">Network News Transfer Protocol (NNTP)</a>,&rdquo; RFC&nbsp;3977, October&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc3977.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="NNTP-TLS">[NNTP-TLS]</a></td>
<td class="author-text">Murchison, K., Vinocur, J., and C. Newman, &ldquo;<a href="http://tools.ietf.org/html/rfc4642">Using Transport Layer Security (TLS) with Network News Transfer Protocol (NNTP)</a>,&rdquo; RFC&nbsp;4642, October&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4642.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="POP3">[POP3]</a></td>
<td class="author-text"><a href="mailto:jgm+@cmu.edu">Myers, J.</a> and <a href="mailto:mrose@dbc.mtview.ca.us">M. Rose</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1939">Post Office Protocol - Version 3</a>,&rdquo; STD&nbsp;53, RFC&nbsp;1939, May&nbsp;1996 (<a href="ftp://ftp.isi.edu/in-notes/rfc1939.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1034">[RFC1034]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1034">Domain names - concepts and facilities</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1034, November&nbsp;1987 (<a href="ftp://ftp.isi.edu/in-notes/rfc1034.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1035">[RFC1035]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1035, November&nbsp;1987 (<a href="ftp://ftp.isi.edu/in-notes/rfc1035.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2459">[RFC2459]</a></td>
<td class="author-text"><a href="mailto:housley@spyrus.com">Housley, R.</a>, <a href="mailto:wford@verisign.com">Ford, W.</a>, <a href="mailto:wpolk@nist.gov">Polk, T.</a>, and <a href="mailto:david.solo@citicorp.com">D. Solo</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2459">Internet X.509 Public Key Infrastructure Certificate and CRL Profile</a>,&rdquo; RFC&nbsp;2459, January&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2459.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SECTERMS">[SECTERMS]</a></td>
<td class="author-text">Shirey, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4949">Internet Security Glossary, Version 2</a>,&rdquo; RFC&nbsp;4949, August&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc4949.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP">[SIP]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP-CERTS">[SIP-CERTS]</a></td>
<td class="author-text">Gurbani, V., Lawrence, S., and B. Laboratories, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-domain-certs-04.txt">Domain Certificates in the Session Initiation Protocol (SIP)</a>,&rdquo; draft-ietf-sip-domain-certs-04 (work in progress), May&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-domain-certs-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SMTP">[SMTP]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://tools.ietf.org/html/rfc5321">Simple Mail Transfer Protocol</a>,&rdquo; RFC&nbsp;5321, October&nbsp;2008 (<a href="ftp://ftp.isi.edu/in-notes/rfc5321.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SMTP-AUTH">[SMTP-AUTH]</a></td>
<td class="author-text">Siemborski, R. and A. Melnikov, &ldquo;<a href="http://tools.ietf.org/html/rfc4954">SMTP Service Extension for Authentication</a>,&rdquo; RFC&nbsp;4954, July&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc4954.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SMTP-TLS">[SMTP-TLS]</a></td>
<td class="author-text">Hoffman, P., &ldquo;<a href="http://tools.ietf.org/html/rfc3207">SMTP Service Extension for Secure SMTP over Transport Layer Security</a>,&rdquo; RFC&nbsp;3207, February&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3207.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SRVNAME">[SRVNAME]</a></td>
<td class="author-text">Santesson, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4985">Internet X.509 Public Key Infrastructure Subject Alternative Name for Expression of Service Name</a>,&rdquo; RFC&nbsp;4985, August&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc4985.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SSH">[SSH]</a></td>
<td class="author-text">Ylonen, T. and C. Lonvick, &ldquo;<a href="http://tools.ietf.org/html/rfc4251">The Secure Shell (SSH) Protocol Architecture</a>,&rdquo; RFC&nbsp;4251, January&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4251.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SYSLOG">[SYSLOG]</a></td>
<td class="author-text">Gerhards, R., &ldquo;<a href="http://tools.ietf.org/html/rfc5424">The Syslog Protocol</a>,&rdquo; RFC&nbsp;5424, March&nbsp;2009 (<a href="ftp://ftp.isi.edu/in-notes/rfc5424.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SYSLOG-TLS">[SYSLOG-TLS]</a></td>
<td class="author-text">Miao, F., Ma, Y., and J. Salowey, &ldquo;<a href="http://tools.ietf.org/html/rfc5425">Transport Layer Security (TLS) Transport Mapping for Syslog</a>,&rdquo; RFC&nbsp;5425, March&nbsp;2009 (<a href="ftp://ftp.isi.edu/in-notes/rfc5425.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TLS">[TLS]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008 (<a href="ftp://ftp.isi.edu/in-notes/rfc5246.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="USINGTLS">[USINGTLS]</a></td>
<td class="author-text"><a href="mailto:chris.newman@innosoft.com">Newman, C.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2595">Using TLS with IMAP, POP3 and ACAP</a>,&rdquo; RFC&nbsp;2595, June&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2595.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP">[XMPP]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3920">Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; RFC&nbsp;3920, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3920.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3920.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3920.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPPBIS">[XMPPBIS]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-xmpp-3920bis-02.txt">Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; draft-ietf-xmpp-3920bis-02 (work in progress), September&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-xmpp-3920bis-02.txt">TXT</a>).</td></tr>
</table>

<a name="prior"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Prior Art</h3>

<p>This section is non-normative.
</p>
<p>The recommendations in this document are an abstraction from recommendations in specifications for a wide range of application protocols.  For the purpose of comparison and to delineate the history of thinking about server identity verification within the IETF, this informative section gathers together prior art by including the exact text from various RFCs (the only modifications are changes to the names of several references to maintain coherence with the main body of this document, and the elision of irrelevant text as marked by the characters "[...]").
</p>
<a name="prior-imap"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
IMAP, POP3, and ACAP (1999)</h3>

<p>In 1999, <a class='info' href='#USINGTLS'>[USINGTLS]<span> (</span><span class='info'>Newman, C., &ldquo;Using TLS with IMAP, POP3 and ACAP,&rdquo; June&nbsp;1999.</span><span>)</span></a> specified the following text regarding server identity verification in IMAP, POP3, and ACAP:
</p>
<p>######
</p>
<p>2.4. Server Identity Check
</p>
<p>During the TLS negotiation, the client MUST check its understanding of the server hostname against the server's identity as presented in the server Certificate message, in order to prevent man-in-the-middle attacks.  Matching is performed according to these rules:
</p>
<p>
          </p>
<ul class="text">
<li>The client MUST use the server hostname it used to open the connection as the value to compare against the server name as expressed in the server certificate.  The client MUST NOT use any form of the server hostname derived from an insecure remote source (e.g., insecure DNS lookup).  CNAME canonicalization is not done.
</li>
<li>If a subjectAltName extension of type dNSName is present in the certificate, it SHOULD be used as the source of the server's identity.
</li>
<li>Matching is case-insensitive.
</li>
<li>A "*" wildcard character MAY be used as the left-most name component in the certificate.  For example, *.example.com would match a.example.com, foo.example.com, etc. but would not match example.com.
</li>
<li>If the certificate contains multiple names (e.g. more than one dNSName field), then a match with any one of the fields is considered acceptable.
</li>
</ul><p>
        
</p>
<p>If the match fails, the client SHOULD either ask for explicit user confirmation, or terminate the connection and indicate the server's identity is suspect.
</p>
<p>######
</p>
<a name="prior-http"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
HTTP (2000)</h3>

<p>In 2000, <a class='info' href='#HTTP-TLS'>[HTTP&#8209;TLS]<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> specified the following text regarding server identity verification in HTTP:
</p>
<p>######
</p>
<p>3.1. Server Identity
</p>
<p>In general, HTTP/TLS requests are generated by dereferencing a URI.  As a consequence, the hostname for the server is known to the client.  If the hostname is available, the client MUST check it against the server's identity as presented in the server's Certificate message, in order to prevent man-in-the-middle attacks.
</p>
<p>If the client has external information as to the expected identity of the server, the hostname check MAY be omitted. (For instance, a client may be connecting to a machine whose address and hostname are dynamic but the client knows the certificate that the server will present.) In such cases, it is important to narrow the scope of acceptable certificates as much as possible in order to prevent man in the middle attacks.  In special cases, it may be appropriate for the client to simply ignore the server's identity, but it must be understood that this leaves the connection open to active attack.
</p>
<p>If a subjectAltName extension of type dNSName is present, that MUST be used as the identity. Otherwise, the (most specific) Common Name field in the Subject field of the certificate MUST be used. Although the use of the Common Name is existing practice, it is deprecated and Certification Authorities are encouraged to use the dNSName instead.
</p>
<p>Matching is performed using the matching rules specified by <a class='info' href='#RFC2459'>[RFC2459]<span> (</span><span class='info'>Housley, R., Ford, W., Polk, T., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and CRL Profile,&rdquo; January&nbsp;1999.</span><span>)</span></a>.  If more than one identity of a given type is present in the certificate (e.g., more than one dNSName name, a match in any one of the set is considered acceptable.) Names may contain the wildcard character * which is considered to match any single domain name component or component fragment. E.g., *.a.com matches foo.a.com but not bar.foo.a.com. f*.com matches foo.com but not bar.com.
</p>
<p>In some cases, the URI is specified as an IP address rather than a hostname. In this case, the iPAddress subjectAltName must be present in the certificate and must exactly match the IP in the URI.
</p>
<p>If the hostname does not match the identity in the certificate, user oriented clients MUST either notify the user (clients MAY give the user the opportunity to continue with the connection in any case) or terminate the connection with a bad certificate error. Automated clients MUST log the error to an appropriate audit log (if available) and SHOULD terminate the connection (with a bad certificate error).  Automated clients MAY provide a configuration setting that disables this check, but MUST provide a setting which enables it.
</p>
<p>Note that in many cases the URI itself comes from an untrusted source. The above-described check provides no protection against attacks where this source is compromised. For example, if the URI was obtained by clicking on an HTML page which was itself obtained without using HTTP/TLS, a man in the middle could have replaced the URI.  In order to prevent this form of attack, users should carefully examine the certificate presented by the server to determine if it meets their expectations.
</p>
<p>######
</p>
<a name="prior-ldap"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
LDAP (2000/2006)</h3>

<p>In 2000, <a class='info' href='#LDAP-TLS'>[LDAP&#8209;TLS]<span> (</span><span class='info'>Hodges, J., Morgan, R., and M. Wahl, &ldquo;Lightweight Directory Access Protocol (v3): Extension for Transport Layer Security,&rdquo; May&nbsp;2000.</span><span>)</span></a> specified the following text regarding server identity verification in LDAP:
</p>
<p>######
</p>
<p>3.6. Server Identity Check
</p>
<p>The client MUST check its understanding of the server's hostname against the server's identity as presented in the server's Certificate message, in order to prevent man-in-the-middle attacks.
</p>
<p>Matching is performed according to these rules:
</p>
<p>
          </p>
<ul class="text">
<li>The client MUST use the server hostname it used to open the LDAP connection as the value to compare against the server name as expressed in the server's certificate.  The client MUST NOT use the server's canonical DNS name or any other derived form of name.
</li>
<li>If a subjectAltName extension of type dNSName is present in the certificate, it SHOULD be used as the source of the server's identity.
</li>
<li>Matching is case-insensitive.
</li>
<li>The "*" wildcard character is allowed.  If present, it applies only to the left-most name component.
</li>
</ul><p>
        
</p>
<p>E.g. *.bar.com would match a.bar.com, b.bar.com, etc. but not bar.com.  If more than one identity of a given type is present in the certificate (e.g. more than one dNSName name), a match in any one of the set is considered acceptable.
</p>
<p>If the hostname does not match the dNSName-based identity in the certificate per the above check, user-oriented clients SHOULD either notify the user (clients MAY give the user the opportunity to continue with the connection in any case) or terminate the connection and indicate that the server's identity is suspect. Automated clients SHOULD close the connection, returning and/or logging an error indicating that the server's identity is suspect.
</p>
<p>Beyond the server identity checks described in this section, clients SHOULD be prepared to do further checking to ensure that the server is authorized to provide the service it is observed to provide. The client MAY need to make use of local policy information.
</p>
<p>######
</p>
<p>In 2006, <a class='info' href='#LDAP-AUTH'>[LDAP&#8209;AUTH]<span> (</span><span class='info'>Harrison, R., &ldquo;Lightweight Directory Access Protocol (LDAP): Authentication Methods and Security Mechanisms,&rdquo; June&nbsp;2006.</span><span>)</span></a> specified the following text regarding server identity verification in LDAP:
</p>
<p>######
</p>
<p>3.1.3. Server Identity Check
</p>
<p>In order to prevent man-in-the-middle attacks, the client MUST verify the server's identity (as presented in the server's Certificate message).  In this section, the client's understanding of the server's identity (typically the identity used to establish the transport connection) is called the "reference identity".
</p>
<p>The client determines the type (e.g., DNS name or IP address) of the reference identity and performs a comparison between the reference identity and each subjectAltName value of the corresponding type until a match is produced.  Once a match is produced, the server's identity has been verified, and the server identity check is complete.  Different subjectAltName types are matched in different ways.  Sections 3.1.3.1 - 3.1.3.3 explain how to compare values of various subjectAltName types.
</p>
<p>The client may map the reference identity to a different type prior to performing a comparison.  Mappings may be performed for all available subjectAltName types to which the reference identity can be mapped; however, the reference identity should only be mapped to types for which the mapping is either inherently secure (e.g., extracting the DNS name from a URI to compare with a subjectAltName of type dNSName) or for which the mapping is performed in a secure manner (e.g., using DNSSEC, or using user- or admin-configured host-to-address/address-to-host lookup tables).
</p>
<p>The server's identity may also be verified by comparing the reference identity to the Common Name (CN) <a class='info' href='#LDAP-SCHEMA'>[LDAP&#8209;SCHEMA]<span> (</span><span class='info'>Sciberras, A., &ldquo;Lightweight Directory Access Protocol (LDAP): Schema for User Applications,&rdquo; June&nbsp;2006.</span><span>)</span></a> value in the leaf Relative Distinguished Name (RDN) of the subjectName field of the server's certificate.  This comparison is performed using the rules for comparison of DNS names in Section 3.1.3.1, below, with the exception that no wildcard matching is allowed.  Although the use of the Common Name value is existing practice, it is deprecated, and Certification Authorities are encouraged to provide subjectAltName values instead.  Note that the TLS implementation may represent DNs in certificates according to X.500 or other conventions.  For example, some X.500 implementations order the RDNs in a DN using a left-to-right (most significant to least significant) convention instead of LDAP's right-to-left convention.
</p>
<p>If the server identity check fails, user-oriented clients SHOULD either notify the user (clients may give the user the opportunity to continue with the LDAP session in this case) or close the transport connection and indicate that the server's identity is suspect.  Automated clients SHOULD close the transport connection and then return or log an error indicating that the server's identity is suspect or both.
</p>
<p>Beyond the server identity check described in this section, clients should be prepared to do further checking to ensure that the server is authorized to provide the service it is requested to provide.  The client may need to make use of local policy information in making this determination.
</p>
<p>3.1.3.1. Comparison of DNS Names
</p>
<p>If the reference identity is an internationalized domain name, conforming implementations MUST convert it to the ASCII Compatible Encoding (ACE) format as specified in Section 4 of RFC 3490 <a class='info' href='#IDNA'>[IDNA]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> before comparison with subjectAltName values of type dNSName.  Specifically, conforming implementations MUST perform the conversion operation specified in Section 4 of RFC 3490 as follows:
</p>
<p>
          </p>
<ul class="text">
<li>in step 1, the domain name SHALL be considered a "stored string";
</li>
<li>in step 3, set the flag called "UseSTD3ASCIIRules";
</li>
<li>in step 4, process each label with the "ToASCII" operation; and
</li>
<li>in step 5, change all label separators to U+002E (full stop).
</li>
</ul><p>
        
</p>
<p>After performing the "to-ASCII" conversion, the DNS labels and names MUST be compared for equality according to the rules specified in Section 3 of RFC3490.
</p>
<p>The '*' (ASCII 42) wildcard character is allowed in subjectAltName values of type dNSName, and then only as the left-most (least significant) DNS label in that value.  This wildcard matches any left-most DNS label in the server name.  That is, the subject *.example.com matches the server names a.example.com and b.example.com, but does not match example.com or a.b.example.com.
</p>
<p>3.1.3.2. Comparison of IP Addresses
</p>
<p>When the reference identity is an IP address, the identity MUST be converted to the "network byte order" octet string representation <a class='info' href='#IP'>[IP]<span> (</span><span class='info'>Postel, J., &ldquo;Internet Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> <a class='info' href='#IPv6'>[IPv6]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>.  For IP Version 4, as specified in RFC 791, the octet string will contain exactly four octets.  For IP Version 6, as specified in RFC 2460, the octet string will contain exactly sixteen octets.  This octet string is then compared against subjectAltName values of type iPAddress.  A match occurs if the reference identity octet string and value octet strings are identical.
</p>
<p>3.1.3.3. Comparison of Other subjectName Types
</p>
<p>Client implementations MAY support matching against subjectAltName values of other types as described in other documents.
</p>
<p>######
</p>
<a name="prior-smtp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
SMTP (2002/2007)</h3>

<p>In 2002, <a class='info' href='#SMTP-TLS'>[SMTP&#8209;TLS]<span> (</span><span class='info'>Hoffman, P., &ldquo;SMTP Service Extension for Secure SMTP over Transport Layer Security,&rdquo; February&nbsp;2002.</span><span>)</span></a> specified the following text regarding server identity verification in SMTP:
</p>
<p>######
</p>
<p>4.1 Processing After the STARTTLS Command
</p>
<p>[...]
</p>
<p>The decision of whether or not to believe the authenticity of the other party in a TLS negotiation is a local matter.  However, some general rules for the decisions are:
</p>
<p>
          </p>
<ul class="text">
<li>A SMTP client would probably only want to authenticate an SMTP server whose server certificate has a domain name that is the domain name that the client thought it was connecting to.
</li>
</ul><p>
        
</p>
<p>[...]
</p>
<p>######
</p>
<p>In 2006, <a class='info' href='#SMTP-AUTH'>[SMTP&#8209;AUTH]<span> (</span><span class='info'>Siemborski, R. and A. Melnikov, &ldquo;SMTP Service Extension for Authentication,&rdquo; July&nbsp;2007.</span><span>)</span></a> specified the following text regarding server identity verification in SMTP:
</p>
<p>######
</p>
<p>14. Additional Requirements When Using SASL PLAIN over TLS
</p>
<p>[...]
</p>
<p>After a successful <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> negotiation, the client MUST check its understanding of the server hostname against the server's identity as presented in the server Certificate message, in order to prevent man-in-the-middle attacks.  If the match fails, the client MUST NOT attempt to authenticate using the SASL PLAIN mechanism.  Matching is performed according to the following rules:
</p>
<p>
          </p>
<blockquote class="text">
<p>The client MUST use the server hostname it used to open the connection as the value to compare against the server name as expressed in the server certificate.  The client MUST NOT use any form of the server hostname derived from an insecure remote source (e.g., insecure DNS lookup).  CNAME canonicalization is not done.
</p>
<p>If a subjectAltName extension of type dNSName is present in the certificate, it SHOULD be used as the source of the server's identity.
</p>
<p>Matching is case-insensitive.
</p>
<p>A "*" wildcard character MAY be used as the leftmost name component in the certificate.  For example, *.example.com would match a.example.com, foo.example.com, etc., but would not match example.com.
</p>
<p>If the certificate contains multiple names (e.g., more than one dNSName field), then a match with any one of the fields is considered acceptable.
</p>
</blockquote><p>
        
</p>
<p>######
</p>
<a name="prior-xmpp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.5"></a><h3>A.5.&nbsp;
XMPP (2004)</h3>

<p>In 2004, <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> specified the following text regarding server identity verification in XMPP:
</p>
<p>######
</p>
<p>14.2. Certificate Validation
</p>
<p>When an XMPP peer communicates with another peer securely, it MUST validate the peer's certificate.  There are three possible cases:
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt>Case #1:</dt>
<dd>The peer contains an End Entity certificate which appears to be certified by a chain of certificates terminating in a trust anchor (as described in Section 6.1 of <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>).
</dd>
<dt>Case #2:</dt>
<dd>The peer certificate is certified by a Certificate Authority not known to the validating peer.
</dd>
<dt>Case #3:</dt>
<dd>The peer certificate is self-signed.
</dd>
</dl></blockquote><p>
        
</p>
<p>In Case #1, the validating peer MUST do one of two things:
          </p>
<ol class="text">
<li>Verify the peer certificate according to the rules of <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.  The certificate SHOULD then be checked against the expected identity of the peer following the rules described in <a class='info' href='#HTTP-TLS'>[HTTP&#8209;TLS]<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a>, except that a subjectAltName extension of type "xmpp" MUST be used as the identity if present.  If one of these checks fails, user-oriented clients MUST either notify the user (clients MAY give the user the opportunity to continue with the connection in any case) or terminate the connection with a bad certificate error.  Automated clients SHOULD terminate the connection (with a bad certificate error) and log the error to an appropriate audit log.  Automated clients MAY provide a configuration setting that disables this check, but MUST provide a setting that enables it.
</li>
<li>The peer SHOULD show the certificate to a user for approval, including the entire certificate chain.  The peer MUST cache the certificate (or some non-forgeable representation such as a hash).  In future connections, the peer MUST verify that the same certificate was presented and MUST notify the user if it has changed.
</li>
</ol><p>
        
</p>
<p>In Case #2 and Case #3, implementations SHOULD act as in (2) above.
</p>
<p>######
</p>
<p>As of this writing, <a class='info' href='#XMPPBIS'>[XMPPBIS]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; September&nbsp;2009.</span><span>)</span></a> specified updated text regarding server identity verification in XMPP.  However, that specification has not yet been approved by the IESG, and the relevant text might be replaced by a reference to this document.
</p>
<a name="prior-nntp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.6"></a><h3>A.6.&nbsp;
NNTP (2006)</h3>

<p>In 2006, <a class='info' href='#NNTP-TLS'>[NNTP&#8209;TLS]<span> (</span><span class='info'>Murchison, K., Vinocur, J., and C. Newman, &ldquo;Using Transport Layer Security (TLS) with Network News Transfer Protocol (NNTP),&rdquo; October&nbsp;2006.</span><span>)</span></a> specified the following text regarding server identity verification in NNTP:
</p>
<p>######
</p>
<p>5. Security Considerations
</p>
<p>[...]
</p>
<p>During the TLS negotiation, the client MUST check its understanding of the server hostname against the server's identity as presented in the server Certificate message, in order to prevent man-in-the-middle attacks.  Matching is performed according to these rules:
</p>
<p>
          </p>
<ul class="text">
<li>The client MUST use the server hostname it used to open the connection (or the hostname specified in TLS "server_name" extension <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a>) as the value to compare against the server name as expressed in the server certificate.  The client MUST NOT use any form of the server hostname derived from an insecure remote source (e.g., insecure DNS lookup).  CNAME canonicalization is not done.
</li>
<li>If a subjectAltName extension of type dNSName is present in the certificate, it SHOULD be used as the source of the server's identity.
</li>
<li>Matching is case-insensitive.
</li>
<li>A "*" wildcard character MAY be used as the left-most name component in the certificate.  For example, *.example.com would match a.example.com, foo.example.com, etc., but would not match example.com.
</li>
<li>If the certificate contains multiple names (e.g., more than one dNSName field), then a match with any one of the fields is considered acceptable.
</li>
</ul><p>
        
</p>
<p>If the match fails, the client SHOULD either ask for explicit user confirmation or terminate the connection with a QUIT command and indicate the server's identity is suspect.
</p>
<p> Additionally, clients MUST verify the binding between the identity of the servers to which they connect and the public keys presented by those servers.  Clients SHOULD implement the algorithm in Section 6 of <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> for general certificate validation, but MAY supplement that algorithm with other validation methods that achieve equivalent levels of verification (such as comparing the server certificate against a local store of already-verified certificates and identity bindings).
</p>
<p>######
</p>
<a name="prior-netconf"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.7"></a><h3>A.7.&nbsp;
NETCONF (2006/2009)</h3>

<p>In 2006, <a class='info' href='#NETCONF-SSH'>[NETCONF&#8209;SSH]<span> (</span><span class='info'>Wasserman, M. and T. Goddard, &ldquo;Using the NETCONF Configuration Protocol over Secure SHell (SSH),&rdquo; December&nbsp;2006.</span><span>)</span></a> specified the following text regarding server identity verification in NETCONF:
</p>
<p>######
</p>
<p>6. Security Considerations
</p>
<p>The identity of the server MUST be verified and authenticated by the client according to local policy before password-based authentication data or any configuration or state data is sent to or received from the server.  The identity of the client MUST also be verified and authenticated by the server according to local policy to ensure that the incoming client request is legitimate before any configuration or state data is sent to or received from the client.  Neither side should establish a NETCONF over SSH connection with an unknown, unexpected, or incorrect identity on the opposite side.
</p>
<p>######
</p>
<p>In 2009, <a class='info' href='#NETCONF-TLS'>[NETCONF&#8209;TLS]<span> (</span><span class='info'>Badra, M., &ldquo;NETCONF over Transport Layer Security (TLS),&rdquo; May&nbsp;2009.</span><span>)</span></a> specified the following text regarding server identity verification in NETCONF:
</p>
<p>######
</p>
<p>3.1. Server Identity
</p>
<p>During the TLS negotiation, the client MUST carefully examine the certificate presented by the server to determine if it meets the client's expectations.  Particularly, the client MUST check its understanding of the server hostname against the server's identity as presented in the server Certificate message, in order to prevent man- in-the-middle attacks.
</p>
<p>Matching is performed according to the rules below (following the example of <a class='info' href='#NNTP-TLS'>[NNTP&#8209;TLS]<span> (</span><span class='info'>Murchison, K., Vinocur, J., and C. Newman, &ldquo;Using Transport Layer Security (TLS) with Network News Transfer Protocol (NNTP),&rdquo; October&nbsp;2006.</span><span>)</span></a>):
</p>
<p>
          </p>
<ul class="text">
<li>The client MUST use the server hostname it used to open the connection (or the hostname specified in the TLS "server_name" extension <a class='info' href='#TLS'>[TLS]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a>) as the value to compare against the server name as expressed in the server certificate.  The client MUST NOT use any form of the server hostname derived from an insecure remote source (e.g., insecure DNS lookup).  CNAME canonicalization is not done.
</li>
<li>If a subjectAltName extension of type dNSName is present in the certificate, it MUST be used as the source of the server's identity.
</li>
<li>Matching is case-insensitive.
</li>
<li>A "*" wildcard character MAY be used as the leftmost name component in the certificate.  For example, *.example.com would match a.example.com, foo.example.com, etc., but would not match example.com.
</li>
<li>If the certificate contains multiple names (e.g., more than one dNSName field), then a match with any one of the fields is considered acceptable.
</li>
</ul><p>
        
</p>
<p>If the match fails, the client MUST either ask for explicit user confirmation or terminate the connection and indicate the server's identity is suspect.
</p>
<p>Additionally, clients MUST verify the binding between the identity of the servers to which they connect and the public keys presented by those servers.  Clients SHOULD implement the algorithm in Section 6 of <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> for general certificate validation, but MAY supplement that algorithm with other validation methods that achieve equivalent levels of verification (such as comparing the server certificate against a local store of already-verified certificates and identity bindings).
</p>
<p>If the client has external information as to the expected identity of the server, the hostname check MAY be omitted.
</p>
<p>######
</p>
<a name="prior-syslog"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.8"></a><h3>A.8.&nbsp;
Syslog (2009)</h3>

<p>In 2009, <a class='info' href='#SYSLOG-TLS'>[SYSLOG&#8209;TLS]<span> (</span><span class='info'>Miao, F., Ma, Y., and J. Salowey, &ldquo;Transport Layer Security (TLS) Transport Mapping for Syslog,&rdquo; March&nbsp;2009.</span><span>)</span></a> specified the following text regarding server identity verification in Syslog:
</p>
<p>######
</p>
<p>5.2. Subject Name Authorization
</p>
<p>Implementations MUST support certification path validation <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.  In addition, they MUST support specifying the authorized peers using locally configured host names and matching the name against the certificate as follows.
</p>
<p>
          </p>
<ul class="text">
<li>Implementations MUST support matching the locally configured host name against a dNSName in the subjectAltName extension field and SHOULD support checking the name against the common name portion of the subject distinguished name.
</li>
<li>The '*' (ASCII 42) wildcard character is allowed in the dNSName of the subjectAltName extension (and in common name, if used to store the host name), but only as the left-most (least significant) DNS label in that value.  This wildcard matches any left-most DNS label in the server name.  That is, the subject *.example.com matches the server names a.example.com and b.example.com, but does not match example.com or a.b.example.com.  Implementations MUST support wildcards in certificates as specified above, but MAY provide a configuration option to disable them.
</li>
<li>Locally configured names MAY contain the wildcard character to match a range of values.  The types of wildcards supported MAY be more flexible than those allowed in subject names, making it possible to support various policies for different environments.  For example, a policy could allow for a trust-root-based authorization where all credentials issued by a particular CA trust root are authorized.
</li>
<li>If the locally configured name is an internationalized domain name, conforming implementations MUST convert it to the ASCII Compatible Encoding (ACE) format for performing comparisons, as specified in Section 7 of <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</li>
<li>Implementations MAY support matching a locally configured IP address against an iPAddress stored in the subjectAltName extension.  In this case, the locally configured IP address is converted to an octet string as specified in <a class='info' href='#X509'>[X509]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>, Section 4.2.1.6.  A match occurs if this octet string is equal to the value of iPAddress in the subjectAltName extension.
</li>
</ul><p>
        
</p>
<p>######
</p>
<a name="prior-sip"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.9"></a><h3>A.9.&nbsp;
SIP (2009)</h3>

<p>As of this writing, <a class='info' href='#SIP-CERTS'>[SIP&#8209;CERTS]<span> (</span><span class='info'>Gurbani, V., Lawrence, S., and B. Laboratories, &ldquo;Domain Certificates in the Session Initiation Protocol (SIP),&rdquo; May&nbsp;2009.</span><span>)</span></a> specified text regarding server identity verification in SIP.  However, that specification has not yet been approved by the IESG, and the relevant text might be replaced by a reference to this document.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Peter Saint-Andre</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Peter.SaintAndre@WebEx.com">Peter.SaintAndre@WebEx.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kurt D. Zeilenga</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Isode Limited</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Kurt.Zeilenga@Isode.COM">Kurt.Zeilenga@Isode.COM</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jeff Hodges</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">PayPal</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Jeff.Hodges@KingsMountain.com">Jeff.Hodges@KingsMountain.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">RL 'Bob' Morgan</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UWashington/Internet2</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:rlmorgan@washington.edu">rlmorgan@washington.edu</a></td></tr>
</table>
</body></html>
