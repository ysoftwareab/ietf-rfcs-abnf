<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Public Key Cryptography Based User-to-User Authentication - (PKU2U)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Public Key Cryptography Based User-to-User Authentication - (PKU2U)">
<meta name="keywords" content="Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">NETWORK WORKING GROUP</td><td class="header">L. Zhu</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Microsoft Corporation</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">J. Altman</td></tr>
<tr><td class="header">Expires: January 2, 2009</td><td class="header">Secure Endpoints</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">N. Williams</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Sun</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 2008</td></tr>
</table></td></tr></table>
<h1><br />Public Key Cryptography Based User-to-User Authentication - (PKU2U)<br />draft-zhu-pku2u-07</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 2, 2009.</p>

<h3>Abstract</h3>

<p>This document defines a Generic Security Services
		Application Program Interface (GSS-API) mechanism based
		on Public Key Infrastructure (PKI) - PKU2U.  This
		mechanism is based on Kerberos V messages and the
		Kerberos V GSS-API mechanism, but without requiring a
		Kerberos Key Distribution Center (KDC).
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#introduction">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Conventions Used in This Document<br />
<a href="#pku2urealm">3.</a>&nbsp;
The PKU2U Realm Name<br />
<a href="#naming">4.</a>&nbsp;
PKU2U Principal Naming<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#name_DN">4.1.</a>&nbsp;
GSS_C_NT_DN<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#name_dNSName">4.2.</a>&nbsp;
GSS_C_NT_HOSTNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#name_iPAddress">4.3.</a>&nbsp;
GSS_C_NT_IP_ADDR<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#name_rfc822Name">4.4.</a>&nbsp;
GSS_C_NT_EMAIL_ADDR<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#name_user_name">4.5.</a>&nbsp;
GSS_C_NT_USER_NAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#name_krb5">4.6.</a>&nbsp;
GSS_KRB5_NT_PRINCIPAL_NAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#name_anon">4.7.</a>&nbsp;
GSS_C_NT_ANONYMOUS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#hostbased">4.8.</a>&nbsp;
Matching host-based
		service principal names to acceptor certificates<br />
<a href="#protocol">5.</a>&nbsp;
The Protocol Description and
	    the Context Establishment Tokens<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#as_req">5.1.</a>&nbsp;
Context token derived from
		KRB_AS_REQ<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#as_rep">5.2.</a>&nbsp;
Context token derived from
		KRB_AS_REP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ap_exchange">5.3.</a>&nbsp;
Context tokens imported from
		RFC4121<br />
<a href="#anchor2">6.</a>&nbsp;
Guidelines for Credentials Selection<br />
<a href="#seccons">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor3">8.</a>&nbsp;
Acknowledgements<br />
<a href="#iana">9.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">10.</a>&nbsp;
Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The Generic Security Services Application Programming
		Interface (GSS-API) is a generic protocol and API for
		providing authentication and session protection to
		applications.  It is generic in that it supports
		multiple authentication mechanisms.  Today there exists
		only one workable, widely deployed, standards-track
		GSS-API mechanism: the Kerberos V GSS-API mechanism
		<a class='info' href='#RFC1964'>[RFC1964]<span> (</span><span class='info'>Linn, J., &ldquo;The Kerberos Version 5 GSS-API Mechanism,&rdquo; June&nbsp;1996.</span><span>)</span></a> <a class='info' href='#RFC4121'>[RFC4121]<span> (</span><span class='info'>Zhu, L., Jaganathan, K., and S. Hartman, &ldquo;The Kerberos Version 5 Generic Security Service Application Program Interface (GSS-API) Mechanism: Version 2,&rdquo; July&nbsp;2005.</span><span>)</span></a>, which
		is based on Kerberos V <a class='info' href='#RFC4120'>[RFC4120]<span> (</span><span class='info'>Neuman, C., Yu, T., Hartman, S., and K. Raeburn, &ldquo;The Kerberos Network Authentication Service (V5),&rdquo; July&nbsp;2005.</span><span>)</span></a>.  There
		is a need to provide a GSS-API mechanism which does not
		require Kerberos V Key Distribution Center (KDC)
		infrastructure, and which supports the use of public key
		cryptography, particularly Public Key Infrastructure
		(PKI) <a class='info' href='#RFC3280'>[RFC3280]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>, including the use of
		public key certificates without a PKI.
</p>
<p>This document specifies such a mechanism: the Public Key
		User to User mechanism (PKU2U).
</p>
<p>PKU2U is based on building blocks taken from Kerberos V
		<a class='info' href='#RFC4120'>[RFC4120]<span> (</span><span class='info'>Neuman, C., Yu, T., Hartman, S., and K. Raeburn, &ldquo;The Kerberos Network Authentication Service (V5),&rdquo; July&nbsp;2005.</span><span>)</span></a>, PKINIT, <a class='info' href='#RFC4556'>[RFC4556]<span> (</span><span class='info'>Zhu, L. and B. Tung, &ldquo;Public Key Cryptography for Initial Authentication in Kerberos (PKINIT),&rdquo; June&nbsp;2006.</span><span>)</span></a> (which in turn uses PKI <a class='info' href='#RFC3280'>[RFC3280]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>) building blocks), and the
		Kerberos V GSS-API mechanism <a class='info' href='#RFC1964'>[RFC1964]<span> (</span><span class='info'>Linn, J., &ldquo;The Kerberos Version 5 GSS-API Mechanism,&rdquo; June&nbsp;1996.</span><span>)</span></a>
		<a class='info' href='#RFC4121'>[RFC4121]<span> (</span><span class='info'>Zhu, L., Jaganathan, K., and S. Hartman, &ldquo;The Kerberos Version 5 Generic Security Service Application Program Interface (GSS-API) Mechanism: Version 2,&rdquo; July&nbsp;2005.</span><span>)</span></a>.  In spite of using Kerberos V
		building blocks, PKU2U does not require any Kerberos V
		KDC infrastructure.  And though PKU2U also uses PKI
		building blocks, PKU2U can be used without a PKI by
		pre-sharing certificates and/or pre-associating
		name/certificate bindings.
</p>
<p>Therefore PKU2U can be used for true peer-to-peer
		authentication, as well as for PKI-based
		authentication.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions Used in This Document</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
		"SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",
		"MAY", and "OPTIONAL" in this document are to be
		interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>In this document, the GSS-API initiator or acceptor is
		referred to as the peer when the description is
		applicable to both the initiator and the acceptor.
</p>
<a name="pku2urealm"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
The PKU2U Realm Name</h3>

<p>The PKU2U realm name is defined as a reserved Kerberos
		realm name per <a class='info' href='#KRB-NAMING'>[KRB&#8209;NAMING]<span> (</span><span class='info'>Zhu, L., &ldquo;Additional Kerberos Naming Constraints,&rdquo; 2007.</span><span>)</span></a>, and it has
		the value of "WELLKNOWN:PKU2U".
</p>
<p>Unless otherwise specified, the realm name in any
		Kerberos message used by PKU2U is the PKU2U realm
		name.
</p>
<a name="naming"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
PKU2U Principal Naming</h3>

<p>PKU2U principal names are certificate names and subject
		alternative names <a class='info' href='#RFC3280'>[RFC3280]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a> as they
		appear in the certificate of any PKU2U peer, as well as
		any names agreed to out of band where a certificate
		authenticates a name that does not appear in the
		certificate.
</p>
<p>Thus certificates may be associated with multiple
		principal names.  This presents problems for the GSS-API
		bindings of a PKI-based mechanism.  We resolve these
		problems as follows:
</p>
<p>
		</p>
<ul class="text">
<li>We define multiple GSS-API name types
			corresponding to several GeneralName choices
			<a class='info' href='#RFC3280'>[RFC3280]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>, along with syntaxes,
			display forms, and exported name token formats
			for each.  For most of the name-types listed
			below the exported name token formats consists
			of a BER-encoded GeneralName with the usual
			exported name token header as per-RFC2743.  Two
			name-types are shared with the Kerberos V
			mechanism and use the Kerberos V mechanism's
			exported name token format.
</li>
<li>The cred_name of credential object acquired with
			a desired_name other than GSS_C_NT_NO_NAME MUST
			be equal to the name used as the
			desired_name.
</li>
<li>We provide that the cred_name of a default
			credential, or of a credential acquired with the
			GSS_C_NT_NO_NAME desired_name MUST be the first
			id-pkinit-san subject alternative name of the
			certificate, if there is one, or else it MUST be
			the DN of its certificate.
</li>
<li>We provide a method by which initiators can
			assert one of these names to the other, and we
			provide a default of asserting the certificate
			DN.  We also provide a method of asserting names
			that do not appear in the caller's certificate.
			This assertion consists of a traditional
			Kerberos V principal name appearing in the
			expected 'cname' fields of various Kerberos V
			PDUs used to construct PKU2U security context
			tokens, and an optional authorization-data type
			consisting of an integer which identifies one of
			the several names of the initiator's
			certificate.
</li>
<li>We provide a method of matching host-based
			service principal names to acceptor
			certificates, so that: a) initiators need not
			know the particulars of an acceptor's
			certificates' names a priori, b) acceptors can
			select a credential to accept a security context
			with that the initiator will accept.
</li>
</ul><p>
	    
</p>
<p>Thus GSS-API initiators that use the GSS_C_NO_NAME as the
		desired_name arguments of GSS_Acquire_cred() and
		GSS_Add_cred(), or GSS_C_NO_CREDENTIAL as the cred
		argument of GSS_Init_sec_context() will assert the
		selected certificate's DN, and that certificate's DN
		will be the name returned by GSS_Inquire_cred() and
		GSS_Inquire_cred_by_mech().
</p>
<p>And portable GSS-API initiator applications using
		GSS_C_NT_HOSTBASED_SERVICE for naming acceptors (i.e.,
		for importing a name to use as the targ_name input
		argument of GSS_Init_sec_context()) will have a
		reasonable chance of success in authenticating peers
		with certificates predating this specification.
</p>
<a name="name_DN"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
GSS_C_NT_DN</h3>

<p>We introduce a new name type, GSS_C_NT_DN, with OID
		    &lt;TBD&gt;, corresponding to the 'Name' ASN.1 type
		    defined in <a class='info' href='#RFC3280'>[RFC3280]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>.
</p>
<p>The query syntax and display form for names of this
		    type SHALL be as described in <a class='info' href='#RFC4514'>[RFC4514]<span> (</span><span class='info'>Zeilenga, K., &ldquo;Lightweight Directory Access Protocol (LDAP): String Representation of Distinguished Names,&rdquo; June&nbsp;2006.</span><span>)</span></a>.
</p>
<p>There is no reasonable way to canonicalize names of
		    this type without providing a directory against
		    which to lookup the name.  The canonical form of
		    this name is the same as that provided to
		    GSS_Import_name() with GSS_C_NT_DN as the
		    input_name_type.
</p>
<p>The exported name token format for names of this type
		    SHALL be the DER encoding of a GeneralName with
		    directoryName as the choice.
</p>
<p>Implementation support for this name type is
		    REQUIRED.
</p>
<a name="name_dNSName"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
GSS_C_NT_HOSTNAME</h3>

<p>We introduce a new name type, GSS_C_NT_HOSTNAME, with
		    OID &lt;TBD&gt;, corresponding to the 'dNSName'
		    choice of the 'GeneralName' ASN.1 type defined in
		    <a class='info' href='#RFC3280'>[RFC3280]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>.
</p>
<p>The query syntax for names of this type SHALL be a
		    DNS name <a class='info' href='#RFC1034'>[RFC1034]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - concepts and facilities,&rdquo; November&nbsp;1987.</span><span>)</span></a> in either ACE or
		    Unicode form <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>.
</p>
<p>The display and canonical form of names of this type
		    SHALL be a DNS domainname in ACE form, with
		    character case folded down.
</p>
<p>The exported name token format for names of this type
		    SHALL be the DER encoding of a GeneralName with
		    dNSName as the choice and the DNS domainname in ACE
		    form and case folded down.
</p>
<p>Implementation support for this name type is
		    OPTIONAL.
</p>
<a name="name_iPAddress"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
GSS_C_NT_IP_ADDR</h3>

<p>We introduce a new name type, GSS_C_NT_IP_ADDR, with
		    OID &lt;TBD&gt;, corresponding to the 'iPAddress'
		    choice of the 'GeneralName' ASN.1 type defined in
		    <a class='info' href='#RFC3280'>[RFC3280]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>.
</p>
<p>The query syntax, and display and canonical forms for
		    names of this type SHALL be the text representation
		    of an IPv4 or IPv6 address (XXX add references).
</p>
<p>The exported name token form for this name type SHALL
		    be a DER-encoded GeneralName with the iPAddress
		    choice.
</p>
<p>Implementation support for this name type is
		    OPTIONAL.
</p>
<a name="name_rfc822Name"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
GSS_C_NT_EMAIL_ADDR</h3>

<p>We introduce a new name type, GSS_C_NT_EMAIL_ADDR,
		    with OID &lt;TBD&gt;, corresponding to the
		    'rfc822Name' choice of the 'GeneralName' ASN.1 type
		    defined in <a class='info' href='#RFC3280'>[RFC3280]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>.
</p>
<p>The query syntax and display form for names of this
		    type SHALL be the text representation of an
		    'addr-spec' as defined in <a class='info' href='#RFC0822'>[RFC0822]<span> (</span><span class='info'>Crocker, D., &ldquo;Standard for the format of ARPA Internet text messages,&rdquo; August&nbsp;1982.</span><span>)</span></a>.
</p>
<p>The canonical form of names of this type SHALL be the
		    query form with case folded down.
</p>
<p>The exported name token form for this name type SHALL
		    be a DER-encoded GeneralName with the rfc822Name
		    choice.
</p>
<p>Implementation support for this name type is
		    OPTIONAL.
</p>
<a name="name_user_name"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
GSS_C_NT_USER_NAME</h3>

<p>For PKU2U the generic name type GSS_C_NT_USER_NAME
		    SHALL be an alias of GSS_C_NT_EMAIL_ADDR.
</p>
<p>Implementation support for this name type is
		    OPTIONAL.
</p>
<a name="name_krb5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
GSS_KRB5_NT_PRINCIPAL_NAME</h3>

<p>PKU2U supports the use of GSS_KRB5_NT_PRINCIPAL_NAME
		    names <a class='info' href='#RFC1964'>[RFC1964]<span> (</span><span class='info'>Linn, J., &ldquo;The Kerberos Version 5 GSS-API Mechanism,&rdquo; June&nbsp;1996.</span><span>)</span></a>.  These appear as
		    expected in various 'cname', 'crealm', 'sname' and
		    'srealm' fields of the Kerberos V PDUs used to
		    construct PKU2U security context tokens.  For PKU2U
		    names of this type correspond to subject alternative
		    names of type 'id-pkinit-san' <a class='info' href='#RFC4556'>[RFC4556]<span> (</span><span class='info'>Zhu, L. and B. Tung, &ldquo;Public Key Cryptography for Initial Authentication in Kerberos (PKINIT),&rdquo; June&nbsp;2006.</span><span>)</span></a>.  When no such SAN appears in
		    a certificate, then names of this type correspond to
		    certificates as agreed out of band (e.g., there may
		    be a table mapping certificates to Kerberos V
		    principal names).
</p>
<p>The canonical form of names of this type SHALL be as
		    specified in RFC4121.  (XXX Here we have two
		    mechanisms sharing a single name type that
		    originally was mechanism-specific.  This may cause
		    problems with some mechglue implementations; we
		    should describe this in detail.)
</p>
<p>Implementation support for this name type is
		    REQUIRED.
</p>
<a name="name_anon"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7"></a><h3>4.7.&nbsp;
GSS_C_NT_ANONYMOUS</h3>

<p>This is a generic GSS-API name-type.  Implementation
		    support for this name type is OPTIONAL.  See <a class='info' href='#as_req'>Section&nbsp;5.1<span> (</span><span class='info'>Context token derived from 		KRB_AS_REQ</span><span>)</span></a> for more information.
</p>
<a name="hostbased"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8"></a><h3>4.8.&nbsp;
Matching host-based
		service principal names to acceptor certificates</h3>

<p>Support for GSS_C_NT_HOSTBASED_SERVICE names is
		    REQUIRED as described herein.
</p>
<p>The query and display forms of this name type are as
		    per-RFC2743.  The canonical and exported name token
		    forms are as per-RFC1964.
</p>
<p>Initiators using names of type
		    GSS_C_NT_HOSTBASED_SERVICE to identify target
		    acceptors represent these names as Kerberos V
		    principal names as per <a class='info' href='#RFC4121'>[RFC4121]<span> (</span><span class='info'>Zhu, L., Jaganathan, K., and S. Hartman, &ldquo;The Kerberos Version 5 Generic Security Service Application Program Interface (GSS-API) Mechanism: Version 2,&rdquo; July&nbsp;2005.</span><span>)</span></a> but
		    with a well-known realm name of "WELLKNOWN:PKU2U"
		    (see <a class='info' href='#as_req'>Section&nbsp;5.1<span> (</span><span class='info'>Context token derived from 		KRB_AS_REQ</span><span>)</span></a>).
</p>
<p>Acceptors match such names to acceptor certificates
		    as follows.  Initiators then match the certificate
		    chosen by the acceptor in the same manner.
</p>
<p>Initiators can also assert host-based service names as
		    the initiator name.  In this case acceptors MUST
		    also apply the matching rules below to validate the
		    initiator's assertion.
</p>
<p>
		    </p>
<ol class="text">
<li>If the acceptor has a certificate with an
			    id-pkinit-san subject alternative name
			    matching the initiator-provided acceptor
			    name, then the certificate matches.
</li>
<li>If the acceptor has a certificate with a
			    dNSName SAN that matches the hostname part
			    of the host-based service principal name,
			    and either the anyExtendedKeyUsage extended
			    key usage (EKU), or no EKU is present, or an
			    EKU is present which corresponds to the
			    service part of the host-based service
			    principal name, then the certificate
			    matches.  The id-kp-serverAuth EKU SHALL be
			    considered to match the 'HTTP' service
			    name.  (See <a class='info' href='#iana'>Section&nbsp;9<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>, IANA
			    considerations, where the GSS-API service name
			    registry is extended to include an EKU for
			    each service name.)
</li>
<li>Implementations SHOULD, subject to local
			    configuration, allowing matches where the CN
			    of the DN of a cert matches the hostname
			    part of the host-based service name, for
			    some or all service names.  This feature is
			    needed to allow the use of existing web
			    certificates.
</li>
<li>If there is an out-of-band binding of the
			    peer's host-based service name to its
			    certificate, then the certificate
			    matches.
</li>
</ol><p>
		
</p>
<a name="protocol"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
The Protocol Description and
	    the Context Establishment Tokens</h3>

<p>The PKU2U mechanism is a GSS-API mechanism based on <a class='info' href='#RFC4120'>[RFC4120]<span> (</span><span class='info'>Neuman, C., Yu, T., Hartman, S., and K. Raeburn, &ldquo;The Kerberos Network Authentication Service (V5),&rdquo; July&nbsp;2005.</span><span>)</span></a>, <a class='info' href='#RFC4556'>[RFC4556]<span> (</span><span class='info'>Zhu, L. and B. Tung, &ldquo;Public Key Cryptography for Initial Authentication in Kerberos (PKINIT),&rdquo; June&nbsp;2006.</span><span>)</span></a> and
		<a class='info' href='#RFC4121'>[RFC4121]<span> (</span><span class='info'>Zhu, L., Jaganathan, K., and S. Hartman, &ldquo;The Kerberos Version 5 Generic Security Service Application Program Interface (GSS-API) Mechanism: Version 2,&rdquo; July&nbsp;2005.</span><span>)</span></a>.
</p>
<p>The per-message tokens of the PKU2U mechanism are the
		same as those of the Kerberos V GSS-API mechanism <a class='info' href='#RFC4121'>[RFC4121]<span> (</span><span class='info'>Zhu, L., Jaganathan, K., and S. Hartman, &ldquo;The Kerberos Version 5 Generic Security Service Application Program Interface (GSS-API) Mechanism: Version 2,&rdquo; July&nbsp;2005.</span><span>)</span></a>.
</p>
<p>The PKU2U security context token exchange consists of
		KRB-AS-REQ and KRB-AS-REP (and KRB-ERROR) Kerberos KDC
		PDUs (with minor changes/requirements described below)
		as context tokens, with the acceptor as the KDC,
		followed by context tokens from <a class='info' href='#RFC4121'>[RFC4121]<span> (</span><span class='info'>Zhu, L., Jaganathan, K., and S. Hartman, &ldquo;The Kerberos Version 5 Generic Security Service Application Program Interface (GSS-API) Mechanism: Version 2,&rdquo; July&nbsp;2005.</span><span>)</span></a>
		using the Kerberos V Ticket PDU issued by the
		acceptor-as-KDC.  PKINIT <a class='info' href='#RFC4556'>[RFC4556]<span> (</span><span class='info'>Zhu, L. and B. Tung, &ldquo;Public Key Cryptography for Initial Authentication in Kerberos (PKINIT),&rdquo; June&nbsp;2006.</span><span>)</span></a> is the
		only acceptable pre-authentication method.  Caching that
		ticket issued by the acceptor allows subsequent security
		context exchanges between the same to peers to use a
		single context token round-trip -- a "fast restart"
		feature.
</p>
<p>PKU2U differs from Kerberos V with PKINIT in several
		minor ways:
</p>
<p>
		</p>
<ul class="text">
<li>KDC PDUs are not exchanged as usual in Kerberos,
			but wrapped as GSS-API context tokens
</li>
<li>PKU2U allows the use of out-of-band binding of
			certificates to principal names
</li>
<li>PKU2U does not require the use of KDC
			certificates
</li>
<li>PKU2U adds pa-data types for carrying the
			initiator's assertion of its name and the
			targ_name passed to GSS_Init_sec_context()
</li>
</ul><p>
	    
</p>
<p>PKU2U differs from the Kerberos V GSS-API mechanism in
		several ways:
</p>
<p>
		</p>
<ul class="text">
<li>KDC PDUs are not exchanged as usual in Kerberos,
			but wrapped as GSS-API context tokens
</li>
<li>PKU2U allows the use of principal names matching
			PKI naming
</li>
<li>PKU2U adds an extension to the RFC4121 initial
			context token for binding the AP-REQ to the AS
			exchange that precedes is (that is, when the
			initiator has to request a ticket from the
			acceptor)
</li>
<li>The number of round-trips can vary.  If the
			initiator already has a ticket for the
			acceptor then the context token exchange will be
			half a round-trip or one round-trip, as per
			RFC4121.  Otherwise one or two round-trips are
			added for the AS exchanges needed to acquire a
			ticket.  Note that two AS exchanges may
			be required when the initiator's initial choice
			of certificate does not match the acceptor's
			trust anchors, in which case the acceptor will
			reply with a KRB-ERROR with
			TD-TRUSTED-CERTIFIERS indicating what the
			acceptor's trust anchors are, and then the
			initiator can engage in a second AS exchange
			within the same context token exchange.
</li>
</ul><p>
	    
</p>
<p>To recapitulate, the acceptor and the initiator
		communicate by tunneling the authentication service
		exchange messages through the use of the GSS-API tokens
		and application traffic.  The reliable delivery of the
		authentication service exchange messages at the GSS-API
		token level is mandatory.  In the event of message loss,
		message duplication, or out of order message delivery,
		the security context MUST fail to establish.
</p>
<p>All context establishment tokens MUST follow the
		InitialContextToken syntax defined in Section 3.1 of
		<a class='info' href='#RFC2743'>[RFC2743]<span> (</span><span class='info'>Linn, J., &ldquo;Generic Security Service Application Program Interface Version 2, Update 1,&rdquo; January&nbsp;2000.</span><span>)</span></a>. PKU2U is identified by the
		Objection Identifier (OID) id-kerberos-pku2u.
</p>
<p>All context establishment tokens consist of some Kerberos
		V PDU or another, prefixed with a two-octet token type
		ID, and the InitialContextToken header (see above).
</p>
<p>The PKU2U OID is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
            id-kerberos-pku2u ::=
            { iso(1) org(3) dod(6) internet(1) security(5) kerberosV5(2)
            pku2u(7) }
</pre></div>
<p>The innerToken described in section 3.1 of <a class='info' href='#RFC2743'>[RFC2743]<span> (</span><span class='info'>Linn, J., &ldquo;Generic Security Service Application Program Interface Version 2, Update 1,&rdquo; January&nbsp;2000.</span><span>)</span></a> and subsequent GSS-API mechanism
		tokens have the following formats: it starts with a
		two-octet token-identifier (TOK_ID), followed by a
		Kerberos message. The TOK_ID values for the KRB_AS_REQ
		message and the KRB_AS_REP message are defined in the
		table blow:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
		    Token         TOK_ID Value in Hex
		    -----------------------------------------------
		    KRB_AS_REQ          05 00
		    KRB_AS_REP          06 00
</pre></div>
<p>The TOK_ID values for all other Kerberos messages are the
		same as defined in <a class='info' href='#RFC4121'>[RFC4121]<span> (</span><span class='info'>Zhu, L., Jaganathan, K., and S. Hartman, &ldquo;The Kerberos Version 5 Generic Security Service Application Program Interface (GSS-API) Mechanism: Version 2,&rdquo; July&nbsp;2005.</span><span>)</span></a>.
</p>
<p>By using anonymous PKINIT <a class='info' href='#KRB-ANON'>[KRB&#8209;ANON]<span> (</span><span class='info'>Zhu, L. and P. Leach, &ldquo;Kerberos Anonymity Support,&rdquo; 2007.</span><span>)</span></a>,
		PKU2U can provide server-authentication without
		revealing the client's identity.
</p>
<a name="as_req"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Context token derived from
		KRB_AS_REQ</h3>

<p>When the initiator does not have a service ticket to
		    the acceptor, it requests a ticket from the acceptor
		    instead of the KDC by constructing a KRB_AS_REQ PDU
		    <a class='info' href='#RFC4120'>[RFC4120]<span> (</span><span class='info'>Neuman, C., Yu, T., Hartman, S., and K. Raeburn, &ldquo;The Kerberos Network Authentication Service (V5),&rdquo; July&nbsp;2005.</span><span>)</span></a> and using it as the context
		    token, with a token type ID prefixed.  This will be
		    the initiator's initial context token, therefore it
		    MUST also have the standard header bearing the OID
		    of the mechanism being used (in this case, PKU2U's
		    OID).
</p>
<p>If the initiator wishes to assert a name of type
		    GSS_C_NT_ANONYMOUS then it MUST set the cname field
		    to WELLKNOWN/WELLKNOWN with name type
		    KRB_NT_WELLKNOWN <a class='info' href='#KRB-ANON'>[KRB&#8209;ANON]<span> (</span><span class='info'>Zhu, L. and P. Leach, &ldquo;Kerberos Anonymity Support,&rdquo; 2007.</span><span>)</span></a>, and it
		    MUST NOT use a certificate <a class='info' href='#KRB-ANON'>[KRB&#8209;ANON]<span> (</span><span class='info'>Zhu, L. and P. Leach, &ldquo;Kerberos Anonymity Support,&rdquo; 2007.</span><span>)</span></a>.  If the initiator wishes to
		    assert a name of type GSS_KRB5_NT_PRINCIPAL_NAME,
		    then it MUST set the cname and realm fields of the
		    KRB_AS_REQ to match.  Otherwise the initiator MUST
		    add a pa-data element (see below) stating the name
		    that the initiator wishes to assert, it MUST set the
		    cname field to the anonymous principal name, and it
		    MUST set the realm field to "WELLKNOWN:PKU2U" with
		    type "other" <a class='info' href='#KRB-NAMING'>[KRB&#8209;NAMING]<span> (</span><span class='info'>Zhu, L., &ldquo;Additional Kerberos Naming Constraints,&rdquo; 2007.</span><span>)</span></a>.
</p>
<p>If the targ_name passed to GSS_Init_sec_context() is
		    of GSS_C_NT_ANONYMOUS type, then the sname field of
		    the AS-REQ SHALL be set to WELLKNOWN/WELLKNOWN with
		    name type KRB_NT_WELLKNOWN <a class='info' href='#KRB-ANON'>[KRB&#8209;ANON]<span> (</span><span class='info'>Zhu, L. and P. Leach, &ldquo;Kerberos Anonymity Support,&rdquo; 2007.</span><span>)</span></a>.  If the targ_name passed to
		    GSS_Init_sec_context() is of type
		    GSS_C_NT_HOSTBASED_NAME then the initiator sets the
		    sname field to match the parsed name as per <a class='info' href='#RFC4121'>[RFC4121]<span> (</span><span class='info'>Zhu, L., Jaganathan, K., and S. Hartman, &ldquo;The Kerberos Version 5 Generic Security Service Application Program Interface (GSS-API) Mechanism: Version 2,&rdquo; July&nbsp;2005.</span><span>)</span></a>, and there is no notion of
		    server realm name in this case.  In all other cases
		    the initiator MUST produce the exported name token
		    for the given targ_name and MUST include it as the
		    pa-value of an pa-data element whose pa-type SHALL
		    be &lt;TBD&gt;, and the initiator MUST set the sname
		    field of the AS-REQ to WELLKNOWN/WELLKNOWN with name
		    type KRB_NT_WELLKNOWN [KRB-ANON] -- the presence of
		    the targ_name pa-data element means the targ_name is
		    not of type GSS_C_NT_ANONYMOUS.
</p>
<p>The token type ID for this token SHALL be 05 00.
</p>
<p>The pa-data element for the initiator's name
		    assertion SHALL be of ad-type &lt;TBD&gt; and its
		    ad-value SHALL consist of the BER encoding of the
		    following:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
			InitiatorNameAssertion ::= CHOICE {
			    -- -1 -&gt; certificate DN
			    -- 0..16384 -&gt; subjectAltName named by
			    --             this index
			    sanIndex INTEGER (-1..16384),
			    nameNotInCert GeneralName -- from RFC3280
			}
</pre></div>
<p>The acceptor MUST validate this token as a Kerberos V
		    KDC would validate a PKINIT AS-REQ, and also MUST
		    check that the initiator's asserted name is present
		    in the initiator's certificate or otherwise bound to
		    the initiator's certificate by out-of-band
		    negotiation (e.g., by a table lookup).  Failure to
		    validate this token MUST cause
		    GSS_Accept_sec_context() to return an error and,
		    optionally, to output a KRB-ERROR context token as
		    per-RFC4121.
</p>
<a name="as_rep"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Context token derived from
		KRB_AS_REP</h3>

<p>When the initiator's initial context token is a
		    KRB_AS_REQ then the acceptor MUST reply with either
		    a KRB-ERROR token as per <a class='info' href='#RFC4121'>[RFC4121]<span> (</span><span class='info'>Zhu, L., Jaganathan, K., and S. Hartman, &ldquo;The Kerberos Version 5 Generic Security Service Application Program Interface (GSS-API) Mechanism: Version 2,&rdquo; July&nbsp;2005.</span><span>)</span></a> or
		    a token derived from a KRB_AS_REP PDU <a class='info' href='#RFC4120'>[RFC4120]<span> (</span><span class='info'>Neuman, C., Yu, T., Hartman, S., and K. Raeburn, &ldquo;The Kerberos Network Authentication Service (V5),&rdquo; July&nbsp;2005.</span><span>)</span></a> constructed to respond to the
		    initiator's KRB_AS_REQ.
</p>
<p>The acceptor MUST only accept PKINIT
		    pre-authentication.  If the initiator's KRB_AS_REQ
		    token is valid, and the initiator's asserted name is
		    bound to the certificate (see <a class='info' href='#as_req'>Section&nbsp;5.1<span> (</span><span class='info'>Context token derived from 		KRB_AS_REQ</span><span>)</span></a> and <a class='info' href='#naming'>Section&nbsp;4<span> (</span><span class='info'>PKU2U Principal Naming</span><span>)</span></a>)
		    then the acceptor MUST select a certificate (if it
		    has more than one) which matches the initiator's
		    targ_name (or any certificate at all, if the
		    initiator's targ_name is the anonymous name), and
		    then the acceptor MUST construct a KRB_AS_REP as
		    usual for PKINIT, except that there is no
		    requirement to use a KDC certificate.
</p>
<p>The initiator then validates this token according to
		    Section 3.1.5 of <a class='info' href='#RFC4120'>[RFC4120]<span> (</span><span class='info'>Neuman, C., Yu, T., Hartman, S., and K. Raeburn, &ldquo;The Kerberos Network Authentication Service (V5),&rdquo; July&nbsp;2005.</span><span>)</span></a> and
		    Section 3.2.4 of <a class='info' href='#RFC4556'>[RFC4556]<span> (</span><span class='info'>Zhu, L. and B. Tung, &ldquo;Public Key Cryptography for Initial Authentication in Kerberos (PKINIT),&rdquo; June&nbsp;2006.</span><span>)</span></a>.  The
		    inclusion of the EKU KeyPurposeId <a class='info' href='#RFC3280'>[RFC3280]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a> id-pkinit-KPKdc in the X.509
		    certificate in the response is not applicable when
		    PKU2U is used because there is no KDC involved in
		    this protocol.  The initiator MUST verify that the
		    acceptor's certificate matches the targ_name passed
		    in to GSS_Init_sec_context().
</p>
<a name="ap_exchange"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Context tokens imported from
		RFC4121</h3>

<p>Once the initiator has a Kerberos V Ticket for the
		    acceptor the security context token exchange will
		    continue with those of the Kerberos V GSS-API
		    mechanism <a class='info' href='#RFC4121'>[RFC4121]<span> (</span><span class='info'>Zhu, L., Jaganathan, K., and S. Hartman, &ldquo;The Kerberos Version 5 Generic Security Service Application Program Interface (GSS-API) Mechanism: Version 2,&rdquo; July&nbsp;2005.</span><span>)</span></a> with the
		    following modifications:
</p>
<p>
		    </p>
<ul class="text">
<li>the mechanism OID of PKU2U SHALL be used
			    instead of that of the Kerberos V GSS-API
			    mechanism;
</li>
<li>a sub-session key MUST be included in the
			    initiator's Authenticator;
</li>
<li>if the initiator's initial context token is a
			    KRB_AS_REQ token (i.e., not KRB_AP_REQ
			    token), then the Exts field in the
			    Authenticator of the KRB_AP_REQ-derived
			    token <a class='info' href='#GSS-EXTS'>[GSS&#8209;EXTS]<span> (</span><span class='info'>Emery, S., &ldquo;Kerberos Version 5 GSS-API Channel Binding Hash Agility,&rdquo; 2007.</span><span>)</span></a> MUST contain
			    an extension of the type GSS_EXTS_FINISHED
			    (extension type ID &lt;TBA&gt;) and the
			    extension data contains a DER-encoded value
			    of the Kerberos V 'Checksum' type, where the
			    checksum (actually, a MAC, see <a class='info' href='#RFC3961'>[RFC3961]<span> (</span><span class='info'>Raeburn, K., &ldquo;Encryption and Checksum Specifications for Kerberos 5,&rdquo; February&nbsp;2005.</span><span>)</span></a>) is taken over all
			    the preceding context tokens in this
			    exchange (including the InitialContextToken
			    header), concatenated in chronological order
			    (remember, GSS-API context token exchanges
			    are synchronous).  The key usage number for
			    this checksum is KEY_USAGE_FINISHED (number
			    41).
</li>
</ul><p>
		
</p>
<p>The acceptor MUST process this token as usual for
		    RFC4121, except that if the context token exchange
		    included an AS eschange, then the acceptor MUST also
		    validate the GSS_EXTS_FINISHED and return an error
		    if it is not valid or not present.  But if this is
		    the initial context token then the acceptor MUST
		    return an error if GSS_EXTS_FINISHED is present.
</p>
<p>The GSS_EXTS_FINISHED (along with the ticket) binds
		    the second part of the context token exchange to the
		    first, and it binds the pa-data used in the request
		    as well (this needs to be done because PKINIT does
		    not bind pa-data other than PKINIT pa-data from the
		    request).  GSS_EXTS_FINISHED also protects all
		    otherwise unauthenticated plaintext in Kerberos V
		    PDUs.  Note that GSS_EXTS_FINISHED also protects the
		    mechanism OID in the InitialContextToken header.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
			KEY_USAGE_FINISHED            41
</pre></div>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Guidelines for Credentials Selection</h3>

<p>If a peer, either the initiator or the acceptor, has
		multiple pairs of public-key private keys, a choice is
		to be made in choosing the best fit.  The
		trustedCertifiers field in the PA-PK-AS-REQ structure
		<a class='info' href='#RFC4556'>[RFC4556]<span> (</span><span class='info'>Zhu, L. and B. Tung, &ldquo;Public Key Cryptography for Initial Authentication in Kerberos (PKINIT),&rdquo; June&nbsp;2006.</span><span>)</span></a> SHOULD be filled by the
		initiator, to provide hints for guiding the selection of
		an appropriate certificate chain by the acceptor.
</p>
<p>If the initiator's X.509 certificate cannot be validated
		according to <a class='info' href='#RFC3280'>[RFC3280]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a>, the acceptor
		SHOULD send back the TD-TRUSTED-CERTIFIERS structure
		<a class='info' href='#RFC4556'>[RFC4556]<span> (</span><span class='info'>Zhu, L. and B. Tung, &ldquo;Public Key Cryptography for Initial Authentication in Kerberos (PKINIT),&rdquo; June&nbsp;2006.</span><span>)</span></a> that provides hints for guiding
		the selection of an appropriate certificate by the
		initiator.  In this case GSS_Accept_sec_context()
		returns GSS_S_CONTINUE_NEEDED, and the initiator gets
		to try again in its subsequent AS-REQ token.
</p>
<p>The GSS-API does not provide a way to make this
		credential selection interactive, however, whenever the
		context allows for direct interaction of the mechanism
		with the user then it is RECOMMENDED that
		implementations do so.
</p>
<p>If the certificates cannot be selected interactively, and
		multiple certificates can be used, it is RECOMMENDED
		that initiators fail the context establishment thus
		avoid confusions caused by an unexpected programmatic
		selection.  Users should be able to retry using a
		specific credential (this requires that distinct
		credentials have distinct names that can be used to
		acquire each credential separately).
</p>
<a name="seccons"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>The security considerations in <a class='info' href='#RFC4556'>[RFC4556]<span> (</span><span class='info'>Zhu, L. and B. Tung, &ldquo;Public Key Cryptography for Initial Authentication in Kerberos (PKINIT),&rdquo; June&nbsp;2006.</span><span>)</span></a>
		apply here.  This mechanism relaxes some requirements of
		PKINIT and adds a device for protecting otherwise
		unauthenticated plaintext in the protocol -- it is
		crucial that this device be faithfully implemented.  It
		is also crucial that both the initiator and the acceptor
		MUST be able to verify the binding between the signing
		key and the associated identity. 
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgements</h3>

<p>The authors would like to thank Jeffrey Hutzelman for his
		insightful comments on the earlier revisions of this
		document.
</p>
<p>In addition, the following individuals have provided
		review comments for this document: Nicolas Williams, Sam
		Hartman, Leif Johansson, Olga Kornievskaia, Martin Rex,
		and Sunil Gottumukkala.
</p>
<p> Ari Medvinsky provided help in editing the initial
		revisions of this document.
</p>
<p>The text for the DN mapping is compiled directly from the
		email discussions among the following individuals:
		Howard Chu, Martin Rex, Nicolas Williams, Jeffrey
		Hutzelman, Kevin Coffman, Henry B. Hotz, Leif Johansson,
		and Olga Kornievskaia.  Howard and Jeffery clearly
		illustrated the challenges in creating a unique mapping,
		while Nicolas and Martin demonstrated the relevance and
		interactions to GSS-API and Kerberos. 
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p><a class='info' href='#pku2urealm'>Section&nbsp;3<span> (</span><span class='info'>The PKU2U Realm Name</span><span>)</span></a> defines the PKU2U realm. The
		IANA registry for the reserved names should be updated
		to reference this document.
</p>
<p>This document defines GSS_EXTS_FINISHED extension type.
		The corresponding IANA registry need to be updated to
		reference this document.  The following single
		registration should be added in the registry for
		"Kerberos V GSS-API mechanism extension types":
		GSS_EXTS_FINISHED, "GSS-API token checksum", "Extension
		to provide a checksum for GSS-API tokens", the RFC # of
		this document.
</p>
<p>This document also expands the existing GSS-API service
		name registry, that IANA maintains, to have a an
		assignment of one or more OIDs for each service name.
		The id-kp-serverAuth OID <a class='info' href='#RFC3280'>[RFC3280]<span> (</span><span class='info'>Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; April&nbsp;2002.</span><span>)</span></a> is
		immediately registered as the OID for the "HTTP" service
		name.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="GSS-EXTS">[GSS-EXTS]</a></td>
<td class="author-text">Emery, S., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-krb-wg-gss-cb-hash-agility-03.txt.txt">Kerberos Version 5 GSS-API Channel Binding Hash Agility</a>,&rdquo; draft-ietf-krb-wg-gss-cb-hash-agility-03.txt (work in progress), 2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="KRB-ANON">[KRB-ANON]</a></td>
<td class="author-text">Zhu, L. and P. Leach, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-krb-wg-anon-04.txt.txt">Kerberos Anonymity Support</a>,&rdquo; draft-ietf-krb-wg-anon-04.txt (work in progress), 2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="KRB-NAMING">[KRB-NAMING]</a></td>
<td class="author-text">Zhu, L., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-krb-wg-naming-04.txt">Additional Kerberos Naming Constraints</a>,&rdquo; draft-ietf-krb-wg-naming-04 (work in progress), 2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC0822">[RFC0822]</a></td>
<td class="author-text"><a href="mailto:DCrocker@UDel-Relay">Crocker, D.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc822">Standard for the format of ARPA Internet text messages</a>,&rdquo; STD&nbsp;11, RFC&nbsp;822, August&nbsp;1982 (<a href="http://www.rfc-editor.org/rfc/rfc822.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1034">[RFC1034]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1034">Domain names - concepts and facilities</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1034, November&nbsp;1987 (<a href="http://www.rfc-editor.org/rfc/rfc1034.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1964">[RFC1964]</a></td>
<td class="author-text"><a href="mailto:John.Linn@ov.com">Linn, J.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1964">The Kerberos Version 5 GSS-API Mechanism</a>,&rdquo; RFC&nbsp;1964, June&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1964.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2743">[RFC2743]</a></td>
<td class="author-text"><a href="mailto:jlinn@rsasecurity.com">Linn, J.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2743">Generic Security Service Application Program Interface Version 2, Update 1</a>,&rdquo; RFC&nbsp;2743, January&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2743.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3280">[RFC3280]</a></td>
<td class="author-text">Housley, R., Polk, W., Ford, W., and D. Solo, &ldquo;<a href="http://tools.ietf.org/html/rfc3280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;3280, April&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3280.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3490">[RFC3490]</a></td>
<td class="author-text">Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;<a href="http://tools.ietf.org/html/rfc3490">Internationalizing Domain Names in Applications (IDNA)</a>,&rdquo; RFC&nbsp;3490, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3490.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3961">[RFC3961]</a></td>
<td class="author-text">Raeburn, K., &ldquo;<a href="http://tools.ietf.org/html/rfc3961">Encryption and Checksum Specifications for Kerberos 5</a>,&rdquo; RFC&nbsp;3961, February&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3961.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4120">[RFC4120]</a></td>
<td class="author-text">Neuman, C., Yu, T., Hartman, S., and K. Raeburn, &ldquo;<a href="http://tools.ietf.org/html/rfc4120">The Kerberos Network Authentication Service (V5)</a>,&rdquo; RFC&nbsp;4120, July&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4120.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4121">[RFC4121]</a></td>
<td class="author-text">Zhu, L., Jaganathan, K., and S. Hartman, &ldquo;<a href="http://tools.ietf.org/html/rfc4121">The Kerberos Version 5 Generic Security Service Application Program Interface (GSS-API) Mechanism: Version 2</a>,&rdquo; RFC&nbsp;4121, July&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4121.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4514">[RFC4514]</a></td>
<td class="author-text">Zeilenga, K., &ldquo;<a href="http://tools.ietf.org/html/rfc4514">Lightweight Directory Access Protocol (LDAP): String Representation of Distinguished Names</a>,&rdquo; RFC&nbsp;4514, June&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4514.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4556">[RFC4556]</a></td>
<td class="author-text">Zhu, L. and B. Tung, &ldquo;<a href="http://tools.ietf.org/html/rfc4556">Public Key Cryptography for Initial Authentication in Kerberos (PKINIT)</a>,&rdquo; RFC&nbsp;4556, June&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4556.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Larry Zhu</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Microsoft Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">One Microsoft Way</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Redmond, WA  98052</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:lzhu@microsoft.com">lzhu@microsoft.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jeffery Altman</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Secure Endpoints</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">255 W 94th St</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">New York, NY  10025</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jaltman@secure-endpoints.com">jaltman@secure-endpoints.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nicolas Williams</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sun Microsystems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">5300 Riata Trace Ct</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Austin, TX  78727</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Nicolas.Williams@sun.com">Nicolas.Williams@sun.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
