 



INTERNET-DRAFT                                              Sami Boutros
Intended Status: Standard Track                              Ali Sajassi
                                                             Samer Salam
                                                           Cisco Systems

                                                              John Drake
                                                        Juniper Networks

                                                           Jeff Tantsura
                                                                Ericsson

                                                          Dirk Steinberg
                                                    Steinberg Consulting

                                                         Thomas Beckhaus
                                                        Deutsche Telecom

Expires: January 3, 2015                                    July 2, 2014


                         VPWS support in E-VPN 
                 draft-boutros-l2vpn-evpn-vpws-04.txt 


Abstract

   This document describes how E-VPN can be used to support virtual
   private wire service (VPWS) in MPLS/IP networks. E-VPN enables the
   following characteristics for VPWS: single-active as well as all-
   active multi-homing with flow-based load-balancing, eliminates the
   need for single-segment and multi-segment PW signaling, and provides
   fast protection using data-plane prefix independent convergence upon
   node or link failure.


Status of this Memo

   This Internet-Draft is submitted to IETF in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as
   Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
 


Boutros                 Expires January 3, 2015                 [Page 1]

INTERNET DRAFT           VPWS support in E-VPN              July 2, 2014


   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/1id-abstracts.html

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html


Copyright and License Notice

   Copyright (c) 2014 IETF Trust and the persons identified as the
   document authors. All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document. Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document. Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



Table of Contents

   1  Introduction  . . . . . . . . . . . . . . . . . . . . . . . . .  3
     1.1  Terminology . . . . . . . . . . . . . . . . . . . . . . . .  4
     1.2 Requirements . . . . . . . . . . . . . . . . . . . . . . . .  4
   2. BGP Extensions  . . . . . . . . . . . . . . . . . . . . . . . .  5
   3 Operation  . . . . . . . . . . . . . . . . . . . . . . . . . . .  5
   4 EVPN Comparison to PW Signaling  . . . . . . . . . . . . . . . .  7
   5 ESI Bandwidth  . . . . . . . . . . . . . . . . . . . . . . . . .  7
   7 VPWS with multiple sites . . . . . . . . . . . . . . . . . . . .  8
   8 Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . .  8
   9 Security Considerations  . . . . . . . . . . . . . . . . . . . .  8
   10  IANA Considerations  . . . . . . . . . . . . . . . . . . . . .  8
   11  References . . . . . . . . . . . . . . . . . . . . . . . . . .  8
     11.1  Normative References . . . . . . . . . . . . . . . . . . .  8
     11.2  Informative References . . . . . . . . . . . . . . . . . .  8
   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . .  8





 


Boutros                 Expires January 3, 2015                 [Page 2]

INTERNET DRAFT           VPWS support in E-VPN              July 2, 2014


1  Introduction

   This document describes how EVPN can be used to support virtual
   private wire service (VPWS) in MPLS/IP networks. The use of EVPN
   mechanisms for VPWS brings the benefits of EVPN to p2p services.
   These benefits include single-active redundancy as well as all-active
   redundancy with flow-based load-balancing. Furthermore, the use of
   EVPN for VPWS eliminates the need for signaling single-segment and
   multi-segment PWs for p2p Ethernet services. 

   [EVPN] has the ability to forward customer traffic to/from a given
   customer Attachment Circuit (AC), aka Ethernet Segment in EVPN
   terminology, without any MAC lookup. This capability is ideal in
   providing p2p services (aka VPWS services). [MEF] defines Ethernet
   Virtual Private Line (EVPL) service as p2p service between a pair of
   ACs (designated by VLANs) and Ethernet Private Line (EPL) service, in
   which all traffic flows are between a single pair of ESes. EVPL can
   be considered as a VPWS with only two ACs. In delivering an EVPL
   service, the traffic forwarding capability of EVPN based on the
   exchange of a pair of Ethernet AD routes is used; whereas, for more
   general VPWS, traffic forwarding capability of EVPN based on the
   exchange of a group of Ethernet AD routes (one Ethernet AD route per
   AC/segment) is used. In a VPWS service,  the traffic from an
   originating Ethernet Segment can be forwarded only to a single
   destination Ethernet Segment; hence, no MAC lookup is needed and the
   MPLS label associated with the per-EVI Ethernet AD route can be used
   in forwarding user traffic to the destination AC.  

   Both services are supported by using the Per EVI Ethernet AD route
   which contains an Ethernet Segment Identifier, in which the customer
   ES is encoded, and an Ethernet Tag, in which the VPWS service
   instance identifier is encoded.  I.e., for both EPL and EVPL
   services, a specific VPWS service instance is identified by a pair of
   Per EVI Ethernet AD routes which together identify the VPWS service
   instance endpoints and the VPWS service instance.  In the control
   plane the VPWS service instance is identified using the VPWS service
   instance identifiers advertised by each PE and in the data plane the
   MPLS label advertised by one PE is used by the other PE to send it
   traffic for that VPWS service instance.  As with the Ethernet Tag in
   standard EVPN, the VPWS service instance identifier has uniqueness
   within an EVPN instance. The Ethernet Segment identifier encoded in
   he per EVI Ethernet AD route is not used to identify the service,
   however it can be used for flow-based load-balancing and mass
   withdraw functions.

   As with standard EVPN, the Per ES Ethernet AD route is used for fast
   convergence upon link or node failure and the Ethernet Segment route
   is used for auto-discovery of the PEs attached to a given multi-homed
 


Boutros                 Expires January 3, 2015                 [Page 3]

INTERNET DRAFT           VPWS support in E-VPN              July 2, 2014


   CE and to synchronize state between them.

1.1  Terminology

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [RFC2119].

   MAC: Media Access Control

   MPLS: Multi Protocol Label Switching.

   OAM: Operations, Administration and Maintenance.

   PE: Provide Edge Node.

   CE: Customer Edge device e.g., host or router or switch.

   EVI: EVPN Instance.

   Single-Active Mode: When a device or a network is multi-homed to two
   or more PEs and when only a single PE in such redundancy group can
   forward traffic to/from the multi-homed device or network for a given
   VLAN, then such multi-homing or redundancy is referred to as "Single-
   Active".

   All-Active: When a device is multi-homed to two or more PEs and when
   all PEs in such redundancy group can forward traffic to/from the
   multi-homed device for a given VLAN, then such multi-homing or
   redundancy is referred to as "All-Active".

1.2 Requirements

   1. EPL service access circuit maps to the whole Ethernet port.

   2. EVPL service access circuits are VLANs on single or double tagged
   trunk ports. Each VLAN individually will be considered to be an
   endpoint for an EVPL service, without any direct dependency on any
   other VLANs on the trunk. Other VLANs on the same trunk could also be
   used for EVPL services, but could also be associated with other
   services.

   3. If multiple VLANs on the same trunk are associated with EVPL
   services, the respective remote endpoints of these EVPLs could be
   dispersed across any number of PEs, i.e. different VLANs may lead to
   different destinations.

   4. The VLAN tag on the access trunk only has PE-local significance.
 


Boutros                 Expires January 3, 2015                 [Page 4]

INTERNET DRAFT           VPWS support in E-VPN              July 2, 2014


   The VLAN tag on the remote end could be different, and could also be
   double tagged when the other side is single tagged.

   5. Also, multiple EVPL service VLANs on the same trunk could belong
   to the same EVPN instance (EVI), or they could belong to different
   EVIs. This should be purely an administrative choice of the network
   operator.

   6. A given access trunk could have hundreds of EVPL services, and a
   given PE could have thousands of EVPLs configured. It must be
   possible to configure multiple EVPL services within the same EVI.

   7. Local access circuits configured to belong to a given EVPN
   instance could also belong to different physical access trunks.


2. BGP Extensions


   This document proposes the use of the Per EVI Ethernet AD route to
   signal VPWS services. The Ethernet Segment Identifier field is set to
   the customer ES and the Ethernet Tag field is set to the VPWS service
   instance identifier.  For both EPL and EVPL services, for a given
   VPWS service instance the pair of PEs instantiating that VPWS service
   instance will each advertise a Per EVI Ethernet AD route with its
   VPWS service instance identifier and will each be configured with the
   other PE's VPWS service instance identifier. When each PE has
   received the other PE's

   Per EVI Ethernet AD route the VPWS service instance is instantiated. 
   It should be noted that the same VPWS service instance identifier may
   be configured on both PEs.

   The Route-Target (RT) extended community with which the Per EVI
   Ethernet AD route is tagged identifies the EVPN instance in which the
   VPWS service instance is configured.  It is the operator's choice as
   to how many and which VPWS service instances are configured in a
   given EVPN instance. However, a given EVPN instance MUST NOT be
   configured with both VPWS service instances and standard EVPN multi-
   point services.

3 Operation

   The following figure shows an example of a P2P service deployed with
   EVPN.
          Ethernet                                          Ethernet
          Native   |<--------- EVPN Instance ----------->|  Native
          Service  |                                     |  Service
 


Boutros                 Expires January 3, 2015                 [Page 5]

INTERNET DRAFT           VPWS support in E-VPN              July 2, 2014


           (AC)    |     |<-PSN1->|       |<-PSN2->|     |  (AC)
             |     V     V        V       V        V     V  |
             |     +-----+      +-----+  +-----+   +-----+  |
      +----+ |     | PE1 |======|ASBR1|==|ASBR2|===| PE3 |  |    +----+
      |    |-------+-----+      +-----+  +-----+   +-----+-------|    |
      | CE1| |                                              |    |CE2 |
      |    |-------+-----+      +-----+  +-----+   +-----+-------|    |
      +----+ |     | PE2 |======|ASBR3|==|ASBR4|===| PE4 |  |    +----+
           ^       +-----+      +-----+  +-----+   +-----+          ^
           |   Provider Edge 1        ^        Provider Edge 2      |
           |                          |                             |
           |                          |                             |
           |              EVPN Inter-provider point                 |
           |                                                        |
           |<---------------- Emulated Service -------------------->|

   iBGP sessions are established between PE1, PE2, ASBR1 and ASBR3,
   possibly via a BGP route-reflector. Similarly, iBGP sessions are
   established between PE3, PE4, ASBR2 and ASBR4. eBGP sessions are
   established among ASBR1, ASBR2, ASBR3, and ASBR4.

   All PEs and ASBRs are enabled for the EVPN SAFI and exchange Per EVI
   Ethernet AD routes, one route per VPWS service instance.  For inter-
   AS option B, the ASBRs re-advertise these routes with Next Hop
   attribute set to their IP addresses. The link between the CE and the
   PE is either a C-tagged or S-tagged interface, as described in
   [802.1Q], that can carry a single VLAN tag or two nested VLAN tags
   and it is configured as a trunk with multiple VLANs, one per VPWS
   service instance. It should be noted that the VLAN ID used by the
   customer at either end of a VPWS service instance to identify that
   service instance may be different and EVPN doesn't perform that
   translation between the two values.  Rather, this should be done by
   the Ethernet interface.

   For single-homed CE, in an advertised Per EVI Ethernet AD route the
   ESI field is set to 0 and the Ethernet Tag field is set to the VPWS
   service instance identifier that identifies the EVPL or EPL service.

   For a multi-homed CE, in an advertised Per EVI Ethernet AD route the
   ESI field is set to the CE's ESI and the Ethernet Tag field is set to
   the VPWS service instance identifier, which MUST have the same value
   on all PEs attached to that ES.  This allows an ingress PE to perform
   flow-based load-balancing of traffic flows to all of the PEs attached
   to that ES. In all cases traffic follows the transport paths, which
   may be asymmetric.

   The VPWS service instance identifier encoded in the Ethernet Tag
   field in an advertised Per EVI Ethernet AD route MUST either be
 


Boutros                 Expires January 3, 2015                 [Page 6]

INTERNET DRAFT           VPWS support in E-VPN              July 2, 2014


   unique across all ASs, or an ASBR needs to perform a translation when
   the per EVI Ethernet AD route is re-advertised by the ASBR from one
   AS to the other AS.

   Per ES EAD route can be used for mass withdraw to withdraw all per
   EVI EAD routes associated with the multi-home site on a given PE.


4 EVPN Comparison to PW Signaling

   In EVPN, service endpoint discovery and label signaling are done
   concurrently using BGP. Whereas, with VPWS based on [RFC4448], label
   signaling is done via LDP and service endpoint discovery is either
   through manual provisioning or through BGP. 

   In existing implementation of VPWS using pseudowires(PWs), redundancy
   is limited to single-active mode, while with EVPN implementation of
   VPWS both single-active and all-active redundancy modes can be
   supported.

   In existing implementation with PWs, backup PWs are not used to carry
   traffic, while with EVPN, traffic can be load-balanced among
   different PEs multi-homed to a single CE.

   Upon link or node failure, EVPN can trigger failover with the
   withdrawal of a single BGP route per EVPL service or multiple EVPL
   services, whereas with VPWS PW redundancy, the failover sequence
   requires exchange of two control plane messages: one message to
   deactivate the group of primary PWs and a second message to activate
   the group of backup PWs associated with the access link. Finally,
   EVPN may employ data plane local repair mechanisms not available in
   VPWS.

5 ESI Bandwidth

   The ESI Bandwidth will be encoded using the Link Bandwidth Extended
   community defined in [draft-ietf-idr-link-bandwidth] and associated
   with the Ethernet AD route used to realize the EVPL services.

   When a PE receives this attribute for a given EVPL it MUST request
   the required bandwidth from the PSN towards the other EVPL service
   destination PE originating the message. When resources are allocated
   from the PSN for a given EVPL service, then the PSN SHOULD account
   for the Bandwidth requested by this EVPL service.

   In the case where PSN resources are not available, the PE receiving
   this attribute MUST re-send its local Ethernet AD routes for this
   EVPL service with the ESI Bandwidth = All FFs to declare that the
 


Boutros                 Expires January 3, 2015                 [Page 7]

INTERNET DRAFT           VPWS support in E-VPN              July 2, 2014


   "PSN Resources Unavailable".

   The scope of the ESI Bandwidth is limited to only one Autonomous
   System.

7 VPWS with multiple sites

   The VPWS among multiple sites (full mesh of P2P connections - one per
   pair of sites) that can be setup automatically without any explicit
   provisioning of P2P connections among the sites is outside the scope
   of this document.

8 Acknowledgements

   The authors would like to acknowledge Wen Lin contributions to this
   document.

9 Security Considerations

   This document does not introduce any additional security constraints.
10  IANA Considerations

   TBD.

11  References

11.1  Normative References

   [KEYWORDS] Bradner, S., "Key words for use in RFCs to Indicate
   Requirement Levels", BCP 14, RFC 2119, March 1997.

11.2  Informative References

   [EVPN-REQ] A. Sajassi, R. Aggarwal et. al., "Requirements for      
   Ethernet VPN", draft-ietf-l2vpn-evpn-req-00.txt.

   [EVPN] A. Sajassi, R. Aggarwal et. al., "BGP MPLS Based Ethernet
   VPN", draft-ietf-l2vpn-evpn-04.txt.

   [PBB-EVPN] A. Sajassi et. al., "PBB-EVPN", draft-ietf-l2vpn-pbb-evpn-
   05.txt.

   [draft-ietf-idr-link-bandwidth] P. Mohapatra, R. Fernando, "BGP Link
   Bandwidth Extended Community", draft-ietf-idr-link-bandwidth-06.txt



Authors' Addresses
 


Boutros                 Expires January 3, 2015                 [Page 8]

INTERNET DRAFT           VPWS support in E-VPN              July 2, 2014


   Sami Boutros
   Cisco 
   Email: sboutros@cisco.com

   Ali Sajassi
   Cisco
   Email: sajassi@cisco.com

   Samer Salam
   Cisco 
   Email: ssalam@cisco.com

   John Drake
   Juniper Networks
   Email: jdrake@juniper.net

   Jeff Tantsura
   Ericsson
   Email: jeff.tantsura@ericsson.com

   Dirk Steinberg
   Steinberg Consulting
   Email: dws@steinbergnet.net

   Patrice Brissette 
   Cisco
   Email: pbrisset@cisco.com

   Thomas Beckhaus
   Deutsche Telecom
   Email:Thomas.Beckhaus@telekom.de>




















Boutros                 Expires January 3, 2015                 [Page 9]
