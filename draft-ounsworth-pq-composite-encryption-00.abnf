i_last = n


C = CEK
Ei = encrypt(C, Pi, Ai)
Ei = encrypt(Si, Pi, Ai)

CEK = S1
CEK = CEK XOR Si

i_last = n


Ei_last = encrypt(CEK, Pi_last)

Si = emptyOctetString
Z = S1 || S2 || .. || Sn

M = KDF(Z)

Si = EMPTY_STRING
Z = S1 || S2 || .. || Sn

M = KDF(Z)

