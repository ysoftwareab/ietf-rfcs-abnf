<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>NAT64/DNS64 detection via SRV Records</title>
<meta content="Martin Hunek" name="author">
<meta content="
       This document specifies how to discover the NAT64 pools in use and DNS servers providing DNS64 service to the local clients. The discovery made via SRV records allows the assignment of priorities to the NAT64 pools and DNS64 servers. It also allows clients to have different DNS providers than NAT64 providers while providing a secure way via DNSSEC validation of provided SRV records. This way, it provides DNS64 service regardless of DNS operator and DNS transport protocol. 
    " name="description">
<meta content="xml2rfc 3.12.3" name="generator">
<meta content="NAT64 prefix detection" name="keyword">
<meta content="NAT64" name="keyword">
<meta content="DNS64" name="keyword">
<meta content="DNS" name="keyword">
<meta content="Third party resolver" name="keyword">
<meta content="draft-hunek-v6ops-nat64-srv-01" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.3
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.8.0
    MarkupSafe 2.0.1
    pycountry 22.1.10
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-hunek-v6ops-nat64-srv-cedlso1t.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">NAT64 SRV</td>
<td class="right">March 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Hunek</td>
<td class="center">Expires 7 September 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">IPv6 Operations</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-hunek-v6ops-nat64-srv-01</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-03" class="published">March 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-09-07">7 September 2022</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Hunek</div>
<div class="org">Technical University of Liberec</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">NAT64/DNS64 detection via SRV Records</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies how to discover the NAT64 pools in use and DNS servers providing DNS64 service to the local clients. The discovery made via SRV records allows the assignment of priorities to the NAT64 pools and DNS64 servers. It also allows clients to have different DNS providers than NAT64 providers while providing a secure way via DNSSEC validation of provided SRV records. This way, it provides DNS64 service regardless of DNS operator and DNS transport protocol.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo-7">
<a href="#name-status-of-this-memo-7" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 2 September 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice-7">
<a href="#name-copyright-notice-7" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents-7">
<a href="#name-table-of-contents-7" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction-6" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-requirements-language-2" class="xref">Requirements Language</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-terminology-2" class="xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-problems-with-current-solut" class="xref">Problems with Current Solutions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-dns-based-method" class="xref">DNS-based method</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-methods-based-on-other-prot" class="xref">Methods based on other protocols</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-local-domain-detection" class="xref">Local domain detection</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-nat64-service-srv-record" class="xref">NAT64 service SRV record</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-dns64-service-srv-record" class="xref">DNS64 service SRV record</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-node-behavior" class="xref">Node Behavior</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-interaction-with-other-meth" class="xref">Interaction with other methods</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-example" class="xref">Example</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-acknowledgements-5" class="xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-iana-considerations-7" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-security-considerations-7" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-references-5" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="xref">12.1</a>.  <a href="#name-normative-references-5" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="xref">12.2</a>.  <a href="#name-informative-references-7" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-address-2" class="xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction-6">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction-6" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The slower than expected adoption of the IPv6 resulted in the need for reliable transition mechanisms that shut down legacy protocols in the early adopters' network without waiting for latecomers. The transition mechanisms like NAT64/DNS64 or 464XLAT <span>[<a href="#RFC6877" class="xref">RFC6877</a>]</span> are essential in the transition between dual-stack networks and IPv6-only networks while not sacrificing the accessibility of the IPv4-only services. It is essential for these transition mechanisms to reliably and securely detect prefixes used for translation. Failing to do so, the IPv4-only services would not be accessible, or the traffic for these services could be kidnapped.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">There are multiple solutions for detecting NAT64 prefixes, but none of those are without problems and can fit different applications' needs. This document describes a new DNS-based method that could replace the method standardized by <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> and lately updated by <span>[<a href="#RFC8880" class="xref">RFC8880</a>]</span>, as this method is incompatible with DNSSEC and does have unrealistic prerequisites.<a href="#section-1-2" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-requirements-language-2">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-language-2" class="section-name selfRef">Requirements Language</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL 
        NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", 
        "MAY", and "OPTIONAL" in this document are to be interpreted as 
        described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span>
          <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in 
        all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-2">
      <h2 id="name-terminology-2">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology-2" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">CLAT: Customer-side translator as defined in <span>[<a href="#RFC6877" class="xref">RFC6877</a>]</span>.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Node: Either physical device or an application capable of performing DNS queries.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">NAT64 FQDN: a fully qualified domain name (FQDN) for a NAT64 protocol translator.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Pref64::/n: a IPv6 prefix used for IPv6 address synthesis <span>[<a href="#RFC6146" class="xref">RFC6146</a>]</span>.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">Pref64::WKA: an IPv6 address consisting of Pref64::/n and WKA at any of the locations 
                    allowed by RFC 6052 <span>[<a href="#RFC6052" class="xref">RFC6052</a>]</span>.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6">Secure Channel: a communication channel a Node has between itself and a DNS64 server protecting DNS protocol-related messages from interception and tampering. The Channel can be, for example, IPsec-based virtual private network (VPN) tunnel or a link-layer utilizing data encryption technologies.<a href="#section-2-6" class="pilcrow">¶</a></p>
<p id="section-2-7">Well-Known IPv4 Address (WKA): an IPv4 address that is well-known and present in an A record
       for the well-known name as defined in <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span>.<a href="#section-2-7" class="pilcrow">¶</a></p>
</section>
<div id="comparison">
<section id="section-3">
      <h2 id="name-problems-with-current-solut">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-problems-with-current-solut" class="section-name selfRef">Problems with Current Solutions</a>
      </h2>
<p id="section-3-1">For means of comparison, current solutions are split into two groups. The first one is the DNS-based solutions and the second one are solutions based on other protocols.<a href="#section-3-1" class="pilcrow">¶</a></p>
<section id="section-3.1">
        <h3 id="name-dns-based-method">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-dns-based-method" class="section-name selfRef">DNS-based method</a>
        </h3>
<p id="section-3.1-1">The DNS based method is represented by the current method of <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> updated by the <span>[<a href="#RFC8880" class="xref">RFC8880</a>]</span>. This method uses the Well-Known Name 'ipv4only.arpa.' with only an A record to detect DNS64 service. As this method depends on a specific DNS64 capable resolver with a specific NAT64 prefix, a client has to use the resolver provided by the NAT64 service provider. Furthermore, information about the NAT64 prefix in use is distributed only locally, so the third-party resolvers have no information about it, so they cannot provide DNS64 service for them.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">With the introduction of the DNS-over-HTTPS (DoH) <span>[<a href="#RFC8484" class="xref">RFC8484</a>]</span>, the introduction of the third-party resolver made the <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> unusable for clients using DoH. There is a quick fix provided by the <span>[<a href="#RFC8880" class="xref">RFC8880</a>]</span> that the Well-Known name should be treated differently - resolved by autoconfigured resolver on a specific outbound interface only. However, this would mean that the application/system stub resolver has to keep track of the source of configured DNS resolvers, which may be an unrealistic expectation.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">Another design property of the <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> is its incompatibility with the DNSSEC. In order for <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> to work, the DNSSEC has to be turned off, and even the detection phase of this method could not use it to verify the provided information. As the network operator does not own the 'arpa.' domain, it cannot properly sign the AAAA record for the Well-Known Name. Because of it, the first step of the NAT64 prefix detection is always insecure.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4">In order for <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> method to be secure, this method requires these prerequisites:<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-5.1">DNSSEC signed NAT64 FQDN<a href="#section-3.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-5.2">Corresponding PTR<a href="#section-3.1-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-5.3">Secure Channel between Node and resolver<a href="#section-3.1-5.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-5.4">Trusted domain list<a href="#section-3.1-5.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-5.5">No user input<a href="#section-3.1-5.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.1-6">The <span>[<a href="#RFC8880" class="xref">RFC8880</a>]</span> adds another set of prerequisites:<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-7.1">Stub resolver must distinguish between configuration sources of recursive DNS<a href="#section-3.1-7.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-7.2">Only autoconfiguration sources can provide recursive DNS to resolve Well-Known Name<a href="#section-3.1-7.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-7.3">Recursive DNS resolver is interface specific<a href="#section-3.1-7.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.1-8">Some of these listed prerequisites cannot be achieved in certain networks without prior provisioning of the Node. This includes recommended secure channel between a Node and DNS64 recursive resolver on shared network segments and the Trusted Domain List mandatory requirement that implicitly cannot be entered by a user. As not every Node is provisioned by a network operator, especially in smaller networks, and the generation process of the Trusted Domain List is not defined. The implementations of the <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> seems to ignore this requirement. However, without it, these implementations are insecure. This is due to the fact that the path between a Node and a resolver cannot be secured by the DNSSEC, and without Trusted Domain List, any arbitrary data can be injected into a Node configuration.<a href="#section-3.1-8" class="pilcrow">¶</a></p>
<p id="section-3.1-9">Requirements of the <span>[<a href="#RFC8880" class="xref">RFC8880</a>]</span> are also hard to implement strictly according to standard. The user-space application vendor that implements its own stub resolver would like to implement <span>[<a href="#RFC8880" class="xref">RFC8880</a>]</span> it would require access to the information about network configuration to keep track of which recursive DNS server has been received from which interface and from which protocol. Presenting such information to the user-space is not typical and requires system-level changes. Furthermore, when strictly following the <span>[<a href="#RFC8880" class="xref">RFC8880</a>]</span>, the network cannot use static configuration to have NAT64 functionality autoconfigured from the DNS.<a href="#section-3.1-9" class="pilcrow">¶</a></p>
</section>
<section id="section-3.2">
        <h3 id="name-methods-based-on-other-prot">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-methods-based-on-other-prot" class="section-name selfRef">Methods based on other protocols</a>
        </h3>
<p id="section-3.2-1">There are other solutions for detecting NAT64 prefixes based on various protocols. Namely <span>[<a href="#RFC7225" class="xref">RFC7225</a>]</span>, <span>[<a href="#RFC8115" class="xref">RFC8115</a>]</span> and <span>[<a href="#RFC8781" class="xref">RFC8781</a>]</span>. Regardless of the protocol used, these solutions have some common properties that limit their user-space use. If an application vendor would like to implement any of these methods, it would need to include a client implementation of an underlying protocol, or the system would need to provide an interface to obtain NAT64 prefix detected by these methods to the user-space application. This is much harder than making a DNS query inside an application.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">Another common property of these methods is an expectation of local DNS64 synthesis or CLAT presence on a Node. This may be the case for some Nodes, but others may depend on this functionality from the DNS64 resolver. For such Nodes, the DNS-based detection mechanism could be the preferred solution.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">It is fair to say that these methods are viable solutions for system-level NAT64 prefix detection - implementations of a system DNS stub resolver or CLAT daemon. These methods are not so easy to implement for user-space applications and daemons that are not so tightly integrated into an operating system.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="domain">
<section id="section-4">
      <h2 id="name-local-domain-detection">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-local-domain-detection" class="section-name selfRef">Local domain detection</a>
      </h2>
<p id="section-4-1">The Node should perform detection of the domain used by the network operator. A Node MAY use any source of such information, but a Node implementing the method described in this document MUST be able to use the PTR record for Node's unicast address as one of such source.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">A network operator that uses the method described in this document to distribute NAT64 configuration to Nodes connected to its network MUST provide a PTR record for every IPv6 address handed to the Node. The PTR record MUST have valid DNSSEC signature and MUST point to securely delegated zone with DNSSEC signed NAT64 SRV record. The SRV record itself MUST point to DNSSEC signed AAAA record and MAY also point to DNSSEC signed A record.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">Both Node and a network operator MAY use other sources of information about a local domain. If they decide to do so, the channel to provide such information MUST be secured against undetected data manipulation, as these sources may not provide the same level of security as the DNSSEC signed PTR record.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">Other sources of information about local domain MAY include (but are not limited to):<a href="#section-4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-5.1">Node's FQDN<a href="#section-4-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-5.2">Router Advertisement DNSSL option <span>[<a href="#RFC8106" class="xref">RFC8106</a>]</span><a href="#section-4-5.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-5.3">DHCPv6 options: 57, 24, 39, 74 or 118<a href="#section-4-5.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-6">At least when detection of the local domain is done by the PTR record, a Node MUST consider not only its FQDN as the detected local domain. When there is no SRV record associated with the detected domain name, a Node MUST disregard the lowest level domain (part of the domain name until the first dot) and repeat the detection process. This MUST be repeated until there is an SRV record associated with the domain name (even the empty "." one) or until the second level domain is reached. The same process MAY be deployed for other sources as well.<a href="#section-4-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="nat64_srv">
<section id="section-5">
      <h2 id="name-nat64-service-srv-record">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-nat64-service-srv-record" class="section-name selfRef">NAT64 service SRV record</a>
      </h2>
<p id="section-5-1">This document specifies two new well-known SRV records. The one for NAT64 prefix which Node MUST implement:<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">_nat64._ipv6.Name TTL Class SRV Priority Weight Port Target<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">The TTL, Class, Priority, and Weight follow the same scheme as defined in <span>[<a href="#RFC2782" class="xref">RFC2782</a>]</span> and have their standard meaning.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">Port: IPv6 as L3 protocol does not use port numbers. Because of that, this field SHOULD be either set to zero or SHOULD be used to indicate the length of network prefix length in both IPv6 and IPv4 protocol, used for NAT64. In such a case, the port 16b integer MUST be constructed by directly appending IPv4 pool prefix length after the IPv6 prefix length decimally. Usually, this would mean 9632, stating that the IPv6 prefix with a length of /96 is translated into a single IPv4 address (/32).<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">Target: MUST point to AAAA record formed from Pref64::/n prefix and WKA same way as in <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> (Pref64::WKA). The target MAY also point to A record, in which case it SHOULD point to the IPv4 address used for NAT64 (or base address of the NAT64 IPv4 prefix). A network operator MAY indicate to Node that NAT64 service is not provided by putting root domain target (".") into the SRV record. The Port field value should be set to zero for such a record, and Node MUST stop further NAT64 prefix detection for a given domain.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">Note: The target MAY also point to AAAA record of Any-Source Multicast prefix or Source-Specific Multicast prefix, similarly to <span>[<a href="#RFC8115" class="xref">RFC8115</a>]</span> this MAY be used to indicate a Node prefix used for multicast translation. For this reason, a Node MUST check address type before its use. One SRV record MUST NOT combine unicast and multicast targets, and in the case of a multicast target, the Port field value MUST be set to a value of 9600, and A record target MUST be ignored by a Node.<a href="#section-5-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="dns64_srv">
<section id="section-6">
      <h2 id="name-dns64-service-srv-record">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-dns64-service-srv-record" class="section-name selfRef">DNS64 service SRV record</a>
      </h2>
<p id="section-6-1">The second SRV record is for the discovery of the DNS64 service. Support of this record is OPTIONAL, but Node SHOULD implement it.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">_dns64.Protocol.Name TTL Class SRV Priority Weight Port Target<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">Record informs about location of DNS64 service. This record might be used if the network operator does not want to deploy DNS64 in their main DNS infrastructure. A DNS64 SRV record follows the rules specified by <span>[<a href="#RFC2782" class="xref">RFC2782</a>]</span> and does not modify the meaning of any field.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">Server provided by this record SHOULD only be used for domain names which have returned NODATA for AAAA record and for A record queries when a Node is not performing DNS64 function and is not using CLAT.<a href="#section-6-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="node">
<section id="section-7">
      <h2 id="name-node-behavior">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-node-behavior" class="section-name selfRef">Node Behavior</a>
      </h2>
<p id="section-7-1">In the initial stage of the Node connected to the network - after the Node is configured with an IP address; the Node MUST get local domains used in the network. The method of obtaining such information is described in the section <a href="#domain" class="xref">Local domain detection</a>. When no local domain can be discovered, the Node SHOULD continue NAT64/DNS64 detection by other means.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">After the list of local domains has been established, the Node MUST query for a NAT64 SRV record for every domain in the list. The result of such queries SHOULD be ordered by following the rules of <span>[<a href="#RFC2782" class="xref">RFC2782</a>]</span>. When multiple records have equal values of both priority and weight, the records SHOULD maintain the same order as its domain in the discovered domain list.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">If a Node is not configured to perform DNS64 address synthesis and is not using CLAT, it SHOULD perform a query for DNS64 SRV record for every discovered domain with NAT64 SRV record. If such a record is obtained, the Node SHOULD use preferred target of DNS64 SRV record to query for FQDNs without AAAA record - when Node received NODATA response for its query. Similarly, such Node SHOULD prefer target of DNS64 SRV record for any A record query (like caused by Happy Eye-Balls).<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">If the Node can validate DNS records via DNSSEC, the Node MUST perform validation of NAT64/DNS64 SRV record. The default behavior of Node SHOULD be to ignore any NAT64/DNS64 SRV records which cannot be validated or did not pass the validation.<a href="#section-7-4" class="pilcrow">¶</a></p>
<p id="section-7-5">Any information received from DNS MUST respect TTL of received records. The Node MUST perform a new detection before currently used information expires. This also applies to information received from other sources that include expiration.<a href="#section-7-5" class="pilcrow">¶</a></p>
<section id="section-7.1">
        <h3 id="name-interaction-with-other-meth">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-interaction-with-other-meth" class="section-name selfRef">Interaction with other methods</a>
        </h3>
<p id="section-7.1-1">Proposed method does not aim to replace all other NAT64 prefix detection methods. In fact, it should be the network operator who should decide which detection method should be used in the network and which should have a preference. One advantage of using SRV records for NAT64 detection is their Priority and Weight fields that allows to communicate such preference to a Node.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">In accordance with the latest detection method the <span>[<a href="#RFC8781" class="xref">RFC8781</a>]</span>, other detection method should be treated equally to SRV method with following Priority and Weight fields:<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<span id="name-default-priorities-of-other"></span><div id="priorities">
<table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-default-priorities-of-other" class="selfRef">Default priorities of other methods</a>
          </caption>
<thead>
            <tr>
              <th class="text-center" rowspan="1" colspan="1">Method</th>
              <th class="text-center" rowspan="1" colspan="1">Priority</th>
              <th class="text-center" rowspan="1" colspan="1">Weight</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">RFC8115</td>
              <td class="text-center" rowspan="1" colspan="1">100</td>
              <td class="text-center" rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">RFC7225</td>
              <td class="text-center" rowspan="1" colspan="1">150</td>
              <td class="text-center" rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">RFC8781</td>
              <td class="text-center" rowspan="1" colspan="1">200</td>
              <td class="text-center" rowspan="1" colspan="1">0</td>
            </tr>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">RFC7050</td>
              <td class="text-center" rowspan="1" colspan="1">250</td>
              <td class="text-center" rowspan="1" colspan="1">0</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-7.1-4">If a network operator prefers another method than the SRV method and wants to provide the SRV method as a fallback, it should set the priority field of the NAT64 SRV record to a higher value than specified for a method that should be used as a primary. For example, when a network operator uses Router Advertisement to distribute NAT64 prefix information to its network and also wants to use the SRV method as a fallback; it should set Priority field to number higher than 200.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5">It is RECOMMENDED that network operators SHOULD NOT use values higher than 249 in the Priority field of the NAT64 SRV record unless they want to use <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> as a primary source of NAT64 prefix configuration, and they have all Nodes connected in their network properly configured for this. In order for this configuration to be safe, the Nodes MUST follow all the mandatory and optional requirements of both <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> and <span>[<a href="#RFC8880" class="xref">RFC8880</a>]</span>. Otherwise, the <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> SHOULD NOT be used as a primary configuration source.<a href="#section-7.1-5" class="pilcrow">¶</a></p>
<p id="section-7.1-6">Default priority values on Node SHOULD be user-configurable.<a href="#section-7.1-6" class="pilcrow">¶</a></p>
<p id="section-7.1-7">A Node SHOULD start the NAT64 detection process by performing the SRV method. If it is successful and the SRV record Priority field value is lower than configured values for other methods, the Node MUST NOT use other detection methods. If the Priority value is higher than configured Priority value of any other methods, the Node SHOULD also perform detection methods with the lower priority values. Detection SHOULD be done starting from the lowest configured Priority value to the highest. The successful completion of any detection method MUST stop further detection.<a href="#section-7.1-7" class="pilcrow">¶</a></p>
<p id="section-7.1-8">Similarly, the DNS64 function of the recursive resolver in use SHOULD be treated equally to the DNS64 SRV record with the Priority field value of 250. If the Node supports the DNS64 SRV record, Node is not performing DNS64 function, it is not using CLAT and the DNS64 SRV record has a lower Priority field value; the A record queries MUST be sent to the target of such SRV record instead of Node's default recursive resolver.<a href="#section-7.1-8" class="pilcrow">¶</a></p>
<p id="section-7.1-9">Regardless of the detection method used for DNS64 discovery, the Node MUST NOT accept any DNS64 synthesized AAAA record outside detected NAT64 prefixes.<a href="#section-7.1-9" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="example">
<section id="section-8">
      <h2 id="name-example">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-example" class="section-name selfRef">Example</a>
      </h2>
<p id="section-8-1">The Node is a home router connected to the ISP network in which the NAT64/DNS64 is used, and the ISP has the following SRV records in their zones:<a href="#section-8-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-2.1">nat64.ipv6.example.com. IN SRV 5 10 9632 nat64-pool-1.example.com.<a href="#section-8-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.2">nat64-pool-1.example.com. IN AAAA 2001:db8:64:ff9b:1::c000:aa<a href="#section-8-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.3">nat64-pool-1.example.com. IN A 192.0.2.64<a href="#section-8-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.4">nat64.ipv6.example.com. IN SRV 10 10 9632 nat64-pool-2.example.com.<a href="#section-8-2.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.5">nat64-pool-2.example.com. IN AAAA 2001:db8:64:ff9b:2::c000:aa<a href="#section-8-2.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.6">nat64-pool-2.example.com. IN A 192.0.2.164<a href="#section-8-2.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.7">nat64.ipv6.example.net. IN SRV 10 10 9624 nat64-pool.example.net.<a href="#section-8-2.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.8">nat64-pool.example.net. IN AAAA 2001:db8:64:ff9b:abc::c000:aa<a href="#section-8-2.8" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.9">nat64-pool.example.net. IN A 198.51.100.0<a href="#section-8-2.9" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.10">nat64.ipv6.example.invalid. IN SRV 10 10 9624 nat64-pool.example.org.<a href="#section-8-2.10" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.11">nat64-pool.example.org. IN AAAA 2001:db8:64:ff9b:def::c000:aa<a href="#section-8-2.11" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-2.12">nat64-pool.example.org. IN A 203.0.113.0<a href="#section-8-2.12" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-8-3">In addition, the zones "example.net" and "example.invalid" has got DNS64 SRV records:<a href="#section-8-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-4.1">dns64.tcp.example.net. IN SRV 5 10 53 dns64.example.net.<a href="#section-8-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-4.2">dns64.udp.example.net. IN SRV 10 10 53 dns64.example.net.<a href="#section-8-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-4.3">dns64.example.net. IN AAAA 2001:db8::53<a href="#section-8-4.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-4.4">dns64.udp.example.invalid. IN SRV 10 10 53 dns64.example.org.<a href="#section-8-4.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-4.5">dns64.example.org. IN AAAA 2001:db8:123::53<a href="#section-8-4.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-8-5">The Node has detected the following list of domains:<a href="#section-8-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="olPercent" id="section-8-6">
<dt>1.</dt>
<dd id="section-8-6.1">example.net<a href="#section-8-6.1" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt>2.</dt>
<dd id="section-8-6.2">example.invalid<a href="#section-8-6.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt>3.</dt>
<dd id="section-8-6.3">example.com<a href="#section-8-6.3" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt>4.</dt>
<dd id="section-8-6.4">example.org<a href="#section-8-6.4" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<p id="section-8-7">The Node would fetch all available SRV records and their A and AAAA counterparts and sort them in the following order:<a href="#section-8-7" class="pilcrow">¶</a></p>
<span id="name-detectected-prefixes"></span><div id="det_pref">
<table class="center" id="table-2">
        <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-detectected-prefixes" class="selfRef">Detectected Prefixes</a>
        </caption>
<thead>
          <tr>
            <th class="text-center" rowspan="1" colspan="1">Pool</th>
            <th class="text-center" rowspan="1" colspan="1">DNSSEC</th>
            <th class="text-center" rowspan="1" colspan="1">Priority</th>
            <th class="text-center" rowspan="1" colspan="1">Reason</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">nat64-pool-1.example.com.</td>
            <td class="text-center" rowspan="1" colspan="1">yes</td>
            <td class="text-center" rowspan="1" colspan="1">5</td>
            <td class="text-center" rowspan="1" colspan="1">lowest priority field</td>
          </tr>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">nat64-pool.example.net.</td>
            <td class="text-center" rowspan="1" colspan="1">yes</td>
            <td class="text-center" rowspan="1" colspan="1">10</td>
            <td class="text-center" rowspan="1" colspan="1">discovered first</td>
          </tr>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">nat64-pool-2.example.net.</td>
            <td class="text-center" rowspan="1" colspan="1">yes</td>
            <td class="text-center" rowspan="1" colspan="1">10</td>
            <td class="text-center" rowspan="1" colspan="1">higher priority field</td>
          </tr>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">nat64-pool.example.org.</td>
            <td class="text-center" rowspan="1" colspan="1">no</td>
            <td class="text-center" rowspan="1" colspan="1">10</td>
            <td class="text-center" rowspan="1" colspan="1">no valid DNSSEC chain</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-8-9">After sorting, the DNSSEC validating Node SHOULD graylist any record which cannot be validated by the DNSSEC. This example would be "nat64-pool.example.org." because it has been obtained from insecure domain "example.invalid". Such pool SHOULD NOT be used if it is not confirmed by other DNSSEC secured record.<a href="#section-8-9" class="pilcrow">¶</a></p>
<p id="section-8-10">If the Node can act as a recursive or caching DNS server and it is configured to provide the DNS64 service, it MUST provide this service using a sorted list of NAT64 pools. For such Node, the process of the NAT64/DNS64 ends here.<a href="#section-8-10" class="pilcrow">¶</a></p>
<p id="section-8-11">However, when the Node is not capable of performing AAAA record synthesis or it is not configured to provide DNS64 service, and it is not using CLAT, it MUST perform detection of DNS64.<a href="#section-8-11" class="pilcrow">¶</a></p>
<p id="section-8-12">When the Node supports the DNS64 SRV record, it MUST make a sorted list of DNS64 servers from the DNS64 SRV records. If the Priority field of the corresponding DNS64 record is higher than 250, and when the Node does not support the DNS64 SRV record; the Node MUST perform DNS64 detection for specified NAT64 pool by the <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span> method.<a href="#section-8-12" class="pilcrow">¶</a></p>
<p id="section-8-13">The detection, according to <span>[<a href="#RFC7050" class="xref">RFC7050</a>]</span>, should be done by querying for "ipv4only.arpa". If the reply contains a pool listed in the NAT64 pool list, the corresponding entry is marked as having DNS64 provided by recursive DNS.<a href="#section-8-13" class="pilcrow">¶</a></p>
<p id="section-8-14">The DNS64 sorted list would look like this:<a href="#section-8-14" class="pilcrow">¶</a></p>
<span id="name-detectected-dns64-servers"></span><div id="det_dns">
<table class="center" id="table-3">
        <caption>
<a href="#table-3" class="selfRef">Table 3</a>:
<a href="#name-detectected-dns64-servers" class="selfRef">Detectected DNS64 Servers</a>
        </caption>
<thead>
          <tr>
            <th class="text-center" rowspan="1" colspan="1">Server</th>
            <th class="text-center" rowspan="1" colspan="1">Proto</th>
            <th class="text-center" rowspan="1" colspan="1">DNSSEC</th>
            <th class="text-center" rowspan="1" colspan="1">Priority</th>
            <th class="text-center" rowspan="1" colspan="1">Reason</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">dns64.example.net.</td>
            <td class="text-center" rowspan="1" colspan="1">tcp</td>
            <td class="text-center" rowspan="1" colspan="1">yes</td>
            <td class="text-center" rowspan="1" colspan="1">5</td>
            <td class="text-center" rowspan="1" colspan="1">lowest priority field</td>
          </tr>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">dns64.example.net.</td>
            <td class="text-center" rowspan="1" colspan="1">udp</td>
            <td class="text-center" rowspan="1" colspan="1">yes</td>
            <td class="text-center" rowspan="1" colspan="1">10</td>
            <td class="text-center" rowspan="1" colspan="1">higher priority field</td>
          </tr>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">dns64.example.org.</td>
            <td class="text-center" rowspan="1" colspan="1">udp</td>
            <td class="text-center" rowspan="1" colspan="1">no</td>
            <td class="text-center" rowspan="1" colspan="1">10</td>
            <td class="text-center" rowspan="1" colspan="1">no valid DNSSEC chain</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-8-16">Sorting is done in the same fashion as any other SRV record with the same exception of graylisting records without a valid DNSSEC chain. Those SHOULD NOT be used when not confirmed by DNSSEC validated record and SHOULD be kept at the end of the list.<a href="#section-8-16" class="pilcrow">¶</a></p>
<p id="section-8-17">For example, when ISP is providing DNS64 service in their main DNS infrastructure only for pools in the domains "example.com" and "example.org" and the pool "nat64-pool.example.net" is used only with corresponding DNS64 server. The final sorted list of NAT64 prefixes used by the Node in the ISP network would be:<a href="#section-8-17" class="pilcrow">¶</a></p>
<span id="name-used-prefixes"></span><div id="used_pref">
<table class="center" id="table-4">
        <caption>
<a href="#table-4" class="selfRef">Table 4</a>:
<a href="#name-used-prefixes" class="selfRef">Used Prefixes</a>
        </caption>
<thead>
          <tr>
            <th class="text-center" rowspan="1" colspan="1">Pool</th>
            <th class="text-center" rowspan="1" colspan="1">State</th>
            <th class="text-center" rowspan="1" colspan="1">Priority</th>
            <th class="text-center" rowspan="1" colspan="1">Reason</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">nat64-pool-1.example.com.</td>
            <td class="text-center" rowspan="1" colspan="1">active</td>
            <td class="text-center" rowspan="1" colspan="1">5</td>
            <td class="text-center" rowspan="1" colspan="1">lowest priority field</td>
          </tr>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">nat64-pool-2.example.net.</td>
            <td class="text-center" rowspan="1" colspan="1">backup</td>
            <td class="text-center" rowspan="1" colspan="1">10</td>
            <td class="text-center" rowspan="1" colspan="1">higher priority field</td>
          </tr>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">nat64-pool.example.net.</td>
            <td class="text-center" rowspan="1" colspan="1">active*</td>
            <td class="text-center" rowspan="1" colspan="1">10</td>
            <td class="text-center" rowspan="1" colspan="1">only DNS64 SRV capable Node</td>
          </tr>
          <tr>
            <td class="text-center" rowspan="1" colspan="1">nat64-pool.example.org.</td>
            <td class="text-center" rowspan="1" colspan="1">inactive</td>
            <td class="text-center" rowspan="1" colspan="1">10</td>
            <td class="text-center" rowspan="1" colspan="1">no valid DNSSEC chain</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-8-19">As the pool "nat64-pool.example.net" is used only with the server "dns64.example.net", this would effectively make it usable only for Nodes supporting DNS64 SRV and not running DNS64 locally or not using CLAT. For such Nodes, this pool would have priority over others because lower Priority field value of the DNS64 SRV record.<a href="#section-8-19" class="pilcrow">¶</a></p>
<p id="section-8-20">Now, the Node has successfully identified NAT64 pools and the DNS64 servers in the ISP infrastructure. The discovered prefixes SHOULD be considered safe, and DNSSEC validation of answers in these prefixes, when a remote recursive resolver does the DNS64 synthesis, it MUST be either disabled or performed by validating only the suffix.<a href="#section-8-20" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Acknowledgements">
<section id="section-9">
      <h2 id="name-acknowledgements-5">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-acknowledgements-5" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-9-1">The author of this document would like to thank Lee Howard, Gert Doering, Fred Baker, Philip Homburg, Mikael Abrahamsson, Jordi Palet Martinez, Gabor Lencse, Dan Wing for their valuable comments.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IANA">
<section id="section-10">
      <h2 id="name-iana-considerations-7">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations-7" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">This document proposes two services, "_nat64" and "_dns64" in Service field of SRV RR (<span>[<a href="#RFC2782" class="xref">RFC2782</a>]</span>).<a href="#section-10-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Security">
<section id="section-11">
      <h2 id="name-security-considerations-7">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-security-considerations-7" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-11-1">The method proposed by this document relies on security principles based on DNSSEC and secure discovery of local domain. In order to be secure, the network operator MUST deploy DNSSEC on at least one domain (advertised to the Node), establish a secure channel to this advertisement, or provide every IPv6 address given to a Node with DNSSEC secured PTR record.<a href="#section-11-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-12">
      <h2 id="name-references-5">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-references-5" class="section-name selfRef">References</a>
      </h2>
<section id="section-12.1">
        <h3 id="name-normative-references-5">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-normative-references-5" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2782">[RFC2782]</dt>
        <dd>
<span class="refAuthor">Gulbrandsen, A.</span>, <span class="refAuthor">Vixie, P.</span>, and <span class="refAuthor">L. Esibov</span>, <span class="refTitle">"A DNS RR for specifying the location of services (DNS SRV)"</span>, <span class="seriesInfo">RFC 2782</span>, <span class="seriesInfo">DOI 10.17487/RFC2782</span>, <time datetime="2000-02" class="refDate">February 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2782">https://www.rfc-editor.org/info/rfc2782</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6146">[RFC6146]</dt>
        <dd>
<span class="refAuthor">Bagnulo, M.</span>, <span class="refAuthor">Matthews, P.</span>, and <span class="refAuthor">I. van Beijnum</span>, <span class="refTitle">"Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers"</span>, <span class="seriesInfo">RFC 6146</span>, <span class="seriesInfo">DOI 10.17487/RFC6146</span>, <time datetime="2011-04" class="refDate">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6146">https://www.rfc-editor.org/info/rfc6146</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7050">[RFC7050]</dt>
        <dd>
<span class="refAuthor">Savolainen, T.</span>, <span class="refAuthor">Korhonen, J.</span>, and <span class="refAuthor">D. Wing</span>, <span class="refTitle">"Discovery of the IPv6 Prefix Used for IPv6 Address Synthesis"</span>, <span class="seriesInfo">RFC 7050</span>, <span class="seriesInfo">DOI 10.17487/RFC7050</span>, <time datetime="2013-11" class="refDate">November 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7050">https://www.rfc-editor.org/info/rfc7050</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-12.2">
        <h3 id="name-informative-references-7">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-informative-references-7" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC6052">[RFC6052]</dt>
        <dd>
<span class="refAuthor">Bao, C.</span>, <span class="refAuthor">Huitema, C.</span>, <span class="refAuthor">Bagnulo, M.</span>, <span class="refAuthor">Boucadair, M.</span>, and <span class="refAuthor">X. Li</span>, <span class="refTitle">"IPv6 Addressing of IPv4/IPv6 Translators"</span>, <span class="seriesInfo">RFC 6052</span>, <span class="seriesInfo">DOI 10.17487/RFC6052</span>, <time datetime="2010-10" class="refDate">October 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6052">https://www.rfc-editor.org/info/rfc6052</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6877">[RFC6877]</dt>
        <dd>
<span class="refAuthor">Mawatari, M.</span>, <span class="refAuthor">Kawashima, M.</span>, and <span class="refAuthor">C. Byrne</span>, <span class="refTitle">"464XLAT: Combination of Stateful and Stateless Translation"</span>, <span class="seriesInfo">RFC 6877</span>, <span class="seriesInfo">DOI 10.17487/RFC6877</span>, <time datetime="2013-04" class="refDate">April 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6877">https://www.rfc-editor.org/info/rfc6877</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7225">[RFC7225]</dt>
        <dd>
<span class="refAuthor">Boucadair, M.</span>, <span class="refTitle">"Discovering NAT64 IPv6 Prefixes Using the Port Control Protocol (PCP)"</span>, <span class="seriesInfo">RFC 7225</span>, <span class="seriesInfo">DOI 10.17487/RFC7225</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7225">https://www.rfc-editor.org/info/rfc7225</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8106">[RFC8106]</dt>
        <dd>
<span class="refAuthor">Jeong, J.</span>, <span class="refAuthor">Park, S.</span>, <span class="refAuthor">Beloeil, L.</span>, and <span class="refAuthor">S. Madanapalli</span>, <span class="refTitle">"IPv6 Router Advertisement Options for DNS Configuration"</span>, <span class="seriesInfo">RFC 8106</span>, <span class="seriesInfo">DOI 10.17487/RFC8106</span>, <time datetime="2017-03" class="refDate">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8106">https://www.rfc-editor.org/info/rfc8106</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8115">[RFC8115]</dt>
        <dd>
<span class="refAuthor">Boucadair, M.</span>, <span class="refAuthor">Qin, J.</span>, <span class="refAuthor">Tsou, T.</span>, and <span class="refAuthor">X. Deng</span>, <span class="refTitle">"DHCPv6 Option for IPv4-Embedded Multicast and Unicast IPv6 Prefixes"</span>, <span class="seriesInfo">RFC 8115</span>, <span class="seriesInfo">DOI 10.17487/RFC8115</span>, <time datetime="2017-03" class="refDate">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8115">https://www.rfc-editor.org/info/rfc8115</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8484">[RFC8484]</dt>
        <dd>
<span class="refAuthor">Hoffman, P.</span> and <span class="refAuthor">P. McManus</span>, <span class="refTitle">"DNS Queries over HTTPS (DoH)"</span>, <span class="seriesInfo">RFC 8484</span>, <span class="seriesInfo">DOI 10.17487/RFC8484</span>, <time datetime="2018-10" class="refDate">October 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8484">https://www.rfc-editor.org/info/rfc8484</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8781">[RFC8781]</dt>
        <dd>
<span class="refAuthor">Colitti, L.</span> and <span class="refAuthor">J. Linkova</span>, <span class="refTitle">"Discovering PREF64 in Router Advertisements"</span>, <span class="seriesInfo">RFC 8781</span>, <span class="seriesInfo">DOI 10.17487/RFC8781</span>, <time datetime="2020-04" class="refDate">April 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8781">https://www.rfc-editor.org/info/rfc8781</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8880">[RFC8880]</dt>
      <dd>
<span class="refAuthor">Cheshire, S.</span> and <span class="refAuthor">D. Schinazi</span>, <span class="refTitle">"Special Use Domain Name 'ipv4only.arpa'"</span>, <span class="seriesInfo">RFC 8880</span>, <span class="seriesInfo">DOI 10.17487/RFC8880</span>, <time datetime="2020-08" class="refDate">August 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8880">https://www.rfc-editor.org/info/rfc8880</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-address-2">
<a href="#name-authors-address-2" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Martin Hunek</span></div>
<div dir="auto" class="left"><span class="org">Technical University of Liberec</span></div>
<div dir="auto" class="left"><span class="street-address">Studentska 1402/2</span></div>
<div dir="auto" class="left">
<span class="postal-code">46017</span> <span class="locality">Liberec</span>
</div>
<div dir="auto" class="left"><span class="country-name">Czechia</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:martin.hunek@tul.cz" class="email">martin.hunek@tul.cz</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
