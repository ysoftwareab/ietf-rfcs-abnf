<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Diameter Network Address and Port Translation Control Application</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions">
<link href="#rfc.section.3" rel="Chapter" title="3 Deployment Framework">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Deployment Scenario">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Diameter NAPT Control Application Overview">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Deployment Scenarios For DNCA">
<link href="#rfc.section.4" rel="Chapter" title="4 DNCA Session Establishment and Management">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Parties Involved ">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Session Establishment">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Session Re-Authorization">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Session and Binding Query">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Session Termination">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 DNCA Manager and Agent Failures">
<link href="#rfc.section.5" rel="Chapter" title="5 Use Of The Diameter Base Protocol">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Securing Diameter Messages ">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Accounting Functionality">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Use Of Sessions">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Routing Considerations">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Advertising Application Support">
<link href="#rfc.section.6" rel="Chapter" title="6 DNCA Commands">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 NAT-Control Request (NCR) Command">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 NAT-Control Answer (NCA) Command">
<link href="#rfc.section.7" rel="Chapter" title="7 NAT Control Application Session State Machine">
<link href="#rfc.section.8" rel="Chapter" title="8 DNCA AVPs">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Reused Base Protocol AVPs">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Additional Result-Code AVP Values">
<link href="#rfc.section.8.2.1" rel="Chapter" title="8.2.1 Success">
<link href="#rfc.section.8.2.2" rel="Chapter" title="8.2.2 Transient Failures">
<link href="#rfc.section.8.2.3" rel="Chapter" title="8.2.3 Permanent Failures ">
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Reused NASREQ Diameter Application AVPs">
<link href="#rfc.section.8.4" rel="Chapter" title="8.4 Reused from RFC 4675 ">
<link href="#rfc.section.8.5" rel="Chapter" title="8.5 Reused from Diameter QoS Application">
<link href="#rfc.section.8.6" rel="Chapter" title="8.6 Reused from ETSI ES 283 034, e4 Diameter Application">
<link href="#rfc.section.8.7" rel="Chapter" title="8.7 DNCA Defined AVPs">
<link href="#rfc.section.8.7.1" rel="Chapter" title="8.7.1 NC-Request-Type AVP">
<link href="#rfc.section.8.7.2" rel="Chapter" title="8.7.2 NAT-Control-Install AVP">
<link href="#rfc.section.8.7.3" rel="Chapter" title="8.7.3 NAT-Control-Remove AVP">
<link href="#rfc.section.8.7.4" rel="Chapter" title="8.7.4 NAT-Control-Definition AVP">
<link href="#rfc.section.8.7.5" rel="Chapter" title="8.7.5 NAT-Internal-Address AVP">
<link href="#rfc.section.8.7.6" rel="Chapter" title="8.7.6 NAT-External-Address AVP">
<link href="#rfc.section.8.7.7" rel="Chapter" title="8.7.7 Max-NAT-Bindings">
<link href="#rfc.section.8.7.8" rel="Chapter" title="8.7.8 NAT-Control-Binding-Rule AVP">
<link href="#rfc.section.8.7.9" rel="Chapter" title="8.7.9 Duplicate-Session-Id AVP">
<link href="#rfc.section.9" rel="Chapter" title="9 Accounting Commands">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 NAT Control Accounting Messages">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 NAT Control Accounting AVPs">
<link href="#rfc.section.9.2.1" rel="Chapter" title="9.2.1 NAT-Control-Record">
<link href="#rfc.section.9.2.2" rel="Chapter" title="9.2.2 NAT-Control-Binding-Status">
<link href="#rfc.section.9.2.3" rel="Chapter" title="9.2.3 Current-NAT-Bindings">
<link href="#rfc.section.10" rel="Chapter" title="10 AVP Occurrence Table">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 DNCA AVP Table for NAT Control Initial and Update Requests">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 DNCA AVP Table for Session Query request">
<link href="#rfc.section.10.3" rel="Chapter" title="10.3 DNCA AVP Table for Accounting Message">
<link href="#rfc.section.11" rel="Chapter" title="11 IANA Considerations">
<link href="#rfc.section.11.1" rel="Chapter" title="11.1 Command Codes">
<link href="#rfc.section.11.2" rel="Chapter" title="11.2 AVP Codes">
<link href="#rfc.section.11.3" rel="Chapter" title="11.3 AVP Values">
<link href="#rfc.section.11.3.1" rel="Chapter" title="11.3.1 Result-Code AVP Values">
<link href="#rfc.section.11.4" rel="Chapter" title="11.4 Application IDs">
<link href="#rfc.section.12" rel="Chapter" title="12 Security Considerations">
<link href="#rfc.section.13" rel="Chapter" title="13 Acknowledgements">
<link href="#rfc.section.14" rel="Chapter" title="14 Change History (to be removed prior to publication as an RFC) ">
<link href="#rfc.references" rel="Chapter" title="15 References">
<link href="#rfc.references.1" rel="Chapter" title="15.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="15.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes the framework, messages, and procedures for the Diameter Network address and port translation Control Application.  This Diameter application allows per endpoint control of Network Address Translators and Network Address and Port Translators, which are added to cope with IPv4-address space completion. This Diameter application allows external devices to configure and manage a Network Address Translator device - expanding the existing Diameter-based AAA and policy control capabilities with a Network Address Translators and Network Address and Port Translators control component. These external devices can be network elements in the data plane such as a Network Access Server, or can be more centralized control plane devices such as AAA-servers. This Diameter application establishes a context to commonly identify and manage endpoints on a gateway or server, and a Network Address Translator and Network Address and Port Translator device. This includes, for example, the control of the total number of Network Address Translator bindings allowed or the allocation of a specific Network Address Translator binding for a particular endpoint. In addition, it allows Network Address Translator devices to provide information relevant to accounting purposes." />
  <meta name="description" content="This document describes the framework, messages, and procedures for the Diameter Network address and port translation Control Application.  This Diameter application allows per endpoint control of Network Address Translators and Network Address and Port Translators, which are added to cope with IPv4-address space completion. This Diameter application allows external devices to configure and manage a Network Address Translator device - expanding the existing Diameter-based AAA and policy control capabilities with a Network Address Translators and Network Address and Port Translators control component. These external devices can be network elements in the data plane such as a Network Access Server, or can be more centralized control plane devices such as AAA-servers. This Diameter application establishes a context to commonly identify and manage endpoints on a gateway or server, and a Network Address Translator and Network Address and Port Translator device. This includes, for example, the control of the total number of Network Address Translator bindings allowed or the allocation of a specific Network Address Translator binding for a particular endpoint. In addition, it allows Network Address Translator devices to provide information relevant to accounting purposes." />
  <meta name="keywords" content="ds-lite" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Internet Engineering Task Force</td>
<td class="right">F. Brockners</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">S. Bhandari</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Cisco</td>
</tr>
<tr>
<td class="left">Expires: August 20, 2011</td>
<td class="right">V. Singh</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">V. Fajardo</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Telcordia Technologies</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">February 16, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Diameter Network Address and Port Translation Control Application<br />
  <span class="filename">draft-ietf-dime-nat-control-07</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes the framework, messages, and procedures for the Diameter Network address and port translation Control Application.  This Diameter application allows per endpoint control of Network Address Translators and Network Address and Port Translators, which are added to cope with IPv4-address space completion. This Diameter application allows external devices to configure and manage a Network Address Translator device - expanding the existing Diameter-based AAA and policy control capabilities with a Network Address Translators and Network Address and Port Translators control component. These external devices can be network elements in the data plane such as a Network Access Server, or can be more centralized control plane devices such as AAA-servers. This Diameter application establishes a context to commonly identify and manage endpoints on a gateway or server, and a Network Address Translator and Network Address and Port Translator device. This includes, for example, the control of the total number of Network Address Translator bindings allowed or the allocation of a specific Network Address Translator binding for a particular endpoint. In addition, it allows Network Address Translator devices to provide information relevant to accounting purposes.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 20, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions</a>
</li>
<li>3.   <a href="#rfc.section.3">Deployment Framework</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Deployment Scenario</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Diameter NAPT Control Application Overview</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Deployment Scenarios For DNCA</a>
</li>
<li>4.   <a href="#rfc.section.4">DNCA Session Establishment and Management</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Parties Involved </a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Session Establishment</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Session Re-Authorization</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Session and Binding Query</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Session Termination</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">DNCA Manager and Agent Failures</a>
</li>
<li>5.   <a href="#rfc.section.5">Use Of The Diameter Base Protocol</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Securing Diameter Messages </a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Accounting Functionality</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Use Of Sessions</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Routing Considerations</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">Advertising Application Support</a>
</li>
<li>6.   <a href="#rfc.section.6">DNCA Commands</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">NAT-Control Request (NCR) Command</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">NAT-Control Answer (NCA) Command</a>
</li>
<li>7.   <a href="#rfc.section.7">NAT Control Application Session State Machine</a>
</li>
<li>8.   <a href="#rfc.section.8">DNCA AVPs</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Reused Base Protocol AVPs</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Additional Result-Code AVP Values</a>
</li>
<li>8.2.1.   <a href="#rfc.section.8.2.1">Success</a>
</li>
<li>8.2.2.   <a href="#rfc.section.8.2.2">Transient Failures</a>
</li>
<li>8.2.3.   <a href="#rfc.section.8.2.3">Permanent Failures </a>
</li>
<li>8.3.   <a href="#rfc.section.8.3">Reused NASREQ Diameter Application AVPs</a>
</li>
<li>8.4.   <a href="#rfc.section.8.4">Reused from RFC 4675 </a>
</li>
<li>8.5.   <a href="#rfc.section.8.5">Reused from Diameter QoS Application</a>
</li>
<li>8.6.   <a href="#rfc.section.8.6">Reused from ETSI ES 283 034, e4 Diameter Application</a>
</li>
<li>8.7.   <a href="#rfc.section.8.7">DNCA Defined AVPs</a>
</li>
<li>8.7.1.   <a href="#rfc.section.8.7.1">NC-Request-Type AVP</a>
</li>
<li>8.7.2.   <a href="#rfc.section.8.7.2">NAT-Control-Install AVP</a>
</li>
<li>8.7.3.   <a href="#rfc.section.8.7.3">NAT-Control-Remove AVP</a>
</li>
<li>8.7.4.   <a href="#rfc.section.8.7.4">NAT-Control-Definition AVP</a>
</li>
<li>8.7.5.   <a href="#rfc.section.8.7.5">NAT-Internal-Address AVP</a>
</li>
<li>8.7.6.   <a href="#rfc.section.8.7.6">NAT-External-Address AVP</a>
</li>
<li>8.7.7.   <a href="#rfc.section.8.7.7">Max-NAT-Bindings</a>
</li>
<li>8.7.8.   <a href="#rfc.section.8.7.8">NAT-Control-Binding-Rule AVP</a>
</li>
<li>8.7.9.   <a href="#rfc.section.8.7.9">Duplicate-Session-Id AVP</a>
</li>
<li>9.   <a href="#rfc.section.9">Accounting Commands</a>
</li>
<li>9.1.   <a href="#rfc.section.9.1">NAT Control Accounting Messages</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">NAT Control Accounting AVPs</a>
</li>
<li>9.2.1.   <a href="#rfc.section.9.2.1">NAT-Control-Record</a>
</li>
<li>9.2.2.   <a href="#rfc.section.9.2.2">NAT-Control-Binding-Status</a>
</li>
<li>9.2.3.   <a href="#rfc.section.9.2.3">Current-NAT-Bindings</a>
</li>
<li>10.   <a href="#rfc.section.10">AVP Occurrence Table</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">DNCA AVP Table for NAT Control Initial and Update Requests</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">DNCA AVP Table for Session Query request</a>
</li>
<li>10.3.   <a href="#rfc.section.10.3">DNCA AVP Table for Accounting Message</a>
</li>
<li>11.   <a href="#rfc.section.11">IANA Considerations</a>
</li>
<li>11.1.   <a href="#rfc.section.11.1">Command Codes</a>
</li>
<li>11.2.   <a href="#rfc.section.11.2">AVP Codes</a>
</li>
<li>11.3.   <a href="#rfc.section.11.3">AVP Values</a>
</li>
<li>11.3.1.   <a href="#rfc.section.11.3.1">Result-Code AVP Values</a>
</li>
<li>11.4.   <a href="#rfc.section.11.4">Application IDs</a>
</li>
<li>12.   <a href="#rfc.section.12">Security Considerations</a>
</li>
<li>13.   <a href="#rfc.section.13">Acknowledgements</a>
</li>
<li>14.   <a href="#rfc.section.14">Change History (to be removed prior to publication as an RFC) </a>
</li>
<li>15.   <a href="#rfc.references">References</a>
</li>
<li>15.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>15.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Internet service providers have started to deploy Network Address Translators (NATs) and Network Address and Port Translators (NAPTs) at the edge of their networks to deal with the depletion of available public IPv4 addresses. This document defines a Diameter application for providers deploying such NAT and NAPT devices. The use of a Diameter application allows for simple integration into the existing Authentication, Authorization and Accounting (AAA) environment of a provider.</p>
<p id="rfc.section.1.p.2">The Diameter Network address and port translation Control Application (DNCA) offers the following capabilities:</p>
<p></p>

<ol>
<li>Limits or defines the number of NAPT/NAT bindings made available to an individual subscriber or end point.</li>
<li>Supports the allocation of specific NAPT/NAT bindings. Two types of specific bindings can be distinguished:<ul>
<li>Allocation of a pre-defined NAT binding: Both the internal and external IP address and port pair are specified within the request. In some deployment cases, such as access to a web-server within a user&#8217;s home network with IP address and port, benefit from statically configured bindings.</li>
<li>Allocation of an external IP address for a given internal IP address: The allocated external IP address is reported back to the requestor. In some deployment scenarios, the application requires immediate knowledge of the allocated binding for a given internal IP address but does not control the allocation of the external IP address; for example, SIP-proxy server deployments.</li>
</ul>
</li>
<li>Defines the external address pool(s) to be used for allocating an external IP address: External address pools can either be pre-assigned at the NAPT/NAT, or specified within a request. If pre-assigned address pools are used, a request needs to include a reference to identify the pool. Otherwise, the request contains a description of the IP address pool(s) to be used; for example, list of IP-subnets. Such External address pools can be used to select external IP address in NAPT/NAT bindings for multiple subscribers.</li>
<li>Generates reports and accounting records: Reports established bindings for a particular user. The collected information is used by accounting systems for statistical purposes.</li>
<li>Queries and retrieves details about bindings on demand: This feature complements the previously mentioned accounting functionality(see item 4).</li>
<li>Identifies a subscriber or endpoint on multiple network devices (NAPT or NAT device, the AAA-server, or the Network Access Server (NAS)): Endpoint identification is facilitated through a Global Endpoint ID. Endpoints are identified through a single or a set of classifiers, such as IP address, Virtual Local Area Network (VLAN) identifier, or interface identifier which uniquely identify the traffic associated with a particular global endpoint</li>
</ol>
<p id="rfc.section.1.p.4">This document is structured as follows: Section 2 lists terminology, while Section 3 provides an introduction to DNCA and its overall deployment framework. Sections 4 to 8 cover DNCA specifics, with Section 4 describing session management, Section 5 the use of the Diameter base protocol, Section 6 new commands, Section 7 AVPs used, and Section 8 accounting aspects. Section 9 presents an AVP occurance table. IANA and security considerations are addressed in Sections 10 and 11.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#Conventions" id="Conventions">Conventions</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.2.p.2">Abbreviations used in this document:</p>
<p></p>

<ul class="empty">
<li>AAA: Authentication, Authorization, Accounting</li>
<li>DNCA: Diameter Network address and port translation Control Application</li>
<li>NAPT: Network Address and Port Translation</li>
<li>NAT: Network Address Translation (NAT and NAPT are used in this document interchangeably)</li>
<li>NAT Binding or Binding: Association of two IP address/port pairs (with one IP address typically being private and the other one public) to facilitate NAT</li>
<li>NAS: Network Access Server</li>
<li>NCR:NAT Control Request</li>
<li>NCA:NAT Control Answer</li>
</ul>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#framework" id="framework">Deployment Framework</a>
</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Deployment Scenario</h1>
<p><a href="#fig-network-deployment">Figure 1</a> shows a typical network deployment for Internet access. A user&#8217;s IPv4 host gains access to the Internet though a NAS, which facilitates the authentication of the endpoint and configures the user&#8217;s connection according to the authorization and configuration data received from the AAA-server upon successful authentication. Public IPv4 addresses are used throughout the network.</p>
<div id="#rfc.figure.1"></div>
<div id="#fig-network-deployment"></div>
<pre>                      +---------+
                      |         |
                      |   AAA   |
                      |         |
                      +---------+
                           |
                           |
                           |
                           |
 +---------+          +---------+             +----------+
 |  IPv4   |          |         |             |  IPv4    |
 |  Host   |----------|   NAS   |-------------| Internet |
 |         |          |         |             |          |
 +---------+          +---------+             +----------+

 &lt;-------------------- Public IPv4 ----------------------&gt;
</pre>
<p><a href="#fig-NAT-deployment">Figure 2</a> depicts the deployment scenario when a service provider introduces a NAT device to increase the efficiency of the global IPv4 address pool utilization. The objective is to provide the customer with connectivity to the public IPv4 Internet. The NAT device performs network address and port (and optionally address family) translation, depending on whether the access network uses private IPv4 addresses or public IPv6 addresses, to public IPv4 addresses. If the NAT device would be put in place without any endpoint awareness, the service offerings of the service provider could be hampered. Provisioning static NAT bindings for particular endpoints, using different public IP address pools for different set of endpoints; for example, residential or business customers, and reporting allocated bindings on a per endpoint basis is burdensome for a service provider if the NAT device is not aware of endpoints and allows per endpoint control and management, which easily integrates with the already existing per endpoint management infrastructure of the service provider.</p>
<div id="#rfc.figure.2"></div>
<div id="#fig-NAT-deployment"></div>
<pre>                +---------+
                |         |
                |   AAA   |
                |         |
                +---------+
                     |
                     |
                     |
                     |
  +--------+    +---------+    +---------+    +----------+
  |  IPv4/ |    |         |    |         |    |  IPv4    |
  |  IPv6  |----|   NAS   |----|   NAT   |----| Internet |
  |  Host  |    |         |    |         |    |          |
  +--------+    +---------+    +---------+    +----------+
  &lt;-------- Private IPv4 -----------&gt;&lt;--- Public IPv4 ---&gt;
  &lt;-------- Public  IPv6 -----------&gt;&lt;--- Public IPv4 ---&gt;
</pre>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Diameter NAPT Control Application Overview</h1>
<p id="rfc.section.3.2.p.1">DNCA runs between a DNCA Agent on the NAT and DNCA Manager. DNCA allows per endpoint control and management of NAT. Based on Diameter, DNCA integrates well with the suite of Diameter applications deployed for per endpoint authentication, authorization, accounting, and policy control in service provider networks.</p>
<p id="rfc.section.3.2.p.2">DNCA offers:</p>

<ul>
<li>Request and answer commands to control the allowed number of NAT bindings per endpoint , to request the allocation of specific bindings for an endpoint, to define the address pool to be used for an endpoint.</li>
<li>Provides per endpoint reporting of the allocated NAT bindings.</li>
<li>Provides unique identification of an endpoint on NAT device, AAA-server and NAS, to simplify correlation of accounting data streams.</li>
</ul>
<p id="rfc.section.3.2.p.3">DNCA allows controlling the behavior of a NAT device on a per endpoint basis during initial session establishment and at later stages by providing an update procedure for already established sessions. Using DNCA, per endpoint NAT binding information can be retrieved either using accounting mechanisms or through an explicit session query to the NAT.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> Deployment Scenarios For DNCA</h1>
<p id="rfc.section.3.3.p.1">The role of DNCA can be fulfilled by either the NAS or by an external server, such as AAA-server. The two deployment scenarios are outlined in <a href="#fig-NAT-integrated-deployment">Figure 3</a> (&#8220;integrated deployment&#8221;) and <a href="#fig-NAT-autonomous-deployment">Figure 4</a> (&#8220;autonomous deployment&#8221;).</p>
<p id="rfc.section.3.3.p.2">Within the figures (M) denotes the network element, which takes on DNCA Manager role. Similarly, (A) identifies the network element, which performs DNCA Agent role.</p>
<p id="rfc.section.3.3.p.3">The integrated deployment approach hides the existence of the NAT device from external servers, such as the AAA-server as much as possible. It is suited for environments where minimal changes to the existing AAA deployment are desired. As DNCA Manager the NAS, initiates and manages session with the NAT device, exchanges NAT specific configuration information and handles reporting and accounting information. The NAS receives reporting and accounting information from NAT device. With this information, the NAS provides a single accounting record for the user. This reduces the usage of an external accounting system for correlating the information received from multiple sources.</p>
<p id="rfc.section.3.3.p.4">An example network attachment for an integrated NAT deployment can be described as follows: An endpoint connects to the network, with the NAS being the point of attachment. After successful authentication, NAS receives endpoint related authorization data from the AAA-server.  A portion of the authorization data applies to per endpoint configuration on the NAS itself, another portion describes authorization and configuration information for NAT control aimed at the NAT device. NAS will initiate a DNCA session to the NAT and send the relevant authorization and configuration information for the particular endpoint to the NAT device. This can comprise NAT bindings, which have to be pre-established for the endpoint, or management related configuration, such as the maximum number of NAT bindings allowed for the endpoint or accounting requirements. The NAT device sends its per endpoint accounting information to the NAS, which aggregates the accounting information received form the NAT device with its local accounting information for the endpoint into a single accounting stream towards the AAA-server.</p>
<div id="#rfc.figure.3"></div>
<div id="#fig-NAT-integrated-deployment"></div>
<pre>                +---------+
                |         |
                |   AAA   |
                |         |
                +---------+
                     |
                     |
                     |
  +--------+    +---------+    +---------+    +----------+
  |  IPv4/ |    |   (M)   |    |   (A)   |    |  IPv4    |
  |  IPv6  |----|   NAS   |----|   NAT   |----| Internet |
  |  Host  |    |         |    |         |    |          |
  +--------+    +---------+    +---------+    +----------+
  &lt;-------- Public  IPv6 ----------&gt;&lt;--- Public IPv4 ----&gt;
  &lt;-------- Private IPv4 ----------&gt;&lt;--- Public IPv4 ----&gt;
</pre>
<p id="rfc.section.3.3.p.5">The autonomous deployment approach decouples user management on NAS and NAT device. The AAA system performing the role of DNCA Manager manages the connection to the NAT device, controls the per endpoint configuration, and also receives accounting and reporting information from the NAT device. Different from the integrated deployment scenario, the autonomous deployment scenario does not &#8220;hide&#8221; the existence of the NAT device from the AAA infrastructure. Here two accounting streams are received by the AAA-server for one particular endpoint, one from the NAS, and one from the NAT device.</p>
<div id="#rfc.figure.4"></div>
<div id="#fig-NAT-autonomous-deployment"></div>
<pre>                  +---------+
                  |   (M)   |
                  |   AAA   |---------
                  |         |         |
                  +---------+         |
                       |              |
                       |              |
                       |              |
    +--------+    +---------+    +---------+    +----------+
    |  IPv4/ |    |         |    |   (A)   |    |  IPv4    |
    |  IPv6  |----|   NAS   |----|   NAT   |----| Internet |
    |  Host  |    |         |    |         |    |          |
    +--------+    +---------+    +---------+    +----------+
    &lt;-------- Public  IPv6 ----------&gt;&lt;---- Public IPv4 ---&gt;
    &lt;-------- Private IPv4 ----------&gt;&lt;---- Public IPv4 ---&gt;</pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#sec-dnca" id="sec-dnca">DNCA Session Establishment and Management</a>
</h1>
<p id="rfc.section.4.p.1">Note that this section forward references some of the commands and AVPs defined for DNCA. Please refer to <a href="#sec-dnca-commands">Section 6</a> and <a href="#sec-dnca-avps">Section 8</a> for details.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Parties Involved </h1>
<p id="rfc.section.4.1.p.1">Authorization and control models supported by this application include the following parties: </p>

<ul>
<li>DNCA Agent: DNCA Agent is part of the NAT device</li>
<li>DNCA Manager</li>
</ul>
<p id="rfc.section.4.1.p.2">The NAT control requesting entity is always DNCA Manager. DNCA Manager always initiates, updates, or terminates the sessions. This mode of operation is sometimes also referred to as "push mode".</p>
<p id="rfc.section.4.1.p.3">DNCA Manager can be NAS or AAA-server. DNCA Manager initiates a session with DNCA Agent when it learns about the subscriber. DNCA Manager may learn about a subscriber when it receives authentication, authorization, or accounting request for that subscriber or by some other means, such as on the box configuration to identify a subscriber with respect to his IP packets.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Session Establishment</h1>
<p id="rfc.section.4.2.p.1">DNCA Manager establishes a session with DNCA Agent to control the behavior of the NAT device. During session establishment, DNCA Manager passes along configuration information to DNCA Agent. The session configuration information comprises the maximum number of bindings allowed for the endpoint associated with this session, a set of pre-defined NAT bindings to be established for this endpoint, or a description of the address pool, external addresses to be allocated from.</p>
<p id="rfc.section.4.2.p.2">DNCA Manager initiates the Diameter NAT Control session to DNCA Agent. DNCA Manager generates a NAT-Control Request (NCR) message to DNCA Agent with NC-Request-Type AVP set to INITIAL_REQUEST. On receipt of NCR DNCA Agent sets up a new session for the endpoint associated with the endpoint classifier(s) contained in the NCR. DNCA Agent notifies DNCA Manager about successful session setup using a NAT-Control Answer (NCA) message with Result-Code set to DIAMETER_SUCCESS. <a href="#fig-session-establishment">Figure 5</a> shows the initial protocol interaction between DNCA Manager and DNCA Agent.</p>
<p id="rfc.section.4.2.p.3">The initial NAT-Control-Request may contain configuration information for the session, which specifies the behavior of the NAT device for the session. The configuration information, which may be included, comprises: </p>

<ul>
<li>A list of NAT bindings, which should be pre-allocated for the session; for example, in case a subscriber requires a fixed external IP- address/port pair for one of the applications.</li>
<li>The maximum number of NAT bindings allowed for an endpoint.</li>
<li>A description of the external address pool(s) to be used for the session.</li>
<li>A reference to a predefined binding rule on DNCA Agent, which is applied to the session. Such a predefined binding rule on DNCA Agent may contain, for example, the name of the IP address pool that external IP addresses should be allocated from, maximum number of bindings permitted for the endpoint etc.</li>
</ul>
<p id="rfc.section.4.2.p.4">In certain cases, DNCA Agent may not be able to perform the tasks requested within the NCR. These include the following: </p>

<ul>
<li>If a DNCA Agent receives a NCR from a DNCA Manager with NC- Request-Type AVP set to INITIAL_REQUEST that identifies an already existing session; that is, DNCA Manager and endpoint identifier match an already existing session, DNCA Agent returns NCA with Result-Code set to SESSION_EXISTS, and provides the Session-Id of the existing session in Duplicate-Session-Id AVP.</li>
<li>If a DNCA Agent receives an NCR from a DNCA Manager with NC- Request-Type AVP set to INITIAL_REQUEST that matches more than one of the already existing sessions; that is, DNCA Manager and endpoint identifier match already existing sessions, DNCA Agent returns a NCA with Result-Code set to INSUFFICIENT-CLASSIFIERS. In case a DNCA Manager receives NCA that reports Insufficient-Classifiers, it may choose to retry establishing a new session using additional and more specific classifiers.</li>
<li>If the NCR contains a binding rule not defined on the NAT device, DNCA Agent returns NCA with Result-Code AVP set to UNKNOWN_BINDING_RULE.</li>
<li>In case DNCA Agent is unable to establish all of the bindings requested in the NCR, it will return a NCA with Result-Code set to BINDING_FAILURE. DNCA Agent, that is NAT device, treats a NCR as an atomic operation; hence none of the requested bindings will be established by the NAT device. Either all requested actions within a NCR are completed successfully, or the entire request fails.</li>
<li>If DNCA Agent does not have sufficient resources to process a request, it returns NCA with Result-Code set to RESOURCE_FAILURE.</li>
<li>In case Max-NAT-Binding and NAT-Control-Definition are included in the NCR along with a reference to a binding rule; that is, a predefined template on NAT device, and the values in Max-NAT-Binding and NAT-Control-Definition contradict those specified in the pre-defined binding rule, Max-NAT-Binding and NAT-Control-Definition override the values specified in the binding rule.</li>
</ul>
<div id="#rfc.figure.5"></div>
<div id="#fig-session-establishment"></div>
<pre>         DNCA Manager                             DNCA Agent
            |                                           |
            |                                           |
            |                                           |
         Trigger                                        |
            |                                           |
            |                   NCR                     |
            |------------------------------------------&gt;|
            | (INITIAL_REQUEST, endpoint classifier,    |
            |     session id, NAT control config data)  |
            |                                           |
            |                                           |
            |                                  Create session state
            |                                           |
            |                                           |
            |                     NCA                   |
            |&lt;------------------------------------------|
            |                 (result code)             |
            |                                           |
            |                                           |</pre>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Session Re-Authorization</h1>
<p id="rfc.section.4.3.p.1">Session re-authorization is performed if DNCA Manager desires to change the behavior of the NAT for an existing session.  Re-authorization could be used, for example, to change the number of allowed bindings for a particular session, or establish or remove a pre-defined binding.</p>
<p id="rfc.section.4.3.p.2">DNCA Manager generates a NCR message to DNCA Agent with NC-Request-Type AVP set to UPDATE_REQUEST upon receiving a trigger signal. In case the session is updated successfully, DNCA Agent notifies DNCA Manager about successful session update using a NAT-Control Answer (NCA) message with Result-Code set to DIAMETER_SUCCESS. <a href="#fig-session-re-auth">Figure 6</a> shows the protocol interaction between DNCA Manager and DNCA Agent.</p>
<p id="rfc.section.4.3.p.3">In certain cases, DNCA Agent may not be able to perform the tasks requested within the NCR. These include the following: </p>

<ul>
<li>If DNCA Agent receives a NCR update or query request for a non-existent session, it sets Result-Code in the answer to DIAMETER_UNKNOWN_SESSION_ID.</li>
<li>If the NCR contains a binding rule not defined on the NAT device, DNCA Agent returns NCA with Result-Code AVP set to UNKNOWN_BINDING_RULE.</li>
<li>If DNCA Agent cannot establish the requested binding because the maximum number of allowed bindings has been reached for the Endpoint Classifier, it returns NCA with Result-Code AVP set to MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT.</li>
<li>If DNCA Agent cannot establish some or all of the bindings requested in a NCR, but has not yet reached the maximum number of allowed bindings for the subscriber, it returns a NCA with Result-Code set to BINDING_FAILURE. DNCA Agent (i.e., NAT device) treats a NCR as an atomic operation. Hence none of the requested bindings will be established by NAT device. Either all requested actions within a NCR are either successful or failed completely.</li>
<li>If DNCA Agent does not have sufficient resources to process a request, it returns NCA with Result-Code set to RESOURCE_FAILURE.</li>
<li>If a NCR redefines the maximum number of NAT bindings allowed for the endpoint, the new value will override any previously defined limit on NAT bindings. It depends on the implementation of the NAT device on how the NAT device copes with a case where the new value is lower than the actual number of allocated bindings.  Typically the NAT device refrains from enforcing the new limit immediately; that is, actively remove bindings, but rather disallow the establishment of new bindings until the current number of bindings is lower than the newly established maximum number of allowed bindings.</li>
<li>If a NCR specifies a new binding rule, predefined on DNCA Agent, the binding rule overrides any previously defined rules for the session.</li>
<li>If Max-NAT-Binding and NAT-Control-Definition AVPs are included in the NCR along with a reference to a binding rule (a predefined template on NAT device) and the values in Max-NAT-Binding and NAT-Control-Definition AVPs contradict those specified in the pre-defined binding rule, Max-NAT-Binding and NAT-Control-Definition AVPs override the values specified in the binding rule.</li>
</ul>

<p>Note: Already established bindings for the session will not be affected.</p>
<div id="#rfc.figure.6"></div>
<div id="#fig-session-re-auth"></div>
<pre>         DNCA Manager                             DNCA Agent
            |                                           |
            |                                           |
            |                                           |
     Change of session                                  |
        attributes                                      |
            |                                           |
            |                   NCR                     |
            |------------------------------------------&gt;|
            |       (UPDATE_REQUEST session id,         |
            |         NAT control config data)          |
            |                                           |
            |                                           |
            |                                  Update session state
            |                                           |
            |                                           |
            |                     NCA                   |
            |&lt;------------------------------------------|
            |                 (result code)             |
            |                                           |
            |                                           |</pre>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> Session and Binding Query</h1>
<p id="rfc.section.4.4.p.1">Session query can be used by DNCA Manager to either retrieve information on the current bindings for a particular session at the NAT device or discover the session identifier for a particular external IP address/port pair.</p>
<p id="rfc.section.4.4.p.2">DNCA Manager initiates a session query by sending a NCR message to DNCA Agent with NC-Request-Type AVP set to QUERY_REQUEST. <a href="#fig-session-query">Figure 7</a> shows the protocol interaction between DNCA Manager and DNCA Agent.</p>
<p id="rfc.section.4.4.p.3">Two types of query requests exist. The first type of query request uses the session ID as input parameter to the query. It is to allow DNCA Manager retrieve the current set of bindings for a specific session. The second type of query request is used to retrieve the session identifiers, along with the associated bindings, matching a criteria. This enables DNCA Manager to find the sessions, which utilize a specific external IP address.</p>
<p></p>

<ol>
<li>Request a list of currently allocated NAT bindings for a particular session: DNCA Agent on receiving NCR, looks up session information for the session ID contained in the NCR, and reports all currently active NAT bindings for the session using NCA message with Result-Code set to DIAMETER_SUCCESS. In this case the NCR MUST NOT contain a NAT-Control-Definition AVP. Each NAT binding is reported in a NAT-Control-Definition AVP. In case the session ID is unknown, DNCA Agent returns NCA with Result-Code set to DIAMETER_UNKNOWN_SESSION_ID.</li>
<li>Retrieve session IDs and internal IP address/port pairs for one or multiple external IP address/port pairs: If DNCA Manager wishes to retrieve the session ID(s) for one or multiple external IP address/port pairs, it MUST include the external IP address/port pair(s) as part of the NAT-Control-Definition AVP of the NCR. The session ID is not included in the NCR or the NCA for this type of a query. DNCA Agent reports the NAT bindings and associated session IDs corresponding to the external IP address/port pairs in a NCA message with Result-Code set to DIAMETER_SUCCESS with the same session ID, which is used in NCR. In case an external IP address/port pair has no associated existing NAT binding, the NAT-Control-Definition AVP contained in the reply just contains the NAT-External-Address AVP.</li>
</ol>
<div id="#rfc.figure.7"></div>
<div id="#fig-session-query"></div>
<pre>         DNCA Manager                             DNCA Agent
            |                                           |
            |                                           |
            |                                           |
  DNCA Session Established                              |
            |                                           |
            |                   NCR                     |
            |------------------------------------------&gt;|
            |              (QUERY_REQUEST)              |
            |                                           |
            |                                           |
            |                                           |
            |                          Look up corresponding session
            |                            and associated NAT Bindings
            |                                           |
            |                   NCA                     |
            |&lt;------------------------------------------|
            |              (Result-Code)                |
            |                                           |
            |                                           |</pre>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> Session Termination</h1>
<p id="rfc.section.4.5.p.1">DNCA Manager generates a Session Terminate Request (STR) message to DNCA Agent upon receiving a trigger signal. The source of the trigger signal is outside the scope of this document. DNCA Agent sends accounting stop record reporting all the bindings and notifies DNCA Manager about successful session termination using a Session Terminate Answer (STA) message with Result-Code set to DIAMETER_SUCCESS. <a href="#fig-session-terminate">Figure 8</a> shows the protocol interaction between DNCA Manager and DNCA Agent.</p>
<p id="rfc.section.4.5.p.2">If a DNCA Agent receives STR from a DNCA Manager and fails to find a matching session, DNCA Agent returns STA with Result-Code set to DIAMETER_UNKNOWN_SESSION_ID.</p>
<div id="#rfc.figure.8"></div>
<div id="#fig-session-terminate"></div>
<pre>
         DNCA Manager                             DNCA Agent
            |                                            |
            |                                            |
         Trigger                                         |
            |                                            |
            |                   STR                      |
            |-------------------------------------------&gt;|
            |               (session id)                 |
            |                                            |
            |                                            |
            |                                  Remove NAT bindings
            |                                       of session
            |                                            |
            |                                            |
            |           Send accounting stop             |
            |&lt;-------------------------------------------|
            |           for all session bindings         |
            |                                            |
            |                                  Terminate Session /
            |                                 Remove session state
            |                                            |
            |                                            |
            |                                            |
            |                  STA                       |
            |&lt;-------------------------------------------|
            |             (Result-Code)                  |
            |                                            |</pre>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> DNCA Manager and Agent Failures</h1>
<p id="rfc.section.4.6.p.1">This document does not cover details in case DNCA Manager and DNCA Agent are out of sync. This happens when DNCA Manager or DNCA Agent restart, (temporary) loss of network connectivity etc. DNCA Manager and DNCA Agent MUST have builtin redundancy support to recover state in case of failure.</p>
<p id="rfc.section.4.6.p.2">Example failure cases include the following:</p>
<p></p>

<ul>
<li>DNCA Manager loses session state (e.g. due to a restart). In this case, <ul>
<li>DNCA Agent may receive a NCR with NC-Request-Type AVP set to INITIAL_REQUEST that matches an existing session of DNCA Agent. DNCA Agent returns a Result-Code that contains Duplicate-Session-Id AVP to report the Session-ID of existing session. DNCA Manager may send an explicit Sesstion Terminate Request (STR) for the older session, which was lost.</li>
<li>DNCA Manager may receive accounting records for a session that does not exist. DNCA Manager sends an accounting answer with Result-Code set to DIAMETER_UNKNOWN_SESSION_ID. On receiving this, DNCA Agent clears the session and removes the associated session state.</li>
</ul>
</li>
<li>DNCA Agent loses session state. In such a case, DNCA Agent may receive a NCR with NC-Request-Type AVP set to UPDATE_REQUEST for a non-existent session. DNCA Agent returns NCA with Result-Code set to DIAMETER_UNKNOWN_SESSION_ID.</li>
<li>DNCA Manager is unreachable, for example detected by Diameter watchdog, or down and accounting request from DNCA Agent fails to get a response. The mechanism to ensure that a DNCA Manager no longer has associated state for a session being cleared by a DNCA Agent is beyond the scope of this document.</li>
<li>DNCA Agent is unreachable or down and NCR requests fail to get a response. Handling of this case depends on the actual service offering of the service provider. The service provider can choose to terminate the access session to the endpoint.</li>
</ul>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#sec-diameter-base-use" id="sec-diameter-base-use">Use Of The Diameter Base Protocol</a>
</h1>
<p id="rfc.section.5.p.1">The Diameter Base Protocol defined by <a href="#RFC3588">[RFC3588]</a> applies with the clarifications listed in the present specification.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#sec-diameter-messages" id="sec-diameter-messages">Securing Diameter Messages </a>
</h1>
<p id="rfc.section.5.1.p.1">For secure transport of Diameter messages recommendations in <a href="#RFC3588">[RFC3588]</a> apply.</p>
<p id="rfc.section.5.1.p.2">DNCA Agent MAY verify the identity of DNCA Manager during the Capabilities Exchange Request procedure.</p>
<p id="rfc.section.5.1.p.3">DNCA Agent MAY verify if DNCA Manager that issues a NCR command is allowed and it is based on: </p>

<ul>
<li>The identity of DNCA Manager</li>
<li>The type of NCR Command</li>
<li>The content of the NCR Command</li>
<li>Any combination of the above</li>
</ul>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Accounting Functionality</h1>
<p id="rfc.section.5.2.p.1">Accounting functionality (accounting session state machine, related command codes and AVPs) is defined in <a href="#sec-accounting">Section 9</a> below.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> Use Of Sessions</h1>
<p id="rfc.section.5.3.p.1">Each DNCA session MUST have a globally unique Session-ID as defined in <a href="#RFC3588">[RFC3588]</a>, which MUST NOT be changed during the lifetime of a DNCA session. The Diameter Session-ID serves as the global endpoint identifier. DNCA Agent and DNCA Manager maintain state associated with the Session-ID. This globally unique Session-ID is used for updating, accounting, and terminating the session. DNCA session MUST NOT have more than one outstanding request at any given instant. DNCA Agent sends an Abort-Session-Request as defined in <a href="#RFC3588">[RFC3588]</a> if it is unable to maintain sessions due to resource limitation.</p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> Routing Considerations</h1>
<p id="rfc.section.5.4.p.1">It is assumed that DNCA Manager knows the DiameterIdentity of DNCA Agent for a given endpoint. Both the Destination-Realm and Destination-Host AVPs are present in the request from DNCA Manager to DNCA Agent.</p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> Advertising Application Support</h1>
<p id="rfc.section.5.5.p.1">Diameter nodes conforming to this specification MUST advertise support for DNCA by including the value of TBD in the Auth-Application-Id of the Capabilities-Exchange-Request and Capabilities-Exchange-Answer command<a href="#RFC3588">[RFC3588]</a>.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#sec-dnca-commands" id="sec-dnca-commands">DNCA Commands</a>
</h1>
<p id="rfc.section.6.p.1">The following commands are used to establish, maintain and query NAT bindings.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#sec-dnca-ncr" id="sec-dnca-ncr">NAT-Control Request (NCR) Command</a>
</h1>
<p id="rfc.section.6.1.p.1">The NAT-Control Request (NCR) command, indicated by the command field set to TBD and the "R" bit set in the Command Flags field, is sent from DNCA Manager to DNCA Agent in order to install NAT bindings.</p>
<p id="rfc.section.6.1.p.2">User-Name, Logical-Access-Id, Physical-Access-ID, Framed-IP-Address, Framed-IPv6-Prefix , Framed-Interface-Id, EGRESS-VLANID, NAS-Port-ID, Address-Realm, Calling-Station-ID AVPs serve as identifiers for the subscriber.</p>
<p id="rfc.section.6.1.p.3">Message Format:</p>
<div id="#rfc.figure.9"></div>
<pre>   &lt; NC-Request &gt; ::= &lt; Diameter Header: TBD, REQ, PXY&gt;
                    [ Session-Id ]
                    { Auth-Application-Id }
                    { Origin-Host }
                    { Origin-Realm }
                    { Destination-Realm }
                    { Destination-Host }
                    { NC-Request-Type }
                    [ Origin-State-Id ]
                 *1 [ NAT-Control-Remove ]
                 *1 [ NAT-Control-Install ]
                    [ User-Name ]
                    [ Logical-Access-Id ]
                    [ Physical-Access-ID ]
                    [ Framed-IP-Address ]
                    [ Framed-IPv6-Prefix ]
                    [ Framed-Interface-Id ]
                    [ EGRESS-VLANID]
                    [ NAS-Port-ID]
                    [ Address-Realm ]
                    [ Calling-Station-ID ]
                  * [ Proxy-Info ]
                  * [ Route-Record ]
                  * [ AVP ]
</pre>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#sec-dnca-nca" id="sec-dnca-nca">NAT-Control Answer (NCA) Command</a>
</h1>
<p id="rfc.section.6.2.p.1">The NAT-Control-Answer (NCA) command, indicated by the Command-Code field set to TBD and the "R" bit cleared in the Command Flags field, is sent by DNCA Agent in response to NAT-Control-Request command.</p>
<p id="rfc.section.6.2.p.2">Message Format:</p>
<div id="#rfc.figure.10"></div>
<pre>   &lt;NC-Answer&gt; ::= &lt; Diameter Header: TBD, PXY &gt;
                   [ Session-Id ]
                   { Origin-Host }
                   { Origin-Realm }
                   { NC-Request-Type }
                   [ Result-Code ]
                 * [ NAT-Control-Definition ]
                   [ Current-NAT-Bindings   ]
                   [ Origin-State-Id ]
                   [ Error-Message ]
                   [ Error-Reporting-Host ]
                 * [ Failed-AVP ]
                 * [ Proxy-Info ]
                   [ Duplicate-Session-ID ]
                 * [ Redirect-Host]
                   [ Redirect-Host-Usage ]
                   [ Redirect-Max-Cache-Time ]
                 * [ Proxy-Info ]
                 * [ Route-Record ]
                 * [ Failed-AVP ]
                 * [ AVP ]
                 * [ AVP ]

</pre>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> NAT Control Application Session State Machine</h1>
<p id="rfc.section.7.p.1">This section contains a set of finite state machines, representing the life cycle of DNCA session, which MUST be observed by all implementations of DNCA Diameter application. DNCA Agent and Manager are stateful and the state machine maintained is similar to the stateful Client and Server authorization state machine described in <a href="#RFC3588">[RFC3588]</a>. When a session is moved to the Idle state, any resources that were allocated for the particular session must be released. Any event not listed in the state machines MUST be considered as an error condition, and an answer, if applicable, MUST be returned to the originator of the message.</p>
<p id="rfc.section.7.p.2">In the state table, the event 'Failure to send NCR' means that DNCA Manager is unable to send command NCR to the desired destination. This could be due to the peer being down, or due to the peer sending back a transient failure or temporary protocol error notification DIAMETER_TOO_BUSY or DIAMETER_LOOP_DETECTED in the Result-Code AVP of NCA.</p>
<p id="rfc.section.7.p.3">In the state table "FAILED NCA" means that DNCA Agent was not able to honor corresponding NCR. This can happen due to any of the transient and permanent error at DNCA Agent indicated by the following error Result-Code values - RESOURCE_FAILURE, UNKNOWN_BINDING_RULE_NAME, BINDING_FAILURE, MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT, SESSION_EXISTS, INSUFFICIENT_CLASSIFIERS</p>
<p id="rfc.section.7.p.4">The following state machine is observed by a DNCA Manager:</p>
<div id="#rfc.figure.11"></div>
<pre>                           MANAGER
   State     Event                          Action     New State
   -------------------------------------------------------------
   Idle      New Host detected that         Send       Pending
             requires NAT Control           NCR
                                            Initial 
                                            Request

   Idle      ASR Received                   Send ASA   Idle
             for unknown session            with
                                            Result-Code
                                            = UNKNOWN_
                                            SESSION_ID

   Pending   Successful NCA                 Setup      Open
             received                       complete

   Pending   Successful NCA                 Sent STR   Discon
             received
             but Agent unable to provide
             service

   Pending   Error processing successful    Sent STR   Discon
             NCA

   Pending   Failed                         Cleanup    Idle
             NCA received

   Open      NAT control                    Send       Open
             update required                NCR Update
                                            Request

   Open      Successful                                Open
             NCA received  

   Open      Failed                         Cleanup    Idle
             NCA received.                  
             

   Open      Access Session end detected    Send STR   Discon
             

   Open      ASR Received,                  Send ASA   Discon
             client will comply with        with
             request to end the session     Result-Code
                                            = SUCCESS,
                                            Send STR.

   Open      ASR Received,                  Send ASA   Open
             client will not comply with    with
             request to end the session     Result-Code
                                            != SUCCESS
   
   Discon    ASR Received                   Send ASA   Idle

   Discon    STA Received                   Discon.    Idle
                                            user/device</pre>
<p id="rfc.section.7.p.5">The following state machine is observed by a DNCA Agent:</p>
<div id="#rfc.figure.12"></div>
<pre>                          AGENT
   State     Event                          Action     New State
   -------------------------------------------------------------
   Idle      NCR request                    Send       Open
             received, and                  successful
             able to provide requested      NCA
             NAT control service

   Idle      NCR request                    Send       Idle
             received, and                  failed 
             unable to provide requested    NCA
             NAT control service
     
   Open      NCR  request                    Send       Open
             received, and                   successful
             able to provide requested       NCA
             NAT control service       

   Open      NCR request                    Send       Idle
             received, and                  failed 
             unable to provide requested    NCA,
             NAT control service            Cleanup

   Open      Unable to continue             Send ASR   Discon
             providing requested
             NAT control service

   Discon    Failure to send ASR            Wait,      Discon
                                            resend ASR

   Discon    ASR successfully sent and      Cleanup    Idle
             ASA Received with Result-Code

   Not       ASA Received                   None       No Change.
   Discon

   Any       STR Received                   Send STA,  Idle
                                            Cleanup.</pre>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#sec-dnca-avps" id="sec-dnca-avps">DNCA AVPs</a>
</h1>
<p></p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> Reused Base Protocol AVPs</h1>
<p id="rfc.section.8.1.p.1">AVPs reused from Diameter Base Protocol <a href="#RFC3588">[RFC3588]</a> are listed below.</p>
<div id="#rfc.figure.13"></div>
<div id="#tab-avps-from-diameter-base"></div>
<pre>                                                +-------------------+
                                                |  AVP Flag rules   |
+-----------------------------------------------|-----+---+---------+
|                           AVP                 |     |   |   May   |
| Attribute Name            Code     Data Type  |MUST |MAY| encrypt |
+-----------------------------------------------+-----+---+---------+
|Acct-Interim-Interval      85       Unsigned32 | M   | P |    Y    |
|Auth-Application-Id        258      Unsigned32 | M   | P |    N    |
|Destination-Host           293      DiamIdent  | M   | P |    N    |
|Destination-Realm          283      DiamIdent  | M   | P |    N    |
|Error-Message              281      UTF8String | M   | P |    N    |
|Error-Reporting-Host       294      DiamIdent  | M   | P |    N    |
|Failed-AVP                 279      Grouped    | M   | P |    N    |
|Origin-Host                264      DiamIdent  | M   | P |    N    |
|Origin-Realm               296      DiamIdent  | M   | P |    N    |
|Origin-State-Id            278      Unsigned32 | M   | P |    N    |
|Proxy-Info                 284      Grouped    | M   | P |    N    |
|Result-Code                268      Unsigned32 | M   | P |    N    |
|Route-Record               282      DiamIdent  | M   |   |    N    |
|Session-Id                 263      UTF8String | M   | P |    Y    |
|User-Name                  1        UTF8String | M   | P |    Y    |
+-----------------------------------------------+-----+---+---------+
|M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
|    supported and recognized by a Diameter entity in order the     |
|    message, which carries this AVP, to be accepted.               |
|P - Indicates the need for encryption for end-to-end security.     |
+-------------------------------------------------------------------+
</pre>
<p id="rfc.section.8.1.p.2">The Auth-Application-Id AVP (AVP Code 258) is assigned by IANA to Diameter applications. The value of the Auth-Application-Id for the Diameter NAT Control Application is TBD.</p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> <a href="#sec_result-codes" id="sec_result-codes">Additional Result-Code AVP Values</a>
</h1>
<p id="rfc.section.8.2.p.1">This section defines new values for the Result-Code AVP which SHALL be supported by all Diameter implementations that conform to the present document.</p>
<h1 id="rfc.section.8.2.1">
<a href="#rfc.section.8.2.1">8.2.1.</a> Success</h1>
<p id="rfc.section.8.2.1.p.1">No new Result-Code AVP value is defined within this category.</p>
<h1 id="rfc.section.8.2.2">
<a href="#rfc.section.8.2.2">8.2.2.</a> <a href="#sec_result-code-transient" id="sec_result-code-transient">Transient Failures</a>
</h1>
<p id="rfc.section.8.2.2.p.1">Result-Code AVP values that fall within the transient failures category are those used to inform a peer that the request could not be satisfied at the time that it was received. The request may be able to be satisfied in the future.</p>
<p id="rfc.section.8.2.2.p.2">The following new values of the Result-Code AVP are defined:</p>
<p></p>

<ul class="empty"><li>RESOURCE_FAILURE (TBD)<ul class="empty"><li>DNCA Agent indicates that the binding could not be installed or a new session could not be created due to resource shortage.</li></ul>
</li></ul>
<h1 id="rfc.section.8.2.3">
<a href="#rfc.section.8.2.3">8.2.3.</a> <a href="#sec_result-code-permanent" id="sec_result-code-permanent">Permanent Failures </a>
</h1>
<p id="rfc.section.8.2.3.p.1">The Result-Code AVP values, which fall within the permanent failures category are used to inform the peer that the request failed, and should not be attempted again. The request may be able to be satisfied in the future.</p>
<p id="rfc.section.8.2.3.p.2">The following new values of the Result-Code AVP are defined:</p>
<p></p>

<ul class="empty">
<li>UNKNOWN_BINDING_RULE_NAME (TBD)<ul class="empty"><li>DNCA Agent indicates that the binding could not be installed or a new session could not be created due to resource shortage.</li></ul>
<p>BINDING_FAILURE (TBD)</p>
<ul class="empty"><li>DNCA indicates that the requested binding(s) could not be installed.</li></ul>
</li>
<li>MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT (TBD)<ul class="empty"><li>DNCA Agent denies the request because the maximum number of allowed bindings has been reached for the specified Endpoint Classifier.</li></ul>
</li>
<li>SESSION_EXISTS (TBD)<ul class="empty"><li>DNCA Agent denies request to initialize a new session, if it already has a DNCA session that uses the same set of classifiers as indicated by DNCA Manager in the new session initialization request.</li></ul>
</li>
<li>INSUFFICIENT_CLASSIFIERS (TBD)<ul class="empty"><li>DNCA Agent defines request to initialize a new session, if the classifiers in the request match more than one of the existing sessions on DNCA Agent.</li></ul>
</li>
</ul>
<h1 id="rfc.section.8.3">
<a href="#rfc.section.8.3">8.3.</a> Reused NASREQ Diameter Application AVPs</h1>
<p id="rfc.section.8.3.p.1">The following AVPs are reused from Diameter Network Access Server Application <a href="#RFC4005">[RFC4005]</a>.</p>
<div id="#rfc.figure.14"></div>
<div id="#tab-avps-from-nasreq"></div>
<pre>                                       +---------------------+
                                       |    AVP Flag rules   |
+------------------+------+------------|----+-----+----+-----|----+
|                  | AVP  |            |    |     |SHLD| MUST|    |
| Attribute Name   | Code |  Value Type|MUST| MAY | NOT|  NOT|Encr|
|------------------|------|------------|----+-----+----+-----|----|
| NAS-Port         |   5  | Unsigned32 | M  |  P  |    |  V  | Y  |
| NAS-Port-Id      |  87  | UTF8String | M  |  P  |    |  V  | Y  |
| Calling-Station- |  31  | UTF8String | M  |  P  |    |  V  | Y  |
|   Id             |      |            |    |     |    |     |    |
| Framed-IP-Address|   8  | OctetString| M  |  P  |    |  V  | Y  |
| Framed-Interface-|  96  | Unsigned64 | M  |  P  |    |  V  | Y  |
|   ID             |      |            |    |     |    |     |    |
| Framed-IPv6-     |  97  | OctetString| M  |  P  |    |  V  | Y  |
|  Prefix          |      |            |    |     |    |     |    |
+------------------+------+------------|----+-----+----+-----|----+</pre>
<h1 id="rfc.section.8.4">
<a href="#rfc.section.8.4">8.4.</a> Reused from RFC 4675 </h1>
<p id="rfc.section.8.4.p.1">The following AVPs are reused from "RADIUS Attributes for Virtual LAN and Priority Support" specification <a href="#RFC4675">[RFC4675]</a>.</p>
<div id="#rfc.figure.15"></div>
<div id="#tab-avps-from-rfc4675"></div>
<pre>                                       +---------------------+
                                       |    AVP Flag rules   |
+------------------+------+------------|----+-----+----+-----|----+
|                  | AVP  |            |    |     |SHLD| MUST|    |
| Attribute Name   | Code |  Value Type|MUST| MAY | NOT|  NOT|Encr|
|------------------|------|------------|----+-----+----+-----|----|
| Egress-VLANID    |  56  | OctetString| M  |  P  |    |  V  | Y  |
+------------------+------+------------|----+-----+----+-----|----+</pre>
<h1 id="rfc.section.8.5">
<a href="#rfc.section.8.5">8.5.</a> Reused from Diameter QoS Application</h1>
<p id="rfc.section.8.5.p.1">The following AVPs are reused from the Traffic Classification and Quality of Service (QoS) Attributes for Diameter <a href="#RFC5777">[RFC5777]</a>.</p>
<div id="#rfc.figure.16"></div>
<div id="#tab-avps-from-diameter-qos"></div>
<pre>                                                +-------------------+
                                                |  AVP Flag rules   |
+-----------------------------------------------|-----+---+---------+
|                           AVP                 |     |   |   May   |
| Attribute Name            Code     Data Type  |MUST |MAY| encrypt |
+-----------------------------------------------+-----+---+---------+
|Port                       TBD     Integer32   |  M  | P |    Y    |
|IP-Address-Mask            TBD     Grouped     |  M  | P |    Y    |
|Protocol                   TBD     Enumerated  |  M  | P |    Y    |
|Direction                  TBD     Enumerated  |  M  | P |    Y    |
+-----------------------------------------------+-----+---+---------+
|M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
|    supported and recognized by a Diameter entity in order the     |
|    message, which carries this AVP, to be accepted.               |
|P - Indicates the need for encryption for end-to-end security.     |
+-------------------------------------------------------------------+</pre>
<h1 id="rfc.section.8.6">
<a href="#rfc.section.8.6">8.6.</a> Reused from ETSI ES 283 034, e4 Diameter Application</h1>
<p id="rfc.section.8.6.p.1">The following AVPs are reused from the Diameter e4 Application <a href="#ETSIES283034">[ETSIES283034]</a>.</p>
<div id="#rfc.figure.17"></div>
<div id="#tab-avps-from-diameter-e4"></div>
<pre>                                                +-------------------+
                                                |  AVP Flag rules   |
+-----------------------------------------------|-----+---+---------+
|                           AVP                 |     |   |   May   |
| Attribute Name            Code     Data Type  |MUST |MAY| encrypt |
+-----------------------------------------------+-----+---+---------+
|Address-Realm              301     OctetString | M,V |   |    Y    |
|Logical-Access-Id          302     OctetString |   V | M |    Y    |
|Physical-Access-ID         313     UTF8String  |   V | M |    Y    |
+-----------------------------------------------+-----+---+---------+
|M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
|    supported and recognized by a Diameter entity in order the     |
|    message, which carries this AVP, to be accepted.               |
|P - Indicates the need for encryption for end-to-end security.     |
|V - Indicates whether the optional Vendor-ID field is present      |
|    in the AVP header. Vendor-Id header of all AVPs in             |
|    this table will be set to ETSI (13019).                        |
+-------------------------------------------------------------------+</pre>
<h1 id="rfc.section.8.7">
<a href="#rfc.section.8.7">8.7.</a> DNCA Defined AVPs</h1>
<p id="rfc.section.8.7.p.1">The following table describes the new Diameter AVPs used in this document.</p>
<div id="#rfc.figure.18"></div>
<div id="#tab-new-avps"></div>
<pre>                                                +-------------------+
                                                |  AVP Flag rules   |
+-----------------------------------------------|-----+---+---------+
|                       AVP  Section            |     |   |   May   |
| Attribute Name        Code Defined Data Type  |MUST |MAY| encrypt |
+-----------------------------------------------+-----+---+---------+
|NC-Request-Type        TBD  7.7.1   Enumerated | M   | P |    Y    |
|NAT-Control-Install    TBD  7.7.2   Grouped    | M   | P |    Y    |
|NAT-Control-Remove     TBD  7.7.3   Grouped    | M   | P |    Y    |
|NAT-Control-Definition TBD  7.7.4   Grouped    | M   | P |    Y    |
|NAT-Internal-Address   TBD  7.7.5   Grouped    | M   | P |    Y    |
|NAT-External-Address   TBD  7.7.6   Grouped    | M   | P |    Y    |
|Max-NAT-Bindings       TBD  7.7.7   Unsigned32 | M   | P |    Y    |
|NAT-Control-           TBD  7.7.8   OctetString| M   | P |    Y    |
| Binding-Rule                                  |     |   |         |
|Duplicate-             TBD  7.7.9   UTF8String | M   | P |    Y    |
| Session-ID                                    |     |   |         |
|NAT-Control-Record     TBD  8.2.1   Grouped    | M   | P |    Y    |
|NAT-Control-           TBD  8.2.2   Enumerated | M   | P |    Y    |
| Binding-Status                                |     |   |         |
|Current-NAT-Bindings   TBD  8.2.3   Unsigned32 | M   | P |    Y    |
+-----------------------------------------------+-----+---+---------+
|M - Mandatory bit. An AVP with "M" bit set and its value MUST be   |
|    supported and recognized by a Diameter entity in order the     |
|    message, which carries this AVP, to be accepted.               |
|P - Indicates the need for encryption for end-to-end security.     |
|V - Vendor specific bit that indicates whether the optional        |
|    Vendor-ID field is present in the AVP header.                  |
+-------------------------------------------------------------------+</pre>
<h1 id="rfc.section.8.7.1">
<a href="#rfc.section.8.7.1">8.7.1.</a> <a href="#avp_NC-Request-Type" id="avp_NC-Request-Type">NC-Request-Type AVP</a>
</h1>
<p id="rfc.section.8.7.1.p.1">The NC-Request-Type AVP (AVP Code TBD) is of type Enumerated and contains the reason for sending the NAT-Control-Request command. It shall be present in all NAT-Control-Request messages.</p>
<p id="rfc.section.8.7.1.p.2">The following values are defined: </p>

<ul class="empty">
<li>INITIAL_REQUEST (1)<ul class="empty"><li>An Initial Request is used to install binding at DNCA Agent on a successful access session setup.</li></ul>
<p>UPDATE_REQUEST (2)</p>
<ul class="empty"><li>An Update Request is used to update bindings previously installed on a given access session, to add new binding on a given access session, or to remove one or several binding(s) activated on a given access session.</li></ul>
</li>
<li>QUERY_REQUEST (4)<ul class="empty"><li>Query Request is used to query DNCA Agent about the currently installed bindings for an endpoint classifier.</li></ul>
</li>
</ul>
<h1 id="rfc.section.8.7.2">
<a href="#rfc.section.8.7.2">8.7.2.</a> <a href="#avp_NAT-Control-Install" id="avp_NAT-Control-Install">NAT-Control-Install AVP</a>
</h1>
<p id="rfc.section.8.7.2.p.1">The NAT-Control AVP (AVP code TBD) is of type Grouped, and it is used to activate or install NAT bindings. It also contains Max-NAT-Bindings that defines maximum number of NAT bindings to be allowed for a subscriber and NAT-Control-Binding-Rule that references predefined policy template on DNCA Agent that may contain static bindings, maximum number of bindings to be allowed, address pool from which external binding address should be allocated.</p>
<p id="rfc.section.8.7.2.p.2">AVP format:</p>
<div id="#rfc.figure.19"></div>
<pre>  NAT-Control-Install ::= &lt; AVP Header: TBD &gt;
                           * [ NAT-Control-Definition ]
                             [ NAT-Control-Binding-Rule ]
                             [ Max-NAT-Bindings]
                           * [ AVP ]</pre>
<h1 id="rfc.section.8.7.3">
<a href="#rfc.section.8.7.3">8.7.3.</a> <a href="#avp_NAT-Control-Remove" id="avp_NAT-Control-Remove">NAT-Control-Remove AVP</a>
</h1>
<p id="rfc.section.8.7.3.p.1">The NAT-Control-Remove AVP (AVP code TBD) is of type Grouped, and it is used to deactivate or remove NAT bindings.</p>
<p id="rfc.section.8.7.3.p.2">AVP format:</p>
<div id="#rfc.figure.20"></div>
<pre>  NAT-Control-Remove ::= &lt; AVP Header: TBD &gt;
                          * [ NAT-Control-Definition ]
                            [ NAT-Control-Binding-Rule ]
                          * [ AVP ]</pre>
<h1 id="rfc.section.8.7.4">
<a href="#rfc.section.8.7.4">8.7.4.</a> <a href="#avp_NAT-Control-Definition" id="avp_NAT-Control-Definition">NAT-Control-Definition AVP</a>
</h1>
<p id="rfc.section.8.7.4.p.1">The NAT-Control-Definition AVP (AVP code TBD) is of type Grouped, and it describes a binding.</p>
<p id="rfc.section.8.7.4.p.2">The NAT-Control-Definition AVP uniquely identifies the binding between DNCA Agent and DNCA Manager.</p>
<p id="rfc.section.8.7.4.p.3">If both the NAT-Internal-Address and NAT-External-Address AVP(s) are supplied, it is a pre-defined binding.</p>
<p id="rfc.section.8.7.4.p.4">The Protocol AVP describes the transport protocol for the binding. The NAT-Control-Definition AVP can contain either zero or one Protocol AVP. If the Protocol AVP is omitted and if both internal and external address are specified then the binding reserves the addresses for all transport protocols.</p>
<p id="rfc.section.8.7.4.p.5">The Direction AVP is of type Enumerated. It specifies the direction for the binding. The values of the enumeration applicable in this context are: "IN","OUT". If Direction AVP is OUT or absent, NAT-Internal-Address refers to the address of the subscriber device that needs to be translated. If Direction AVP is "IN", NAT-Internal-Address is the destination address that has to be translated.</p>
<p id="rfc.section.8.7.4.p.6">AVP format:</p>
<div id="#rfc.figure.21"></div>
<pre>  NAT-Control-Definition ::= &lt; AVP Header: TBD &gt;
                              { NAT-Internal-Address }
                              [ Protocol ]
                              [ Direction ]
                              [ NAT-External-Address ]
                              [ Session-Id ]
                            * [ AVP ]</pre>
<h1 id="rfc.section.8.7.5">
<a href="#rfc.section.8.7.5">8.7.5.</a> <a href="#avp_NAT-Internal-Address" id="avp_NAT-Internal-Address">NAT-Internal-Address AVP</a>
</h1>
<p id="rfc.section.8.7.5.p.1">The NAT-Internal-Address AVP (AVP code TBD) is of type Grouped.  It describes the internal IP address and port for a binding.  Framed-IPV6-Prefix and Framed-IP-Address AVPs are mutually exclusive.</p>
<p id="rfc.section.8.7.5.p.2">AVP format:</p>
<div id="#rfc.figure.22"></div>
<pre>  NAT-Internal-Address ::= &lt; AVP Header: TBD &gt;
                            [ Framed-IP-Address ]
                            [ Framed-IPv6-Prefix ]
                            [ Port]
                          * [ AVP ]</pre>
<h1 id="rfc.section.8.7.6">
<a href="#rfc.section.8.7.6">8.7.6.</a> <a href="#avp_NAT-External-Address" id="avp_NAT-External-Address">NAT-External-Address AVP</a>
</h1>
<p id="rfc.section.8.7.6.p.1">The NAT-External-Address AVP (AVP code TBD) is of type Grouped, and it describes the external IP address and port for a binding.  IP-Address-Mask AVP can only be specified when Framed-IP-Address AVP is present. External IP address specified in this attribute can be reused for multiple subscribers by specifying the same address in the respective NAT-External-Address AVPs.</p>
<p id="rfc.section.8.7.6.p.2">AVP format:</p>
<div id="#rfc.figure.23"></div>
<pre>  NAT-External-Address ::= &lt; AVP Header: TBD &gt;
                            [ Framed-IP-Address ]
                            [ IP-Address-Mask ]
                            [ Port ]
                          * [ AVP ]</pre>
<h1 id="rfc.section.8.7.7">
<a href="#rfc.section.8.7.7">8.7.7.</a> <a href="#avp_Max-NAT-Bindings" id="avp_Max-NAT-Bindings">Max-NAT-Bindings</a>
</h1>
<p id="rfc.section.8.7.7.p.1">The Max-NAT-Bindings AVP (AVP code TBD) is of type Unsigned32. It indicates the maximum number of NAT bindings allowed.</p>
<h1 id="rfc.section.8.7.8">
<a href="#rfc.section.8.7.8">8.7.8.</a> <a href="#avp_NAT-Control-Binding-Rule" id="avp_NAT-Control-Binding-Rule">NAT-Control-Binding-Rule AVP</a>
</h1>
<p id="rfc.section.8.7.8.p.1">The NAT-Control-Binding-Rule AVP (AVP code TBD) is of type OctetString. It defines a name for a policy template that will be predefined at NAT. Details on the contents and structure of the template and configuration are outside the scope of this document.  The policy to which this AVP refers to may contain NAT bindings, address pool for external address allocation of NAT binding, and maximum allowed NAT bindings. Such policy template can be reused by specifying same NAT-Control-Binding-Rule AVP in corresponding NAT-Control-Install AVPs of multiple subscribers.</p>
<h1 id="rfc.section.8.7.9">
<a href="#rfc.section.8.7.9">8.7.9.</a> <a href="#avp_Duplicate-Session-Id" id="avp_Duplicate-Session-Id">Duplicate-Session-Id AVP</a>
</h1>
<p id="rfc.section.8.7.9.p.1">The Duplicate-Session-Id AVP (AVP Code TBD) is of type UTF8String. It is used to report error and contains the Session-Id of an existing session.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#sec-accounting" id="sec-accounting">Accounting Commands</a>
</h1>
<p id="rfc.section.9.p.1">DNCA reuses session based accounting as defined in Diameter Base Protocol<a href="#RFC3588">[RFC3588]</a> to report the bindings per endpoint. This reporting is achieved by sending Diameter Accounting Requests (ACR) [Start, Interim and Stop] from DNCA Agent to DNCA Manager.</p>
<p id="rfc.section.9.p.2">DNCA Agent sends an ACR Start on receiving an NCR with NC-Request-Type AVP set to INITIAL_REQUEST for a session or on creation of the first binding for a session requested in an earlier NCR. DNCA may send ACR Interim updates, if required, either due to a change in bindings resulting from a NCR with NC-Request-Type AVP set to UPDATE_REQUEST, or periodically as specified in Acct-Interim-Interval by DNCA Manager, or when it creates or tears down bindings. An ACR Stop is sent by DNCA Agent on receiving STR.</p>
<p id="rfc.section.9.p.3">The function of correlating the multiple bindings used by an endpoint at any given time is relegated to the post processor.</p>
<p id="rfc.section.9.p.4">DNCA Agent may trigger an interim accounting record when maximum number of bindings, if received in NCR, is reached.</p>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> NAT Control Accounting Messages</h1>
<p id="rfc.section.9.1.p.1">The ACR and ACA messages are reused as defined in Diameter Base Protocol <a href="#RFC3588">[RFC3588]</a> for exchanging endpoint NAT binding details between DNCA Agent and DNCA Manager. DNCA Application ID is used in the accounting commands. ACR contains one or more optional NAT-Control-Record AVP to report the bindings. DNCA Agent indicates the number of allocated NAT bindings to DNCA Manager using the Current-NAT-Bindings AVP. This number needs to match the number of bindings identified as active within the NAT-Control-Record AVP.</p>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> NAT Control Accounting AVPs</h1>
<p id="rfc.section.9.2.p.1">In addition to AVPs for ACR specified in <a href="#RFC3588">[RFC3588]</a>, DNCA Agent must add the NAT-Control-Record AVP.</p>
<h1 id="rfc.section.9.2.1">
<a href="#rfc.section.9.2.1">9.2.1.</a> <a href="#avp_NAT-Control-Record" id="avp_NAT-Control-Record">NAT-Control-Record</a>
</h1>
<p id="rfc.section.9.2.1.p.1">The NAT-Control-Record AVP (AVP code TBD) is of type Grouped. It describes a binding and its status. If NAT-Control-Binding-Status is set to Created, Event-Timestamp indicates the binding creation time.  If NAT-Control-Binding-Status is set to Removed, Event-Timestamp indicates the binding removal time. If NAT-Control-Binding-Status is active, Event-Timestamp need not be present; if a value is present, it indicates that binding is active at the given time.</p>
<div id="#rfc.figure.24"></div>
<pre>  NAT-Control-Record ::= &lt; AVP Header: TBD &gt;
                         { NAT-Control-Definition }
                         { NAT-Control-Binding-Status } 
                         [ Event-Timestamp ]</pre>
<h1 id="rfc.section.9.2.2">
<a href="#rfc.section.9.2.2">9.2.2.</a> <a href="#avp_NAT-Control-Binding-Status" id="avp_NAT-Control-Binding-Status">NAT-Control-Binding-Status</a>
</h1>
<p id="rfc.section.9.2.2.p.1">The NAT-Control-Binding-Status AVP (AVP code TBD) is of type enumerated. It indicates the status of the binding - created, removed, or active.</p>
<p id="rfc.section.9.2.2.p.2">The following values are defined: </p>

<ul class="empty">
<li>Created (1)<ul class="empty"><li>NAT binding is created.</li></ul>
</li>
<li>Active (2)<ul class="empty"><li>NAT binding is active.</li></ul>
</li>
<li>Removed (3)<ul class="empty"><li>NAT binding was removed.</li></ul>
</li>
</ul>
<h1 id="rfc.section.9.2.3">
<a href="#rfc.section.9.2.3">9.2.3.</a> <a href="#avp_Current-NAT-Bindings" id="avp_Current-NAT-Bindings">Current-NAT-Bindings</a>
</h1>
<p id="rfc.section.9.2.3.p.1">The Current-NAT-Bindings AVP (AVP code TBD) is of type Unsigned32. It indicates number of NAT bindings active on NAT device.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#sec-avp-occurence-table" id="sec-avp-occurence-table">AVP Occurrence Table</a>
</h1>
<p id="rfc.section.10.p.1">The following sections presents the AVPs defined in this document and specifies the Diameter messages in which, they MAY be present. Note: AVPs that can only be present within a Grouped AVP are not represented in this table.</p>
<p id="rfc.section.10.p.2">The table uses the following symbols:</p>
<p></p>

<ul class="empty"><li><dl>
<dt>0</dt>
<dd style="margin-left: 10">The AVP MUST NOT be present in the message.</dd>
<dt>0+</dt>
<dd style="margin-left: 10">Zero or more instances of the AVP MAY be present in the message.</dd>
<dt>0-1</dt>
<dd style="margin-left: 10">Zero or one instance of the AVP MAY be present in the message. It is considered an error if there is more than one instance of the AVP.</dd>
<dt>1</dt>
<dd style="margin-left: 10">One instance of the AVP MUST be present in the message.</dd>
<dt>1+</dt>
<dd style="margin-left: 10">At least one instance of the AVP MUST be present in the message.</dd>
</dl></li></ul>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> DNCA AVP Table for NAT Control Initial and Update Requests</h1>
<p id="rfc.section.10.1.p.1">The following table lists DNCA specific AVPs that have to be present in NCR and NCA with NC-Request-Type set to INITIAL_REQUEST or UPDATE_REQUEST.</p>
<div id="#rfc.figure.25"></div>
<pre>                                    +-------------------+
                                    |  Command Code     |
+-----------------------------------+-------------------+
| Attribute Name                        NCR    NCA      |
+-------------------------------------------------------+
|NC-Request-Type                         1      1       |
|NAT-Control-Install                     0-1    0       |
|NAT-Control-Remove                      0-1    0       |
|NAT-Control-Definition                  0      0       |
|Current-NAT-Bindings                    0      0       |
|Duplicate-Session-Id                    0      0-1     |
+-------------------------------------------------------+</pre>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> DNCA AVP Table for Session Query request</h1>
<p id="rfc.section.10.2.p.1">The following table lists DNCA specific AVPs that have to be present in NCR and NCA with NC-Request-Type set to QUERY_REQUEST.</p>
<div id="#rfc.figure.26"></div>
<pre>                                    +-------------------+
                                    |  Command Code     |
+-----------------------------------+-------------------+
| Attribute Name                        NCR    NCA      |
+-------------------------------------------------------+
|NC-Request-Type                         1      1       |
|NAT-Control-Install                     0      0       |
|NAT-Control-Remove                      0      0       |
|NAT-Control-Definition                  0      0+      |
|Current-NAT-Bindings                    0      1       |
|Duplicate-Session-Id                    0      0       |
+-------------------------------------------------------+</pre>
<h1 id="rfc.section.10.3">
<a href="#rfc.section.10.3">10.3.</a> DNCA AVP Table for Accounting Message</h1>
<p id="rfc.section.10.3.p.1">The following table lists DNCA specific AVPs, which may or may not be present in ACR and ACA messages.</p>
<div id="#rfc.figure.27"></div>
<pre>                                    +-------------------+
                                    |  Command Code     |
+-----------------------------------+-------------------+
| Attribute Name                        ACR    ACA      |
+-------------------------------------------------------+
|NAT-Control-Record                      0+     0       |
|Current-NAT-Bindings                    1      0       |
+-------------------------------------------------------+
</pre>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.11.p.1">This section contains the namespaces that have either been created in this specification or had their values assigned to existing namespaces managed by IANA.</p>
<h1 id="rfc.section.11.1">
<a href="#rfc.section.11.1">11.1.</a> Command Codes</h1>
<p id="rfc.section.11.1.p.1">IANA is requested to allocate command code values for the following.</p>
<p id="rfc.section.11.1.p.2">Registry:</p>
<div id="#rfc.table.1"></div>
<div id="#table_command-codes"></div>
<table cellpadding="3" cellspacing="0" class="tt full right">
<caption>Command codes</caption>
<thead><tr>
<th class="left">Code Value</th>
<th class="left">Name</th>
<th class="left">Reference</th>
</tr></thead>
<tbody><tr>
<td class="left">to be assigned</td>
<td class="left">NAT-Control-Request (NCR), NAT-Control-Answer (NCA)</td>
<td class="left">
<a href="#sec-dnca-ncr">Section 6.1</a>, <a href="#sec-dnca-nca">Section 6.2</a>
</td>
</tr></tbody>
</table>
<p></p>
<h1 id="rfc.section.11.2">
<a href="#rfc.section.11.2">11.2.</a> AVP Codes</h1>
<p id="rfc.section.11.2.p.1">IANA is requested to allocate AVP codes for the following AVPs that are defined in this document.</p>
<p id="rfc.section.11.2.p.2">Registry:</p>
<div id="#rfc.table.2"></div>
<div id="#table_avp-codes"></div>
<table cellpadding="3" cellspacing="0" class="tt full right">
<caption>AVP codes</caption>
<thead><tr>
<th class="left">Code Value</th>
<th class="left">Name</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">to be assigned</td>
<td class="left">NC-Request-Type</td>
<td class="left"><a href="#avp_NC-Request-Type">Section 8.7.1</a></td>
</tr>
<tr>
<td class="left">to be assigned</td>
<td class="left">NAT-Control-Install</td>
<td class="left"><a href="#avp_NAT-Control-Install">Section 8.7.2</a></td>
</tr>
<tr>
<td class="left">to be assigned</td>
<td class="left">NAT-Control-Remove</td>
<td class="left"><a href="#avp_NAT-Control-Remove">Section 8.7.3</a></td>
</tr>
<tr>
<td class="left">to be assigned</td>
<td class="left">NAT-Control-Definition</td>
<td class="left"><a href="#avp_NAT-Control-Definition">Section 8.7.4</a></td>
</tr>
<tr>
<td class="left">to be assigned</td>
<td class="left">NAT-Internal-Address</td>
<td class="left"><a href="#avp_NAT-Internal-Address">Section 8.7.5</a></td>
</tr>
<tr>
<td class="left">to be assigned</td>
<td class="left">NAT-External-Address</td>
<td class="left"><a href="#avp_NAT-External-Address">Section 8.7.6</a></td>
</tr>
<tr>
<td class="left">to be assigned</td>
<td class="left">Max-NAT-Bindings</td>
<td class="left"><a href="#avp_Max-NAT-Bindings">Section 8.7.7</a></td>
</tr>
<tr>
<td class="left">to be assigned</td>
<td class="left">NAT-Control-Binding-Rule</td>
<td class="left"><a href="#avp_NAT-Control-Binding-Rule">Section 8.7.8</a></td>
</tr>
<tr>
<td class="left">to be assigned</td>
<td class="left">Duplicate-Session-Id</td>
<td class="left"><a href="#avp_Duplicate-Session-Id">Section 8.7.9</a></td>
</tr>
<tr>
<td class="left">to be assigned</td>
<td class="left">NAT-Control-Record</td>
<td class="left"><a href="#avp_NAT-Control-Record">Section 9.2.1</a></td>
</tr>
<tr>
<td class="left">to be assigned</td>
<td class="left">NAT-Control-Binding-Status</td>
<td class="left"><a href="#avp_NAT-Control-Binding-Status">Section 9.2.2</a></td>
</tr>
<tr>
<td class="left">to be assigned</td>
<td class="left">Current-NAT-Bindings</td>
<td class="left"><a href="#avp_Current-NAT-Bindings">Section 9.2.3</a></td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.11.3">
<a href="#rfc.section.11.3">11.3.</a> AVP Values</h1>
<p></p>
<h1 id="rfc.section.11.3.1">
<a href="#rfc.section.11.3.1">11.3.1.</a> Result-Code AVP Values</h1>
<p><a href="#sec_result-codes">Section 8.2</a> defines several new values for the Result-Code AVP for transient and permanent failures.  IANA is requested to allocate the corresponding values from the ranges for transient (4xxx) and permantent (5xxx) failures.</p>
<div id="#rfc.table.3"></div>
<div id="#table_result-code-avps"></div>
<table cellpadding="3" cellspacing="0" class="tt full right">
<caption>Result Code AVP Values</caption>
<thead><tr>
<th class="left">Code Value</th>
<th class="left">Name</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">to be assigned (4xxx)</td>
<td class="left">RESOURCE_FAILURE</td>
<td class="left"><a href="#sec_result-code-transient">Section 8.2.2</a></td>
</tr>
<tr>
<td class="left">to be assigned (5xxx)</td>
<td class="left">UNKNOWN_BINDING_RULE_NAME</td>
<td class="left"><a href="#sec_result-code-permanent">Section 8.2.3</a></td>
</tr>
<tr>
<td class="left">to be assigned (5xxx)</td>
<td class="left">BINDING_FAILURE</td>
<td class="left"><a href="#sec_result-code-permanent">Section 8.2.3</a></td>
</tr>
<tr>
<td class="left">to be assigned (5xxx)</td>
<td class="left">MAXIMUM_BINDINGS_REACHED_FOR_ENDPOINT</td>
<td class="left"><a href="#sec_result-code-permanent">Section 8.2.3</a></td>
</tr>
<tr>
<td class="left">to be assigned (5xxx)</td>
<td class="left">SESSION_EXISTS</td>
<td class="left"><a href="#sec_result-code-permanent">Section 8.2.3</a></td>
</tr>
<tr>
<td class="left">to be assigned (5xxx)</td>
<td class="left">INSUFFICIENT_CLASSIFIERS</td>
<td class="left"><a href="#sec_result-code-permanent">Section 8.2.3</a></td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.11.4">
<a href="#rfc.section.11.4">11.4.</a> Application IDs</h1>
<p id="rfc.section.11.4.p.1">IANA is requested to allocate the following application ID using the next value from the 7-16777215 range.</p>
<p id="rfc.section.11.4.p.2">Registry:</p>
<div id="#rfc.table.4"></div>
<div id="#table_id-codes"></div>
<table cellpadding="3" cellspacing="0" class="tt full right">
<caption> Diameter Application ID values</caption>
<thead><tr>
<th class="left">ID Value</th>
<th class="left">Name</th>
<th class="left">Reference</th>
</tr></thead>
<tbody><tr>
<td class="left">to be assigned</td>
<td class="left">Diameter NAT Control Application</td>
<td class="left"><a href="#sec-dnca">Section 4</a></td>
</tr></tbody>
</table>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.12.p.1">Similar to the impact of Diameter QoS application (see <a href="#RFC5866">[RFC5866]</a>) on authorization of QoS reservations, this document describes procedures for authorizing NAT related attributes and parameters by an entity, which is non-local to the device performing NAT. The security considerations for the Diameter QoS application (see <a href="#RFC5866">[RFC5866]</a> section 11) apply in a similar way to DNCA. To secure the information exchange between the authorizing entity (DNCA Manager) and the NAT device (DNCA Agent) requires bilateral authentication of the involved parties, authorization of the involved parties to perform the required procedures and functions, and procedures to ensure integrity and confidentiality of the information exchange MAY be performed. DNCA makes use of the capabilities offered by Diameter and the underlying transport protocols to deliver these requirements (see <a href="#sec-diameter-messages">Section 5.1</a> ).</p>
<p id="rfc.section.12.p.2">It is assumed that DNCA Agent and DNCA Manager are in the same domain and have a mutual trust set up. Authorization between DNCA Agent and DNCA Manager is beyond the scope of this document.</p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> Acknowledgements</h1>
<p id="rfc.section.13.p.1">The authors would like to thank Jouni Korhonen, Avi Lior, Chris Metz, Pallavi Mishra, Lionel Morand, Hannes Tschofenig, Shashank Vikram, Greg Weber, and Glen Zorn for their input on this document.</p>
<h1 id="rfc.section.14">
<a href="#rfc.section.14">14.</a> Change History (to be removed prior to publication as an RFC) </h1>
<p id="rfc.section.14.p.1">Changes from -00 to -01</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>new values for Result-Code AVP used - instead of Experimental-Result AVP</li>
<li>added support for transport specific binding (UDP/TCP)</li>
<li>added support for twice-NAT</li>
<li>clarified the use of the two different types of query-requests</li>
</ol>
<p id="rfc.section.14.p.3">Changes from -01 to -02</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>Reference to pull mode removed, session initiation event clarified in section 4.1</li>
<li>added Redirect-* AVPs in NCA command</li>
<li>Removed reference to Called-Station-Id AVP in NCR command</li>
<li>Editorial changes</li>
<li>added support for bindings providing AFT (NAT64)</li>
</ol>

<p>Changes from -02 to -03</p>

<ol style="list-style-type: lower-alpha"><li>Editorial changes</li></ol>

<p>Changes from -03 to -04</p>

<ol style="list-style-type: lower-alpha">
<li>Editorial changes suggested in WG Lastcall review</li>
<li>Removed NCR Request type terminate and replaced with STR</li>
<li>All references to Auth-Session-State are removed and a new section to describe FSM for Manager and Agent has been added</li>
<li>Clarified reuse of External address and address pools among multiple subscribers</li>
</ol>

<p>Changes from -04 to -05</p>

<ol style="list-style-type: lower-alpha"><li>Removed references to Large Scale NAT as per review comments</li></ol>

<p>Changes from -05 to -06</p>

<ol style="list-style-type: lower-alpha"><li>Editorial changes</li></ol>

<p>Changes from -06 to -07</p>

<ol style="list-style-type: lower-alpha">
<li>Added a note in section 4.3 stating the state of pre-existing bindings on update failure</li>
<li>Security considerations are made consistent between sections 5.1 and 12</li>
<li>Editorial changes</li>
</ol>
<h1 id="rfc.references">
<a href="#rfc.references">15.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">15.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3588">[RFC3588]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Loughney, J.</a>, <a>Guttman, E.</a>, <a>Zorn, G.</a> and <a>J. Arkko</a>, "<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>", RFC 3588, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4675">[RFC4675]</b></td>
<td class="top">
<a>Congdon, P.</a>, <a>Sanchez, M.</a> and <a>B. Aboba</a>, "<a href="http://tools.ietf.org/html/rfc4675">RADIUS Attributes for Virtual LAN and Priority Support</a>", RFC 4675, September 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5777">[RFC5777]</b></td>
<td class="top">
<a>Korhonen, J.</a>, <a>Tschofenig, H.</a>, <a>Arumaithurai, M.</a>, <a>Jones, M.</a> and <a>A. Lior</a>, "<a href="http://tools.ietf.org/html/rfc5777">Traffic Classification and Quality of Service (QoS) Attributes for Diameter</a>", RFC 5777, February 2010.</td>
</tr>
<tr>
<td class="reference"><b id="ETSIES283034">[ETSIES283034]</b></td>
<td class="top">
<a>ETSI, </a>, "<a>Telecommunications and Internet Converged Services and Protocols for Advanced Networks (TISPAN),Network Attachment Sub-System (NASS),e4 interface based on the Diameter protocol.</a>", September 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4005">[RFC4005]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Zorn, G.</a>, <a>Spence, D.</a> and <a>D. Mitton</a>, "<a href="http://tools.ietf.org/html/rfc4005">Diameter Network Access Server Application</a>", RFC 4005, August 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">15.2.</a> Informative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC5866">[RFC5866]</b></td>
<td class="top">
<a>Sun, D.</a>, <a>McCann, P.</a>, <a>Tschofenig, H.</a>, <a>Tsou, T.</a>, <a>Doria, A.</a> and <a>G. Zorn</a>, "<a href="http://tools.ietf.org/html/rfc5866">Diameter Quality-of-Service Application</a>", RFC 5866, May 2010.</td>
</tr></tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Frank Brockners</span> 
	  <span class="n hidden">
		<span class="family-name">Brockners</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  <span>Hansaallee 249, 3rd Floor</span>

	  <span class="vcardline">
		<span class="locality">DUESSELDORF</span>,  
		<span class="region">NORDRHEIN-WESTFALEN</span> 
		<span class="code">40549</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:fbrockne@cisco.com">fbrockne@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Shwetha Bhandari</span> 
	  <span class="n hidden">
		<span class="family-name">Bhandari</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  <span>Cessna Business Park, Sarjapura Marathalli Outer Ring Road</span>

	  <span class="vcardline">
		<span class="locality">Bangalore, KARNATAKA 560 087</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:shwethab@cisco.com">shwethab@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Vaneeta Singh</span> 
	  <span class="n hidden">
		<span class="family-name">Singh</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  <span>18, Cambridge Road</span>

	  <span class="vcardline">
		<span class="locality">Bangalore 560008</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:vaneeta.singh@gmail.com">vaneeta.singh@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Victor Fajardo</span> 
	  <span class="n hidden">
		<span class="family-name">Fajardo</span>
	  </span>
	</span>
	<span class="org vcardline">Telcordia Technologies</span>
	<span class="adr">
	  <span>1 Telcordia Drive #1S-222</span>

	  <span class="vcardline">
		<span class="locality">Piscataway, NJ 08854</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:vf0213@gmail.com">vf0213@gmail.com</a></span>

  </address>
</div>

</body>
</html>