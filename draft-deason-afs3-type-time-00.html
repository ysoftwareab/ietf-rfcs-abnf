<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Base Types for Time in AFS-3</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Data Types">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 AFSAbsTime">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 AFSRelTime">
<link href="#rfc.section.3" rel="Chapter" title="3 Security Considerations">
<link href="#rfc.section.4" rel="Chapter" title="4 IANA Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="6 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document defines two types to be used in future AFS-3 Rx Remote Procedure Calls (RPCs) to represent time. Current AFS-3 RPCs represent time as 32-bit integers representing seconds. This is insufficient in both granularity and range, so new types to represent time are defined in this document to overcome these limitations." />
  <meta name="description" content="This document defines two types to be used in future AFS-3 Rx Remote Procedure Calls (RPCs) to represent time. Current AFS-3 RPCs represent time as 32-bit integers representing seconds. This is insufficient in both granularity and range, so new types to represent time are defined in this document to overcome these limitations." />
  <meta name="keywords" content="AFS3, AFS-3, time, AFSAbsTime, AFSRelTime" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">N/A</td>
<td class="right">A.P.D. Deason</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Sine Nomine</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">March 07, 2011</td>
</tr>
<tr>
<td class="left">Expires: September 08, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Base Types for Time in AFS-3<br />
  <span class="filename">draft-deason-afs3-type-time-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document defines two types to be used in future AFS-3 Rx Remote Procedure Calls (RPCs) to represent time. Current AFS-3 RPCs represent time as 32-bit integers representing seconds. This is insufficient in both granularity and range, so new types to represent time are defined in this document to overcome these limitations.</p>
<h1><a>Internet Draft Comments</a></h1>
<p>Comments regarding this draft are solicited. Please include the AFS-3 protocol standardization mailing list (afs3-standardization@openafs.org) as a recipient of any comments.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 08, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Data Types</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">AFSAbsTime</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">AFSRelTime</a>
</li>
<li>3.   <a href="#rfc.section.3">Security Considerations</a>
</li>
<li>4.   <a href="#rfc.section.4">IANA Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">Acknowledgements</a>
</li>
<li>6.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">All extant AFS-3 RPCs represent time as a 32-bit integer, as encoded by XDR in <a href="#RFC4506">[RFC4506]</a>, which represents a number of seconds. For RPCs that specify an absolute time, this is the number of seconds that have passed since since midnight or 0 hour January 1, 1970 Coordinated Universal Time (UTC), not counting leap seconds. These time structures will be unusable after January 2038, and are already insufficient to represent time with more granularity than one second.</p>
<p id="rfc.section.1.p.2">This limited granularity creates inefficiencies in various parts of the AFS-3 protocol when it must be determined in what order two events have occurred (for example, whether or not a file was changed since the last time a volume has been backed up). When those two events have occurred during the same second, implementations must take a conservative assumption about which event occurred first, often resulting in unnecessary duplication or retransmission of data. In addition, metadata can be lost when files are copied to AFS from other filesystems that store file modification times with finer granularity than one second.</p>
<p id="rfc.section.1.p.3">This document defines a new type, AFSAbsTime, to be used in AFS-3 RPCs in the future. This type aims to solve these problems, as it supports a much wider range of dates at a much finer granularity. Another type, AFSRelTime, is defined to represent times relative to some other event, which provides for greater granularity over the existing representations via 32-bit integers.</p>
<p id="rfc.section.1.p.4">Both of these new types also provide standard type identifiers to be used when specifying relative or absolute time in AFS-3 RPC arguments and structures. Currently, both of these are just specified as "afs_int32" types in the XDR language definitions, which can make it ambiguous whether or not a field is an absolute time, relative time, or something else completely. Using the standard types AFSAbsTime and AFSRelTime will make this unambiguous.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Data Types</h1>
<p id="rfc.section.2.p.1">This document defines two new data types: AFSAbsTime and AFSRelTime. Both of these are encoded on the wire using the XDR standard described in <a href="#RFC4506">[RFC4506]</a>, and are described using the XDR language specification therein.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#afsabstime" id="afsabstime">AFSAbsTime</a>
</h1>
<p id="rfc.section.2.1.p.1">The new AFSAbsTime type is represented as an XDR-encoded structure containing a 64-bit unsigned integer as the timestamp, and an unsigned 32-bit integer representing the resolution. It is defined as thus in XDR:</p>
<div id="#rfc.figure.1"></div>
<pre>
    struct AFSAbsTime {
      unsigned hyper timestamp;
      unsigned int resolution;
    };
</pre>
<p id="rfc.section.2.1.p.2">The AFSAbsTime structure represents the amount of time that has passed since midnight or 0 hour January 1, 1601 Coordinated Universal Time (UTC). The value of the timestamp field represents this amount of time in increments of 100 nanoseconds (ns). This precision and starting date is equivalent to the Microsoft Windows FILETIME structure.</p>
<p id="rfc.section.2.1.p.3">The value of the resolution field represents the resolution of the time source from which the timestamp was obtained. The presence of this field is important when calculating the order in which two events occurred relative to each other. If a timestamp is obtained from a time source that only has 1-second granularity, the event may have occurred anywhere in that second, whereas if it was obtained from a source with 100-ns granularity, it is known that it occurred before an event that occurred 0.5 seconds later.</p>
<p id="rfc.section.2.1.p.4">The value of the resolution field is the smallest amount of time representable by that time source, in increments of 100 ns. If the value of the timestamp field is X, and the value of the resolution is Y, the AFSAbsTime structure describes an event that occurs at or after time X, but before time X+Y.</p>
<p id="rfc.section.2.1.p.5">For example, to represent the time 60 seconds after midnight on January 1, 1601, the value of the timestamp field would be 600000000 (600 million). If the time source this was obtained from only has 1-second granularity, the resolution field would have the value 10000000 (10 million). In effect, the AFSAbsTime structure then represents an event that happened at or after 60 seconds after midnight on January 1, 1601, but happened before 61 seconds after midnight on January 1, 1601.</p>
<p id="rfc.section.2.1.p.6">This structure can represent any time from January 1, 1601 up to the year 30282 with 100-ns granularity.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> AFSRelTime</h1>
<p id="rfc.section.2.2.p.1">The new AFSRelTime type has nearly the same representation on the wire as AFSAbsTime in <a href="#afsabstime">Section 2.1</a>:</p>
<div id="#rfc.figure.2"></div>
<pre>
    struct AFSRelTime {
      hyper timestamp;
      unsigned int resolution;
    };
</pre>
<p id="rfc.section.2.2.p.2">The AFSRelTime structure represents the amount of time that has passed since some other event. The event to which this time is relative is unspecified, and can be anything; it must be specified by the RPC or structure that defines a field of the AFSRelTime type.</p>
<p id="rfc.section.2.2.p.3">The value of the timestamp field represents this amount of time in increments of 100 ns. Values greater than 0 represent dates that occur after the relative event, and values less than 0 represent dates that occur before the relative event.</p>
<p id="rfc.section.2.2.p.4">The meaning and value of the resolution field is the same as that of the resolution field in AFSAbsTime specified in <a href="#afsabstime">Section 2.1</a>.</p>
<p id="rfc.section.2.2.p.5">For example, to represent the time 5 seconds before some other event, the value of the timestamp field would be -50000000 (negative 50 million). If the time source has 1-second granularity, the resolution field would have the value 10000000 (10 million). In effect, the AFSRelTime structure then represents an event that happens at or after 5 seconds before some other event X, but before 4 seconds before the event X.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Security Considerations</h1>
<p id="rfc.section.3.p.1">This memo raises no security issues.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> IANA Considerations</h1>
<p id="rfc.section.4.p.1">This document makes no request of the IANA.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Acknowledgements</h1>
<p id="rfc.section.5.p.1">The author thanks Simon Wilkinson And Jeffrey Altman for some background text and for bringing up the question of varying time resolution, and Tom Keiser and David Boyes for input on the problem of time resolution.</p>
<h1 id="rfc.references">
<a href="#rfc.references">6.</a> References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC4506">[RFC4506]</b></td>
<td class="top">
<a>Eisler, M.</a>, "<a href="http://tools.ietf.org/html/rfc4506">XDR: External Data Representation Standard</a>", STD 67, RFC 4506, May 2006.</td>
</tr></tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Andrew Deason</span> 
	  <span class="n hidden">
		<span class="family-name">Deason</span>
	  </span>
	</span>
	<span class="org vcardline">Sine Nomine Associates</span>
	<span class="adr">
	  <span>43596 Blacksmith Square</span>

	  <span class="vcardline">
		<span class="locality">Ashburn</span>,  
		<span class="region">Virginia</span> 
		<span class="code">20147-4606</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 703 723 6673</span>

<span class="vcardline">EMail: <a href="mailto:adeason@sinenomine.net">adeason@sinenomine.net</a></span>

  </address>
</div>

</body>
</html>