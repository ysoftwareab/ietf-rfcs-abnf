<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IGMP/MLD Error Feedback</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IGMP/MLD Error Feedback">
<meta name="keywords" content="draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">mboned</td><td class="header">T. Morin</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">France Telecom - Orange Labs</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">November 12, 2007</td></tr>
<tr><td class="header">Expires: May 15, 2008</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />IGMP/MLD Error Feedback<br />draft-morin-mboned-igmpmld-error-feedback-00</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 15, 2008.</p>

<h3>Abstract</h3>

<p>This document describes messages and procedures that can optionnaly
      be implemented in IGMP/MLD Queriers and Hosts, to provide information to
      terminals on the reason why the IGMP/MLD Querier didn't take into
      account a Membership Report message.
</p>
<h3>Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
History and problem statement<br />
<a href="#anchor4">4.</a>&nbsp;
Principle<br />
<a href="#procedures">5.</a>&nbsp;
Procedures<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.1.</a>&nbsp;
Procedures on the IGMP/MLD Querier<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.2.</a>&nbsp;
Procedures on the IGMP/MLD Host<br />
<a href="#anchor7">6.</a>&nbsp;
Message encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">6.1.</a>&nbsp;
Base encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">6.2.</a>&nbsp;
Protocol to carry error feedback messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.2.1.</a>&nbsp;
ICMP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">6.2.2.</a>&nbsp;
IGMP/MLD<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#error-codes">6.3.</a>&nbsp;
Error codes<br />
<a href="#application">7.</a>&nbsp;
Feedback to the application layer<br />
<a href="#anchor12">8.</a>&nbsp;
Impact on IGMP/MLD proxies and equipments doing IGMP/MLD snooping<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">8.1.</a>&nbsp;
IGMP/MLD Proxies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">8.2.</a>&nbsp;
Equipments doing IGMP/MLD snooping<br />
<a href="#IANA">9.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">10.</a>&nbsp;
Security Considerations<br />
<a href="#Acknowledgements">11.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Requirements have been formulated for means to provide mutticast
      terminals with error feedback when the IGMP/MLD Querier did not or could
      not process an IGMP/MLD Membership Report message (<a class='info' href='#I-D.ietf-mboned-maccnt-req'>[I&#8209;D.ietf&#8209;mboned&#8209;maccnt&#8209;req]<span> (</span><span class='info'>He, H., &ldquo;Requirements for Multicast AAA coordinated between Content Provider(s) and  Network Service Provider(s),&rdquo; October&nbsp;2007.</span><span>)</span></a>, section 4). Operator's
      experience with IPTV deployments show that introducing such a feedback
      in IGMP exhanges between terminals and multicast access equipments would
      help provide a better service (e.g. a liaison between the IETF mboned
      working group and the DSLForum was made in December 2005 to discuss this
      issue, but didn't lead to a standardized solution).
</p>
<p>An examples case is when an IGMP Querier refuses to take into account
      an IGMP Membership Report because the number of multicast channels would
      outpass the allowed threshold for the service. Many other examples of
      the case where an IGMP error feedback channel would be useful are
      presented in <a class='info' href='#error-codes'>Section&nbsp;6.3<span> (</span><span class='info'>Error codes</span><span>)</span></a>.
</p>
<p>This document describes new message encodings and the associated
      procedures, all of which being optional and preserving full backward and
      forward compatibility, and details the impact on the host API for
      multicast subscriptions.
</p>
<p>This document doesn't state yet whether the messages should be
      carried over IGMP, ICMP or another protocol, but tries to document the
      pros and cons of the different alternatives, to guide the decision
      process.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The terminology in this document is the terminology used in <a class='info' href='#RFC3376'>[RFC3376]<span> (</span><span class='info'>Cain, B., Deering, S., Kouvelas, I., Fenner, B., and A. Thyagarajan, &ldquo;Internet Group Management Protocol, Version 3,&rdquo; October&nbsp;2002.</span><span>)</span></a> and <a class='info' href='#RFC3810'>[RFC3810]<span> (</span><span class='info'>Vida, R. and L. Costa, &ldquo;Multicast Listener Discovery Version 2 (MLDv2) for IPv6,&rdquo; June&nbsp;2004.</span><span>)</span></a>.
</p>
<p>For readability, "Querier" and "Host(s)" will be used thoughout this
      document, in place of "IGMP or MLD Querier" and "IGMP or MLD
      Host(s)".
</p>
<p>
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
History and problem statement</h3>

<p>The DSLForum expressed interest for such a feature, which was <a class='info' href='#magma-archive'>discussed<span> (</span><span class='info'>, &ldquo;IETF Magma WG mailing-list archives,&rdquo; December&nbsp;2005.</span><span>)</span></a> [magma&#8209;archive] in a liaison with the Magma IETF
      Working group. The specifications described in this document try to
      address the comments exchanged on the magma WG mailing-list.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Principle</h3>

<p>The procedures described in this memo are fully optionnal : their
      only intent is to carry informative data from the IGMP/MLD Querier to
      the IGMP/MLD Hosts.
</p>
<p>Most specifically, the intent is that:</p>
<ul class="text">
<li>the procedures don't change the state machine of the IGMP Querier
          or IGMP Host, the information carried is only meant to provide
          information to the application subscribed to multicast data
</li>
<li>an IGMP Host implementing these specifications will behave
          correctly in the absence of these informations.
</li>
<li>the behavior of an IGMP Querier implementing these specifications
          is unchanged whether or not the hosts implement these specs.
</li>
</ul>

<p>Last, these specifications are not meant to carry information about
      transient errors that the network is supposed to recover from, like
      network outages.
</p>
<a name="procedures"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Procedures</h3>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Procedures on the IGMP/MLD Querier</h3>

<p>The following procedures introduce a new type of message : the
        Feedback message. See section xxx for details about message
        encodings.
</p>
<p>Using these procedures a Querier can optionally emmit a Feedback
        message after receiving a Membership Report message that it can not
        process (see <a class='info' href='#error-codes'>Section&nbsp;6.3<span> (</span><span class='info'>Error codes</span><span>)</span></a> for example reasons on
        why a Querier would not process a Membership Report message).
</p>
<p>The Feedback message carries error type/sub-type field, and
        information about the group to which the error pertains. Optionally,
        if IGMPv3/MLDv2 is used, and if the error message pertains to some
        specific sources, the addresses of the sources to which the error
        pertains are included in the message.
</p>
<p>The address to which the Feedback message will be sent is
        determined as follows:</p>
<ul class="text">
<li>if IGMPv3/MLDv2 is used and if the sender IP address is not
            0.0.0.0 or 0000::/32, the address of sender of the IGMP Membership
            Report is used
</li>
<li>else, the group address that was mentioned in the Membership
            Report message is used
</li>
</ul>

<p>The source address MUST be the same address as the address used for
        Query messages, and the TTL MUST be set to 1.
</p>
<p>If IGMPv2/MLDv1 is being used, only one feedback message should be
        sent for a said Membership Report message.
</p>
<p>If IGMPv3/MLDv2 is being used, only one feedback message should be
        sent for each (S,G) in the Membership Report message.
</p>
<p>In any case the amount of Feedback messages sent on a link MUST be
        rate-limited,
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Procedures on the IGMP/MLD Host</h3>

<p>When a Host receives an Feedback message, it MAY process it.
</p>
<p>Processing a Feedback message consists in :</p>
<ul class="text">
<li>MANDATORY checking that the TTL is set to 1
</li>
<li>OPTIONALLY checking that the message source address is the
            address of a known Querier
</li>
<li>parsing the Feedback message
</li>
<li>determining the network sockets for which the Feedback message
            is relevant (G is the group address of the Feedback message)
<ul class="text">
<li>if no source address is included in the Feedback message,
                the sockets are the sockets that have some active forwarding
                state related to G (subscribed to G with a non-null include
                list)
</li>
<li>if some source addresses are indicated in the Feedback
                message, the sockets are the sockets to which traffic from at
                least one of these sources, and toward G, would be
                forwarded
</li>
</ul>
</li>
<li>notifying these sockets of the error (see <a class='info' href='#application'>Section&nbsp;7<span> (</span><span class='info'>Feedback to the application layer</span><span>)</span></a>)
</li>
<li>OPTIONALLY logging the error and/or doing any local action
            depending on policy
</li>
</ul>

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Message encoding</h3>

<p>This document currently only proposes a base encoding for the
      Feedback message. Discussion is left open on the protocol on which these
      messages should be piggybacked on, though ICMP and IGMP/MLD are natural
      candidates. The definitive choice and exact detailed encodings will be
      detailed in a later revision.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Base encoding</h3>

<p>Encoding of the error feedback message type, is as follows:</p>
<ul class="text">
<li>error type (1 byte)
</li>
<li>error sub-type (1 bytes)
</li>
<li>group address (field length depends on IP protocol revision
            used)
</li>
<li>number of sources in error (possibly zero), followed by the
            source addresses in error (possibly none, field length depends on
            IP protocol revision used and number of sources)
</li>
</ul>

<p>[ nice ASCII-art might be considered for future revisions ]
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Protocol to carry error feedback messages</h3>

<p>ICMP and IGMP/MLD are candidates for carrying the error feedback
        message. This section exposes the pros/cons of both alternatives, and
        ought to be removed once a decision is made on one of them.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.1"></a><h3>6.2.1.&nbsp;
ICMP</h3>

<p>The Feedback message could be an ICMP message that would use a
          new ICMP message type (or possibly reusing existing types and
          codes).
</p>
<p>Pros:</p>
<ul class="text">
<li>ICMP is already used to carry error messages between routers
              and hosts (e.g.. port unreachable message)
</li>
<li>ICMP has an extensible format which could easily be reused
              for the Feedback function described in this memo
</li>
<li>Implementations of network socket APIs already take into
              account ICMP messages
</li>
</ul>

<p>Cons:</p>
<ul class="text">
<li>ICMP has currently nothing to do with multicast today
</li>
<li>some RFC explicitly forbid the sending of ICMP in reaction to
              receiving multicast packets, and IGMP/MLD Membership Reports are
              multicast packets (<a class='info' href='#RFC1122'>[RFC1122]<span> (</span><span class='info'>Braden, R., &ldquo;Requirements for Internet Hosts - Communication Layers,&rdquo; October&nbsp;1989.</span><span>)</span></a> section 7.2
              and 3.2.2, <a class='info' href='#RFC1812'>[RFC1812]<span> (</span><span class='info'>Baker, F., &ldquo;Requirements for IP Version 4 Routers,&rdquo; June&nbsp;1995.</span><span>)</span></a> section 4.3.2.7) (see
              <a class='info' href='#fenner-icmp-mcast'>[fenner&#8209;icmp&#8209;mcast]<span> (</span><span class='info'>, &ldquo;ICMP errors in response to multicast,&rdquo; March&nbsp;1999.</span><span>)</span></a>).
</li>
<li>ICMP messages are (currently) never sent toward multicast
              addresses, whereas that would be required to send Feedback
              messages to IGMPv2/MLDv1 hosts
</li>
</ul>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.2"></a><h3>6.2.2.&nbsp;
IGMP/MLD</h3>

<p>The Feedback message could be an IGMP or MLD message that would
          use new IGMP/MLD message types.
</p>
<p>Pros:</p>
<ul class="text">
<li>IGMP and MLD are the protocols used for all operations
              related to multicast subscription
</li>
</ul>

<p>Cons:</p>
<ul class="text">
<li>possibly more work to define the encodings
</li>
<li>a new IANA registry might be needed to manage Feedback error
              codes
</li>
<li>definition of how the network socket API will be used to
              carry the information to the applications has to be defined
</li>
</ul>

<a name="error-codes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Error codes</h3>

<p>This section describes some proposed based error types:
</p>
<p></p>
<ul class="text">
<li>improper message : the Membership Report message is improper
            (the group address is not in the 224/0 or FF00::/8 range, or
            specified sources are improper addresses)
</li>
<li>IGMP version not supported by querier
</li>
<li>wildcard on an SSM group : IGMPv2 or IGMPv3/MLDv2 with Exclude
            source filter mode was asked, but the group address is not in the
            SSM range of the Querier
</li>
<li>exclude source filter mode not supported by the Querier
</li>
<li>group administratively prohibited
</li>
<li>source(s) administratively prohibited
</li>
<li>resource limit reached
</li>
<li>multicast reception is disabled on the link
</li>
</ul>

<p>[ This section will later be completed to include error type
        numbers ]
</p>
<p>Remind that the Feedback message is NOT meant to carry information
        about transient errors that the network is supposed to recover from,
        like for instance network outages.
</p>
<p>An IANA registry may be required to manage these and future error
        codes, and provide third party with the ability to define error codes
        for IGMP/MLD error feedback.
</p>
<a name="application"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Feedback to the application layer</h3>

<p>[ TBC : working group guidance is sought on how to link these
      specifications with possibly needed evolution of the <a class='info' href='#posix'>POSIX<span> (</span><span class='info'>, &ldquo;ISO/IEC 9945 Information technology, Portable Operating           System Interface (POSIX), Part 1: Base Definitions,&rdquo; 2003.</span><span>)</span></a> [posix] network socket API ]
</p>
<p>This section describes how the information from Feedback messages is
      supplied to applications subscribed to multicast stream, and expecting
      the reception of multicast datagrams on a socket.
</p>
<p>A requirement is fully backward compatibility with applications not
      supporting these specifications : an application not supporting these
      specifications must not be affected by a Feedback message. For instance,
      a wrong solution would be to return an error on a read() or recv()
      call.
</p>
<p>A second requirement is to allow an application to keep receiving
      data on a socket, even if some error was reported through a Feedback
      message, for a group or channel joined on this socket. This is needed,
      for instance, in two cases : when a socket is used to join multiple
      distinct group or channels and only one of them is subject to an error ;
      when a socket is used to join only one multicast group, for which the
      Querier sends a Feedback message, but there are members for this group
      sending data on a directly connected link.
</p>
<p>A proposal is to rely on the use of the MSG_ERRQUEUE flag of the
      recvmsg()/recvfrom() POSIX calls. This call allows the socket user to
      retrieve the network errors queued for the socket. Further work is
      required to fully describe how information from the Feedback message
      would be mapped in the sock_extended_err structure.
</p>
<p>Another proposal would be to allow the setsockopt() and
      set(ipv4)sourcefilter() calls <a class='info' href='#RFC3678'>[RFC3678]<span> (</span><span class='info'>Thaler, D., Fenner, B., and B. Quinn, &ldquo;Socket Interface Extensions for Multicast Source Filters,&rdquo; January&nbsp;2004.</span><span>)</span></a> to return
      an error. That would require the local network stack to wait for some
      time after sending a Membership Report message, before being able to
      return from the setsockopt()/set(ipv4)sourcefilter() call, and would not
      easily allow to carry detailed information about the specific group or
      channel in error. Consequently, this approach doesn't seem a viable
      one.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Impact on IGMP/MLD proxies and equipments doing IGMP/MLD snooping</h3>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
IGMP/MLD Proxies</h3>

<p>To support this Feedback mechanism, an <a class='info' href='#RFC4605'>IGMP
        or MLD proxy<span> (</span><span class='info'>Fenner, B., He, H., Haberman, B., and H. Sandick, &ldquo;Internet Group Management Protocol (IGMP) / Multicast Listener Discovery (MLD)-Based Multicast Forwarding (&quot;IGMP/MLD Proxying&quot;),&rdquo; August&nbsp;2006.</span><span>)</span></a> [RFC4605] SHOULD send Feedback messages received on its Host
        side toward its Querier side(s) that have matching multicast
        memberships. The procedures for sending the Feedback messages are then
        the same as for a normal Querier, as specified in <a class='info' href='#procedures'>Section&nbsp;5<span> (</span><span class='info'>Procedures</span><span>)</span></a>: in particular the IGMP/MLD proxy MUST
        use its own address as the source address of the Feedback message.
</p>
<p>A new member of a multicast group already forwarded by the proxy on
        its Querier side, will have to wait for some time before having a
        chance to receive a Feedback message : timers will have to trigger
        before the Querier on the Host side of the proxy sends a Query,
        causing the proxy to send a Membership Report that may then cause the
        Querier on the Host side to send a Feedback message, and this Feedback
        message to be propagated to the new receiver.
</p>
<p>To quickly provide Feedback messages to receivers on its Querier
        side, the proxy MAY cache the Feedback messages that it receives on
        the Host side to later match them with Membership Report messages
        received on its Querier side, and send relevant Feedback messages in
        reaction to these. If doing Feedback message caching, the proxy MUST
        keep only one Feedback message per (S,G) entry or (*,G) entry. It MUST
        also remove a Feedback message from its cache, if a same Feedback
        message hasn't been sent in the last &lt;&gt; seconds by the Querier
        on its Host side.
</p>
<p>Last, an IGMP/MLD proxy MAY produce its own Feedback messages. In
        that case it MUST still respect procedures of <a class='info' href='#procedures'>Section&nbsp;5<span> (</span><span class='info'>Procedures</span><span>)</span></a>.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Equipments doing IGMP/MLD snooping</h3>

<p>IGMP/MLD snooping equipments are expected to transparently
        interoperate with the procedures described in this document, given
        that <a class='info' href='#RFC4541'>RFC 4541 section 2.2.1(3)<span> (</span><span class='info'>Christensen, M., Kimball, K., and F. Solensky, &ldquo;Considerations for Internet Group Management Protocol (IGMP) and Multicast Listener Discovery (MLD) Snooping Switches,&rdquo; May&nbsp;2006.</span><span>)</span></a> [RFC4541] states
        that "[a] switch that supports IGMP snooping must flood all
        unrecognized IGMP messages to all other ports".
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>Request to IANA for ICMP or IGMP code point allocation would
      expectedly be requested in the future for the messages defined in this
      document.
</p>
<p>[Note to RFC Editor: this section may be removed on publication as an
      RFC.]
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>Given that the specifications in this document do not change nor the
      state machine of the IGMP/MDLD Querier and Host stack, nor the datagrams
      that will be received by an application, they are not expected to
      introduce security issues not already existing with IGMP/MLD or the
      protocol used to carry the Feedback message.
</p>
<p>A possible issue would be to have wrong Feedback sent toward
      multicast applications. Such an issue could arise if spoofed Feedback
      messages are sent and interpreted by multicast receiver hosts. This
      issue is mitigated by the fact that IGMP/MLD Hosts MUST check that the
      TTL of the Feedback messages is 1, and MAY also check the source IP of
      the Feedback message against a list of known Queriers.
</p>
<p>Another possible issue is denial of service of the Querier function,
      that would be due to having the IGMP/MLD Querier be overloaded by
      Feedback messages to send. This is mitigated by allowing the Querier to
      rate-limit the flow of Feedback messages. On a LAN, such a rate-limiting
      would possibly result in some receivers not receiving the feedback
      message that they would have, which is a form of denial of service, but
      only on the Feedback function by itself, with no impact on the rest of
      the multicast group membership control protocol infrastructure. This
      later type of denial of service might be mitigated by doing
      rate-limiting based on the source address of the receivers (the source
      address of the Membership Report triggering the Feedback message); but
      such mechanism may themselves be subject to weaknesses due to Membership
      Report spoofing.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Acknowledgements</h3>

<p>Acknowledgments go to DSLForum contributors who provided an initial
      proposal, to IETF participants that participated in the discussion on
      the magma WG list, from which guidance and inspiration was largely
      taken. Thank you to Bill Fenner for providing detailed information on
      issues related to ICMP errors in reaction to multicast datagrams.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3376">[RFC3376]</a></td>
<td class="author-text">Cain, B., Deering, S., Kouvelas, I., Fenner, B., and A. Thyagarajan, &ldquo;<a href="http://tools.ietf.org/html/rfc3376">Internet Group Management Protocol, Version 3</a>,&rdquo; RFC&nbsp;3376, October&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3376.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3678">[RFC3678]</a></td>
<td class="author-text">Thaler, D., Fenner, B., and B. Quinn, &ldquo;<a href="http://tools.ietf.org/html/rfc3678">Socket Interface Extensions for Multicast Source Filters</a>,&rdquo; RFC&nbsp;3678, January&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3678.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3810">[RFC3810]</a></td>
<td class="author-text">Vida, R. and L. Costa, &ldquo;<a href="http://tools.ietf.org/html/rfc3810">Multicast Listener Discovery Version 2 (MLDv2) for IPv6</a>,&rdquo; RFC&nbsp;3810, June&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3810.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4541">[RFC4541]</a></td>
<td class="author-text">Christensen, M., Kimball, K., and F. Solensky, &ldquo;<a href="http://tools.ietf.org/html/rfc4541">Considerations for Internet Group Management Protocol (IGMP) and Multicast Listener Discovery (MLD) Snooping Switches</a>,&rdquo; RFC&nbsp;4541, May&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4541.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4605">[RFC4605]</a></td>
<td class="author-text">Fenner, B., He, H., Haberman, B., and H. Sandick, &ldquo;<a href="http://tools.ietf.org/html/rfc4605">Internet Group Management Protocol (IGMP) / Multicast Listener Discovery (MLD)-Based Multicast Forwarding ("IGMP/MLD Proxying")</a>,&rdquo; RFC&nbsp;4605, August&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4605.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mboned-maccnt-req">[I-D.ietf-mboned-maccnt-req]</a></td>
<td class="author-text">He, H., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mboned-maccnt-req-05.txt">Requirements for Multicast AAA coordinated between Content Provider(s) and  Network Service Provider(s)</a>,&rdquo; draft-ietf-mboned-maccnt-req-05 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mboned-maccnt-req-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1122">[RFC1122]</a></td>
<td class="author-text"><a href="mailto:Braden@ISI.EDU">Braden, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1122">Requirements for Internet Hosts - Communication Layers</a>,&rdquo; STD&nbsp;3, RFC&nbsp;1122, October&nbsp;1989 (<a href="ftp://ftp.isi.edu/in-notes/rfc1122.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1812">[RFC1812]</a></td>
<td class="author-text"><a href="mailto:fred@cisco.com">Baker, F.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1812">Requirements for IP Version 4 Routers</a>,&rdquo; RFC&nbsp;1812, June&nbsp;1995 (<a href="ftp://ftp.isi.edu/in-notes/rfc1812.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="fenner-icmp-mcast">[fenner-icmp-mcast]</a></td>
<td class="author-text">&ldquo;<a href="http://www.icir.org/fenner/mcast/icmp.html">ICMP errors in response to multicast</a>,&rdquo; March&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="magma-archive">[magma-archive]</a></td>
<td class="author-text">&ldquo;<a href="http://www1.ietf.org/mail-archive/web/magma/current/msg00815.html">IETF Magma WG mailing-list archives</a>,&rdquo; December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="posix">[posix]</a></td>
<td class="author-text">&ldquo;ISO/IEC 9945 Information technology, Portable Operating
          System Interface (POSIX), Part 1: Base Definitions,&rdquo; 2003.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Thomas Morin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France Telecom - Orange Labs</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">2, avenue Pierre Marzin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Lannion  22307</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:thomas.morin@orange-ftgroup.com">thomas.morin@orange-ftgroup.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2007).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
