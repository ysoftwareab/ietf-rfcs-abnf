
Internet Engineering Task Force           Mukul Goyal, Padmini Misra
INTERNET-DRAFT                            Raj Jain
draft-goyal-dpstdy-diffserv-00.txt        The Ohio State University
                                                          March, 1999
                                             Expires: September, 1999

       Effect of Number of Drop Precedences in Assured Forwarding


Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet- Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
        http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
         http://www.ietf.org/shadow.html.

NOTE

   This document is not to be taken as a finished product.  Some of the
   sections are rough and are included in order to obtain comments from
   the community that will benefit future iterations of this document.
   This is simply a step in the ongoing conversation about this
   document.  Finally, all the authors of this draft do not necessarily
   agree with and/or advocate all the mechanisms outlined in this
   document.



Abstract

   This informational draft presents a simulation study of the effect of
   having different number of drop precedences in an Assured Forwarding
   [juha1] traffic class. The simulations involve both TCP and UDP
   traffic. The results show that discrimination between UDP and TCP



Goyal, Misra & Jain          Drop Precedence Study              [Page 1]

draft-goyal-dpstdy-diffserv-00.txt- 2 -                      March, 1998


   flows can be achieved with just 2 drop precedences.

1. Introduction

   The Assured Forwarding PHB [juha1] specifies 4 traffic classes with 3
   drop precedence each to provide differentiated services to the
   customers. One of the reasons given for having 3 drop precedences is
   that in case of mixed traffic (both congestion-sensitive and
   congestion-insensitive) in the same traffic class, 3 drop precedences
   can be used to effectively control congestion-insensitive sources
   (e.g. UDP sources) from getting more than their fair share of network
   resources. In this study, we simulate a mixed traffic scenario with
   0, 2, and 3 drop precedences.




2. Simulation Configuration and Parameters:

   In our simulations, we used the network configuration shown in Figure
   1. It consists of 50 sources, labeled Src_1 through Src_50, arranged
   in 5 groups of 10 sources each.  Of these, Src_10, Src_20, Src_30,
   Src_40 and Src_50 are UDP sources and the rest are TCP
   sources. All TCP sources implement slow start and the Reno version of
   fast retransmit and recovery algorithm.

   There are 5 access routers labeled as AR_1 through AR_5. These
   represent ingress to a DS domain for 5 customers belonging to same AF
   traffic class. These routers implement a drop precedence marker. This
   marker can be either Three Color Marker (TCM) as specified in [juha2]
   or a Rate Based Marker (RBM).

   In TCM, there are two token buckets with different bucket sizes
   called committed burst size (CBS) and excess burst size (EBS). The
   tokens are generated for the two buckets at a combined rate. This
   rate is called committed information rate (CIR). The tokens are added
   to the second bucket when the first bucket is full.

   The RBM is similar to TCM except that separate token generation rates
   (TGR0 and TGR1) are specified for the two buckets. Moreover, in RBM,
   token generation in two buckets is independent of each other.  To get
   similar behavior with either TCM or RBM, we set CIR of TCM to be sum
   of token genration rates of two buckets in RBM (CIR = TGR0 + TGR1).
   Also, the same bucket sizes are set for both TCM and RBM.

   In all our simulations, the color markers work in the 'color aware'
   mode [juha2], meaning that packets pre-marked with a drop precedence
   can not use tokens of higher precedence buckets and that they cannot



Goyal, Misra & Jain          Drop Precedence Study              [Page 2]

draft-goyal-dpstdy-diffserv-00.txt- 3 -                      March, 1998


   be upgraded to a higher precedence. However, a marker can degrade the
   drop precedence of a packet.

           Src_1
           .   \
           .    ----AR_1------------
           .   /                    |
           Src_10                   |
                                    |
           Src_11                   |
           .   \                    |                         Snk_1
           .    ----AR_2 --------   |                         /   .
           .   /                 |  |                        /    .
           Src_20                |  |                       /     .
                                 |  |                      /      .
           Src_21                |  |                     /       .
           .   \                                         /        .
           .    ----AR_3--------  R_1 -----------------R_2        . 
           .   /                                         \        .
           Src_30                |  |                     \       .
                                 |  |                      \      .
           Src_31                |  |                       \     .
           .   \                 |  |                        \    .
           .    ----AR_4 --------   |                         \   .
           .   /                    |                         Snk_50
           Src_40                   |
                                    |
           Src_41                   |
           .   \                    |
           .    ----AR_5 -----------
           .   /
           Src_50

                DATA ---->                                    <----Ack

           Src_i's are Senders
           Snk_i's are Receivers
           AR_i's and R_i's are Routers


           Figure 1: Simulation Configuration




Goyal, Misra & Jain          Drop Precedence Study              [Page 3]

draft-goyal-dpstdy-diffserv-00.txt- 4 -                      March, 1998


   The traffic arriving at each of color markers consists of both UDP
   and TCP packets. If the number of drop precedences is 3, TCP packets
   are marked with dp0 by their sources whereas UDP packets are marked
   with dp2. If the number of drop precedences is 2, TCP packets are
   marked with dp0 and UDP packets are marked with dp1.

   In the configuration with n drop precedences, router R_1 implements
   RED drop policy [floy1] with n different drop probabilities.  Here
   onwards, we call such a drop policy RED_n. To implement RED_n, we
   extended the RIO algorithm used in [ibanez] to have different
   thresholds and maximum drop probability for packets of precedence 0,
   1, 2, and so on. As in [ibanez], to calculate RED average queue
   length for packets with precedence 'i', current queue occupancy of
   all packets of precedence 0 to 'i' is used.

   We have used NS simulator version 2.1b4a [NS] for these simulations.
   New code has been added to the simulator to implement TCM, RBM and
   RED_n. Values of various simulation parameters are shown in Table 1.

                     Table 1: Simulation Parameters
   --------------------------------------------------------------------------

    Simulation Time                100 seconds
    TCP Window                     64 packets
    IP Packet Size                 576
    UDP Rate                       128Kb, 1.28Mb
    Maximum queue size             60 packets
      (for all queues)

    RED_n parameters:

      Queue Weight                 0.002
       (for all queues)

                           No D.P.         2 D.P.          3 D.P.
      Min Thresh(dp0)      20              20              20
      Max Thresh(dp0)      40              40              40
      Min Thresh(dp1)      N/A             20              20
      Max Thresh(dp1)      N/A             40              40
      Min Thresh(dp2)      N/A             N/A             20
      Max Thresh(dp2)      N/A             N/A             40

      Drop prob(dp0)       1/30            1/30            1/30
      Drop prob(dp1)       N/A             1/20            1/20
      Drop prob(dp2)       N/A             N/A             1/10






Goyal, Misra & Jain          Drop Precedence Study              [Page 4]

draft-goyal-dpstdy-diffserv-00.txt- 5 -                      March, 1998


                     (Table 1: Simulation Parameters: Continued)
    RBM Parameters :
                           No D.P.         2 D.P.          3 D.P.
      TGR0                 N/A             192000, 256000  64000, 128000
      TGR1                 N/A             N/A             128000,128000
      BucketSize dp0       N/A             64000           32000
      BucketSize dp1       N/A             N/A             32000

    TCM Parameters :
                           No D.P.         2 D.P.          3 D.P.
      CIR                  N/A             192000, 256000  192000, 256000
      BucketSize dp0       N/A             64000           32000
      BucketSize dp1       N/A             N/A             32000

   Link between Src_i's & AR_i's :

      Link Bandwidth :     10 Mbps
      Link Delay     :     1 microsecond
      Drop Policy    :     DropTail

   Link between AR_i's & R_1 :
                           From AR_i               To AR_i
      Link Bandwidth :     1.5 Mbps                1.5 Mbps
      Link Delay     :     5 microseconds          5 microseconds
      Drop Policy    :     DropTail(with marker)   DropTail

   Link between R_1 & R_2 :
                           From R_1                To R_2
      Link Bandwidth :     1.5 Mbps                1.5 Mbps
      Link Delay     :     30 miliseconds          30 miliseconds
      Drop Policy    :     RED_n                   DropTail

   Link between R_2 & Snk_i's :

      Link Bandwidth :     1.5 Mbps
      Link Delay     :     5 microseconds
      Drop Policy    :     Droptail
   --------------------------------------------------------------------------



4. Simulation Results

   Tables 2 and 3 summarize the simulation results for both TCM and RBM.
   In each case, we compare the TCP and UDP throughputs and fairness for
   different number of drop precedences. Fairness is computed using the
   following formula [jain]:




Goyal, Misra & Jain          Drop Precedence Study              [Page 5]

draft-goyal-dpstdy-diffserv-00.txt- 6 -                      March, 1998


   Fairness = [{sum(xi)}**2]/[n*sum(xi**2)]

   Where xi is the throughput of the ith flow and n is the number of
   flows.

   Notice that, in case of no drop precedence, average TCP throughput
   and fairness values are very low. However, with 2 drop precedences,
   TCP throughputs and fairness values improve radically. Having 3
   drop precedence does not help to improve TCP throughputs or
   fairness.  However, as the token generation rate is increased (CIR
   for TCM: from 192 to 256kbps, TGR0 for RBM:from 64 to 128kbps),
   both TCP throughputs and fairness improves and UDP throughputs
   decrease. This happens irrespective of whether there are 2 drop
   precedences or 3. In all cases, results achieved with 2 drop
   precedences are almost same as with 3 drop precedences.

          Table 2 ( For TCM [juha2] as Color Marker)
   ------------------------------------------------------------------------
   UDP    # of  CIR    Max TCP  Min TCP Avg TCP  Max UDP  Min UDP  Fairness
   Rate   DP's  (kbps) Thruput  Thruput Thruput  Thruput  Thruput
                       (kbps)    (kbps)  (kbps)   (kbps)  (kbps)
   -----------------------------------------------------------------------
   1.28M No DP  N/A    0.64     0.05    0.21     299.40   296.92    .101
   1.28M   2    192   26.06    14.27   19.90     123.74   118.81    .494
   1.28M   3    192   24.67    12.11   20.15     122.54   115.91    .507
   1.28M   2    256   26.52    15.97   22.81      98.14    91.61    .658
   1.28M   3    256   25.83    20.39   22.84      98.79    89.44    .661

   128k  No DP  N/A   28.36    10.17   21.36     108.69   106.06    .570
   128k    2    192   31.76     7.46   25.04      74.62    73.42    .796
   128k    3    192   30.84    13.81   24.87      76.23    74.07    .788
   128k    2    256   32.27    16.76   27.91      49.03    46.95    .951
   128k    3    256   33.28    21.64   27.96      48.70    46.95    .957
   -----------------------------------------------------------------------

















Goyal, Misra & Jain          Drop Precedence Study              [Page 6]

draft-goyal-dpstdy-diffserv-00.txt- 7 -                      March, 1998


            Table 3 (For RBM as Color Marker)
   (For 2 DP: TGR = TGR0; For 3 DP: TGR = TGR0{64,128kbps} + TGR1{128kbps})
   ------------------------------------------------------------------------
   UDP    # of  TGR    Max TCP  Min TCP Avg TCP  Max UDP  Min UDP  Fairness
   Rate   DP's  (kbps) Thruput  Thruput Thruput  Thruput  Thruput
                       (kbps)   (kbps)  (kbps)   (kbps)   (kbps)
   -----------------------------------------------------------------------
   1.28M No DP  N/A     0.64     0.05    0.21    299.40   296.92  .101
   1.28M   2    192    24.81    11.00   19.89    126.82   117.57  .493
   1.28M   3    192    23.94    10.96   18.54    135.43   130.14  .431 
   1.28M   2    256    26.38    19.29   22.76     97.82    93.13  .656
   1.28M   3    256    25.83    13.35   23.08     95.01    89.44  .675

   128k  No DP  N/A    28.36    10.17   21.36    108.69   106.06  .570
   128k    2    192    34.66    19.33   25.04     74.71    73.56  .799
   128k    3    192    29.51    20.07   24.92     76.88    74.11  .794
   128k    2    256    33.79    19.84   28.07     48.38    46.26  .960
   128k    3    256    34.57    22.42   28.18     46.40    45.48  .964
   -----------------------------------------------------------------------

6. Summary

   Simulations presented here show that having 3 drop precedences in
   each AF traffic class does not give any better results than 2 drop
   precedences.



7. References

   [juha1] J. Heinanen, et al., Assured Forwarding PHB Group.  Internet
   draft draft-ietf-diffserv-af-05.txt, February 1999.


   [juha2] J. Heinanen, et al., A Three Color Marker.  Internet draft
   draft-heinanen-diffserv-tcm-00.txt, February 1999.


   [floy1] S. Floyd, V. Jacobson, "Random Early Detection Gateways for
   Congestion Avoidance," IEEE/ACM Transactions on Networking, August
   1993.


   [ibanez] J. Ibanez, K. Nichols, "Preliminary Simulation Evaluation of
   an Assured Service" <draft-ibanez-diffserv-assured-eval-00.txt>,
   August, 1998.





Goyal, Misra & Jain          Drop Precedence Study              [Page 7]

draft-goyal-dpstdy-diffserv-00.txt- 8 -                      March, 1998


   [jain] Raj Jain, "The Art of Computer Systems Performance Analysis,"
   John Wiley and Sons Inc., 1991.


   [RFC2475] S. Blake, et al., An Architecture for Differentiated
   Services. RFC 2475, December 1998.

   [NS] NS simulator, Version 2.1 Available from http://www-
   mash.cs.berkeley.edu/ns

Authors's address

   Mukul Goyal, Padmini Misra, Raj Jain
   Computer and Information Science Dept,
   The Ohio State University,
   2015, Neil Avenue,Room 395,
   Columbus, OH 43201
   Phone: +1 (614) 292-3989
   Fax: +1 (614) 292 2911
   Email: {mukul,misra,jain}@cis.ohio-state.edu

      This internet draft expires on September 1999





























Goyal, Misra & Jain          Drop Precedence Study              [Page 8]

