<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>File Transfer Protocol RANG Command for Byte Ranges</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Document Conventions">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Basic Tokens">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Server Replies">
<link href="#rfc.section.3" rel="Chapter" title="3 Byte Ranges in STREAM Mode">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Error Recovery and Range Requests">
<link href="#rfc.section.4" rel="Chapter" title="4 The RANGe Command (RANG)">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 FEAT Command Response for RANG Command">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 User-PI usage of RANG">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 RANG Command Errors">
<link href="#rfc.section.5" rel="Chapter" title="5 RANG Command Use with Other Commands">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Acknowledgements and Contributors">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Document History">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The File Transfer Protocol offers the REST command to designate a starting point for a transfer, but does not currently offer any method to specify an end point.  This document specifies a new FTP RANG command to be used by clients to designate a start and end point to permit restarts and repairs of interrupted data transfers in STREAM mode.  " />
  <meta name="description" content="The File Transfer Protocol offers the REST command to designate a starting point for a transfer, but does not currently offer any method to specify an end point.  This document specifies a new FTP RANG command to be used by clients to designate a start and end point to permit restarts and repairs of interrupted data transfers in STREAM mode.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">A. Bryan</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">T. Tsujikawa</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">D. Stenberg</td>
</tr>
<tr>
<td class="left">Expires: September 15, 2011</td>
<td class="right">March 14, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">File Transfer Protocol RANG Command for Byte Ranges<br />
  <span class="filename">draft-bryan-ftp-range-03</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The File Transfer Protocol offers the REST command to designate a starting point for a transfer, but does not currently offer any method to specify an end point.  This document specifies a new FTP RANG command to be used by clients to designate a start and end point to permit restarts and repairs of interrupted data transfers in STREAM mode.  </p>
<h1><a>Editorial Note (To be removed by RFC Editor)</a></h1>
<p>Discussion of this draft should take place on the FTPEXT2 working group mailing list (ftpext@ietf.org), although this draft is not a WG item.  Related documents (including fancy diffs) can be found at <a href="http://tools.ietf.org/wg/ftpext2/">http://tools.ietf.org/wg/ftpext2/</a>.  </p>
<p>The changes in this draft are summarized in <a href="#dochistory">Appendix Appendix B</a>.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 15, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Document Conventions</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Basic Tokens</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Server Replies</a>
</li>
<li>3.   <a href="#rfc.section.3">Byte Ranges in STREAM Mode</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Error Recovery and Range Requests</a>
</li>
<li>4.   <a href="#rfc.section.4">The RANGe Command (RANG)</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">FEAT Command Response for RANG Command</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">User-PI usage of RANG</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">RANG Command Errors</a>
</li>
<li>5.   <a href="#rfc.section.5">RANG Command Use with Other Commands</a>
</li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Acknowledgements and Contributors</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Document History</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The File Transfer Protocol offers the REST command <a href="#RFC3659">[RFC3659]</a> to designate a starting point for a transfer, but does not currently offer any method to specify an end point.  This document specifies a new FTP RANG command to be used by clients to designate a start and end point to permit restarts and repairs of interrupted data transfers in STREAM mode. </p>
<p id="rfc.section.1.p.2">The current alternatives, without being able to specify an end point, are to issue an ABOR command or close the data connection.</p>
<p id="rfc.section.1.p.3">HTTP offers similar functionality with the Range: header field in Section 14.35 of <a href="#RFC2616">[RFC2616]</a>, where a specific byte range can optionally be requested.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Document Conventions</h1>
<p id="rfc.section.2.p.1">This specification describes conformance of File Transfer Protocol Extension for RANG, a start and end point in a byte range.</p>
<p id="rfc.section.2.p.2">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14, <a href="#RFC2119">[RFC2119]</a>, as scoped to those conformance targets.</p>
<p id="rfc.section.2.p.3">This document also uses notation defined in STD 9, <a href="#RFC0959">[RFC0959]</a>.  In particular, the terms or commands "reply", "user", "file", "FTP commands", "user-PI" (user protocol interpreter), "server-FTP process", "server-PI", "mode", "Image type", "Stream transfer mode", "type", "STOR", "RETR", and "ASCII", are all used here as defined there. The command "REST" is used as defined in Section 5 of <a href="#RFC3659">[RFC3659]</a>.</p>
<p id="rfc.section.2.p.4">In the examples of FTP dialogs presented in this document, lines that begin "C&gt; " were sent over the control connection from the user-PI to the server-PI, and lines that begin "S&gt; " were sent over the control connection from the server-PI to the user-PI. In all cases, the prefixes shown above, including the one space, have been added for the purposes of this document, and are not a part of the data exchanged between client and server.</p>
<p id="rfc.section.2.p.5">Syntax required is defined using the Augmented BNF defined in <a href="#RFC5234">[RFC5234]</a>.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Basic Tokens</h1>
<p id="rfc.section.2.1.p.1">This document imports the core definitions given in Appendix B of <a href="#RFC5234">[RFC5234]</a>.  There definitions will be found for basic ABNF elements like ALPHA, DIGIT, SP, etc.  To that, the following term is added for use in this document.</p>
<div id="#rfc.figure.1"></div>
<p></p>

<p></p>
<pre>
   TCHAR = VCHAR / SP / HTAB    ; visible plus white space
</pre>
<p id="rfc.section.2.1.p.3">The VCHAR (from <a href="#RFC5234">[RFC5234]</a>) and TCHAR rules give basic character types from varying sub-sets of the ASCII character set for use in various commands and responses.</p>
<p id="rfc.section.2.1.p.4">Note that in ABNF, string literals are case insensitive.  That convention is preserved in this document, and implies that FTP commands and parameters that are added by this specification have values that can be represented in any case.  That is, "RANG" is the same as "rang", "Rang", "RaNg", etc., and "ftp.example.com" is the same as "Ftp.Example.Com", "fTp.eXample.cOm", etc.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Server Replies</h1>
<p id="rfc.section.2.2.p.1">Section 4.2 of <a href="#RFC0959">[RFC0959]</a> defines the format and meaning of replies by the server-PI to FTP commands from the user-PI.  Those reply conventions are used here without change.</p>
<div id="#rfc.figure.2"></div>
<p></p>

<p></p>
<pre>
   error-response = error-code SP *TCHAR CRLF
   error-code     = ("4" / "5") 2DIGIT
</pre>
<p id="rfc.section.2.2.p.3">Implementers should note that the ABNF syntax (which was not used in <a href="#RFC0959">[RFC0959]</a>) used in this document, and other FTP related documents, sometimes shows replies using the one line format.  Unless otherwise explicitly stated, that is not intended to imply that multi-line responses are not permitted.  Implementers should assume that, unless stated to the contrary, any reply to any FTP command (including QUIT) can be of the multi-line format described in <a href="#RFC0959">[RFC0959]</a>.</p>
<p id="rfc.section.2.2.p.4">Throughout this document, replies will be identified by the three digit code that is their first element.  Thus the term "500 reply" means a reply from the server-PI using the three digit code "500".</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Byte Ranges in STREAM Mode</h1>
<p id="rfc.section.3.p.1">To get a specific part of a file without sending entire file, both sides need some way to agree on where in the data stream to start and end the data transfer.  </p>
<p id="rfc.section.3.p.2">In STREAM mode, the data connection contains just a stream of unformatted octets of data.  Explicit restart markers thus cannot be inserted into the data stream, they would be indistinguishable from data.  For this reason, the FTP specification <a href="#RFC0959">[RFC0959]</a> did not provide the ability to do restarts in stream mode.  However, there is not really a need to have explicit restart markers in this case, as restart markers can be implied by the octet offset into the data stream.  </p>
<p id="rfc.section.3.p.3">Because the data stream defines the file in STREAM mode, a different data stream would represent a different file.  Thus, an offset will always represent the same position within a file.  On the other hand, in other modes than STREAM, the same file can be transferred using quite different octet sequences and yet be reconstructed into the one identical file.  Thus an offset into the data stream in transfer modes other than STREAM would not give an unambiguous restart or end point.  </p>
<p id="rfc.section.3.p.4">If the data representation TYPE is IMAGE and the STRUcture is File, for many systems the file will be stored exactly in the same format as it is sent across the data connection.  It is then usually very easy for the receiver to determine how much data was previously received, and notify the sender of the offset where the transfer should be restarted.  In other representation types and structures more effort will be required, but it remains always possible to determine the offset with finite, but perhaps non-negligible, effort.  In the worst case, an FTP process may need to open a data connection to itself, set the appropriate transfer type and structure, and actually transmit the file, counting the transmitted octets.  </p>
<p id="rfc.section.3.p.5">If the user-FTP process is intending to restart a retrieve, it will directly calculate the restart marker and send that information in the RESTart command.  However, if the user-FTP process is intending to restart sending the file, it needs to be able to determine how much data was previously sent, and correctly received and saved.  The purpose of the SIZE command, as documented in Section 4 of <a href="#RFC3659">[RFC3659]</a>, is to get this information.  </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Error Recovery and Range Requests</h1>
<p id="rfc.section.3.1.p.1">STREAM mode transfers with FILE STRUcture may be range requested even though no restart marker has been transferred in addition to the data itself.  This is done by using the SIZE command, if needed, in combination with the RANG command, and one of the standard file transfer commands.  </p>
<p id="rfc.section.3.1.p.2">When using TYPE ASCII or IMAGE, the SIZE command will return the number of octets that would actually be transferred if the file were to be sent between the two systems, i.e., with type IMAGE, the SIZE normally would be the number of octets in the file.  With type ASCII, the SIZE would be the number of octets in the file including any modifications required to satisfy the TYPE ASCII CR-LF end-of-line convention.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#RANG" id="RANG">The RANGe Command (RANG)</a>
</h1>
<p id="rfc.section.4.p.1">A new command "RANG" is added to the FTP command set to allow the client to specify both a start point byte range and an end point byte range of a file from a server-FTP process.</p>
<div id="#rfc.figure.3"></div>
<p id="rfc.section.4.p.2">The syntax for the RANG command when the current transfer mode is STREAM is: </p>

<p></p>
<pre>
   range-command = "RANG" SP start-point SP end-point CRLF
   start-point = 1*DIGIT
   end-point = 1*DIGIT	  
</pre>
<p id="rfc.section.4.p.3">[NOTE: end-point is inclusive.]</p>
<p id="rfc.section.4.p.4">'start-point' gives the number of octets of the immediately-following transfer to not actually send, effectively causing the transmission to be started at a later point. A value of zero effectively causes the transmission to be started at first byte.</p>
<p id="rfc.section.4.p.5">'end-point' gives the number of octets, counted from the beginning of the file, of the immediately-following transfer to stop sending at, effectively causing the transmission to be ended.  (That is, the end point is relative to the start of the file and not relative to the start point). The server-PI will respond to the RANG command with a 350 reply, indicating that RANG parameters have been saved, and that another command, which can be one of the standard file transfer commands, should then follow to complete the ranged request.</p>
<p id="rfc.section.4.p.6">To reset the range command, "RANG 1 0" should be issued.  Invalid RANG requests where 'start-point' is larger than 'end-point' automatically reset the byte selection to the default, which is the whole file.  The server-PI MUST reply with a 350 reply if "RANG 1 0" is issued by client-PI because it is a valid way of resetting the range. (The range would also be reset if the session is reinitialized with REIN but this terminates the user and resets all parameters).</p>
<div id="#rfc.figure.4"></div>
<p></p>

<p></p>
<pre>
   range-response = range-ok / error-response
   range-ok       = "350" SP *TCHAR CRLF	  
</pre>
<p id="rfc.section.4.p.8">Server-FTP processes may permit transfer commands other than RETR and STOR, such as APPE and STOU, to complete a restart or repair; however, this is not recommended.  STOU (store unique) is undefined in this usage, as storing the remainder of a file into a unique file name is rarely going to be useful.  If APPE (append) is permitted, it MUST act identically to STOR when a restart marker has been set.  That is, in both cases, octets from the data connection are placed into the file at the location indicated by the restart marker value.</p>
<p id="rfc.section.4.p.9">The RANG command is intended to complete or repair a failed transfer.  Use with RETR is comparatively well defined in all cases, as the client bears the responsibility of merging the retrieved data with the partially retrieved file.  It may choose to use the data obtained other than to complete an earlier transfer, or to re-retrieve data that had been retrieved before.  With STOR, however, the server must insert the data into the file named.  The results are undefined if a client uses RANG to do other than restart to complete a transfer of a file that had previously failed to completely transfer.  In particular, if the restart marker set with a RANG command is not at the end of the data currently stored at the server, as reported by the server, or if insufficient data are provided in a STOR that follows a RANG to extend the destination file to at least its previous size, then the effects are undefined.</p>
<p id="rfc.section.4.p.10">The RANG command MUST be the last command issued before the data transfer command that is to cause a partial data transfer.  The effect of issuing a RANG command at any other time is undefined.  The server-PI may react to a badly positioned RANG command by issuing an error response to the following command, not being a restartable data transfer command, or it may save the start-point and/or end-point byte range value and apply it to the next data transfer command, or it may silently ignore the inappropriate restart attempt.  Because of this, a user-PI that has issued a RANG command, but that has not successfully transmitted the following data transfer command for any reason, should send another RANG command before the next data transfer command.  If that transfer is not to be restarted, then "RANG 1 0" should be issued.</p>
<p id="rfc.section.4.p.11">An error response will follow a RANG command only when the server does not implement the command, or when command syntax is invalid.  Any other errors, including such problems as start-point and/or end-point byte range out of range, should be reported when the following transfer command is issued.  Such errors will cause that transfer request to be rejected with an error indicating the invalid restart attempt.</p>
<p id="rfc.section.4.p.12">The server-PI SHOULD transfer 0 bytes with RETR if the specified start point is larger than the actual file size.</p>
<p id="rfc.section.4.p.13">The server-PI SHOULD transfer the whole range from the start point to the end point with RETR if the end point is larger than the actual file.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> FEAT Command Response for RANG Command</h1>
<p id="rfc.section.4.1.p.1">When replying to the FEAT command <a href="#RFC2389">[RFC2389]</a>, a server-FTP process that supports the RANG command, as specified here, MUST include, a line containing exactly the string "RANG STREAM".  This string is case insensitive, and MAY be sent in any mixture of upper or lower case, however it SHOULD be sent in upper case. That is, the response SHOULD be:</p>
<div id="#rfc.figure.5"></div>
<p></p>

<p></p>
<pre>
   C&gt; FEAT
   S&gt; 211-Extensions supported:
   S&gt;  ...
   S&gt;  RANG STREAM
   S&gt;  ...
   S&gt; 211 END
</pre>
<p id="rfc.section.4.1.p.3">The ellipses indicate place holders where other features may be included, and are not required. The one-space indentation of the feature lines is mandatory <a href="#RFC2389">[RFC2389]</a>.</p>
<div id="#rfc.figure.6"></div>
<p></p>

<p></p>
<pre>	
   range-feat = SP "RANG" SP "STREAM"
</pre>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> User-PI usage of RANG</h1>
<p id="rfc.section.4.2.p.1">The user-PI issues the FEAT command to query the server-PI if it supports the RANG command. In this example, the server-PI also supports REST.</p>
<div id="#rfc.figure.7"></div>
<p></p>

<p></p>
<pre>
   C&gt; FEAT
   S&gt; 211-Extensions supported:
   S&gt;  ...
   S&gt;  REST STREAM
   S&gt;  RANG STREAM   
   S&gt;  ...
   S&gt; 211 END
</pre>
<div id="#rfc.figure.8"></div>
<p id="rfc.section.4.2.p.3">Assume that the transfer of a largish file has previously been interrupted after 802816 octets had been received, that the transfer should stop at octet 1000000 of the file, that the previous transfer was with TYPE=I, and that it has been verified that the file on the server has not since changed.  </p>

<p></p>
<pre>
   C&gt; TYPE I
   S&gt; 200 Type set to I.
   C&gt; PORT 127,0,0,1,15,107
   S&gt; 200 PORT command successful.
   C&gt; RANG 802816 1000000
   S&gt; 350 Restarting at 802816. End Byte range at 1000000.
   C&gt; RETR cap60.pl198.tar
   S&gt; 150 Opening BINARY mode data connection
   [...]
   S&gt; 226 Transfer complete.
</pre>
<p id="rfc.section.4.2.p.4">In the above example, data is sent from offset 802816 to, and including, offset 1000000.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> RANG Command Errors</h1>
<p id="rfc.section.4.3.p.1">The server-PI SHOULD reply with a 500 reply if the RANG command is unrecognized or unimplemented.</p>
<p id="rfc.section.4.3.p.2">The server-PI SHOULD reply with a 551 reply if the server-PI is not configured to use TYPE I and MODE S.</p>
<p id="rfc.section.4.3.p.3">The server-PI SHOULD reply with a 552 reply if the user is not allowed to use the RANG command.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> RANG Command Use with Other Commands</h1>
<p id="rfc.section.5.p.1">This specification defines the use of RANG in a certain way. Other commands could decide to use RANG in a similar way, to select a byte range, and their specification would define how they operate with RANG. The HASH command <a href="#draft-ietf-ftpext2-hash">[draft-ietf-ftpext2-hash]</a> uses RANG to select a byte range for partial file hashing.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.6.p.1">This new command is added to the "FTP Commands and Extensions" registry created by <a href="#RFC5797">[RFC5797]</a>.</p>
<p id="rfc.section.6.p.2">Command Name: RANG</p>
<p id="rfc.section.6.p.3">Description: End point byte range (for STREAM mode).</p>
<p id="rfc.section.6.p.4">FEAT String: RANG STREAM</p>
<p id="rfc.section.6.p.5">Command Type: Service execution/parameter setting</p>
<p id="rfc.section.6.p.6">Conformance Requirements: Optional</p>
<p id="rfc.section.6.p.7">Reference: This specification</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Security Considerations</h1>
<p id="rfc.section.7.p.1">This memo does not directly concern security.  It is not believed that any of the mechanisms documented here impact in any particular way upon the security of FTP.</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC0959">[RFC0959]</b></td>
<td class="top">
<a>Postel, J.</a> and <a>J. Reynolds</a>, "<a href="http://tools.ietf.org/html/rfc0959">File Transfer Protocol</a>", STD 9, RFC 0959, October 1985.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2389">[RFC2389]</b></td>
<td class="top">
<a>Hethmon, P.</a> and <a>R. Elz</a>, "<a href="http://tools.ietf.org/html/rfc2389">Feature negotiation mechanism for the File Transfer Protocol</a>", RFC 2389, August 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3659">[RFC3659]</b></td>
<td class="top">
<a>Hethmon, P.</a>, "<a href="http://tools.ietf.org/html/rfc3659">Extensions to FTP</a>", RFC 3659, March 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5234">[RFC5234]</b></td>
<td class="top">
<a>Crocker, D.</a> and <a>P. Overell</a>, "<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>", STD 68, RFC 5234, January 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5797">[RFC5797]</b></td>
<td class="top">
<a>Klensin, J.</a> and <a>A. Hoenes</a>, "<a href="http://tools.ietf.org/html/rfc5797">FTP Command and Extension Registry</a>", RFC 5797, March 2010.</td>
</tr>
<tr>
<td class="reference"><b id="draft-ietf-ftpext2-hash">[draft-ietf-ftpext2-hash]</b></td>
<td class="top">
<a href="mailto:anthonybryan@gmail.com">Bryan, A.</a>, <a href="mailto:tim.kosse@filezilla-project.org">Kosse, T.</a> and <a href="mailto:daniel@haxx.se">D. Stenberg</a>, "<a href="http://tools.ietf.org/html/draft-ietf-ftpext2-hash-02">FTP Extensions for Cryptographic Hashes</a>", Internet-Draft draft-ietf-ftpext2-hash-02, .</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Acknowledgements and Contributors</h1>
<p id="rfc.section.Appendix A.p.1">Thanks to the FTPEXT2 Working Group and Kamil Dudka.</p>
<p id="rfc.section.Appendix A.p.2">Portions of <a href="#RFC3659">[RFC3659]</a> were wholly reused in this document.</p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> <a href="#dochistory" id="dochistory">Document History</a>
</h1>
<p id="rfc.section.Appendix B.p.1">[[ to be removed by the RFC editor before publication as an RFC. ]]</p>
<p id="rfc.section.Appendix B.p.2">Known issues concerning this draft: </p>

<ul><li>Expand current alternatives (ABOR, close data connection) and why they are not optimal.</li></ul>
<p id="rfc.section.Appendix B.p.3">draft-bryan-ftp-range-03 : March 14, 2011.  </p>

<ul><li>Refinements.</li></ul>
<p id="rfc.section.Appendix B.p.4">draft-bryan-ftp-range-02 : February 1, 2011.  </p>

<ul><li>Refinements.</li></ul>
<p id="rfc.section.Appendix B.p.5">draft-bryan-ftp-range-01 : January 25, 2011.  </p>

<ul><li>Refinements. "RANG 1 0" resets byte selection.</li></ul>
<p id="rfc.section.Appendix B.p.6">draft-bryan-ftp-range-00 : December 13, 2010.  </p>

<ul><li>Initial draft.</li></ul>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Anthony Bryan</span> 
	  <span class="n hidden">
		<span class="family-name">Bryan</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Pompano Beach</span>,  
		<span class="region">FL</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:anthonybryan@gmail.com">anthonybryan@gmail.com</a></span>

<span class="vcardline">URI: <a href="http://www.metalinker.org">http://www.metalinker.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tatsuhiro Tsujikawa</span> 
	  <span class="n hidden">
		<span class="family-name">Tsujikawa</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region">Shiga</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Japan</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:tatsuhiro.t@gmail.com">tatsuhiro.t@gmail.com</a></span>

<span class="vcardline">URI: <a href="http://aria2.sourceforge.net">http://aria2.sourceforge.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Daniel Stenberg</span> 
	  <span class="n hidden">
		<span class="family-name">Stenberg</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:daniel@haxx.se">daniel@haxx.se</a></span>

<span class="vcardline">URI: <a href="http://www.haxx.se/">http://www.haxx.se/</a></span>

  </address>
</div>

</body>
</html>