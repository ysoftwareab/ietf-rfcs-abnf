<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Transporting PTP messages (1588) over MPLS Networks</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Problem Statement">
<link href="#rfc.section.4" rel="Chapter" title="4 1588 over MPLS Architecture">
<link href="#rfc.section.5" rel="Chapter" title="5 Dedicated LSPs for PTP messages">
<link href="#rfc.section.6" rel="Chapter" title="6 1588 over MPLS Encapsulation">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 1588 over LSP Encapsulation">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 1588 over PW Encapsulation">
<link href="#rfc.section.7" rel="Chapter" title="7 1588 Message Transport">
<link href="#rfc.section.8" rel="Chapter" title="8 Protection and Redundancy">
<link href="#rfc.section.9" rel="Chapter" title="9 ECMP">
<link href="#rfc.section.10" rel="Chapter" title="10 OAM, Control and Management">
<link href="#rfc.section.11" rel="Chapter" title="11 QoS Considerations">
<link href="#rfc.section.12" rel="Chapter" title="12 FCS Recalculation">
<link href="#rfc.section.13" rel="Chapter" title="13 UDP Checksum Correction">
<link href="#rfc.section.14" rel="Chapter" title="14 Routing extensions for 1588aware LSRs">
<link href="#rfc.section.14.1" rel="Chapter" title="14.1 1588aware Link Capability for OSPF">
<link href="#rfc.section.14.2" rel="Chapter" title="14.2 1588aware Link Capability for IS-IS">
<link href="#rfc.section.15" rel="Chapter" title="15 RSVP-TE Extensions for support of 1588">
<link href="#rfc.section.16" rel="Chapter" title="16 Behavior of LER/LSR">
<link href="#rfc.section.16.1" rel="Chapter" title="16.1 Behavior of 1588-aware LER">
<link href="#rfc.section.16.2" rel="Chapter" title="16.2 Behavior of 1588-aware LSR">
<link href="#rfc.section.16.3" rel="Chapter" title="16.3 Behavior of non-1588-aware LSR">
<link href="#rfc.section.17" rel="Chapter" title="17 Other considerations">
<link href="#rfc.section.18" rel="Chapter" title="18 Security Considerations">
<link href="#rfc.section.19" rel="Chapter" title="19 Acknowledgements">
<link href="#rfc.section.20" rel="Chapter" title="20 IANA Considerations">
<link href="#rfc.section.20.1" rel="Chapter" title="20.1 IANA Considerations for OSPF">
<link href="#rfc.section.20.2" rel="Chapter" title="20.2 IANA Considerations for IS-IS">
<link href="#rfc.section.20.3" rel="Chapter" title="20.3 IANA Considerations for RSVP">
<link href="#rfc.references" rel="Chapter" title="21 References">
<link href="#rfc.references.1" rel="Chapter" title="21.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="21.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document defines the method for transporting PTP messages (PDUs) over an MPLS network. The method allows for the easy identification of these PDUs at the port level to allow for port level processing of these PDUs in both LERs and LSRs." />
  <meta name="description" content="This document defines the method for transporting PTP messages (PDUs) over an MPLS network. The method allows for the easy identification of these PDUs at the port level to allow for port level processing of these PDUs in both LERs and LSRs." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">TICTOC Working Group</td>
<td class="right">S. Davari</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">A. Oren</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Broadcom Corp.</td>
</tr>
<tr>
<td class="left">Expires: April 09, 2012</td>
<td class="right">M.B. Bhatia</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">P. Roberts</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Alcatel-Lucent</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">L. Montini</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Cisco Systems</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 07, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Transporting PTP messages (1588) over MPLS Networks<br />
  <span class="filename">draft-ietf-tictoc-1588overmpls-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document defines the method for transporting PTP messages (PDUs) over an MPLS network. The method allows for the easy identification of these PDUs at the port level to allow for port level processing of these PDUs in both LERs and LSRs.</p>
<p>The basic idea is to transport PTP messages inside dedicated MPLS LSPs. These LSPs only carry PTP messages and possibly Control and Management packets, but they do not carry customer traffic.</p>
<p>Two methods for transporting 1588 over MPLS are defined. The first method is to transport PTP messages directly over the dedicated MPLS LSP via UDP/IP encapsulation, which is suitable for IP/MPLS networks. The second method is to transport PTP messages inside a PW via Ethernet encapsulation, which is more suitable for MPLS-TP networks.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 09, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Problem Statement</a>
</li>
<li>4.   <a href="#rfc.section.4">1588 over MPLS Architecture</a>
</li>
<li>5.   <a href="#rfc.section.5">Dedicated LSPs for PTP messages</a>
</li>
<li>6.   <a href="#rfc.section.6">1588 over MPLS Encapsulation</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">1588 over LSP Encapsulation</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">1588 over PW Encapsulation</a>
</li>
<li>7.   <a href="#rfc.section.7">1588 Message Transport</a>
</li>
<li>8.   <a href="#rfc.section.8">Protection and Redundancy</a>
</li>
<li>9.   <a href="#rfc.section.9">ECMP</a>
</li>
<li>10.   <a href="#rfc.section.10">OAM, Control and Management</a>
</li>
<li>11.   <a href="#rfc.section.11">QoS Considerations</a>
</li>
<li>12.   <a href="#rfc.section.12">FCS Recalculation</a>
</li>
<li>13.   <a href="#rfc.section.13">UDP Checksum Correction</a>
</li>
<li>14.   <a href="#rfc.section.14">Routing extensions for 1588aware LSRs</a>
</li>
<li>14.1.   <a href="#rfc.section.14.1">1588aware Link Capability for OSPF</a>
</li>
<li>14.2.   <a href="#rfc.section.14.2">1588aware Link Capability for IS-IS</a>
</li>
<li>15.   <a href="#rfc.section.15">RSVP-TE Extensions for support of 1588</a>
</li>
<li>16.   <a href="#rfc.section.16">Behavior of LER/LSR</a>
</li>
<li>16.1.   <a href="#rfc.section.16.1">Behavior of 1588-aware LER</a>
</li>
<li>16.2.   <a href="#rfc.section.16.2">Behavior of 1588-aware LSR</a>
</li>
<li>16.3.   <a href="#rfc.section.16.3">Behavior of non-1588-aware LSR</a>
</li>
<li>17.   <a href="#rfc.section.17">Other considerations</a>
</li>
<li>18.   <a href="#rfc.section.18">Security Considerations</a>
</li>
<li>19.   <a href="#rfc.section.19">Acknowledgements</a>
</li>
<li>20.   <a href="#rfc.section.20">IANA Considerations</a>
</li>
<li>20.1.   <a href="#rfc.section.20.1">IANA Considerations for OSPF</a>
</li>
<li>20.2.   <a href="#rfc.section.20.2">IANA Considerations for IS-IS</a>
</li>
<li>20.3.   <a href="#rfc.section.20.3">IANA Considerations for RSVP</a>
</li>
<li>21.   <a href="#rfc.references">References</a>
</li>
<li>21.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>21.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <p id="rfc.section..p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC2119 <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section..p.2">When used in lower case, these words convey their typical use in common language, and are not to be interpreted as described in RFC2119 <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The objective of Precision Time Protocol (PTP) is to synchronize independent clocks running on separate nodes of a distributed system.  <a href="#IEEE">[IEEE]</a> defines PTP messages for clock and time synchronization. The PTP messages include PTP PDUs over UDP/IP (Annex D and E of <a href="#IEEE">[IEEE]</a>) and PTP PDUs over Ethernet (Annex F of <a href="#IEEE">[IEEE]</a>). This document defines mapping and transport of the PTP messages defined in <a href="#IEEE">[IEEE]</a> over MPLS networks.</p>
<p id="rfc.section.1.p.2">PTP defines several clock types: ordinary clocks, boundary clocks, end-to-end transparent clocks, and peer-to-peer transparent clocks. One key attribute of all of these clocks is the recommendation for PTP messages processing to occur as close as possible to the actual transmission and reception at the physical port interface. This targets optimal time and/or frequency recovery by avoiding variable delay introduced by queues internal to the clocks. To facilitate the fast and efficient recognition of PTP messages at the port level when the PTP messages are carried over MPLS LSPs, this document defines the specific encapsulations that should be used. In addition, it can be expected that there will exist LSR/LERs where only a subset of the physical ports will have the port based PTP message processing capabilities. In order to ensure that the PTP carrying LSPs always enter and exit ports with this capability, routing extensions are defined to advertise this capability on a port basis and to allow for the establishment of LSPs that only transit such ports. While this path establishment restriction may be applied only at the LER ingress/egress ports, it becomes more important when using Transparent Clock capable LSRs in the path.</p>
<p id="rfc.section.1.p.3">The port based PTP message processing involves PTP event message recognition. Once the PTP event messages are recognized they can be modified based on the reception or transmission timestamp. An alternative technique to actual packet modification could include the enforcement of a fixed delay time across the LSR to remove variability in the transit delay. This latter would be applicable in a LSR which does not contain a PTP transparent Clock function.</p>
<p id="rfc.section.1.p.4">This document provides two methods for transporting PTP messages over MPLS. One is principally focused on an IP/MPLS environment and the second is focused on the MPLS-TP environment.</p>
<p id="rfc.section.1.p.5">While the techniques included herein allow for the establishment of paths optimized to include PTP Timestamping capable links, the performance of the Slave clocks is outside the scope of this document.</p>
<p></p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">1588: The timing and synchronization as defined by IEEE 1588</p>
<p id="rfc.section.2.p.2">PTP: The timing and synchronization protocol used by 1588</p>
<p id="rfc.section.2.p.3">Master Clock: The source of 1588 timing to a set of slave clocks.</p>
<p id="rfc.section.2.p.4">Master Port: A port on a ordinary or boundary clock that is in Master state. This is the source of timing toward slave ports.</p>
<p id="rfc.section.2.p.5">Slave Clock: A receiver of 1588 timing from a master clock</p>
<p id="rfc.section.2.p.6">Slave Port: A port on a boundary clock or ordinary clock that is receiving timing from a master clock.</p>
<p id="rfc.section.2.p.7">Ordinary Clock: A device with a single PTP port.</p>
<p id="rfc.section.2.p.8">Transparent Clock. A device that measures the time taken for a PTP event message to transit the device and then updates the correctionField of the message with this transit time.</p>
<p id="rfc.section.2.p.9">Boundary Clock: A device with more than one PTP port. Generally boundary clocks will have one port in slave state to receive timing and then other ports in master state to re-distribute the timing.</p>
<p id="rfc.section.2.p.10">PTP LSP: An LSP dedicated to carry PTP messages</p>
<p id="rfc.section.2.p.11">PTP PW: A PW within a PTP LSP that is dedicated to carry PTP messages.</p>
<p id="rfc.section.2.p.12">CW: Pseudowire Control Word</p>
<p id="rfc.section.2.p.13">LAG: Link Aggregation</p>
<p id="rfc.section.2.p.14">ECMP: Equal Cost Multipath</p>
<p id="rfc.section.2.p.15">CF: Correction Field, a field inside certain PTP messages (message type 0-3)that holds the accumulative transit time inside intermediate switches</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Problem Statement</h1>
<p id="rfc.section.3.p.1">When PTP messages are transported over MPLS networks, there is a need for PTP message processing at the physical port level. This requirement exists to minimum uncertainty in the transit delays. If PTP message processing occurs interior to the MPLS routers, then the variable delay introduced by queuing between the physical port and the PTP processing will add noise to the timing distribution. Port based processing applies at both the originating and terminating LERs and also at the intermediate LSRs if they support transparent clock functionality.</p>
<p id="rfc.section.3.p.2">PTP messages over Ethernet or IP can always be tunneled over MPLS.  However there is a requirement to limit the possible encapsulation options to simplify the PTP message processing required at the port level. This applies to all 1588 clock types implemented in MPLS routers.  But this is particularly important in LSRs that provide transparent clock functionality.</p>
<p id="rfc.section.3.p.3">When 1588-awareness is needed, PTP messages should not be transported over LSPs or PWs that are carrying customer traffic because LSRs perform Label switching based on the top label in the stack. To detect PTP messages inside such LSPs require special hardware to do deep packet inspection at line rate. Even if such hardware exists, the payload can't be deterministically identified by LSRs because the payload type is a context of the PW label and the PW label and its context are only known to the Edge routers (PEs); LSRs don't know what is a PW's payload (Ethernet, ATM, FR, CES, etc). Even if one restricts an LSP to only carry Etehrent PWs, the LSRs don't have the knowledge of whether PW Control Word (CW) is present or not and therefore can't deterministically identify the payload.</p>
<p id="rfc.section.3.p.4">Therefore a generic method is defined in this document that does not require deep packet inspection at line rate, and can deterministically identify PTP messages. The defined method is applicable to both MPLS and MPLS-TP networks.</p>
<p></p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> 1588 over MPLS Architecture</h1>
<p id="rfc.section.4.p.1">1588 communication flows map onto MPLS nodes as follows: 1588 messages are exchange between PTP ports on Ordinary and boundary clocks.  Transparent clocks do not terminate the PTP messages but they do modify the contents of the PTP messages as they transit across the Transparent clock. SO Ordinary and boundary clocks would exist within LERs as they are the termination points for the PTP messages carried in MPLS.  Transparent clocks would exist within LSRs as they do not terminate the PTP message exchange.</p>
<p id="rfc.section.4.p.2">Perhaps a picture would be good here.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Dedicated LSPs for PTP messages</h1>
<p id="rfc.section.5.p.1">Many methods were considered for identifying the 1588 messages when they are encapsulated in MPLS such as by using GAL/ACH or a new reserved label. These methods were not attractive since they either required deep packet inspection and snooping at line rate or they required use of a scarce new reserved label. Also one of the goals was to reuse existing OAM and protection mechanisms.</p>
<p id="rfc.section.5.p.2">The method defined in this document can be used by LER/LSRs to identify PTP messages in MPLS tunnels by using dedicated LSPs to carry PTP messages.</p>
<p id="rfc.section.5.p.3">Compliant implementations MUST use dedicated LSPs to carry PTP messages over MPLS. These LSPs are herein referred to as "PTP LSPs" and the labels associated with these LSPs as "PTP labels". These LSPs could be P2P or P2MP LSPs. The PTP LSP between Master Clocks and Slave Clocks MAY be P2MP or P2P LSP while the PTP LSP between each Slave Clock and Master Clock SHOULD be P2P LSP. The PTP LSP between a Master Clock and a Slave Clock and the PTP LSP between the same Slave Clock and Master Clock MUST be co-routed. Alternatively, a single bidirectional co-routed LSP can be used. The PTP LSP MAY be MPLS LSP or MPLS-TP LSP. This co-routing is required to limit differences in the delays in the Master clock to Slave clock direction compared to the Slave clock to Master clock direction.</p>
<p id="rfc.section.5.p.4">The PTP LSPs could be configured or signaled via RSVP-TE/GMPLS. New RSVP-TE/GMPLS TLVs and objects are defined in this document to indicate that these LSPs are PTP LSPs.</p>
<p id="rfc.section.5.p.5">The PTP LSPs MAY carry essential MPLS/MPLS-TP control plane traffic such as BFD and LSP Ping but the LSP user plane traffic MUST be PTP only.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> 1588 over MPLS Encapsulation</h1>
<p id="rfc.section.6.p.1">This document defines two methods for carrying PTP messages over MPLS. The first method is carrying IP encapsulated PTP messages over PTP LSPs and the second method is to carry PTP messages over dedicated Ethernet PWs (called PTP PWs) inside PTP LSPs.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> 1588 over LSP Encapsulation</h1>
<p id="rfc.section.6.1.p.1">The simplest method of transporting PTP messages over MPLS is to encapsulate PTP PDUs in UDP/IP and then encapsulate them in PTP LSP.  The 1588 over LSP format is shown in Figure 1.</p>
<div id="#rfc.figure.1"></div>
<pre>

        
       +----------------------+
       |   PTP Tunnel Label   |
       +----------------------+
       |        IPv4/6        |
       +----------------------+
       |         UDP          |
       +----------------------+
       |        PTP PDU       |
       +----------------------+

Figure 1 - 1588 over LSP Encapsulation
</pre>
<p id="rfc.section.6.1.p.2">This encapsulation is very simple and is useful when the networks between 1588 Master Clock and Slave Clock are IP/MPLS networks.</p>
<p id="rfc.section.6.1.p.3">In order for an LSR to process PTP messages, the PTP Label must be the top label of the label stack.</p>
<p id="rfc.section.6.1.p.4">The UDP/IP encapsulation of PTP MUST follow Annex D and E of <a href="#IEEE">[IEEE]</a>.</p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> 1588 over PW Encapsulation</h1>
<p id="rfc.section.6.2.p.1">Another method of transporting 1588 over MPLS networks is by encapsulating PTP PDUs in Ethernet and then transporting them over Ethernet PW (PTP PW) as defined in <a href="#RFC4448">[RFC4448]</a>, which in turn is transported over PTP LSPs. Alternatively PTP PDUs MAY be encapsulated in UDP/IP/Ethernet and then transported over Ethernet PW.</p>
<p id="rfc.section.6.2.p.2">Both Raw and Tagged modes for Ethernet PW are permitted. The 1588 over PW format is shown in Figure 2.</p>
<div id="#rfc.figure.2"></div>
<pre>

                 +----------------+
                 |PTP Tunnel Label|
                 +----------------+
                 |    PW Label    |
                 +----------------+
                 |  Control Word  |
                 +----------------+
                 |    Ethernet    |
                 |     Header     |
                 +----------------+
                 |     VLANs      |
                 |   (optional)   |
                 +----------------+
                 |    IPV4/V6     |
                 |   (optional)   |
                 +----------------+
                 |      UDP       |
                 |   (optional)   |
                 +----------------+
                 |    PTP PDU     |
                 +----------------+

         Figure 2 - 1588 over PW Encapsulation
</pre>
<p id="rfc.section.6.2.p.3">The Control Word (CW) as specified in <a href="#RFC4448">[RFC4448]</a> SHOULD be used to ensure a more robust detection of PTP messages inside the MPLS packet. If CW is used, the use of Sequence number is optional.</p>
<p id="rfc.section.6.2.p.4">The use of VLAN and UDP/IP are optional. Note that 1 or 2 VLANs MAY exist in the PW payload.</p>
<p id="rfc.section.6.2.p.5">In order for an LSR to process PTP messages, the top label of the label stack (the Tunnel Label) MUST be from PTP label range. However in some applications the PW label may be the top label in the stack, such as cases where there is only one-hop between PEs or in case of PHP. In such cases, the PW label SHOULD be chosen from the PTP Label range.</p>
<p id="rfc.section.6.2.p.6">In order to ensure congruency between the two directions of PTP message flow, ECMP should not be used for the PTP LSPs. Therefore, no Entropy label <a href="#I-D.ietf-pwe3-fat-pw">[I-D.ietf-pwe3-fat-pw]</a> is necessary and it SHOULD NOT be present in the stack.</p>
<p id="rfc.section.6.2.p.7">The Ethernet encapsulation of PTP MUST follow Annex F of <a href="#IEEE">[IEEE]</a> and the UDP/IP encapsulation of PTP MUST follow Annex D and E of <a href="#IEEE">[IEEE]</a>.</p>
<p id="rfc.section.6.2.p.8">For 1588 over MPLS encapsulations that are PW based, there are some cases in which the PTP LSP label may not be present:</p>
<p></p>

<ul>
<li>When PHP is applied to the PTP LSP, and the packet is received without PTP LSP label at PW termination point .</li>
<li>When the PW is established between two routers directly connected to each other and no PTP LSP is needed.</li>
</ul>

<p> </p>
<p id="rfc.section.6.2.p.10">In such cases it is required for a router to identify these packets as PTP packets. This would require the PW label to also be a label that is distributed specifically for carrying PTP traffic (aka PTP PW label). Therefore there is a need to add extension to LDP/BGP PW label distribution protocol to indicate that a PW label is a PTP PW labels.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#MessageTransport" id="MessageTransport">1588 Message Transport</a>
</h1>
<p id="rfc.section.7.p.1">1588 protocol comprises of the following message types:</p>
<p></p>

<ul>
<li>Announce</li>
<li>SYNC</li>
<li>FOLLOW UP</li>
<li>DELAY_REQ (Delay Request)</li>
<li>DELAY_RESP (Delay Response)</li>
<li>PDELAY_REQ (Peer Delay Request)</li>
<li>PDELAY_RESP (Peer Delay Response)</li>
<li>PDELAY_RESP_FOLLOW_UP (Peer Delay Response Follow up)</li>
<li>Management</li>
<li>Signaling</li>
</ul>

<p> </p>
<p id="rfc.section.7.p.3">A subset of PTP message types that require timestamp processing are called Event messages:</p>
<p></p>

<ul>
<li>SYNC</li>
<li>DELAY_REQ (Delay Request)</li>
<li>PDELAY_REQ (Peer Delay Request)</li>
<li>PDELAY_RESP (Peer Delay Response)</li>
</ul>

<p> </p>
<p id="rfc.section.7.p.5">SYNC and DELAY_REQ are exchanged between Master Clock and Slave Clock and MUST be transported over PTP LSPs. PDELAY_REQ and PDELAY_RESP are exchanged between adjacent PTP clocks (i.e. Master, Slave, Boundary, or Transparent) and MAY be transported over single hop PTP LSPs. If Two Step PTP clocks are present, then the FOLLOW_UP, DELAY_RESP, and PDELAY_RESP_FOLLOW_UP messages must also be transported over the PTP LSPs.</p>
<p id="rfc.section.7.p.6">For a given instance of 1588 protocol, SYNC and DELAY_REQ MUST be transported over two PTP LSPs that are in opposite directions. These PTP LSPs, which are in opposite directions MUST be congruent and co-routed.  Alternatively, a single bidirectional co-routed LSP can be used.</p>
<p id="rfc.section.7.p.7">Except as indicated above for the two-step PTP clocks, Non-Event PTP message types don't need to be processed by intermediate routers. These message types MAY be carried in PTP Tunnel LSPs.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#Protection" id="Protection">Protection and Redundancy</a>
</h1>
<p id="rfc.section.8.p.1">In order to ensure continuous uninterrupted operation of 1588 Slaves, usually as a general practice, Redundant Masters are tracked by each Slave. It is the responsibility of the network operator to ensure that physically disjoint PTP tunnels that don't share any link are used between the redundant Masters and a Slave.</p>
<p id="rfc.section.8.p.2">When redundant Masters are tracked by a Slave, any prolonged PTP LSP or PTP PW outage will trigger the Slave Clock to switch to the Redundant Master Clock. However LSP/PW protection such as Linear Protection Switching (1:1,1+1), Ring protection switching or MPLS Fast Reroute (FRR) SHOULD still be used to provide resiliency to individual network segment failures..</p>
<p id="rfc.section.8.p.3">Note that any protection or reroute mechanism that adds additional label to the label stack, such as Facility Backup Fast Reroute, MUST ensure that the pushed label is a PTP Label to ensure recognition of the MPLS frame as containing PTP messages as it transits the backup path..</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#ECMP" id="ECMP">ECMP</a>
</h1>
<p id="rfc.section.9.p.1">To ensure the optimal operation of 1588 Slave clocks and avoid errors introduced by forward and reverse path delay asymmetry, the physical path for PTP messages from Master Clock to Slave Clock and vice versa must be the same for all PTP messages listed in section 7 and must not change even in the presence of ECMP in the MPLS network.</p>
<p id="rfc.section.9.p.2">To ensure the forward and reverse paths are the same PTP LSPs and PWs MUST NOT be subject to ECMP.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#OAM" id="OAM">OAM, Control and Management</a>
</h1>
<p id="rfc.section.10.p.1">In order to manage PTP LSPs and PTP PWs, they MAY carry OAM, Control and Management messages. These control and management messages can be differentiated from PTP messages via already defined IETF methods.</p>
<p id="rfc.section.10.p.2">In particular BFD <a href="#RFC5880">[RFC5880]</a>, <a href="#RFC5884">[RFC5884]</a> and LSP-Ping <a href="#RFC4389">[RFC4389]</a>MAY run over PTP LSPs via UDP/IP encapsulation or via GAL/G-ACH. These Management protocols are easily identified by the UDP Destination Port number or by GAL/ACH respectively.</p>
<p id="rfc.section.10.p.3">Also BFD, LSP-Ping and other Management messages MAY run over PTP PW via one of the defined VCCVs (Type 1, 2 or 3) <a href="#RFC5085">[RFC5085]</a>.  In this case G-ACH, Router Alert Label (RAL), or PW label (TTL=1) are used to identify such management messages.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#QoS" id="QoS">QoS Considerations</a>
</h1>
<p id="rfc.section.11.p.1">In network deployments where not every LSR/LER is PTP-aware, then it is important to reduce the impact of the non-PTP-aware LSR/LERs on the timing recovery in the slave clock. The PTP messages are time critical and must be treated with the highest priority. Therefore 1588 over MPLS messages must be treated with the highest priority in the routers. This can be achieved by proper setup of PTP tunnels. It is recommended that the PTP LSPs are setup and marked properly to indicate EF-PHB for the CoS and Green for drop eligibility.</p>
<p id="rfc.section.11.p.2">In network deployments where every LSR/LER supports PTP LSPs, then it MAY NOT be required to apply the same level of prioritization as specified above.</p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> <a href="#FCS" id="FCS">FCS Recalculation</a>
</h1>
<p id="rfc.section.12.p.1">Ethernet FCS of the outer encapsulation MUST be recalculated at every LSR that performs the Transparent Clock processing and FCS retention for the payload Ethernet described in <a href="#RFC4720">[RFC4720]</a> MUST NOT be used.</p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> <a href="#UDP" id="UDP">UDP Checksum Correction</a>
</h1>
<p id="rfc.section.13.p.1">For UDP/IP encapsulation mode of 1588 over MPLS, the UDP checksum is optional when used for IPv4 encapsulation and mandatory in case of IPv6.  When IPv4/v6 UDP checksum is used each 1588-aware LSR must either incrementally update the UDP checksum after the CF update or should verify the UDP checksum on reception from upstream and recalculate the checksum completely on transmission after CF update to downstream node.</p>
<h1 id="rfc.section.14">
<a href="#rfc.section.14">14.</a> <a href="#Routing" id="Routing">Routing extensions for 1588aware LSRs</a>
</h1>
<p id="rfc.section.14.p.1">MPLS-TE routing relies on extensions to OSPF <a href="#RFC2328">[RFC2328]</a> <a href="#RFC5340">[RFC5340]</a> and IS-IS <a href="#ISO">[ISO]</a> <a href="#RFC1195">[RFC1195]</a> in order to advertise Traffic Engineering (TE) link information used for constraint-based routing.</p>
<p id="rfc.section.14.p.2">Indeed, it is useful to advertise data plane TE router link capabilities, such as the capability for a router to be 1588-aware. This capability MUST then be taken into account during path computation to prefer or even require links that advertise themselves as 1588-aware. In this way the path can ensure the entry and exit points into the LERs and, if desired, the links into the LSRs are able to perform port based timestamping thus minimizing their impact on the performance of the slave clock.</p>
<p id="rfc.section.14.p.3">For this purpose, the following sections specify extensions to OSPF and IS-IS in order to advertise 1588 aware capabilities of a link.</p>
<h1 id="rfc.section.14.1">
<a href="#rfc.section.14.1">14.1.</a> <a href="#OSPFCapability" id="OSPFCapability">1588aware Link Capability for OSPF</a>
</h1>
<p id="rfc.section.14.1.p.1">OSPF uses the Link TLV (Type 2) that is itself carried within either the Traffic Engineering LSA specified in <a href="#RFC3630">[RFC3630]</a> or the OSPFv3 Intra-Area-TE LSA (function code 10) defined in <a href="#RFC5329">[RFC5329]</a> to advertise the TE related information for the locally attached router links. For an LSA Type 10, one LSA can contain one Link TLV information for a single link. This extension defines a new 1588-aware capability sub-TLV that can be carried as part of the Link TLV.</p>
<p id="rfc.section.14.1.p.2">The 1588-aware capability sub-TLV is OPTIONAL and MUST NOT appear more than once within the Link TLV. If a second instance of the 1588-aware capability sub-TLV is present, the receiving system MUST only process the first instance of the sub-TLV. It is defined as follows:</p>
<div id="#rfc.figure.3"></div>
<pre>
   0                    1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Type             |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Flags     |
   +-+-+-+-+-+-+-+-+
  
             Figure 3: 1588-aware Capability TLV 

          </pre>
<p id="rfc.section.14.1.p.3">Where:</p>
<p id="rfc.section.14.1.p.4">Type, 16 bits: 1588-aware Capability TLV where the value is TBD</p>
<p id="rfc.section.14.1.p.5">Length, 16 bits: Gives the length of the flags field in octets, and is currently set to 1</p>
<p id="rfc.section.14.1.p.6">Flags, 8 bits: The bits are defined least-significant-bit (LSB) first, so bit 7 is the least significant bit of the flags octet.</p>
<div id="#rfc.figure.4"></div>
<pre>

    0 1 2 3 4 5 6 7 
   +-+-+-+-+-+-+-+-+
   |   Reserved  |C|
   +-+-+-+-+-+-+-+-+

  Figure 4: Flags Format

          </pre>
<p id="rfc.section.14.1.p.7">Correction (C) field Update field, 1 bit: Setting the C bit to 1 indicates that the link is capable of recognizing the PTP event packets and can compensate for residence time by updating the PTP packet Correction Field. When this is set to 0, it means that this link cannot perform the residence time correction but is capable of performing MPLS frame forwarding of the frames with PTP labels using a method that support the end to end delivery of accurate timing. The exact method is not defined herein.</p>
<p id="rfc.section.14.1.p.8">Reserved, 7 bits: Reserved for future use. The reserved bits must be ignored by the receiver.</p>
<p id="rfc.section.14.1.p.9">The 1588-aware Capability sub-TLV is applicable to both OSPFv2 and OSPFv3.</p>
<h1 id="rfc.section.14.2">
<a href="#rfc.section.14.2">14.2.</a> <a href="#ISIS" id="ISIS">1588aware Link Capability for IS-IS</a>
</h1>
<p id="rfc.section.14.2.p.1">The IS-IS Traffic Engineering <a href="#RFC3784">[RFC3784]</a> defines the intra-area traffic engineering enhancements and uses the Extended IS Reachability TLV (Type 22) <a href="#RFC5305">[RFC5305]</a> to carry the per link TE-related information. This extension defines a new 1588-aware capability sub-TLV that can be carried as part of the Extended IS Reachability TLV.</p>
<p id="rfc.section.14.2.p.2">The 1588-aware capability sub-TLV is OPTIONAL and MUST NOT appear more than once within the Extended IS Reachability TLV or the Multi-Topology (MT) Intermediate Systems TLV (type 222) specified in <a href="#RFC5120">[RFC5120]</a>. If a second instance of the 1588-aware capability sub-TLV is present, the receiving system MUST only process the first instance of the sub-TLV.</p>
<p id="rfc.section.14.2.p.3">The format of the IS-IS 1588-aware sub-TLV is identical to the TLV format used by the Traffic Engineering Extensions to IS-IS <a href="#RFC3784">[RFC3784]</a>. That is, the TLV is comprised of 1 octet for the type, 1 octet specifying the TLV length, and a value field. The Length field defines the length of the value portion in octets.</p>
<div id="#rfc.figure.5"></div>
<pre>
   0                    1                   2        
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |     Length    |    Flags      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  
          Figure 5: 1588-aware Capability sub-TLV 
          </pre>
<p id="rfc.section.14.2.p.4">Where:</p>
<p id="rfc.section.14.2.p.5">Type, 8 bits: 1588-aware Capability sub-TLV where the value is TBD</p>
<p id="rfc.section.14.2.p.6">Length, 8 bits: Gives the length of the flags field in octets, and is currently set to 1</p>
<p id="rfc.section.14.2.p.7">Flags, 8 bits: The bits are defined least-significant-bit (LSB) first, so bit 7 is the least significant bit of the flags octet.</p>
<div id="#rfc.figure.6"></div>
<pre>

    0 1 2 3 4 5 6 7 
   +-+-+-+-+-+-+-+-+
   |   Reserved  |C|
   +-+-+-+-+-+-+-+-+

  Figure 6: Flags Format
          </pre>
<p id="rfc.section.14.2.p.8">Correction (C) field Update field, 1 bit: Setting the C bit to 1 indicates that the link is capable of recognizing the PTP event packets and can compensate for residence time by updating the PTP packet Correction Field. When this is set to 0, it means that this link cannot perform the residence time correction but is capable of performing MPLS frame forwarding of the frames with PTP labels using a method that support the end to end delivery of accurate timing. The exact method is not defined herein.</p>
<p id="rfc.section.14.2.p.9">Reserved, 7 bits: Reserved for future use. The reserved bits must be ignored by the receiver.</p>
<h1 id="rfc.section.15">
<a href="#rfc.section.15">15.</a> <a href="#RSVP" id="RSVP">RSVP-TE Extensions for support of 1588</a>
</h1>
<p id="rfc.section.15.p.1">RSVP-TE signaling MAY be used to setup the PTP LSPs. A new RSVP object is defined to signal that this is a PTP LSP. The OFFSET to the start of the PTP message header MAY also be signaled. Implementations can trivially locate the correctionField (CF) location given this information. The OFFSET points to the start of the PTP header as a node may want to check the PTP messageType before it touches the correctionField (CF). The OFFSET is counted from TBD</p>
<p id="rfc.section.15.p.2">The LSRs that receive and process the RSVP-TE/GMPLS messages MAY use the OFFSET to locate the start of the PTP message header.</p>
<p id="rfc.section.15.p.3">Note that the new object/TLV Must be ignored by LSRs that are not compliant to this specification.</p>
<p id="rfc.section.15.p.4">The new RSVP 1588_PTP_LSP object should be included in signaling PTP LSPs and is defined as follows:</p>
<div id="#rfc.figure.7"></div>
<pre>
                0             1             2             3
         +-------------+-------------+-------------+-------------+
         |       Length (bytes)      |  Class-Num  |   C-Type    |
         +-------------+-------------+-------------+-------------+
         | Offset to locate the start of the PTP message header  |
         +-------------+-------------+-------------+-------------+ 

                  Figure 7: RSVP 1588_PTP_LSP object 

          </pre>
<p id="rfc.section.15.p.5">The ingress LSR MUST include this object in the RSVP PATH Message. It is just a normal RSVP path that is exclusively set up for PTP messages</p>
<h1 id="rfc.section.16">
<a href="#rfc.section.16">16.</a> Behavior of LER/LSR</h1>
<h1 id="rfc.section.16.1">
<a href="#rfc.section.16.1">16.1.</a> Behavior of 1588-aware LER</h1>
<p id="rfc.section.16.1.p.1">A 1588-aware LER advertises it's 1588-awareness via the OSPF procedure explained in earlier section of this specification. The 1588-aware LER then signals PTP LSPs by including the 1588_PTP_LSP object in the RSVP-TE signaling.</p>
<p id="rfc.section.16.1.p.2">When a 1588 message is received from a non-MPLS interface, the LER MUST redirect them to a previously established PTP LSP. When a 1588 over MPLS message is received from an MPLS interface, the processing is similar to 1588-aware LSR processing.</p>
<h1 id="rfc.section.16.2">
<a href="#rfc.section.16.2">16.2.</a> Behavior of 1588-aware LSR</h1>
<p id="rfc.section.16.2.p.1">1588-aware LSRs are LSRs that understand the 1588_PTP_LSP RSVP object and can perform 1588 processing (e.g. Transparent Clock processing).</p>
<p id="rfc.section.16.2.p.2">A 1588-aware LSR advertises it's 1588-awareness via the OSPF procedure explained in earlier section of this specification.</p>
<p id="rfc.section.16.2.p.3">When a 1588-aware LSR distributes a label for PTP LSP, it maintains this information. When the 1588-aware LSR receives an MPLS packet, it performs a label lookup and if the label lookup indicates it is a PTP label then further parsing must be done to positively identify that the payload is 1588 and not OAM, BFD or control and management. Ruling out non-1588 messages can easily be done when parsing indicates the presence of GAL, ACH or VCCV (Type 1, 2, 3) or when the UDP port number does not match one of the 1588 UDP port numbers.</p>
<p id="rfc.section.16.2.p.4">After a 1588 message is positively identified in a PTP LSP, the PTP message type indicates whether any timestamp processing is required.  After 1588 processing the packet is forwarded as a normal MPLS packet to downstream node.</p>
<h1 id="rfc.section.16.3">
<a href="#rfc.section.16.3">16.3.</a> Behavior of non-1588-aware LSR</h1>
<p id="rfc.section.16.3.p.1">It is most beneficial that all LSRs in the path of a PTP LSP be 1588-aware LSRs. This would ensure the highest quality time and clock synchronization by 1588 Slave Clocks. However, this specification does not mandate that all LSRs in path of a PTP LSP be 1588-aware.</p>
<p id="rfc.section.16.3.p.2">Non-1588-aware LSRs are LSRs that either don't have the capability to process 1588 packets (e.g. perform Transparent Clock processing) or don't understand the 1588_PTP_LSP RSVP object.</p>
<p id="rfc.section.16.3.p.3">Non-1588-aware LSRs ignore the RSVP 1588_PTP_LSP object and just switch the MPLS packets carrying 1588 messages as data packets and don't perform any timestamp related processing. However as explained in QoS section the 1588 over MPLS packets MUST be still be treated with the highest priority.</p>
<h1 id="rfc.section.17">
<a href="#rfc.section.17">17.</a> Other considerations</h1>
<p id="rfc.section.17.p.1">The use of Explicit Null (Label= 0 or 2) is acceptable as long as either the Explicit Null label is the bottom of stack label (applicable only to UDP/IP encapsulation) or the label below the Explicit Null label is a PTP label.</p>
<p id="rfc.section.17.p.2">The use of Penultimate Hop Pop (PHP) is acceptable as long as either the PHP label is the bottom of stack label (applicable only to UDP/IP encapsulation) or the label below the PHP label is a PTP label.</p>
<h1 id="rfc.section.18">
<a href="#rfc.section.18">18.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.18.p.1">MPLS PW security considerations in general are discussed in <a href="#RFC3985">[RFC3985]</a> and <a href="#RFC4447">[RFC4447]</a>,and those considerations also apply to this document.</p>
<p id="rfc.section.18.p.2">An experimental security protocol is defined in [IEEE]. The PTP security extension and protocol provides group source authentication, message integrity, and replay attack protection for PTP messages.</p>
<h1 id="rfc.section.19">
<a href="#rfc.section.19">19.</a> <a href="#Ack" id="Ack">Acknowledgements</a>
</h1>
<p id="rfc.section.19.p.1">The authors would like to thank Luca Martini, Ron Cohen, Yaakov Stein, Tal Mizrahi and other members of the TICTOC WG for reviewing and providing feedback on this draft.</p>
<h1 id="rfc.section.20">
<a href="#rfc.section.20">20.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<h1 id="rfc.section.20.1">
<a href="#rfc.section.20.1">20.1.</a> <a href="#OSPF-IANA" id="OSPF-IANA">IANA Considerations for OSPF</a>
</h1>
<p id="rfc.section.20.1.p.1">IANA has defined a sub-registry for the sub-TLVs carried in an OSPF TE Link TLV (type 2). IANA is requested to assign a new sub-TLV codepoint for the 1588aware capability sub-TLV carried within the Router Link TLV.</p>
<div id="#rfc.figure.8"></div>
<pre>
   Value            Sub-TLV                   References
   -----     ----------------------           ----------
    TBD       1588aware node sub-TLV        (this document) 
          </pre>
<h1 id="rfc.section.20.2">
<a href="#rfc.section.20.2">20.2.</a> <a href="#ISIS-IANA" id="ISIS-IANA">IANA Considerations for IS-IS</a>
</h1>
<p id="rfc.section.20.2.p.1">IANA has defined a sub-registry for the sub-TLVs carried in the IS-IS Extended IS Reacability TLV. IANA is requested to assign a new sub-TLV code-point for the 1588aware capability sub-TLV carried within the Extended IS Reacability TLV.</p>
<div id="#rfc.figure.9"></div>
<pre>

   Value            Sub-TLV                   References 
   -----     ----------------------           ---------- 
    TBD       1588aware node sub-TLV        (this document) 
          </pre>
<h1 id="rfc.section.20.3">
<a href="#rfc.section.20.3">20.3.</a> <a href="#RSVp-IANA" id="RSVp-IANA">IANA Considerations for RSVP</a>
</h1>
<p id="rfc.section.20.3.p.1">IANA is requested to assign a new Class Number for 1588 PTP LSP object that is used to signal PTP LSPs.</p>
<p id="rfc.section.20.3.p.2">1588 PTP LSP Object</p>
<p id="rfc.section.20.3.p.3">Class-Num of type 11bbbbbb</p>
<p id="rfc.section.20.3.p.4">Suggested value TBD</p>
<p id="rfc.section.20.3.p.5">Defined CType: 1 (1588 PTP LSP)</p>
<h1 id="rfc.references">
<a href="#rfc.references">21.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">21.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="IEEE">[IEEE]</b></td>
<td class="top">
<a title="IEEE 1588-2008">, </a>, "<a>IEEE Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems</a>", .</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4720">[RFC4720]</b></td>
<td class="top">
<a>Malis, A.</a>, <a>Allan, D.</a> and <a>N. Del Regno</a>, "<a href="http://tools.ietf.org/html/rfc4720">Pseudowire Emulation Edge-to-Edge (PWE3) Frame Check Sequence Retention</a>", RFC 4720, November 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5884">[RFC5884]</b></td>
<td class="top">
<a>Aggarwal, R.</a>, <a>Kompella, K.</a>, <a>Nadeau, T.</a> and <a>G. Swallow</a>, "<a href="http://tools.ietf.org/html/rfc5884">Bidirectional Forwarding Detection (BFD) for MPLS Label Switched Paths (LSPs)</a>", RFC 5884, June 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4448">[RFC4448]</b></td>
<td class="top">
<a>Martini, L.</a>, <a>Rosen, E.</a>, <a>El-Aawar, N.</a> and <a>G. Heron</a>, "<a href="http://tools.ietf.org/html/rfc4448">Encapsulation Methods for Transport of Ethernet over MPLS Networks</a>", RFC 4448, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4389">[RFC4389]</b></td>
<td class="top">
<a>Thaler, D.</a>, <a>Talwar, M.</a> and <a>C. Patel</a>, "<a href="http://tools.ietf.org/html/rfc4389">Neighbor Discovery Proxies (ND Proxy)</a>", RFC 4389, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5085">[RFC5085]</b></td>
<td class="top">
<a>Nadeau, T.</a> and <a>C. Pignataro</a>, "<a href="http://tools.ietf.org/html/rfc5085">Pseudowire Virtual Circuit Connectivity Verification (VCCV): A Control Channel for Pseudowires</a>", RFC 5085, December 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5880">[RFC5880]</b></td>
<td class="top">
<a>Katz, D.</a> and <a>D. Ward</a>, "<a href="http://tools.ietf.org/html/rfc5880">Bidirectional Forwarding Detection (BFD)</a>", RFC 5880, June 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3985">[RFC3985]</b></td>
<td class="top">
<a>Bryant, S.</a> and <a>P. Pate</a>, "<a href="http://tools.ietf.org/html/rfc3985">Pseudo Wire Emulation Edge-to-Edge (PWE3) Architecture</a>", RFC 3985, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4447">[RFC4447]</b></td>
<td class="top">
<a>Martini, L.</a>, <a>Rosen, E.</a>, <a>El-Aawar, N.</a>, <a>Smith, T.</a> and <a>G. Heron</a>, "<a href="http://tools.ietf.org/html/rfc4447">Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)</a>", RFC 4447, April 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">21.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-pwe3-fat-pw">[I-D.ietf-pwe3-fat-pw]</b></td>
<td class="top">
<a>Bryant, S</a>, <a>Filsfils, C</a>, <a>Drafz, U</a>, <a>Kompella, V</a>, <a>Regan, J</a> and <a>S Amante</a>, "<a href="http://tools.ietf.org/html/draft-ietf-pwe3-fat-pw-07">Flow Aware Transport of Pseudowires over an MPLS Packet Switched Network</a>", Internet-Draft draft-ietf-pwe3-fat-pw-07, July 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1195">[RFC1195]</b></td>
<td class="top">
<a title="Digital Equipment Corporation (DEC)">Callon, R.</a>, "<a href="http://tools.ietf.org/html/rfc1195">Use of OSI IS-IS for routing in TCP/IP and dual environments</a>", RFC 1195, December 1990.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2328">[RFC2328]</b></td>
<td class="top">
<a href="mailto:jmoy@casc.com" title="Ascend Communications, Inc.">Moy, J.</a>, "<a href="http://tools.ietf.org/html/rfc2328">OSPF Version 2</a>", STD 54, RFC 2328, April 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3784">[RFC3784]</b></td>
<td class="top">
<a>Smit, H.</a> and <a>T. Li</a>, "<a href="http://tools.ietf.org/html/rfc3784">Intermediate System to Intermediate System (IS-IS) Extensions for Traffic Engineering (TE)</a>", RFC 3784, June 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4970">[RFC4970]</b></td>
<td class="top">
<a>Lindem, A.</a>, <a>Shen, N.</a>, <a>Vasseur, JP.</a>, <a>Aggarwal, R.</a> and <a>S. Shaffer</a>, "<a href="http://tools.ietf.org/html/rfc4970">Extensions to OSPF for Advertising Optional Router Capabilities</a>", RFC 4970, July 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4971">[RFC4971]</b></td>
<td class="top">
<a>Vasseur, JP.</a>, <a>Shen, N.</a> and <a>R. Aggarwal</a>, "<a href="http://tools.ietf.org/html/rfc4971">Intermediate System to Intermediate System (IS-IS) Extensions for Advertising Router Information</a>", RFC 4971, July 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5340">[RFC5340]</b></td>
<td class="top">
<a>Coltun, R.</a>, <a>Ferguson, D.</a>, <a>Moy, J.</a> and <a>A. Lindem</a>, "<a href="http://tools.ietf.org/html/rfc5340">OSPF for IPv6</a>", RFC 5340, July 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3630">[RFC3630]</b></td>
<td class="top">
<a>Katz, D.</a>, <a>Kompella, K.</a> and <a>D. Yeung</a>, "<a href="http://tools.ietf.org/html/rfc3630">Traffic Engineering (TE) Extensions to OSPF Version 2</a>", RFC 3630, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5329">[RFC5329]</b></td>
<td class="top">
<a>Ishiguro, K.</a>, <a>Manral, V.</a>, <a>Davey, A.</a> and <a>A. Lindem</a>, "<a href="http://tools.ietf.org/html/rfc5329">Traffic Engineering Extensions to OSPF Version 3</a>", RFC 5329, September 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5305">[RFC5305]</b></td>
<td class="top">
<a>Li, T.</a> and <a>H. Smit</a>, "<a href="http://tools.ietf.org/html/rfc5305">IS-IS Extensions for Traffic Engineering</a>", RFC 5305, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5120">[RFC5120]</b></td>
<td class="top">
<a>Przygienda, T.</a>, <a>Shen, N.</a> and <a>N. Sheth</a>, "<a href="http://tools.ietf.org/html/rfc5120">M-ISIS: Multi Topology (MT) Routing in Intermediate System to Intermediate Systems (IS-ISs)</a>", RFC 5120, February 2008.</td>
</tr>
<tr>
<td class="reference"><b id="ISO">[ISO]</b></td>
<td class="top">
<a title="ISO/IEC 10589:1992">, </a>, "<a>Intermediate system to Intermediate system routeing information exchange protocol for use in conjunction with the Protocol for providing the Connectionless-mode Network Service (ISO 8473)</a>", .</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Shahram Davari</span> 
	  <span class="n hidden">
		<span class="family-name">Davari</span>
	  </span>
	</span>
	<span class="org vcardline">Broadcom Corp.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">San Jose, CA</span>,  
		<span class="region"></span>
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:davari@broadcom.com">davari@broadcom.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Amit Oren</span> 
	  <span class="n hidden">
		<span class="family-name">Oren</span>
	  </span>
	</span>
	<span class="org vcardline">Broadcom Corp.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">San Jose, CA</span>,  
		<span class="region"></span>
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:amito@broadcom.com">amito@broadcom.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Manav Bhatia</span> 
	  <span class="n hidden">
		<span class="family-name">Bhatia</span>
	  </span>
	</span>
	<span class="org vcardline">Alcatel-Lucent</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Bangalore</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:manav.bhatia@alcatel-lucent.com">manav.bhatia@alcatel-lucent.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Peter Roberts</span> 
	  <span class="n hidden">
		<span class="family-name">Roberts</span>
	  </span>
	</span>
	<span class="org vcardline">Alcatel-Lucent</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Kanata</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Canada</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:peter.roberts@alcatel-lucent.com">peter.roberts@alcatel-lucent.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Laurent Montini</span> 
	  <span class="n hidden">
		<span class="family-name">Montini</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">San Jose CA</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:lmontini@cisco.com">lmontini@cisco.com</a></span>

  </address>
</div>

</body>
</html>