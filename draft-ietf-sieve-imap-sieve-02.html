<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Support for Sieve in Internet Message Access Protocol (IMAP4)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Overview">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Conventions used in this document">
<link href="#rfc.section.2" rel="Chapter" title="2 The IMAPSieve Extension">
<link href="#rfc.section.2.1" rel="Chapter" title='2.1 The "IMAPSieve" Capability String'>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Existing IMAP Functions Affected by IMAPSieve">
<link href="#rfc.section.2.2.1" rel="Chapter" title="2.2.1 The IMAP APPEND Command">
<link href="#rfc.section.2.2.2" rel="Chapter" title="2.2.2 The IMAP MULTIAPPEND Command">
<link href="#rfc.section.2.2.3" rel="Chapter" title="2.2.3 The IMAP COPY Command">
<link href="#rfc.section.2.2.4" rel="Chapter" title="2.2.4 Changes to IMAP Message Flags">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 New Functions Defined by IMAPSieve">
<link href="#rfc.section.2.3.1" rel="Chapter" title="2.3.1 Interaction with Metadata">
<link href="#rfc.section.3" rel="Chapter" title="3 Applicable Sieve Actions and Interactions">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 The Implicit Keep">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 The Keep Action">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 The Fileinto Action">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 The Redirect Action">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 The Discard Action">
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 The Notify Action">
<link href="#rfc.section.3.7" rel="Chapter" title="3.7 The Addheader and Deleteheader Actions">
<link href="#rfc.section.3.8" rel="Chapter" title="3.8 The Setflag, Deleteflag, and Removeflag Actions">
<link href="#rfc.section.3.9" rel="Chapter" title="3.9 MIME Part Tests and Replacement">
<link href="#rfc.section.3.10" rel="Chapter" title="3.10 Spamtest and Virustest">
<link href="#rfc.section.3.11" rel="Chapter" title="3.11 Inapplicable Actions">
<link href="#rfc.section.4" rel="Chapter" title="4 New Sieve Environment Items">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 New Sieve Environment Items: imapuser and imapemail">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 New Sieve Environment Item: cause">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 New Sieve Environment Item: mailbox">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 New Sieve Environment Item: changedflags">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Interaction With Sieve Tests (Comparisons)">
<link href="#rfc.section.5" rel="Chapter" title="5 Examples">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Registration of IMAPSIEVE IMAP capability">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Registration of imapsieve Sieve extension">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Registration of environment item: cause">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Registration of environment item: mailbox">
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 Registration of environment item: changedflags">
<link href="#rfc.section.7.6" rel="Chapter" title="7.6 Registration of environment item: imapuser">
<link href="#rfc.section.7.7" rel="Chapter" title="7.7 Registration of environment item: imapemail">
<link href="#rfc.section.7.8" rel="Chapter" title="7.8 Registration of IMAP METADATA mailbox entry name">
<link href="#rfc.section.7.9" rel="Chapter" title="7.9 Registration of IMAP METADATA server entry name">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Non-Normative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Sieve defines an email filtering language that can, in principle, plug into any point in the processing of an email message.  As defined in the base specification, it plugs into mail delivery.  This document defines how Sieve can plug into points in the IMAP protocol where messages are created or changed, adding the option of user-defined or installation-defined filtering (or, with Sieve extensions, features such as notifications).  " />
  <meta name="description" content="Sieve defines an email filtering language that can, in principle, plug into any point in the processing of an email message.  As defined in the base specification, it plugs into mail delivery.  This document defines how Sieve can plug into points in the IMAP protocol where messages are created or changed, adding the option of user-defined or installation-defined filtering (or, with Sieve extensions, features such as notifications).  " />
  <meta name="keywords" content="IMAP, Sieve, email, filtering" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Sieve Working Group</td>
<td class="right">B. Leiba</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Huawei Technologies</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">July 08, 2011</td>
</tr>
<tr>
<td class="left">Expires: January 09, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Support for Sieve in Internet Message Access Protocol (IMAP4)<br />
  <span class="filename">draft-ietf-sieve-imap-sieve-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Sieve defines an email filtering language that can, in principle, plug into any point in the processing of an email message.  As defined in the base specification, it plugs into mail delivery.  This document defines how Sieve can plug into points in the IMAP protocol where messages are created or changed, adding the option of user-defined or installation-defined filtering (or, with Sieve extensions, features such as notifications).  </p>
<h1><a>Note</a></h1>
<p>This document defines extensions to IMAP and Sieve.  It is the work of the Sieve Working Group, but had previously been in the lemonade mailing list, as draft-ietf-lemonade-imap-sieve.  </p>

<ol>
<li>Discussion of this document should be taken to the Sieve mailing list at mailto:sieve@ietf.org </li>
<li>Subscription requests can be sent to mailto:sieve@ietf.org?body=subscribe (send an email message with the word "subscribe" in the body).  </li>
<li>A WWW archive of back messages is available at http://www.ietf.org/mail-archive/web/sieve/index.html </li>
<li>Older messages, which were posted to the lemonade mailing list, are archived at http://www.ietf.org/mail-archive/web/lemonade/index.html </li>
</ol>

<p> </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 09, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Overview</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Conventions used in this document</a>
</li>
<li>2.   <a href="#rfc.section.2">The IMAPSieve Extension</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">The "IMAPSieve" Capability String</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Existing IMAP Functions Affected by IMAPSieve</a>
</li>
<li>2.2.1.   <a href="#rfc.section.2.2.1">The IMAP APPEND Command</a>
</li>
<li>2.2.2.   <a href="#rfc.section.2.2.2">The IMAP MULTIAPPEND Command</a>
</li>
<li>2.2.3.   <a href="#rfc.section.2.2.3">The IMAP COPY Command</a>
</li>
<li>2.2.4.   <a href="#rfc.section.2.2.4">Changes to IMAP Message Flags</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">New Functions Defined by IMAPSieve</a>
</li>
<li>2.3.1.   <a href="#rfc.section.2.3.1">Interaction with Metadata</a>
</li>
<li>3.   <a href="#rfc.section.3">Applicable Sieve Actions and Interactions</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">The Implicit Keep</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">The Keep Action</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">The Fileinto Action</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">The Redirect Action</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">The Discard Action</a>
</li>
<li>3.6.   <a href="#rfc.section.3.6">The Notify Action</a>
</li>
<li>3.7.   <a href="#rfc.section.3.7">The Addheader and Deleteheader Actions</a>
</li>
<li>3.8.   <a href="#rfc.section.3.8">The Setflag, Deleteflag, and Removeflag Actions</a>
</li>
<li>3.9.   <a href="#rfc.section.3.9">MIME Part Tests and Replacement</a>
</li>
<li>3.10.   <a href="#rfc.section.3.10">Spamtest and Virustest</a>
</li>
<li>3.11.   <a href="#rfc.section.3.11">Inapplicable Actions</a>
</li>
<li>4.   <a href="#rfc.section.4">New Sieve Environment Items</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">New Sieve Environment Items: imapuser and imapemail</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">New Sieve Environment Item: cause</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">New Sieve Environment Item: mailbox</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">New Sieve Environment Item: changedflags</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Interaction With Sieve Tests (Comparisons)</a>
</li>
<li>5.   <a href="#rfc.section.5">Examples</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">Registration of IMAPSIEVE IMAP capability</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">Registration of imapsieve Sieve extension</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">Registration of environment item: cause</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">Registration of environment item: mailbox</a>
</li>
<li>7.5.   <a href="#rfc.section.7.5">Registration of environment item: changedflags</a>
</li>
<li>7.6.   <a href="#rfc.section.7.6">Registration of environment item: imapuser</a>
</li>
<li>7.7.   <a href="#rfc.section.7.7">Registration of environment item: imapemail</a>
</li>
<li>7.8.   <a href="#rfc.section.7.8">Registration of IMAP METADATA mailbox entry name</a>
</li>
<li>7.9.   <a href="#rfc.section.7.9">Registration of IMAP METADATA server entry name</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Non-Normative References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a>
</h1>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#overview" id="overview">Overview</a>
</h1>
<p id="rfc.section.1.1.p.1">Some applications have a need to apply Sieve filters <a href="#RFC5228">[RFC5228]</a> in situations other than initial mail delivery.  This is especially true in diverse service environments, such as when the client is sporadically connected, is connected through a high-latency or high-cost channel, or is on a limited-function device.  For such clients, it may be very important, for higher performance and reliability, to take advantage of server capabilities, including those provided by Sieve filtering (and Sieve extensions, such as Notify <a href="#RFC5435">[RFC5435]</a>).  </p>
<p id="rfc.section.1.1.p.2">This specification defines extensions to IMAP <a href="#RFC3501">[RFC3501]</a> to support the invocation of Sieve scripts at times when the IMAP server creates new messages or modifies existing ones.  It also defines how Sieve scripts will process these invocations.  Support for IMAPSieve requires support for IMAP Metadata <a href="#RFC5464">[RFC5464]</a> and Sieve Environment <a href="#RFC5183">[RFC5183]</a> as well, because Metadata is used to associate scripts with IMAP mailboxes and Environment defines an important way for Sieve scripts to test the conditions under which they have been invoked.  </p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#conventions" id="conventions">Conventions used in this document</a>
</h1>
<p id="rfc.section.1.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#imapspec" id="imapspec">The IMAPSieve Extension</a>
</h1>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#capability" id="capability">The "IMAPSieve" Capability String</a>
</h1>
<p></p>
<p id="rfc.section.2.1.p.2">An IMAP server advertises support for this extension through the capability string "IMAPSieve" (the string is not case-sensitive, and is shown here with this capitalization for readability).  A server that advertises IMAPSieve is claiming to be in compliance with this specification in all aspects.  </p>
<p id="rfc.section.2.1.p.3">The corresponding Sieve implementation uses the Sieve capability string "IMAPSieve (also case-insensitive), and scripts that depend upon the IMAP events MUST include that string in their "required" lists.  </p>
<p id="rfc.section.2.1.p.4">Implementations that support IMAPSieve MUST also support IMAP Metadata <a href="#RFC5464">[RFC5464]</a> and Sieve Environment <a href="#RFC5183">[RFC5183]</a>, because Metadata is used to associate scripts with IMAP mailboxes and Environment defines an important way for Sieve scripts to test the conditions under which they have been invoked.  Notwithstanding the support requirement, scripts that directly use Environment MUST also include its capability string in their "required" lists.  </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#oldfunc" id="oldfunc">Existing IMAP Functions Affected by IMAPSieve</a>
</h1>
<p id="rfc.section.2.2.p.1">The subsections below describe in detail the IMAP commands and situations on which IMAPSieve has an effect.  Not all Sieve actions make sense in the case of messages affected by IMAP commands.  See <a href="#sieveactions">Section 3</a> for details.  </p>
<p id="rfc.section.2.2.p.2">It's important to note that since the base Sieve specification (see <a href="#RFC5228">[RFC5228]</a>) and its extensions define functions for scripts that are invoked during initial mail delivery, those function definitions are necessarily tailored to and limited by that context.  This document extends those function definitions for use during IMAP events.  By nature of that, Sieve functions, in this extended context, may behave somewhat differently, though their extended behaviour will still be consistent with the functions' goals.  </p>
<p id="rfc.section.2.2.p.3">If more than one message is affected at the same time, each message triggers the execution of a Sieve script separately.  The scripts MAY be run in parallel.  </p>
<h1 id="rfc.section.2.2.1">
<a href="#rfc.section.2.2.1">2.2.1.</a> <a href="#imapappend" id="imapappend">The IMAP APPEND Command</a>
</h1>
<p id="rfc.section.2.2.1.p.1">A message may be added to a mailbox through the IMAP APPEND command.  In a server that advertises IMAPSieve, new messages added in this way MUST trigger the execution of a Sieve script, subject to the settings defined through Metadata (see <a href="#metadata-def">Section 2.3.1</a>).  </p>
<h1 id="rfc.section.2.2.2">
<a href="#rfc.section.2.2.2">2.2.2.</a> <a href="#imapmultiappend" id="imapmultiappend">The IMAP MULTIAPPEND Command</a>
</h1>
<p id="rfc.section.2.2.2.p.1">If the IMAP server supports the IMAP MultiAppend extension <a href="#RFC3502">[RFC3502]</a>, messages may be added to a mailbox through the IMAP MULTIAPPEND command.  In a server that advertises IMAPSieve, new messages added in this way MUST trigger the execution of a Sieve script, as with the APPEND command, also subject to the settings defined through Metadata.  </p>
<h1 id="rfc.section.2.2.3">
<a href="#rfc.section.2.2.3">2.2.3.</a> <a href="#imapcopy" id="imapcopy">The IMAP COPY Command</a>
</h1>
<p id="rfc.section.2.2.3.p.1">One or more messages may be added to a mailbox through the IMAP COPY command.  In a server that advertises IMAPSieve, new messages added in this way MUST trigger the execution of a Sieve script, subject to the settings defined through Metadata.  </p>
<h1 id="rfc.section.2.2.4">
<a href="#rfc.section.2.2.4">2.2.4.</a> <a href="#imapflags" id="imapflags">Changes to IMAP Message Flags</a>
</h1>
<p id="rfc.section.2.2.4.p.1">One or more existing messages can have their flags changed in a number of ways, including: </p>

<ul>
<li>The FETCH command (may cause the \Seen flag to be set).</li>
<li>The STORE command (may cause the \Answered, \Deleted, \Draft, \Flagged, and \Seen flags to be set or reset, and may cause keywords to be set or reset).</li>
<li>The invocation of a Sieve script on an existing message, where the Sieve implementation supports the IMAP4Flags extension <a href="#RFC5232">[RFC5232]</a> and the script uses one of the actions defined in that extension.  </li>
</ul>

<p> In a server that advertises IMAPSieve, messages whose flags are changed in any way (except as explained in the next sentence) MUST trigger the execution of a Sieve script, subject to the settings defined through Metadata.  The exception is that in order to avoid script loops, flag changes that are made as a result of a script that was itself invoked because of flag changes SHOULD NOT result in another script invocation.  In any case, implementations MUST take steps to avoid such loops.  </p>
<p id="rfc.section.2.2.4.p.2">For flag-change events, the Sieve script will see the message flags as they are AFTER the changes.  </p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#newfunc" id="newfunc">New Functions Defined by IMAPSieve</a>
</h1>
<h1 id="rfc.section.2.3.1">
<a href="#rfc.section.2.3.1">2.3.1.</a> <a href="#metadata-def" id="metadata-def">Interaction with Metadata</a>
</h1>
<p id="rfc.section.2.3.1.p.1">Support for IMAPSieve requires support for IMAP Metadata <a href="#RFC5464">[RFC5464]</a> as well, since the latter is used to associate scripts with IMAP mailboxes.  </p>
<p id="rfc.section.2.3.1.p.2">When an applicable event occurs on an IMAP mailbox, if there is an IMAP metadata entry named "/IMAPSieve/Script" for the mailbox, that entry is used.  If there is not, but there is an IMAP metadata entry named "/IMAPSieve/Script" for the server, that entry is used (providing a way to define a global script for all mailboxes on a server).  If neither entry exists, then no script will be invoked.  </p>
<p id="rfc.section.2.3.1.p.3">If an "/IMAPSieve/Script" metadata entry was selected above, the shared value of that metadata name (its "value.shared" attribute) MUST be the name of the Sieve script that will be invoked in response to the IMAP event OR the name of another metadata entry, the name prefixed with "metadata:" (such as "metadata:/IMAPSieve/ScriptContents"), that contains the actual script in its value.shared attribute.  Note that only the value.shared attribute is used; any value.priv attributes are ignored.  </p>
<p></p>
<p id="rfc.section.2.3.1.p.5">This specifies the mechanism for "activating" a script for a given mailbox (or for all mailboxes), but does not specify a mechanism for creating, storing, or validating the script.  Implementations MAY use ManageSieve <a href="#RFC5804">[RFC5804]</a> to acomplish this, using the PUTSCRIPT command to store the script without using the SETACTIVE command to activate it.  In any case, the script name that is specified in the /IMAPSieve/Script metadata entry is in a form that depends upon how the server handles the storing of Sieve scripts.  </p>
<p id="rfc.section.2.3.1.p.6">Only one Sieve script may currently be defined per mailbox, eliminating the complexity and possible ambiguity involved with coordinating the results of multiple scripts.  Any sub-filtering is done in the Sieve script.  For example, if it's only necessary to deal with flag changes, but not with new messages appended or copied, the Sieve script will still be invoked for all events, and the script is responsible for checking the event type.  </p>
<p id="rfc.section.2.3.1.p.7">The possibility is open for an extension to add support for multiple scripts -- for example, per-client scripts on a multi-client user's inbox, or per-user scripts on a mailbox that is shared among users.  </p>
<p id="rfc.section.2.3.1.p.8">Because this metadata name is associated with the mailbox, there can (and it's expected that there will) be different scripts associated with events for different mailboxes.  Indeed, most mailboxes will probably invoke no script at all.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#sieveactions" id="sieveactions">Applicable Sieve Actions and Interactions</a>
</h1>
<p id="rfc.section.3.p.1">Since some Sieve actions relate specifically to the delivery of mail, not all actions and extensions make sense when the messages are created by other means or when changes are made to data associated with existing messages.  This section describes how actions in the base Sieve specification, and those in extensions known at this writing, relate to this specification.  </p>
<p id="rfc.section.3.p.2">In addition to what is specified here, interactions noted in the individual specifications apply, and must be considered.  </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#action-implicitkeep" id="action-implicitkeep">The Implicit Keep</a>
</h1>
<p id="rfc.section.3.1.p.1">For all cases that fall under IMAPSieve, the implicit keep means that the message is treated as it would have been if no Sieve script were run.  For APPEND, MULTIAPPEND and COPY, the message is stored into the target mailbox normally.  For flag changes, the message is left in the mailbox.  If actions have been taken that change the message, those changes are considered transient and MUST NOT be retained for any keep action (because IMAP messages are immutable).  No error is generated, but the original message, without the changes, is kept.  </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#action-keep" id="action-keep">The Keep Action</a>
</h1>
<p id="rfc.section.3.2.p.1">The keep action is applicable in all cases that fall under IMAPSieve.  Its behaviour is as described for implicit keep, in <a href="#action-implicitkeep">Section 3.1</a>.  </p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#action-fileinto" id="action-fileinto">The Fileinto Action</a>
</h1>
<p id="rfc.section.3.3.p.1">If the Sieve implementation supports the fileinto action, that action is applicable in all cases that fall under IMAPSieve.  If the Copy extension <a href="#RFC3894">[RFC3894]</a> is available and the :copy option is specified, the implicit keep is retained; otherwise, fileinto cancels the implicit keep, as specified in the base Sieve specification.  </p>
<p id="rfc.section.3.3.p.2">For APPEND, MULTIAPPEND, and COPY, the message is stored into the fileinto mailbox IN ADDITION TO the original target mailbox.  For flag changes, the message is COPIED into the fileinto mailbox, without removing the original.  </p>
<p id="rfc.section.3.3.p.3">If a keep action is NOT also in effect, the original message is then marked with the \Deleted flag (and a flag-change Sieve script is NOT invoked).  The implementation MAY then expunge the original message (WITHOUT expunging other messages in the mailbox), or it MAY choose to have expunges batched, or done by a user.  If the server does the expunge, the effect is as though a client had flagged the message and done a UID EXPUNGE (see <a href="#RFC4315">[RFC4315]</a>) on the affected message(s) only.  Handling it this way allows clients to handle messages consistently, and avoids hidden changes that might invalidate their message caches.  </p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#action-redirect" id="action-redirect">The Redirect Action</a>
</h1>
<p id="rfc.section.3.4.p.1">The redirect action is applicable in all cases that fall under IMAPSieve.  It causes the message to be sent, as specified in the base Sieve specification, to the designated address.  If the Copy extension <a href="#RFC3894">[RFC3894]</a> is available and the :copy option is specified, the implicit keep is retained; otherwise, redirect cancels the implicit keep, as specified in the base Sieve specification.  </p>
<p id="rfc.section.3.4.p.2">It's possible that a message processed in this way does not have the information necessary to be redirected properly.  It might lack necessary header information, and there might not be appropriate information for the MAIL FROM command.  In such cases, the "redirect" action uses Message Submission <a href="#RFC4409">[RFC4409]</a>, and it is up to the Sieve engine to supply the missing information.  The redirect address is, of course, used for the "RCPT TO", and the "MAIL FROM" SHOULD be set to the address of the owner of the mailbox.  The message submission server is allowed, according to the Message Submission protocol, to perform necessary fix-up to the message (see section 8 of RFC 4409).  It can also reject the submission attempt, if the message is too ill-formed for submission.  </p>
<p id="rfc.section.3.4.p.3">For APPEND, MULTIAPPEND, and COPY, the message is stored into the target mailbox in addition to being redirected.  For flag changes, the message remains in its original mailbox.  </p>
<p id="rfc.section.3.4.p.4">If a keep action is NOT also in effect, the original message is then marked with the \Deleted flag (and a flag-change Sieve script is NOT invoked).  The implementation MAY then expunge the original message (WITHOUT expunging other messages in the mailbox), or it MAY choose to have expunges batched, or done by a user.  If the server does the expunge, the effect is as though a client had flagged the message and done a UID EXPUNGE (see <a href="#RFC4315">[RFC4315]</a>) on the affected message(s) only.  Handling it this way allows clients to handle messages consistently, and avoids hidden changes that might invalidate their message caches.  </p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#action-discard" id="action-discard">The Discard Action</a>
</h1>
<p id="rfc.section.3.5.p.1">The discard action is applicable in all cases that fall under IMAPSieve.  For APPEND, MULTIAPPEND, and COPY, the message is first stored into the target mailbox.  If an explicit keep action is also in effect, the discard action now does nothing.  Otherwise, the original message is then marked with the \Deleted flag (and a flag-change Sieve script is NOT invoked).  The implementation MAY then expunge the original message (WITHOUT expunging other messages in the mailbox), or it MAY choose to have expunges batched, or done by a user.  If the server does the expunge, the effect is as though a client had flagged the message and done a UID EXPUNGE (see <a href="#RFC4315">[RFC4315]</a>) on the affected message(s) only.  Handling it this way allows clients to handle messages consistently, and avoids hidden changes that might invalidate their message caches.  </p>
<h1 id="rfc.section.3.6">
<a href="#rfc.section.3.6">3.6.</a> <a href="#action-notify" id="action-notify">The Notify Action</a>
</h1>
<p id="rfc.section.3.6.p.1">If the Nofity extension <a href="#RFC5435">[RFC5435]</a> is available, the notify action is applicable in all cases that fall under IMAPSieve.  The result is that the requested notification is sent, and that the message is otherwise handled as it would normally have been.  </p>
<h1 id="rfc.section.3.7">
<a href="#rfc.section.3.7">3.7.</a> <a href="#action-addheader" id="action-addheader">The Addheader and Deleteheader Actions</a>
</h1>
<p id="rfc.section.3.7.p.1">If the EditHeader extension <a href="#RFC5293">[RFC5293]</a> is available, it can be used to make transient changes to header fields, which aren't saved in place, such as for "redirect" or "fileinto" actions.  Because messages in IMAP mailboxes are immutable, such changes are NOT applicable for the "keep" acton (explicit or implicit).  See <a href="#action-implicitkeep">Section 3.1</a>.  </p>
<h1 id="rfc.section.3.8">
<a href="#rfc.section.3.8">3.8.</a> <a href="#action-imapflags" id="action-imapflags">The Setflag, Deleteflag, and Removeflag Actions</a>
</h1>
<p id="rfc.section.3.8.p.1">Implementations of the IMAPSieve extension MUST also support the IMAP4Flags extension <a href="#RFC5232">[RFC5232]</a>, and the actions associated with it are all applicable to any case that falls under IMAPSieve.  </p>
<p id="rfc.section.3.8.p.2">It is worth noting also that the "hasflag" test that is defined in the IMAP4Flags extension might be particularly useful in scripts triggered by flag changes ("hasflag" will see the new, changed flags).  The flag changes behave as though a client had made the change.  </p>
<p id="rfc.section.3.8.p.3">As explained above, in order to avoid script loops flag changes that are made as a result of a script that was itself invoked because of flag changes SHOULD NOT result in another script invocation.  In any case, implementations MUST take steps to avoid such loops.  </p>
<h1 id="rfc.section.3.9">
<a href="#rfc.section.3.9">3.9.</a> <a href="#action-mimeloop" id="action-mimeloop">MIME Part Tests and Replacement</a>
</h1>
<p id="rfc.section.3.9.p.1">If the MIME Part Tests extension <a href="#RFC5703">[RFC5703]</a> is available, all of its functions can be used, but any changes made to the message, using the "replace" or "enclose" action, MUST be considered transient, and are only applicable with actions such as "redirect" and "fileinto".  Because messages in IMAP mailboxes are immutable, such changes are NOT applicable for the "keep" acton (explicit or implicit).  See <a href="#action-implicitkeep">Section 3.1</a>.  </p>
<h1 id="rfc.section.3.10">
<a href="#rfc.section.3.10">3.10.</a> <a href="#action-spamtest" id="action-spamtest">Spamtest and Virustest</a>
</h1>
<p id="rfc.section.3.10.p.1">If the Spamtest and Virustest extensions <a href="#RFC5235">[RFC5235]</a> are available, they are applicable in all cases that fall under IMAPSieve.  </p>
<h1 id="rfc.section.3.11">
<a href="#rfc.section.3.11">3.11.</a> <a href="#action-inapplicable" id="action-inapplicable">Inapplicable Actions</a>
</h1>
<p id="rfc.section.3.11.p.1">The following actions and extensions are NOT applicable to any case that falls under IMAPSieve.  Their use or their appearance in the "require" control MUST result in an error condition that will terminate the Sieve script: </p>

<ul class="empty">
<li>reject <a href="#RFC5228">[RFC5228]</a>
</li>
<li>ereject <a href="#RFC5429">[RFC5429]</a>
</li>
<li>vacation <a href="#RFC5230">[RFC5230]</a>
</li>
</ul>

<p> </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#env-items" id="env-items">New Sieve Environment Items</a>
</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#env-imapuser" id="env-imapuser">New Sieve Environment Items: imapuser and imapemail</a>
</h1>
<p id="rfc.section.4.1.p.1">In the normal case, when Sieve is used in final delivery, there is no identity for the "filer" -- the user who is creating or changing the message.  In this case, there is such an identity, and a Sieve script might want to access that identity.  </p>
<p id="rfc.section.4.1.p.2">Implementations MUST set and make available two new environment items: </p>
<p id="rfc.section.4.1.p.3">"imapuser" -- the identity (login ID) of the IMAP user that caused the action.  This MUST be the empty string if it is accessed during normal (final delivery) Sieve processing.  </p>
<p id="rfc.section.4.1.p.4">"imapemail" -- the primary email address of the IMAP user that caused the action (the user identified by "imapuser").  In some implementations, "imapuser" and "imapemail" might have the same value.  This MUST be the empty string if it is accessed during normal (final delivery) Sieve processing.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#env-imapcause" id="env-imapcause">New Sieve Environment Item: cause</a>
</h1>
<p id="rfc.section.4.2.p.1">Implementations MAY invoke different Sieve scripts for the different conditions described in this document (append, copy, flag changes).  If the actions to be taken are common, and the implementation supports the Include extension <a href="#I-D.ietf-sieve-include">[I-D.ietf-sieve-include]</a>, the common script code can be included as specified there.  </p>
<p id="rfc.section.4.2.p.2">Each mailbox uses a single script for all the change conditions described in this document (append, copy, flag changes).  To support that, the implementation MUST set the Environment <a href="#RFC5183">[RFC5183]</a> item "cause", which contains the name of the action that caused the script to be invoked.  Its value is one of the following: </p>

<ul>
<li>APPEND (for invocations resulting from APPEND or MULTIAPPEND)</li>
<li>COPY (for invocations resulting from COPY)</li>
<li>FLAG (for invocations resulting from flag changes)</li>
</ul>

<p> </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#env-imapmailbox" id="env-imapmailbox">New Sieve Environment Item: mailbox</a>
</h1>
<p id="rfc.section.4.3.p.1">The implementation MUST set the Environment <a href="#RFC5183">[RFC5183]</a> item "mailbox" to the name of the mailbox that the affected message is in, in the case of existing messages, or is targeted to be stored into, in the case of new messages.  The value of this item is fixed when the script begins, and, in particular, MUST NOT change as a result of any action, such as "fileinto".  </p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#env-imapnewflags" id="env-imapnewflags">New Sieve Environment Item: changedflags</a>
</h1>
<p id="rfc.section.4.4.p.1">If the IMAP4Flags extension <a href="#RFC5232">[RFC5232]</a> is available, AND the script was invoked because of flag changes to an existing message, the implementation MUST set the Environment <a href="#RFC5183">[RFC5183]</a> item "changedflags" to the name(s) of the flag(s) that have changed.  If the script was not invoked because of flag changes, the value of this item MUST be the empty string.  The script will not know from this item whether the flags have been set or reset, but it can use the "hasflag" test to determine the current value.  See example 2 in <a href="#examples">Section 5</a> for an example of how this might be used.  </p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> <a href="#tests" id="tests">Interaction With Sieve Tests (Comparisons)</a>
</h1>
<p id="rfc.section.4.5.p.1">This extension does not affect the operation of tests or comparisons in the Sieve base specification.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#examples" id="examples">Examples</a>
</h1>
<div id="#rfc.figure.1"></div>
<pre>
  require ["copy", "environment"];

  if anyof (environment :is "cause" "APPEND",
            environment :is "cause" "COPY")  {
      if environment :is "mailbox" "ActionItems" {
          redirect :copy "actionitems@example.com";
      }
  }
              </pre>
<p id="rfc.section.5.p.1">Example 1:<br> If a new message is added to the "ActionItems" mailbox, a copy is sent to the address "actionitems@example.com".  </p>
<div id="#rfc.figure.2"></div>
<pre>
  require ["enotify", "imap4flags", "variables", "environment"];

  if environment :matches "mailbox" "*" {
      set "mailbox" "${1}";
  }

  if allof (hasflag "\\Flagged",
            not environment :contains "changedflags" "\\Flagged") {
    notify :message "Important message in ${mailbox}"
        "xmpp:tim@example.com?message;subject=SIEVE";
  }
              </pre>
<p id="rfc.section.5.p.2">Example 2:<br> If the script is called for any message with the \Flagged flag set (tested through the IMAP4Flags extension <a href="#RFC5232">[RFC5232]</a>), a notification is sent using the Notify extension <a href="#RFC5435">[RFC5435]</a>.  No notification will be sent, though, if we're called with an existing message that already had that flag set.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">It is possible to introduce script processing loops by having a Sieve script that is triggered by flag changes use the actions defined in the IMAP4Flags extension <a href="#RFC5232">[RFC5232]</a>.  Implementations MUST take steps to prevent such loops.  One way to avoid this problem is that if a script is invoked by flag changes, and that script further changes the flags, those flag changes SHOULD NOT trigger a Sieve script invocation.  </p>
<p id="rfc.section.6.p.2">It is also possible to introduce loops through the "redirect" or "notify" actions.  See section 10 of Sieve <a href="#RFC5228">[RFC5228]</a>, section 8 of Sieve Notify <a href="#RFC5435">[RFC5435]</a>, and the Security Considerations sections of the applicable notification-method documents for loop-prevention information.  This extension does not change any of that advice.  </p>
<p id="rfc.section.6.p.3">Other security considerations are discussed in IMAP <a href="#RFC3501">[RFC3501]</a>, and Sieve <a href="#RFC5228">[RFC5228]</a>, as well as in some of the other extension documents.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#iana-0" id="iana-0">Registration of IMAPSIEVE IMAP capability</a>
</h1>
<p id="rfc.section.7.1.p.1">This document defines a new IMAP capability.  IANA is asked to add "IMAPSIEVE" to the IMAP 4 Capabilities registry.  </p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> <a href="#iana-1" id="iana-1">Registration of imapsieve Sieve extension</a>
</h1>
<p id="rfc.section.7.2.p.1">The following template specifies the IANA registration of the Sieve extension specified in this document: </p>
<p id="rfc.section.7.2.p.2">To: iana@iana.org <br> Subject: Registration of new Sieve extension <br> Capability name: imapsieve <br> Description: Add Sieve processing for IMAP events.  <br> RFC number: this RFC <br> Contact address: Barry Leiba &lt;barryleiba@computer.org&gt; </p>
<p id="rfc.section.7.2.p.3">This information should be added to the list of sieve extensions given on http://www.iana.org/assignments/sieve-extensions.  </p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> <a href="#iana-2" id="iana-2">Registration of environment item: cause</a>
</h1>
<p id="rfc.section.7.3.p.1">The following template specifies the IANA registration of a sieve environment item specified in this document: </p>
<p id="rfc.section.7.3.p.2">To: iana@iana.org <br> Subject: Registration of new Sieve environment item <br> Item name: cause <br> Description: The name of the action that caused the script to be invoked.  Its value is one of the following: <br> RFC number: this RFC <br> Contact address: <br> &#160; &#160; Barry Leiba &lt;barryleiba@computer.org&gt; </p>

<ul>
<li>APPEND (for invocations resulting from APPEND or MULTIAPPEND)</li>
<li>COPY (for invocations resulting from COPY)</li>
<li>FLAG (for invocations resulting from flag changes)</li>
</ul>

<p> </p>
<p id="rfc.section.7.3.p.3">This information should be added to the list of sieve environment item names given in the Environment extension <a href="#RFC5183">[RFC5183]</a>.  </p>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> <a href="#iana-3" id="iana-3">Registration of environment item: mailbox</a>
</h1>
<p id="rfc.section.7.4.p.1">The following template specifies the IANA registration of a sieve environment item specified in this document: </p>
<p id="rfc.section.7.4.p.2">To: iana@iana.org <br> Subject: Registration of new Sieve environment item <br> Item name: mailbox <br> Description: The name of the mailbox that the affected message is in, in the case of existing messages, or is targeted to be stored into, in the case of new messages.  The value of this item is fixed when the script begins, and, in particular, MUST NOT change as a result of any action, such as "fileinto".  <br> RFC number: this RFC <br> Contact address: <br> &#160; &#160; Barry Leiba &lt;barryleiba@computer.org&gt; </p>
<p id="rfc.section.7.4.p.3">This information should be added to the list of sieve environment item names given in the Environment extension <a href="#RFC5183">[RFC5183]</a>.  </p>
<h1 id="rfc.section.7.5">
<a href="#rfc.section.7.5">7.5.</a> <a href="#iana-4" id="iana-4">Registration of environment item: changedflags</a>
</h1>
<p id="rfc.section.7.5.p.1">The following template specifies the IANA registration of a sieve environment item specified in this document: </p>
<p id="rfc.section.7.5.p.2">To: iana@iana.org <br> Subject: Registration of new Sieve environment item <br> Item name: changedflags <br> Description: If the script was invoked because of flag changes to an existing message, this contains the name(s) of the flag(s) that have changed.  Otherwise, the value of this item MUST be the empty string.  <br> RFC number: this RFC <br> Contact address: <br> &#160; &#160; Barry Leiba &lt;barryleiba@computer.org&gt; </p>
<p id="rfc.section.7.5.p.3">This information should be added to the list of sieve environment item names given in the Environment extension <a href="#RFC5183">[RFC5183]</a>.  </p>
<h1 id="rfc.section.7.6">
<a href="#rfc.section.7.6">7.6.</a> <a href="#iana-5" id="iana-5">Registration of environment item: imapuser</a>
</h1>
<p id="rfc.section.7.6.p.1">The following template specifies the IANA registration of a sieve environment item specified in this document: </p>
<p id="rfc.section.7.6.p.2">To: iana@iana.org <br> Subject: Registration of new Sieve environment item <br> Item name: imapuser <br> Description: The identity (IMAP login ID) of the IMAP user that caused the action.  <br> RFC number: this RFC <br> Contact address: <br> &#160; &#160; Barry Leiba &lt;barryleiba@computer.org&gt; </p>
<p id="rfc.section.7.6.p.3">This information should be added to the list of sieve environment item names given in the Environment extension <a href="#RFC5183">[RFC5183]</a>.  </p>
<h1 id="rfc.section.7.7">
<a href="#rfc.section.7.7">7.7.</a> <a href="#iana-6" id="iana-6">Registration of environment item: imapemail</a>
</h1>
<p id="rfc.section.7.7.p.1">The following template specifies the IANA registration of a sieve environment item specified in this document: </p>
<p id="rfc.section.7.7.p.2">To: iana@iana.org <br> Subject: Registration of new Sieve environment item <br> Item name: imapemail <br> Description: The primary email address of the IMAP user that caused the action (the user identified by "imapuser").  <br> RFC number: this RFC <br> Contact address: <br> &#160; &#160; Barry Leiba &lt;barryleiba@computer.org&gt; </p>
<p id="rfc.section.7.7.p.3">This information should be added to the list of sieve environment item names given in the Environment extension <a href="#RFC5183">[RFC5183]</a>.  </p>
<h1 id="rfc.section.7.8">
<a href="#rfc.section.7.8">7.8.</a> <a href="#iana-7" id="iana-7">Registration of IMAP METADATA mailbox entry name</a>
</h1>
<p id="rfc.section.7.8.p.1">The following template specifies the IANA registration of an IMAP METADATA entry name specified in this document: </p>
<p id="rfc.section.7.8.p.2">To: iana@iana.org <br> Subject: IMAP METADATA Registration <br> Please register the following IMAP METADATA item: <br> [x] Entry &#160; &#160; &#160; &#160; &#160; [ ] Attribute <br> [x] Mailbox &#160; &#160; &#160; &#160; [ ] Server <br> Name: /IMAPSieve/Script <br> Description: This entry name is used to define mailbox metadata associated with IMAPSieve events for the associated mailbox.  Specifically, this specifies the Sieve script that will be invoked when IMAP events occur on the specified mailbox.  <br> Content-type: text/plain; charset=utf-8 <br> RFC number: this RFC <br> Contact person: Barry Leiba <br> Contact email: barryleiba@computer.org </p>
<p id="rfc.section.7.8.p.3">This information should be added to the list of IMAP METADATA item names given in the Metadata extension <a href="#RFC5464">[RFC5464]</a>.  </p>
<h1 id="rfc.section.7.9">
<a href="#rfc.section.7.9">7.9.</a> <a href="#iana-8" id="iana-8">Registration of IMAP METADATA server entry name</a>
</h1>
<p id="rfc.section.7.9.p.1">The following template specifies the IANA registration of an IMAP METADATA entry name specified in this document: </p>
<p id="rfc.section.7.9.p.2">To: iana@iana.org <br> Subject: IMAP METADATA Registration <br> Please register the following IMAP METADATA item: <br> [x] Entry &#160; &#160; &#160; &#160; &#160; [ ] Attribute <br> [ ] Mailbox &#160; &#160; &#160; &#160; [x] Server <br> Name: /IMAPSieve/Script <br> Description: This entry name is used to define metadata associated globally with IMAPSieve events for the associated server.  Specifically, this specifies the Sieve script that will be invoked when IMAP events occur on any mailbox in the server that does not have its own mailbox-level /IMAPSieve/Script entry.  <br> Content-type: text/plain; charset=utf-8 <br> RFC number: this RFC <br> Contact person: Barry Leiba <br> Contact email: barryleiba@computer.org </p>
<p id="rfc.section.7.9.p.3">This information should be added to the list of IMAP METADATA item names given in the Metadata extension <a href="#RFC5464">[RFC5464]</a>.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3501">[RFC3501]</b></td>
<td class="top">
<a>Crispin, M.</a>, "<a href="http://tools.ietf.org/html/rfc3501">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>", RFC 3501, March 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5228">[RFC5228]</b></td>
<td class="top">
<a>Guenther, P.</a> and <a>T. Showalter</a>, "<a href="http://tools.ietf.org/html/rfc5228">Sieve: An Email Filtering Language</a>", RFC 5228, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5464">[RFC5464]</b></td>
<td class="top">
<a>Daboo, C.</a>, "<a href="http://tools.ietf.org/html/rfc5464">The IMAP METADATA Extension</a>", RFC 5464, February 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5183">[RFC5183]</b></td>
<td class="top">
<a>Freed, N.</a>, "<a href="http://tools.ietf.org/html/rfc5183">Sieve Email Filtering: Environment Extension</a>", RFC 5183, May 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5232">[RFC5232]</b></td>
<td class="top">
<a>Melnikov, A.</a>, "<a href="http://tools.ietf.org/html/rfc5232">Sieve Email Filtering: Imap4flags Extension</a>", RFC 5232, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3502">[RFC3502]</b></td>
<td class="top">
<a>Crispin, M.</a>, "<a href="http://tools.ietf.org/html/rfc3502">Internet Message Access Protocol (IMAP) - MULTIAPPEND Extension</a>", RFC 3502, March 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3894">[RFC3894]</b></td>
<td class="top">
<a>Degener, J.</a>, "<a href="http://tools.ietf.org/html/rfc3894">Sieve Extension: Copying Without Side Effects</a>", RFC 3894, October 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4409">[RFC4409]</b></td>
<td class="top">
<a>Gellens, R.</a> and <a>J. Klensin</a>, "<a href="http://tools.ietf.org/html/rfc4409">Message Submission for Mail</a>", RFC 4409, April 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Non-Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5804">[RFC5804]</b></td>
<td class="top">
<a>Melnikov, A.</a> and <a>T. Martin</a>, "<a href="http://tools.ietf.org/html/rfc5804">A Protocol for Remotely Managing Sieve Scripts</a>", RFC 5804, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5435">[RFC5435]</b></td>
<td class="top">
<a>Melnikov, A.</a>, <a>Leiba, B.</a>, <a>Segmuller, W.</a> and <a>T. Martin</a>, "<a href="http://tools.ietf.org/html/rfc5435">Sieve Email Filtering: Extension for Notifications</a>", RFC 5435, January 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5293">[RFC5293]</b></td>
<td class="top">
<a>Degener, J.</a> and <a>P. Guenther</a>, "<a href="http://tools.ietf.org/html/rfc5293">Sieve Email Filtering: Editheader Extension</a>", RFC 5293, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5230">[RFC5230]</b></td>
<td class="top">
<a>Showalter, T.</a> and <a>N. Freed</a>, "<a href="http://tools.ietf.org/html/rfc5230">Sieve Email Filtering: Vacation Extension</a>", RFC 5230, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5429">[RFC5429]</b></td>
<td class="top">
<a>Stone, A.</a>, "<a href="http://tools.ietf.org/html/rfc5429">Sieve Email Filtering: Reject and Extended Reject Extensions</a>", RFC 5429, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5235">[RFC5235]</b></td>
<td class="top">
<a>Daboo, C.</a>, "<a href="http://tools.ietf.org/html/rfc5235">Sieve Email Filtering: Spamtest and Virustest Extensions</a>", RFC 5235, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4315">[RFC4315]</b></td>
<td class="top">
<a>Crispin, M.</a>, "<a href="http://tools.ietf.org/html/rfc4315">Internet Message Access Protocol (IMAP) - UIDPLUS extension</a>", RFC 4315, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-sieve-include">[I-D.ietf-sieve-include]</b></td>
<td class="top">
<a>Daboo, C</a> and <a>A Stone</a>, "<a href="http://tools.ietf.org/html/draft-ietf-sieve-include-06">Sieve Email Filtering: Include Extension</a>", Internet-Draft draft-ietf-sieve-include-06, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5703">[RFC5703]</b></td>
<td class="top">
<a>Hansen, T.</a> and <a>C. Daboo</a>, "<a href="http://tools.ietf.org/html/rfc5703">Sieve Email Filtering: MIME Part Tests, Iteration, Extraction, Replacement, and Enclosure</a>", RFC 5703, October 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Barry Leiba</span> 
	  <span class="n hidden">
		<span class="family-name">Leiba</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">Phone: +1 646 827 0648</span>

<span class="vcardline">EMail: <a href="mailto:barryleiba@computer.org">barryleiba@computer.org</a></span>

<span class="vcardline">URI: <a href="http://internetmessagingtechnology.org/">http://internetmessagingtechnology.org/</a></span>

  </address>
</div>

</body>
</html>