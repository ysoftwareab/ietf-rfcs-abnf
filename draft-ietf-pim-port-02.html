<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>A Reliable Transport Mechanism for PIM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="A Reliable Transport Mechanism for PIM">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">D. Farinacci</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">IJ. Wijnands</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">S. Venaas</td></tr>
<tr><td class="header">Expires: April 29, 2010</td><td class="header">cisco Systems</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">M. Napierala</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">AT&T Labs</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 26, 2009</td></tr>
</table></td></tr></table>
<h1><br />A Reliable Transport Mechanism for PIM<br />draft-ietf-pim-port-02.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 29, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This draft describes how a reliable transport mechanism can be 
	  used by the PIM protocol to optimize CPU and bandwidth resource 
	  utilization by eliminating periodic Join/Prune message transmission.
	  This draft proposes a modular extension to PIM to use either the TCP
	  or SCTP transport protocol.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements Notation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#TERMS">1.2.</a>&nbsp;
Definitions<br />
<a href="#anchor3">2.</a>&nbsp;
Protocol Overview<br />
<a href="#helloopts">3.</a>&nbsp;
New PIM Hello Options<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
PIM over the TCP Transport Protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
PIM over the SCTP Transport Protocol<br />
<a href="#anchor6">4.</a>&nbsp;
Establishing Transport Connections<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.1.</a>&nbsp;
TCP Connection Maintenance<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.2.</a>&nbsp;
Moving from PORT to Datagram Mode<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ondemand">4.3.</a>&nbsp;
On-demand versus Pre-configured Connections<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.4.</a>&nbsp;
Possible Hello Suppression Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">4.5.</a>&nbsp;
Avoiding a Pair of Connections between Neighbors<br />
<a href="#CH">5.</a>&nbsp;
Common Header Definition<br />
<a href="#anchor11">6.</a>&nbsp;
Explicit Tracking<br />
<a href="#anchor12">7.</a>&nbsp;
Multiple Instances and Address-Family Support<br />
<a href="#anchor13">8.</a>&nbsp;
Miscellany<br />
<a href="#anchor14">9.</a>&nbsp;
Security Considerations<br />
<a href="#IANA-Considerations">10.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor15">11.</a>&nbsp;
Contributors<br />
<a href="#anchor16">12.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">13.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">13.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">13.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The goals of this specification are:
</p>
<p></p>
<ul class="text">
<li>To create a simple incremental mechanism to provide reliable
	      PIM message delivery in PIM version 2.
</li>
<li>The reliable transport mechanism will be used for Join-Prune
	      message transmission only.
</li>
<li>Can be used for link-local transmission of Join-Prune messages
	      or multi-hop for use in a multicast VPN environments.
</li>
<li>When a router supports this specification, it need not
	      use the reliable transport mechanism with every neighbor. That is,
	      negotiation on a per neighbor basis will occur.
</li>
</ul>

<p>The explicit non-goals of this specification are:
</p>
<p></p>
<ul class="text">
<li>Changes to the PIM protocol machinery as defined in 
	      <a class='info' href='#RFC4601'>[RFC4601]<span> (</span><span class='info'>Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas, &ldquo;Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised),&rdquo; August&nbsp;2006.</span><span>)</span></a>. The reliable transport mechanism will
	      be used as a plugin layer so the PIM component does not know it
	      is really there.
</li>
<li>Provide support for automatic switching between Datagram mode
		and Transport mode. Two routers that are PIM neighbors on a
              link will always use Transport mode if and only if both have
              Transport mode enabled.
</li>
</ul>

<p>This document will specify how periodic JP message
	    transmission can be eliminated by using TCP 
	    <a class='info' href='#RFC0761'>[RFC0761]<span> (</span><span class='info'>Postel, J., &ldquo;DoD standard Transmission Control Protocol,&rdquo; January&nbsp;1980.</span><span>)</span></a> or SCTP <a class='info' href='#RFC4960'>[RFC4960]<span> (</span><span class='info'>Stewart, R., &ldquo;Stream Control Transmission Protocol,&rdquo; September&nbsp;2007.</span><span>)</span></a> as the 
	    reliable transport mechanism for JP messages.
</p>
<p>This specification enables greater scalability in
	    multicast deployment since the processing required for
	    protocol state maintenance can be reduced. In
	    addition to reduced processing on PIM enabled routers,
	    another important feature is the reduced join and leave
	    latency provided through a reliable transport.
</p>
<p>In many existing and emerging networks, particularly
            wireless and mobile satellite systems, link degradation due
            to weather, interference, and other impairments can result
            in temporary spikes in the packet loss. In these
            environments, periodic PIM joining can cause join latency
            when messages are lost causing a retransmission only 60
            seconds later. By applying a reliable transport, a lost join
            is retransmitted rapidly. Furthermore, when the last user
            leaves a multicast group, any lost prune is similarly
            repaired and the multicast stream is quickly removed from
            the wireless/satellite link. Without a reliable transport,
            the multicast transmission could otherwise continue until it
            timed out, roughly 3 minutes later.  As network resources
            are at a premium in many of these environments, rapid
            termination of the multicast stream is critical to
            maintaining efficient use of bandwidth.
</p>
<p>
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Notation</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
                "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
                and "OPTIONAL" in this document are to be interpreted as
                described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="TERMS"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Definitions</h3>

<p></p>
<blockquote class="text"><dl>
<dt>PORT: </dt>
<dd>
	        Stands for PIM Over Reliable Transport. Which is the short 
		form for 
		describing the mechanism in this specification where PIM
		can use the TCP or SCTP transport protocol.
</dd>
<dt>JP Message: </dt>
<dd>
	        An abbreviation for a Join-Prune message.
</dd>
<dt>Periodic JP: </dt>
<dd>
                A JP message sent periodically to refresh state.
</dd>
<dt>Incremental JP: </dt>
<dd>
	        A JP message sent as a result of state creation or deletion
                events. Also known as a triggered message.
</dd>
<dt>Native JP: </dt>
<dd>
                A JP message which is carried with an IP protocol type of 
		PIM.
</dd>
<dt>Reliable JP: </dt>
<dd>
                A JP message using TCP or SCTP for transport.
</dd>
<dt>Datagram Mode: </dt>
<dd>
	        The current procedures PIM uses by encapsulating JP messages 
		in IP
	        packets sent either triggered or periodically.
</dd>
<dt>PORT Mode: </dt>
<dd>
	        Procedures used by PIM defined in this specification for 
		sending JP messages over the TCP or SCTP transport layer.
</dd>
</dl></blockquote>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Protocol Overview</h3>

<p>PIM Over Reliable Transport (PORT) is a simple extension to
	  PIMv2 for refresh reduction of PIM JP messages. It involves sending 
          incremental rather than periodic JPs over a TCP/SCTP connection 
	  between PIM neighbors.
</p>
<p>This document does not restrict PORT to any specific link types.
	    It is however not recommended to use PORT on e.g. multi-access
	    LANs with many PIM neighbors. This due to the fact that there may
	    be a full mesh of PORT connections, and that there is no join
	    suppression.
</p>
<p>PORT can be incrementally used on a link between PORT
	  capable neighbors. Routers which are not PORT capable can continue
	  to use PIM in Datagram Mode. PORT capability is detected using
	  new PORT Capable PIM Hello Options.
</p>
<p>Once PORT is enabled on an interface and a PIM neighbor also
	  announces that it is PORT enabled, only Reliable JP messages will
	  be used. That is, only Reliable JP messages are accepted from, and
	  sent to, that particular neighbor. Native JP messages may still
	  be used for other neighbors.
</p>
<p>Reliable JP messages are sent using a TCP/SCTP connection.
	  When two PIM neighbors are PORT enabled, both for TCP or both
	  for SCTP, they will immediately, or on-demand, establish a
	  connection. If the connection goes down, they will again
	  immediately, or on-demand, try to reestablish the connection.
	  No JP messages (neither Native nor Reliable) are sent while there
	  is no connection.
</p>
<p>When PORT is used, only incremental JPs are sent from downstream
          routers to upstream routers. As such, downstream routers do not
          generate periodic JPs for routes which RPF to a PORT-capable 
	  neighbor.
</p>
<p>For Joins and Prunes, which are received over a TCP/SCTP 
	  connection, 
	  the upstream router does not start or maintain timers on the 
	  outgoing interface
          entry. Instead, it keeps track of which downstream routers have
          expressed interest. An interface is deleted from the outgoing
	  interface list
          only when all downstream routers on the interface, no longer wish to
          receive traffic.
</p>
<p>There is no change proposed for the PIM JP packet format. However,
          for JPs sent over TCP/SCTP connections, no IP Header is included. 
	  The 
	  message begins with the PIM common header, followed by the JP 
	  message. See section <a class='info' href='#CH'>Section&nbsp;5<span> (</span><span class='info'>Common Header Definition</span><span>)</span></a> for details on the common
	  header.
</p>
<a name="helloopts"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
New PIM Hello Options</h3>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
PIM over the TCP Transport Protocol</h3>

<p>Option Type: PIM-over-TCP Capable
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           Type = 27           |         Length = X + 8        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |    TCP Connection ID AFI      |          Reserved             |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                       TCP Connection ID                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         Interface ID                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div>
<p>Allocated Hello Type values can be found in 
	    <a class='info' href='#HELLO-OPT'>[HELLO&#8209;OPT]<span> (</span><span class='info'>IANA, &ldquo;PIM Hello Options,&rdquo; March&nbsp;2007.</span><span>)</span></a>.
</p>
<p>When a router is configured to use PIM over TCP on a given
          interface, it MUST include the PIM-over-TCP Capable hello option
	  in its Hello
          messages for that interface. If a router is explicitly disabled from
          using JP over TCP it MUST NOT include the PIM-over-TCP Capable hello
	  option
          in its Hello messages. When the router cannot setup a TCP 
	  connection, it will refrain from including this option.
</p>
<p>Implementations may provide a configuration option to enable or
          disable PORT functionality. We recommend that this capability be
          disabled by default.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Length: </dt>
<dd>
	    In bytes for the value part of the Type/Length/Value encoding.
	    Where X is 4 bytes if AFI of value 1 (IPv4) is used and 16
	    bytes when AFI of value 2 (IPv6) is used <a class='info' href='#AFI'>[AFI]<span> (</span><span class='info'>IANA, &ldquo;Address Family Indicators (AFIs),&rdquo; February&nbsp;2007.</span><span>)</span></a>.
</dd>
<dt>TCP Connection ID AFI: </dt>
<dd>
	    The AFI value to describe the address-family of the address of
	    the TCP Connection ID field. When this field is 0, a mechanism
	    outside the scope of this spec is used to obtain the addresses
	    used to establish the TCP connection.
</dd>
<dt>Reserved: </dt>
<dd>
	    Set to zero on transmission and ignored on receipt.
</dd>
<dt>TCP Connection ID: </dt>
<dd>
	    An IPv4 or IPv6 address used to establish the TCP connection.
	    This field is omitted (length 0) for the Connection ID AFI 0.
</dd>
<dt>Interface ID: </dt>
<dd>
            An Interface ID is used to associate the connection a JP message
            is received over with an interface which is added or removed from
            an oif-list. When unnumbered interfaces are used or when a single
            Transport connection is used for sending and receiving JP messages
            over multiple interfaces, the Interface ID is used convey the
            interface from JP message sender to JP message receiver.
            When a PIM router sets a locally generated value for the 
            Interface ID in the Hello TLV, it must send the same Interface ID
            value in all JP messages it is sending to the PIM neighbor.
</dd>
</dl></blockquote>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
PIM over the SCTP Transport Protocol</h3>

<p>Option Type: PIM-over-SCTP Capable
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           Type = 28           |         Length = X + 8        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |   SCTP Connection ID AFI      |          Reserved             |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                      SCTP Connection ID                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         Interface ID                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div>
<p>Allocated Hello Type values can be found in 
	    <a class='info' href='#HELLO-OPT'>[HELLO&#8209;OPT]<span> (</span><span class='info'>IANA, &ldquo;PIM Hello Options,&rdquo; March&nbsp;2007.</span><span>)</span></a>.
</p>
<p>When a router is configured to use PIM over SCTP on a given
          interface, it MUST include the PIM-over-SCTP Capable hello option
	  in its Hello
          messages for that interface. If a router is explicitly disabled from
          using JP over SCTP it MUST NOT include the PIM-over-SCTP Capable
	  hello option
	  in its Hello messages. When the router cannot setup a SCTP 
	  connection, it will refrain from including this option.
</p>
<p>Implementations may provide a configuration option to enable or
          disable PORT functionality. We recommend that this capability be
          disabled by default.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Length: </dt>
<dd>
	    In bytes for the value part of the Type/Length/Value encoding.
	    Where X is 4 bytes if AFI of value 1 (IPv4) is used and 16
	    bytes when AFI of value 2 (IPv6) is used <a class='info' href='#AFI'>[AFI]<span> (</span><span class='info'>IANA, &ldquo;Address Family Indicators (AFIs),&rdquo; February&nbsp;2007.</span><span>)</span></a>.
</dd>
<dt>SCTP Connection ID AFI: </dt>
<dd>
	    The AFI value to describe the address-family of the address of
	    the SCTP Connection ID field. When this field is 0, a mechanism
	    outside the scope of this spec is used to obtain the addresses
	    used to establish the SCTP connection.
</dd>
<dt>Reserved: </dt>
<dd>
	    Set to zero on transmission and ignored on receipt.
</dd>
<dt>SCTP Connection ID: </dt>
<dd>
	    An IPv4 or IPv6 address used to establish the SCTP connection.
	    This field is omitted (length 0) for the Connection ID AFI 0.
</dd>
<dt>Interface ID: </dt>
<dd>
            An Interface ID is used to associate the connection a JP message
            is received over with an interface which is added or removed from
            an oif-list. When unnumbered interfaces are used or when a single
            Transport connection is used for sending and receiving JP messages
            over multiple interfaces, the Interface ID is used convey the
            interface from JP message sender to JP message receiver.
            When a PIM router sets a locally generated value for the 
            Interface ID in the Hello TLV, it must send the same Interface ID
            value in all JP messages it is sending to the PIM neighbor.
</dd>
</dl></blockquote>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Establishing Transport Connections</h3>

<p>While a router interface is PORT enabled, a PIM-over-TCP
	  or a PIM-over-SCTP option is included in the PIM Hello messages
	  sent on that interface. When a router on a PORT-enabled
	  interface receives a Hello message containing a
	  PIM-over-TCP/PIM-over-SCTP Option from a new neighbor,
	  or an existing neighbor that did not previously include the
	  option, it switches to PORT mode for that particular neighbor.
</p>
<p>When a router switches to PORT mode for a neighbor, it stops
	  sending and accepting Native JP messages for that neighbor.
	  Any state from previous Native JP messages is left to expire
	  as normal. It will also attempt to establish a Transport connection
	  (TCP or SCTP) with the neighbor.
</p>
<p>When the router is using TCP it will compare
          the TCP Connection ID it announced in the PIM-over-TCP Capable
          Option with the TCP Connection ID in the Hello received from the
          neighbor. The router with the lower Connection ID will do an
          active Transport open to the neighbor Connection ID. The router
          with the higher Connection ID will do a passive Transport open.
	  An implementation may open connections only on-demand, in that
          case it may be that the neighbor with the higher Connection ID
          does the active open, see <a class='info' href='#ondemand'>Section&nbsp;4.3<span> (</span><span class='info'>On-demand versus Pre-configured Connections</span><span>)</span></a>.
	  Note that the source address of the active open must be the
          announced Connection ID.
</p>
<p>When the router is using SCTP, the IP address comparison
	  need not be done since the SCTP protocol can handle
	  call collision.
</p>
<p>If PORT is used both for IPv4 and IPv6, both IPv4 and IPv6
          PIM Hello messages are sent, both containing PORT Hello options.
          If two neighbors announce the same transport (TCP or SCTP) and
          the same Connection ID in the IPv4 and IPv6 Hello messages, then
          only one connection is established and is shared. Otherwise,
          two connections are established and are used separately.
</p>
<p>The PIM router that performs the active open initiates the 
          connection with a locally
          generated source transport port number and a well-known destination
          transport port number. The PIM router that performs the passive open
          listens on the well-known local transport port number and does not
          qualify the remote transport port number. See <a class='info' href='#CH'>Section&nbsp;5<span> (</span><span class='info'>Common Header Definition</span><span>)</span></a>
          for well-known port number assignment for PORT.
</p>
<p>When a Transport connection is established (or reestablished), the
	  two routers MUST
	  both send a full set of JP messages for which the other router
	  is the upstream neighbor. This is needed to ensure that the
	  upstream neighbor has the correct state. When moving from
	  Datagram mode, or when the connection has gone down, the router
	  cannot be sure that all the previous JP data was received by the
	  neighbor. Any state received while in Datagram mode that is not
	  refreshed, will be left to expire.
</p>
<p>When a Transport connection goes down, Join or Prune state that 
	  was
	  sent over the Transport connection is still retained. The neighbor 
	  should
	  not be considered down until the neighbor timer has expired. This
	  allows routers to do a control-plane switchover without disrupting
	  the network. If a Transport connection is reestablished before the
	  neighbor timer expires, the previous state is intact and any new
	  JP messages sent cause state to be created or removed (depending on
	  if it was a Join or Prune). If the neighbor timer does expire, 
	  only the upstream router, that has oif-list state, to the expired
	  downstream neighbor will need to clear state. A downstream
	  router, when an upstream neighboring router has expired, will
	  simply RPF to a new neighbor where it would trigger JP messages
	  like it would in <a class='info' href='#RFC4601'>[RFC4601]<span> (</span><span class='info'>Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas, &ldquo;Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised),&rdquo; August&nbsp;2006.</span><span>)</span></a>. It is required of a 
	  PIM router to clear 
	  its neighbor table for a neighbor who has timed out due to 
	  neighbor holdtime expiration.
</p>
<p>Note, since JP messages are sent over a Transport connection, no 
	  Prune Override or Join Suppression are possible for these 
	  messages.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
TCP Connection Maintenance</h3>

<p>TCP is designed to keep connections up indefinitely during
	    a period of network disconnection. If a PIM-over-TCP router fails,
	    the TCP connection may  stay up until  the neighbor 
	    actually reboots,  
	    and even then it  may continue to stay  up until you actually try 
	    to  send the neighbor some information. This is particularly
	    relevant to PIM, since the flow  of JPs might be in only one 
	    direction, and the downstream neighbor might never get any 
	    indication via TCP that the other end of the connection 
	    isn&#039;t really there.
</p>
<p>Most  applications using  TCP want  to detect  when a  neighbor
	    is no longer there, so that  the associated application state can  
	    be released.  Also, one wants to clean up the TCP state, and not 
	    keep half-open connections around indefinitely. This is 
	    accomplished by using PIM Hellos and by not introducing an 
	    application-specific or new PIM keep-alive message. Therefore,
	    when a GENID changes from a received PIM Hello message, and a
	    TCP connection is established or attempting to be established, 
	    the local side will tear down the connection and
	    attempt to reopen a new one for the new instance of the neighbor
	    coming up.  However, if the connection is shared by multiple
	    interfaces and the GENID changes only for one of them, then
	    there was not a full reboot and the connection is likely to
	    still work. In that case, the router should just resend all
	    JP state for that particular neighbor. This is similar to how
	    state is refreshed when GENID changes for PIM in
	    datagram mode.
</p>
<p>There may be situations where a router ignores some joins
	    or prunes. E.g. due to wrong RP information or receiving joins
	    on an RPF interface. A router may try to cache such messages
	    and apply them later if only a temporary error. It may however
	    also ignore the message, and later change its GENID for that
	    interface to make the
	    neighbor resend all state, including any that may have been
	    previously ignored. It is possible that one receives JP
	    messages for an interface/link that is down. As long as the
	    neighbor has not expired, we recommend processing those
	    messages as usual. If they are ignored, then the router should
	    change the GENID for that interface when it comes back up, in
	    order to get a full update.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Moving from PORT to Datagram Mode</h3>

<p>There may be situations where an administrator decides to
	    stop using PORT. If PORT is disabled on a router interface,
	    we start expiry timers with the respective neighbor holdtimes
	    as the initial values. Similarly if we receive a Hello message
	    without a PORT Capable option from a neighbor, we start expiry
	    timers for all JP state we have for that particular neighbor.
            The Transport connection should be shut down as soon as there are
            no more PIM neighborships using it. That is, for the connection
	    we have associated local and remote Connection IDs. When there
	    is no PIM neighbor with that particular remote connection ID on
	    any interface where we announce the local connection ID, the
	    connection should be shut down.
</p>
<a name="ondemand"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
On-demand versus Pre-configured Connections</h3>

<p>Transport connections could be established when they are needed
	    or when a router interface to other PIM neighbors has come up. The
	    advantage of on-demand Transport connection establishment 
	    is the reduction of router resources. Especially in the case
	    where there is no need for n^2 connections on a network interface
	    or MDT tunnel. The disadvantage is additional delay and queueing
            when a JP message needs to be sent and a Transport connection is
            not established yet.
</p>
<p>If a router interface has become operational and PIM neighbors
	    are learned from Hello messages, at that time, Transport 
	    connections may be established. The advantage is that a connection
	    is ready to transport data by the time a JP messages needs to be
	    sent. The disadvantage is there can be more connections 
	    established than needed. This can occur when there is a small set 
	    of RPF neighbors for the active distribution trees compared to
	    the total number of neighbors. Even when Transport connections
	    are pre-established before they are needed, a connection can go
	    down and an implementation will have to deal with an on-demand
	    situation.
</p>
<p>Note that for TCP, it is the router with the lower Connection
            ID that decides whether to open a connection immediately, or
	    on-demand. The router with the higher Connection ID should only
	    initiate a
            connection on-demand. That is, if it needs to send a JP message
            and there is no currently established connection.
</p>
<p>Therefore, this specification recommends but does not mandate 
	    the use of on-demand Transport connection establishment.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Possible Hello Suppression Considerations</h3>

<p>This specification indicates that a Transport connection cannot
	    be established until a Hello message is received. One reason for
	    this is to determine if the PIM neighbor supports this 
	    specification and the other is to determine the remote address
	    to use to establish the Transport connection.
</p>
<p>There are cases where it is desirable to suppress entirely the
	    transmission of Hello messages. In this case, it is outside the
	    scope of this document on how to determine if the PIM neighbor
	    supports this specification as well as an out-of-band (outside
	    of the PIM protocol) method to determine the remote address to
	    establish the Transport connection. 
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Avoiding a Pair of Connections between Neighbors</h3>

<p>To ensure there are not two connections between a pair of 
	    PIM neighbors, the following set of rules must be followed. Let
	    A and B be two PIM neighbors where A&#039;s Connection ID is 
	    numerically
	    smaller than B&#039;s Connection ID, and each is known to the
	    other as having a potential PIM adjacency relationship.
</p>
<p>At node A:
</p>
<p></p>
<ul class="text">
<li>If there is  already  an established  TCP  connection to  
	      B, on  the PIM-over-TCP  port,  then A  MUST  NOT  attempt  to 
	      establish  a  new connection to B.   Rather it uses the 
	      established  connection to send JPs to B.   (This is independent
	      of which  node initiated the connection.)
</li>
<li>If A has initiated a connection to B, but the connection is 
	      still in the process of being established, then A MUST refuse 
	      any connection on the PIM-over-TCP port from B.
</li>
<li>At any time when A does not have a connection to B which is 
	      either established or in the process of being established, A 
	      MUST accept connections from B.
</li>
</ul>

<p>At node B:
</p>
<p></p>
<ul class="text">
<li>If there is already an established TCP connection to A, on 
	      the PIM-over-TCP port, then B MUST NOT attempt to establish a 
	      new connection to A.  Rather it uses the established connection 
	      to send JPs to A.  (This is independent of which node initiated 
	      the connection.)
</li>
<li>If B has initiated a connection to A, but the connection is 
	      still in the process of being established, then if A initiates a
	      connection too, B MUST accept the connection initiated by A and 
	      must release the connection which it (B) initiated.
</li>
</ul>

<a name="CH"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Common Header Definition</h3>

<p>It may be desirable for scaling purposes to allow JP messages
	  from different PIM protocol instances to be sent over the same
	  Transport connection. Also, it may be desirable to have a set of JP
	  messages for one address-family sent over a Transport connection that
	  is established over a different address-family network layer.
</p>
<p>To be able to do this we need a common header that is inserted
	  and parsed for each PIM JP message that is sent on a Transport 
	  connection.
	  This common header will provide both record boundary and demux
	  points when sending over a stream protocol like Transport.
</p>
<p>Each JP message will have in front of it the following common
	  header in Type/Length/Value format. And multiple different TLV
	  types can be sent over the same Transport connection.
</p>
<p>To make sure PIM JP messages are delivered as soon as the TCP
	  transport layer receives the JP buffer, the TCP Push flag will be
	  set in all outgoing JP messages sent over a TCP transport
	  connection.
</p>
<p>PIM messages will be sent using destination TCP port number 
	  8471. When using SCTP as the reliable transport, destination
	  port number 8471 will be used. See 
          <a class='info' href='#IANA-Considerations'>Section&nbsp;10<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a> for IANA considerations.
</p>
<p>JP messages are error checked. This includes a bad PIM checksum,
	  illegal type fields, illegal addresses or a truncated message. If
	  any parsing errors
	  occur in a JP message, it is skipped, and we proceed processing any
          following TLVs.
</p>
<p>The current list of defined TLVs are:
</p>
<p>IPv4 JP Message
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |          Type = 1             |        Length = X + 16        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                        Reserved                       |I-Type |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         Interface ID                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                     Instance ID . . .                         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                     . . . Instance ID                         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                       PIMv2 JP Message                        |
       |                               .                               |
       |                               .                               |
       |                               .                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>
</p>
<p>The IPv4 JP common header is used when a JP message is sent
          that has all IPv4 encoded addresses in the PIM payload.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Length: </dt>
<dd>
	    In bytes for the value part of the Type/Length/Value encoding.
	    Where X is the number of bytes that make up the PIMv2 JP
	    message.
</dd>
<dt>I-Type: </dt>
<dd>
	    Defines the encoding and semantics of the Instance ID field.
	    Instance Type 0 means Instance ID is not used. Other values are
	    not defined in this specification.
</dd>
<dt>Interface ID: </dt>
<dd>
            This is the Interface ID from the Hello TLV, defined in this 
            specification, the PIM router is sending to the PIM neighbor.
            It indicates to the PIM neighbor what interface to associate the 
            JP Join or Prune with.
</dd>
<dt>Instance ID: </dt>
<dd>
	    This can be a VPN-ID. This field could also be a BGP Route Target 
	    (RT) or BGP Route Distinguisher (RD) as defined in 
	    <a class='info' href='#RFC4364'>[RFC4364]<span> (</span><span class='info'>Rosen, E. and Y. Rekhter, &ldquo;BGP/MPLS IP Virtual Private Networks (VPNs),&rdquo; February&nbsp;2006.</span><span>)</span></a>. This document only defines this for
	    Instance Type 0. For type 0 the field should be set to zero on
	    transmission and ignored on receipt.
</dd>
<dt>Reserved: </dt>
<dd>
	    Set to zero on transmission and ignored on receipt.
</dd>
<dt>PIMv2 JP Message: </dt>
<dd>
	    PIMv2 Join/Prune message and payload with no IP header in front
	    of it. As you can see from the packet format diagram, multiple
	    JP messages can go into one TCP/SCTP stream from the same or 
	    different Interface and Instance IDs.
</dd>
</dl></blockquote>

<p>IPv6 JP Message
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |          Type = 2             |        Length = X + 16        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                        Reserved                       |I-Type |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         Interface ID                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                     Instance ID . . .                         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                     . . . Instance ID                         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                       PIMv2 JP Message                        |
       |                               .                               |
       |                               .                               |
       |                               .                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>
</p>
<p>The IPv6 JP common header is used when a JP message is sent
          that has all IPv6 encoded addresses in the PIM payload.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Length: </dt>
<dd>
	    In bytes for the value part of the Type/Length/Value encoding.
	    Where X is the number of bytes that make up the PIMv2 JP
	    message.
</dd>
<dt>I-Type: </dt>
<dd>
	    Defines the encoding and semantics of the Instance ID field.
	    Instance Type 0 means Instance ID is not used. Other values are
	    not defined in this specification.
</dd>
<dt>Interface ID: </dt>
<dd>
            This is the Interface ID from the Hello TLV, defined in this 
            specification, the PIM router is sending to the PIM neighbor.
            It indicates to the PIM neighbor what interface to associate the 
            JP Join or Prune with.
</dd>
<dt>Instance ID: </dt>
<dd>
	    This can be a VPN-ID, BGP Route Target (RT) or BGP Route
	    Distinguisher (RD). This document only defines this for
	    Instance Type 0. For type 0 the field should be set to zero on
	    transmission and ignored on receipt.
</dd>
<dt>Reserved: </dt>
<dd>
	    Set to zero on transmission and ignored on receipt.
</dd>
<dt>PIMv2 JP Message: </dt>
<dd>
	    PIMv2 Join/Prune message and payload with no IP header in front
	    of it. As you can see from the packet format diagram, multiple
	    JP messages can go into one TCP/SCTP stream from the same or 
	    different Interface and Instance IDs.
</dd>
</dl></blockquote>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Explicit Tracking</h3>

<p>A router needs to keep track of which PORT neighbors express
	  interest in a route on a given interface. For non-PORT neighbors,
	  there is no change, one would usually just need to know if at
	  least one non-PORT neighbor is interested. For some link-types,
	  e.g. point-to-point, tracking neighbors is no different than
	  tracking interfaces. It may also be possible for an implementation
	  to treat different downstream neighbors as being on different
	  logical interfaces, even if they are on the same physical link.
	  Exactly how this is implemented and for which link types, is left
	  to the implementer.
</p>
<p>For (*,G) and (S,G) routes, the router starts forwarding 
	  traffic on an interface when a Join is received from a neighbor
	  on such an interface. When a non-PORT neighbor sends a Prune,
	  there is generally a small delay to see if another non-PORT
	  neighbor sends a Prune Override. If there is no override, one
	  should note that no non-PORT neighbor is interested. If no
	  PORT neighbors are interested, the interface can be removed
          from the oif-list. When a PORT neighbor sends a Prune, one
          removes the join state for that neighbor. If no other PORT or
          non-PORT neighbors are interested, the interface can be
          removed from the oif-list. In this case there is no Prune
	  Override, since the Prune was not visible to other neighbors.
</p>
<p>For (S,G,R) routes, the router needs to track Prune state on
	  the shared tree. It needs to know which PORT neighbors have sent
          prunes, and whether any non-PORT neighbors have sent prunes. The
          latter is exactly like when not using PORT. Normally one would
          forward a packet from a source S to a group G out on an interface
          if a (*,G)-join is received, but no (S,G,R)-prune. With PORT one
          needs to do this check per PORT neighbor. That is, the packet
          should be forwarded unless all PORT neighbors that have sent
          (*,G)-joins have also sent (S,G,R)-prunes and if a non-PORT
          neighbor has sent a (*,G)-join, whether there also is non-PORT
	  (S,G,R)-prune state.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Multiple Instances and Address-Family Support</h3>

<p>Multiple instances of the PIM protocol may be used to support
	multiple VPNs or within a VPN to support multiple address families. 
	Multiple instances can cause a multiplier effect on the number of
	router resources consumed. To be able to have an option to use
	router resources more efficiently, muxing JP messages over fewer
	Transport connections can be performed.
</p>
<p>There are two ways this can be accomplished, one using a common
	header format over a TCP connection and the other using multiple
        streams over a single SCTP connection.
</p>
<p>Using the Common Header format described previously in this
	specification, using different TLVs, both IPv4 and IPv6 based JP
	messages can be encoded within a Transport connection. Likewise,
	within a TLV, multiple occurrences of JP messages can occur and are
	tagged with an instance-ID so multiple JP messages for different
	VPNs can use a single Transport connection.
</p>
<p>When using SCTP multi-streaming, the common header is still used
	to convey instance information but an SCTP association is used, on
	a per-VPN basis, to send data concurrently for multiple instances. 
	When data is sent concurrently, head of line blocking, which can 
	occur when using TCP, is avoided.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Miscellany</h3>

<p>No changes expected in processing of other PIM messages like PIM
          Asserts, Grafts, Graft-Acks, Registers, and Register-Stops. This
	  goes for BSR and Auto-RP type messages as well.
</p>
<p>This extension is applicable only to PIM-SM, PIM-SSM and 
	  Bidir-PIM. It does not take requirements for PIM-DM into 
	  consideration.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Security Considerations</h3>

<p>Transport connections can be authenticated using HMACs MD5 and 
	  SHA-1 similar to use in BGP <a class='info' href='#RFC4271'>[RFC4271]<span> (</span><span class='info'>Rekhter, Y., Li, T., and S. Hares, &ldquo;A Border Gateway Protocol 4 (BGP-4),&rdquo; January&nbsp;2006.</span><span>)</span></a> and MSDP 
  	  <a class='info' href='#RFC3618'>[RFC3618]<span> (</span><span class='info'>Fenner, B. and D. Meyer, &ldquo;Multicast Source Discovery Protocol (MSDP),&rdquo; October&nbsp;2003.</span><span>)</span></a>.
</p>
<p>When using SCTP as the transport protocol, 
	  <a class='info' href='#RFC4895'>[RFC4895]<span> (</span><span class='info'>Tuexen, M., Stewart, R., Lei, P., and E. Rescorla, &ldquo;Authenticated Chunks for the Stream Control Transmission Protocol (SCTP),&rdquo; August&nbsp;2007.</span><span>)</span></a> can be used, on a per SCTP association basis
	  to authenticate PIM data.
</p>
<a name="IANA-Considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
IANA Considerations</h3>

<p>This specification makes use of a TCP port number
	  and a SCTP port number for the use of PIM-Over-Reliable-Transport
	  that has been allocated by IANA. It also makes use of IANA
	  PIM Hello Options allocations that should be made permanent. In
	  addition, a registry for PORT message types is requested. This
	  document defines two PORT message types. Type 1, IPv4 JP Message;
	  and Type 2, IPv6 JP Message.
	  
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Contributors</h3>

<p>In addition to the persons listed as authors, significant
	    contributions were provided by Apoorva Karan and
            Arjen Boers.
	  
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Acknowledgments</h3>

<p>The authors would like to give a special thank you and 
	    appreciation to Nidhi Bhaskar for her initial design and early
	    prototype of this idea.
</p>
<p>Appreciation goes to Randall Stewart for his authoritative
	    review and recommendation for using SCTP.
</p>
<p>Thanks also goes to the following for their ideas and 
	    commentary review of this specification, Mike McBride, 
	    Toerless Eckert, Yiqun Cai, Albert Tian, Suresh Boddapati, 
	    Nataraj Batchu, Daniel Voce, John Zwiebel, Yakov Rekhter,
	    Lenny Giuliano, Gorry Fairhurst and Sameer Gulrajani.
</p>
<p>A special thank you goes to Eric Rosen for his very detailed
	    review and commentary. Many of his comments are reflected as 
	    text in this specification.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC0761">[RFC0761]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc761">DoD standard Transmission Control Protocol</a>,&rdquo; RFC&nbsp;761, January&nbsp;1980 (<a href="http://www.rfc-editor.org/rfc/rfc761.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3618">[RFC3618]</a></td>
<td class="author-text">Fenner, B. and D. Meyer, &ldquo;<a href="http://tools.ietf.org/html/rfc3618">Multicast Source Discovery Protocol (MSDP)</a>,&rdquo; RFC&nbsp;3618, October&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3618.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4271">[RFC4271]</a></td>
<td class="author-text">Rekhter, Y., Li, T., and S. Hares, &ldquo;<a href="http://tools.ietf.org/html/rfc4271">A Border Gateway Protocol 4 (BGP-4)</a>,&rdquo; RFC&nbsp;4271, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4271.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4364">[RFC4364]</a></td>
<td class="author-text">Rosen, E. and Y. Rekhter, &ldquo;<a href="http://tools.ietf.org/html/rfc4364">BGP/MPLS IP Virtual Private Networks (VPNs)</a>,&rdquo; RFC&nbsp;4364, February&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4364.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4601">[RFC4601]</a></td>
<td class="author-text">Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas, &ldquo;<a href="http://tools.ietf.org/html/rfc4601">Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)</a>,&rdquo; RFC&nbsp;4601, August&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4601.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc4601.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4895">[RFC4895]</a></td>
<td class="author-text">Tuexen, M., Stewart, R., Lei, P., and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc4895">Authenticated Chunks for the Stream Control Transmission Protocol (SCTP)</a>,&rdquo; RFC&nbsp;4895, August&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4895.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4960">[RFC4960]</a></td>
<td class="author-text">Stewart, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4960">Stream Control Transmission Protocol</a>,&rdquo; RFC&nbsp;4960, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4960.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="AFI">[AFI]</a></td>
<td class="author-text">IANA, &ldquo;Address Family Indicators (AFIs),&rdquo; ADDRESS FAMILY NUMBERS&nbsp;http://www.iana.org/numbers.html, February&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="HELLO-OPT">[HELLO-OPT]</a></td>
<td class="author-text">IANA, &ldquo;PIM Hello Options,&rdquo; PIM-HELLO-OPTIONS per RFC4601&nbsp;http://www.iana.org/assignments/pim-hello-options, March&nbsp;2007.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dino Farinacci</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:dino@cisco.com">dino@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">IJsbrand Wijnands</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ice@cisco.com">ice@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stig Venaas</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:stig@cisco.com">stig@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Maria Napierala</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">AT&T Labs</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">200 Laurel Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Middletown, New Jersey  07748></td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mnapierala@att.com">mnapierala@att.com</a></td></tr>
</table>
</body></html>
