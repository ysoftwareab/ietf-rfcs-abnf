



SIPPING Working Group                                        A. Johnston
Internet-Draft                                                       MCI
Expires: January 19, 2006                                   H. Sinnreich
                                                                  Pulver
                                                                A. Clark
                                                   Telchemy Incorporated
                                                            A. Pendleton
                                                         Nortel Networks
                                                           July 18, 2005


                  SIP Service Quality Reporting Event
                 draft-johnston-sipping-rtcp-summary-07

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on January 19, 2006.

Copyright Notice

   Copyright (C) The Internet Society (2005).

Abstract

   This document defines a SIP event package that enables the collection
   and reporting of metrics that measure the quality for VoIP sessions
   using RTP [3] as their transport.  The definitions of the metrics



Johnston, et al.        Expires January 19, 2006                [Page 1]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


   used in the event package are based on RTCP Extended Reports [4] and
   RTCP [3].

Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  3
   2.  SIP Events Approach  . . . . . . . . . . . . . . . . . . . . .  3
   3.  Use of PUBLISH Method  . . . . . . . . . . . . . . . . . . . .  3
   4.  Event Package Formal Definition  . . . . . . . . . . . . . . .  4
     4.1   Event Package Name . . . . . . . . . . . . . . . . . . . .  4
     4.2   Event Package Parameters . . . . . . . . . . . . . . . . .  4
     4.3   SUBSCRIBE Bodies . . . . . . . . . . . . . . . . . . . . .  4
     4.4   Subscription Duration  . . . . . . . . . . . . . . . . . .  4
     4.5   NOTIFY Bodies  . . . . . . . . . . . . . . . . . . . . . .  4
     4.6   Voice Quality Event Syntax . . . . . . . . . . . . . . . .  5
     4.7   Recommended Values of Metrics  . . . . . . . . . . . . . . 10
     4.8   Message Flow and Syntax Examples . . . . . . . . . . . . . 10
       4.8.1   End of Session Report using PUBLISH  . . . . . . . . . 10
       4.8.2   Mid Session Threshold Violation using PUBLISH  . . . . 12
       4.8.3   End of Session Report using NOTIFY . . . . . . . . . . 14
       4.8.4   Mid Session Threshold Violation using NOTIFY . . . . . 16
     4.9   IANA Considerations  . . . . . . . . . . . . . . . . . . . 19
       4.9.1   SIP Event Package Registration . . . . . . . . . . . . 19
       4.9.2   application/rtcp-xr MIME Registration  . . . . . . . . 20
     4.10  Security Considerations  . . . . . . . . . . . . . . . . . 20
     4.11  Updates since -06  . . . . . . . . . . . . . . . . . . . . 21
     4.12  Updates since -04  . . . . . . . . . . . . . . . . . . . . 21
     4.13  Updates since -03  . . . . . . . . . . . . . . . . . . . . 21
     4.14  Contributors . . . . . . . . . . . . . . . . . . . . . . . 21
   5.  Informative References . . . . . . . . . . . . . . . . . . . . 22
       Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . 22
       Intellectual Property and Copyright Statements . . . . . . . . 24



















Johnston, et al.        Expires January 19, 2006                [Page 2]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


1.  Introduction

   This document defines a new SIP event package, rtcpxr, and a new MIME
   type, application/vq-rtcpxr, that enable the collection and reporting
   of metrics that measure quality for RTP [3] sessions.  The
   definitions of the metrics used in the event package are based on
   RTCP Extended Reports [4] and RTCP [3].  Monitoring of voice quality
   is believed to be the highest priority for usage of this mechanism
   and as such, the metrics in the event package are largely tailored
   for voice quality measurement.  However, the event package defined
   herein is designed to be extensible.  The event package explicitly
   provides parameters for reporting both the local and remote versions
   of these statistics.  Note that in multi-party calls, multiple
   reports will need to be generated either one for each endpoint or one
   for each session.  Configuration of usage of the event package is not
   covered in this document.  The event package can be used either with
   the SUBSCRIBE/NOTIFY methods or the PUBLISH method.  Message flow
   examples for both mechanims are provided in this document.

2.  SIP Events Approach

   This document defines a new SIP events package [6].  The intended
   methods to use for this event are PUBLISH [8] and SUBSCRIBE/NOTIFY.
   A SIP UA can provide voice quality reports using either of these
   methods to an entity which can make the information available to
   other applications.

3.  Use of PUBLISH Method

   A SIP UA that supports this specification may send the service
   quality metric reports using the PUBLISH method.  An application
   wishing to access this performance data maintains a State Agent for
   the svcqual event package.  The Request-URI of the PUBLISH method is
   set to the address of the resource for the VoIP application.  The
   PUBLISH method is sent to the normal default outbound proxy server of
   the SIP UA.

   The use of PUBLISH by this event is unique in that it does not
   require a soft or hard state to be maintained by either the Event
   Publication Agent (EPA) or the Event State Compositor (ESC).
   Futhermore the information that is presented by the svcqual event in
   a PUBLISH request is not expected to have an expiration, rather, the
   information is associated with the timestamps in the event itself.
   The primary intention of using PUBLISH for this event is reduction of
   transaction processing.

   The State Agent can use normal mechanisms for publication throttling
   or rejection of the information as described in the PUBLISH [8]



Johnston, et al.        Expires January 19, 2006                [Page 3]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


   specification.

4.  Event Package Formal Definition

4.1  Event Package Name

   This document defines a SIP Event Package as defined in RFC 3265 [2].
   The event-package token name for this package is:

   "vq-rtcpxr"

4.2  Event Package Parameters

   No event package parameters are defined.

4.3  SUBSCRIBE Bodies

   No SUBSCRIBE bodies are described by this specification.

4.4  Subscription Duration

   Subscriptions to this event package MAY range from minutes to weeks.
   Subscriptions in hours or days are more typical and are RECOMMENDED.
   The default subscription duration for this event package is one hour.

4.5  NOTIFY Bodies

   There are three notify bodies:  a session report, an interval session
   report, and a alert report.

   The session report is used for end of session reporting.  This can be
   generated when a voice media session terminates or when a media
   change occurs, such as a codec change or a session forks.  This
   report is intended to allow cumulative metric reporting.  The session
   reports will populate the metrics with values that are measured over
   the interval explicitly defined by the "start" and "stop" timestamps.

   The interval report is used for periodic or interval reporting.  This
   report is intended to capture short duration metric reporting.
   Interval reports will populate the metrics with values that are
   measured over the interval explicitly defined by the "start" and
   "stop" timestamps.

   The threshold report is used when voice quality degrades during a
   session.  The session report is also included in the alert report to
   provide all of the necessary diagnostic information.

   This specification defines a new MIME type application/vq-rtcpxr



Johnston, et al.        Expires January 19, 2006                [Page 4]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


   which is a text encoding of the RTCP and RTCP-XR statistics, with the
   addition of a few additional identifiers.

4.6  Voice Quality Event Syntax

   This section describes the syntax extensions required for event
   publication in SIP.  The formal syntax definitions described in this
   section are expressed in the Augmented BNF format [7] used in SIP
   [2], and contains references to elements defined therein.


     VoiceQualityReportEvent  =  AlertReport / SessionReport / IntervalReport


     SessionReport = "VQSessionReport" CLRF
                       LocalMetrics [CLRF RemoteMetrics]
                       [DialogID]

     IntervalReport = "VQIntervalReport" CLRF
                       LocalMetrics [CLRF RemoteMetrics]
                       [DialogID]

     LocalMetrics  = "LocalMetrics" COLON Metrics
     RemoteMetrics = "RemoteMetrics" COLON Metrics

     AlertReport   = "VQAlertReport" COLON
                            MetricType WSP Severity WSP Direction CLRF
                            "Metrics:" CLRF
                               Metrics
                               [CLRF "OtherDir Metrics:" CLRF Metrics]


     Metrics = TimeStamps CLRF
               SessionDescription CLRF
               CallID CLRF
               LocalAddr CRLF
               RemoteAddr CRLF
               [JitterBuffer CRLF]
               [PacketLoss CRLF]
               [BurstGapLoss CLRF]
               [Delay CLRF]
               [Signal CLRF]
               [QualityScores CLRF]
               *[Extension CLRF]

     ; timestamps are measured inaccordance with RFC 3611
     TimeStamps = "Timestamps" EQUAL StartTime WSP StopTime
     StartTime  = "START" COLON word



Johnston, et al.        Expires January 19, 2006                [Page 5]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


     StopTime   = "STOP" COLON word


     ; SessionDescription provides a shortened version of the
     ; session SDP but contains only the relevant parameters
     SessionDescription  = "SessionDesc" EQUAL
                             [PayloadType WSP]
                             [PayloadDesc WSP]
                             [SampleRate WSP]
                             [FrameDuration WSP]
                             [FrameOctets WSP]
                             [FramesPerPacket WSP]
                             [PacketLossConcealment WSP]
                             [SilenceSuppressionState]


     ; PayloadType provides the PT parameter used in the RTP packets
     ; i.e. the codec used for decoding received RTP packets
     ; It is recommended that IANA registered values are used where possible.
     PayloadType  = "PT" COLON (1*3DIGIT)

     ; PayloadDesc provides a text description of the codec in PayloadType
     PayloadDesc  = "PD" COLON word

     ; SampleRate provides the rate at which voice was sampled
     ; in the case of narrowband codecs, the value will typically be 8000
     SampleRate = "SR" COLON (1*5DIGIT)

     ; FrameDuration provides the amount of sampled voice, in milliseconds,
     ; contained in each frame.  This the same as Packetization Rate.
     FrameDuration = "FD" COLON (1*3DIGIT)

     ; FrameOctets provides the number of octets in each frame
     ; Used where FrameDuration is not available
     FrameOctets  = "FO" COLON (1*4DIGIT)

     ; FramesPerPacket provides the number of frames in each RTP packet
     FramesPerPacket = "FPP" COLON (1*2DIGIT)

     ; PacketLossConcealment indicates whether a PLC algorithm was
     ; or is being used for the session.  The values follow the same
     ; numbering convention as RFC 3611.  For more details,
     ; please refer to RFC 3611, RTCP XR
     ; 0 - unspecified
     ; 1 - disabled
     ; 2 - enhanced
     ; 3 - standard
     PacketLossConcealment  = "PLC" COLON ("0" / "1" / "2" / "3")



Johnston, et al.        Expires January 19, 2006                [Page 6]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


     ; SilenceSuppressionState indicates whether silence suppression,
     ; also known as Voice Activity Detection (VAD) is enabled.
     SilenceSuppressionState  = "SSUP" COLON ("on" / "off")

     ; CallId provides the call id from the SIP header
     CallID  =  "CID" COLON word [ "@" word ]

     ; LocalAddr provides the IP address, port and ssrc for the
     ; session from the perspective of the endpoint/UA which is
     ; sending the report
     LocalAddr   = "LocalAddr" COLON IPAddress WSP Port WSP Ssrc

     ; RemoteAddr provides the IP address, port and ssrc for the
     ; session from the perspective of the peer of the endpoint/UA
     ; that is sending the report
     RemoteAddr  = "RemoteAddr" COLON IPAddress WSP Port WSP Ssrc

     IPAddress   = "IP" COLON IPv6address / IPv4address
     Port        = "PORT" COLON 1*DIGIT
     Ssrc        = "SSRC" text / notAvail

     JitterBuffer = "JitterBuffer" EQUAL
                       [JitterBufferAdaptive WSP]
                       [JitterBufferRate WSP]
                       [JitterBufferNominal WSP]
                       [JitterBufferMax WSP]
                       [JitterBufferAbsMax]

     ; JitterBufferAdaptive indicates whether the jitter buffer in the
     ; endpoint is adaptive, static, or unknown.
     ; The values follow the same numbering convention as RFC 3611.
     ; For more details, please refer to that document.
     ; 0 - unknown
     ; 1 - reserved
     ; 2 - non-adaptive
     ; 3 - adaptive
     JitterBufferAdaptive  = "JBA" COLON ("0" / "1" / "2" / "3")

     ; JitterBuffer metric definitions are provided in RTCP XR, RFC 3611
     JitterBufferRate      = "JBR" COLON (1*2DIGIT) ;0-15
     JitterBufferNominal   = "JBN" COLON (1*5DIGIT) ;0-65535
     JitterBufferMax       = "JBM" COLON (1*5DIGIT) ;0-65535
     JitterBufferAbsMax    = "JBA" COLON (1*5DIGIT) ;0-65535

     ; PacketLoss metrics definitions are provided in RTCP XR, RFC 3611
     PacketLoss = "PacketLoss" EQUAL
                     [NetworkPacketLossRate]
                     [JitterBufferDiscardRate]



Johnston, et al.        Expires January 19, 2006                [Page 7]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


     NetworkPacketLossRate
        = "NLR" COLON (1*3(DIGIT) ["." 1*2(DIGIT)]) ;percentage
     JitterBufferDiscardRate
        = "JDR" COLON (1*3(DIGIT) ["." 1*2(DIGIT)]) ;percentage


     ; BurstGapLoss metrics definitions are provided in RTCP XR, RFC 3611
     BurstGapLoss = "BurstGapLoss" EQUAL
                          [BurstLossDensity WSP]
                          [BurstDuration WSP]
                          [GapLossDensity WSP]
                          [GapDuration WSP]
                          [MinimumGapThreshold]

     BurstLossDensity
        = "BLD" COLON (1*3(DIGIT) ["." 1*2(DIGIT)]) ;percentage
     BurstDuration
        = "BD" COLON (1*8DIGIT) ;0-3,600,000 -- milliseconds
     GapLossDensity
        = "GLD" COLON (1*3(DIGIT) ["." 1*2(DIGIT)]) ;percentage
     GapDuration
        = "GD" COLON (1*8DIGIT) ;0-3,600,000 -- milliseconds
     MinimumGapThreshold
        = "GMIN" COLON (1*3DIGIT) ;1-255


     Delay = "Delay" EQUAL
                 [RoundTripDelay WSP]
                 [EndSystemDelay WSP]
                 [OneWayDelay WSP]
                 [InterarrivalJitter WSP]
                 [MeanAbsoluteJitter]

     ; RoundTripDelay is recommended to be measured as defined in
     ; RTCP, RFC 3550.
     RoundTripDelay     = "RTD" COLON (1*5DIGIT) ;0-65535

     ; EndSystemDelay metric is provided in RTCP XR, RFC 3611
     EndSystemDelay     = "ESD" COLON (1*5DIGIT) ;0-65535

     ; OneWayDelay is recommended to be measured according to
     ; recommendations provided by the IPPM working group but may be
     ; based on alternative measurement recommendations
     OneWayDelay        = "OWD" COLON (1*5DIGIT) ;0-65535

     ; Interarrival Jitter is recommended to be measured as defined
     ; in RTCP, RFC 3550, but may be based on alternatives
     InterarrivalJitter = "IAJ" COLON (1*5DIGIT) ;0-65535



Johnston, et al.        Expires January 19, 2006                [Page 8]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


     ; Mean Absolute Jitter is recommended to be measured as defined
     ; by ITU-T G.1020 where it is known as MAPDV
     MeanAbsoluteJitter = "MAJ" COLON (1*5DIGIT)

     ; Signal metrics definitions are provided in RTCP XR, RFC 3611
     Signal = "Signal" EQUAL
                  [SignalLevel WSP]
                  [NoiseLevel WSP]
                  [ResidualEchoReturnLoss]

     SignalLevel = "SL" COLON (["-"] 1*2DIGIT)
     NoiseLevel  = "NL" COLON (["-"] 1*2DIGIT)
     ResidualEchoReturnLoss = "RERL" COLON (1*3DIGIT)


     ; Voice Quality estimation metrics
     ; The definition of these metrics are provided in RTCP XR, RFC 3611, and
     ; the new High Resolution proposal, RTCP HR.

     ; Each quality estmiate has an associated, optional algorithm parameter.
     ; This field permits the implementation to use a variety of different
     ; calculation methods for each type of metric
     QualityEstimates  = "QualityEst" EQUAL
                          [ListeningQualityR WSP]
                          [RLQEstAlg WSP]
                          [ConversationalQualityR WSP]
                          [RCQEstAlg WSP]
                          [ExternalR-In WSP]
                          [ExtRInEstAlg WSP]
                          [ExternalR-Out WSP]
                          [ExtROutEstAlg WSP]
                          [MOS-LQ WSP]
                          [MOSLQEstAlg WSP]
                          [MOS-CQ WSP]
                          [MOSCQEstAlg WSP]
                          [QoEEstAlg]

     ListeningQualityR = "RLQ" COLON (1*3DIGIT) ; 0 - 120
     RLQEstAlg = "RLQEstAlg" COLON word ; "PESQ", "G.107", or other

     ConversationalQualityR = "RCQ" (COLON 1*3DIGIT) ; 0 - 120
     RCQEstAlg = "RCQEstAlg" COLON word ; "PESQ", "G.107", or other

     ExternalR-In = "EXTRI" COLON (1*3DIGIT) ; 0 - 120
     ExtRInEstAlg = "ExtRIEstAlg" COLON word ; "PESQ", "G.107", or other

     ExternalR-Out = "EXTRO" COLON (1*3DIGIT) ; 0 - 120
     ExtRInEstAlg = "ExtROEstAlg" COLON word ; "PESQ", "G.107", or other



Johnston, et al.        Expires January 19, 2006                [Page 9]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


     MOS-LQ = "MOSLQ" COLON (DIGIT ["." 1*2DIGIT]) ; 0.0 - 4.9
     MOSLQEstAlg = "MOSLQEstAlg" COLON word ; "PESQ", "G.107", or other

     MOS-CQ = "MOSCQ" COLON (DIGIT ["." 1*2DIGIT]  ; 0.0 - 4.9
     MOSCQEstAlg = "MOSCQEstAlg" COLON word ; "PESQ", "G.107", or other

     ; alternative to the separate estimation algorithms where the same algorithm
     ; is used for all of the measurements
     QoEEstAlg = "QoEEstAlg'

     DialogID  = "DialogID" COLON callid *(SEMI did-parm)
     did-parm  = to-tag / from-tag / generic-param
     callid    = *(token)
     to-tag    = "to-tag" EQUAL token
     from-tag  = "from-tag" EQUAL token

     ; MetricType provides the metric on which a notification of
     ; threshold violation was based.  The more commonly used metrics
     ; for alerting purposes are included here explicitly and the
     ; token parameter allows for extension
     MetricType = "Type" COLON "RLQ" / "RCQ" / "EXTR" /
                               "MOSLQ" / "MOSCQ" /
                               "BD" / "NLR" / "JDR" /
                               "RTD" / "ESD" / "IAD" /
                               "RERL" / token

     Direction = "Dir" COLON "local" / "remote"

     Severity  = "Severity" COLON "Warning" / "Critical" /
                                          "Clear"

     Extension = *(token)




4.7  Recommended Values of Metrics

4.8  Message Flow and Syntax Examples

   This section shows a number of message flow examples showing how the
   event package works.

4.8.1  End of Session Report using PUBLISH

        Alice            Proxy/Registrar        Collector               Bob
          |                    |                    |                    |
          |                    |                    |                    |



Johnston, et al.        Expires January 19, 2006               [Page 10]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


          | REGISTER Allow-Event:vq-rtcpxr  F1      |                    |
          |------------------->|                    |                    |
          |      200 OK F2     |                    |                    |
          |<-------------------|                    |                    |
          |      INVITE F3     |                    |                    |
          |------------------->|                    |                    |
          |                    |      INVITE F4     |                    |
          |                    |---------------------------------------->|
          |                    |      200 OK F5     |                    |
          |                    |<----------------------------------------|
          |     200 OK F6      |                    |                    |
          |<-------------------|                    |                    |
          |        ACK F7      |                    |                    |
          |------------------->|                    |                    |
          |                    |      ACK F8        |                    |
          |                    |---------------------------------------->|
          |        RTP         |                    |                    |
          |<============================================================>|
          |        RTCP        |                    |                    |
          |<============================================================>|
          |                    |                    |                    |
          |    BYE F9          |                    |                    |
          |------------------->|      BYE F10       |                    |
          |                    |---------------------------------------->|
          |                    |     200 OK F11     |                    |
          |                    |<----------------------------------------|
          |     200 OK F12     |                    |                    |
          |<-------------------|                    |                    |
          |  PUBLISH Event:vq-rtcpxr F13            |                    |
          |------------------->|                    |                    |
          |                    | PUBLISH Event:vq-rtcpxr F14             |
          |                    |------------------->|                    |
          |                    |     200 OK F15     |                    |
          |                    |<-------------------|                    |
          |     200 OK F16     |                    |                    |
          |<-------------------|                    |                    |


      Figure 1. End of session report sent after session termination.


      In the call flow depicted in Figure 1, the following message format
      is sent in F13:


          PUBLISH sip:collector@example.com SIP/2.0
          Via: SIP/2.0/UDP pc22.example.com;branch=z9hG4bK3343d7
          Max-Forwards: 70



Johnston, et al.        Expires January 19, 2006               [Page 11]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


          To: <sip:proxy@example.com>
          From: Alice <sip:alice@example.com>;tag=a3343df32
          Call-ID: 1890463548@alice.chicago.com
          CSeq: 4331 PUBLISH
          Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
           SUBSCRIBE, NOTIFY
          Event: vq-rtcpxr
          Accept: application/sdp, message/sipfrag
          Content-Type: application/vq-rtcpxr
          Content-Length: ...

          VQSessionReport
          LocalMetrics:
          TimeStamps=START:10012004.18.23.43 STOP:10012004.18.26.02
          SessionDesc=PT:0 PD:G.711 SR:8000 FD:20 FPP:2 PLC:3 SSUP:on
          CallID=1890463548@alice.uac.chicago.com
          LocalAddr=IP:10.10.1.100 PORT: 5000 SSRC:fjuekdn393k
          RemoteAddr=IP:11.1.1.150 PORT:5002 SSRC:r3k3k99weid
          JitterBuffer=JBA:3 JBR:2 JBN:40 JBM:80 JBA:120
          PacketLoss=NLR:5.0 JDR:2.0
          BurstGapLoss=BLD:0 BD:0 GLD:2.0 GD:500
          Delay=RTD:200 ESD:140 IAJ:2
          Signal=SL:2 NL:10 RERL:14
          QualityEst=RLQ:90 RCQ:85 EXTRI:90 MOSLQ:3.4 MOSCQ:3.3 QoEEstAlg:VQMonv2.1
          RemoteMetrics:
          TimeStamps=START:10012004.18.23.43 stop:10012004.18.26.02
          SessionDesc=PT:0 PD:G.711 SR:8000 FD:20 FPP:2 PLC:3 SSUP:on
          CallID=1890463548@alice.uac.chicago.com
          LocalAddr=IP:11.1.1.150 PORT:5002 SSRC:r3k3k99weid
          RemoteAddr=IP:10.10.1.100 PORT:5000 SSRC:fjuekdn393k
          JitterBuffer=JBA:3 JBR:2 JBN:40 JBM:80 JBA:120
          PacketLoss=NLR:5.0 JDR:2.0
          BurstGapLoss=BLD:0 BD:0 GLD:2.0 GD:500
          Delay=RTD:200 ESD:140 IAJ:2
          Signal=SL:2 NL:10 RERL:0
          QualityEst=RLQ:90 RCQ:85 EXTRI:90 MOSLQ:3.4 MOSCQ:3.3 QoEEstAlg:VQMonv2.1
          DialogID:38419823470834;to-tag=8472761;from-tag=9123dh311


4.8.2  Mid Session Threshold Violation using PUBLISH


     Alice            Proxy/Registrar        Collector               Bob
       |                    |                    |                    |
       |      INVITE F1     |                    |                    |
       |------------------->|                    |                    |
       |                    |      INVITE F2     |                    |
       |                    |---------------------------------------->|



Johnston, et al.        Expires January 19, 2006               [Page 12]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


       |                    |      200 OK F3     |                    |
       |                    |<----------------------------------------|
       |     200 OK F4      |                    |                    |
       |<-------------------|                    |                    |
       |        ACK F5      |                    |                    |
       |------------------->|                    |                    |
       |                    |      ACK F6        |                    |
       |                    |---------------------------------------->|
       |        RTP         |                    |                    |
       |<============================================================>|
       |        RTCP        |                    |                    |
       |<============================================================>|
       |  PUBLISH Event:vq-rtcpxr F7             |                    |
       |------------------->|                    |                    |
       |                    | PUBLISH Event:vq-rtcpxr F8              |
       |                    |------------------->|                    |
       |                    |     200 OK F9      |                    |
       |                    |<-------------------|                    |
       |     200 OK F10     |                    |                    |
       |<-------------------|                    |                    |
       |                    |                    |                    |
       |      BYE F12       |                    |                    |
       |------------------->|      BYE F13       |                    |
       |                    |---------------------------------------->|
       |                    |     200 OK F14     |                    |
       |                    |<----------------------------------------|
       |     200 OK F15     |                    |                    |
       |<-------------------|                    |                    |


      Figure 2. Mid-session threshold report message flow

      In the message flow depicted in Figure 2, the following message format
      is sent in F7:

          PUBLISH sip:collector@chicago.example.com SIP/2.0
          Via: SIP/2.0/UDP pc22.example.com;branch=z9hG4bK3343d7
          Max-Forwards: 70
          To: <sip:collector@example.com>
          From: Alice <sip:alice@example.com>;tag=a3343df32
          Call-ID: 1890463548@alice.chicago.com
          CSeq: 4321 PUBLISH
          Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
           SUBSCRIBE, NOTIFY
          Event: vq-rtcpxr
          Accept: application/sdp, message/sipfrag
          Content-Type: application/vq-rtcpxr
          Content-Length: ...



Johnston, et al.        Expires January 19, 2006               [Page 13]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


          VQAlertReport: Type:RLQ Severity:Warning Dir:local
          Metrics:
          TimeStamps=START:10012004.19.01.04 STOP:10012004.19.01.52
          SessionDesc=PT:0 PD:G.711 SR:8000 FD:20 FPP:2 PLC:3 SSUP:on
          CallID=1890463548@alice.chicago.com
          LocalAddr=IP:10.10.1.100 PORT: 5000 SSRC:fjuekdn393k
          RemoteAddr=IP:11.1.1.150 PORT:5002 SSRC:r3k3k99weid
          JitterBuffer=JBA:3 JBR:2 JBN:40 JBM:80 JBA:120
          PacketLoss=NLR:5.0 JDR:2.0
          BurstGapLoss=BLD:0 BD:0 GLD:2.0 GD:500
          Delay=RTD:200 ESD:140 IAJ:2
          Signal=SL:2 NL:10 RERL:14
          QualityEst=RLQ:90 RCQ:85 EXTR:90 MOSLQ:3.4 MOSCQ:3.3 QoEEstAlg:VQMonv2.1
          OtherDir Metrics:
          TimeStamps=START:10012004.18.23.43 stop:10012004.18.26.02
          SessionDesc=PT:0 PD:G.711 SR:8000 FD:20 FPP:2 PLC:3 SSUP:on
          CallID=1890463548@alice.uac.chicago.com
          LocalAddr=IP:11.1.1.150 PORT:5002 SSRC:r3k3k99weid
          RemoteAddr=IP:10.10.1.100 PORT:5000 SSRC:fjuekdn393k
          JitterBuffer=JBA:3 JBR:2 JBN:40 JBM:80 JBA:120
          PacketLoss=NLR:5.0 JDR:2.0
          BurstGapLoss=BLD:0 BD:0 GLD:2.0 GD:500
          Delay=RTD:200 ESD:140 IAJ:2
          Signal=SL:2 NL:10 RERL:0
          QualityEst=RLQ:90 RCQ:85 EXTRI:90 MOSLQ:3.4 MOSCQ:3.3 QoEEstAlg:VQMonv2.1
          DialogID:38419823470834;to-tag=8472761;from-tag=9123dh3111

   This alert indicates that the quality of the call in progress,
   as measured by the Listening Quality R metric, has degraded to an
   unacceptable level.  For futher troubleshooting of the problem, all
   metrics are populated, including the remote values which were obtained
   via RTCP XR (RFC 3611) in the endpoints.



4.8.3  End of Session Report using NOTIFY

      Alice            Proxy/Registrar        Collector               Bob
          |                    |                    |                    |
          |                    |                    |                    |
          | REGISTER Allow-Event:vq-rtcpxr F1       |                    |
          |------------------->|                    |                    |
          |      200 OK F2     |                    |                    |
          |<-------------------|                    |                    |
          |                    |  SUBSCRIBE Event:vq-rtcpxr F3           |
          |                    |<-------------------|                    |
          | SUBSCRIBE Event:vq-rtcpxr F4            |                    |
          |<-------------------|                    |                    |



Johnston, et al.        Expires January 19, 2006               [Page 14]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


          |     200 OK F5      |                    |                    |
          |------------------->|                    |                    |
          |                    |   200 OK F6        |                    |
          |                    |------------------->|                    |
          |      INVITE F7     |                    |                    |
          |------------------->|                    |                    |
          |                    |      INVITE F8     |                    |
          |                    |---------------------------------------->|
          |                    |      200 OK F9     |                    |
          |                    |<----------------------------------------|
          |     200 OK F10     |                    |                    |
          |<-------------------|                    |                    |
          |        ACK F11     |                    |                    |
          |------------------->|                    |                    |
          |                    |      ACK F12       |                    |
          |                    |---------------------------------------->|
          |        RTP         |                    |                    |
          |<============================================================>|
          |        RTCP, RTCP XR                    |                    |
          |<============================================================>|
          |                    |                    |                    |
          |    BYE F13         |                    |                    |
          |------------------->|      BYE F14       |                    |
          |                    |---------------------------------------->|
          |                    |     200 OK F15     |                    |
          |                    |<----------------------------------------|
          |     200 OK F16     |                    |                    |
          |<-------------------|                    |                    |
          |  NOTIFY Event:vq-rtcpxr F17             |                    |
          |------------------->|                    |                    |
          |                    | NOTIFY Event:vq-rtcpxr F18              |
          |                    |------------------->|                    |
          |                    |     200 OK F19     |                    |
          |                    |<-------------------|                    |
          |     200 OK F20     |                    |                    |
          |<-------------------|                    |                    |

      Figure 3. Summary report with NOTIFY sent after session termination.


      In the call flow depicted in Figure 3, the following message format
      is sent in F17:

          NOTIFY sip:collector@example.com SIP/2.0
          Via: SIP/2.0/UDP pc22.example.com;branch=z9hG4bK3343d7
          Max-Forwards: 70
          To: <sip:collector@example.com>;tag=43524545
          From: Alice <sip:alice@example.com>;tag=a3343df32



Johnston, et al.        Expires January 19, 2006               [Page 15]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


          Call-ID: 1890463548@alice.chicago.com
          CSeq: 4321 NOTIFY
          Contact: <sip:alice@pc22.example.com>
          Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
          SUBSCRIBE, NOTIFY
          Event: vq-rtcpxr
          Accept: application/sdp, message/sipfrag
          Subscription-State: active;expires=3600
          Content-Type: application/vq-rtcpxr
          Content-Length: ...

          VQSessionReport
          LocalMetrics:
          TimeStamps=START:10012004.18.23.43 STOP:10012004.18.26.02
          SessionDesc=PT:0 PD:G.711 SR:8000 FD:20 FPP:2 PLC:3  SSUP:on
          CallID=1890463548@alice.uac.chicago.com
          LocalAddr=IP:10.10.1.100 PORT: 5000 SSRC:fjuekdn393k
          RemoteAddr=IP:11.1.1.150 PORT:5002 SSRC:r3k3k99weid
          JitterBuffer=JBA:3 JBR:2 JBN:40 JBM:80 JBA:120
          PacketLoss=NLR:5.0 JDR:2.0
          BurstGapLoss=BLD:0 BD:0 GLD:2.0 GD:500
          Delay=RTD:200 ESD:140 IAJ:2
          Signal=SL:2 NL:10 RERL:14
          QualityEst=RLQ:90 RCQ:85 EXTRI:90 MOSLQ:3.4 MOSCQ:3.3 QoEEstAlg:VQMonv2.1
          RemoteMetrics:
          TimeStamps=START:10012004.18.23.43 stop:10012004.18.26.02
          SessionDesc=PT:0 PD:G.711 SR:8000 FD:20 FPP:2 PLC:3 SSUP:on
          CallID=1890463548@alice.uac.chicago.com
          LocalAddr=IP:11.1.1.150 PORT:5002 SSRC:r3k3k99weid
          RemoteAddr=IP:10.10.1.100 PORT:5000 SSRC:fjuekdn393k
          JitterBuffer=JBA:3 JBR:2 JBN:40 JBM:80 JBA:120
          PacketLoss=NLR:5.0 JDR:2.0
          BurstGapLoss=BLD:0 BD:0 GLD:2.0 GD:500
          Delay=RTD:200 ESD:140 IAJ:2
          Signal=SL:2 NL:10 RERL:0
          QualityEst=RLQ:90 RCQ:85 EXTRI:90 MOSLQ:3.4 MOSCQ:3.3 QoEEstAlg:VQMonv2.1
          DialogID:38419823470834;to-tag=8472761;from-tag=9123dh31111



4.8.4  Mid Session Threshold Violation using NOTIFY


        Alice            Proxy/Registrar        Collector               Bob
          |                    |                    |                    |
          |                    |                    |                    |
          | REGISTER Allow-Event:vq-rtcpxr F1       |                    |
          |------------------->|                    |                    |



Johnston, et al.        Expires January 19, 2006               [Page 16]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


          |      200 OK F2     |                    |                    |
          |<-------------------|                    |                    |
          |                    |  SUBSCRIBE Event:vq-rtcpxr F3           |
          |                    |<-------------------|                    |
          | SUBSCRIBE Event:vq-rtcpxr F4            |                    |
          |<-------------------|                    |                    |
          |     200 OK F5      |                    |                    |
          |------------------->|                    |                    |
          |                    |   200 OK F6        |                    |
          |                    |------------------->|                    |
          |      INVITE F7     |                    |                    |
          |------------------->|                    |                    |
          |                    |      INVITE F8     |                    |
          |                    |---------------------------------------->|
          |                    |      200 OK F9     |                    |
          |                    |<----------------------------------------|
          |     200 OK F10     |                    |                    |
          |<-------------------|                    |                    |
          |        ACK F11     |                    |                    |
          |------------------->|                    |                    |
          |                    |      ACK F12       |                    |
          |                    |---------------------------------------->|
          |        RTP         |                    |                    |
          |<============================================================>|
          |        RTCP, RTCP XR                    |                    |
          |<============================================================>|
          |  NOTIFY Event:vq-rtcpxr F17             |                    |
          |------------------->|                    |                    |
          |                    | NOTIFY Event:vq-rtcpxr F18              |
          |                    |------------------->|                    |
          |                    |     200 OK F19     |                    |
          |                    |<-------------------|                    |
          |     200 OK F20     |                    |                    |
          |<-------------------|                    |                    |
          |                    |                    |                    |
          |    BYE F13         |                    |                    |
          |------------------->|      BYE F14       |                    |
          |                    |---------------------------------------->|
          |                    |     200 OK F15     |                    |
          |                    |<----------------------------------------|
          |     200 OK F16     |                    |                    |
          |<-------------------|                    |                    |
          |  NOTIFY Event:vq-rtcpxr F17             |                    |
          |------------------->|                    |                    |
          |                    | NOTIFY Event:vq-rtcpxr F18              |
          |                    |------------------->|                    |
          |                    |     200 OK F19     |                    |
          |                    |<-------------------|                    |



Johnston, et al.        Expires January 19, 2006               [Page 17]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


          |     200 OK F20     |                    |                    |
          |<-------------------|                    |                    |

      Figure 4. Summary report sent during session with threshold report.

     In the call flow depicted in Figure 4, the following message format
     is sent in F17:

          NOTIFY sip:collector@chicago.example.com SIP/2.0
          Via: SIP/2.0/UDP pc22.example.com;branch=z9hG4bK3343d7
          Max-Forwards: 70
          To: <sip:collector@example.com>
          From: Alice <sip:alice@example.com>;tag=a3343df32
          Call-ID: 1890463548@alice.chicago.com
          CSeq: 4321 PUBLISH
          Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER,
           SUBSCRIBE, NOTIFY
          Event: vq-rtcpxr
          Accept: application/sdp, message/sipfrag
          Content-Type: application/vq-rtcpxr
          Content-Length: ...

          VQAlertReport: Type:RLQ Severity:Warning Dir:local
          Metrics:
          TimeStamps=START:10012004.19.01.04 STOP:10012004.19.01.52
          SessionDesc=PT:0 PD:G.711 SR:8000 FD:20 FPP:2 PLC:3 SSUP:on
          CallID=1890463548@alice.chicago.com
          LocalAddr=IP:10.10.1.100 PORT: 5000 SSRC:fjuekdn393k
          RemoteAddr=IP:11.1.1.150 PORT:5002 SSRC:r3k3k99weid
          JitterBuffer=JBA:3 JBR:2 JBN:40 JBM:80 JBA:120
          PacketLoss=NLR:5.0 JDR:2.0
          BurstGapLoss=BLD:0 BD:0 GLD:2.0 GD:500
          Delay=RTD:200 ESD:140 IAJ:2
          Signal=SL:2 NL:10 RERL:14
          QualityEst=RLQ:90 RCQ:85 EXTRI:90 MOSLQ:3.4 MOSCQ:3.3 QoEEstAlg:VQMonv2.1
          OtherDir Metrics:
          TimeStamps=START:10012004.18.23.43 stop:10012004.18.26.02
          SessionDesc=PT:0 PD:G.711 SR:8000 FD:20 FPP:2 PLC:3 SSUP:on
          CallID=1890463548@alice.uac.chicago.com
          LocalAddr=IP:11.1.1.150 PORT:5002 SSRC:r3k3k99weid
          RemoteAddr=IP:10.10.1.100 PORT:5000 SSRC:fjuekdn393k
          JitterBuffer=JBA:3 JBR:2 JBN:40 JBM:80 JBA:120
          PacketLoss=NLR:5.0 JDR:2.0
          BurstGapLoss=BLD:0 BD:0 GLD:2.0 GD:500
          Delay=RTD:200 ESD:140 IAJ:2
          Signal=SL:2 NL:10 RERL:0
          QualityEst=RLQ:90 RCQ:85 EXTRI:90 MOSLQ:3.4 MOSCQ:3.3 QoEEstAlg:VQMonv2.1
          DialogID:38419823470834;to-tag=8472761;from-tag=9123dh3111



Johnston, et al.        Expires January 19, 2006               [Page 18]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


      This alert indicates that the quality of the call in progress, as calculated
      using the Listening Quality transmission rating R , has degraded to an
      unacceptable level.  For futher troubleshooting of the problem, all metrics
      are populated, including the remote values which were obtained via RTCP XR [4]
      in the endpoints..



4.9  IANA Considerations

   This document registers a new SIP Event Package and a new MIME type.

4.9.1  SIP Event Package Registration

      Package name: vq-rtcpxr

      Type: package

      Contact: Alan Johnston <alan.johnston@mci.com>

      Published Specification: This document






























Johnston, et al.        Expires January 19, 2006               [Page 19]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


4.9.2  application/rtcp-xr MIME Registration

      MIME media type name: application

      MIME subtype name: vq-rtcpxr

      Mandatory parameters: none

      Optional parameters: none

      Encoding considerations: text

      Security considerations: See next section.

      Interoperability considerations: none.

      Published specification: This document.


      Applications which use this media type: This document type is
           being used in notifications of VoIP quality reports.

      Additional Information:

           Magic Number: None

           File Extension: None

           Macintosh file type code: "TEXT"

      Personal and email address for further information: Alan Johnston
        <alan.johnston@mci.com>

      Intended usage: COMMON

      Author/Change controller: The IETF.


4.10  Security Considerations

   RTCP reports can contain sensitive information since they can provide
   information about the nature and duration of a session established
   between two endpoints.  As a result, any third party wishing to
   obtain this information should be properly authenticated and the
   information transferred securely.






Johnston, et al.        Expires January 19, 2006               [Page 20]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


4.11  Updates since -06

   - Changed package name from "svcqual" to "vq-rtcpxr" as the focus
   will be only voice quality reporting based on RTCP XR.

   - Rewrite of verbage in document to clarify that the focus will be
   voice quality reporting and not general performance or service
   quality reporting.

   - Removed section on "Why SNMP is not appropriate" as it was
   inaccurate and misleading.

   - Removed usage of SDP lines for describing the basic session
   parameters.  A reduced format designed specifically for this document
   is provided instead.

   - General clean up of syntax based on comments from WG

   - Removed general description of parameters, instead referring to
   RTCP XR for more details in most cases.

   - Reworked message flow examples using new syntax.

4.12  Updates since -04

   - Changed package name from "perfrpt" to "svcqual"

4.13  Updates since -03

   - Removed discussion of alternative mechanisms

   - Changed from NOTIFY transport to PUBLISH transport.

   - Changed package name from "rtcp-xr" to "perfrpt"

   - Corrected call flows.

   - Minor updates to message body format.

   - Added IANA registration for perfrpt SIP Event Package and
   application/rtcp-xr MIME registration.

   - Added more discussion for motivation and reasons why SNMP is not
   suitable

4.14  Contributors

   The authors would like to thank Rajesh Kumar, Dave Oran and Tom



Johnston, et al.        Expires January 19, 2006               [Page 21]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


   Redman for their discussions.

5.  Informative References

   [1]  Bradner, S., "Key words for use in RFCs to Indicate Requirement
        Levels", BCP 14, RFC 2119, March 1997.

   [2]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A.,
        Peterson, J., Sparks, R., Handley, M., and E. Schooler, "SIP:
        Session Initiation Protocol", RFC 3261, June 2002.

   [3]  Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson,
        "RTP: A Transport Protocol for Real-Time Applications", STD 64,
        RFC 3550, July 2003.

   [4]  Friedman, T., Caceres, R., and A. Clark, "RTP Control Protocol
        Extended Reports (RTCP XR)", RFC 3611, November 2003.

   [5]  Huitema, C., "Real Time Control Protocol (RTCP) attribute in
        Session Description Protocol (SDP)", RFC 3605, October 2003.

   [6]  Roach, A., "Session Initiation Protocol (SIP)-Specific Event
        Notification", RFC 3265, June 2002.

   [7]  Crocker, D., Ed. and P. Overell, "Augmented BNF for Syntax
        Specifications: ABNF", RFC 2234, November 1997.

   [8]  Niemi, A., "An Event State Publication Extension to the Session
        Initiation Protocol  (SIP)", draft-ietf-sip-publish-04 (work in
        progress), May 2004.


Authors' Addresses

   Alan Johnston
   MCI
   100 South 4th Street
   St. Louis, MO  63104

   Email: alan.johnston@mci.com











Johnston, et al.        Expires January 19, 2006               [Page 22]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


   Henry Sinnreich
   Pulver
   115 Broadhollow Drive, Suite 250
   Melville, NY 11747, NY  11747

   Email: henry@pulver.com


   Alan Clark
   Telchemy Incorporated
   3360 Martins Farm Road, Suite 200
   Suwanee, GA  30024

   Email: alan@telchemy.com


   Amy Pendleton
   Nortel Networks
   2380 Performance Drive
   Richardson, TX  75081

   Email: aspen@nortelnetworks.com





























Johnston, et al.        Expires January 19, 2006               [Page 23]

Internet-Draft    SIP Event for Voice Quality Reporting        July 2005


Intellectual Property Statement

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.


Disclaimer of Validity

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Copyright Statement

   Copyright (C) The Internet Society (2005).  This document is subject
   to the rights, licenses and restrictions contained in BCP 78, and
   except as set forth therein, the authors retain all their rights.


Acknowledgment

   Funding for the RFC Editor function is currently provided by the
   Internet Society.




Johnston, et al.        Expires January 19, 2006               [Page 24]


