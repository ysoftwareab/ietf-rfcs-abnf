
Network Working Group                                Rahul Aggarwal
Internet Draft                                       Juniper Networks
Expires: July 2004                                   Christian Jacquenet
                                                     France Telecom
                                                     Jeremy De Clercq
                                                     Alcatel

                      Encapsulating MPLS in IPsec
                    draft-raggarwa-mpls-ipsec-00.txt



Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
              http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
              http://www.ietf.org/shadow.html.


Copyright Notice

   Copyright (C) The Internet Society (2004). All Rights Reserved.














draft-raggarwa-mpls-ipsec-00.txt                                [Page 1]

Internet Draft      draft-raggarwa-mpls-ipsec-00.txt        January 2004


Abstract

   In various applications of MPLS, label stacks with multiple entries
   are used. In some cases, it is possible to replace the top label of
   the stack with an IP-based encapsulation, thereby enabling the
   application to run over networks which do not have MPLS enabled in
   their core routers. MPLS-in-IP and MPLS-in-GRE encapsulations have
   already been specified by the MPLS WG. In some cases, in addition to
   IP and GRE tunnels, it may be desirable to use IPsec for transporting
   MPLS packets securely over non-MPLS networks, using standard IPsec
   authentication and/or encryption functions. This draft describes
   procedures for encapsulating MPLS packets in IPsec.


Conventions used in this document

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC-2119 [KEYWORDS].


1. Motivation

   In many applications of MPLS, packets traversing an MPLS backbone
   carry label stacks with more than one label. [MPLS-IP-GRE] specifies
   procedures for encapsulating MPLS in IP and MPLS in GRE. This allows
   the top label to be replaced, without loss of functionality, by an IP
   header or a GRE header. Hence two LSRs that are adjacent on an LSP
   can be separated by an IP network, even if the routers on that
   network do not support MPLS. For instance these two LSRs may have a
   directed LDP session between them to exchange LDP labels, but may be
   separated by an IP network, where the routers in the IP network do
   not support MPLS. In some cases it may be desirable for two such LSRs
   to use IPsec [IP-SEC-ARCH] to carry MPLS packets securely over the IP
   network.

1.1. IPsec Authentication and/or Encryption for Security

   An IPsec security association (SA), enables MPLS packets to be
   carried securely over non-MPLS networks. An IPsec protected IP/GRE
   encapsulation replaces the upper MPLS labels, which are required when
   the backbone network is MPLS. MPLS packets can be protected using
   standard IPsec authentication and/or encryption functions. The
   payload of the IPsec encapsulation contains an authenticated and/or
   encrypted MPLS packet with the inner MPLS label(s).






draft-raggarwa-mpls-ipsec-00.txt                                [Page 2]

Internet Draft      draft-raggarwa-mpls-ipsec-00.txt        January 2004


1.1.1. Protection Against Spoofed Packets

   The use of IPsec tunnels protects the tunnelled MPLS packets against
   spoofed packets in a more secure fashion compared to an IP or GRE
   tunnel.

   It should be noted that if the upper MPLS labels are replaced with an
   unsecured IP encapsulation, like GRE or IP, it becomes more difficult
   to protect the application against spoofed packets. A Service
   Provider can protect against spoofed MPLS packets by the simple
   expedient of not accepting MPLS packets from outside its own domain
   boundaries (or more generally by keeping track of which labels are
   validly received over which interfaces, and discarding packets which
   arrive with labels that are not valid for their incoming interfaces).
   Protection against spoofed IP packets requires having all the
   boundary routers perform filtering; either filtering out packets from
   "outside" which are addressed to PE routers, or filtering out packets
   from "outside" which have source addresses that belong "inside" and
   filtering on each PE all packets which have source addresses that
   belong "outside". The maintenance of these filter lists can be
   management-intensive, and their use at all border routers can affect
   the performance seen by all traffic entering the Service Provider's
   network. Furthermore, these filtering techniques may be difficult to
   apply when the application is being used across multiple providers,
   because in that case IP datagrams from outside an Service Provider's
   network can legitimately be addressed to its PE routers.

   If on the other hand, the upper MPLS labels are replaced by an IPsec
   encapsulation, protection against spoofed packets does not rely on
   filtering at the border routers. The ingress PE router may still
   maintain filtering policies to filter IP datagrams from outside.
   However such filter lists have to be maintained only on the ingress
   and are not required on the border routers or the egress PE. The
   cryptographic authentication features of IPsec [AH, ESP] enable an
   egress PE to detect and discard tunneled MPLS packets that were not
   generated by a valid ingress PE for that particular application. Thus
   protection against spoofing is managed entirely at the ingress and
   egress PE routers, transparent to the border routers. The tradeoff is
   the management and performance implications associated with the use
   of IPsec.

1.1.2. Protection Against Transit Node Misbehavior

   Cryptographic authentication [AH, ESP] applied by the ingress PE on
   MPLS packets destined to an egress PE can protect against misrouting
   occurences or modification of packets by transit nodes. The
   authentication check at the egress PE will fail if the MPLS packets
   are forwarded to the incorrect egress PE or are modified in transit.



draft-raggarwa-mpls-ipsec-00.txt                                [Page 3]

Internet Draft      draft-raggarwa-mpls-ipsec-00.txt        January 2004


   This will also protect against packet spoofing from within a Service
   Provider's network.

1.1.3. Encryption of the Application Data

   If the path followed by the traffic from ingress PE to egress PE
   contains non-trusted network parts, IPsec data encryption may be used
   to encrypt the payload [ESP].  This can help in providing privacy for
   the application data in some cases.


2. Encapsulation of MPLS in IPsec by Ingress PE

   We describe two possible ways of encapsulating MPLS packets in IPsec.

   In the first approach an MPLS-in-GRE or MPLS-in-IP [MPLS-IP-GRE]
   encapsulation is used by the ingress PE to turn the MPLS packet into
   an IP packet. The IP packet's source IP address is an address of the
   Ingress PE; the IP packet's destination IP address is an address of
   the Egress PE. The net effect is to create an IP or GRE tunnel to
   send the MPLS packet to the egress PE. IPsec tunnel mode is then used
   to secure these tunnels. Thus the MPLS packet gets sent through an
   IPsec secured IP or GRE tunnel. The resulting packet has an outer IP
   header preceding the IPsec header and an inner IP header following
   the IPsec header.

   In the second approach an MPLS-in-GRE or MPLS-in-IP [MPLS-IP-GRE]
   encapsulation is used by the ingress PE to turn the MPLS packet into
   an IP packet. The IP packet's source IP address is an address of the
   Ingress PE; the IP packet's destination IP address is an address of
   the Egress PE. The net effect is to create an IP or GRE tunnel to
   send the MPLS packet.  IPsec transport mode is then used to secure
   these tunnels. Thus the resulting packet has an outer IP header
   preceding the IPsec header but does not have an inner IP header. The
   MPLS label stack follows the IPsec header. In this case the IPsec
   header needs to set the payload type to MPLS. MPLS in IP payload
   types defined in [MPLS-IP-GRE] MUST be used for this purpose.

   The ingress PE needs to have an IPsec security association (SA) with
   the egress PE router. The traffic type to be protected by the
   considered SA is MPLS-in-IP/GRE packets with ingress PE/egress PE IP
   addresses as the IP source/destination addresses. Depending on the
   application it may be important to set up IPsec SAs dynamically and
   static keying may not be a viable option. There may be a need for a
   key distribution infrastructure that supports multiple Service
   Providers and IKE [IKE] may need to be used to establish the SAs. The
   identification of whether transport mode or tunnel mode IPsec is used
   is accomplished via configuration of Ingress and Egress PE or via



draft-raggarwa-mpls-ipsec-00.txt                                [Page 4]

Internet Draft      draft-raggarwa-mpls-ipsec-00.txt        January 2004


   dynamic negotiation with e.g. IKE.


3. De-capsulation of MPLS in IPsec by the Egress PE

   The egress PE will handle the necessary IKE functions, SA and IPsec
   tunnel maintenance, etc., as well as handle arriving IPsec packets.
   It will apply the necessary IPsec procedures to arriving IPsec
   packets.

   The result of the IPsec 'outbound' processing at the egress PE is the
   recovering of a contained MPLS-in-IP/GRE packet. With tunnel mode,
   IPsec will delete one of both IP headers and the result will still
   contain one IP header. The egress PE will then strip off the
   encapsulating IP header to recover the MPLS packet, for MPLS
   switching purposes.

   It is to be noted that if a) A MPLS packet is received by an egress
   PE, with no IPsec encapsulation and b) An IPsec encapsulation was
   expected by the egress PE for that MPLS packet, it should be
   discarded. How this is achieved depends on the implementation.


4. Security Considerations

   Security issues are discussed in section 1.


5. Acknowledgments

   Lot of the text in this document is written using [MPLS-IP-GRE,
   2547IPsec] We would like to thank the authors of these documents.
   Thanks to Yakov Rekhter and Kireeti Kompella for the discussions that
   led to this draft.  Thanks also to Nischal Sheth for his comments.


6. References


   [MPLS-IP-GRE] "Encapsulating MPLS in IP or GRE", T. Worster,
   Rekhter Y., Work in Progress, Rosen E., draft-ietf-mpls-in-ip-or-gre-01.txt

   [2547GRE] "Use of PE-PE GRE or IP in RFC2547 VPNs", Yakov Rekhter,
   Eric Rosen, Work in Progress, draft-ietf-l3vpn-gre-ip-2547-00.txt

   [2547IPsec] "Use of PE-PE IPsec in RFC2547 VPNs", Rosen E., De Clercq
   J., Pridaens O., T'Joens Y., Sargor C., Work in Progress,
   draft-ietf-l3vpn-ipsec-2547-03.txt



draft-raggarwa-mpls-ipsec-00.txt                                [Page 5]

Internet Draft      draft-raggarwa-mpls-ipsec-00.txt        January 2004


   [IP-SEC-ARCH] "Security Architecture for the Internet Protocol". S.Kent,
   K. Seo, Work in Progress, draft-ietf-ipsec-rfc2401bis-01.txt

   [ESP] "IP Encapsulating Security Payload (ESP)", S. Kent, Work in Progress,
   draft-ietf-ipsec-esp-v3-06.txt

   [AH] "IP Authentication Header", S. Kent, Work in Progress,
   draft-ietf-ipsec-rfc2402bis-05.txt

   [IKE] Harkins, D., Carrel, D., "The Internet Key Exchange", RFC 2409,
   November 1998.



Author Information


   Rahul Aggarwal
   Juniper Networks
   1194 North Mathilda Ave.
   Sunnyvale, CA 94089
   Email: rahul@juniper.net

   Christian Jacquenet
   France Telecom
   3, avenue Francois Chateau
   CS 36901
   35069 Rennes Cedex
   France
   Phone: +33 2 99 87 63 31
   Email: christian.jacquenet@francetelecom.com

   Jeremy De Clercq
   Alcatel
   Fr. Wellesplein 1, 2018 Antwerpen, Belgium.
   Email: Jeremy.De_Clercq@alcatel.be


   IPR Notice

   The IETF takes no position regarding the validity or scope of any
   intellectual property or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; neither does it represent that it
   has made any effort to identify any such rights.  Information on the
   IETF's procedures with respect to rights in standards-track and
   standards-related documentation can be found in BCP-11.  Copies of



draft-raggarwa-mpls-ipsec-00.txt                                [Page 6]

Internet Draft      draft-raggarwa-mpls-ipsec-00.txt        January 2004


   claims of rights made available for publication and any assurances of
   licenses to be made available, or the result of an attempt made to
   obtain a general license or permission for the use of such
   proprietary rights by implementors or users of this specification can
   be obtained from the IETF Secretariat.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights which may cover technology that may be required to practice
   this standard.  Please address the information to the IETF Executive
   Director.


Full Copyright Notice

   Copyright (C) The Internet Society (2004).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE."











draft-raggarwa-mpls-ipsec-00.txt                                [Page 7]

Internet Draft      draft-raggarwa-mpls-ipsec-00.txt        January 2004


Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.















































draft-raggarwa-mpls-ipsec-00.txt                                [Page 8]

