<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Cookie-based HTTP Authentication</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Cookie-based HTTP Authentication">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">T. Broyer</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">January 05, 2009</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: July 9, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Cookie-based HTTP Authentication<br />draft-broyer-http-cookie-auth-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 9, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
        This document specifies an HTTP authentication scheme for use when credentials
        are validated by an out-of-band mechanism (not defined here) and later
        communicated to the server through the use of a cookie. Which out-of-band
        mechanism should be used, and how, is described by the 401 (Unauthorized)
        response body. It is common practice that this mechanism is an HTML form,
        sending the user's credentials with the use of an HTTP POST request to a tier
        URL which will set a cookie in response; though this document doesn't preclude
        the use of other mechanisms.
      
</p>
<h3>Editorial Note (To be removed by RFC Editor before publication)</h3>

<p>
        Distribution of this document is unlimited. Please send comments to the 
        ietf-http-auth mailing list at <a href='mailto:ietf-http-auth@osafoundation.org'>ietf-http-auth@osafoundation.org</a>, which may be joined by sending a message with subject 
        "subscribe" to <a href='mailto:ietf-http-auth-request@osafoundation.org?subject=subscribe'>ietf-http-auth-request@osafoundation.org</a>.
      
</p>
<p>
        Discussions of the ietf-http-auth mailing list are archived at
        <a href='http://lists.osafoundation.org/pipermail/ietf-http-auth/'>http://lists.osafoundation.org/pipermail/ietf-http-auth/</a>.               
      
</p>
<p>
        XML versions, latest edits and the issues list for this document
        are available from <a href='http://broyer.info/hg/http-cookie-auth/'>http://broyer.info/hg/http-cookie-auth/</a>.
      
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#Introduction">1.</a>&nbsp;
Introduction<br />
<a href="#notational.conventions">2.</a>&nbsp;
Notational Conventions<br />
<a href="#anchor1">3.</a>&nbsp;
Cookie Authentication Scheme<br />
<a href="#Acknowledgements">4.</a>&nbsp;
Acknowledgements<br />
<a href="#IANA">5.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">6.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">7.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">7.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">7.2.</a>&nbsp;
Informative References<br />
<a href="#examples">Appendix&nbsp;A.</a>&nbsp;
Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">A.1.</a>&nbsp;
Simple example (everything goes through TLS)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">A.2.</a>&nbsp;
Mixed HTTP/HTTPS example<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">A.3.</a>&nbsp;
Cross-domain example<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="Introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
        Authentication on the web can be done either at the <a class='info' href='#RFC2616'>Hypertext Transfer Protocol (HTTP)<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> [RFC2616] level with a 401 (Unauthorized) status
        code, or using SSL certificates. Among other issues already listed in
        <a class='info' href='#W3C.NOTE-authentform-19990203'>User Agent Authentication
        Forms<span> (</span><span class='info'>Lawrence, S. and P. Leach, &ldquo;User Agent Authentication Forms,&rdquo; February&nbsp;1999.</span><span>)</span></a> [W3C.NOTE&#8209;authentform&#8209;19990203], the former suffers from a poor user experience while the latter
        can quickly become expensive. That's why the most common authentication mechanism
        is based on <a class='info' href='#W3C.REC-html401-19991224'>HyperText Markup Language
        (HTML) forms<span> (</span><span class='info'>Jacobs, I., Hors, A., and D. Raggett, &ldquo;HTML 4.01 Specification,&rdquo; December&nbsp;1999.</span><span>)</span></a> [W3C.REC&#8209;html401&#8209;19991224] and <a class='info' href='#RFC2965'>cookies<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; October&nbsp;2000.</span><span>)</span></a> [RFC2965].
      
</p>
<p>
        However, form-based authentication is almost always implemented with an HTTP
        redirect to the login form, making it impossible for non-browser user agents
        to detect a protected resource (this leads to people downloading and saving
        login forms instead of the protected resource they wanted, web service clients
        failing with unrecoverable errors, etc.).
      
</p>
<p>
        <a class='info' href='#W3C.NOTE-authentform-19990203'>User Agent Authentication Forms<span> (</span><span class='info'>Lawrence, S. and P. Leach, &ldquo;User Agent Authentication Forms,&rdquo; February&nbsp;1999.</span><span>)</span></a> [W3C.NOTE&#8209;authentform&#8209;19990203]
        tried to overcome this with an amendment to HTML forms making them
        "HTTP-authentication aware".
      
</p>
<p>
        This document solves the problem the other way around, keeping the mechanism
        backwards compatible with browsers while making it independant of HTML.
      
</p>
<a name="notational.conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Notational Conventions</h3>

<p>
        The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL-NOT", "SHOULD",
        "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
        interpreted as described in Appendix  of <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>. 
      
</p>
<p>
        The terminology used here follows and extends that in the HTTP specification
        Appendix  of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>.
      
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Cookie Authentication Scheme</h3>

<p>
        The "cookie" authentication scheme tries to reconcile the current practice of
        many web sites and web development frameworks of using HTML forms and cookies
        to authenticate users, and the Access Authentication Framework described in
        Section 1.2 of <a class='info' href='#RFC2617'>[RFC2617]<span> (</span><span class='info'>Franks, J., Hallam-Baker, P., Hostetler, J., Lawrence, S., Leach, P., Luotonen, A., and L. Stewart, &ldquo;HTTP Authentication: Basic and Digest Access Authentication,&rdquo; June&nbsp;1999.</span><span>)</span></a>. The user credentials being
        passed through cookies, the Authorization and Proxy-Authorization request
        headers are therefore not used.
      
</p>
<p>
        The "cookie" authentication scheme cannot be used for proxy authentication
        (within the value of a Proxy-Authenticate response header) because, as defined
        in Section 3.5 of <a class='info' href='#RFC2965'>[RFC2965]<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; October&nbsp;2000.</span><span>)</span></a>: "Proxies MUST NOT
        introduce Set-Cookie2 (Cookie) headers of their own in proxy responses
        (requests)."
      
</p>
<p>
        When the origin server sends a 401 (Unauthorized) response containing a
        WWW-Authenticate header with a "cookie" authentication scheme, the response
        body gives instructions on how to create the appropriate cookies, generally
        by issuing another HTTP request (preferably a POST request) to a distinct URL.
      
</p>
<p>
        In most current web sites and web applications, the response body would be an
        HTML document containing a form; when the form is submitted, the server checks
        the user-provided form-data and upon validation sends the appropriate
        Set-Cookie2 response header fields within a 303 (See Other) response redirecting
        back to the protected resource.
      
</p>
<p>
        The "cookie" authentication scheme is however not limited to such scenarios: the
        response body could be for example an SVG image with an embedded XForms, or an
        HTML document with an embedded script that will compute a hash of user-provided
        data and set the cookie by script before reloading the resource, or some specific
        entity recognized by the UA, which will authenticate using an out-of-band
        mechanism and set the appropriate cookie before re-requesting the protected
        resource. This last scenario might be better solved using another authentication
        scheme, though this scenario would allow server-side negotiation of the
        authentication mechanism using content negotiation; instead of the client-side
        negotiation traditionally used when sending multiple WWW-Authenticate response
        headers.
      
</p>
<p>Syntax (using the augmented Backus-Naur Form (BNF) defined
          in Section 2.1 of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
challenge           =  "Cookie" cookie-challenge

cookie-challenge    = 1#( realm | [ form-action ] | cookie-name |
                      [ secure-cookie-name ] | [auth-param] )

form-action         = "form-action" "=" &lt;"&gt; URI &lt;"&gt;
URI                 = absolute-URI | ( path-absolute [ "?" query ] )
cookie-name         = "cookie-name" "=" token
secure-cookie-name  = "secure-cookie-name" "=" token

path-absolute  = &lt;defined in [RFC3986], Section 3.3&gt;
quoted-string  = &lt;defined in [RFC2616], Section 2.2&gt;
query          = &lt;defined in [RFC3986], Section 3.4&gt;
token          = &lt;defined in [RFC2616], Section 2.2&gt;
</pre></div>
<p>
        The meanings of the values of the directives used above are as follows:
        </p>
<blockquote class="text"><dl>
<dt>form-action</dt>
<dd>
            OPTIONAL. The value of the "form-action" attribute is the URI reference
            of the resource that will set the cookies used for authenticating the user
            in subsequent requests. The value must resolve to an URI reference where
            the "scheme" part MUST be "http" or "https", the "authority" part contains
            no "userinfo", the "host" and "abs_path" parts have the same contraints as
            the "Domain" and "Path" attributes of a Set-Cookie2 response header
            respectively.
          
</dd>
<dt>cookie-name</dt>
<dd>
            REQUIRED. The value of the "cookie-name" attribute is the name of the
            cookie that is checked by the server to authenticate the user; an UA thus
            could then inform the user this cookie is necessary to gain access to the
            protected resource, and eventually use a different, more secure, storage
            than for other cookies.
          
</dd>
<dt>secure-cookie-name</dt>
<dd>
            OPTIONAL. In case the application uses a mix of secured and unsecured
            channels, the value of the "secure-cookie-name" attribute is the name of
            the cookie that is checked by the server to authenticate the user when the
            communication uses a secured channel, while the cookie named by the
            "cookie-name" attribute will be used for unsecured channel.
          
</dd>
</dl></blockquote><p>
      
</p>
<p>
        The applicability of the cookie(s) (its Domain, Port and Path attributes)
        defines the protection space.
      
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Acknowledgements</h3>

<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>This memo includes no request to IANA.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>
        As with any use of cookies, care should be taken by servers to avoid cookie
        spoofing, and clients to prevent unexpected cookie sharing (see Section 6 and Section 7 of <a class='info' href='#RFC2965'>[RFC2965]<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; October&nbsp;2000.</span><span>)</span></a>).
      
</p>
<p>
        However, using cookies for account information requires that some additional
        measures be taken. Using <a class='info' href='#RFC2818'>HTTP Over TLS<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> [RFC2818] or other
        means of encrypting the conversation is sufficient to mitigate most threats,
        though it requires that some additional measures be taken, as described in this
        section.
      
</p>
<p>
        To mitigate replay attacks (re-use of a sniffed cookie), the value of the
        cookie used for authentication SHOULD NOT contain the users credentials but
        rather a key associated with the authentication session, and this key SHOULD
        be renewed (and expired) frequently.
      
</p>
<p>
        Sensitive information (such as the user's IBAN on an online store) and
        sensitive actions (such as confirming an order) SHOULD only happen on a
        secure channel such as <a class='info' href='#RFC2818'>HTTP Over TLS<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> [RFC2818], and
        protected with a secure cookie (a cookie with the "Secure" bit set) so that
        it cannot be stolen on a unsecured channel.
      
</p>
<p>
        This document does not specify how credentials are sent to the "form-action"
        URL, though care should be taken that those credentials cannot be sniffed.
        In the case of an HTML form, the "form-action" SHOULD use a secure channel
        such as <a class='info' href='#RFC2818'>HTTP Over TLS<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> [RFC2818].
      
</p>
<p><a class='info' href='#comment.anchor2'>[anchor2]<span> (</span><span class='info'>TODO: document how secure-cookie-name helps with security by preventing replay-attacks. The cookie must obviously have the Secure attribute set.</span><span>)</span></a><a name='anchor2'></a>
</p>
<p><a class='info' href='#comment.anchor3'>[anchor3]<span> (</span><span class='info'>TODO: add some words about CSRF (and find a normative reference). Mention &quot;logout&quot; as a mean to mitigate CSRF.</span><span>)</span></a><a name='anchor3'></a>
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2617">[RFC2617]</a></td>
<td class="author-text"><a href="mailto:john@math.nwu.edu">Franks, J.</a>, <a href="mailto:pbaker@verisign.com">Hallam-Baker, P.</a>, <a href="mailto:jeff@AbiSource.com">Hostetler, J.</a>, <a href="mailto:lawrence@agranat.com">Lawrence, S.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, Luotonen, A., and <a href="mailto:stewart@OpenMarket.com">L. Stewart</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and Digest Access Authentication</a>,&rdquo; RFC&nbsp;2617, June&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2617.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2617.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2617.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2818">[RFC2818]</a></td>
<td class="author-text">Rescorla, E., &ldquo;<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>,&rdquo; RFC&nbsp;2818, May&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2818.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2965">[RFC2965]</a></td>
<td class="author-text"><a href="mailto:dmk@bell-labs.com">Kristol, D.</a> and <a href="mailto:lou@montulli.org">L. Montulli</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2965">HTTP State Management Mechanism</a>,&rdquo; RFC&nbsp;2965, October&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2965.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2965.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2965.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3986">[RFC3986]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>,&rdquo; RFC&nbsp;3986, January&nbsp;2005.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="W3C.NOTE-authentform-19990203">[W3C.NOTE-authentform-19990203]</a></td>
<td class="author-text">Lawrence, S. and P. Leach, &ldquo;<a href="http://www.w3.org/TR/1999/NOTE-authentform-19990203">User Agent Authentication Forms</a>,&rdquo; W3C NOTE&nbsp;NOTE-authentform-19990203, February&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-html401-19991224">[W3C.REC-html401-19991224]</a></td>
<td class="author-text">Jacobs, I., Hors, A., and D. Raggett, &ldquo;<a href="http://www.w3.org/TR/1999/REC-html401-19991224">HTML 4.01 Specification</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-html401-19991224, December&nbsp;1999 (<a href="http://www.w3.org/TR/1999/REC-html401-19991224">HTML</a>).</td></tr>
</table>

<a name="examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Examples</h3>

<p>
        Most detail of request and response headers has been omitted. Assume that the
        user agent has no stored cookies.
      
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Simple example (everything goes through TLS)</h3>

<ol class="text">
<li>
            User Agent -&gt; Server
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET https://www.example.com/acme/ HTTP/1.1
</pre></div>
          
</li>
<li>
            Server -&gt; User Agent
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Cookie realm="Acme"
        form-action="/acme/login"
        cookie-name=ACME_TICKET
Content-Type: text/html

&lt;title&gt;Unauthorized&lt;/title&gt;
&lt;form action="/acme/login" method=POST&gt;
&lt;input type=hidden name=referer value="/acme/"&gt;
&lt;p&gt;&lt;label&gt;Username: &lt;input name=user&gt;&lt;/label&gt;
&lt;p&gt;&lt;label&gt;Password: &lt;input name=pwd type=password&gt;&lt;/label&gt;
&lt;p&gt;&lt;button type=submit&gt;Sign in&lt;/button&gt;
&lt;p&gt;&lt;a href="/acme/register"&gt;Register for an account&lt;/a&gt;
&lt;/form&gt;
</pre></div>
          
</li>
<li>
            User Agent -&gt; Server
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
POST https://www.example.com/acme/login HTTP/1.1
Content-Type: application/x-www-form-urlencoded

referer=%2Facme%2F&amp;user=Aladdin&amp;password=open%20sesame
</pre></div>
          
</li>
<li>
            Server -&gt; User Agent
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 303 See Other
Location: https://www.example.com/acme/
Set-Cookie2: ACME_TICKET="sdf354s5c1s8e1s"; Version="1";
        Path="/acme"; Secure
</pre></div>
          
</li>
<li>
            User Agent -&gt; Server
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET https://www.example.com/acme/ HTTP/1.1
Cookie: $Version="1"; ACME_TICKET="sdf354s5c1s8e1s"; $Path="/acme"
</pre></div>
          
</li>
<li>
            Server -&gt; User Agent
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
</pre></div>
          
</li>
</ol>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Mixed HTTP/HTTPS example</h3>

<ol class="text">
<li>
            User Agent -&gt; Server
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET http://www.example.com/acme/ HTTP/1.1
</pre></div>
          
</li>
<li>
            Server -&gt; User Agent
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Cookie realm="Acme"
        form-action="https://secure.example.com/acme/login"
        cookie-name=ACME_TICKET
        secure-cookie-name=ACME_SECURE_TICKET
Content-Type: text/html

&lt;title&gt;Unauthorized&lt;/title&gt;
&lt;form action="https://secure.example.com/acme/login" method=POST&gt;
&lt;input type=hidden name=referer
       value="http://www.example.com/acme/"&gt;
&lt;p&gt;&lt;label&gt;Username: &lt;input name=user&gt;&lt;/label&gt;
&lt;p&gt;&lt;label&gt;Password: &lt;input name=pwd type=password&gt;&lt;/label&gt;
&lt;p&gt;&lt;button type=submit&gt;Sign in&lt;/button&gt;
&lt;p&gt;&lt;a href="/acme/register"&gt;Register for an account&lt;/a&gt;
&lt;/form&gt;
</pre></div>
          
</li>
<li>
            User Agent -&gt; Server
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
POST https://secure.example.com/acme/login HTTP/1.1
Content-Type: application/x-www-form-urlencoded

referer=http%3A%2F%2Fwww.example.com%2Facme%2F&amp;user=Aladdin&amp;password=open%20sesame
</pre></div>
          
</li>
<li>
            Server -&gt; User Agent
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 303 See Other
Location: http://www.example.com/acme/
Set-Cookie2: ACME_TICKET="sdf354s5c1s8e1s"; Version="1";
        Path="/acme"; Domain=".example.com"
Set-Cookie2: ACME_SECURE_TICKET="drg53d51fd535rg"; Version="1";
        Path="/acme"; Domain=".example.com"; Secure
</pre></div>
          
</li>
<li>
            User Agent -&gt; Server
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET http://www.example.com/acme/ HTTP/1.1
Cookie: $Version="1"; ACME_TICKET="sdf354s5c1s8e1s";
        $Path="/acme"; $Domain=".example.com"
</pre></div>
          
</li>
<li>
            Server -&gt; User Agent
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
</pre></div>
          
</li>
<li>
            User Agent -&gt; Server
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET https://secure.example.com/acme/ HTTP/1.1
Cookie: $Version="1"; ACME_SECURE_TICKET="drg53d51fd535rg";
        $Path="/acme"; $Domain=".example.com"
</pre></div>
          
</li>
<li>
            Server -&gt; User Agent
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
</pre></div>
          
</li>
</ol>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Cross-domain example</h3>

<p><a class='info' href='#comment.anchor9'>[anchor9]<span> (</span><span class='info'>TODO: using CSRF and server-to-server communication to achieve cross-domain single sign-on between sso.some-co.com and www.some-tm.net.</span><span>)</span></a><a name='anchor9'></a>
</p>
<p>
          At some-tm.net, the 401 response body loads a javascript from
          sso.some-co.com that sets a "temporary" cookie if already authenticated
          or redirects to sso.some-co.com otherwise. In the former case, the
          server validates the "temporary" cookie by calling sso.some-co.com and
          then sets the appropriate cookie to authenticate the user at some-tm.net.
          On the latter case, the server then redirects the browser back to
          some-tm.net with some token in the URL; this token is validated the same
          way as with the "temporary" cookie and the browser is then redirected
          back to the protected resource.
        
</p>
<p>
          Fallback in case javascript is not available is a &lt;meta refresh&gt;
          (in a &lt;noscript&gt;) to redirect the browser to sso.some-co.com. The
          process is then similar to JA-SIG Central Authentication Service (CAS).
        
</p>
<p>
          Or maybe these should be two distinct examples?
        
</p>
<p>
          And do not forget the "single-logout" issue.
        
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Thomas Broyer</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:t.broyer@ltgt.net">t.broyer@ltgt.net</a></td></tr>
</table>
</body></html>
