Network Working Group                                       M. MacDonald
Internet Draft                                           Nortel Networks
Expiration Date: February 2000                               August 1999                                     



                        Virtual Bridge Tunneling
                       Ethernet Encapsulation in IP

                   <draft-macdonald-vir-bri-tun-00.txt>


Status of this Memo

   This document is an Internet-Draft and is in full conformance
   with all provisions of Section 10 of RFC2026. 

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as
   Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six
   months and may be updated, replaced, or obsoleted by other
   documents at any time.  It is inappropriate to use Internet-
   Drafts as reference material or to cite them other than as
   "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.


Abstract

   This document specifies an approach to provide extended LAN and VLAN
   services across IP routed networks.  This is done by adding a virtual
   bridge identifier to packets destined to the remote location and then
   encapsulating this new packet in IP.  This packet is then source 
   routed across the IP network to a Virtual Bridge Tunnel terminating
   router where the header is stripped off and the virtual bridge
   identifier is used to forward the original packet out the 
   corresponding tunnel interface.

   Within the IP network the packets are treated like any other IP packets
   and as such identical mechanisms such as security and quality of 
   service can be applied.






MacDonald                                                       [Page 1]

Internet Draft          Virtual Bridge Tunneling            August 1999 


Table of Contents

   1.   Introduction . . . . . . . . . . . . . . . . . . . . . . . . 2
   2.   Bridge Tunnel Interface  . . . . . . . . . . . . . . . . . . 2
           Figure 1: A Virtual Bridge Tunnel . . . . . . . . . . . . 2
   3.   Bridge Tunnels . . . . . . . . . . . . . . . . . . . . . . . 3
           Figure 2: Bridge Tunnel Packet  . . . . . . . . . . . . . 3
           Figure 3: Multiple VBTs . . . . . . . . . . . . . . . . . 3
   4.   Ethernet Encapsulation in IP . . . . . . . . . . . . . . . . 3
           Figure 4: BTP Encapsulated in IP  . . . . . . . . . . . . 3
   5.   Learning . . . . . . . . . . . . . . . . . . . . . . . . . . 4
   6.   Establishing a Tunnel  . . . . . . . . . . . . . . . . . . . 4
   7.   BTP Processing . . . . . . . . . . . . . . . . . . . . . . . 4
   8.   Acronyms . . . . . . . . . . . . . . . . . . . . . . . . . . 5
   9.   References . . . . . . . . . . . . . . . . . . . . . . . . . 6
   10.  Author's Address . . . . . . . . . . . . . . . . . . . . . . 7


1.  Introduction

   It may be necessary to provide extended LAN and VLAN services between
   two or more remote locations that are connected via an IP routed
   network.  Current implementations exist for Ethernet encapsulated in
   ATM and frame-relay however no mechanism is available to provide a
   similar service for IP routed networks.  This document proposes an
   approach to providing Ethernet encapsulated in IP, essentially making
   the IP network transparent to the remote locations.  This will allow
   the IP network to function as a virtual bridge by providing Ethernet
   encapsulation at the edge routers with tunneling between.


2.  Bridge Tunnel Interface

   The local interface on the two edge routers is designated as the 
   Bridge Tunnel Interface, BTI. 

   Figure 1: A Virtual Bridge Tunnel

      Local LAN     +-----------------------------+    Remote LAN
       Segment      |          IP Network         |     Segment
      1.1.1.0/24    |                             |    1.1.1.0/24
      |     |    +-----+                       +-----+    |     | 
      +--+--+----|  A  |=======================|  B  |----+--+--+
         |      /+-----+ Virtual Bridge Tunnel +-----+\      |
              BTI   |                             |   BTI 
                    |       A,B Edge Routers      |         
                    +-----------------------------+





MacDonald                                                       [Page 2]

Internet Draft          Virtual Bridge Tunneling            August 1999 


3.  Bridge Tunnels

   Because the potential exists for more than two remote locations
   requiring this service it is necessary to introduce a Bridge Tunnel
   ID, BTID in the form of a two byte header to the original Ethernet
   frame.  This ID is a number from 1 to 65535.

   Figure 2: Bridge Tunnel Packet

                      +----+---------------+---------+-----
                      |BTID|Ethernet Header|IP Header|Data
                      +----+---------------+---------+-----


   Figure 3: Multiple VBTs

      |     |       +-----------------------------+       |     |
      +--+--+---    |          IP Network         |    ---+--+--+
         |      \   |                             |   /      |     
      1.1.1.0/24 +-----+  A,B,C Edge Routers   +-----+ 1.1.1.0/24
       BTID 100  |  A  |                       |  B  |  BTID 100
                 +-----+                       +-----+       
      |     |   /   |                             |   \   |     |    
      +--+--+---    |                             |    ---+--+--+    
         |          |           +-----+           |          |   
      2.2.2.0/24    +-----------|  C  |-----------+    3.3.3.0/24
       BTID 200                 +-----+                 BTID 300
                     |     |   /       \   |     |
                     +--+--+---         ---+--+--+
                        |                     |
                     2.2.2.0/24         3.3.3.0/24
                      BTID 200           BTID 300
                                            

4.  Ethernet Encapsulation in IP

   The remote interface on the local router will perform the
   encapsulation of the Bridge Tunnel Packet BTP in IP.

   Figure 4: BTP Encapsulated in IP

            +---------+----+---------------+---------+-----
            |IP Header|BTID|Ethernet Header|IP Header|Data
            +---------+----+---------------+---------+-----








MacDonald                                                       [Page 3]

Internet Draft          Virtual Bridge Tunneling            August 1999 


   The IP Protocol Type is set to recognize that the data carried
   is a BTP.  Any receiving router interface configured for VBT will
   examine the BTID to determine of the tunnel terminates on one of its
   local interfaces.  If so it reassembles the original IP packet and
   forwards it out on the Bridge Tunnel Interface corresponding to that
   VBT configuration.


5.  Learning

   Initially any packets received by the router on a BTI are forwarded
   to the remote router via the tunnel.  Both routers examine the
   original MAC source addresses of the exchanged packets to create a
   MAC forwarding table.  This table is then used to limit the traffic
   traversing the tunnel to that destined to devices at the remote
   location.  In this sense the BTIs on the edge routers are performing a 
   bridging function.


6.  Establishing the Tunnel

   To configure a BTI on a router it is necessary to know the series of
   next hop routers between the two edge routers.  This information is
   used to source-route the BTPs through the IP network.


7.  BTP Processing

   Each router must keep a list of tunnels for which it is configured.
   Any packet arriving with a Protocol Type of BTP will be examined to
   determine the BTID.  If the BTID corresponds to any of the tunnels
   configured on that router then the outer IP Header and BTID are
   stripped off and the remaining data is reassembled and forwarded
   out on the correct interface as raw data since it already has the
   required header information.

















MacDonald                                                       [Page 4]

Internet Draft          Virtual Bridge Tunneling            August 1999


8.  Acronyms

   BTI     - Bridge Tunnel Interface

   BTID    - Bridge Tunnel ID

   BTP     - Bridge Tunnel Packet

   IP      - Internet Protocol

   LAN     - Local Area Network

   VBT     - Virtual Bridge Tunnel

   VLAN    - Virtual Local Area Network





































MacDonald                                                       [Page 5]

Internet Draft          Virtual Bridge Tunneling            August 1999


9. References
   
   RFC 1701
      Hanks, S., Li, T., Farinacci, D., and P. Traina, "Generic Routing
      Encapsulation", RFC 1701, NetSmiths, Ltd., Cisco Systems, October
      1994.

   RFC 1702
      Hanks, S., Li, T., Farinacci, D., and P. Traina, "Generic Routing
      Encapsulation over Ipv4 networks", RFC 1701, NetSmiths, Ltd., 
      Cisco Systems, October 1994.

   RFC 1932
      Cole, R., Shur, D., and D. Villamizer, "IP over ATM: A Framework
      Document", RFC 1932, AT&T Bell Laboratories, ANS, April 1996. 

   STD 0041/RFC 894
      Hornig, Charles, "A Standard for the Transmission of IP Datagrams
      Over Ethernet Networks", Symbolics Cambridge Research Center,
      April 1984.
 
   STD 0055/RFC 2427
      Brown, C., and A. Malis, "Multiprotocol Interconnect over Frame
      Relay", STD 0055/RFC 2427, Consultant, Ascend Communications, 
      Inc., September 1998.

 

























MacDonald                                                       [Page 6]

Internet Draft          Virtual Bridge Tunneling            August 1999


10.  Author's Address

   Mike MacDonald
   Nortel Networks
   3500 Carling Ave
   Nepean, ON, Can.    K2H 8E9

   Phone: +1 613-765-7899
   Fax:   +1 613-765-4824
   EMail: mikemac@nortelnetworks.com










































MacDonald                                                       [Page 7]



