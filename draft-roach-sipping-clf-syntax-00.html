<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Binary Syntax for SIP Common Log Format</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Binary Syntax for SIP Common Log Format">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">A. Roach</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Tekelec</td></tr>
<tr><td class="header">Expires: September 27, 2009</td><td class="header">March 26, 2009</td></tr>
</table></td></tr></table>
<h1><br />Binary Syntax for SIP Common Log Format<br />draft-roach-sipping-clf-syntax-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 27, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
        This document proposes a binary syntax for the SIP
        common log format (CLF). It does not cover semantic issues,
        and is meant to be evaluated in the context of the
        other efforts discussing SIP CLF.
      
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Format<br />
<a href="#rfc.references1">3.</a>&nbsp;
Normative References<br />
<a href="#anchor4">Appendix&nbsp;A.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
	The Common Log File (CLF) format for the Session Initiation
	Protocol (SIP) <a class='info' href='#I-D.gurbani-sipping-clf'>[I&#8209;D.gurbani&#8209;sipping&#8209;clf]<span> (</span><span class='info'>Gurbani, V., Burger, E., Anjali, T., Abdelnur, H., and O. Festor, &ldquo;The Common Log File (CLF) format for the Session Initiation Protocol (SIP),&rdquo; March&nbsp;2009.</span><span>)</span></a>
	proposes a syntax for logging SIP messages received and
	sent by SIP clients, servers, and proxies. The syntax
	proposed by that document has been inspired by the common
	HTTP log format. However, experience with that format has
	shown that dealing with large quantities of log data can
	be very processor intensive, as doing so necessary requires
	reading and parsing every byte in the log file(s) of interest.
      
</p>
<p>
	This document counterpropses a format that is no more
	difficult to generate by logging entites, while being
	radically faster to process. In particular, the format
        is optimized for both rapidly scanning through log
        records, as well as quickly locating commonly-accessed
        data fields. Both operations can be performed in constant time
        (as compared with O(n) time associated with the current format,
        where n is the length of the log record).
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Format</h3>

<p>
        Each data record is encoded according to the following
        format:
      
</p>
<p>
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0      7 8     15 16    23 24    31
+--------+--------+--------+--------+
| Flags  |     Record Length        | 0 - 3
+--------+--------+--------+--------+
|     Date/Time (bits 32-63)        | 4 - 7
+        +        +        +        +
|     Date/Time (bits 0-31)         | 8 - 11
+--------+--------+--------+--------+
|       Time (nanoseconds)          | 12 - 15
+--------+--------+--------+--------+
|             CSeq Number           | 16 - 19
+--------+--------+--------+--------+
| Response Code   |  TLV Start Ptr  | 20 - 23
+--------+--------+--------+--------+
| Server Txn Ptr  | Server Txn Len  | 24 - 27
+--------+--------+--------+--------+
| Client Txn Ptr  | Client Txn Len  | 28 - 31
+--------+--------+--------+--------+
| Method Pointer  |  Method Length  | 32 - 35
+--------+--------+--------+--------+
|  To Value Ptr   |  To Value Len   | 36 - 39
+--------+--------+--------+--------+
|   To Tag Ptr    |   To Tag Len    | 40 - 43
+--------+--------+--------+--------+
| From Value Ptr  | From Value Len  | 44 - 47
+--------+--------+--------+--------+
|  From Tag Ptr   |  From Tag Len   | 48 - 51
+--------+--------+--------+--------+
| Call-Id Pointer | Call-Id Length  | 52 - 55
+--------+--------+--------+--------+
|                                   |
|                                   |
|      Mandatory Field Data         |
|                                   |
|                                   |
+--------+--------+--------+--------+ \
|       Tag       |      Length     |  \
+--------+--------+--------+--------+   \  Repeated as
|                                   |    &gt; many times
|               Value               |   /  as necessary
|                                   |  /
+--------+--------+--------+--------+ /
</pre></div><p>

      
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>Flags Field (1 byte):</dt>
<dd>
            
<blockquote class="text"><dl>
<dt>0x80 - </dt>
<dd> Request/Response flag
                  (0 = request, 1 = response)
</dd>
<dt>0x40 - </dt>
<dd> Retransmission flag
                  (Always set to 0 if server is stateless)
</dd>
<dt>0x20 - </dt>
<dd> Sent/Recieved flag
                  (0 = message received, 1 = message sent)
</dd>
<dt>0x10 - </dt>
<dd> Reserved
</dd>
<dt>0x08 - </dt>
<dd> Reserved
</dd>
<dt>0x04 - </dt>
<dd> Reserved
</dd>
<dt>0x02 - </dt>
<dd> Reserved
</dd>
<dt>0x01 - </dt>
<dd> Reserved
</dd>
</dl></blockquote>
          <br />
<br />

</dd>
<dt>Record Length (3 bytes):</dt>
<dd> Total length of this log record,
         including "Flags" and "Record Length" fields<br />

</dd>
<dt>Date/Time (8 bytes):</dt>
<dd> Seconds since midnight, January 1st,
         1970, GMT<br />

</dd>
<dt>Time (4 bytes):</dt>
<dd> Nanoseconds since the time in Date/Time
         field (&lt;= 999,999,999)<br />

</dd>
<dt>CSeq Number (4 bytes):</dt>
<dd> CSeq number from the SIP message<br />

</dd>
<dt>Response Code (2 bytes):</dt>
<dd> Set to the value of the response
         code for responses. Should be set to 0 for requests.<br />

</dd>
<dt>TLV Start Ptr (2 bytes):</dt>
<dd> Indicates an absolute byte value
         for the start of tag/length/value (TLV) groups.  Set to 0
         if no TLVs are present.<br />

</dd>
</dl></blockquote><p>
            Bytes 24 trough 55 contain pointer/length pairs that point
            to the values of variable-length mandatory fields. The
            "Pointer" fields indicate absolute byte values within the
            record, and must be >= 56 bytes. They point to the start
            of the corresponding value within the "Mandatory Field Data"
            area. The "Length" fields indicate the length of the
            corresponding value.
          <br />
<br />

         </p>
<blockquote class="text"><dl>
<dt>Server Txn:</dt>
<dd>  The transaction identifier
             associated with the server transaction.  Implementations MAY reuse
             the server transaction identifier (the topmost branch-id of the
             incoming request, with or without the magic cookie), or they MAY
             generate a unique identification string for a server transaction
             (this identifier needs to be locally unique to the server only.)
             This identifier is used to correlate ACKs and CANCELs to an INVITE
             transaction; it is also used to aid in forking.<br />

</dd>
<dt>Client Txn:</dt>
<dd> This field is used to
             associate client transactions with a server transaction for
             forking proxies or B2BUAs.<br />

</dd>
<dt>Method:</dt>
<dd> In requests, the method from the start line. In responses,
         the method found in the CSeq header field.<br />

</dd>
<dt>To Value:</dt>
<dd> Value of the To header field, possibly with the tag
         parameter removed. (Whether to remove the tag paramter is
         left up to the logging entity).<br />

</dd>
<dt>To Tag:</dt>
<dd> Value of the To header field tag parameter. If no To
         header field tag parameter is present, the pointer field
         is ignored, and the length field is set to 0.<br />

</dd>
<dt>From Value:</dt>
<dd> Value of the From header field, possibly with the tag
         parameter removed. (Whether to remove the tag paramter is
         left up to the logging entity)<br />

</dd>
<dt>From Tag:</dt>
<dd> Value of the From header field tag parameter.<br />

</dd>
<dt>Call-Id:</dt>
<dd> The value of the Call-ID header field<br />

</dd>
<dt>Mandatory Field Data:</dt>
<dd> Contains actual values for the preceding
         fields. Note that this data is not necessarily in order, and
         is not necessarily non-overlapping. In particular, loggers
         may usefully choose to overlap the "To Tag" field with the
         "To Value" field (and the "From Tag" field with the "From
         Value" field).<br />

</dd>
</dl></blockquote><p>
            The Tag/Length/Value groups appear zero or more times, at the
            location indicated by the "TLV Start Ptr" field. They are
            used to log information that is not mandatory for all messages
            (although specific TLVs are mandatory in request logs).
          <br />
<br />

         </p>
<blockquote class="text"><dl>
<dt>Tag Field (2 bytes):</dt>
<dd> indicates the type of value coded
         by this TLV. Currently defined tags are: <br />

            
<blockquote class="text"><dl>
<dt>0 -</dt>
<dd> Contact value (can be repeated)
                  Contains entire value of Contact header field<br />
<br />

</dd>
<dt>1 -</dt>
<dd> Request URI (mandatory in request)
                  Contains Request URI in start line<br />
<br />

</dd>
<dt>2 -</dt>
<dd> Remote Host (mandatory in request)
                  The DNS name of IP address from which the
                  message was received (if "sent/received flag" is 0)
                  of the IP address to which the message is being
                  send (if "sent/received flag" is 1)<br />
<br />

</dd>
<dt>3 -</dt>
<dd> Authenticated User
                  Contans the user name by which the user has
                  been authenticated<br />
<br />

</dd>
<dt>4 -</dt>
<dd> Complete SIP Message (optional, should be omitted by default)
                  Contains complete SIP message. Can be repeated
                  multiple times to accomodate SIP messages that
                  exceed 65535 bytes in length.<br />
<br />

</dd>
</dl></blockquote>
          <br />
<br />

</dd>
<dt>Length Field (2 bytes):</dt>
<dd> indicates the length of the value
         coded in this TLV. This length does NOT include the TLV
         header.<br />

</dd>
<dt>Value Field (0 to 65535 bytes):</dt>
<dd> contains the actual
          value of this TLV.<br />

</dd>
</dl></blockquote><p>
      <br />
<br />

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>3.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.gurbani-sipping-clf">[I-D.gurbani-sipping-clf]</a></td>
<td class="author-text">Gurbani, V., Burger, E., Anjali, T., Abdelnur, H., and O. Festor, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-gurbani-sipping-clf-01.txt">The Common Log File (CLF) format for the Session Initiation Protocol (SIP)</a>,&rdquo; draft-gurbani-sipping-clf-01 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-gurbani-sipping-clf-01.txt">TXT</a>).</td></tr>
</table>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Acknowledgements</h3>

<p>
        Cullen put me up to this.
      
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adam Roach</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tekelec</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">17210 Campbell Rd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Suite 250</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dallas, TX  75252</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:adam@nostrum.com">adam@nostrum.com</a></td></tr>
</table>
</body></html>
