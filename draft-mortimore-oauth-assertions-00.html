<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>OAuth 2.0 Assertion Profile</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Requirements Notation and Conventions">
<link href="#rfc.section.2" rel="Chapter" title="2 Overview">
<link href="#rfc.section.3" rel="Chapter" title="3 Authentication vs Authorization">
<link href="#rfc.section.4" rel="Chapter" title="4 Transporting Assertions">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Using Assertions for Client Authentication">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Using Assertions as Authorization Grants">
<link href="#rfc.section.5" rel="Chapter" title="5 Assertion Content and Proccessing">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Assertion Metamodel">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 General Assertion Format and Processing Rules">
<link href="#rfc.section.6" rel="Chapter" title="6 Specific Assertion Format and Processing Rules">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Client authentication">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Client acting on behalf of itself">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Client acting on behalf of a user ">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Client acting on behalf of an anonymous user">
<link href="#rfc.section.7" rel="Chapter" title="7 Error Responses">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This specification provides a general framework for the use of assertions as client credentials and/or authorization grants with OAuth 2.0. It includes a generic mechanism for transporting assertions during interactions with a token endpoint, as wells as rules for the content and processing of those assertions. The intent is to provide an enhanced security profile by using derived values such as signatures or HMACs, as well as facilitate the use of OAuth 2.0 in client-server integration scenarios where the end-user may not be present." />
  <meta name="description" content="This specification provides a general framework for the use of assertions as client credentials and/or authorization grants with OAuth 2.0. It includes a generic mechanism for transporting assertions during interactions with a token endpoint, as wells as rules for the content and processing of those assertions. The intent is to provide an enhanced security profile by using derived values such as signatures or HMACs, as well as facilitate the use of OAuth 2.0 in client-server integration scenarios where the end-user may not be present." />
  <meta name="keywords" content="OAuth, SAML, Assertion" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">C. Mortimore, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Salesforce</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">M. Jones</td>
</tr>
<tr>
<td class="left">Expires: December 20, 2011</td>
<td class="right">MSFT</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">B. Campbell</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Ping</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Y. Goland</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">MSFT</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">June 18, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">OAuth 2.0 Assertion Profile<br />
  <span class="filename">draft-mortimore-oauth-assertions-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This specification provides a general framework for the use of assertions as client credentials and/or authorization grants with OAuth 2.0. It includes a generic mechanism for transporting assertions during interactions with a token endpoint, as wells as rules for the content and processing of those assertions. The intent is to provide an enhanced security profile by using derived values such as signatures or HMACs, as well as facilitate the use of OAuth 2.0 in client-server integration scenarios where the end-user may not be present.</p>
<p>This specification only defines abstract messsage flow and assertion content. Actual use requires implementation of a companion protocol binding specification. Additional profile documents provide standard representations in formats such as SAML and JWT.</p>
<p>The IETF has been notified of intellectual property rights claimed in regard to some or all of the specification contained in this document.  For more information consult the online list of claimed rights.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 20, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Requirements Notation and Conventions</a>
</li>
<li>2.   <a href="#rfc.section.2">Overview</a>
</li>
<li>3.   <a href="#rfc.section.3">Authentication vs Authorization</a>
</li>
<li>4.   <a href="#rfc.section.4">Transporting Assertions</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Using Assertions for Client Authentication</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Using Assertions as Authorization Grants</a>
</li>
<li>5.   <a href="#rfc.section.5">Assertion Content and Proccessing</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Assertion Metamodel</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">General Assertion Format and Processing Rules</a>
</li>
<li>6.   <a href="#rfc.section.6">Specific Assertion Format and Processing Rules</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Client authentication</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Client acting on behalf of itself</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">Client acting on behalf of a user </a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">Client acting on behalf of an anonymous user</a>
</li>
<li>7.   <a href="#rfc.section.7">Error Responses</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#rnc" id="rnc">Requirements Notation and Conventions</a>
</h1>
<p id="rfc.section.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a> .</p>
<p id="rfc.section.1.p.2">Throughout this document, values are quoted to indicate that they are to be taken literally. When using these values in protocol messages, the quotes MUST NOT be used as part of the value.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#overview" id="overview">Overview</a>
</h1>
<p><a href="#I-D.ietf.oauth-v2">The OAuth 2.0 Authorization Protocol </a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite> provides a method for making authenticated HTTP requests to a resource using an access token. Access tokens are issued to clients by an authorization server with the (sometimes implicit) approval of the resource owner. These access tokens are typically obtained by exchanging an authorization grant representing authorization by the resource owner or privliged administrator. Several authorization grant types are defined to support a wide range of client types and user experiences.  OAuth also allows for the definition of new extension grant types to support additional clients or to provide a bridge between OAuth and other trust frameworks. Finally, OAuth allows the definition of additional authentication mechanisms to be used by clients when interacting with the authorization server.</p>
<p id="rfc.section.2.p.2">In scenarios where security is at a premium one wants to avoid sending secrets across the Internet, even on encrypted connections.  Instead one wants to send values derived from the secret that prove to the receiver that the sender is in possession of the secret without actually sending the secret. Typically the way derived values are created is by generating an assertion that is then either HMAC&#8217;d or digitally signed using an agreed upon secret. By validating the HMAC or digital signature on the assertion, the receiver can prove to themselves that the entity that generated the assertion was in possession of the secret without actually communicating the secret directly.</p>
<p id="rfc.section.2.p.3">This specification provides a general framework for the use of assertions as client credentials and/or authorization grants with OAuth 2.0. It includes a generic mechanism for transporting assertions during interactions with a token endpoint, as wells as rules for the content and processing of those assertions. The intent is to provide an enhanced security profile by using derived values such as signatures or HMACs, as well as facilitate the use of OAuth 2.0 in client-server integration scenarios where the end-user may not be present.</p>
<p id="rfc.section.2.p.4">This specification only defines abstract messsage flow and assertion content. Actual use requires implementation of a companion protocol binding specification. Additional profile documents provide standard representations in formats such as SAML and JWT.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Authentication vs Authorization</h1>
<p id="rfc.section.3.p.1">This specification provides a model for using assertions for authentication of an OAuth client during interactions with an Authorization Server, as well as the use of assertions as authorization grants. It is important to note that the use of assertions for client authentication is orthogonal and separable from using assertions as an authorization grant and can be used either in combination or in isolation. In addition, in scenarios when assertion based authentication and authorization are used in combination, the assertion format and processing may be redundant; under such circumstances, the protocol may be optimized to present a single assertion.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Transporting Assertions</h1>
<p id="rfc.section.4.p.1">This section defines generic HTTP parameters for transporting assertions during interactions with a token endpoint.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Using Assertions for Client Authentication</h1>
<p id="rfc.section.4.1.p.1">In scenarios where one wants to avoid sending secrets, one wants to send values derived from the secret that prove to the receiver that the sender is in possession of the secret without actually sending the secret.</p>
<p id="rfc.section.4.1.p.2">For example, a client can establish a secret using an out-of-band mechanism with a resource server. As part of this out-of-band communication the client and resource server agree that the client will authenticate itself using an assertion with agreed upon parameters that will be signed by the provisioned secret. Later on, the client might send an access token request to the token endpoint for the resource server that includes an authorization code, as well as a client_assertion that is signed with the previously agreed key and parameters. The client_assertion proves to the token endpoint the identity of the client and the authorization code provides the link to the end-user authorization.</p>
<p id="rfc.section.4.1.p.3">The following section defines the use of assertions as client credentials as an extension of <a href="#I-D.ietf.oauth-v2">Section 3.2 of OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>. When using assertions as client credentials, the client MUST include the assertion using the following HTTP request parameters:</p>
<p></p>

<dl>
<dt>client_id</dt>
<dd style="margin-left: 8">REQUIRED. The client identifier as described in <a href="#I-D.ietf.oauth-v2">Section 3 of OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>.</dd>
<dt>client_assertion_type</dt>
<dd style="margin-left: 8">REQUIRED. The format of the assertion as defined by the authorization server. The value MUST be an absolute URI.</dd>
<dt>client_assertion</dt>
<dd style="margin-left: 8">REQUIRED. The assertion being used to authenticate the client. Specific serialization of the assertion is defined by profile documents. The serialization MUST be encoded for transport within HTTP forms. It is RECOMMENDED that base64url be used.</dd>
</dl>
<p id="rfc.section.4.1.p.5">The following non-normative example demonstrates a client authenticating using an assertion during a Authorization Code Access Token Request as defined in <a href="#I-D.ietf.oauth-v2">Section 4.1.3 of OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>. (line breaks are for display purposes only):</p>
<div id="#rfc.figure.1"></div>
<pre>POST /token HTTP/1.1 
Host: server.example.com 
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&amp;
code=i1WsRn1uB1&amp;
client_id=s6BhdRkqt3&amp;
client_assertion_type=urn%3Aoasis%3Anames%sAtc%3ASAML%3A2.0%3Aassertion&amp;
client_assertion=PHNhbWxwOl...[omitted for brevity]...ZT</pre>
<p></p>
<p id="rfc.section.4.1.p.7">The client MUST NOT include the client_credential using more than one mechanism. Token endpoints can differentiate between client assertion credentials and other client credential types by looking for the presence of the client_assertion and client_assertion_type attributes which will only be present with client assertion credentials. See section 7 for more details</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Using Assertions as Authorization Grants</h1>
<p id="rfc.section.4.2.p.1">An assertion can be used to request an access token when a client wishes to utilize an existing trust relationship. This may be done through the semantics of (and a digital signature/HMAC calculated over) the assertion, without direct user approval at the authorization server, and expressed through an extension authorization grant type.  The processes by which authorization is previously granted, and by which the client obtains the assertion prior to exchanging it with the authorization server, are out of scope.</p>
<p id="rfc.section.4.2.p.2">The following defines the use of assertions as authorization grants as an extension of <a href="#I-D.ietf.oauth-v2">OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>, section 4.5. When using assertions as authorization grants, the client MUST include the assertion using the following HTTP request parameters:</p>
<p></p>

<dl>
<dt>client_id</dt>
<dd style="margin-left: 8">REQUIRED. The client identifier as described in <a href="#I-D.ietf.oauth-v2">Section 3 of OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>.</dd>
<dt>grant_type</dt>
<dd style="margin-left: 8">REQUIRED. The format of the assertion as defined by the authorization server. The value MUST be an absolute URI.</dd>
<dt>assertion</dt>
<dd style="margin-left: 8">REQUIRED. The assertion being used as an authorization grant. Specific serialization of the assertion is defined by profile documents. The serialization MUST be encoded for transport within HTTP forms. It is RECOMMENDED that base64url be used.</dd>
<dt>scope</dt>
<dd style="margin-left: 8">OPTIONAL. The request MAY contain a "scope" parameter. The scope of the access request is expressed as a list of space-delimited strings. The value is defined by the authorization server. If the value contains multiple space- delimited strings, their order does not matter, and each string adds an additional access range to the requested scope. When exchanging assertions for access_tokens, the authorization for the token has been previously granted through some other mechanism. As such, the requested scope SHOULD be equal or lesser than the scope originally granted to the authorized accessor. If the scope parameter and/or value is omitted, the scope SHOULD be treated as equal to the scope originally granted to the authorized accessor.  The Authorization Server SHOULD limit the scope of the issued access token to be equal or lesser than the scope originally granted to the authorized accessor.</dd>
</dl>
<p id="rfc.section.4.2.p.4">The following non-normative example demonstrates an assertion being used as an authorization grant. (line breaks are for display purposes only):</p>
<div id="#rfc.figure.2"></div>
<pre>POST /token HTTP/1.1 
Host: server.example.com 
Content-Type: application/x-www-form-urlencoded

client_id=s6BhdRkqt3&amp;
grant_type=urn%3Aoasis%3Anames%sAtc%3ASAML%3A2.0%3Aassertion&amp;
assertion=PHNhbWxwOl...[omitted for brevity]...ZT4</pre>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Assertion Content and Proccessing</h1>
<p id="rfc.section.5.p.1">This section provides a general content and processing model for the use of assertions in <a href="#I-D.ietf.oauth-v2">OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Assertion Metamodel</h1>
<p id="rfc.section.5.1.p.1">The following are entities and metadata involved in the issuance, exchange and processing of assertions in OAuth 2.0. These are general terms, abstract from any particular assertion format. Mappings of these terms into specific representations are provided by profiles of this specification.</p>
<p></p>

<dl>
<dt>Issuer</dt>
<dd style="margin-left: 8">The unique identifier for the entity that issued the assertion. Generally this is the entity that holds the keying material used to generate the assertion. In some use-cases Issuers may be either OAuth Clients (when assertions are self-asserted ) or a Security Token Service (an entity capable of issuing, renewing, transforming and validating of security tokens).</dd>
<dt>Principal</dt>
<dd style="margin-left: 8">A unique identifier for the subject of the assertion. When using assertions for client authentication, the Principal SHOULD be the client_id of the OAuth client. When using assertions as an authorization grant, the Principal MUST identify an authorized accessor for whom the access token is being requested (typically the resource owner, or an authorized delegate).</dd>
<dt>Audience</dt>
<dd style="margin-left: 8">A URI that identifies the Authorization Server as the intended audience. The audience SHOULD be the URL of the Token Endpoint as defined in section 2.2 of <a href="#I-D.ietf.oauth-v2">OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>.</dd>
<dt>Issued At </dt>
<dd style="margin-left: 8">The time at which the assertion was issued. While the serialization may differ by assertion format, this is always expressed in UTC with no time zone component.</dd>
<dt>Expires At </dt>
<dd style="margin-left: 8">The time at which the assertion expires.  While the serialization may differ by assertion format, this is always expressed in UTC with no time zone component.</dd>
<dt>Assertion ID</dt>
<dd style="margin-left: 8">A nonce or unique identifier for the assertion. The Assertion ID may be used by implementations requiring message de-duplication for one-time use assertions. Any entity that assigns an identifier MUST ensure that there is negligible probability that that entity or any other entity will accidentally assign the same identifier to a different data object.</dd>
</dl>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> General Assertion Format and Processing Rules</h1>
<p id="rfc.section.5.2.p.1">The following are general format and processing rules for the use of assertions in OAuth:</p>
<p></p>

<ul>
<li>The assertion MUST contain an Issuer. The Issuer MUST identify the entity that issued the assertion as recognized by the Authorization Server. If an assertion is self-asserted, the Issuer SHOULD be the client_id.</li>
<li>The assertion SHOULD contain a Principal. The Principal MUST identify an authorized accessor for whom the access token is being requested ( typically the resource owner, or an authorized delegate ) When the client is acting on behalf of itself, the Principal SHOULD be the client_id.</li>
<li>The assertion MUST contain an Audience that identifies the Authorization Server as the intended audience. The Authorization Server MUST verify that it is an intended audience for the assertion. The Audience SHOULD be the URL of the Authorization Server's Token Endpoint.</li>
<li>The assertion MUST contain an Expires At entity that limits the time window during which the assertion can be used. The authorization server MUST verify that the expiration time has not passed, subject to allowable clock skew between systems. The authorization server SHOULD reject assertions with an Expires At attribute value that is unreasonably far in the future.</li>
<li>The assertion MAY contain an Issued At entity containing the UTC time at which the assertion was issued.</li>
<li>The assertion MAY contain a Assertion ID. An Authorization Server MAY dictate that Assertion ID is mandatory.</li>
<li>The Authorization Server MUST validate the assertion in order to establish a mapping between the Issuer and the secret used to generate the assertion. The algortihm used to validate the assertion, and the mechanism for designating the secret used to generate assertion is out-of-scope for this specification.</li>
</ul>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Specific Assertion Format and Processing Rules</h1>
<p id="rfc.section.6.p.1">The following clarifies the format and processing rules defined in section 4 and section 5 for a number of common use-cases:</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> Client authentication</h1>
<p id="rfc.section.6.1.p.1">When a client authenticates to a token service using an assertion, it SHOULD do so according to section 4.1. The following format and processing rules SHOULD be applied:</p>

<ul>
<li>The client_id HTTP parameter MUST identify the client to the authorization server.</li>
<li>The client_assertion_type HTTP parameter MUST identify the assertion format being used for authentication.</li>
<li>The client_assertion HTTP parameter MUST contain the serialized assertion as in a format indicated by the client_assertion_type parameter.</li>
<li>The Issuer of the assertion MUST identify the entity that issued the assertion as recognized by the Authorization Server. If the assertion is self-asserted, the Issuer SHOULD be the client_id.</li>
<li>The Principal MUST identify an authorized accessor. If the assertion is self-issued, the Principal SHOULD be the client_id.</li>
<li>The Audience of the assertion MUST identify the Authorization Server and SHOULD be the URL of the Token Endpoint.</li>
<li>The Authorization Server MUST validate the assertion in order to establish a mapping between the Issuer and the secret used to generate the assertion.</li>
</ul>
<p id="rfc.section.6.1.p.2">The following non-normative example demonstrates the use of a client authenticating using an assertion during a Authorization Code Access Token Request as defined in <a href="#I-D.ietf.oauth-v2">Section 4.1.3 of OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>. (line breaks are for display purposes only):</p>
<div id="#rfc.figure.3"></div>
<pre>POST /token HTTP/1.1 
Host: server.example.com 
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code&amp;
code=i1WsRn1uB1&amp;
client_id=s6BhdRkqt3&amp;
client_assertion_type=urn%3Aoasis%3Anames%sAtc%3ASAML%3A2.0%3Aassertion&amp;
client_assertion=PHNhbWxwOl...[omitted for brevity]...ZT4</pre>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> Client acting on behalf of itself</h1>
<p id="rfc.section.6.2.p.1">When a client is accessing resources on behalf of itself, it SHOULD do so in a manner analagous to the Client Credentials flow defined in <a href="#I-D.ietf.oauth-v2">Section 4.4 of OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>. This is a special case that combines both the authentication and authorization grant usage patterns. In this case, the interactions with the authorization server SHOULD be treated as using an assertion for Client Authentication according to section 4.1, with the addition of a grant_type parameter. The following format and processing rules SHOULD be applied.</p>

<ul>
<li>The client_id HTTP parameter MUST identify the client to the authorization server.</li>
<li>The grant_type HTTP request parameter MUST be "client_credentials".</li>
<li>The client_assertion_type HTTP parameter MUST identify the assertion format.</li>
<li>The client_assertion HTTP parameter MUST contain the serialized assertion as in a format indicated by the client_assertion_type parameter.</li>
<li>The Issuer of the assertion MUST identify the entity that issued the assertion as recognized by the Authorization Server. If the assertion is self-asserted, the Issuer SHOULD be the client_id. If the assertion was issued by a Security Token Service, the Issuer SHOULD identify the STS as recognized by the Authorization Server.</li>
<li>The Principal SHOULD be the client_id.</li>
<li>The Audience of the assertion MUST identify the Authorization Server and SHOULD be the URL of the Token Endpoint.</li>
<li>The Authorization Server MUST validate the assertion in order to establish a mapping between the Issuer and the secret used to generate the assertion.</li>
</ul>
<p id="rfc.section.6.2.p.2">The following non-normative example demonstrates the use of a sample assertion being used for a Client Credentials Access Token Request as defined in <a href="#I-D.ietf.oauth-v2">Section 4.4.2 of OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>. (line breaks are for display purposes only):</p>
<div id="#rfc.figure.4"></div>
<pre>POST /token HTTP/1.1 
Host: server.example.com 
Content-Type: application/x-www-form-urlencoded

client_id=s6BhdRkqt3&amp;
grant_type=client_credentials&amp;
client_assertion_type=urn%3Aoasis%3Anames%sAtc%3ASAML%3A2.0%3Aassertion&amp;
client_assertion=PHNhbWxwOl...[omitted for brevity]...ZT4%3D</pre>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> Client acting on behalf of a user </h1>
<p id="rfc.section.6.3.p.1">When a client is accessing resources on behalf of a user, it SHOULD be treated as using an assertion as an Authorization Grant according to section 4.2. The following format and processing rules SHOULD be applied:</p>

<ul>
<li>The client_id HTTP parameter MUST identify the client to the authorization server.</li>
<li>The grant_type HTTP request parameter MUST indicate the assertion format.</li>
<li>The assertion HTTP parameter MUST contain the serialized assertion as in a format indicated by the grant_type parameter.</li>
<li>The Issuer of the assertion MUST identify the entity that issued the assertion as recognized by the Authorization Server. If the assertion is self-asserted, the Issuer SHOULD be the client_id. If the assertion was issued by a STS, the Issuer SHOULD identify the STS as recognized by the Authorization Server.</li>
<li>The Principal MUST identify an authorized accessor for whom the access token is being requested (typically the resource owner, or an authorized delegate).</li>
<li>The Audience of the assertion MUST identify the Authorization Server and MAY be the URL of the Token Endpoint.</li>
<li>The Authorization Server MUST validate the assertion in order to establish a mapping between the Issuer and the secret used to generate the assertion.</li>
</ul>
<p id="rfc.section.6.3.p.2">The following non-normative example demonstrates the use of a client authenticating using an assertion during a Authorization Code Access Token Request as defined in <a href="#I-D.ietf.oauth-v2">Section 4.1.3 of OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>. (line breaks are for display purposes only):</p>
<div id="#rfc.figure.5"></div>
<pre>POST /token HTTP/1.1 
Host: server.example.com 
Content-Type: application/x-www-form-urlencoded

client_id=s6BhdRkqt3&amp;
grant_type=urn%3Aoasis%3Anames%sAtc%3ASAML%3A2.0%3Aassertion&amp;
assertion=PHNhbWxwOl...[omitted for brevity]...ZT4%3D</pre>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> Client acting on behalf of an anonymous user</h1>
<p id="rfc.section.6.4.p.1">When a client is accessing resources on behalf of an anonymous user, the following format and processing rules SHOULD be applied:</p>

<ul>
<li>The client_id HTTP parameter MUST identify the client to the authorization server.</li>
<li>The grant_type HTTP request parameter MUST indicate the assertion format.</li>
<li>The assertion HTTP parameter MUST contain the serialized assertion as in a format indicated by the grant_type parameter.</li>
<li>The Issuer of the assertion MUST identify the entity that issued the assertion as recognized by the Authorization Server. If the assertion is self-asserted, the Issuer SHOULD be the client_id. If the assertion was issued by a Security Token Service, the Issuer SHOULD identify the STS as recognized by the Authorization Server.</li>
<li>The Principal SHOULD indicate to the Authorization Server that the client is acting on-behalf of an anonymous user as defined by the Authorization Server. It is implied that authorizaion is based upon additional criteria, such as additional attributes or claims provided in the assertion. For example, a client may present an assertion from a trusted issuer asserting that the bearer is over 18 via an included claim. In this case, no additional information about the user's identity is included yet all the data needed to issue an access token is present.</li>
<li>The Audience of the assertion MUST identify the Authorization Server and MAY be the URL of the Token Endpoint.</li>
<li>The Authorization Server MUST validate the assertion in order to establish a mapping between the Issuer and the secret used to generate the assertion.</li>
</ul>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Error Responses</h1>
<p id="rfc.section.7.p.1">If an assertion is not valid or has expired, the Authorization Server MUST construct an error response as defined in <a href="#I-D.ietf.oauth-v2">OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>. The value of the error parameter MUST be the "invalid_grant" error code. The authorization server MAY include additional information regarding the reasons the assertion was considered invalid using the "error_description" or "error_uri" parameters.</p>
<p id="rfc.section.7.p.2">For example:</p>
<div id="#rfc.figure.6"></div>
<pre>HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store

{
"error":"invalid_grant",
"error_description":"Audience validation failed"
}</pre>
<p></p>
<p id="rfc.section.7.p.4">A client MUST NOT include client credentials using more than one mechanism. Token endpoints can differentiate between assertion based credentials and other client credential types by looking for the presence of the client_assertion and client_assertion_type attributes which will only be present when using assertions for client authentication. If more than one mechanism is used, the Authorization Server MUST construct an error response as defined in <a href="#I-D.ietf.oauth-v2">OAuth 2.0</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>. The value of the error parameter MUST be the &#8220;invalid_client&#8221; error code. The authorization server MAY include additional information regarding the reasons the client was considered invalid using the "error_description" or "error_uri" parameters.</p>
<p id="rfc.section.7.p.5">For example:</p>
<div id="#rfc.figure.7"></div>
<pre>HTTP/1.1 400 Bad Request
Content-Type: application/json
Cache-Control: no-store

{
"error":"invalid_client"
"error_description":"Multiple Credentials Not Allowed"
}</pre>
<p></p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.8.p.1">No additional considerations beyond those described within the <a href="#I-D.ietf.oauth-v2">OAuth 2.0 Protocol Framework</a> <cite title="NONE">[I-D.ietf.oauth-v2]</cite>.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Acknowledgements</h1>
<p id="rfc.section.9.p.1">The authors wish to thank the following people that have influenced or contributed this specification: Paul Madsen, Eric Sachs, Jian Cai, Tony Nadlin, the authors of OAuth WRAP, and those in the OAuth 2 working group.</p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf.oauth-v2">[I-D.ietf.oauth-v2]</b></td>
<td class="top">
<a title="Yahoo!">Hammer-Lahav, E.</a>, "<a>The OAuth 2.0 Authorization Protocol</a>", April 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Chuck Mortimore</span> editor
	  <span class="n hidden">
		<span class="family-name">Mortimore</span>
	  </span>
	</span>
	<span class="org vcardline">Salesforce.com</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:cmortimore@salesforce.com">cmortimore@salesforce.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Michael B. Jones</span> 
	  <span class="n hidden">
		<span class="family-name">Jones</span>
	  </span>
	</span>
	<span class="org vcardline">Microsoft</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mbj@microsoft.com">mbj@microsoft.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Brian Campbell</span> 
	  <span class="n hidden">
		<span class="family-name">Campbell</span>
	  </span>
	</span>
	<span class="org vcardline">Ping Identity</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:bcampbell@pingidentity.com">bcampbell@pingidentity.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Yaron Goland</span> 
	  <span class="n hidden">
		<span class="family-name">Goland</span>
	  </span>
	</span>
	<span class="org vcardline">Microsoft</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:yarong@microsoft.com">yarong@microsoft.com</a></span>

  </address>
</div>

</body>
</html>