<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Ephemeral Diffie-Hellman Over COSE (EDHOC)</title>
<meta content="Göran Selander" name="author">
<meta content="John Preuß Mattsson" name="author">
<meta content="Francesca Palombini" name="author">
<meta content="
       This document specifies Ephemeral Diffie-Hellman Over COSE (EDHOC), a very compact and lightweight authenticated Diffie-Hellman key exchange with ephemeral keys. EDHOC provides mutual authentication, forward secrecy, and identity protection. EDHOC is intended for usage in constrained scenarios and a main use case is to establish an OSCORE security context. By reusing COSE for cryptography, CBOR for encoding, and CoAP for transport, the additional code size can be kept very low. 
    " name="description">
<meta content="xml2rfc 3.9.1" name="generator">
<meta content="draft-ietf-lake-edhoc-11" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.9.1
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.2
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 58.0.4
    six 1.16.0
-->
<link href="/tmp/draft-ietf-lake-edhoc-11-jvgbkatc.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">EDHOC</td>
<td class="right">September 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Selander, et al.</td>
<td class="center">Expires 28 March 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-lake-edhoc-11</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-09-24" class="published">24 September 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-03-28">28 March 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">G. Selander</div>
<div class="org">Ericsson</div>
</div>
<div class="author">
      <div class="author-name">J. Preuß Mattsson</div>
<div class="org">Ericsson</div>
</div>
<div class="author">
      <div class="author-name">F. Palombini</div>
<div class="org">Ericsson</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Ephemeral Diffie-Hellman Over COSE (EDHOC)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies Ephemeral Diffie-Hellman Over COSE (EDHOC), a very compact and lightweight authenticated Diffie-Hellman key exchange with ephemeral keys. EDHOC provides mutual authentication, forward secrecy, and identity protection. EDHOC is intended for usage in constrained scenarios and a main use case is to establish an OSCORE security context. By reusing COSE for cryptography, CBOR for encoding, and CoAP for transport, the additional code size can be kept very low.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Lightweight Authenticated Key Exchange Working Group mailing list (lake@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/lake/">https://mailarchive.ietf.org/arch/browse/lake/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/lake-wg/edhoc">https://github.com/lake-wg/edhoc</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 28 March 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="ulBare ulEmpty compact toc">
<li class="ulBare ulEmpty compact toc" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-motivation" class="xref">Motivation</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-use-of-edhoc" class="xref">Use of EDHOC</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="xref">1.3</a>.  <a href="#name-message-size-examples" class="xref">Message Size Examples</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.1.2.4">
                <p id="section-toc.1-1.1.2.4.1"><a href="#section-1.4" class="xref">1.4</a>.  <a href="#name-document-structure" class="xref">Document Structure</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.1.2.5">
                <p id="section-toc.1-1.1.2.5.1"><a href="#section-1.5" class="xref">1.5</a>.  <a href="#name-terminology-and-requirement" class="xref">Terminology and Requirements Language</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-edhoc-outline" class="xref">EDHOC Outline</a></p>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-protocol-elements" class="xref">Protocol Elements</a></p>
<ul class="ulBare ulEmpty compact toc">
<li class="ulBare ulEmpty compact toc" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-general" class="xref">General</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-method" class="xref">Method</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-connection-identifiers" class="xref">Connection Identifiers</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-transport" class="xref">Transport</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-authentication-parameters" class="xref">Authentication Parameters</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="xref">3.6</a>.  <a href="#name-cipher-suites" class="xref">Cipher Suites</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.3.2.7">
                <p id="section-toc.1-1.3.2.7.1"><a href="#section-3.7" class="xref">3.7</a>.  <a href="#name-ephemeral-public-keys" class="xref">Ephemeral Public Keys</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.3.2.8">
                <p id="section-toc.1-1.3.2.8.1"><a href="#section-3.8" class="xref">3.8</a>.  <a href="#name-external-authorization-data" class="xref">External Authorization Data (EAD)</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.3.2.9">
                <p id="section-toc.1-1.3.2.9.1"><a href="#section-3.9" class="xref">3.9</a>.  <a href="#name-applicability-statement" class="xref">Applicability Statement</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-key-derivation" class="xref">Key Derivation</a></p>
<ul class="ulBare ulEmpty compact toc">
<li class="ulBare ulEmpty compact toc" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-extract" class="xref">Extract</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-expand" class="xref">Expand</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-edhoc-exporter" class="xref">EDHOC-Exporter</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-edhoc-keyupdate" class="xref">EDHOC-KeyUpdate</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-message-formatting-and-proc" class="xref">Message Formatting and Processing</a></p>
<ul class="ulBare ulEmpty compact toc">
<li class="ulBare ulEmpty compact toc" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-message-processing-outline" class="xref">Message Processing Outline</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-edhoc-message-1" class="xref">EDHOC Message 1</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-edhoc-message-2" class="xref">EDHOC Message 2</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-edhoc-message-3" class="xref">EDHOC Message 3</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="xref">5.5</a>.  <a href="#name-edhoc-message-4" class="xref">EDHOC Message 4</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-error-handling" class="xref">Error Handling</a></p>
<ul class="ulBare ulEmpty compact toc">
<li class="ulBare ulEmpty compact toc" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-success" class="xref">Success</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-unspecified" class="xref">Unspecified</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-wrong-selected-cipher-suite" class="xref">Wrong Selected Cipher Suite</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-mandatory-to-implement-comp" class="xref">Mandatory-to-Implement Compliance Requirements</a></p>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="ulBare ulEmpty compact toc">
<li class="ulBare ulEmpty compact toc" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-security-properties" class="xref">Security Properties</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-cryptographic-consideration" class="xref">Cryptographic Considerations</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-cipher-suites-and-cryptogra" class="xref">Cipher Suites and Cryptographic Algorithms</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="xref">8.4</a>.  <a href="#name-unprotected-data" class="xref">Unprotected Data</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="xref">8.5</a>.  <a href="#name-denial-of-service" class="xref">Denial-of-Service</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="xref">8.6</a>.  <a href="#name-implementation-consideratio" class="xref">Implementation Considerations</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
<ul class="ulBare ulEmpty compact toc">
<li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-edhoc-exporter-label-regist" class="xref">EDHOC Exporter Label Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-edhoc-cipher-suites-registr" class="xref">EDHOC Cipher Suites Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="xref">9.3</a>.  <a href="#name-edhoc-method-type-registry" class="xref">EDHOC Method Type Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="xref">9.4</a>.  <a href="#name-edhoc-error-codes-registry" class="xref">EDHOC Error Codes Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="xref">9.5</a>.  <a href="#name-edhoc-external-authorizatio" class="xref">EDHOC External Authorization Data Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.6">
                <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="xref">9.6</a>.  <a href="#name-cose-header-parameters-regi" class="xref">COSE Header Parameters Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.7">
                <p id="section-toc.1-1.9.2.7.1"><a href="#section-9.7" class="xref">9.7</a>.  <a href="#name-cose-header-parameters-regis" class="xref">COSE Header Parameters Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.8">
                <p id="section-toc.1-1.9.2.8.1"><a href="#section-9.8" class="xref">9.8</a>.  <a href="#name-cose-key-common-parameters-" class="xref">COSE Key Common Parameters Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.9">
                <p id="section-toc.1-1.9.2.9.1"><a href="#section-9.9" class="xref">9.9</a>.  <a href="#name-cwt-confirmation-methods-re" class="xref">CWT Confirmation Methods Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.10">
                <p id="section-toc.1-1.9.2.10.1"><a href="#section-9.10" class="xref">9.10</a>. <a href="#name-the-well-known-uri-registry" class="xref">The Well-Known URI Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.11">
                <p id="section-toc.1-1.9.2.11.1"><a href="#section-9.11" class="xref">9.11</a>. <a href="#name-media-types-registry" class="xref">Media Types Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.12">
                <p id="section-toc.1-1.9.2.12.1"><a href="#section-9.12" class="xref">9.12</a>. <a href="#name-coap-content-formats-regist" class="xref">CoAP Content-Formats Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.13">
                <p id="section-toc.1-1.9.2.13.1"><a href="#section-9.13" class="xref">9.13</a>. <a href="#name-resource-type-rt-link-targe" class="xref">Resource Type (rt=) Link Target Attribute Values Registry</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.9.2.14">
                <p id="section-toc.1-1.9.2.14.1"><a href="#section-9.14" class="xref">9.14</a>. <a href="#name-expert-review-instructions" class="xref">Expert Review Instructions</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="ulBare ulEmpty compact toc">
<li class="ulBare ulEmpty compact toc" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-use-with-oscore-and-transfe" class="xref">Use with OSCORE and Transfer over CoAP</a></p>
<ul class="ulBare ulEmpty compact toc">
<li class="ulBare ulEmpty compact toc" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#appendix-A.1" class="xref">A.1</a>.  <a href="#name-selecting-edhoc-connection-" class="xref">Selecting EDHOC Connection Identifier</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#appendix-A.2" class="xref">A.2</a>.  <a href="#name-deriving-the-oscore-securit" class="xref">Deriving the OSCORE Security Context</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#appendix-A.3" class="xref">A.3</a>.  <a href="#name-transferring-edhoc-over-coa" class="xref">Transferring EDHOC over CoAP</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-compact-representation" class="xref">Compact Representation</a></p>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-C" class="xref">Appendix C</a>.  <a href="#name-use-of-cbor-cddl-and-cose-i" class="xref">Use of CBOR, CDDL and COSE in EDHOC</a></p>
<ul class="ulBare ulEmpty compact toc">
<li class="ulBare ulEmpty compact toc" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#appendix-C.1" class="xref">C.1</a>.  <a href="#name-cbor-and-cddl" class="xref">CBOR and CDDL</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#appendix-C.2" class="xref">C.2</a>.  <a href="#name-cddl-definitions" class="xref">CDDL Definitions</a></p>
</li>
              <li class="ulBare ulEmpty compact toc" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#appendix-C.3" class="xref">C.3</a>.  <a href="#name-cose" class="xref">COSE</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-D" class="xref">Appendix D</a>.  <a href="#name-applicability-template" class="xref">Applicability Template</a></p>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-E" class="xref">Appendix E</a>.  <a href="#name-edhoc-message-deduplication" class="xref">EDHOC Message Deduplication</a></p>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-F" class="xref">Appendix F</a>.  <a href="#name-transports-not-natively-pro" class="xref">Transports Not Natively Providing Correlation</a></p>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-G" class="xref">Appendix G</a>.  <a href="#name-change-log" class="xref">Change Log</a></p>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#appendix-H" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#appendix-I" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<div id="motivation">
<section id="section-1.1">
        <h3 id="name-motivation">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-motivation" class="section-name selfRef">Motivation</a>
        </h3>
<p id="section-1.1-1">Many Internet of Things (IoT) deployments require technologies which are highly performant in constrained environments <span>[<a href="#RFC7228" class="xref">RFC7228</a>]</span>. IoT devices may be constrained in various ways, including memory, storage, processing capacity, and power. The connectivity for these settings may also exhibit constraints such as unreliable and lossy channels, highly restricted bandwidth, and dynamic topology. The IETF has acknowledged this problem by standardizing a range of lightweight protocols and enablers designed for the IoT, including the Constrained Application Protocol (CoAP, <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>), Concise Binary Object Representation (CBOR, <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span>), and Static Context Header Compression (SCHC, <span>[<a href="#RFC8724" class="xref">RFC8724</a>]</span>).<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">The need for special protocols targeting constrained IoT deployments extends also to the security domain <span>[<a href="#I-D.ietf-lake-reqs" class="xref">I-D.ietf-lake-reqs</a>]</span>. Important characteristics in constrained environments are the number of round trips and protocol message sizes, which if kept low can contribute to good performance by enabling transport over a small number of radio frames, reducing latency due to fragmentation or duty cycles, etc. Another important criteria is code size, which may be prohibitive for certain deployments due to device capabilities or network load during firmware update. Some IoT deployments also need to support a variety of underlying transport technologies, potentially even with a single connection.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">Some security solutions for such settings exist already. CBOR Object Signing and Encryption (COSE, <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>) specifies basic application-layer security services efficiently encoded in CBOR. Another example is Object Security for Constrained RESTful Environments (OSCORE, <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>) which is a lightweight communication security extension to CoAP using CBOR and COSE. In order to establish good quality cryptographic keys for security protocols such as COSE and OSCORE, the two endpoints may run an authenticated Diffie-Hellman key exchange protocol, from which shared secret key material can be derived. Such a key exchange protocol should also be lightweight; to prevent bad performance in case of repeated use, e.g., due to device rebooting or frequent rekeying for security reasons; or to avoid latencies in a network formation setting with many devices authenticating at the same time.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">This document specifies Ephemeral Diffie-Hellman Over COSE (EDHOC), a lightweight authenticated key exchange protocol providing good security properties including forward secrecy, identity protection, and cipher suite negotiation. Authentication can be based on raw public keys (RPK) or public key certificates and requires the application to provide input on how to verify that endpoints are trusted. This specification focuses on referencing instead of transporting credentials to reduce message overhead. EDHOC does currently not support pre-shared key (PSK) authentication as authentication with static Diffie-Hellman public keys by reference produces equally small message sizes but with much simpler key distribution and identity protection.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">EDHOC makes use of known protocol constructions, such as SIGMA <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span> and Extract-and-Expand <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>. EDHOC uses COSE for cryptography and identification of credentials (including COSE_Key, CWT, CCS, X.509, C509, see <a href="#auth-cred" class="xref">Section 3.5.3</a>). COSE provides crypto agility and enables the use of future algorithms and credentials targeting IoT.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="use-of-edhoc">
<section id="section-1.2">
        <h3 id="name-use-of-edhoc">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-use-of-edhoc" class="section-name selfRef">Use of EDHOC</a>
        </h3>
<p id="section-1.2-1">EDHOC is designed for highly constrained settings making it especially suitable for low-power wide area networks <span>[<a href="#RFC8376" class="xref">RFC8376</a>]</span> such as Cellular IoT, 6TiSCH, and LoRaWAN. A main objective for EDHOC is to be a lightweight authenticated key exchange for OSCORE, i.e., to provide authentication and session key establishment for IoT use cases such as those built on CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>. CoAP is a specialized web transfer protocol for use with constrained nodes and networks, providing a request/response interaction model between application endpoints. As such, EDHOC is targeting a large variety of use cases involving 'things' with embedded microcontrollers, sensors, and actuators.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">A typical setting is when one of the endpoints is constrained or in a constrained network, and the other endpoint is a node on the Internet (such as a mobile phone) or at the edge of the constrained network (such as a gateway). Thing-to-thing interactions over constrained networks are also relevant since both endpoints would then benefit from the lightweight properties of the protocol. EDHOC could e.g., be run when a device connects for the first time, or to establish fresh keys which are not revealed by a later compromise of the long-term keys. Further security properties are described in <a href="#sec-prop" class="xref">Section 8.1</a>.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<p id="section-1.2-3">EDHOC enables the reuse of the same lightweight primitives as OSCORE: CBOR for encoding, COSE for cryptography, and CoAP for transport. By reusing existing libraries, the additional code size can be kept very low. Note that, while CBOR and COSE primitives are built into the protocol messages, EDHOC is not bound to a particular transport. Transfer of EDHOC messages in CoAP payloads is detailed in <a href="#coap" class="xref">Appendix A.3</a>.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="message-size-examples">
<section id="section-1.3">
        <h3 id="name-message-size-examples">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-message-size-examples" class="section-name selfRef">Message Size Examples</a>
        </h3>
<p id="section-1.3-1">Compared to the DTLS 1.3 handshake <span>[<a href="#I-D.ietf-tls-dtls13" class="xref">I-D.ietf-tls-dtls13</a>]</span> with ECDHE and connection ID, the number of bytes in EDHOC + CoAP can be less than 1/6 when RPK authentication is used, see <span>[<a href="#I-D.ietf-lwig-security-protocol-comparison" class="xref">I-D.ietf-lwig-security-protocol-comparison</a>]</span>. <a href="#fig-sizes" class="xref">Figure 1</a> shows examples of message sizes for EDHOC with different kinds of authentication keys and different COSE header parameters for identification: static Diffie-Hellman keys or signature keys, either in CBOR Web Token (CWT) / CWT Claims Set (CCS) <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span> identified by a key identifier using 'kid' <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>, or in X.509 certificates identified by a hash value using 'x5t' <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span>.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<span id="name-example-of-message-sizes-in"></span><div id="fig-sizes">
<figure id="figure-1">
          <div class="artwork art-text alignCenter" id="section-1.3-2.1">
<pre>
========================================================
                    Static DH Keys        Signature Keys
                    --------------        --------------
                    kid        x5t        kid        x5t
--------------------------------------------------------
message_1            37         37         37         37
message_2            45         58        102        115
message_3            19         33         77         90
--------------------------------------------------------
Total               101        128        216        242
========================================================
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-example-of-message-sizes-in" class="selfRef">Example of message sizes in bytes.</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="document-structure">
<section id="section-1.4">
        <h3 id="name-document-structure">
<a href="#section-1.4" class="section-number selfRef">1.4. </a><a href="#name-document-structure" class="section-name selfRef">Document Structure</a>
        </h3>
<p id="section-1.4-1">The remainder of the document is organized as follows: <a href="#background" class="xref">Section 2</a> outlines EDHOC authenticated with digital signatures, <a href="#overview" class="xref">Section 3</a> describes the protocol elements of EDHOC, including formatting of the ephemeral public keys, <a href="#key-der" class="xref">Section 4</a> specifies the key derivation, <a href="#asym" class="xref">Section 5</a> specifies message processing for EDHOC authenticated with signature keys or static Diffie-Hellman keys, <a href="#error" class="xref">Section 6</a> describes the error messages, and <a href="#transfer" class="xref">Appendix A</a> shows how to transfer EDHOC with CoAP and establish an OSCORE security context.<a href="#section-1.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="term">
<section id="section-1.5">
        <h3 id="name-terminology-and-requirement">
<a href="#section-1.5" class="section-number selfRef">1.5. </a><a href="#name-terminology-and-requirement" class="section-name selfRef">Terminology and Requirements Language</a>
        </h3>
<p id="section-1.5-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-1.5-1" class="pilcrow">¶</a></p>
<p id="section-1.5-2">Readers are expected to be familiar with the terms and concepts described in CBOR <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span>, CBOR Sequences <span>[<a href="#RFC8742" class="xref">RFC8742</a>]</span>, COSE structures and processing <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>, COSE algorithms <span>[<a href="#I-D.ietf-cose-rfc8152bis-algs" class="xref">I-D.ietf-cose-rfc8152bis-algs</a>]</span>, CWT and CWT Claims Set <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span>, and CDDL <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span>. The Concise Data Definition Language (CDDL) is used to express CBOR data structures <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span>. Examples of CBOR and CDDL are provided in <a href="#CBOR" class="xref">Appendix C.1</a>. When referring to CBOR, this specification always refers to Deterministically Encoded CBOR as specified in Sections 4.2.1 and 4.2.2 of <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span>. The single output from authenticated encryption (including the authentication tag) is called "ciphertext", following <span>[<a href="#RFC5116" class="xref">RFC5116</a>]</span>.<a href="#section-1.5-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="background">
<section id="section-2">
      <h2 id="name-edhoc-outline">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-edhoc-outline" class="section-name selfRef">EDHOC Outline</a>
      </h2>
<p id="section-2-1">EDHOC specifies different authentication methods of the Diffie-Hellman key exchange: digital signatures and static Diffie-Hellman keys. This section outlines the digital signature-based method. Further details of protocol elements and other authentication methods are provided in the remainder of this document.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">SIGMA (SIGn-and-MAc) is a family of theoretical protocols with a large number of variants <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>. Like IKEv2 <span>[<a href="#RFC7296" class="xref">RFC7296</a>]</span> and (D)TLS 1.3 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>, EDHOC authenticated with digital signatures is built on a variant of the SIGMA protocol which provides identity protection of the initiator (SIGMA-I), and like IKEv2 <span>[<a href="#RFC7296" class="xref">RFC7296</a>]</span>, EDHOC implements the MAC-then-Sign variant of the SIGMA-I protocol shown in <a href="#fig-sigma" class="xref">Figure 2</a>.<a href="#section-2-2" class="pilcrow">¶</a></p>
<span id="name-mac-then-sign-variant-of-th"></span><div id="fig-sigma">
<figure id="figure-2">
        <div class="artwork art-text alignCenter" id="section-2-3.1">
<pre>
Initiator                                                   Responder
|                                G_X                                |
+------------------------------------------------------------------&gt;|
|                                                                   |
|      G_Y, Enc( ID_CRED_R, Sig( R; MAC( CRED_R, G_X, G_Y ) ) )     |
|&lt;------------------------------------------------------------------+
|                                                                   |
|        AEAD( ID_CRED_I, Sig( I; MAC( CRED_I, G_Y, G_X ) ) )       |
+------------------------------------------------------------------&gt;|
|                                                                   |
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-mac-then-sign-variant-of-th" class="selfRef">MAC-then-Sign variant of the SIGMA-I protocol.</a>
        </figcaption></figure>
</div>
<p id="section-2-4">The parties exchanging messages are called Initiator (I) and Responder (R). They exchange ephemeral public keys, compute a shared secret, and derive symmetric application keys used to protect application data.<a href="#section-2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-5.1">G_X and G_Y are the ECDH ephemeral public keys of I and R, respectively.<a href="#section-2-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.2">CRED_I and CRED_R are the credentials containing the public authentication keys of I and R, respectively.<a href="#section-2-5.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.3">ID_CRED_I and ID_CRED_R are credential identifiers enabling the recipient party to retrieve the credential of I and R, respectively.<a href="#section-2-5.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.4">Sig(I; . ) and Sig(R; . ) denote signatures made with the private authentication key of I and R, respectively.<a href="#section-2-5.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-5.5">Enc(), AEAD(), and MAC() denotes encryption, authenticated encryption with additional data, and message authentication code using keys derived from the shared secret.<a href="#section-2-5.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-6">In order to create a "full-fledged" protocol some additional protocol elements are needed. EDHOC adds:<a href="#section-2-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-7.1">Transcript hashes (hashes of message data) TH_2, TH_3, TH_4 used for key derivation and as additional authenticated data.<a href="#section-2-7.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-7.2">Computationally independent keys derived from the ECDH shared secret and used for authenticated encryption of different messages.<a href="#section-2-7.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-7.3">An optional fourth message giving explicit key confirmation to I in deployments where no protected application data is sent from R to I.<a href="#section-2-7.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-7.4">A key material exporter and a key update function enabling forward secrecy.<a href="#section-2-7.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-7.5">Verification of a common preferred cipher suite.<a href="#section-2-7.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-7.6">Method types and error handling.<a href="#section-2-7.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-7.7">Selection of connection identifiers C_I and C_R which may be used to identify established keys or protocol state.<a href="#section-2-7.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-7.8">Transport of external authorization data.<a href="#section-2-7.8" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-8">EDHOC is designed to encrypt and integrity protect as much information as possible, and all symmetric keys are derived using as much previous information as possible. EDHOC is furthermore designed to be as compact and lightweight as possible, in terms of message sizes, processing, and the ability to reuse already existing CBOR, COSE, and CoAP libraries.<a href="#section-2-8" class="pilcrow">¶</a></p>
<p id="section-2-9">To simplify for implementors, the use of CBOR and COSE in EDHOC is summarized in <a href="#CBORandCOSE" class="xref">Appendix C</a>. Test vectors including CBOR diagnostic notation are provided in <span>[<a href="#I-D.selander-lake-traces" class="xref">I-D.selander-lake-traces</a>]</span>.<a href="#section-2-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="overview">
<section id="section-3">
      <h2 id="name-protocol-elements">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-protocol-elements" class="section-name selfRef">Protocol Elements</a>
      </h2>
<div id="general">
<section id="section-3.1">
        <h3 id="name-general">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-general" class="section-name selfRef">General</a>
        </h3>
<p id="section-3.1-1">The EDHOC protocol consists of three mandatory messages (message_1, message_2, message_3) between Initiator and Responder, an optional fourth message (message_4), and an error message. All EDHOC messages are CBOR Sequences <span>[<a href="#RFC8742" class="xref">RFC8742</a>]</span>. <a href="#fig-flow" class="xref">Figure 3</a> illustrates an EDHOC message flow with the optional fourth message as well as the content of each message. The protocol elements in the figure are introduced in <a href="#overview" class="xref">Section 3</a> and <a href="#asym" class="xref">Section 5</a>. Message formatting and processing is specified in <a href="#asym" class="xref">Section 5</a> and <a href="#error" class="xref">Section 6</a>.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">Application data may be protected using the agreed application algorithms (AEAD, hash) in the selected cipher suite (see <a href="#cs" class="xref">Section 3.6</a>) and the application can make use of the established connection identifiers C_I and C_R (see <a href="#ci" class="xref">Section 3.3</a>). EDHOC may be used with the media type application/edhoc defined in <a href="#iana" class="xref">Section 9</a>.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">The Initiator can derive symmetric application keys after creating EDHOC message_3, see <a href="#exporter" class="xref">Section 4.3</a>. Protected application data can therefore be sent in parallel or together with EDHOC message_3. EDHOC message_4 is typically not sent.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<span id="name-edhoc-message-flow-with-the"></span><div id="fig-flow">
<figure id="figure-3">
          <div class="artwork art-text alignCenter" id="section-3.1-4.1">
<pre>
Initiator                                                   Responder
|                 METHOD, SUITES_I, G_X, C_I, EAD_1                 |
+------------------------------------------------------------------&gt;|
|                             message_1                             |
|                                                                   |
|       G_Y, Enc( ID_CRED_R, Signature_or_MAC_2, EAD_2 ), C_R       |
|&lt;------------------------------------------------------------------+
|                             message_2                             |
|                                                                   |
|            AEAD( ID_CRED_I, Signature_or_MAC_3, EAD_3 )           |
+------------------------------------------------------------------&gt;|
|                             message_3                             |
|                                                                   |
|                           AEAD( EAD_4 )                           |
|&lt;- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
|                             message_4                             |
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-edhoc-message-flow-with-the" class="selfRef">EDHOC Message Flow with the Optional Fourth Message</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="method">
<section id="section-3.2">
        <h3 id="name-method">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-method" class="section-name selfRef">Method</a>
        </h3>
<p id="section-3.2-1">The data item METHOD in message_1 (see <a href="#asym-msg1-form" class="xref">Section 5.2.1</a>), is an integer specifying the authentication method. EDHOC supports authentication with signature or static Diffie-Hellman keys, as defined in the four authentication methods: 0, 1, 2, and 3, see <a href="#fig-method-types" class="xref">Figure 4</a>. When using a static Diffie-Hellman key the authentication is provided by a Message Authentication Code (MAC) computed from an ephemeral-static ECDH shared secret which enables significant reductions in message sizes.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">The Initiator and the Responder need to have agreed on a single method to be used for EDHOC, see <a href="#applicability" class="xref">Section 3.9</a>.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<span id="name-method-types"></span><div id="fig-method-types">
<figure id="figure-4">
          <div class="artwork art-text alignCenter" id="section-3.2-3.1">
<pre>
+-------+-------------------+-------------------+-------------------+
| Value | Initiator         | Responder         | Reference         |
+-------+-------------------+-------------------+-------------------+
|     0 | Signature Key     | Signature Key     | [[this document]] |
|     1 | Signature Key     | Static DH Key     | [[this document]] |
|     2 | Static DH Key     | Signature Key     | [[this document]] |
|     3 | Static DH Key     | Static DH Key     | [[this document]] |
+-------+-------------------+-------------------+-------------------+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-method-types" class="selfRef">Method Types</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="ci">
<section id="section-3.3">
        <h3 id="name-connection-identifiers">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-connection-identifiers" class="section-name selfRef">Connection Identifiers</a>
        </h3>
<p id="section-3.3-1">EDHOC includes the selection of connection identifiers (C_I, C_R) identifying a connection for which keys are agreed.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">Connection identifiers may be used to correlate EDHOC messages and facilitate the retrieval of protocol state during EDHOC protocol execution (see <a href="#transport" class="xref">Section 3.4</a>) or in a subsequent application protocol, e.g., OSCORE (see <a href="#ci-oscore" class="xref">Section 3.3.2</a>). The connection identifiers do not have any cryptographic purpose in EDHOC.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">Connection identifiers in EDHOC are byte strings or integers, encoded in CBOR. One byte connection identifiers (the integers -24 to 23 and the empty CBOR byte string h'') are realistic in many scenarios as most constrained devices only have a few connections.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
<div id="selection-of-connection-identifiers">
<section id="section-3.3.1">
          <h4 id="name-selection-of-connection-ide">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-selection-of-connection-ide" class="section-name selfRef">Selection of Connection Identifiers</a>
          </h4>
<p id="section-3.3.1-1">C_I and C_R are chosen by I and R, respectively. The Initiator selects C_I and sends it in message_1 for the Responder to use as a reference to the connection in communications with the Initiator. The Responder selects C_R and sends in message_2 for the Initiator to use as a reference to the connection in communications with the Responder.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2">If connection identifiers are used by an application protocol for which EDHOC establishes keys then the selected connection identifiers SHALL adhere to the requirements for that protocol, see <a href="#ci-oscore" class="xref">Section 3.3.2</a> for an example.<a href="#section-3.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ci-oscore">
<section id="section-3.3.2">
          <h4 id="name-use-of-connection-identifie">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-use-of-connection-identifie" class="section-name selfRef">Use of Connection Identifiers with OSCORE</a>
          </h4>
<p id="section-3.3.2-1">For OSCORE, the choice of a connection identifier results in the endpoint selecting its Recipient ID, see Section 3.1 of <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>, for which certain uniqueness requirements apply, see Section 3.3 of <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>. Therefore, the Initiator and the Responder MUST NOT select connection identifiers such that it results in same OSCORE Recipient ID. Since the Recipient ID is a byte string and a EDHOC connection identifier is either a CBOR byte string or a CBOR integer, care must be taken when selecting the connection identifiers and converting them to Recipient IDs. A mapping from EDHOC connection identifier to OSCORE Recipient ID is specified in <a href="#edhoc-to-oscore" class="xref">Appendix A.1</a>.<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="transport">
<section id="section-3.4">
        <h3 id="name-transport">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-transport" class="section-name selfRef">Transport</a>
        </h3>
<p id="section-3.4-1">Cryptographically, EDHOC does not put requirements on the lower layers. EDHOC is not bound to a particular transport layer and can even be used in environments without IP. The transport is responsible, where necessary, to handle:<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.4-2.1">message loss,<a href="#section-3.4-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.4-2.2">message reordering,<a href="#section-3.4-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.4-2.3">message duplication,<a href="#section-3.4-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.4-2.4">fragmentation,<a href="#section-3.4-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.4-2.5">demultiplex EDHOC messages from other types of messages,<a href="#section-3.4-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.4-2.6">denial-of-service protection,<a href="#section-3.4-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.4-2.7">message correlation.<a href="#section-3.4-2.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.4-3">The Initiator and the Responder need to have agreed on a transport to be used for EDHOC, see <a href="#applicability" class="xref">Section 3.9</a>.<a href="#section-3.4-3" class="pilcrow">¶</a></p>
<div id="ci-edhoc">
<section id="section-3.4.1">
          <h4 id="name-use-of-connection-identifier">
<a href="#section-3.4.1" class="section-number selfRef">3.4.1. </a><a href="#name-use-of-connection-identifier" class="section-name selfRef">Use of Connection Identifiers for EDHOC Message Correlation</a>
          </h4>
<p id="section-3.4.1-1">The transport needs to support the correlation between EDHOC messages and facilitate the retrieval of protocol state during EDHOC protocol execution, including an indication of a message being message_1. The correlation may reuse existing mechanisms in the transport protocol. For example, the CoAP Token may be used to correlate EDHOC messages in a CoAP response and an associated CoAP request.<a href="#section-3.4.1-1" class="pilcrow">¶</a></p>
<p id="section-3.4.1-2">Connection identifiers may be used to correlate EDHOC messages and facilitate the retrieval of protocol state during EDHOC protocol execution.  EDHOC transports that do not inherently provide correlation across all messages of an exchange can send connection identifiers along with EDHOC messages to gain that required capability, e.g., by prepending the appropriate connection identifier (when available from the EDHOC protocol) to the EDHOC message. Transport of EDHOC in CoAP payloads is described in <a href="#coap" class="xref">Appendix A.3</a>, which also shows how to use connection identifiers and message_1 indication with CoAP.<a href="#section-3.4.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="auth-key-id">
<section id="section-3.5">
        <h3 id="name-authentication-parameters">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-authentication-parameters" class="section-name selfRef">Authentication Parameters</a>
        </h3>
<p id="section-3.5-1">EDHOC supports various settings for how the other endpoint's authentication (public) key is transported, identified, and trusted as described in this section.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<p id="section-3.5-2">The authentication key (see <a href="#auth-keys" class="xref">Section 3.5.2</a>) is used in several parts of EDHOC:<a href="#section-3.5-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.5-3">
<li id="section-3.5-3.1">as part of the authentication credential included in the integrity calculation<a href="#section-3.5-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-3.5-3.2">for verification of the Signature_or_MAC field in message_2 and message_3 (see <a href="#asym-msg2-proc" class="xref">Section 5.3.2</a> and <a href="#asym-msg3-proc" class="xref">Section 5.4.2</a>)<a href="#section-3.5-3.2" class="pilcrow">¶</a>
</li>
          <li id="section-3.5-3.3">in the key derivation (in case of a static Diffie-Hellman key, see <a href="#key-der" class="xref">Section 4</a>).<a href="#section-3.5-3.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-3.5-4">The authentication credential (CRED_x) contains, in addition to the authentication key, also the authentication key algorithm and optionally other parameters such as identity, key usage, expiry, issuer, etc. (see <a href="#auth-cred" class="xref">Section 3.5.3</a>). Identical authentication credentials need to be established in both endpoints to be able to verify integrity. For many settings it is not necessary to transport the authentication credential within EDHOC over constrained links, for example, it may be pre-provisioned or acquired out-of-band over less constrained links.<a href="#section-3.5-4" class="pilcrow">¶</a></p>
<p id="section-3.5-5">EDHOC relies on COSE for identification of authentication credentials (using ID_CRED_x, see <a href="#id_cred" class="xref">Section 3.5.4</a>) and supports all credential types for which COSE header parameters are defined (see <a href="#auth-cred" class="xref">Section 3.5.3</a>).<a href="#section-3.5-5" class="pilcrow">¶</a></p>
<p id="section-3.5-6">The choice of authentication credential depends also on the trust model (see <a href="#identities" class="xref">Section 3.5.1</a>). For example, a certificate or CWT may rely on a trusted third party, whereas a CCS or a self-signed certificate/CWT may be used when trust in the public key can be achieved by other means, or in the case of trust-on-first-use.<a href="#section-3.5-6" class="pilcrow">¶</a></p>
<p id="section-3.5-7">The type of authentication key, authentication credential, and the way to identify the credential have a large impact on the message size. For example, the signature_or_MAC field is much smaller with a static DH key than with a signature key. A CCS is much smaller than a self-signed certificate/CWT, but if it is possible to reference the credential with a COSE header like 'kid', then that is typically much smaller than to transport a CCS.<a href="#section-3.5-7" class="pilcrow">¶</a></p>
<div id="identities">
<section id="section-3.5.1">
          <h4 id="name-identities-and-trust-anchor">
<a href="#section-3.5.1" class="section-number selfRef">3.5.1. </a><a href="#name-identities-and-trust-anchor" class="section-name selfRef">Identities and trust anchors</a>
          </h4>
<p id="section-3.5.1-1">Policies for what connections to allow are typically set based on the identity of the other party, and parties typically only allow connections from a specific identity or a small restricted set of identities. For example, in the case of a device connecting to a network, the network may only allow connections from devices which authenticate with certificates having a particular range of serial numbers and signed by a particular CA. On the other hand, the device may only be allowed to connect to a network which authenticates with a particular public key (information of which may be provisioned, e.g., out of band or in the external authorization data, see <a href="#AD" class="xref">Section 3.8</a>). The EDHOC implementation or the application must enforce information about the intended endpoint, and in particular whether it is a specific identity or a set of identities. Either EDHOC passes information about identity to the application for a decision, or EDHOC needs to have access to relevant information and makes the decision on its own.<a href="#section-3.5.1-1" class="pilcrow">¶</a></p>
<p id="section-3.5.1-2">EDHOC assumes the existence of mechanisms (certification authority, trusted third party, pre-provisioning, etc.) for specifying and distributing authentication credentials.<a href="#section-3.5.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.5.1-3.1">When a Public Key Infrastructure (PKI) is used with certificates, the trust anchor is a Certification Authority (CA) certificate, and the identity is the subject whose unique name (e.g., a domain name, NAI, or EUI) is included in the endpoint's certificate. In order to run EDHOC each party needs at least one CA public key certificate, or just the public key, and a specific identity or set of identities it is allowed to communicate with. Only validated public-key certificates with an allowed subject name, as specified by the application, are to be accepted. EDHOC provides proof that the other party possesses the private authentication key corresponding to the public authentication key in its certificate. The certification path provides proof that the subject of the certificate owns the public key in the certificate.<a href="#section-3.5.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.5.1-3.2">Similarly, when a PKI is used with CWTs, each party needs to have a trusted third party public key as trust anchor to verify the end-entity CWTs, and a specific identity or set of identities in the 'sub' (subject) claim of the CWT to determine if it is allowed to communicate with. The trusted third party public key can, e.g., be stored in a self-signed CWT or in a CCS.<a href="#section-3.5.1-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.5.1-3.3">When PKI is not used (CCS, self-signed certificate/CWT), the trust anchor is the authentication key of the other party. In this case, the identity is typically directly associated to the authentication key of the other party. For example, the name of the subject may be a canonical representation of the public key. Alternatively, if identities can be expressed in the form of unique subject names assigned to public keys, then a binding to identity can be achieved by including both public key and associated subject name in the protocol message computation: CRED_I or CRED_R may be a self-signed certificate/CWT or CCS containing the authentication key and the subject name, see <a href="#auth-cred" class="xref">Section 3.5.3</a>. In order to run EDHOC, each endpoint needs a specific authentication key/unique associated subject name, or a set of public authentication keys/unique associated subject names, which it is allowed to communicate with. EDHOC provides the proof that the other party possesses the private authentication key corresponding to the public authentication key.<a href="#section-3.5.1-3.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.5.1-4">To prevent misbinding attacks in systems where an attacker can register public keys without proving knowledge of the private key, SIGMA <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span> enforces a MAC to be calculated over the "identity". EDHOC follows SIGMA by calculating a MAC over the whole credential, which in case of a X.509 or C509 certificate includes the "subject" and "subjectAltName" fields, and in the case of CWT or CCS includes the "sub" claim. While the SIGMA paper only focuses on the identity, the same principle is true for other information such as policies associated to the public key.<a href="#section-3.5.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="auth-keys">
<section id="section-3.5.2">
          <h4 id="name-authentication-keys">
<a href="#section-3.5.2" class="section-number selfRef">3.5.2. </a><a href="#name-authentication-keys" class="section-name selfRef">Authentication Keys</a>
          </h4>
<p id="section-3.5.2-1">The authentication key (i.e. the public key used for authentication) MUST be a signature key or static Diffie-Hellman key. The Initiator and the Responder MAY use different types of authentication keys, e.g., one uses a signature key and the other uses a static Diffie-Hellman key. The authentication key algorithm needs to be compatible with the method and the cipher suite. The authentication key algorithm needs to be compatible with the EDHOC key exchange algorithm when static Diffie-Hellman authentication is used and compatible with the EDHOC signature algorithm when signature authentication is used.<a href="#section-3.5.2-1" class="pilcrow">¶</a></p>
<p id="section-3.5.2-2">Note that for most signature algorithms, the signature is determined by the signature algorithm and the authentication key algorithm together. When using static Diffie-Hellman keys the Initiator's and Responder's private authentication keys are called I and R, respectively, and the public authentication keys are called G_I and G_R, respectively.<a href="#section-3.5.2-2" class="pilcrow">¶</a></p>
<p id="section-3.5.2-3">For X.509 the authentication key is represented with a SubjectPublicKeyInfo field. For CWT and CCS, the authentication key is represented with a 'cnf' claim <span>[<a href="#RFC8747" class="xref">RFC8747</a>]</span> containing a COSE_Key <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>.<a href="#section-3.5.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="auth-cred">
<section id="section-3.5.3">
          <h4 id="name-authentication-credentials">
<a href="#section-3.5.3" class="section-number selfRef">3.5.3. </a><a href="#name-authentication-credentials" class="section-name selfRef">Authentication Credentials</a>
          </h4>
<p id="section-3.5.3-1">The authentication credentials, CRED_I and CRED_R, contain the public authentication key of the Initiator and the Responder, respectively.<a href="#section-3.5.3-1" class="pilcrow">¶</a></p>
<p id="section-3.5.3-2">EDHOC relies on COSE for identification of authentication credentials (see <a href="#id_cred" class="xref">Section 3.5.4</a>) and supports all credential types for which COSE header parameters are defined including X.509 <span>[<a href="#RFC5280" class="xref">RFC5280</a>]</span>, C509 <span>[<a href="#I-D.ietf-cose-cbor-encoded-cert" class="xref">I-D.ietf-cose-cbor-encoded-cert</a>]</span>, CWT <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span> and CWT Claims Set (CCS) <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span>. When the identified credential is a chain or bag, CRED_x is just the end-entity X.509 or C509 certificate / CWT. In X.509 and C509 certificates, signature keys typically have key usage "digitalSignature" and Diffie-Hellman public keys typically have key usage "keyAgreement".<a href="#section-3.5.3-2" class="pilcrow">¶</a></p>
<p id="section-3.5.3-3">CRED_x needs to be defined such that it is identical when used by Initiator or Responder. The Initiator and Responder are expected to agree on a specific encoding of the credential, see <a href="#applicability" class="xref">Section 3.9</a>. It is RECOMMENDED that the COSE 'kid' parameter, when used, refers to a specific encoding. The Initiator and Responder SHOULD use an available authentication credential (transported in EDHOC or otherwise provisioned) without re-encoding. If for some reason re-encoding of the authentication credential may occur, then a potential common encoding for CBOR based credentials is bytewise lexicographic order of their deterministic encodings as specified in Section 4.2.1 of <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span>.<a href="#section-3.5.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.5.3-4.1">When the authentication credential is a X.509 certificate, CRED_x SHALL be the end-entity DER encoded certificate wrapped in a bstr <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span>.<a href="#section-3.5.3-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.5.3-4.2">When the authentication credential is a C509 certificate, CRED_x SHALL be the end-entity C509Certificate <span>[<a href="#I-D.ietf-cose-cbor-encoded-cert" class="xref">I-D.ietf-cose-cbor-encoded-cert</a>]</span><a href="#section-3.5.3-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.5.3-4.3">When the authentication credential is a COSE_Key in a CWT, CRED_x SHALL be the untagged CWT.<a href="#section-3.5.3-4.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.5.3-4.4">When the authentication credential is a COSE_Key but not in a CWT, CRED_x SHALL be an untagged CCS.
    * Naked COSE_Keys are thus dressed as CCS when used in EDHOC, which is done by prefixing the COSE_Key with 0xA108A101.<a href="#section-3.5.3-4.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.5.3-5">An example of a CRED_x is shown below:<a href="#section-3.5.3-5" class="pilcrow">¶</a></p>
<span id="name-a-ccs-containing-an-x25519-"></span><figure id="figure-5">
            <div class="artwork art-text alignLeft" id="section-3.5.3-6.1">
<pre>
{                                              /CCS/
  2 : "42-50-31-FF-EF-37-32-39",               /sub/
  8 : {                                        /cnf/
    1 : {                                      /COSE_Key/
      1 : 1,                                   /kty/
      2 : 0,                                   /kid/
     -1 : 4,                                   /crv/
     -2 : h'b1a3e89460e88d3a8d54211dc95f0b90   /x/
            3ff205eb71912d6db8f4af980d2db83a'
    }
  }
}
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-a-ccs-containing-an-x25519-" class="selfRef">A CCS Containing an X25519 Static Diffie-Hellman Key and an EUI-64 Identity.</a>
            </figcaption></figure>
</section>
</div>
<div id="id_cred">
<section id="section-3.5.4">
          <h4 id="name-identification-of-credentia">
<a href="#section-3.5.4" class="section-number selfRef">3.5.4. </a><a href="#name-identification-of-credentia" class="section-name selfRef">Identification of Credentials</a>
          </h4>
<p id="section-3.5.4-1">ID_CRED_R and ID_CRED_I are transported in message_2 and message_3, respectively (see <a href="#asym-msg2-proc" class="xref">Section 5.3.2</a> and <a href="#asym-msg3-proc" class="xref">Section 5.4.2</a>). They are used to identify and optionally transport the authentication keys of the Initiator and the Responder, respectively. ID_CRED_I and ID_CRED_R do not have any cryptographic purpose in EDHOC since EDHOC integrity protects the authentication credential. EDHOC relies on COSE for identification of authentication credentials and supports all COSE header parameters used to identify authentication credentials including X.509, C509, CWT and CCS.<a href="#section-3.5.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.5.4-2.1">ID_CRED_R is intended to facilitate for the Initiator to retrieve the Responder's authentication key.<a href="#section-3.5.4-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.5.4-2.2">ID_CRED_I is intended to facilitate for the Responder to retrieve the Initiator's authentication key.<a href="#section-3.5.4-2.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.5.4-3">ID_CRED_I and ID_CRED_R are COSE header maps and contains one or more COSE header parameter. ID_CRED_I and ID_CRED_R MAY contain different header parameters. The header parameters typically provide some information about the format of authentication credential.<a href="#section-3.5.4-3" class="pilcrow">¶</a></p>
<p id="section-3.5.4-4">Example: X.509 certificates can be identified by a hash value using the 'x5t' parameter:<a href="#section-3.5.4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.5.4-5.1">ID_CRED_x = { 34 : COSE_CertHash }, for x = I or R,<a href="#section-3.5.4-5.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.5.4-6">Example: CWT or CCS can be identified by a key identifier using the 'kid' parameter:<a href="#section-3.5.4-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.5.4-7.1">ID_CRED_x = { 4 : key_id_x }, where key_id_x : kid, for x = I or R.<a href="#section-3.5.4-7.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.5.4-8">Note that 'kid' is extended to support int values to allow more one-byte identifiers (see <a href="#kid-header-param" class="xref">Section 9.7</a> and <a href="#kid-key-common-param" class="xref">Section 9.8</a>) which may be useful in many scenarios since constrained devices only have a few keys. As stated in Section 3.1 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>, applications MUST NOT assume that 'kid' values are unique and several keys associated with a 'kid' may need to be checked before the correct one is found. Applications might use additional information such as 'kid context' or lower layers to determine which key to try first. Applications should strive to make ID_CRED_x as unique as possible, since the recipient may otherwise have to try several keys.<a href="#section-3.5.4-8" class="pilcrow">¶</a></p>
<p id="section-3.5.4-9">See <a href="#COSE" class="xref">Appendix C.3</a> for more examples.<a href="#section-3.5.4-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="cs">
<section id="section-3.6">
        <h3 id="name-cipher-suites">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-cipher-suites" class="section-name selfRef">Cipher Suites</a>
        </h3>
<p id="section-3.6-1">An EDHOC cipher suite consists of an ordered set of algorithms from the "COSE Algorithms" and "COSE Elliptic Curves" registries as well as the EDHOC MAC length. Algorithms need to be specified with enough parameters to make them completely determined. EDHOC is only specified for use with key exchange algorithms of type ECDH curves. Use with other types of key exchange algorithms would likely require a specification updating EDHOC. Note that for most signature algorithms, the signature is determined by the signature algorithm and the authentication key algorithm together, see <a href="#auth-keys" class="xref">Section 3.5.2</a>. The authentication key algorithm needs to be compatible with the EDHOC key exchange algorithm when static Diffie-Hellman authentication is used and compatible with the EDHOC signature algorithm when signature authentication is used.<a href="#section-3.6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.6-2.1">EDHOC AEAD algorithm<a href="#section-3.6-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.6-2.2">EDHOC hash algorithm<a href="#section-3.6-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.6-2.3">EDHOC MAC length in bytes (Static DH)<a href="#section-3.6-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.6-2.4">EDHOC key exchange algorithm (ECDH curve)<a href="#section-3.6-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.6-2.5">EDHOC signature algorithm<a href="#section-3.6-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.6-2.6">Application AEAD algorithm<a href="#section-3.6-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.6-2.7">Application hash algorithm<a href="#section-3.6-2.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.6-3">Each cipher suite is identified with a pre-defined int label.<a href="#section-3.6-3" class="pilcrow">¶</a></p>
<p id="section-3.6-4">EDHOC can be used with all algorithms and curves defined for COSE. Implementation can either use one of the pre-defined cipher suites (<a href="#suites-registry" class="xref">Section 9.2</a>) or use any combination of COSE algorithms and parameters to define their own private cipher suite. Private cipher suites can be identified with any of the four values -24, -23, -22, -21.<a href="#section-3.6-4" class="pilcrow">¶</a></p>
<p id="section-3.6-5">The following CCM cipher suites are for constrained IoT where message overhead is a very important factor. Cipher suites 1 and 3 use a larger tag length (128-bit) in EDHOC than in the Application AEAD algorithm (64-bit):<a href="#section-3.6-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.6-6">
<pre>
   0. ( 10, -16, 8, 4, -8, 10, -16 )
      (AES-CCM-16-64-128, SHA-256, 8, X25519, EdDSA,
       AES-CCM-16-64-128, SHA-256)

   1. ( 30, -16, 16, 4, -8, 10, -16 )
      (AES-CCM-16-128-128, SHA-256, 16, X25519, EdDSA,
       AES-CCM-16-64-128, SHA-256)

   2. ( 10, -16, 8, 1, -7, 10, -16 )
      (AES-CCM-16-64-128, SHA-256, 8, P-256, ES256,
       AES-CCM-16-64-128, SHA-256)

   3. ( 30, -16, 16, 1, -7, 10, -16 )
      (AES-CCM-16-128-128, SHA-256, 16, P-256, ES256,
       AES-CCM-16-64-128, SHA-256)
</pre><a href="#section-3.6-6" class="pilcrow">¶</a>
</div>
<p id="section-3.6-7">The following ChaCha20 cipher suites are for less constrained applications and only use 128-bit tag lengths.<a href="#section-3.6-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.6-8">
<pre>
   4. ( 24, -16, 16, 4, -8, 24, -16 )
      (ChaCha20/Poly1305, SHA-256, 16, X25519, EdDSA,
       ChaCha20/Poly1305, SHA-256)

   5. ( 24, -16, 16, 1, -7, 24, -16 )
      (ChaCha20/Poly1305, SHA-256, 16, P-256, ES256,
       ChaCha20/Poly1305, SHA-256)
</pre><a href="#section-3.6-8" class="pilcrow">¶</a>
</div>
<p id="section-3.6-9">The following GCM cipher suite is for general non-constrained applications. It uses high performance algorithms that are widely supported:<a href="#section-3.6-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.6-10">
<pre>
   6. ( 1, -16, 16, 4, -7, 1, -16 )
      (A128GCM, SHA-256, 16, X25519, ES256,
       A128GCM, SHA-256)
</pre><a href="#section-3.6-10" class="pilcrow">¶</a>
</div>
<p id="section-3.6-11">The following two cipher suites are for high security application such as government use and financial applications. The two cipher suites do not share any algorithms. The first of the two cipher suites is compatible with the CNSA suite <span>[<a href="#CNSA" class="xref">CNSA</a>]</span>.<a href="#section-3.6-11" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.6-12">
<pre>
  24. ( 3, -43, 16, 2, -35, 3, -43 )
      (A256GCM, SHA-384, 16, P-384, ES384,
       A256GCM, SHA-384)

  25. ( 24, -45, 16, 5, -8, 24, -45 )
      (ChaCha20/Poly1305, SHAKE256, 16, X448, EdDSA,
       ChaCha20/Poly1305, SHAKE256)
</pre><a href="#section-3.6-12" class="pilcrow">¶</a>
</div>
<p id="section-3.6-13">The different methods use the same cipher suites, but some algorithms are not used in some methods. The EDHOC signature algorithm is not used in methods without signature authentication.<a href="#section-3.6-13" class="pilcrow">¶</a></p>
<p id="section-3.6-14">The Initiator needs to have a list of cipher suites it supports in order of preference. The Responder needs to have a list of cipher suites it supports. SUITES_I contains cipher suites supported by the Initiator, formatted and processed as detailed in <a href="#asym-msg1-form" class="xref">Section 5.2.1</a> to secure the cipher suite negotiation. Examples of cipher suite negotiation are given in <a href="#ex-neg" class="xref">Section 6.3.2</a>.<a href="#section-3.6-14" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cose_key">
<section id="section-3.7">
        <h3 id="name-ephemeral-public-keys">
<a href="#section-3.7" class="section-number selfRef">3.7. </a><a href="#name-ephemeral-public-keys" class="section-name selfRef">Ephemeral Public Keys</a>
        </h3>
<p id="section-3.7-1">EDHOC always uses compact representation of elliptic curve points, see <a href="#comrep" class="xref">Appendix B</a>. In COSE compact representation is achieved by formatting the ECDH ephemeral public keys as COSE_Keys of type EC2 or OKP according to Sections 7.1 and 7.2 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-algs" class="xref">I-D.ietf-cose-rfc8152bis-algs</a>]</span>, but only including the 'x' parameter in G_X and G_Y. For Elliptic Curve Keys of type EC2, compact representation MAY be used also in the COSE_Key.  If the COSE implementation requires an 'y' parameter, the value y = false SHALL be used. COSE always use compact output for Elliptic Curve Keys of type EC2.<a href="#section-3.7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="AD">
<section id="section-3.8">
        <h3 id="name-external-authorization-data">
<a href="#section-3.8" class="section-number selfRef">3.8. </a><a href="#name-external-authorization-data" class="section-name selfRef">External Authorization Data (EAD)</a>
        </h3>
<p id="section-3.8-1">In order to reduce round trips and number of messages or to simplify processing, external security applications may be integrated into EDHOC by transporting authorization related data in the messages. One example is third-party identity and authorization information protected out of scope of EDHOC <span>[<a href="#I-D.selander-ace-ake-authz" class="xref">I-D.selander-ace-ake-authz</a>]</span>. Another example is a certificate enrolment request or the resulting issued certificate.<a href="#section-3.8-1" class="pilcrow">¶</a></p>
<p id="section-3.8-2">EDHOC allows opaque external authorization data (EAD) to be sent in the EDHOC messages. External authorization data sent in message_1 (EAD_1) or message_2 (EAD_2) should be considered unprotected by EDHOC, see <a href="#unprot-data" class="xref">Section 8.4</a>. External authorization data sent in message_3 (EAD_3) or message_4 (EAD_4) is protected between Initiator and Responder.<a href="#section-3.8-2" class="pilcrow">¶</a></p>
<p id="section-3.8-3">External authorization data is a CBOR sequence (see <a href="#CBOR" class="xref">Appendix C.1</a>) consisting of one or more (ead_label, ead_value) pairs as defined below:<a href="#section-3.8-3" class="pilcrow">¶</a></p>
<div id="section-3.8-4">
<pre class="sourcecode lang-CDDL">
ead = 1* (
  ead_label : int,
  ead_value : any,
)
</pre><a href="#section-3.8-4" class="pilcrow">¶</a>
</div>
<p id="section-3.8-5">Applications using external authorization data need to specify format, processing, and security considerations and register the (ead_label, ead_value) pair, see <a href="#iana-ead" class="xref">Section 9.5</a>. The CDDL type of ead_value is determined by the int ead_label and MUST be specified.<a href="#section-3.8-5" class="pilcrow">¶</a></p>
<p id="section-3.8-6">The EAD fields of EDHOC are not intended for generic application data. Since data carried in EAD_1 and EAD_2 fields may not be protected, special considerations need to be made such that it does not violate security and privacy requirements of the service which uses this data. Moreover, the content in an EAD field may impact the security properties provided by EDHOC. Security applications making use of the EAD fields must perform the necessary security analysis.<a href="#section-3.8-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="applicability">
<section id="section-3.9">
        <h3 id="name-applicability-statement">
<a href="#section-3.9" class="section-number selfRef">3.9. </a><a href="#name-applicability-statement" class="section-name selfRef">Applicability Statement</a>
        </h3>
<p id="section-3.9-1">EDHOC requires certain parameters to be agreed upon between Initiator and Responder. Some parameters can be agreed through the protocol execution (specifically cipher suite negotiation, see <a href="#cs" class="xref">Section 3.6</a>) but other parameters may need to be known out-of-band (e.g., which authentication method is used, see <a href="#method" class="xref">Section 3.2</a>).<a href="#section-3.9-1" class="pilcrow">¶</a></p>
<p id="section-3.9-2">The purpose of the applicability statement is to describe the intended use of EDHOC to allow for the relevant processing and verifications to be made, including things like:<a href="#section-3.9-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.9-3">
<li id="section-3.9-3.1">
            <p id="section-3.9-3.1.1">How the endpoint detects that an EDHOC message is received. This includes how EDHOC messages are transported, for example in the payload of a CoAP message with a certain Uri-Path or Content-Format; see <a href="#coap" class="xref">Appendix A.3</a>.<a href="#section-3.9-3.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.9-3.1.2.1">The method of transporting EDHOC messages may also describe data carried along with the messages that are needed for the transport to satisfy the requirements of <a href="#transport" class="xref">Section 3.4</a>, e.g., connection identifiers used with certain messages, see <a href="#coap" class="xref">Appendix A.3</a>.<a href="#section-3.9-3.1.2.1" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li id="section-3.9-3.2">Authentication method (METHOD; see <a href="#method" class="xref">Section 3.2</a>).<a href="#section-3.9-3.2" class="pilcrow">¶</a>
</li>
          <li id="section-3.9-3.3">Profile for authentication credentials (CRED_I, CRED_R; see <a href="#auth-cred" class="xref">Section 3.5.3</a>), e.g., profile for certificate or CCS, including supported authentication key algorithms (subject public key algorithm in X.509 or C509 certificate).<a href="#section-3.9-3.3" class="pilcrow">¶</a>
</li>
          <li id="section-3.9-3.4">Type used to identify authentication credentials (ID_CRED_I, ID_CRED_R; see <a href="#id_cred" class="xref">Section 3.5.4</a>).<a href="#section-3.9-3.4" class="pilcrow">¶</a>
</li>
          <li id="section-3.9-3.5">Use and type of external authorization data (EAD_1, EAD_2, EAD_3, EAD_4; see <a href="#AD" class="xref">Section 3.8</a>).<a href="#section-3.9-3.5" class="pilcrow">¶</a>
</li>
          <li id="section-3.9-3.6">Identifier used as identity of endpoint; see <a href="#identities" class="xref">Section 3.5.1</a>.<a href="#section-3.9-3.6" class="pilcrow">¶</a>
</li>
          <li id="section-3.9-3.7">If message_4 shall be sent/expected, and if not, how to ensure a protected application message is sent from the Responder to the Initiator; see <a href="#m4" class="xref">Section 5.5</a>.<a href="#section-3.9-3.7" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-3.9-4">The applicability statement may also contain information about supported cipher suites. The procedure for selecting and verifying cipher suite is still performed as described in <a href="#asym-msg1-form" class="xref">Section 5.2.1</a> and <a href="#wrong-selected" class="xref">Section 6.3</a>, but it may become simplified by this knowledge.<a href="#section-3.9-4" class="pilcrow">¶</a></p>
<p id="section-3.9-5">An example of an applicability statement is shown in <a href="#appl-temp" class="xref">Appendix D</a>.<a href="#section-3.9-5" class="pilcrow">¶</a></p>
<p id="section-3.9-6">For some parameters, like METHOD, ID_CRED_x, type of EAD, the receiver is able to verify compliance with applicability statement, and if it needs to fail because of incompliance, to infer the reason why the protocol failed.<a href="#section-3.9-6" class="pilcrow">¶</a></p>
<p id="section-3.9-7">For other parameters, like CRED_x in the case that it is not transported, it may not be possible to verify that incompliance with applicability statement was the reason for failure: Integrity verification in message_2 or message_3 may fail not only because of wrong authentication credential. For example, in case the Initiator uses public key certificate by reference (i.e., not transported within the protocol) then both endpoints need to use an identical data structure as CRED_I or else the integrity verification will fail.<a href="#section-3.9-7" class="pilcrow">¶</a></p>
<p id="section-3.9-8">Note that it is not necessary for the endpoints to specify a single transport for the EDHOC messages. For example, a mix of CoAP and HTTP may be used along the path, and this may still allow correlation between messages.<a href="#section-3.9-8" class="pilcrow">¶</a></p>
<p id="section-3.9-9">The applicability statement may be dependent on the identity of the other endpoint, or other information carried in an EDHOC message, but it then applies only to the later phases of the protocol when such information is known. (The Initiator does not know identity of Responder before having verified message_2, and the Responder does not know identity of the Initiator before having verified message_3.)<a href="#section-3.9-9" class="pilcrow">¶</a></p>
<p id="section-3.9-10">Other conditions may be part of the applicability statement, such as target application or use (if there is more than one application/use) to the extent that EDHOC can distinguish between them. In case multiple applicability statements are used, the receiver needs to be able to determine which is applicable for a given session, for example based on URI or external authorization data type.<a href="#section-3.9-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="key-der">
<section id="section-4">
      <h2 id="name-key-derivation">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-key-derivation" class="section-name selfRef">Key Derivation</a>
      </h2>
<p id="section-4-1">EDHOC uses Extract-and-Expand <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span> with the EDHOC hash algorithm in the selected cipher suite to derive keys used in EDHOC and in the application. Extract is used to derive fixed-length uniformly pseudorandom keys (PRK) from ECDH shared secrets. Expand is used to derive additional output keying material (OKM) from the PRKs.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">This section defines Extract, Expand and other key derivation functions based on these: Expand is used to define EDHOC-KDF and in turn EDHOC-Exporter, whereas Extract is used to define EDHOC-KeyUpdate.<a href="#section-4-2" class="pilcrow">¶</a></p>
<div id="extract">
<section id="section-4.1">
        <h3 id="name-extract">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-extract" class="section-name selfRef">Extract</a>
        </h3>
<p id="section-4.1-1">The pseudorandom keys (PRKs) are derived using Extract.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1-2">
<pre>
   PRK = Extract( salt, IKM )
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1-3">where the input keying material (IKM) and salt are defined for each PRK below.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">The definition of Extract depends on the EDHOC hash algorithm of the selected cipher suite:<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-5.1">if the EDHOC hash algorithm is SHA-2, then Extract( salt, IKM ) = HKDF-Extract( salt, IKM ) <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span><a href="#section-4.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-5.2">if the EDHOC hash algorithm is SHAKE128, then Extract( salt, IKM ) = KMAC128( salt, IKM, 256, "" )<a href="#section-4.1-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-5.3">if the EDHOC hash algorithm is SHAKE256, then Extract( salt, IKM ) = KMAC256( salt, IKM, 512, "" )<a href="#section-4.1-5.3" class="pilcrow">¶</a>
</li>
        </ul>
<div id="prk2e">
<section id="section-4.1.1">
          <h4 id="name-prk_2e">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-prk_2e" class="section-name selfRef">PRK_2e</a>
          </h4>
<p id="section-4.1.1-1">PRK_2e is used to derive a keystream to encrypt message_2. PRK_2e is derived with the following input:<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1.1-2.1">The salt SHALL be a zero-length byte string. Note that <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span> specifies that if the salt is not provided, it is set to a string of zeros (see Section 2.2 of <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>). For implementation purposes, not providing the salt is the same as setting the salt to the zero-length byte string (0x).<a href="#section-4.1.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.1.1-2.2">The IKM SHALL be the ECDH shared secret G_XY (calculated from G_X and Y or G_Y and X) as defined in Section 6.3.1 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-algs" class="xref">I-D.ietf-cose-rfc8152bis-algs</a>]</span>.<a href="#section-4.1.1-2.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.1.1-3">Example: Assuming the use of curve25519, the ECDH shared secret G_XY is the output of the X25519 function <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>:<a href="#section-4.1.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.1-4">
<pre>
   G_XY = X25519( Y, G_X ) = X25519( X, G_Y )
</pre><a href="#section-4.1.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1-5">Example: Assuming the use of SHA-256 the extract phase of HKDF produces PRK_2e as follows:<a href="#section-4.1.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1.1-6">
<pre>
   PRK_2e = HMAC-SHA-256( salt, G_XY )
</pre><a href="#section-4.1.1-6" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1-7">where salt = 0x (zero-length byte string).<a href="#section-4.1.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="prk3e2m">
<section id="section-4.1.2">
          <h4 id="name-prk_3e2m">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-prk_3e2m" class="section-name selfRef">PRK_3e2m</a>
          </h4>
<p id="section-4.1.2-1">PRK_3e2m is used to produce a MAC in message_2 and to encrypt message_3. PRK_3e2m is derived as follows:<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2-2">If the Responder authenticates with a static Diffie-Hellman key, then PRK_3e2m = Extract( PRK_2e, G_RX ), where G_RX is the ECDH shared secret calculated from G_R and X, or G_X and R, else PRK_3e2m = PRK_2e.<a href="#section-4.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="prk4x3m">
<section id="section-4.1.3">
          <h4 id="name-prk_4x3m">
<a href="#section-4.1.3" class="section-number selfRef">4.1.3. </a><a href="#name-prk_4x3m" class="section-name selfRef">PRK_4x3m</a>
          </h4>
<p id="section-4.1.3-1">PRK_4x3m is used to produce a MAC in message_3, to encrypt message_4, and to derive application specific data. PRK_4x3m is derived as follows:<a href="#section-4.1.3-1" class="pilcrow">¶</a></p>
<p id="section-4.1.3-2">If the Initiator authenticates with a static Diffie-Hellman key, then PRK_4x3m = Extract( PRK_3e2m, G_IY ), where G_IY is the ECDH shared secret calculated from G_I and Y, or G_Y and I, else PRK_4x3m = PRK_3e2m.<a href="#section-4.1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="expand">
<section id="section-4.2">
        <h3 id="name-expand">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-expand" class="section-name selfRef">Expand</a>
        </h3>
<p id="section-4.2-1">The keys, IVs and MACs used in EDHOC are derived from the PRKs using Expand, and instantiated with the EDHOC AEAD algorithm in the selected cipher suite.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2-2">
<pre>
   OKM = EDHOC-KDF( PRK, transcript_hash, label, context, length )
       = Expand( PRK, info, length )
</pre><a href="#section-4.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2-3">where info is encoded as the CBOR sequence<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<div id="section-4.2-4">
<pre class="sourcecode lang-CDDL">
info = (
  transcript_hash : bstr,
  label : tstr,
  context : bstr,
  length : uint,
)
</pre><a href="#section-4.2-4" class="pilcrow">¶</a>
</div>
<p id="section-4.2-5">where<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-6.1">transcript_hash is a bstr set to one of the transcript hashes TH_2, TH_3, or TH_4 as defined in Sections <a href="#asym-msg2-form" class="xref">5.3.1</a>, <a href="#asym-msg3-form" class="xref">5.4.1</a>, and <a href="#exporter" class="xref">4.3</a>.<a href="#section-4.2-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-6.2">label is a tstr set to the name of the derived key, IV or MAC; i.e., "KEYSTREAM_2", "MAC_2", "K_3", "IV_3", or "MAC_3".<a href="#section-4.2-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-6.3">context is a bstr<a href="#section-4.2-6.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-6.4">length is the length of output keying material (OKM) in bytes<a href="#section-4.2-6.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-7">The definition of Expand depends on the EDHOC hash algorithm of the selected cipher suite:<a href="#section-4.2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-8.1">if the EDHOC hash algorithm is SHA-2, then Expand( PRK, info, length ) = HKDF-Expand( PRK, info, length ) <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span><a href="#section-4.2-8.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-8.2">if the EDHOC hash algorithm is SHAKE128, then Expand( PRK, info, length ) = KMAC128( PRK, info, L, "" )<a href="#section-4.2-8.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-8.3">if the EDHOC hash algorithm is SHAKE256, then Expand( PRK, info, length ) = KMAC256( PRK, info, L, "" )<a href="#section-4.2-8.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-9">where L = 8*length, the output length in bits.<a href="#section-4.2-9" class="pilcrow">¶</a></p>
<p id="section-4.2-10">The keys, IVs and MACs are derived as follows:<a href="#section-4.2-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-11.1">KEYSTREAM_2 is derived using the transcript hash TH_2 and the pseudorandom key PRK_2e.<a href="#section-4.2-11.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-11.2">MAC_2 is derived using the transcript hash TH_2 and the pseudorandom key PRK_3e2m.<a href="#section-4.2-11.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-11.3">K_3 and IV_3 are derived using the transcript hash TH_3 and the pseudorandom key PRK_3e2m. IVs are only used if the EDHOC AEAD algorithm uses IVs.<a href="#section-4.2-11.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-11.4">MAC_3 is derived using the transcript hash TH_3 and the pseudorandom key PRK_4x3m.<a href="#section-4.2-11.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-12">KEYSTREAM_2, K_3, and IV_3 use an empty CBOR byte string h'' as context. MAC_2 and MAC_3 use context as defined in <a href="#asym-msg2-proc" class="xref">Section 5.3.2</a> and <a href="#asym-msg3-proc" class="xref">Section 5.4.2</a>, respectively.<a href="#section-4.2-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="exporter">
<section id="section-4.3">
        <h3 id="name-edhoc-exporter">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-edhoc-exporter" class="section-name selfRef">EDHOC-Exporter</a>
        </h3>
<p id="section-4.3-1">Application keys and other application specific data can be derived using the EDHOC-Exporter interface defined as:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.3-2">
<pre>
   EDHOC-Exporter(label, context, length)
     = EDHOC-KDF(PRK_4x3m, TH_4, label, context, length)
</pre><a href="#section-4.3-2" class="pilcrow">¶</a>
</div>
<p id="section-4.3-3">where label is a registered tstr from the EDHOC Exporter Label registry (<a href="#exporter-label" class="xref">Section 9.1</a>), context is a bstr defined by the application, and length is a uint defined by the application. The (label, context) pair must be unique, i.e., a (label, context) MUST NOT be used for two different purposes. However an application can re-derive the same key several times as long as it is done in a secure way. For example, in most encryption algorithms the same key kan be reused with different nonces. The context can for example be the empty (zero-length) sequence or a single CBOR byte string.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">The transcript hash TH_4 is a CBOR encoded bstr and the input to the hash function is a CBOR Sequence.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.3-5">
<pre>
   TH_4 = H( TH_3, CIPHERTEXT_3 )
</pre><a href="#section-4.3-5" class="pilcrow">¶</a>
</div>
<p id="section-4.3-6">where H() is the hash function in the selected cipher suite. Examples of use of the EDHOC-Exporter are given in <a href="#asym-msg4-proc" class="xref">Section 5.5.2</a> and <a href="#transfer" class="xref">Appendix A</a>.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-7.1">K_4 and IV_4 are derived with the EDHOC-Exporter using the empty CBOR byte string h'' as context, and labels "EDHOC_K_4" and "EDHOC_IV_4", respectively. IVs are only used if the EDHOC AEAD algorithm uses IVs.<a href="#section-4.3-7.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="keyupdate">
<section id="section-4.4">
        <h3 id="name-edhoc-keyupdate">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-edhoc-keyupdate" class="section-name selfRef">EDHOC-KeyUpdate</a>
        </h3>
<p id="section-4.4-1">To provide forward secrecy in an even more efficient way than re-running EDHOC, EDHOC provides the function EDHOC-KeyUpdate. When EDHOC-KeyUpdate is called the old PRK_4x3m is deleted and the new PRK_4x3m is calculated as a "hash" of the old key using the Extract function as illustrated by the following pseudocode:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.4-2">
<pre>
   EDHOC-KeyUpdate( nonce ):
      PRK_4x3m = Extract( nonce, PRK_4x3m )
</pre><a href="#section-4.4-2" class="pilcrow">¶</a>
</div>
<p id="section-4.4-3">The EDHOC-KeyUpdate takes a nonce as input to guarantee that there are no short cycles. The Initiator and the Responder need to agree on the nonce, which can e.g., be a counter or a random number. While the KeyUpdate method provides forward secrecy it does not give as strong security properties as re-running EDHOC, see <a href="#security" class="xref">Section 8</a>.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="asym">
<section id="section-5">
      <h2 id="name-message-formatting-and-proc">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-message-formatting-and-proc" class="section-name selfRef">Message Formatting and Processing</a>
      </h2>
<p id="section-5-1">This section specifies formatting of the messages and processing steps. Error messages are specified in <a href="#error" class="xref">Section 6</a>.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">An EDHOC message is encoded as a sequence of CBOR data items (CBOR Sequence, <span>[<a href="#RFC8742" class="xref">RFC8742</a>]</span>).
Additional optimizations are made to reduce message overhead.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">While EDHOC uses the COSE_Key, COSE_Sign1, and COSE_Encrypt0 structures, only a subset of the parameters is included in the EDHOC messages, see <a href="#COSE" class="xref">Appendix C.3</a>. The unprotected COSE header in COSE_Sign1, and COSE_Encrypt0 (not included in the EDHOC message) MAY contain parameters (e.g., 'alg').<a href="#section-5-3" class="pilcrow">¶</a></p>
<div id="proc-outline">
<section id="section-5.1">
        <h3 id="name-message-processing-outline">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-message-processing-outline" class="section-name selfRef">Message Processing Outline</a>
        </h3>
<p id="section-5.1-1">This section outlines the message processing of EDHOC.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">For each session, the endpoints are assumed to keep an associated protocol state containing identifiers, keys, etc. used for subsequent processing of protocol related data. The protocol state is assumed to be associated to an applicability statement (<a href="#applicability" class="xref">Section 3.9</a>) which provides the context for how messages are transported, identified, and processed.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">EDHOC messages SHALL be processed according to the current protocol state. The following steps are expected to be performed at reception of an EDHOC message:<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.1-4">
<li id="section-5.1-4.1">Detect that an EDHOC message has been received, for example by means of port number, URI, or media type (<a href="#applicability" class="xref">Section 3.9</a>).<a href="#section-5.1-4.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.1-4.2">Retrieve the protocol state according to the message correlation provided by the transport, see <a href="#transport" class="xref">Section 3.4</a>. If there is no protocol state, in the case of message_1, a new protocol state is created. The Responder endpoint needs to make use of available Denial-of-Service mitigation (<a href="#dos" class="xref">Section 8.5</a>).<a href="#section-5.1-4.2" class="pilcrow">¶</a>
</li>
          <li id="section-5.1-4.3">If the message received is an error message, then process according to <a href="#error" class="xref">Section 6</a>, else process as the expected next message according to the protocol state.<a href="#section-5.1-4.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.1-5">If the processing fails for some reason then, typically, an error message is sent, the protocol is discontinued, and the protocol state erased. Further details are provided in the following subsections and in <a href="#error" class="xref">Section 6</a>.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1-6">Different instances of the same message MUST NOT be processed in one session.  Note that processing will fail if the same message appears a second time for EDHOC processing because the state of the protocol has moved on and now expects something else. This assumes that message duplication due to re-transmissions is handled by the transport protocol, see <a href="#transport" class="xref">Section 3.4</a>. The case when the transport does not support message deduplication is addressed in <a href="#duplication" class="xref">Appendix E</a>.<a href="#section-5.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="m1">
<section id="section-5.2">
        <h3 id="name-edhoc-message-1">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-edhoc-message-1" class="section-name selfRef">EDHOC Message 1</a>
        </h3>
<div id="asym-msg1-form">
<section id="section-5.2.1">
          <h4 id="name-formatting-of-message-1">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-formatting-of-message-1" class="section-name selfRef">Formatting of Message 1</a>
          </h4>
<p id="section-5.2.1-1">message_1 SHALL be a CBOR Sequence (see <a href="#CBOR" class="xref">Appendix C.1</a>) as defined below<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<div id="section-5.2.1-2">
<pre class="sourcecode lang-CDDL">
message_1 = (
  METHOD : int,
  SUITES_I : suites,
  G_X : bstr,
  C_I : bstr / int,
  ? EAD_1 : ead,
)

suites = [ 2* int ] / int
</pre><a href="#section-5.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.2.1-3">where:<a href="#section-5.2.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.1-4.1">METHOD = 0, 1, 2, or 3 (see <a href="#fig-method-types" class="xref">Figure 4</a>).<a href="#section-5.2.1-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.1-4.2">SUITES_I - array of cipher suites which the Initiator supports in order of preference, starting with the most preferred and ending with the cipher suite selected for this session. If the most preferred cipher suite is selected then SUITES_I is encoded as that cipher suite, i.e., as an int. The processing steps are detailed below and in <a href="#wrong-selected" class="xref">Section 6.3</a>.<a href="#section-5.2.1-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.1-4.3">G_X - the ephemeral public key of the Initiator<a href="#section-5.2.1-4.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.1-4.4">C_I - variable length connection identifier<a href="#section-5.2.1-4.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.1-4.5">EAD_1 - unprotected external authorization data, see <a href="#AD" class="xref">Section 3.8</a>.<a href="#section-5.2.1-4.5" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="init-proc-msg1">
<section id="section-5.2.2">
          <h4 id="name-initiator-processing-of-mes">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-initiator-processing-of-mes" class="section-name selfRef">Initiator Processing of Message 1</a>
          </h4>
<p id="section-5.2.2-1">The Initiator SHALL compose message_1 as follows:<a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.2-2.1">The supported cipher suites and the order of preference MUST NOT be changed based on previous error messages. SUITES_I contains the ordered list of supported cipher suites, truncated after the cipher suite selected for this session. The selected cipher suite MAY be changed between sessions, e.g., based on previous error messages (see next bullet), but all cipher suites which are more preferred than the selected cipher suite in the list MUST be included in SUITES_I.<a href="#section-5.2.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.2-2.2">The Initiator MUST select its most preferred cipher suite, conditioned on what it can assume to be supported by the Responder. If the Initiator previously received from the Responder an error message with error code 2 (see <a href="#wrong-selected" class="xref">Section 6.3</a>) indicating cipher suites supported by the Responder, then the Initiator SHOULD select the most preferred supported cipher suite among those (note that error messages are not authenticated and may be forged).<a href="#section-5.2.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.2-2.3">Generate an ephemeral ECDH key pair using the curve in the selected cipher suite and format it as a COSE_Key. Let G_X be the 'x' parameter of the COSE_Key.<a href="#section-5.2.2-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.2-2.4">Choose a connection identifier C_I and store it for the length of the protocol.<a href="#section-5.2.2-2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.2-2.5">Encode message_1 as a sequence of CBOR encoded data items as specified in <a href="#asym-msg1-form" class="xref">Section 5.2.1</a><a href="#section-5.2.2-2.5" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="resp-proc-msg1">
<section id="section-5.2.3">
          <h4 id="name-responder-processing-of-mes">
<a href="#section-5.2.3" class="section-number selfRef">5.2.3. </a><a href="#name-responder-processing-of-mes" class="section-name selfRef">Responder Processing of Message 1</a>
          </h4>
<p id="section-5.2.3-1">The Responder SHALL process message_1 as follows:<a href="#section-5.2.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.3-2.1">Decode message_1 (see <a href="#CBOR" class="xref">Appendix C.1</a>).<a href="#section-5.2.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.3-2.2">Verify that the selected cipher suite is supported and that no prior cipher suite in SUITES_I is supported.<a href="#section-5.2.3-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.3-2.3">Pass EAD_1 to the security application.<a href="#section-5.2.3-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.2.3-3">If any processing step fails, the Responder SHOULD send an EDHOC error message back, formatted as defined in <a href="#error" class="xref">Section 6</a>, and the session MUST be discontinued. Sending error messages is essential for debugging but MAY e.g., be skipped due to denial-of-service reasons, see <a href="#security" class="xref">Section 8</a>.<a href="#section-5.2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="m2">
<section id="section-5.3">
        <h3 id="name-edhoc-message-2">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-edhoc-message-2" class="section-name selfRef">EDHOC Message 2</a>
        </h3>
<div id="asym-msg2-form">
<section id="section-5.3.1">
          <h4 id="name-formatting-of-message-2">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-formatting-of-message-2" class="section-name selfRef">Formatting of Message 2</a>
          </h4>
<p id="section-5.3.1-1">message_2 SHALL be a CBOR Sequence (see <a href="#CBOR" class="xref">Appendix C.1</a>) as defined below<a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<div id="section-5.3.1-2">
<pre class="sourcecode lang-CDDL">
message_2 = (
  G_Y_CIPHERTEXT_2 : bstr,
  C_R : bstr / int,
)
</pre><a href="#section-5.3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.3.1-3">where:<a href="#section-5.3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.1-4.1">G_Y_CIPHERTEXT_2 - the concatenation of G_Y, the ephemeral public key of the Responder, and CIPHERTEXT_2<a href="#section-5.3.1-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.1-4.2">C_R - variable length connection identifier<a href="#section-5.3.1-4.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="asym-msg2-proc">
<section id="section-5.3.2">
          <h4 id="name-responder-processing-of-mess">
<a href="#section-5.3.2" class="section-number selfRef">5.3.2. </a><a href="#name-responder-processing-of-mess" class="section-name selfRef">Responder Processing of Message 2</a>
          </h4>
<p id="section-5.3.2-1">The Responder SHALL compose message_2 as follows:<a href="#section-5.3.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.2-2.1">Generate an ephemeral ECDH key pair using the curve in the selected cipher suite and format it as a COSE_Key. Let G_Y be the 'x' parameter of the COSE_Key.<a href="#section-5.3.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.2-2.2">Choose a connection identifier C_R and store it for the length of the protocol.<a href="#section-5.3.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.2-2.3">Compute the transcript hash TH_2 = H( H(message_1), G_Y, C_R ) where H() is the hash function in the selected cipher suite. The transcript hash TH_2 is a CBOR encoded bstr and the input to the hash function is a CBOR Sequence. Note that H(message_1) can be computed and cached already in the processing of message_1.<a href="#section-5.3.2-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.2-2.4">
              <p id="section-5.3.2-2.4.1">Compute MAC_2 = EDHOC-KDF( PRK_3e2m, TH_2, "MAC_2", &lt;&lt; ID_CRED_R, CRED_R, ? EAD_2 &gt;&gt;, mac_length_2 ). If the Responder authenticates with a static Diffie-Hellman key (method equals 1 or 3), then mac_length_2 is the EDHOC MAC length given by the selected cipher suite. If the Responder authenticates with a signature key (method equals 0 or 2), then mac_length_2 is equal to the output size of the EDHOC hash algorithm given by the selected cipher suite.<a href="#section-5.3.2-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.2-2.4.2.1">ID_CRED_R - identifier to facilitate retrieval of CRED_R, see <a href="#id_cred" class="xref">Section 3.5.4</a><a href="#section-5.3.2-2.4.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.3.2-2.4.2.2">CRED_R - CBOR item containing the credential of the Responder, see <a href="#id_cred" class="xref">Section 3.5.4</a><a href="#section-5.3.2-2.4.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.3.2-2.4.2.3">EAD_2 = unprotected external authorization data, see <a href="#AD" class="xref">Section 3.8</a><a href="#section-5.3.2-2.4.2.3" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.3.2-2.5">
              <p id="section-5.3.2-2.5.1">If the Responder authenticates with a static Diffie-Hellman key (method equals 1 or 3), then Signature_or_MAC_2 is MAC_2. If the Responder authenticates with a signature key (method equals 0 or 2), then Signature_or_MAC_2 is the 'signature' of a COSE_Sign1 object as defined in Section 4.4 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span> using the signature algorithm in the selected cipher suite, the private authentication key of the Responder, and the following parameters:<a href="#section-5.3.2-2.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.2-2.5.2.1">protected =  &lt;&lt; ID_CRED_R &gt;&gt;<a href="#section-5.3.2-2.5.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.3.2-2.5.2.2">external_aad = &lt;&lt; TH_2, CRED_R, ? EAD_2 &gt;&gt;<a href="#section-5.3.2-2.5.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.3.2-2.5.2.3">payload = MAC_2<a href="#section-5.3.2-2.5.2.3" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-5.3.2-2.5.3">
COSE constructs the input to the Signature Algorithm as:<a href="#section-5.3.2-2.5.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.2-2.5.4.1">The key is the private authentication key of the Responder.<a href="#section-5.3.2-2.5.4.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.3.2-2.5.4.2">
                  <p id="section-5.3.2-2.5.4.2.1">The message M to be signed =<a href="#section-5.3.2-2.5.4.2.1" class="pilcrow">¶</a></p>
<p id="section-5.3.2-2.5.4.2.2">
[ "Signature1", &lt;&lt; ID_CRED_R &gt;&gt;, &lt;&lt; TH_2, CRED_R, ? EAD_2 &gt;&gt;, MAC_2 ]<a href="#section-5.3.2-2.5.4.2.2" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.3.2-2.6">
              <p id="section-5.3.2-2.6.1">CIPHERTEXT_2 is encrypted by using the Expand function as a binary additive stream cipher.<a href="#section-5.3.2-2.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.2-2.6.2.1">
                  <p id="section-5.3.2-2.6.2.1.1">plaintext = ( ID_CRED_R / bstr / int, Signature_or_MAC_2, ? EAD_2 )<a href="#section-5.3.2-2.6.2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.2-2.6.2.1.2.1">Note that if ID_CRED_R contains a single 'kid' parameter, i.e., ID_CRED_R = { 4 : kid_R }, only the byte string or integer kid_R is conveyed in the plaintext encoded as a bstr or int.<a href="#section-5.3.2-2.6.2.1.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
                <li class="normal" id="section-5.3.2-2.6.2.2">CIPHERTEXT_2 = plaintext XOR KEYSTREAM_2<a href="#section-5.3.2-2.6.2.2" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.3.2-2.7">Encode message_2 as a sequence of CBOR encoded data items as specified in <a href="#asym-msg2-form" class="xref">Section 5.3.1</a>.<a href="#section-5.3.2-2.7" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="initiator-processing-of-message-2">
<section id="section-5.3.3">
          <h4 id="name-initiator-processing-of-mess">
<a href="#section-5.3.3" class="section-number selfRef">5.3.3. </a><a href="#name-initiator-processing-of-mess" class="section-name selfRef">Initiator Processing of Message 2</a>
          </h4>
<p id="section-5.3.3-1">The Initiator SHALL process message_2 as follows:<a href="#section-5.3.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.3-2.1">Decode message_2 (see <a href="#CBOR" class="xref">Appendix C.1</a>).<a href="#section-5.3.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.3-2.2">Retrieve the protocol state using the message correlation provided by the transport (e.g., the CoAP Token and the 5-tuple as a client, or the prepended C_I as a server).<a href="#section-5.3.3-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.3-2.3">Decrypt CIPHERTEXT_2, see <a href="#asym-msg2-proc" class="xref">Section 5.3.2</a>.<a href="#section-5.3.3-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.3-2.4">Pass EAD_2 to the security application.<a href="#section-5.3.3-2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.3-2.5">Verify that the identity of the Responder is an allowed identity for this connection, see <a href="#auth-key-id" class="xref">Section 3.5</a>.<a href="#section-5.3.3-2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.3-2.6">Verify Signature_or_MAC_2 using the algorithm in the selected cipher suite. The verification process depends on the method, see <a href="#asym-msg2-proc" class="xref">Section 5.3.2</a>.<a href="#section-5.3.3-2.6" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.3.3-3">If any processing step fails, the Initiator SHOULD send an EDHOC error message back, formatted as defined in <a href="#error" class="xref">Section 6</a>. Sending error messages is essential for debugging but MAY e.g., be skipped if a session cannot be found or due to denial-of-service reasons, see <a href="#security" class="xref">Section 8</a>. If an error message is sent, the session MUST be discontinued.<a href="#section-5.3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="m3">
<section id="section-5.4">
        <h3 id="name-edhoc-message-3">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-edhoc-message-3" class="section-name selfRef">EDHOC Message 3</a>
        </h3>
<div id="asym-msg3-form">
<section id="section-5.4.1">
          <h4 id="name-formatting-of-message-3">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-formatting-of-message-3" class="section-name selfRef">Formatting of Message 3</a>
          </h4>
<p id="section-5.4.1-1">message_3 SHALL be a CBOR Sequence (see <a href="#CBOR" class="xref">Appendix C.1</a>) as defined below<a href="#section-5.4.1-1" class="pilcrow">¶</a></p>
<div id="section-5.4.1-2">
<pre class="sourcecode lang-CDDL">
message_3 = (
  CIPHERTEXT_3 : bstr,
)
</pre><a href="#section-5.4.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="asym-msg3-proc">
<section id="section-5.4.2">
          <h4 id="name-initiator-processing-of-messa">
<a href="#section-5.4.2" class="section-number selfRef">5.4.2. </a><a href="#name-initiator-processing-of-messa" class="section-name selfRef">Initiator Processing of Message 3</a>
          </h4>
<p id="section-5.4.2-1">The Initiator SHALL compose message_3 as follows:<a href="#section-5.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-2.1">Compute the transcript hash TH_3 = H(TH_2, CIPHERTEXT_2) where H() is the hash function in the selected cipher suite. The transcript hash TH_3 is a CBOR encoded bstr and the input to the hash function is a CBOR Sequence.  Note that H(TH_2, CIPHERTEXT_2) can be computed and cached already in the processing of message_2.<a href="#section-5.4.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.4.2-2.2">
              <p id="section-5.4.2-2.2.1">Compute MAC_3 = EDHOC-KDF( PRK_4x3m, TH_3, "MAC_3", &lt;&lt; ID_CRED_I, CRED_I, ? EAD_3 &gt;&gt;, mac_length_3 ). If the Initiator authenticates with a static Diffie-Hellman key (method equals 2 or 3), then mac_length_3 is the EDHOC MAC length given by the selected cipher suite.  If the Initiator authenticates with a signature key (method equals 0 or 1), then mac_length_3 is equal to the output size of the EDHOC hash algorithm given by the selected cipher suite.<a href="#section-5.4.2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-2.2.2.1">ID_CRED_I - identifier to facilitate retrieval of CRED_I, see <a href="#id_cred" class="xref">Section 3.5.4</a><a href="#section-5.4.2-2.2.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.4.2-2.2.2.2">CRED_I - CBOR item containing the credential of the Initiator, see <a href="#id_cred" class="xref">Section 3.5.4</a><a href="#section-5.4.2-2.2.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.4.2-2.2.2.3">EAD_3 = protected external authorization data, see <a href="#AD" class="xref">Section 3.8</a><a href="#section-5.4.2-2.2.2.3" class="pilcrow">¶</a>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.4.2-2.3">
              <p id="section-5.4.2-2.3.1">If the Initiator authenticates with a static Diffie-Hellman key (method equals 2 or 3), then Signature_or_MAC_3 is MAC_3. If the Initiator authenticates with a signature key (method equals 0 or 1), then Signature_or_MAC_3 is the 'signature' of a COSE_Sign1 object as defined in Section 4.4 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span> using the signature algorithm in the selected cipher suite, the private authentication key of the Initiator, and the following parameters:<a href="#section-5.4.2-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-2.3.2.1">protected =  &lt;&lt; ID_CRED_I &gt;&gt;<a href="#section-5.4.2-2.3.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.4.2-2.3.2.2">external_aad = &lt;&lt; TH_3, CRED_I, ? EAD_3 &gt;&gt;<a href="#section-5.4.2-2.3.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.4.2-2.3.2.3">payload = MAC_3<a href="#section-5.4.2-2.3.2.3" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-5.4.2-2.3.3">
COSE constructs the input to the Signature Algorithm as:<a href="#section-5.4.2-2.3.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-2.3.4.1">The key is the private authentication key of the Initiator.<a href="#section-5.4.2-2.3.4.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.4.2-2.3.4.2">
                  <p id="section-5.4.2-2.3.4.2.1">The message M to be signed =<a href="#section-5.4.2-2.3.4.2.1" class="pilcrow">¶</a></p>
<p id="section-5.4.2-2.3.4.2.2">
[ "Signature1", &lt;&lt; ID_CRED_I &gt;&gt;, &lt;&lt; TH_3, CRED_I, ? EAD_3 &gt;&gt;, MAC_3 ]<a href="#section-5.4.2-2.3.4.2.2" class="pilcrow">¶</a></p>
</li>
              </ul>
</li>
            <li class="normal" id="section-5.4.2-2.4">
              <p id="section-5.4.2-2.4.1">Compute an outer COSE_Encrypt0 as defined in Section 5.3 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>, with the EDHOC AEAD algorithm in the selected cipher suite, K_3, IV_3, and the following parameters. The protected header SHALL be the empty CBOR byte string.<a href="#section-5.4.2-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-2.4.2.1">protected = h''<a href="#section-5.4.2-2.4.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.4.2-2.4.2.2">external_aad = TH_3<a href="#section-5.4.2-2.4.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.4.2-2.4.2.3">
                  <p id="section-5.4.2-2.4.2.3.1">plaintext = ( ID_CRED_I / bstr / int, Signature_or_MAC_3, ? EAD_3 )<a href="#section-5.4.2-2.4.2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-2.4.2.3.2.1">Note that if ID_CRED_I contains a single 'kid' parameter, i.e., ID_CRED_I = { 4 : kid_I }, only the byte string or integer kid_I is conveyed in the plaintext encoded as a bstr or int.<a href="#section-5.4.2-2.4.2.3.2.1" class="pilcrow">¶</a>
</li>
                  </ul>
</li>
              </ul>
<p id="section-5.4.2-2.4.3">
COSE constructs the input to the AEAD <span>[<a href="#RFC5116" class="xref">RFC5116</a>]</span> as follows:<a href="#section-5.4.2-2.4.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-2.4.4.1">Key K = EDHOC-KDF( PRK_3e2m, TH_3, "K_3", h'', length )<a href="#section-5.4.2-2.4.4.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.4.2-2.4.4.2">Nonce N = EDHOC-KDF( PRK_3e2m, TH_3, "IV_3", h'', length )<a href="#section-5.4.2-2.4.4.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.4.2-2.4.4.3">Plaintext P = ( ID_CRED_I / bstr / int, Signature_or_MAC_3, ? EAD_3 )<a href="#section-5.4.2-2.4.4.3" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.4.2-2.4.4.4">Associated data A = [ "Encrypt0", h'', TH_3 ]<a href="#section-5.4.2-2.4.4.4" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-5.4.2-2.4.5">
CIPHERTEXT_3 is the 'ciphertext' of the outer COSE_Encrypt0.<a href="#section-5.4.2-2.4.5" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.2-2.5">Encode message_3 as a sequence of CBOR encoded data items as specified in <a href="#asym-msg3-form" class="xref">Section 5.4.1</a>.<a href="#section-5.4.2-2.5" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.4.2-3">Pass the connection identifiers (C_I, C_R) and the application algorithms in the selected cipher suite to the application. The application can now derive application keys using the EDHOC-Exporter interface, see <a href="#exporter" class="xref">Section 4.3</a>.<a href="#section-5.4.2-3" class="pilcrow">¶</a></p>
<p id="section-5.4.2-4">After sending message_3, the Initiator is assured that no other party than the Responder can compute the key PRK_4x3m (implicit key authentication). The Initiator can securely derive application keys and send protected application data. However, the Initiator does not know that the Responder has actually computed the key PRK_4x3m and therefore the Initiator SHOULD NOT permanently store the keying material PRK_4x3m and TH_4, or derived application keys, until the Initiator is assured that the Responder has actually computed the key PRK_4x3m (explicit key confirmation). This is similar to waiting for acknowledgement (ACK) in a transport protocol. Explicit key confirmation is e.g., assured when the Initiator has verified an OSCORE message or message_4 from the Responder.<a href="#section-5.4.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="responder-processing-of-message-3">
<section id="section-5.4.3">
          <h4 id="name-responder-processing-of-messa">
<a href="#section-5.4.3" class="section-number selfRef">5.4.3. </a><a href="#name-responder-processing-of-messa" class="section-name selfRef">Responder Processing of Message 3</a>
          </h4>
<p id="section-5.4.3-1">The Responder SHALL process message_3 as follows:<a href="#section-5.4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.3-2.1">Decode message_3 (see <a href="#CBOR" class="xref">Appendix C.1</a>).<a href="#section-5.4.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.4.3-2.2">Retrieve the protocol state using the message correlation provided by the transport (e.g., the CoAP Token and the 5-tuple as a client, or the prepended C_R as a server).<a href="#section-5.4.3-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.4.3-2.3">Decrypt and verify the outer COSE_Encrypt0 as defined in Section 5.3 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>, with the EDHOC AEAD algorithm in the selected cipher suite, K_3, and IV_3.<a href="#section-5.4.3-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.4.3-2.4">Pass EAD_3 to the security application.<a href="#section-5.4.3-2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.4.3-2.5">Verify that the identity of the Initiator is an allowed identity for this connection, see <a href="#auth-key-id" class="xref">Section 3.5</a>.<a href="#section-5.4.3-2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.4.3-2.6">Verify Signature_or_MAC_3 using the algorithm in the selected cipher suite. The verification process depends on the method, see <a href="#asym-msg3-proc" class="xref">Section 5.4.2</a>.<a href="#section-5.4.3-2.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.4.3-2.7">Pass the connection identifiers (C_I, C_R), and the application algorithms in the selected cipher suite to the security application. The application can now derive application keys using the EDHOC-Exporter interface.<a href="#section-5.4.3-2.7" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.4.3-3">If any processing step fails, the Responder SHOULD send an EDHOC error message back, formatted as defined in <a href="#error" class="xref">Section 6</a>. Sending error messages is essential for debugging but MAY e.g., be skipped if a session cannot be found or due to denial-of-service reasons, see <a href="#security" class="xref">Section 8</a>. If an error message is sent, the session MUST be discontinued.<a href="#section-5.4.3-3" class="pilcrow">¶</a></p>
<p id="section-5.4.3-4">After verifying message_3, the Responder is assured that the Initiator has calculated the key PRK_4x3m (explicit key confirmation) and that no other party than the Responder can compute the key. The Responder can securely send protected application data and store the keying material PRK_4x3m and TH_4.<a href="#section-5.4.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="m4">
<section id="section-5.5">
        <h3 id="name-edhoc-message-4">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-edhoc-message-4" class="section-name selfRef">EDHOC Message 4</a>
        </h3>
<p id="section-5.5-1">This section specifies message_4 which is OPTIONAL to support. Key confirmation is normally provided by sending an application message from the Responder to the Initiator protected with a key derived with the EDHOC-Exporter, e.g., using OSCORE (see <a href="#transfer" class="xref">Appendix A</a>). In deployments where no protected application message is sent from the Responder to the Initiator, the Responder MUST send message_4. Two examples of such deployments:<a href="#section-5.5-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.5-2">
<li id="section-5.5-2.1">When EDHOC is only used for authentication and no application data is sent.<a href="#section-5.5-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.5-2.2">When application data is only sent from the Initiator to the Responder.<a href="#section-5.5-2.2" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.5-3">Further considerations are provided in <a href="#applicability" class="xref">Section 3.9</a>.<a href="#section-5.5-3" class="pilcrow">¶</a></p>
<div id="asym-msg4-form">
<section id="section-5.5.1">
          <h4 id="name-formatting-of-message-4">
<a href="#section-5.5.1" class="section-number selfRef">5.5.1. </a><a href="#name-formatting-of-message-4" class="section-name selfRef">Formatting of Message 4</a>
          </h4>
<p id="section-5.5.1-1">message_4 SHALL be a CBOR Sequence (see <a href="#CBOR" class="xref">Appendix C.1</a>) as defined below<a href="#section-5.5.1-1" class="pilcrow">¶</a></p>
<div id="section-5.5.1-2">
<pre class="sourcecode lang-CDDL">
message_4 = (
  CIPHERTEXT_4 : bstr,
)
</pre><a href="#section-5.5.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="asym-msg4-proc">
<section id="section-5.5.2">
          <h4 id="name-responder-processing-of-messag">
<a href="#section-5.5.2" class="section-number selfRef">5.5.2. </a><a href="#name-responder-processing-of-messag" class="section-name selfRef">Responder Processing of Message 4</a>
          </h4>
<p id="section-5.5.2-1">The Responder SHALL compose message_4 as follows:<a href="#section-5.5.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.5.2-2.1">
              <p id="section-5.5.2-2.1.1">Compute a COSE_Encrypt0 as defined in Section 5.3 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>, with the EDHOC AEAD algorithm in the selected cipher suite, and the following parameters. The protected header SHALL be the empty CBOR byte string.<a href="#section-5.5.2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.5.2-2.1.2.1">protected = h''<a href="#section-5.5.2-2.1.2.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.5.2-2.1.2.2">external_aad = TH_4<a href="#section-5.5.2-2.1.2.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.5.2-2.1.2.3">plaintext = ( ? EAD_4 ), where EAD_4 is protected external authorization data, see <a href="#AD" class="xref">Section 3.8</a><a href="#section-5.5.2-2.1.2.3" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.5.2-2.1.2.4">Key K_4 = EDHOC-Exporter( "EDHOC_K_4", h'', length )<a href="#section-5.5.2-2.1.2.4" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.5.2-2.1.2.5">IV IV_4 = EDHOC-Exporter( "EDHOC_IV_4", h'', length )<a href="#section-5.5.2-2.1.2.5" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-5.5.2-2.1.3">
COSE constructs the input to the AEAD <span>[<a href="#RFC5116" class="xref">RFC5116</a>]</span> as follows:<a href="#section-5.5.2-2.1.3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.5.2-2.1.4.1">Key K = K_4<a href="#section-5.5.2-2.1.4.1" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.5.2-2.1.4.2">Nonce N = IV_4<a href="#section-5.5.2-2.1.4.2" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.5.2-2.1.4.3">Plaintext P = ( ? EAD_4 )<a href="#section-5.5.2-2.1.4.3" class="pilcrow">¶</a>
</li>
                <li class="normal" id="section-5.5.2-2.1.4.4">Associated data A = [ "Encrypt0", h'', TH_4 ]<a href="#section-5.5.2-2.1.4.4" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-5.5.2-2.1.5">
CIPHERTEXT_4 is the ciphertext of the COSE_Encrypt0.<a href="#section-5.5.2-2.1.5" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.5.2-2.2">Encode message_4 as a sequence of CBOR encoded data items as specified in <a href="#asym-msg4-form" class="xref">Section 5.5.1</a>.<a href="#section-5.5.2-2.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="initiator-processing-of-message-4">
<section id="section-5.5.3">
          <h4 id="name-initiator-processing-of-messag">
<a href="#section-5.5.3" class="section-number selfRef">5.5.3. </a><a href="#name-initiator-processing-of-messag" class="section-name selfRef">Initiator Processing of Message 4</a>
          </h4>
<p id="section-5.5.3-1">The Initiator SHALL process message_4 as follows:<a href="#section-5.5.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.5.3-2.1">Decode message_4 (see <a href="#CBOR" class="xref">Appendix C.1</a>).<a href="#section-5.5.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.5.3-2.2">Retrieve the protocol state using the message correlation provided by the transport (e.g., the CoAP Token and the 5-tuple as a client, or the prepended C_I as a server).<a href="#section-5.5.3-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.5.3-2.3">Decrypt and verify the outer COSE_Encrypt0 as defined in Section 5.3 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>, with the EDHOC AEAD algorithm in the selected cipher suite,  and the parameters defined in <a href="#asym-msg4-proc" class="xref">Section 5.5.2</a>.<a href="#section-5.5.3-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.5.3-2.4">Pass EAD_4 to the security application.<a href="#section-5.5.3-2.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.5.3-3">If any processing step fails, the Responder SHOULD send an EDHOC error message back, formatted as defined in <a href="#error" class="xref">Section 6</a>. Sending error messages is essential for debugging but MAY e.g., be skipped if a session cannot be found or due to denial-of-service reasons, see <a href="#security" class="xref">Section 8</a>. If an error message is sent, the session MUST be discontinued.<a href="#section-5.5.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="error">
<section id="section-6">
      <h2 id="name-error-handling">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-error-handling" class="section-name selfRef">Error Handling</a>
      </h2>
<p id="section-6-1">This section defines the format for error messages.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">An EDHOC error message can be sent by either endpoint as a reply to any non-error EDHOC message. How errors at the EDHOC layer are transported depends on lower layers, which need to enable error messages to be sent and processed as intended.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">Errors in EDHOC are fatal. After sending an error message, the sender MUST discontinue the protocol. The receiver SHOULD treat an error message as an indication that the other party likely has discontinued the protocol. But as the error message is not authenticated, a received error message might also have been sent by an attacker and the receiver MAY therefore try to continue the protocol.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">error SHALL be a CBOR Sequence (see <a href="#CBOR" class="xref">Appendix C.1</a>) as defined below<a href="#section-6-4" class="pilcrow">¶</a></p>
<span id="name-edhoc-error-message"></span><div id="fig-error-message">
<figure id="figure-6">
        <div id="section-6-5.1">
<pre class="sourcecode lang-CDDL">
error = (
  ERR_CODE : int,
  ERR_INFO : any,
)
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-edhoc-error-message" class="selfRef">EDHOC Error Message</a>
        </figcaption></figure>
</div>
<p id="section-6-6">where:<a href="#section-6-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-7.1">ERR_CODE - error code encoded as an integer. The value 0 is used for success, all other values (negative or positive) indicate errors.<a href="#section-6-7.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-6-7.2">ERR_INFO - error information. Content and encoding depend on error code.<a href="#section-6-7.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-6-8">The remainder of this section specifies the currently defined error codes, see <a href="#fig-error-codes" class="xref">Figure 7</a>. Additional error codes and corresponding error information may be specified.<a href="#section-6-8" class="pilcrow">¶</a></p>
<span id="name-error-codes-and-error-infor"></span><div id="fig-error-codes">
<figure id="figure-7">
        <div class="artwork art-text alignLeft" id="section-6-9.1">
<pre>
+----------+---------------+----------------------------------------+
| ERR_CODE | ERR_INFO Type | Description                            |
+==========+===============+========================================+
|        0 | any           | Success                                |
+----------+---------------+----------------------------------------+
|        1 | tstr          | Unspecified                            |
+----------+---------------+----------------------------------------+
|        2 | suites        | Wrong selected cipher suite            |
+----------+---------------+----------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-error-codes-and-error-infor" class="selfRef">Error Codes and Error Information</a>
        </figcaption></figure>
</div>
<div id="success">
<section id="section-6.1">
        <h3 id="name-success">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-success" class="section-name selfRef">Success</a>
        </h3>
<p id="section-6.1-1">Error code 0 MAY be used internally in an application to indicate success, e.g., in log files. ERR_INFO can contain any type of CBOR item. Error code 0 MUST NOT be used as part of the EDHOC message exchange flow.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="unspecified">
<section id="section-6.2">
        <h3 id="name-unspecified">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-unspecified" class="section-name selfRef">Unspecified</a>
        </h3>
<p id="section-6.2-1">Error code 1 is used for errors that do not have a specific error code defined. ERR_INFO MUST be a text string containing a human-readable diagnostic message written in English. The diagnostic text message is mainly intended for software engineers that during debugging need to interpret it in the context of the EDHOC specification. The diagnostic message SHOULD be provided to the calling application where it SHOULD be logged.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wrong-selected">
<section id="section-6.3">
        <h3 id="name-wrong-selected-cipher-suite">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-wrong-selected-cipher-suite" class="section-name selfRef">Wrong Selected Cipher Suite</a>
        </h3>
<p id="section-6.3-1">Error code 2 MUST only be used in a response to message_1 in case the cipher suite selected by the Initiator is not supported by the Responder, or if the Responder supports a cipher suite more preferred by the Initiator than the selected cipher suite, see <a href="#resp-proc-msg1" class="xref">Section 5.2.3</a>. ERR_INFO is in this case denoted SUITES_R and is of type suites, see <a href="#asym-msg1-form" class="xref">Section 5.2.1</a>. If the Responder does not support the selected cipher suite, then SUITES_R MUST include one or more supported cipher suites. If the Responder supports a cipher suite in SUITES_I other than the selected cipher suite (independently of if the selected cipher suite is supported or not) then SUITES_R MUST include the supported cipher suite in SUITES_I which is most preferred by the Initiator. SUITES_R MAY include a single cipher suite, i.e., be encoded as an int. If the Responder does not support any cipher suite in SUITES_I, then it SHOULD include all its supported cipher suites in SUITES_R in any order.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<div id="cipher-suite-negotiation">
<section id="section-6.3.1">
          <h4 id="name-cipher-suite-negotiation">
<a href="#section-6.3.1" class="section-number selfRef">6.3.1. </a><a href="#name-cipher-suite-negotiation" class="section-name selfRef">Cipher Suite Negotiation</a>
          </h4>
<p id="section-6.3.1-1">After receiving SUITES_R, the Initiator can determine which cipher suite to select (if any) for the next EDHOC run with the Responder.<a href="#section-6.3.1-1" class="pilcrow">¶</a></p>
<p id="section-6.3.1-2">If the Initiator intends to contact the Responder in the future, the Initiator SHOULD remember which selected cipher suite to use until the next message_1 has been sent, otherwise the Initiator and Responder will likely run into an infinite loop where the Initiator selects its most preferred and the Responder sends an error with supported cipher suites. After a successful run of EDHOC, the Initiator MAY remember the selected cipher suite to use in future EDHOC sessions. Note that if the Initiator or Responder is updated with new cipher suite policies, any cached information may be outdated.<a href="#section-6.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ex-neg">
<section id="section-6.3.2">
          <h4 id="name-examples">
<a href="#section-6.3.2" class="section-number selfRef">6.3.2. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
          </h4>
<p id="section-6.3.2-1">Assume that the Initiator supports the five cipher suites 5, 6, 7, 8, and 9 in decreasing order of preference. Figures <a href="#fig-error1" class="xref">8</a> and <a href="#fig-error2" class="xref">9</a> show examples of how the Initiator can format SUITES_I and how SUITES_R is used by Responders to give the Initiator information about the cipher suites that the Responder supports.<a href="#section-6.3.2-1" class="pilcrow">¶</a></p>
<p id="section-6.3.2-2">In the first example (<a href="#fig-error1" class="xref">Figure 8</a>), the Responder supports cipher suite 6 but not the initially selected cipher suite 5.<a href="#section-6.3.2-2" class="pilcrow">¶</a></p>
<span id="name-example-of-responder-suppor"></span><div id="fig-error1">
<figure id="figure-8">
            <div class="artwork art-text alignCenter" id="section-6.3.2-3.1">
<pre>
Initiator                                                   Responder
|              METHOD, SUITES_I = 5, G_X, C_I, EAD_1                |
+------------------------------------------------------------------&gt;|
|                             message_1                             |
|                                                                   |
|                   ERR_CODE = 2, SUITES_R = 6                      |
|&lt;------------------------------------------------------------------+
|                               error                               |
|                                                                   |
|             METHOD, SUITES_I = [5, 6], G_X, C_I, EAD_1            |
+------------------------------------------------------------------&gt;|
|                             message_1                             |
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-example-of-responder-suppor" class="selfRef">Example of Responder supporting suite 6 but not suite 5.</a>
            </figcaption></figure>
</div>
<p id="section-6.3.2-4">In the second example (<a href="#fig-error2" class="xref">Figure 9</a>), the Responder supports cipher suites 8 and 9 but not the more preferred (by the Initiator) cipher suites 5, 6 or 7. To illustrate the negotiation mechanics we let the Initiator first make a guess that the Responder supports suite 6 but not suite 5. Since the Responder supports neither 5 nor 6, it responds with SUITES_R containing the supported suites, after which the Initiator selects its most preferred supported suite. The order of cipher suites in SUITES_R does not matter. (If the Responder had supported suite 5, it would have included it in SUITES_R of the response, and it would in that case have become the selected suite in the second message_1.)<a href="#section-6.3.2-4" class="pilcrow">¶</a></p>
<span id="name-example-of-responder-support"></span><div id="fig-error2">
<figure id="figure-9">
            <div class="artwork art-text alignCenter" id="section-6.3.2-5.1">
<pre>
Initiator                                                   Responder
|            METHOD, SUITES_I = [5, 6], G_X, C_I, EAD_1             |
+------------------------------------------------------------------&gt;|
|                             message_1                             |
|                                                                   |
|                  ERR_CODE = 2, SUITES_R = [9, 8]                  |
|&lt;------------------------------------------------------------------+
|                               error                               |
|                                                                   |
|           METHOD, SUITES_I = [5, 6, 7, 8], G_X, C_I, EAD_1        |
+------------------------------------------------------------------&gt;|
|                             message_1                             |
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-example-of-responder-support" class="selfRef">Example of Responder supporting suites 8 and 9 but not 5, 6 or 7.</a>
            </figcaption></figure>
</div>
<p id="section-6.3.2-6">Note that the Initiator's list of supported cipher suites and order of preference is fixed (see <a href="#asym-msg1-form" class="xref">Section 5.2.1</a> and <a href="#init-proc-msg1" class="xref">Section 5.2.2</a>). Furthermore, the Responder shall only accept message_1 if the selected cipher suite is the first cipher suite in SUITES_I that the Responder supports (see <a href="#resp-proc-msg1" class="xref">Section 5.2.3</a>). Following this procedure ensures that the selected cipher suite is the most preferred (by the Initiator) cipher suite supported by both parties.<a href="#section-6.3.2-6" class="pilcrow">¶</a></p>
<p id="section-6.3.2-7">If the selected cipher suite is not the first cipher suite which the Responder supports in SUITES_I received in message_1, then Responder MUST discontinue the protocol, see <a href="#resp-proc-msg1" class="xref">Section 5.2.3</a>. If SUITES_I in message_1 is manipulated, then the integrity verification of message_2 containing the transcript hash TH_2 will fail and the Initiator will discontinue the protocol.<a href="#section-6.3.2-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="mti">
<section id="section-7">
      <h2 id="name-mandatory-to-implement-comp">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-mandatory-to-implement-comp" class="section-name selfRef">Mandatory-to-Implement Compliance Requirements</a>
      </h2>
<p id="section-7-1">An implementation may support only Initiator or only Responder.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">An implementation may support only a single method. None of the methods are mandatory-to-implement.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">Implementations MUST support the EDHOC-Exporter. Implementations SHOULD support EDHOC-KeyUpdate.<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">Implementaions MAY support message_4. Error codes 1 and 2 MUST be supported.<a href="#section-7-4" class="pilcrow">¶</a></p>
<p id="section-7-5">Implementations MUST support 'kid' parameters of type int.<a href="#section-7-5" class="pilcrow">¶</a></p>
<p id="section-7-6">Editor's note: Is any COSE header parameters (kid, kcwt, kccs, x5t, c5c, etc. ) MTI?<a href="#section-7-6" class="pilcrow">¶</a></p>
<p id="section-7-7">Editor's note: Is any credential type (CCS, CWT, X.509, C509) MTI?<a href="#section-7-7" class="pilcrow">¶</a></p>
<p id="section-7-8">Editor's note: Is support of EAD MTI?<a href="#section-7-8" class="pilcrow">¶</a></p>
<p id="section-7-9">For many constrained IoT devices it is problematic to support more than one cipher suite. Existing devices can be expected to support either ECDSA or EdDSA. To enable as much interoperability as we can reasonably achieve, less constrained devices SHOULD implement both cipher suite 0 (AES-CCM-16-64-128, SHA-256, 8, X25519, EdDSA, AES-CCM-16-64-128, SHA-256) and cipher suite 2 (AES-CCM-16-64-128, SHA-256, 8, P-256, ES256, AES-CCM-16-64-128, SHA-256). Constrained endpoints SHOULD implement cipher suite 0 or cipher suite 2. Implementations only need to implement the algorithms needed for their supported methods.<a href="#section-7-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="sec-prop">
<section id="section-8.1">
        <h3 id="name-security-properties">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-security-properties" class="section-name selfRef">Security Properties</a>
        </h3>
<p id="section-8.1-1">EDHOC inherits its security properties from the theoretical SIGMA-I protocol <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>. Using the terminology from <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>, EDHOC provides forward secrecy, mutual authentication with aliveness, consistency, and peer awareness. As described in <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>, peer awareness is provided to the Responder, but not to the Initiator.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">EDHOC protects the credential identifier of the Initiator against active attacks and the credential identifier of the Responder against passive attacks. The roles should be assigned to protect the most sensitive identity/identifier, typically that which is not possible to infer from routing information in the lower layers.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">Compared to <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>, EDHOC adds an explicit method type and expands the message authentication coverage to additional elements such as algorithms, external authorization data, and previous messages. This protects against an attacker replaying messages or injecting messages from another session.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1-4">EDHOC also adds selection of connection identifiers and downgrade protected negotiation of cryptographic parameters, i.e., an attacker cannot affect the negotiated parameters. A single session of EDHOC does not include negotiation of cipher suites, but it enables the Responder to verify that the selected cipher suite is the most preferred cipher suite by the Initiator which is supported by both the Initiator and the Responder.<a href="#section-8.1-4" class="pilcrow">¶</a></p>
<p id="section-8.1-5">As required by <span>[<a href="#RFC7258" class="xref">RFC7258</a>]</span>, IETF protocols need to mitigate pervasive monitoring when possible. EDHOC therefore only supports methods with ephemeral Diffie-Hellman and provides a KeyUpdate function for lightweight application protocol rekeying with forward secrecy, in the sense that compromise of the private authentication keys does not compromise past session keys, and compromise of a session key does not compromise past session keys.<a href="#section-8.1-5" class="pilcrow">¶</a></p>
<p id="section-8.1-6">While the KeyUpdate method can be used to meet cryptographic limits and provide partial protection against key leakage, it provides significantly weaker security properties than re-running EDHOC with ephemeral Diffie-Hellman. Even with frequent use of KeyUpdate, compromise of one session key compromises all future session keys, and an attacker therefore only needs to perform static key exfiltration <span>[<a href="#RFC7624" class="xref">RFC7624</a>]</span>. Frequently re-running EDHOC with ephemeral Diffie-Hellman forces attackers to perform dynamic key exfiltration instead of static key exfiltration <span>[<a href="#RFC7624" class="xref">RFC7624</a>]</span>. In the dynamic case, the attacker must have continuous interactions with the collaborator, which is more complicated and has a higher risk profile than the static case.<a href="#section-8.1-6" class="pilcrow">¶</a></p>
<p id="section-8.1-7">To limit the effect of breaches, it is important to limit the use of symmetrical group keys for bootstrapping. EDHOC therefore strives to make the additional cost of using raw public keys and self-signed certificates as small as possible. Raw public keys and self-signed certificates are not a replacement for a public key infrastructure but SHOULD be used instead of symmetrical group keys for bootstrapping.<a href="#section-8.1-7" class="pilcrow">¶</a></p>
<p id="section-8.1-8">Compromise of the long-term keys (private signature or static DH keys) does not compromise the security of completed EDHOC exchanges. Compromising the private authentication keys of one party lets an active attacker impersonate that compromised party in EDHOC exchanges with other parties but does not let the attacker impersonate other parties in EDHOC exchanges with the compromised party. Compromise of the long-term keys does not enable a passive attacker to compromise future session keys. Compromise of the HDKF input parameters (ECDH shared secret) leads to compromise of all session keys derived from that compromised shared secret. Compromise of one session key does not compromise other session keys. Compromise of PRK_4x3m leads to compromise of all exported keying material derived after the last invocation of the EDHOC-KeyUpdate function.<a href="#section-8.1-8" class="pilcrow">¶</a></p>
<p id="section-8.1-9">EDHOC provides a minimum of 64-bit security against online brute force attacks and a minimum of 128-bit security against offline brute force attacks. This is in line with IPsec, TLS, and COSE. To break 64-bit security against online brute force an attacker would on average have to send 4.3 billion messages per second for 68 years, which is infeasible in constrained IoT radio technologies.<a href="#section-8.1-9" class="pilcrow">¶</a></p>
<p id="section-8.1-10">After sending message_3, the Initiator is assured that no other party than the Responder can compute the key PRK_4x3m (implicit key authentication). The Initiator does however not know that the Responder has actually computed the key PRK_4x3m. While the Initiator can securely send protected application data, the Initiator SHOULD NOT permanently store the keying material PRK_4x3m and TH_4 until the Initiator is assured that the Responder has actually computed the key PRK_4x3m (explicit key confirmation). Explicit key confirmation is e.g., assured when the Initiator has verified an OSCORE message or message_4 from the Responder. After verifying message_3, the Responder is assured that the Initiator has calculated the key PRK_4x3m (explicit key confirmation) and that no other party than the Responder can compute the key. The Responder can securely send protected application data and store the keying material PRK_4x3m and TH_4.<a href="#section-8.1-10" class="pilcrow">¶</a></p>
<p id="section-8.1-11">Key compromise impersonation (KCI): In EDHOC authenticated with signature keys, EDHOC provides KCI protection against an attacker having access to the long-term key or the ephemeral secret key. With static Diffie-Hellman key authentication, KCI protection would be provided against an attacker having access to the long-term Diffie-Hellman key, but not to an attacker having access to the ephemeral secret key. Note that the term KCI has typically been used for compromise of long-term keys, and that an attacker with access to the ephemeral secret key can only attack that specific session.<a href="#section-8.1-11" class="pilcrow">¶</a></p>
<p id="section-8.1-12">Repudiation: In EDHOC authenticated with signature keys, the Initiator could theoretically prove that the Responder performed a run of the protocol by presenting the private ephemeral key, and vice versa. Note that storing the private ephemeral keys violates the protocol requirements. With static Diffie-Hellman key authentication, both parties can always deny having participated in the protocol.<a href="#section-8.1-12" class="pilcrow">¶</a></p>
<p id="section-8.1-13">Two earlier versions of EDHOC have been formally analyzed <span>[<a href="#Norrman20" class="xref">Norrman20</a>]</span> <span>[<a href="#Bruni18" class="xref">Bruni18</a>]</span> and the specification has been updated based on the analysis.<a href="#section-8.1-13" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cryptographic-considerations">
<section id="section-8.2">
        <h3 id="name-cryptographic-consideration">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-cryptographic-consideration" class="section-name selfRef">Cryptographic Considerations</a>
        </h3>
<p id="section-8.2-1">The SIGMA protocol requires that the encryption of message_3 provides confidentiality against active attackers and EDHOC message_4 relies on the use of
authenticated encryption. Hence the message authenticating functionality of the authenticated encryption in EDHOC is critical: authenticated encryption MUST NOT be replaced by plain encryption only, even if authentication is provided at another level or through a different mechanism.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">To reduce message overhead EDHOC does not use explicit nonces and instead rely on the ephemeral public keys to provide randomness to each session. A good amount of randomness is important for the key generation, to provide liveness, and to protect against interleaving attacks. For this reason, the ephemeral keys MUST NOT be used in more than one EDHOC message, and both parties SHALL generate fresh random ephemeral key pairs. Note that an ephemeral key may be used to calculate several ECDH shared secrets. When static Diffie-Hellman authentication is used the same ephemeral key is used in both ephemeral-ephemeral and ephemeral-static ECDH.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<p id="section-8.2-3">As discussed in <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>, the encryption of message_2 does only need to protect against passive attacker as active attackers can always get the Responders identity by sending their own message_1. EDHOC uses the Expand function (typically HKDF-Expand) as a binary additive stream cipher. HKDF-Expand provides better confidentiality than AES-CTR but is not often used as it is slow on long messages, and most applications require both IND-CCA confidentiality as well as integrity protection. For the encryption of message_2, any speed difference is negligible, IND-CCA does not increase security, and integrity is provided by the inner MAC (and signature depending on method).<a href="#section-8.2-3" class="pilcrow">¶</a></p>
<p id="section-8.2-4">Requirement for how to securely generate, validate, and process the ephemeral public keys depend on the elliptic curve. For X25519 and X448, the requirements are defined in <span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>. For secp256r1, secp384r1, and secp521r1, the requirements are defined in Section 5 of <span>[<a href="#SP-800-56A" class="xref">SP-800-56A</a>]</span>. For secp256r1, secp384r1, and secp521r1, at least partial public-key validation MUST be done.<a href="#section-8.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cipher-suites-and-cryptographic-algorithms">
<section id="section-8.3">
        <h3 id="name-cipher-suites-and-cryptogra">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-cipher-suites-and-cryptogra" class="section-name selfRef">Cipher Suites and Cryptographic Algorithms</a>
        </h3>
<p id="section-8.3-1">When using private cipher suite or registering new cipher suites, the choice of key length used in the different algorithms needs to be harmonized, so that a sufficient security level is maintained for certificates, EDHOC, and the protection of application data. The Initiator and the Responder should enforce a minimum security level.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">The hash algorithms SHA-1 and SHA-256/64 (SHA-256 truncated to 64-bits) SHALL NOT be supported for use in EDHOC except for certificate identification with x5t and c5t. Note that secp256k1 is only defined for use with ECDSA and not for ECDH. Note that some COSE algorithms are marked as not recommended in the COSE IANA registry.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="unprot-data">
<section id="section-8.4">
        <h3 id="name-unprotected-data">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-unprotected-data" class="section-name selfRef">Unprotected Data</a>
        </h3>
<p id="section-8.4-1">The Initiator and the Responder must make sure that unprotected data and metadata do not reveal any sensitive information. This also applies for encrypted data sent to an unauthenticated party. In particular, it applies to EAD_1, ID_CRED_R, EAD_2, and error messages. Using the same EAD_1 in several EDHOC sessions allows passive eavesdroppers to correlate the different sessions. Another consideration is that the list of supported cipher suites may potentially be used to identify the application.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<p id="section-8.4-2">The Initiator and the Responder must also make sure that unauthenticated data does not trigger any harmful actions. In particular, this applies to EAD_1 and error messages.<a href="#section-8.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="dos">
<section id="section-8.5">
        <h3 id="name-denial-of-service">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-denial-of-service" class="section-name selfRef">Denial-of-Service</a>
        </h3>
<p id="section-8.5-1">EDHOC itself does not provide countermeasures against Denial-of-Service attacks. By sending a number of new or replayed message_1 an attacker may cause the Responder to allocate state, perform cryptographic operations, and amplify messages. To mitigate such attacks, an implementation SHOULD rely on lower layer mechanisms such as the Echo option in CoAP <span>[<a href="#I-D.ietf-core-echo-request-tag" class="xref">I-D.ietf-core-echo-request-tag</a>]</span> that forces the initiator to demonstrate reachability at its apparent network address.<a href="#section-8.5-1" class="pilcrow">¶</a></p>
<p id="section-8.5-2">An attacker can also send faked message_2, message_3, message_4, or error in an attempt to trick the receiving party to send an error message and discontinue the session. EDHOC implementations MAY evaluate if a received message is likely to have been forged by an attacker and ignore it without sending an error message or discontinuing the session.<a href="#section-8.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implementation-considerations">
<section id="section-8.6">
        <h3 id="name-implementation-consideratio">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-implementation-consideratio" class="section-name selfRef">Implementation Considerations</a>
        </h3>
<p id="section-8.6-1">The availability of a secure random number generator is essential for the security of EDHOC. If no true random number generator is available, a truly random seed MUST be provided from an external source and used with a cryptographically secure pseudorandom number generator. As each pseudorandom number must only be used once, an implementation needs to get a new truly random seed after reboot, or continuously store state in nonvolatile memory, see (<span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>, Appendix B.1.1) for issues and solution approaches for writing to nonvolatile memory. Intentionally or unintentionally weak or predictable pseudorandom number generators can be abused or exploited for malicious purposes. <span>[<a href="#RFC8937" class="xref">RFC8937</a>]</span> describes a way for security protocol implementations to augment their (pseudo)random number generators using a long-term private key and a deterministic signature function. This improves randomness from broken or otherwise subverted random number generators. The same idea can be used with other secrets and functions such as a Diffie-Hellman function or a symmetric secret and a PRF like HMAC or KMAC. It is RECOMMENDED to not trust a single source of randomness and to not put unaugmented random numbers on the wire.<a href="#section-8.6-1" class="pilcrow">¶</a></p>
<p id="section-8.6-2">If ECDSA is supported, "deterministic ECDSA" as specified in <span>[<a href="#RFC6979" class="xref">RFC6979</a>]</span> MAY be used. Pure deterministic elliptic-curve signatures such as deterministic ECDSA and EdDSA have gained popularity over randomized ECDSA as their security do not depend on a source of high-quality randomness. Recent research has however found that implementations of these signature algorithms may be vulnerable to certain side-channel and
fault injection attacks due to their determinism. See e.g., Section 1 of <span>[<a href="#I-D.mattsson-cfrg-det-sigs-with-noise" class="xref">I-D.mattsson-cfrg-det-sigs-with-noise</a>]</span> for a list of attack papers. As suggested in Section 6.1.2 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-algs" class="xref">I-D.ietf-cose-rfc8152bis-algs</a>]</span> this can be addressed by combining randomness and determinism.<a href="#section-8.6-2" class="pilcrow">¶</a></p>
<p id="section-8.6-3">All private keys, symmetric keys, and IVs MUST be secret. Implementations should provide countermeasures to side-channel attacks such as timing attacks. Intermediate computed values such as ephemeral ECDH keys and ECDH shared secrets MUST be deleted after key derivation is completed.<a href="#section-8.6-3" class="pilcrow">¶</a></p>
<p id="section-8.6-4">The Initiator and the Responder are responsible for verifying the integrity of certificates. The selection of trusted CAs should be done very carefully and certificate revocation should be supported. The private authentication keys MUST be kept secret, only the Responder SHALL have access to the Responder's private authentication key and only the Initiator SHALL have access to the Initiator's private authentication key.<a href="#section-8.6-4" class="pilcrow">¶</a></p>
<p id="section-8.6-5">The Initiator and the Responder are allowed to select the connection identifiers C_I and C_R, respectively, for the other party to use in the ongoing EDHOC protocol as well as in a subsequent application protocol (e.g., OSCORE <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>). The choice of connection identifier is not security critical in EDHOC but intended to simplify the retrieval of the right security context in combination with using short identifiers. If the wrong connection identifier of the other party is used in a protocol message it will result in the receiving party not being able to retrieve a security context (which will terminate the protocol) or retrieve the wrong security context (which also terminates the protocol as the message cannot be verified).<a href="#section-8.6-5" class="pilcrow">¶</a></p>
<p id="section-8.6-6">If two nodes unintentionally initiate two simultaneous EDHOC message exchanges with each other even if they only want to complete a single EDHOC message exchange, they MAY terminate the exchange with the lexicographically smallest G_X. If the two G_X values are equal, the received message_1 MUST be discarded to mitigate reflection attacks. Note that in the case of two simultaneous EDHOC exchanges where the nodes only complete one and where the nodes have different preferred cipher suites, an attacker can affect which of the two nodes' preferred cipher suites will be used by blocking the other exchange.<a href="#section-8.6-6" class="pilcrow">¶</a></p>
<p id="section-8.6-7">If supported by the device, it is RECOMMENDED that at least the long-term private keys are stored in a Trusted Execution Environment (TEE) and that sensitive operations using these keys are performed inside the TEE.  To achieve even higher security it is RECOMMENDED that additional operations such as ephemeral key generation, all computations of shared secrets, and storage of the PRK keys can be done inside the TEE. The use of a TEE enforces that code within that environment cannot be tampered with, and that any data used by such code cannot be read or tampered with by code outside that environment.<a href="#section-8.6-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="exporter-label">
<section id="section-9.1">
        <h3 id="name-edhoc-exporter-label-regist">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-edhoc-exporter-label-regist" class="section-name selfRef">EDHOC Exporter Label Registry</a>
        </h3>
<p id="section-9.1-1">IANA has created a new registry titled "EDHOC Exporter Label" under the new group name "Ephemeral Diffie-Hellman Over COSE (EDHOC)". The registration procedure is "Expert Review". The columns of the registry are Label, Description, and Reference. All columns are text strings where Label consists only of the printable ASCII characters 0x21 - 0x7e. Labels beginning with "PRIVATE" MAY be used for private use without registration. All other label values MUST be registered. The initial contents of the registry are:<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.1-2">
<pre>
Label: EDHOC_K_4
Description: Key used to protect EDHOC message_4
Reference: [[this document]]
</pre><a href="#section-9.1-2" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.1-3">
<pre>
Label: EDHOC_IV_4
Description: IV used to protect EDHOC message_4
Reference: [[this document]]
</pre><a href="#section-9.1-3" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.1-4">
<pre>
Label: OSCORE_Master_Secret
Description: Derived OSCORE Master Secret
Reference: [[this document]]
</pre><a href="#section-9.1-4" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.1-5">
<pre>
Label: OSCORE_Master_Salt
Description: Derived OSCORE Master Salt
Reference: [[this document]]
</pre><a href="#section-9.1-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="suites-registry">
<section id="section-9.2">
        <h3 id="name-edhoc-cipher-suites-registr">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-edhoc-cipher-suites-registr" class="section-name selfRef">EDHOC Cipher Suites Registry</a>
        </h3>
<p id="section-9.2-1">IANA has created a new registry titled "EDHOC Cipher Suites" under the new group name "Ephemeral Diffie-Hellman Over COSE (EDHOC)". The registration procedure is "Expert Review". The columns of the registry are Value, Array, Description, and Reference, where Value is an integer and the other columns are text strings. The initial contents of the registry are:<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.2-2">
<pre>
Value: -24
Algorithms: N/A
Desc: Reserved for Private Use
Reference: [[this document]]
</pre><a href="#section-9.2-2" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-3">
<pre>
Value: -23
Algorithms: N/A
Desc: Reserved for Private Use
Reference: [[this document]]
</pre><a href="#section-9.2-3" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-4">
<pre>
Value: -22
Algorithms: N/A
Desc: Reserved for Private Use
Reference: [[this document]]
</pre><a href="#section-9.2-4" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-5">
<pre>
Value: -21
Algorithms: N/A
Desc: Reserved for Private Use
Reference: [[this document]]
</pre><a href="#section-9.2-5" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-6">
<pre>
Value: 0
Array: 10, -16, 8, 4, -8, 10, -16
Desc: AES-CCM-16-64-128, SHA-256, 8, X25519, EdDSA,
      AES-CCM-16-64-128, SHA-256
Reference: [[this document]]
</pre><a href="#section-9.2-6" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-7">
<pre>
Value: 1
Array: 30, -16, 16, 4, -8, 10, -16
Desc: AES-CCM-16-128-128, SHA-256, 16, X25519, EdDSA,
      AES-CCM-16-64-128, SHA-256
Reference: [[this document]]
</pre><a href="#section-9.2-7" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-8">
<pre>
Value: 2
Array: 10, -16, 8, 1, -7, 10, -16
Desc: AES-CCM-16-64-128, SHA-256, 8, P-256, ES256,
      AES-CCM-16-64-128, SHA-256
Reference: [[this document]]
</pre><a href="#section-9.2-8" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-9">
<pre>
Value: 3
Array: 30, -16, 16, 1, -7, 10, -16
Desc: AES-CCM-16-128-128, SHA-256, 16, P-256, ES256,
      AES-CCM-16-64-128, SHA-256
Reference: [[this document]]
</pre><a href="#section-9.2-9" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-10">
<pre>
Value: 4
Array: 24, -16, 16, 4, -8, 24, -16
Desc: ChaCha20/Poly1305, SHA-256, 16, X25519, EdDSA,
      ChaCha20/Poly1305, SHA-256
Reference: [[this document]]
</pre><a href="#section-9.2-10" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-11">
<pre>
Value: 5
Array: 24, -16, 16, 1, -7, 24, -16
Desc: ChaCha20/Poly1305, SHA-256, 16, P-256, ES256,
      ChaCha20/Poly1305, SHA-256
Reference: [[this document]]
</pre><a href="#section-9.2-11" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-12">
<pre>
Value: 6
Array: 1, -16, 16, 4, -7, 1, -16
Desc: A128GCM, SHA-256, 16, X25519, ES256,
      A128GCM, SHA-256
Reference: [[this document]]
</pre><a href="#section-9.2-12" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-13">
<pre>
Value: 24
Array: 3, -43, 16, 2, -35, 3, -43
Desc: A256GCM, SHA-384, 16, P-384, ES384,
      A256GCM, SHA-384
Reference: [[this document]]
</pre><a href="#section-9.2-13" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-9.2-14">
<pre>
Value: 25
Array: 24, -45, 16, 5, -8, 24, -45
Desc: ChaCha20/Poly1305, SHAKE256, 16, X448, EdDSA,
      ChaCha20/Poly1305, SHAKE256
Reference: [[this document]]
</pre><a href="#section-9.2-14" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="method-types">
<section id="section-9.3">
        <h3 id="name-edhoc-method-type-registry">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-edhoc-method-type-registry" class="section-name selfRef">EDHOC Method Type Registry</a>
        </h3>
<p id="section-9.3-1">IANA has created a new registry entitled "EDHOC Method Type" under the new group name "Ephemeral Diffie-Hellman Over COSE (EDHOC)". The registration procedure is "Expert Review". The columns of the registry are Value, Description, and Reference, where Value is an integer and the other columns are text strings. The initial contents of the registry are shown in <a href="#fig-method-types" class="xref">Figure 4</a>.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="edhoc-error-codes-registry">
<section id="section-9.4">
        <h3 id="name-edhoc-error-codes-registry">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-edhoc-error-codes-registry" class="section-name selfRef">EDHOC Error Codes Registry</a>
        </h3>
<p id="section-9.4-1">IANA has created a new registry entitled "EDHOC Error Codes" under the new group name "Ephemeral Diffie-Hellman Over COSE (EDHOC)". The registration procedure is "Expert Review". The columns of the registry are ERR_CODE, ERR_INFO Type and Description, where ERR_CODE is an integer, ERR_INFO is a CDDL defined type, and Description is a text string. The initial contents of the registry are shown in <a href="#fig-error-codes" class="xref">Figure 7</a>.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-ead">
<section id="section-9.5">
        <h3 id="name-edhoc-external-authorizatio">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-edhoc-external-authorizatio" class="section-name selfRef">EDHOC External Authorization Data Registry</a>
        </h3>
<p id="section-9.5-1">IANA has created a new registry entitled "EDHOC External Authorization Data" under the new group name "Ephemeral Diffie-Hellman Over COSE (EDHOC)". The registration procedure is "Expert Review". The columns of the registry are Label, Description, Value Type, and Reference, where Label is an integer and the other columns are text strings.<a href="#section-9.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cwt-header-param">
<section id="section-9.6">
        <h3 id="name-cose-header-parameters-regi">
<a href="#section-9.6" class="section-number selfRef">9.6. </a><a href="#name-cose-header-parameters-regi" class="section-name selfRef">COSE Header Parameters Registry</a>
        </h3>
<p id="section-9.6-1">IANA has registered the following entries in the "COSE Header Parameters" registry under the group name "CBOR Object Signing and Encryption (COSE)". The value of the 'kcwt' header parameter is a COSE Web Token (CWT) <span>[<a href="#RFC8392" class="xref">RFC8392</a>]</span>, and the value of the 'kccs' header parameter is an CWT Claims Set (CCS), see <a href="#term" class="xref">Section 1.5</a>. The CWT/CCS must contain a COSE_Key in a 'cnf' claim <span>[<a href="#RFC8747" class="xref">RFC8747</a>]</span>. The Value Registry for this item is empty and omitted from the table below.<a href="#section-9.6-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.6-2">
<pre>
+-----------+-------+----------------+---------------------------+
| Name      | Label | Value Type     | Description               |
+===========+=======+================+===========================+
| kcwt      | TBD1  | COSE_Messages  | A CBOR Web Token (CWT)    |
|           |       |                | containing a COSE_Key in  |
|           |       |                | a 'cnf' claim             |
+-----------+-------+----------------+---------------------------+
| kccs      | TBD2  | map / #6(map)  | A CWT Claims Set (CCS)    |
|           |       |                | containing a COSE_Key in  |
|           |       |                | a 'cnf' claim             |
+-----------+-------+----------------+---------------------------+
</pre><a href="#section-9.6-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="kid-header-param">
<section id="section-9.7">
        <h3 id="name-cose-header-parameters-regis">
<a href="#section-9.7" class="section-number selfRef">9.7. </a><a href="#name-cose-header-parameters-regis" class="section-name selfRef">COSE Header Parameters Registry</a>
        </h3>
<p id="section-9.7-1">IANA has extended the Value Type of 'kid' in the "COSE Header Parameters" registry under the group name "CBOR Object Signing and Encryption (COSE)" to also allow the Value Type int. The resulting Value Type is bstr / int. The Value Registry for this item is empty and omitted from the table below.<a href="#section-9.7-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.7-2">
<pre>
+------+-------+------------+----------------+-------------------+
| Name | Label | Value Type | Description    | Reference         |
+------+-------+------------+----------------+-------------------+
| kid  |   4   | bstr / int | Key identifier | [RFC9052]         |
|      |       |            |                | [[This document]] |
+------+-------+------------+----------------+-------------------+
</pre><a href="#section-9.7-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="kid-key-common-param">
<section id="section-9.8">
        <h3 id="name-cose-key-common-parameters-">
<a href="#section-9.8" class="section-number selfRef">9.8. </a><a href="#name-cose-key-common-parameters-" class="section-name selfRef">COSE Key Common Parameters Registry</a>
        </h3>
<p id="section-9.8-1">IANA has extended the Value Type of 'kid' in the "COSE Key Common Parameters" registry under the group name "CBOR Object Signing and Encryption (COSE)" to also allow the Value Type int. The resulting Value Type is bstr / int. The Value Registry for this item is empty and omitted from the table below.<a href="#section-9.8-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.8-2">
<pre>
+------+-------+------------+----------------+-------------------+
| Name | Label | Value Type | Description    | Reference         |
+------+-------+------------+----------------+-------------------+
| kid  |   2   | bstr / int | Key identifi-  | [RFC9052]         |
|      |       |            | cation value - | [[This document]] |
|      |       |            | match to kid   |                   |
|      |       |            | in message     |                   |
+------+-------+------------+----------------+-------------------+
</pre><a href="#section-9.8-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="kid-cwt-conf-meth-param">
<section id="section-9.9">
        <h3 id="name-cwt-confirmation-methods-re">
<a href="#section-9.9" class="section-number selfRef">9.9. </a><a href="#name-cwt-confirmation-methods-re" class="section-name selfRef">CWT Confirmation Methods Registry</a>
        </h3>
<p id="section-9.9-1">IANA has extended the Value Type of 'kid' in the "CWT Confirmation Methods" registry under the group name "CBOR Web Token (CWT) Claims" to also allow the Value Type int. The incorrect term binary string has been corrected to bstr. The resulting Value Type is bstr / int. The new updated content for the 'kid' method is shown in the list below.<a href="#section-9.9-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.9-2.1">Confirmation Method Name: kid<a href="#section-9.9-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.9-2.2">Confirmation Method Description: Key Identifier<a href="#section-9.9-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.9-2.3">JWT Confirmation Method Name: kid<a href="#section-9.9-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.9-2.4">Confirmation Key: 3<a href="#section-9.9-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.9-2.5">Confirmation Value Type(s): bstr / int<a href="#section-9.9-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.9-2.6">Change Controller: IESG<a href="#section-9.9-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.9-2.7">Specification Document(s): Section 3.4 of RFC 8747 [[This document]]<a href="#section-9.9-2.7" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="the-well-known-uri-registry">
<section id="section-9.10">
        <h3 id="name-the-well-known-uri-registry">
<a href="#section-9.10" class="section-number selfRef">9.10. </a><a href="#name-the-well-known-uri-registry" class="section-name selfRef">The Well-Known URI Registry</a>
        </h3>
<p id="section-9.10-1">IANA has added the well-known URI "edhoc" to the "Well-Known URIs" registry under the group name "Well-Known URIs".<a href="#section-9.10-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.10-2.1">URI suffix: edhoc<a href="#section-9.10-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.10-2.2">Change controller: IETF<a href="#section-9.10-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.10-2.3">Specification document(s): [[this document]]<a href="#section-9.10-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.10-2.4">Related information: None<a href="#section-9.10-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="media-types-registry">
<section id="section-9.11">
        <h3 id="name-media-types-registry">
<a href="#section-9.11" class="section-number selfRef">9.11. </a><a href="#name-media-types-registry" class="section-name selfRef">Media Types Registry</a>
        </h3>
<p id="section-9.11-1">IANA has added the media type "application/edhoc" to the "Media Types" registry.<a href="#section-9.11-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.11-2.1">Type name: application<a href="#section-9.11-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.2">Subtype name: edhoc<a href="#section-9.11-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.3">Required parameters: N/A<a href="#section-9.11-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.4">Optional parameters: N/A<a href="#section-9.11-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.5">Encoding considerations: binary<a href="#section-9.11-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.6">Security considerations: See Section 7 of this document.<a href="#section-9.11-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.7">Interoperability considerations: N/A<a href="#section-9.11-2.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.8">Published specification: [[this document]] (this document)<a href="#section-9.11-2.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.9">Applications that use this media type: To be identified<a href="#section-9.11-2.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.10">Fragment identifier considerations: N/A<a href="#section-9.11-2.10" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.11">
            <p id="section-9.11-2.11.1">Additional information:<a href="#section-9.11-2.11.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.11-2.11.2.1">Magic number(s): N/A<a href="#section-9.11-2.11.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-9.11-2.11.2.2">File extension(s): N/A<a href="#section-9.11-2.11.2.2" class="pilcrow">¶</a>
</li>
              <li class="normal" id="section-9.11-2.11.2.3">Macintosh file type code(s): N/A<a href="#section-9.11-2.11.2.3" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="section-9.11-2.12">Person &amp; email address to contact for further information: See "Authors' Addresses" section.<a href="#section-9.11-2.12" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.13">Intended usage: COMMON<a href="#section-9.11-2.13" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.14">Restrictions on usage: N/A<a href="#section-9.11-2.14" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.15">Author: See "Authors' Addresses" section.<a href="#section-9.11-2.15" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.11-2.16">Change Controller: IESG<a href="#section-9.11-2.16" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="coap-content-formats-registry">
<section id="section-9.12">
        <h3 id="name-coap-content-formats-regist">
<a href="#section-9.12" class="section-number selfRef">9.12. </a><a href="#name-coap-content-formats-regist" class="section-name selfRef">CoAP Content-Formats Registry</a>
        </h3>
<p id="section-9.12-1">IANA has added the media type "application/edhoc" to the "CoAP Content-Formats" registry under the group name "Constrained RESTful Environments (CoRE) Parameters".<a href="#section-9.12-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.12-2.1">Media Type: application/edhoc<a href="#section-9.12-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.12-2.2">Encoding:<a href="#section-9.12-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.12-2.3">ID: TBD42<a href="#section-9.12-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.12-2.4">Reference: [[this document]]<a href="#section-9.12-2.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="resource-type-rt-link-target-attribute-values-registry">
<section id="section-9.13">
        <h3 id="name-resource-type-rt-link-targe">
<a href="#section-9.13" class="section-number selfRef">9.13. </a><a href="#name-resource-type-rt-link-targe" class="section-name selfRef">Resource Type (rt=) Link Target Attribute Values Registry</a>
        </h3>
<p id="section-9.13-1">IANA has added the resource type "core.edhoc" to the "Resource Type (rt=) Link Target Attribute Values" registry under the group name "Constrained RESTful Environments (CoRE) Parameters".<a href="#section-9.13-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.13-2.1">Value: "core.edhoc"<a href="#section-9.13-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.13-2.2">Description: EDHOC resource.<a href="#section-9.13-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.13-2.3">Reference: [[this document]]<a href="#section-9.13-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-9.13-3">Client applications can use this resource type to discover a server's resource for EDHOC, where to send a request for executing the EDHOC protocol.<a href="#section-9.13-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="expert-review-instructions">
<section id="section-9.14">
        <h3 id="name-expert-review-instructions">
<a href="#section-9.14" class="section-number selfRef">9.14. </a><a href="#name-expert-review-instructions" class="section-name selfRef">Expert Review Instructions</a>
        </h3>
<p id="section-9.14-1">The IANA Registries established in this document is defined as "Expert Review". This section gives some general guidelines for what the experts should be looking for, but they are being designated as experts for a reason so they should be given substantial latitude.<a href="#section-9.14-1" class="pilcrow">¶</a></p>
<p id="section-9.14-2">Expert reviewers should take into consideration the following points:<a href="#section-9.14-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.14-3.1">Clarity and correctness of registrations. Experts are expected to check the clarity of purpose and use of the requested entries. Expert needs to make sure the values of algorithms are taken from the right registry, when that is required. Expert should consider requesting an opinion on the correctness of registered parameters from relevant IETF working groups. Encodings that do not meet these objective of clarity and completeness should not be registered.<a href="#section-9.14-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.14-3.2">Experts should take into account the expected usage of fields when approving point assignment. The length of the encoded value should be weighed against how many code points of that length are left, the size of device it will be used on, and the number of code points left that encode to that size.<a href="#section-9.14-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.14-3.3">Specifications are recommended. When specifications are not provided, the description provided needs to have sufficient information to verify the points above.<a href="#section-9.14-3.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-core-echo-request-tag">[I-D.ietf-core-echo-request-tag]</dt>
        <dd>
<span class="refAuthor">Amsüss, C.</span>, <span class="refAuthor">Mattsson, J. P.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"CoAP: Echo, Request-Tag, and Token Processing"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-echo-request-tag-13</span>, <time datetime="2021-07-12" class="refDate">12 July 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-core-echo-request-tag-13.txt">https://www.ietf.org/archive/id/draft-ietf-core-echo-request-tag-13.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-rfc8152bis-algs">[I-D.ietf-cose-rfc8152bis-algs]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Initial Algorithms"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-rfc8152bis-algs-12</span>, <time datetime="2020-09-24" class="refDate">24 September 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-cose-rfc8152bis-algs-12.txt">https://www.ietf.org/archive/id/draft-ietf-cose-rfc8152bis-algs-12.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-rfc8152bis-struct">[I-D.ietf-cose-rfc8152bis-struct]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Structures and Process"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-rfc8152bis-struct-15</span>, <time datetime="2021-02-01" class="refDate">1 February 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-cose-rfc8152bis-struct-15.txt">https://www.ietf.org/archive/id/draft-ietf-cose-rfc8152bis-struct-15.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-x509">[I-D.ietf-cose-x509]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Header parameters for carrying and referencing X.509 certificates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-x509-08</span>, <time datetime="2020-12-14" class="refDate">14 December 2020</time>, <span>&lt;<a href="https://www.ietf.org/internet-drafts/draft-ietf-cose-x509-08.txt">https://www.ietf.org/internet-drafts/draft-ietf-cose-x509-08.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5116">[RFC5116]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span>, <span class="refTitle">"An Interface and Algorithms for Authenticated Encryption"</span>, <span class="seriesInfo">RFC 5116</span>, <span class="seriesInfo">DOI 10.17487/RFC5116</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5116">https://www.rfc-editor.org/info/rfc5116</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5280">[RFC5280]</dt>
        <dd>
<span class="refAuthor">Cooper, D.</span>, <span class="refAuthor">Santesson, S.</span>, <span class="refAuthor">Farrell, S.</span>, <span class="refAuthor">Boeyen, S.</span>, <span class="refAuthor">Housley, R.</span>, and <span class="refAuthor">W. Polk</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"</span>, <span class="seriesInfo">RFC 5280</span>, <span class="seriesInfo">DOI 10.17487/RFC5280</span>, <time datetime="2008-05" class="refDate">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5280">https://www.rfc-editor.org/info/rfc5280</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5869">https://www.rfc-editor.org/info/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6090">[RFC6090]</dt>
        <dd>
<span class="refAuthor">McGrew, D.</span>, <span class="refAuthor">Igoe, K.</span>, and <span class="refAuthor">M. Salter</span>, <span class="refTitle">"Fundamental Elliptic Curve Cryptography Algorithms"</span>, <span class="seriesInfo">RFC 6090</span>, <span class="seriesInfo">DOI 10.17487/RFC6090</span>, <time datetime="2011-02" class="refDate">February 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6090">https://www.rfc-editor.org/info/rfc6090</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6979">[RFC6979]</dt>
        <dd>
<span class="refAuthor">Pornin, T.</span>, <span class="refTitle">"Deterministic Usage of the Digital Signature Algorithm (DSA) and Elliptic Curve Digital Signature Algorithm (ECDSA)"</span>, <span class="seriesInfo">RFC 6979</span>, <span class="seriesInfo">DOI 10.17487/RFC6979</span>, <time datetime="2013-08" class="refDate">August 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6979">https://www.rfc-editor.org/info/rfc6979</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Hartke, K.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7624">[RFC7624]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Schneier, B.</span>, <span class="refAuthor">Jennings, C.</span>, <span class="refAuthor">Hardie, T.</span>, <span class="refAuthor">Trammell, B.</span>, <span class="refAuthor">Huitema, C.</span>, and <span class="refAuthor">D. Borkmann</span>, <span class="refTitle">"Confidentiality in the Face of Pervasive Surveillance: A Threat Model and Problem Statement"</span>, <span class="seriesInfo">RFC 7624</span>, <span class="seriesInfo">DOI 10.17487/RFC7624</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7624">https://www.rfc-editor.org/info/rfc7624</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7748">[RFC7748]</dt>
        <dd>
<span class="refAuthor">Langley, A.</span>, <span class="refAuthor">Hamburg, M.</span>, and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7748">https://www.rfc-editor.org/info/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7959">[RFC7959]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">Z. Shelby, Ed.</span>, <span class="refTitle">"Block-Wise Transfers in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7959</span>, <span class="seriesInfo">DOI 10.17487/RFC7959</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7959">https://www.rfc-editor.org/info/rfc7959</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8376">[RFC8376]</dt>
        <dd>
<span class="refAuthor">Farrell, S., Ed.</span>, <span class="refTitle">"Low-Power Wide Area Network (LPWAN) Overview"</span>, <span class="seriesInfo">RFC 8376</span>, <span class="seriesInfo">DOI 10.17487/RFC8376</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8376">https://www.rfc-editor.org/info/rfc8376</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8392">[RFC8392]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Wahlstroem, E.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"CBOR Web Token (CWT)"</span>, <span class="seriesInfo">RFC 8392</span>, <span class="seriesInfo">DOI 10.17487/RFC8392</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8392">https://www.rfc-editor.org/info/rfc8392</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8610">[RFC8610]</dt>
        <dd>
<span class="refAuthor">Birkholz, H.</span>, <span class="refAuthor">Vigano, C.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"Concise Data Definition Language (CDDL): A Notational Convention to Express Concise Binary Object Representation (CBOR) and JSON Data Structures"</span>, <span class="seriesInfo">RFC 8610</span>, <span class="seriesInfo">DOI 10.17487/RFC8610</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8610">https://www.rfc-editor.org/info/rfc8610</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07" class="refDate">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8613">https://www.rfc-editor.org/info/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8724">[RFC8724]</dt>
        <dd>
<span class="refAuthor">Minaburo, A.</span>, <span class="refAuthor">Toutain, L.</span>, <span class="refAuthor">Gomez, C.</span>, <span class="refAuthor">Barthel, D.</span>, and <span class="refAuthor">JC. Zúñiga</span>, <span class="refTitle">"SCHC: Generic Framework for Static Context Header Compression and Fragmentation"</span>, <span class="seriesInfo">RFC 8724</span>, <span class="seriesInfo">DOI 10.17487/RFC8724</span>, <time datetime="2020-04" class="refDate">April 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8724">https://www.rfc-editor.org/info/rfc8724</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8742">[RFC8742]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR) Sequences"</span>, <span class="seriesInfo">RFC 8742</span>, <span class="seriesInfo">DOI 10.17487/RFC8742</span>, <time datetime="2020-02" class="refDate">February 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8742">https://www.rfc-editor.org/info/rfc8742</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8747">[RFC8747]</dt>
        <dd>
<span class="refAuthor">Jones, M.</span>, <span class="refAuthor">Seitz, L.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Erdtman, S.</span>, and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Proof-of-Possession Key Semantics for CBOR Web Tokens (CWTs)"</span>, <span class="seriesInfo">RFC 8747</span>, <span class="seriesInfo">DOI 10.17487/RFC8747</span>, <time datetime="2020-03" class="refDate">March 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8747">https://www.rfc-editor.org/info/rfc8747</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8949">[RFC8949]</dt>
      <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">STD 94</span>, <span class="seriesInfo">RFC 8949</span>, <span class="seriesInfo">DOI 10.17487/RFC8949</span>, <time datetime="2020-12" class="refDate">December 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8949">https://www.rfc-editor.org/info/rfc8949</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="Bruni18">[Bruni18]</dt>
        <dd>
<span class="refAuthor">Bruni, A.</span>, <span class="refAuthor">Sahl Jørgensen, T.</span>, <span class="refAuthor">Grønbech Petersen, T.</span>, and <span class="refAuthor">C. Schürmann</span>, <span class="refTitle">"Formal Verification of Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <time datetime="2018-11" class="refDate">November 2018</time>, <span>&lt;<a href="https://www.springerprofessional.de/en/formal-verification-of-ephemeral-diffie-hellman-over-cose-edhoc/16284348">https://www.springerprofessional.de/en/formal-verification-of-ephemeral-diffie-hellman-over-cose-edhoc/16284348</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CborMe">[CborMe]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refTitle">"CBOR Playground"</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="http://cbor.me/">http://cbor.me/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CNSA">[CNSA]</dt>
        <dd>
<span class="refAuthor">(Placeholder), .</span>, <span class="refTitle">"Commercial National Security Algorithm Suite"</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://apps.nsa.gov/iaarchive/programs/iad-initiatives/cnsa-suite.cfm">https://apps.nsa.gov/iaarchive/programs/iad-initiatives/cnsa-suite.cfm</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-edhoc">[I-D.ietf-core-oscore-edhoc]</dt>
        <dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refAuthor">Tiloca, M.</span>, <span class="refAuthor">Hoeglund, R.</span>, <span class="refAuthor">Hristozov, S.</span>, and <span class="refAuthor">G. Selander</span>, <span class="refTitle">"Combining EDHOC and OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-edhoc-01</span>, <time datetime="2021-07-12" class="refDate">12 July 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-core-oscore-edhoc-01.txt">https://www.ietf.org/archive/id/draft-ietf-core-oscore-edhoc-01.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-resource-directory">[I-D.ietf-core-resource-directory]</dt>
        <dd>
<span class="refAuthor">Amsüss, C.</span>, <span class="refAuthor">Shelby, Z.</span>, <span class="refAuthor">Koster, M.</span>, <span class="refAuthor">Bormann, C.</span>, and <span class="refAuthor">P. V. D. Stok</span>, <span class="refTitle">"CoRE Resource Directory"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-resource-directory-28</span>, <time datetime="2021-03-07" class="refDate">7 March 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-core-resource-directory-28.txt">https://www.ietf.org/archive/id/draft-ietf-core-resource-directory-28.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-cbor-encoded-cert">[I-D.ietf-cose-cbor-encoded-cert]</dt>
        <dd>
<span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Raza, S.</span>, <span class="refAuthor">Höglund, J.</span>, and <span class="refAuthor">M. Furuhed</span>, <span class="refTitle">"CBOR Encoded X.509 Certificates (C509 Certificates)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-cbor-encoded-cert-02</span>, <time datetime="2021-07-12" class="refDate">12 July 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-cose-cbor-encoded-cert-02.txt">https://www.ietf.org/archive/id/draft-ietf-cose-cbor-encoded-cert-02.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lake-reqs">[I-D.ietf-lake-reqs]</dt>
        <dd>
<span class="refAuthor">Vucinic, M.</span>, <span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J. P.</span>, and <span class="refAuthor">D. Garcia-Carrillo</span>, <span class="refTitle">"Requirements for a Lightweight AKE for OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lake-reqs-04</span>, <time datetime="2020-06-08" class="refDate">8 June 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-lake-reqs-04.txt">https://www.ietf.org/archive/id/draft-ietf-lake-reqs-04.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-lwig-security-protocol-comparison">[I-D.ietf-lwig-security-protocol-comparison]</dt>
        <dd>
<span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Palombini, F.</span>, and <span class="refAuthor">M. Vucinic</span>, <span class="refTitle">"Comparison of CoAP Security Protocols"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lwig-security-protocol-comparison-05</span>, <time datetime="2020-11-02" class="refDate">2 November 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-lwig-security-protocol-comparison-05.txt">https://www.ietf.org/archive/id/draft-ietf-lwig-security-protocol-comparison-05.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-tls-dtls13">[I-D.ietf-tls-dtls13]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Tschofenig, H.</span>, and <span class="refAuthor">N. Modadugu</span>, <span class="refTitle">"The Datagram Transport Layer Security (DTLS) Protocol Version 1.3"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-dtls13-43</span>, <time datetime="2021-04-30" class="refDate">30 April 2021</time>, <span>&lt;<a href="https://www.ietf.org/internet-drafts/draft-ietf-tls-dtls13-43.txt">https://www.ietf.org/internet-drafts/draft-ietf-tls-dtls13-43.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.mattsson-cfrg-det-sigs-with-noise">[I-D.mattsson-cfrg-det-sigs-with-noise]</dt>
        <dd>
<span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Thormarker, E.</span>, and <span class="refAuthor">S. Ruohomaa</span>, <span class="refTitle">"Deterministic ECDSA and EdDSA Signatures with Additional Randomness"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-mattsson-cfrg-det-sigs-with-noise-02</span>, <time datetime="2020-03-11" class="refDate">11 March 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-mattsson-cfrg-det-sigs-with-noise-02.txt">https://www.ietf.org/archive/id/draft-mattsson-cfrg-det-sigs-with-noise-02.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.selander-ace-ake-authz">[I-D.selander-ace-ake-authz]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Vucinic, M.</span>, <span class="refAuthor">Richardson, M.</span>, and <span class="refAuthor">A. Schellenbaum</span>, <span class="refTitle">"Lightweight Authorization for Authenticated Key Exchange."</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-selander-ace-ake-authz-03</span>, <time datetime="2021-05-04" class="refDate">4 May 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-selander-ace-ake-authz-03.txt">https://www.ietf.org/archive/id/draft-selander-ace-ake-authz-03.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.selander-lake-traces">[I-D.selander-lake-traces]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span> and <span class="refAuthor">J. P. Mattsson</span>, <span class="refTitle">"Traces of EDHOC"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-selander-lake-traces-00</span>, <time datetime="2021-09-10" class="refDate">10 September 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-selander-lake-traces-00.txt">https://www.ietf.org/archive/id/draft-selander-lake-traces-00.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Norrman20">[Norrman20]</dt>
        <dd>
<span class="refAuthor">Norrman, K.</span>, <span class="refAuthor">Sundararajan, V.</span>, and <span class="refAuthor">A. Bruni</span>, <span class="refTitle">"Formal Analysis of EDHOC Key Establishment for Constrained IoT Devices"</span>, <time datetime="2020-09" class="refDate">September 2020</time>, <span>&lt;<a href="https://arxiv.org/abs/2007.11427">https://arxiv.org/abs/2007.11427</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7228">[RFC7228]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span>, <span class="refAuthor">Ersue, M.</span>, and <span class="refAuthor">A. Keranen</span>, <span class="refTitle">"Terminology for Constrained-Node Networks"</span>, <span class="seriesInfo">RFC 7228</span>, <span class="seriesInfo">DOI 10.17487/RFC7228</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7228">https://www.rfc-editor.org/info/rfc7228</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7258">[RFC7258]</dt>
        <dd>
<span class="refAuthor">Farrell, S.</span> and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Pervasive Monitoring Is an Attack"</span>, <span class="seriesInfo">BCP 188</span>, <span class="seriesInfo">RFC 7258</span>, <span class="seriesInfo">DOI 10.17487/RFC7258</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7258">https://www.rfc-editor.org/info/rfc7258</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span>, <span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Eronen, P.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time datetime="2014-10" class="refDate">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8937">[RFC8937]</dt>
        <dd>
<span class="refAuthor">Cremers, C.</span>, <span class="refAuthor">Garratt, L.</span>, <span class="refAuthor">Smyshlyaev, S.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Randomness Improvements for Security Protocols"</span>, <span class="seriesInfo">RFC 8937</span>, <span class="seriesInfo">DOI 10.17487/RFC8937</span>, <time datetime="2020-10" class="refDate">October 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8937">https://www.rfc-editor.org/info/rfc8937</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SECG">[SECG]</dt>
        <dd>
<span class="refTitle">"Standards for Efficient Cryptography 1 (SEC 1)"</span>, <time datetime="2009-05" class="refDate">May 2009</time>, <span>&lt;<a href="https://www.secg.org/sec1-v2.pdf">https://www.secg.org/sec1-v2.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SIGMA">[SIGMA]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span>, <span class="refTitle">"SIGMA - The 'SIGn-and-MAc' Approach to Authenticated Diffie-Hellman and Its Use in the IKE-Protocols (Long version)"</span>, <time datetime="2003-06" class="refDate">June 2003</time>, <span>&lt;<a href="http://webee.technion.ac.il/~hugo/sigma-pdf.pdf">http://webee.technion.ac.il/~hugo/sigma-pdf.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SP-800-56A">[SP-800-56A]</dt>
      <dd>
<span class="refAuthor">Barker, E.</span>, <span class="refAuthor">Chen, L.</span>, <span class="refAuthor">Roginsky, A.</span>, <span class="refAuthor">Vassilev, A.</span>, and <span class="refAuthor">R. Davis</span>, <span class="refTitle">"Recommendation for Pair-Wise Key-Establishment Schemes Using Discrete Logarithm Cryptography"</span>, <span class="seriesInfo">NIST Special Publication 800-56A Revision 3</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://doi.org/10.6028/NIST.SP.800-56Ar3">https://doi.org/10.6028/NIST.SP.800-56Ar3</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="transfer">
<section id="appendix-A">
      <h2 id="name-use-with-oscore-and-transfe">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-use-with-oscore-and-transfe" class="section-name selfRef">Use with OSCORE and Transfer over CoAP</a>
      </h2>
<p id="appendix-A-1">This appendix describes how to select EDHOC connection identifiers and derive an OSCORE security context when OSCORE is used with EDHOC, and how to transfer EDHOC messages over CoAP.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<div id="edhoc-to-oscore">
<section id="appendix-A.1">
        <h3 id="name-selecting-edhoc-connection-">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-selecting-edhoc-connection-" class="section-name selfRef">Selecting EDHOC Connection Identifier</a>
        </h3>
<p id="appendix-A.1-1">This section specifies a rule for converting from EDHOC connection identifier to OSCORE Sender/Recipient ID. (An identifier is Sender ID or Recipient ID depending on from which endpoint is the point of view, see Section 3.1 of <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>.)<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.1-2.1">If the EDHOC connection identifier is numeric, i.e., encoded as a CBOR integer on the wire, it is converted to a (naturally byte-string shaped) OSCORE Sender/Recipient ID equal to its CBOR encoded form.<a href="#appendix-A.1-2.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="appendix-A.1-3">For example, a numeric C_R equal to 10 (0x0A in CBOR encoding) is converted to a (typically client) Sender ID equal to 0x0A, while a numeric C_I equal to -12 (0x2B in CBOR encoding) is converted to a (typically client) Sender ID equal to 0x2B.<a href="#appendix-A.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.1-4.1">If the EDHOC connection identifier is byte-valued, hence encoded as a CBOR byte string on the wire, it is converted to an OSCORE Sender/Recipient ID equal to the byte string.<a href="#appendix-A.1-4.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="appendix-A.1-5">For example, a byte-string valued C_R equal to 0xFF (0x41FF in CBOR encoding) is converted to a (typically client) Sender ID equal to 0xFF.<a href="#appendix-A.1-5" class="pilcrow">¶</a></p>
<p id="appendix-A.1-6">Two EDHOC connection identifiers are called "equivalent" if and only if, by applying the conversion above, they both result in the same OSCORE Sender/Recipient ID. For example, the two EDHOC connection identifiers with CBOR encoding 0x0A (numeric) and 0x410A (byte-valued) are equivalent since they both result in the same OSCORE Sender/Recipient ID 0x0A.<a href="#appendix-A.1-6" class="pilcrow">¶</a></p>
<p id="appendix-A.1-7">When EDHOC is used to establish an OSCORE security context, the connection identifiers C_I and C_R MUST NOT be equivalent. Furthermore, in case of multiple OSCORE security contexts with potentially different endpoints, to facilitate retrieval of the correct OSCORE security context, an endpoint SHOULD select an EDHOC connection identifier that when converted to OSCORE Recipient ID does not coincide with its other Recipient IDs.<a href="#appendix-A.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="oscore-ctx-derivation">
<section id="appendix-A.2">
        <h3 id="name-deriving-the-oscore-securit">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-deriving-the-oscore-securit" class="section-name selfRef">Deriving the OSCORE Security Context</a>
        </h3>
<p id="appendix-A.2-1">This section specifies how to use EDHOC output to derive the OSCORE security context.<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<p id="appendix-A.2-2">After successful processing of EDHOC message_3, Client and Server derive Security Context parameters for OSCORE as follows (see Section 3.2 of <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>):<a href="#appendix-A.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-3.1">The Master Secret and Master Salt are derived by using the EDHOC-Exporter interface, see <a href="#exporter" class="xref">Section 4.3</a>.<a href="#appendix-A.2-3.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="appendix-A.2-4">The EDHOC Exporter Labels for deriving the OSCORE Master Secret and the OSCORE Master Salt, are "OSCORE_Master_Secret" and "OSCORE_Master_Salt", respectively.<a href="#appendix-A.2-4" class="pilcrow">¶</a></p>
<p id="appendix-A.2-5">The context parameter is h'' (0x40), the empty CBOR byte string.<a href="#appendix-A.2-5" class="pilcrow">¶</a></p>
<p id="appendix-A.2-6">By default, key_length is the key length (in bytes) of the application AEAD Algorithm of the selected cipher suite for the EDHOC session. Also by default, salt_length has value 8. The Initiator and Responder MAY agree out-of-band on a longer key_length than the default and on a different salt_length.<a href="#appendix-A.2-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-A.2-7">
<pre>
Master Secret = EDHOC-Exporter("OSCORE_Master_Secret", h'', key_length)
Master Salt   = EDHOC-Exporter("OSCORE_Master_Salt", h'', salt_length)
</pre><a href="#appendix-A.2-7" class="pilcrow">¶</a>
</div>
<ul class="normal">
<li class="normal" id="appendix-A.2-8.1">The AEAD Algorithm is the application AEAD algorithm of the selected cipher suite for the EDHOC session.<a href="#appendix-A.2-8.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="appendix-A.2-8.2">The HKDF Algorithm is the one based on the application hash algorithm of the selected cipher suite for the EDHOC session. For example, if SHA-256 is the application hash algorithm of the selected cipher suite, HKDF SHA-256 is used as HKDF Algorithm in the OSCORE Security Context.<a href="#appendix-A.2-8.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="appendix-A.2-8.3">In case the Client is Initiator and the Server is Responder, the Client's OSCORE Sender ID and the Server's OSCORE Sender ID are determined from the EDHOC connection identifiers C_R and C_I for the EDHOC session, respectively, by applying the conversion in <a href="#edhoc-to-oscore" class="xref">Appendix A.1</a>. The reverse applies in case the Client is the Responder and the Server is the Initiator.<a href="#appendix-A.2-8.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="appendix-A.2-9">Client and Server use the parameters above to establish an OSCORE Security Context, as per Section 3.2.1 of <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>.<a href="#appendix-A.2-9" class="pilcrow">¶</a></p>
<p id="appendix-A.2-10">From then on, Client and Server retrieve the OSCORE protocol state using the Recipient ID, and optionally other transport information such as the 5-tuple.<a href="#appendix-A.2-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="coap">
<section id="appendix-A.3">
        <h3 id="name-transferring-edhoc-over-coa">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-transferring-edhoc-over-coa" class="section-name selfRef">Transferring EDHOC over CoAP</a>
        </h3>
<p id="appendix-A.3-1">This section specifies one instance for how EDHOC can be transferred as an exchange of CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> messages. CoAP provides a reliable transport that can preserve packet ordering and handle message duplication. CoAP can also perform fragmentation and protect against denial-of-service attacks. The underlying CoAP transport should be used in reliable mode, in particular when fragmentation is used, to avoid, e.g.,  situations with hanging endpoints waiting for each other.<a href="#appendix-A.3-1" class="pilcrow">¶</a></p>
<p id="appendix-A.3-2">By default, the CoAP client is the Initiator and the CoAP server is the Responder, but the roles SHOULD be chosen to protect the most sensitive identity, see <a href="#security" class="xref">Section 8</a>. According to this specification, EDHOC is transferred in POST requests and 2.04 (Changed) responses to the Uri-Path: "/.well-known/edhoc". An application may define its own path that can be discovered, e.g., using resource directory <span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span>.<a href="#appendix-A.3-2" class="pilcrow">¶</a></p>
<p id="appendix-A.3-3">By default, the message flow is as follows: EDHOC message_1 is sent in the payload of a POST request from the client to the server's resource for EDHOC. EDHOC message_2 or the EDHOC error message is sent from the server to the client in the payload of a 2.04 (Changed) response. EDHOC message_3 or the EDHOC error message is sent from the client to the server's resource in the payload of a POST request. If needed, an EDHOC error message is sent from the server to the client in the payload of a 2.04 (Changed) response. Alternatively, if EDHOC message_4 is used, it is sent from the server to the client in the payload of a 2.04 (Changed) response analogously to message_2.<a href="#appendix-A.3-3" class="pilcrow">¶</a></p>
<p id="appendix-A.3-4">In order to correlate a message received from a client to a message previously sent by the server, messages sent by the client are prepended with the CBOR serialization of the connection identifier which the server has chosen. This applies independently of if the CoAP server is Responder or Initiator. For the default case when the server is Responder, the prepended connection identifier is C_R, and C_I if the server is Initiator. If message_1 is sent to the server, the CBOR simple value "true" (0xf5) is sent in its place (given that the server has not selected C_R yet).<a href="#appendix-A.3-4" class="pilcrow">¶</a></p>
<p id="appendix-A.3-5">These identifiers are encoded in CBOR and thus self-delimiting.
They are sent in front of the actual EDHOC message,
and only the part of the body following the identifier is used for EDHOC processing.<a href="#appendix-A.3-5" class="pilcrow">¶</a></p>
<p id="appendix-A.3-6">Consequently, the application/edhoc media type does not apply to these messages;
their media type is unnamed.<a href="#appendix-A.3-6" class="pilcrow">¶</a></p>
<p id="appendix-A.3-7">An example of a successful EDHOC exchange using CoAP is shown in <a href="#fig-coap1" class="xref">Figure 10</a>. In this case the CoAP Token enables correlation on the Initiator side, and the prepended C_R enables correlation on the Responder (server) side.<a href="#appendix-A.3-7" class="pilcrow">¶</a></p>
<span id="name-transferring-edhoc-in-coap-"></span><div id="fig-coap1">
<figure id="figure-10">
          <div class="artwork art-text alignCenter" id="appendix-A.3-8.1">
<pre>
Client    Server
  |          |
  +---------&gt;| Header: POST (Code=0.02)
  |   POST   | Uri-Path: "/.well-known/edhoc"
  |          | Payload: true, EDHOC message_1
  |          |
  |&lt;---------+ Header: 2.04 Changed
  |   2.04   | Content-Format: application/edhoc
  |          | Payload: EDHOC message_2
  |          |
  +---------&gt;| Header: POST (Code=0.02)
  |   POST   | Uri-Path: "/.well-known/edhoc"
  |          | Payload: C_R, EDHOC message_3
  |          |
  |&lt;---------+ Header: 2.04 Changed
  |   2.04   |
  |          |
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-transferring-edhoc-in-coap-" class="selfRef">Transferring EDHOC in CoAP when the Initiator is CoAP Client</a>
          </figcaption></figure>
</div>
<p id="appendix-A.3-9">The exchange in <a href="#fig-coap1" class="xref">Figure 10</a> protects the client identity against active attackers and the server identity against passive attackers.<a href="#appendix-A.3-9" class="pilcrow">¶</a></p>
<p id="appendix-A.3-10">An alternative exchange that protects the server identity against active attackers and the client identity against passive attackers is shown in <a href="#fig-coap2" class="xref">Figure 11</a>. In this case the CoAP Token enables the Responder to correlate message_2 and message_3, and the prepended C_I enables correlation on the Initiator (server) side. If EDHOC message_4 is used, C_I is prepended, and it is transported with CoAP in the payload of a POST request with a 2.04 (Changed) response.<a href="#appendix-A.3-10" class="pilcrow">¶</a></p>
<span id="name-transferring-edhoc-in-coap-w"></span><div id="fig-coap2">
<figure id="figure-11">
          <div class="artwork art-text alignCenter" id="appendix-A.3-11.1">
<pre>
Client    Server
  |          |
  +---------&gt;| Header: POST (Code=0.02)
  |   POST   | Uri-Path: "/.well-known/edhoc"
  |          |
  |&lt;---------+ Header: 2.04 Changed
  |   2.04   | Content-Format: application/edhoc
  |          | Payload: EDHOC message_1
  |          |
  +---------&gt;| Header: POST (Code=0.02)
  |   POST   | Uri-Path: "/.well-known/edhoc"
  |          | Payload: C_I, EDHOC message_2
  |          |
  |&lt;---------+ Header: 2.04 Changed
  |   2.04   | Content-Format: application/edhoc
  |          | Payload: EDHOC message_3
  |          |
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-transferring-edhoc-in-coap-w" class="selfRef">Transferring EDHOC in CoAP when the Initiator is CoAP Server</a>
          </figcaption></figure>
</div>
<p id="appendix-A.3-12">To protect against denial-of-service attacks, the CoAP server MAY respond to the first POST request with a 4.01 (Unauthorized) containing an Echo option <span>[<a href="#I-D.ietf-core-echo-request-tag" class="xref">I-D.ietf-core-echo-request-tag</a>]</span>. This forces the initiator to demonstrate its reachability at its apparent network address. If message fragmentation is needed, the EDHOC messages may be fragmented using the CoAP Block-Wise Transfer mechanism <span>[<a href="#RFC7959" class="xref">RFC7959</a>]</span>.<a href="#appendix-A.3-12" class="pilcrow">¶</a></p>
<p id="appendix-A.3-13">EDHOC does not restrict how error messages are transported with CoAP, as long as the appropriate error message can to be transported in response to a message that failed (see <a href="#error" class="xref">Section 6</a>). EDHOC error messages transported with CoAP are carried in the payload.<a href="#appendix-A.3-13" class="pilcrow">¶</a></p>
<div id="transferring-edhoc-and-oscore-over-coap">
<section id="appendix-A.3.1">
          <h4 id="name-transferring-edhoc-and-osco">
<a href="#appendix-A.3.1" class="section-number selfRef">A.3.1. </a><a href="#name-transferring-edhoc-and-osco" class="section-name selfRef">Transferring EDHOC and OSCORE over CoAP</a>
          </h4>
<p id="appendix-A.3.1-1">When using EDHOC over CoAP for establishing an OSCORE Security Context, EDHOC error messages sent as CoAP responses MUST be sent in the payload of error responses, i.e., they MUST specify a CoAP error response code. In particular, it is RECOMMENDED that such error responses have response code either 4.00 (Bad Request) in case of client error (e.g., due to a malformed EDHOC message), or 5.00 (Internal Server Error) in case of server error (e.g., due to failure in deriving EDHOC key material). The Content-Format of the error response MUST be set to application/edhoc.<a href="#appendix-A.3.1-1" class="pilcrow">¶</a></p>
<p id="appendix-A.3.1-2">A method for combining EDHOC and OSCORE protocols in two round-trips is specified in <span>[<a href="#I-D.ietf-core-oscore-edhoc" class="xref">I-D.ietf-core-oscore-edhoc</a>]</span>.<a href="#appendix-A.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="comrep">
<section id="appendix-B">
      <h2 id="name-compact-representation">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-compact-representation" class="section-name selfRef">Compact Representation</a>
      </h2>
<p id="appendix-B-1">As described in Section 4.2 of <span>[<a href="#RFC6090" class="xref">RFC6090</a>]</span> the x-coordinate of an elliptic curve public key is a suitable representative for the entire point whenever scalar multiplication is used as a one-way function. One example is ECDH with compact output, where only the x-coordinate of the computed value is used as the shared secret.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">This section defines a format for compact representation based on the Elliptic-Curve-Point-to-Octet-String Conversion defined in Section 2.3.3 of <span>[<a href="#SECG" class="xref">SECG</a>]</span>. Using the notation from <span>[<a href="#SECG" class="xref">SECG</a>]</span>, the output is an octet string of length ceil( (log2 q) / 8 ). See <span>[<a href="#SECG" class="xref">SECG</a>]</span> for a definition of q, M, X, xp, and ~yp. The steps in Section 2.3.3 of <span>[<a href="#SECG" class="xref">SECG</a>]</span> are replaced by:<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-B-3">
<li id="appendix-B-3.1">Convert the field element xp to an octet string X of length ceil( (log2 q) / 8 ) octets using the conversion routine specified in Section 2.3.5 of <span>[<a href="#SECG" class="xref">SECG</a>]</span>.<a href="#appendix-B-3.1" class="pilcrow">¶</a>
</li>
        <li id="appendix-B-3.2">Output M = X<a href="#appendix-B-3.2" class="pilcrow">¶</a>
</li>
      </ol>
<p id="appendix-B-4">The encoding of the point at infinity is not supported. Compact representation does not change any requirements on validation. If a y-coordinate is required for validation or compatibily with APIs the value ~yp SHALL be set to zero. For such use, the compact representation can be transformed into the SECG point compressed format by prepending it with the single byte 0x02 (i.e., M = 0x02 || X).<a href="#appendix-B-4" class="pilcrow">¶</a></p>
<p id="appendix-B-5">Using compact representation have some security benefits. An implementation does not need to check that the point is not the point at infinity (the identity element). Similarly, as not even the sign of the y-coordinate is encoded, compact representation trivially avoids so called "benign malleability" attacks where an attacker changes the sign, see <span>[<a href="#SECG" class="xref">SECG</a>]</span>.<a href="#appendix-B-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="CBORandCOSE">
<section id="appendix-C">
      <h2 id="name-use-of-cbor-cddl-and-cose-i">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-use-of-cbor-cddl-and-cose-i" class="section-name selfRef">Use of CBOR, CDDL and COSE in EDHOC</a>
      </h2>
<p id="appendix-C-1">This Appendix is intended to simplify for implementors not familiar with CBOR <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span>, CDDL <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span>, COSE <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>, and HKDF <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<div id="CBOR">
<section id="appendix-C.1">
        <h3 id="name-cbor-and-cddl">
<a href="#appendix-C.1" class="section-number selfRef">C.1. </a><a href="#name-cbor-and-cddl" class="section-name selfRef">CBOR and CDDL</a>
        </h3>
<p id="appendix-C.1-1">The Concise Binary Object Representation (CBOR) <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span> is a data format designed for small code size and small message size. CBOR builds on the JSON data model but extends it by e.g., encoding binary data directly without base64 conversion. In addition to the binary CBOR encoding, CBOR also has a diagnostic notation that is readable and editable by humans. The Concise Data Definition Language (CDDL) <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span> provides a way to express structures for protocol messages and APIs that use CBOR. <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span> also extends the diagnostic notation.<a href="#appendix-C.1-1" class="pilcrow">¶</a></p>
<p id="appendix-C.1-2">CBOR data items are encoded to or decoded from byte strings using a type-length-value encoding scheme, where the three highest order bits of the initial byte contain information about the major type. CBOR supports several different types of data items, in addition to integers (int, uint), simple values, byte strings (bstr), and text strings (tstr), CBOR also supports arrays []  of data items, maps {} of pairs of data items, and sequences <span>[<a href="#RFC8742" class="xref">RFC8742</a>]</span> of data items. Some examples are given below.<a href="#appendix-C.1-2" class="pilcrow">¶</a></p>
<p id="appendix-C.1-3">The EDHOC specification sometimes use CDDL names in CBOR dignostic notation as in e.g., &lt;&lt; ID_CRED_R, ? EAD_2 &gt;&gt;. This means that EAD_2 is optional and that ID_CRED_R and EAD_2 should be substituted with their values before evaluation. I.e., if ID_CRED_R = { 4 : h'' } and EAD_2 is omitted then &lt;&lt; ID_CRED_R, ? EAD_2 &gt;&gt; = &lt;&lt; { 4 : h'' } &gt;&gt;, which encodes to 0x43a10440.<a href="#appendix-C.1-3" class="pilcrow">¶</a></p>
<p id="appendix-C.1-4">For a complete specification and more examples, see <span>[<a href="#RFC8949" class="xref">RFC8949</a>]</span> and <span>[<a href="#RFC8610" class="xref">RFC8610</a>]</span>. We recommend implementors to get used to CBOR by using the CBOR playground <span>[<a href="#CborMe" class="xref">CborMe</a>]</span>.<a href="#appendix-C.1-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignCenter" id="appendix-C.1-5">
<pre>
Diagnostic          Encoded              Type
------------------------------------------------------------------
1                   0x01                 unsigned integer
24                  0x1818               unsigned integer
-24                 0x37                 negative integer
-25                 0x3818               negative integer
true                0xf5                 simple value
h''                 0x40                 byte string
h'12cd'             0x4212cd             byte string
'12cd'              0x4431326364         byte string
"12cd"              0x6431326364         text string
{ 4 : h'cd' }       0xa10441cd           map
&lt;&lt; 1, 2, true &gt;&gt;    0x430102f5           byte string
[ 1, 2, true ]      0x830102f5           array
( 1, 2, true )      0x0102f5             sequence
1, 2, true          0x0102f5             sequence
------------------------------------------------------------------
</pre><a href="#appendix-C.1-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="cddl-definitions">
<section id="appendix-C.2">
        <h3 id="name-cddl-definitions">
<a href="#appendix-C.2" class="section-number selfRef">C.2. </a><a href="#name-cddl-definitions" class="section-name selfRef">CDDL Definitions</a>
        </h3>
<p id="appendix-C.2-1">This sections compiles the CDDL definitions for ease of reference.<a href="#appendix-C.2-1" class="pilcrow">¶</a></p>
<div id="appendix-C.2-2">
<pre class="sourcecode lang-CDDL">
suites = [ 2* int ] / int

ead = 1* (
  ead_label : int,
  ead_value : any,
)

message_1 = (
  METHOD : int,
  SUITES_I : suites,
  G_X : bstr,
  C_I : bstr / int,
  ? EAD_1 : ead,
)

message_2 = (
  G_Y_CIPHERTEXT_2 : bstr,
  C_R : bstr / int,
)

message_3 = (
  CIPHERTEXT_3 : bstr,
)

message_4 = (
  CIPHERTEXT_4 : bstr,
)

error = (
  ERR_CODE : int,
  ERR_INFO : any,
)

info = (
  transcript_hash : bstr,
  label : tstr,
  context : bstr,
  length : uint,
)
</pre><a href="#appendix-C.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="COSE">
<section id="appendix-C.3">
        <h3 id="name-cose">
<a href="#appendix-C.3" class="section-number selfRef">C.3. </a><a href="#name-cose" class="section-name selfRef">COSE</a>
        </h3>
<p id="appendix-C.3-1">CBOR Object Signing and Encryption (COSE) <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span> describes how to create and process signatures, message authentication codes, and encryption using CBOR. COSE builds on JOSE, but is adapted to allow more efficient processing in constrained devices. EDHOC makes use of COSE_Key, COSE_Encrypt0, and COSE_Sign1 objects in the message processing:<a href="#appendix-C.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.3-2.1">ECDH ephemeral public keys of type EC2 or OKP in message_1 and message_2 consist of the COSE_Key parameter named 'x', see Section 7.1 and 7.2 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-algs" class="xref">I-D.ietf-cose-rfc8152bis-algs</a>]</span><a href="#appendix-C.3-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="appendix-C.3-2.2">Certain ciphertexts in message_2 and message_3 consist of a subset of the single recipient encrypted data object COSE_Encrypt0, which is described in Sections 5.2-5.3 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>. The ciphertext is computed over the plaintext and associated data,  using an encryption key and a nonce. The associated data is an Enc_structure consisting of protected headers and externally supplied data (external_aad).<a href="#appendix-C.3-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="appendix-C.3-2.3">Signatures in message_2 of method 0 and 2, and in message_3 of method 0 and 1, consist of a subset of the single signer data object COSE_Sign1, which is described in Sections 4.2-4.4 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>. The signature is computed over a Sig_structure containing payload, protected headers and externally supplied data (external_aad) using a private signature key and verified using the corresponding public signature key.<a href="#appendix-C.3-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="appendix-C.3-3">Different header parameters to identify X.509 or C509 certificates by reference are defined in <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span> and <span>[<a href="#I-D.ietf-cose-cbor-encoded-cert" class="xref">I-D.ietf-cose-cbor-encoded-cert</a>]</span>:<a href="#appendix-C.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.3-4.1">
            <p id="appendix-C.3-4.1.1">by a hash value with the 'x5t' or 'c5t' parameters, respectively:<a href="#appendix-C.3-4.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.3-4.1.2.1">ID_CRED_x = { 34 : COSE_CertHash }, for x = I or R,<a href="#appendix-C.3-4.1.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="appendix-C.3-4.1.2.2">ID_CRED_x = { TBD3 : COSE_CertHash }, for x = I or R;<a href="#appendix-C.3-4.1.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="normal" id="appendix-C.3-4.2">
            <p id="appendix-C.3-4.2.1">or by a URI with the 'x5u' or 'c5u' parameters, respectively:<a href="#appendix-C.3-4.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.3-4.2.2.1">ID_CRED_x = { 35 : uri }, for x = I or R,<a href="#appendix-C.3-4.2.2.1" class="pilcrow">¶</a>
</li>
              <li class="normal" id="appendix-C.3-4.2.2.2">ID_CRED_x = { TBD4 : uri }, for x = I or R.<a href="#appendix-C.3-4.2.2.2" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="appendix-C.3-5">When ID_CRED_x does not contain the actual credential, it may be very short, e.g., if the endpoints have agreed to use a key identifier parameter 'kid':<a href="#appendix-C.3-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-C.3-6.1">ID_CRED_x = { 4 : key_id_x }, where key_id_x : kid, for x = I or R.<a href="#appendix-C.3-6.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="appendix-C.3-7">Note that a COSE header map can contain several header parameters, for example { x5u, x5t } or { kid, kid_context }.<a href="#appendix-C.3-7" class="pilcrow">¶</a></p>
<p id="appendix-C.3-8">ID_CRED_x MAY also identify the authentication credential by value. For example, a certificate chain can be transported in ID_CRED_x with COSE header parameter c5c or x5chain, defined in <span>[<a href="#I-D.ietf-cose-cbor-encoded-cert" class="xref">I-D.ietf-cose-cbor-encoded-cert</a>]</span> and <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span> and credentials of type CWT and CCS can be transported with the COSE header parameters registered in <a href="#cwt-header-param" class="xref">Section 9.6</a>.<a href="#appendix-C.3-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="appl-temp">
<section id="appendix-D">
      <h2 id="name-applicability-template">
<a href="#appendix-D" class="section-number selfRef">Appendix D. </a><a href="#name-applicability-template" class="section-name selfRef">Applicability Template</a>
      </h2>
<p id="appendix-D-1">This appendix contains a rudimentary example of an applicability statement, see <a href="#applicability" class="xref">Section 3.9</a>.<a href="#appendix-D-1" class="pilcrow">¶</a></p>
<p id="appendix-D-2">For use of EDHOC in the XX protocol, the following assumptions are made:<a href="#appendix-D-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="appendix-D-3">
<li id="appendix-D-3.1">Transfer in CoAP as specified in <a href="#coap" class="xref">Appendix A.3</a> with requests expected by the CoAP server (= Responder) at /app1-edh, no Content-Format needed.<a href="#appendix-D-3.1" class="pilcrow">¶</a>
</li>
        <li id="appendix-D-3.2">METHOD = 1 (I uses signature key, R uses static DH key.)<a href="#appendix-D-3.2" class="pilcrow">¶</a>
</li>
        <li id="appendix-D-3.3">
          <p id="appendix-D-3.3.1">CRED_I is an IEEE 802.1AR IDevID encoded as a C509 certificate of type 0 <span>[<a href="#I-D.ietf-cose-cbor-encoded-cert" class="xref">I-D.ietf-cose-cbor-encoded-cert</a>]</span>.<a href="#appendix-D-3.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-D-3.3.2.1">R acquires CRED_I out-of-band, indicated in EAD_1.<a href="#appendix-D-3.3.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-D-3.3.2.2">ID_CRED_I = {4: h''} is a 'kid' with value empty CBOR byte string.<a href="#appendix-D-3.3.2.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li id="appendix-D-3.4">
          <p id="appendix-D-3.4.1">CRED_R is a CCS of type OKP as specified in <a href="#auth-cred" class="xref">Section 3.5.3</a>.<a href="#appendix-D-3.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-D-3.4.2.1">The CBOR map has parameters 1 (kty), -1 (crv), and -2 (x-coordinate).<a href="#appendix-D-3.4.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-D-3.4.2.2">ID_CRED_R is {TBD2 : CCS}.   Editor's note: TBD2 is the COSE header parameter value of 'kccs', see <a href="#cwt-header-param" class="xref">Section 9.6</a><a href="#appendix-D-3.4.2.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li id="appendix-D-3.5">External authorization data is defined and processed as specified in <span>[<a href="#I-D.selander-ace-ake-authz" class="xref">I-D.selander-ace-ake-authz</a>]</span>.<a href="#appendix-D-3.5" class="pilcrow">¶</a>
</li>
        <li id="appendix-D-3.6">EUI-64 used as identity of endpoint.<a href="#appendix-D-3.6" class="pilcrow">¶</a>
</li>
        <li id="appendix-D-3.7">No use of message_4: the application sends protected messages from R to I.<a href="#appendix-D-3.7" class="pilcrow">¶</a>
</li>
      </ol>
</section>
</div>
<div id="duplication">
<section id="appendix-E">
      <h2 id="name-edhoc-message-deduplication">
<a href="#appendix-E" class="section-number selfRef">Appendix E. </a><a href="#name-edhoc-message-deduplication" class="section-name selfRef">EDHOC Message Deduplication</a>
      </h2>
<p id="appendix-E-1">EDHOC by default assumes that message duplication is handled by the transport, in this section exemplified with CoAP.<a href="#appendix-E-1" class="pilcrow">¶</a></p>
<p id="appendix-E-2">Deduplication of CoAP messages is described in Section 4.5 of <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>. This handles the case when the same Confirmable (CON) message is received multiple times due to missing acknowledgement on CoAP messaging layer. The recommended processing in <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> is that the duplicate message is acknowledged (ACK), but the received message is only processed once by the CoAP stack.<a href="#appendix-E-2" class="pilcrow">¶</a></p>
<p id="appendix-E-3">Message deduplication is resource demanding and therefore not supported in all CoAP implementations. Since EDHOC is targeting constrained environments, it is desirable that EDHOC can optionally support transport layers which does not handle message duplication. Special care is needed to avoid issues with duplicate messages, see <a href="#proc-outline" class="xref">Section 5.1</a>.<a href="#appendix-E-3" class="pilcrow">¶</a></p>
<p id="appendix-E-4">The guiding principle here is similar to the deduplication processing on CoAP messaging layer: a received duplicate EDHOC message SHALL NOT result in a response consisting of another instance of the next EDHOC message. The result MAY be that a duplicate EDHOC response is sent, provided it is still relevant with respect the current protocol state. In any case, the received message MUST NOT be processed more than once in the same EDHOC session. This is called "EDHOC message deduplication".<a href="#appendix-E-4" class="pilcrow">¶</a></p>
<p id="appendix-E-5">An EDHOC implementation MAY store the previously sent EDHOC message to be able to resend it. An EDHOC implementation MAY keep the protocol state to be able to recreate the previously sent EDHOC message and resend it. The previous message or protocol state MUST NOT be kept longer than what is required for retransmission, for example, in the case of CoAP transport, no longer than the EXCHANGE_LIFETIME (see Section 4.8.2 of <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>).<a href="#appendix-E-5" class="pilcrow">¶</a></p>
<p id="appendix-E-6">Note that the requirements in <a href="#proc-outline" class="xref">Section 5.1</a> still apply because duplicate messages are not processed by the EDHOC state machine:<a href="#appendix-E-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-E-7.1">EDHOC messages SHALL be processed according to the current protocol state.<a href="#appendix-E-7.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-E-7.2">Different instances of the same message MUST NOT be processed in one session.<a href="#appendix-E-7.2" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="transports-not-natively-providing-correlation">
<section id="appendix-F">
      <h2 id="name-transports-not-natively-pro">
<a href="#appendix-F" class="section-number selfRef">Appendix F. </a><a href="#name-transports-not-natively-pro" class="section-name selfRef">Transports Not Natively Providing Correlation</a>
      </h2>
<p id="appendix-F-1">Protocols that do not natively provide full correlation between a series of messages can send the C_I and C_R identifiers along as needed.<a href="#appendix-F-1" class="pilcrow">¶</a></p>
<p id="appendix-F-2">The transport over CoAP (<a href="#coap" class="xref">Appendix A.3</a>) can serve as a blueprint for other server-client protocols:
The client prepends the C_x which the server selected (or, for message 1, the CBOR simple value 'true' which is not a valid C_x) to any request message it sends.
The server does not send any such indicator, as responses are matched to request by the client-server protocol design.<a href="#appendix-F-2" class="pilcrow">¶</a></p>
<p id="appendix-F-3">Protocols that do not provide any correlation at all can prescribe prepending of the peer's chosen C_x to all messages.<a href="#appendix-F-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="change-log">
<section id="appendix-G">
      <h2 id="name-change-log">
<a href="#appendix-G" class="section-number selfRef">Appendix G. </a><a href="#name-change-log" class="section-name selfRef">Change Log</a>
      </h2>
<p id="appendix-G-1">RFC Editor: Please remove this appendix.<a href="#appendix-G-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.1">
          <p id="appendix-G-2.1.1">From -10 to -11:<a href="#appendix-G-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.1.2.1">Restructured section on authentication parameters<a href="#appendix-G-2.1.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.1.2.2">Changed UCCS to CCS<a href="#appendix-G-2.1.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.1.2.3">Changed names and description of COSE header parameters for CWT/CCS<a href="#appendix-G-2.1.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.1.2.4">Changed several of the KDF and Exporter labels<a href="#appendix-G-2.1.2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.1.2.5">Removed edhoc_aead_id from info (already in transcript_hash)<a href="#appendix-G-2.1.2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.1.2.6">Added MTI section<a href="#appendix-G-2.1.2.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.1.2.7">EAD: changed CDDL names and added value type to registry<a href="#appendix-G-2.1.2.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.1.2.8">Updated Figures 1, 2, and 3<a href="#appendix-G-2.1.2.8" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.1.2.9">Some correction and clarifications<a href="#appendix-G-2.1.2.9" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.1.2.10">Added core.edhoc to CoRE Resource Type registry<a href="#appendix-G-2.1.2.10" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="appendix-G-2.2">
          <p id="appendix-G-2.2.1">From -09 to -10:<a href="#appendix-G-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.2.2.1">SUITES_I simplified to only contain the selected and more preferred suites<a href="#appendix-G-2.2.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.2.2.2">Info is a CBOR sequence and context is a bstr<a href="#appendix-G-2.2.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.2.2.3">Added kid to UCCS example<a href="#appendix-G-2.2.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.2.2.4">Separate header parameters for CWT and UCCS<a href="#appendix-G-2.2.2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.2.2.5">CWT Confirmation Method kid extended to bstr / int<a href="#appendix-G-2.2.2.5" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="appendix-G-2.3">
          <p id="appendix-G-2.3.1">From -08 to -09:<a href="#appendix-G-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.3.2.1">G_Y and CIPHERTEXT_2 are now included in one CBOR bstr<a href="#appendix-G-2.3.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.2">MAC_2 and MAC_3 are now generated with EDHOC-KDF<a href="#appendix-G-2.3.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.3">Info field "context" is now general and explicit in EDHOC-KDF<a href="#appendix-G-2.3.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.4">Restructured Section 4, Key Derivation<a href="#appendix-G-2.3.2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.5">Added EDHOC MAC length to cipher suite for use with static DH<a href="#appendix-G-2.3.2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.6">More details on the use of CWT and UCCS<a href="#appendix-G-2.3.2.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.7">Restructured and clarified Section 3.5, Authentication Parameters<a href="#appendix-G-2.3.2.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.8">Replaced 'kid2' with extension of 'kid'<a href="#appendix-G-2.3.2.8" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.9">EAD encoding now supports multiple ead types in one message<a href="#appendix-G-2.3.2.9" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.10">Clarified EAD type<a href="#appendix-G-2.3.2.10" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.11">Updated message sizes<a href="#appendix-G-2.3.2.11" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.12">Replaced "perfect forward secrecy" with "forward secrecy"<a href="#appendix-G-2.3.2.12" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.13">Updated security considerations<a href="#appendix-G-2.3.2.13" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.14">Replaced prepended 'null' with 'true' in the CoAP transport of message_1<a href="#appendix-G-2.3.2.14" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.15">Updated CDDL definitions<a href="#appendix-G-2.3.2.15" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.3.2.16">Expanded on the use of COSE<a href="#appendix-G-2.3.2.16" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="appendix-G-2.4">
          <p id="appendix-G-2.4.1">From -07 to -08:<a href="#appendix-G-2.4.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.4.2.1">Prepended C_x moved from the EDHOC protocol itself to the transport mapping<a href="#appendix-G-2.4.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.4.2.2">METHOD_CORR renamed to METHOD, corr removed<a href="#appendix-G-2.4.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.4.2.3">Removed bstr_identifier and use bstr / int instead; C_x can now be int without any implied bstr semantics<a href="#appendix-G-2.4.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.4.2.4">Defined COSE header parameter 'kid2' with value type bstr / int for use with ID_CRED_x<a href="#appendix-G-2.4.2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.4.2.5">Updated message sizes<a href="#appendix-G-2.4.2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.4.2.6">New cipher suites with AES-GCM and ChaCha20 / Poly1305<a href="#appendix-G-2.4.2.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.4.2.7">Changed from one- to two-byte identifier of CNSA compliant suite<a href="#appendix-G-2.4.2.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.4.2.8">Separate sections on transport and connection id with further sub-structure<a href="#appendix-G-2.4.2.8" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.4.2.9">Moved back key derivation for OSCORE from draft-ietf-core-oscore-edhoc<a href="#appendix-G-2.4.2.9" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.4.2.10">OSCORE and CoAP specific processing moved to new appendix<a href="#appendix-G-2.4.2.10" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.4.2.11">Message 4 section moved to message processing section<a href="#appendix-G-2.4.2.11" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="appendix-G-2.5">
          <p id="appendix-G-2.5.1">From -06 to -07:<a href="#appendix-G-2.5.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.5.2.1">Changed transcript hash definition for TH_2 and TH_3<a href="#appendix-G-2.5.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.2">Removed "EDHOC signature algorithm curve" from cipher suite<a href="#appendix-G-2.5.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.3">New IANA registry "EDHOC Exporter Label"<a href="#appendix-G-2.5.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.4">New application defined parameter "context" in EDHOC-Exporter<a href="#appendix-G-2.5.2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.5">Changed normative language for failure from MUST to SHOULD send error<a href="#appendix-G-2.5.2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.6">Made error codes non-negative and 0 for success<a href="#appendix-G-2.5.2.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.7">Added detail on success error code<a href="#appendix-G-2.5.2.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.8">Aligned terminology "protocol instance" -&gt;  "session"<a href="#appendix-G-2.5.2.8" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.9">New appendix on compact EC point representation<a href="#appendix-G-2.5.2.9" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.10">Added detail on use of ephemeral public keys<a href="#appendix-G-2.5.2.10" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.11">Moved key derivation for OSCORE to draft-ietf-core-oscore-edhoc<a href="#appendix-G-2.5.2.11" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.12">Additional security considerations<a href="#appendix-G-2.5.2.12" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.13">Renamed "Auxililary Data" as "External Authorization Data"<a href="#appendix-G-2.5.2.13" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.5.2.14">Added encrypted EAD_4 to message_4<a href="#appendix-G-2.5.2.14" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="appendix-G-2.6">
          <p id="appendix-G-2.6.1">From -05 to -06:<a href="#appendix-G-2.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.6.2.1">New section 5.2 "Message Processing Outline"<a href="#appendix-G-2.6.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.6.2.2">Optional inital byte C_1 = null in message_1<a href="#appendix-G-2.6.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.6.2.3">New format of error messages, table of error codes, IANA registry<a href="#appendix-G-2.6.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.6.2.4">Change of recommendation transport of error in CoAP<a href="#appendix-G-2.6.2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.6.2.5">Merge of content in 3.7 and appendix C into new section 3.7 "Applicability Statement"<a href="#appendix-G-2.6.2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.6.2.6">Requiring use of deterministic CBOR<a href="#appendix-G-2.6.2.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.6.2.7">New section on message deduplication<a href="#appendix-G-2.6.2.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.6.2.8">New appendix containin all CDDL definitions<a href="#appendix-G-2.6.2.8" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.6.2.9">New appendix with change log<a href="#appendix-G-2.6.2.9" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.6.2.10">Removed section "Other Documents Referencing EDHOC"<a href="#appendix-G-2.6.2.10" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.6.2.11">Clarifications based on review comments<a href="#appendix-G-2.6.2.11" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="appendix-G-2.7">
          <p id="appendix-G-2.7.1">From -04 to -05:<a href="#appendix-G-2.7.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.7.2.1">EDHOC-Rekey-FS -&gt; EDHOC-KeyUpdate<a href="#appendix-G-2.7.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.7.2.2">Clarification of cipher suite negotiation<a href="#appendix-G-2.7.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.7.2.3">Updated security considerations<a href="#appendix-G-2.7.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.7.2.4">Updated test vectors<a href="#appendix-G-2.7.2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.7.2.5">Updated applicability statement template<a href="#appendix-G-2.7.2.5" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="appendix-G-2.8">
          <p id="appendix-G-2.8.1">From -03 to -04:<a href="#appendix-G-2.8.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.8.2.1">Restructure of section 1<a href="#appendix-G-2.8.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.8.2.2">Added references to C509 Certificates<a href="#appendix-G-2.8.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.8.2.3">Change in CIPHERTEXT_2 -&gt; plaintext XOR KEYSTREAM_2 (test vector not updated)<a href="#appendix-G-2.8.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.8.2.4">"K_2e", "IV_2e" -&gt; KEYSTREAM_2<a href="#appendix-G-2.8.2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.8.2.5">Specified optional message 4<a href="#appendix-G-2.8.2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.8.2.6">EDHOC-Exporter-FS -&gt; EDHOC-Rekey-FS<a href="#appendix-G-2.8.2.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.8.2.7">Less constrained devices SHOULD implement both suite 0 and 2<a href="#appendix-G-2.8.2.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.8.2.8">Clarification of error message<a href="#appendix-G-2.8.2.8" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.8.2.9">Added exporter interface test vector<a href="#appendix-G-2.8.2.9" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="appendix-G-2.9">
          <p id="appendix-G-2.9.1">From -02 to -03:<a href="#appendix-G-2.9.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.9.2.1">Rearrangements of section 3 and beginning of section 4<a href="#appendix-G-2.9.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.9.2.2">Key derivation new section 4<a href="#appendix-G-2.9.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.9.2.3">Cipher suites 4 and 5 added<a href="#appendix-G-2.9.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.9.2.4">EDHOC-EXPORTER-FS - generate a new PRK_4x3m from an old one<a href="#appendix-G-2.9.2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.9.2.5">Change in CIPHERTEXT_2 -&gt; COSE_Encrypt0 without tag (no change to test vector)<a href="#appendix-G-2.9.2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.9.2.6">Clarification of error message<a href="#appendix-G-2.9.2.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.9.2.7">New appendix C applicability statement<a href="#appendix-G-2.9.2.7" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="appendix-G-2.10">
          <p id="appendix-G-2.10.1">From -01 to -02:<a href="#appendix-G-2.10.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.10.2.1">New section 1.2 Use of EDHOC<a href="#appendix-G-2.10.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.10.2.2">Clarification of identities<a href="#appendix-G-2.10.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.10.2.3">New section 4.3 clarifying bstr_identifier<a href="#appendix-G-2.10.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.10.2.4">Updated security considerations<a href="#appendix-G-2.10.2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.10.2.5">Updated text on cipher suite negotiation and key confirmation<a href="#appendix-G-2.10.2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.10.2.6">Test vector for static DH
o<a href="#appendix-G-2.10.2.6" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="appendix-G-2.11">
          <p id="appendix-G-2.11.1">From -00 to -01:<a href="#appendix-G-2.11.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-G-2.11.2.1">Removed PSK method<a href="#appendix-G-2.11.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="appendix-G-2.11.2.2">Removed references to certificate by value<a href="#appendix-G-2.11.2.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
      </ul>
</section>
</div>
<div id="acknowledgments">
<section id="appendix-H">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="appendix-H-1">The authors want to thank Christian Amsuess, Alessandro Bruni, Karthikeyan Bhargavan, Timothy Claeys, Martin Disch, Loic Ferreira, Theis Groenbech Petersen, Dan Harkins, Klaus Hartke, Russ Housley, Stefan Hristozov, Alexandros Krontiris, Ilari Liusvaara, Karl Norrman, Salvador Perez, Eric Rescorla, Michael Richardson, Thorvald Sahl Joergensen, Jim Schaad, Carsten Schuermann, Ludwig Seitz, Stanislav Smyshlyaev, Valery Smyslov, Peter van der Stok, Rene Struik, Vaishnavi Sundararajan, Erik Thormarker, Marco Tiloca, Michel Veillette, and Malisa Vucinic for reviewing and commenting on intermediate versions of the draft. We are especially indebted to Jim Schaad for his continuous reviewing and implementation of different versions of the draft.<a href="#appendix-H-1" class="pilcrow">¶</a></p>
<p id="appendix-H-2">Work on this document has in part been supported by the H2020 project SIFIS-Home (grant agreement 952652).<a href="#appendix-H-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-I">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Göran Selander</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="street-address">SE-164 80 Stockholm</span></div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:goran.selander@ericsson.com" class="email">goran.selander@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Preuß Mattsson</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="street-address">SE-164 80 Stockholm</span></div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:john.mattsson@ericsson.com" class="email">john.mattsson@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Francesca Palombini</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div dir="auto" class="left"><span class="street-address">SE-164 80 Stockholm</span></div>
<div dir="auto" class="left"><span class="country-name">Sweden</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:francesca.palombini@ericsson.com" class="email">francesca.palombini@ericsson.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
