<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Emergency Text Messaging using SIP MESSAGE</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 Introduction">
<link href="#rfc.section.3" rel="Chapter" title="3 Overview of operation">
<link href="#rfc.section.4" rel="Chapter" title="4 Caller UAC Processing">
<link href="#rfc.section.5" rel="Chapter" title="5 Proxy Processing">
<link href="#rfc.section.6" rel="Chapter" title="6 Conversion to SIP MESSAGE">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This memo describes best current practices on how to use the SIP MESSAGE method for emergency text messaging from citizens to authorities." />
  <meta name="description" content="This memo describes best current practices on how to use the SIP MESSAGE method for emergency text messaging from citizens to authorities." />
  <meta name="keywords" content="emergency, text" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">DISPATCH</td>
<td class="right">J. Kim</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">W. Song</td>
</tr>
<tr>
<td class="left">Intended status: Best Current Practice</td>
<td class="right">H. Schulzrinne</td>
</tr>
<tr>
<td class="left">Expires: October 06, 2011</td>
<td class="right">Columbia University</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">P. Boni</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">M. Armstrong</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Verizon</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">April 04, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Emergency Text Messaging using SIP MESSAGE<br />
  <span class="filename">draft-kim-dispatch-text-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This memo describes best current practices on how to use the SIP MESSAGE method for emergency text messaging from citizens to authorities.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 06, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Terminology</a>
</li>
<li>2.   <a href="#rfc.section.2">Introduction</a>
</li>
<li>3.   <a href="#rfc.section.3">Overview of operation</a>
</li>
<li>4.   <a href="#rfc.section.4">Caller UAC Processing</a>
</li>
<li>5.   <a href="#rfc.section.5">Proxy Processing</a>
</li>
<li>6.   <a href="#rfc.section.6">Conversion to SIP MESSAGE</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Terminology</h1>
<p id="rfc.section.1.p.1">This document uses terms from <a href="#I-D.ietf-ecrit-framework">[I-D.ietf-ecrit-framework]</a> and <a href="#RFC3428">[RFC3428]</a>.</p>
<p id="rfc.section.1.p.2">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Introduction</h1>
<p id="rfc.section.2.p.1">The SIP MESSAGE method <a href="#RFC3428">[RFC3428]</a> is used for page-mode messaging. In page mode, each individual message is sent independently and not as part of any session. On the other hand, there are session-mode text messaging standards such as the Message Session Relay Protocol (MSRP) <a href="#RFC4975">[RFC4975]</a> and Real Time Text (RTT) <a href="#RFC5194">[RFC5194]</a> where every message is part of an explicit session.</p>
<p id="rfc.section.2.p.2">Which mode to use in an emergency situation depends on what the endpoint is capable of. Short Message Service (SMS), for example, is page-mode messaging. If caller wants to use SMS to send emergency text messages, a page-mode mechanism must be used. Some types of Instant Messaging (IM) systems work as page-mode messaging as well. </p>
<p id="rfc.section.2.p.3">This document describes how the SIP MESSAGE method is used to support emergency text messaging within the framework described in <a href="#I-D.ietf-ecrit-framework">[I-D.ietf-ecrit-framework]</a>. The existing framework does not consider methods, such as the SIP MESSAGE method, that do not create a session or are not a part of it. This document describes how to deliver multiple SIP MESSAGE requests consistently to the same call taker. It also describes how non-SIP text messaging content can be converted to SIP MESSAGE requests.</p>
<p id="rfc.section.2.p.4">Presence is beyond the scope of this document.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#overview" id="overview">Overview of operation</a>
</h1>
<div id="#rfc.figure.1"></div>
<div id="#figure_textflow"></div>
<pre>                                               +-------+
                                               | PSAP2 |
                                               +-------+
           
  +------+ [SIP] +-------+     +------+     +-------+
  |SIP UA| -----&gt;| Proxy |----&gt;| ESRP |----&gt;| PSAP1 |-----&gt; Call-Taker
  +------+       +-------+     +------+     +-------+
                                   ^
  +----------+ [SMS] +--------+    |           +-------+
  |Cell phone| -----&gt;| SMS GW |----+ [SIP]     | PSAP3 |
  +----------+       +--------+                +-------+
</pre>
<p></p>
<p id="rfc.section.3.p.2">This document assumes that the Emergency Services IP Network (ESInet) and Public Safety Answering Point (PSAP) are SIP-based infrastructures.  The caller-facing access network may or may not be SIP-based or IP-based. As shown in <a href="#figure_textflow">Figure 1</a>, emergency text messages may be sent end-to-end from a SIP User Agent using SIP MESSAGE requests. It may also be sent in a different format and protocol, such as SMS, and converted to SIP MESSAGE requests somewhere along the path towards the call taker. Gateways, such as the SMS gateway shown in <a href="#figure_textflow">Figure 1</a>, handles these conversions. Conversion is described in <a href="#conversion">Section 6</a>.</p>
<p id="rfc.section.3.p.3">The SIP MESSAGE request is constructed as described in <a href="#RFC3428">[RFC3428]</a>. The body of the request contains the text message to be delivered. Then the values for various emergency header fields are filled as stated in <a href="#I-D.ietf-ecrit-framework">[I-D.ietf-ecrit-framework]</a>. If the location information is appended to the body of the request, the caller's message and the location information must be inserted into the body of the request as multiple MIME attachments. These are explained in more detail in <a href="#CallerUAC">Section 4</a>.</p>
<p id="rfc.section.3.p.4">The main difference of this approach from both the traditional SIP MESSAGE request routing and the emergency framework is in the way the SIP MESSAGE request is handled along the signaling path. In emergency handling, the path that the first SIP MESSAGE request takes is important. Subsequent SIP MESSAGE requests from the same person or device must follow the same path as the first one so that they are delivered correctly to the same call taker. Otherwise, if subsequent SIP MESSAGE requests are delivered to another call taker or another PSAP, there will be considerable confusion for both the sender and the receiver. Therefore, the path of the first SIP MESSAGE request is determined by location and/or local policy, but all subsequent SIP MESSAGE requests must follow the path of the first request regardless of location or local policy.</p>
<p id="rfc.section.3.p.5">This means that entities within the signaling path that determine the next hop based on location or local policy need to keep track of SIP MESSAGE requests that it forwards. Emergency Service Routing Proxy <a href="#I-D.ietf-ecrit-framework">[I-D.ietf-ecrit-framework]</a> is an example of such entity.  How such proxy behaves is described in <a href="#ProxyProcessing">Section 5</a>. However, this behavior is not confined to proxies. SIP UAs and call distributing entities within the PSAPs are also affected. If the SIP UA does not keep track of SIP MESSAGE requests, then it would query LoST <a href="#RFC5222">[RFC5222]</a> every time a SIP MESSAGE is sent. This is a big problem if the caller is moving while sending messages; the SIP UA may send the SIP MESSAGE requests to different PSAPs based on LoST query results. Call distributing entities need to keep track of SIP MESSAGE requests so that requests from one caller is forwarded consistently to one call taker.  For these entities, the same state-keeping mechanisms described in <a href="#ProxyProcessing">Section 5</a> can be used.</p>
<p id="rfc.section.3.p.6">When the call taker sends a reply to the caller, the reply follows the normal SIP routing path. If the caller's original message was not SIP, then the replies from the call taker must also be converted from SIP MESSAGE requests to the original message format and transport protocol. As an example, if the caller's original message was an SMS message, then the call taker's replies to be converted to an SMS message so that the caller can receive it on his/her cell phone. There may be other protocols, such as proprietary IM protocols, that may need conversion.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#CallerUAC" id="CallerUAC">Caller UAC Processing</a>
</h1>
<p id="rfc.section.4.p.1">Caller UAC follows the rules of SIP MESSAGE method<a href="#RFC3428">[RFC3428]</a> and those of <a href="#I-D.ietf-ecrit-framework">[I-D.ietf-ecrit-framework]</a>. The following description of caller UAC processing is derived from the union of the two documents mentioned earlier.</p>
<p id="rfc.section.4.p.2">The UAC may include location information in the body as type "xml/pidf-lo" with a corresponding Geolocation header field, or include a reference to the location information in the Geolocation header field as specified in <a href="#I-D.ietf-sip-location-conveyance">[I-D.ietf-sip-location-conveyance]</a>.  In the former case, the UAC needs to include both the sender's message and the location information in one body. To do so, the UAC must use multipart MIME. Here is an example:</p>
<div id="#rfc.figure.2"></div>
<pre>----- =_RjhENkI3RjQ4NUE0QjI2Q0VEODdGNjIwMkMwNjZC
MIME-Version: 1.0
Content-ID: &lt;3252.1224700600.5@NG911_Desktop1&gt;
Content-Type: text/plain
Content-Transfer-Encoding: 8bit

Hello, I need help.

----- =_RjhENkI3RjQ4NUE0QjI2Q0VEODdGNjIwMkMwNjZC
MIME-Version: 1.0
Content-ID: caller@x.y
Content-Type: application/pidf+xml
Content-Transfer-Encoding: UTF-8

&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;presence xmlns="urn:ietf:params:xml:ns:pidf" 
  xmlns:gp="urn:ietf:params:xml:ns:pidf:geopriv10" 
  xmlns:cl="urn:ietf:params:xml:ns:pidf:geopriv10:civicLoc" 
  entity="sip:caller@x.y"&gt;
  &lt;tuple id="id94954"&gt;
    &lt;status&gt;
      &lt;gp:geopriv&gt;
        &lt;gp:location-info&gt;
          &lt;cl:civicAddress&gt;
            &lt;cl:country&gt;us&lt;/cl:country&gt;
            &lt;cl:A1&gt;ny&lt;/cl:A1&gt;
            &lt;cl:A3&gt;new york&lt;/cl:A3&gt;
            &lt;cl:A6&gt;amsterdam&lt;/cl:A6&gt;
            &lt;cl:HNO&gt;1214&lt;/cl:HNO&gt;
            &lt;cl:PC&gt;10027&lt;/cl:PC&gt;
          &lt;/cl:civicAddress&gt;
        &lt;/gp:location-info&gt;
        &lt;gp:method&gt;Manual&lt;/gp:method&gt;
      &lt;/gp:geopriv&gt;
    &lt;/status&gt;
    &lt;contact priority="1.0"&gt;sip:caller@x.y&lt;/contact&gt;
    &lt;timestamp&gt;2008-11-14T19:43:43Z&lt;/timestamp&gt;
  &lt;/tuple&gt;
&lt;/presence&gt;
----- =_RjhENkI3RjQ4NUE0QjI2Q0VEODdGNjIwMkMwNjZC</pre>
<p></p>
<p id="rfc.section.4.p.4">The UAC should resolve the location to a URI by querying LoST <a href="#RFC5222">[RFC5222]</a> and should include the URI in the Route header field. This should be done only once for the initial SIP MESSAGE request to make sure that all subsequent SIP MESSAGE requests follow the same next-hop as the first request. If the UAC is not able to resolve the location, then it should not include a Route header field.</p>
<p id="rfc.section.4.p.5">If the UAC receives a non-200 response, it should notify the sender of the response and give the sender the option of dialing the emergency number instead of sending another SIP MESSAGE request.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#ProxyProcessing" id="ProxyProcessing">Proxy Processing</a>
</h1>
<p id="rfc.section.5.p.1">As described in <a href="#overview">Section 3</a>, proxies that determine the next hop of an emergency request based on location or local policy need to keep track of SIP MESSAGE requests they handle. On the other hand, proxies that forward SIP MESSAGE requests statically, i.e., based on the To header field or the Route header field, do not need to keep track since the SIP MESSAGE requests will be delivered consistently.</p>
<p id="rfc.section.5.p.2">The proxies that need to track SIP MESSAGE requests, e.g., the Emergency Services Routing Proxy <a href="#I-D.ietf-ecrit-framework">[I-D.ietf-ecrit-framework]</a>, MUST perform additional record keeping for SIP MESSAGE requests if all of the following conditions are met.</p>
<p></p>

<ol>
<li>The destination (obtained from the To header field) is urn:service:sos.</li>
<li>This is the first SIP MESSAGE request from a particular source (obtained from the From header field). In other words, the proxy has no record of the source sending a SIP MESSAGE request to urn:service:sos.</li>
</ol>
<p id="rfc.section.5.p.4">The record is a (source, next-hop, expiration timer) triplet. The source is obtained from the From header field of the request. The next-hop is determined by a LoST query <a href="#RFC5222">[RFC5222]</a> based on the location information or a reference to the location information within the first request. Location information in subsequent requests do not affect the next-hop value. The expiration timer is a value in seconds during which the record will be preserved in the proxy.  Each subsequent request resets the expiration timer. For example, if the configured value of the expiration timer is 30 seconds, then the countdown begins after the first request is processed. When the second request comes in, the expiration timer is reset to 30 seconds and the countdown starts again. If the timer falls to zero, the record is no longer valid.</p>
<p id="rfc.section.5.p.5">Proxies route all subsequent SIP MESSAGE request from the same source to the same next-hop while the expiration timer is greater than zero.  Each subsequent SIP MESSAGE request resets the expiration timer to its maximum value. This is to ensure that a 'conversation' between the caller and the call taker is consistent.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#conversion" id="conversion">Conversion to SIP MESSAGE</a>
</h1>
<p id="rfc.section.6.p.1">The original message may not be SIP. It may be an SMS message or an IM message in a proprietary format and protocol. In these cases, the original format and protocol must be converted to a SIP MESSAGE request.</p>
<p id="rfc.section.6.p.2">The following is the minimum information needed to convert a non-SIP message to a valid SIP MESSAGE request.</p>
<div id="#rfc.table.1"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Type of Information</th>
<th class="left">Corresponding SIP MESSAGE element</th>
</tr></thead>
<tbody>
<tr>
<td class="left">Origination address or number</td>
<td class="left">From header field</td>
</tr>
<tr>
<td class="left">User message</td>
<td class="left">In the body as type "text/plain"</td>
</tr>
<tr>
<td class="left">Location information</td>
<td class="left">Geolocation header field and in the body as type "xml/pidf-lo" (Geolocation header field only if conveying location by reference)</td>
</tr>
</tbody>
</table>
<p id="rfc.section.6.p.3">The SIP URI for the From header field must be created by merging the origination address or number and the IP address and port of the converting entity. The IP address and port of the converting entity is needed for reply message from the call taker to reach the caller. For example, let's say the origination address or number is 123-456-7890 and the IP address and port number of the converting entity is 128.59.19.184:5060. Then the SIP URI should be sip:1234567890@128.59.19.184:5060.</p>
<p id="rfc.section.6.p.4">The To header field must contain an emergency string such as "urn:service:sos". The destination address or number, e.g., 9-1-1, in the original non-SIP message is retained and carried along with the SIP message in the History-Info header <a href="#RFC4244">[RFC4244]</a>. The destination address could be useful in post incident call analysis for PSAP personnel to identify network issues such as mis-routed text messages allowing more efficient trouble clearing with the appropriate network provider.</p>
<p id="rfc.section.6.p.5">The next hop entity should be determined by querying LoST with the provided location information and it should be included in the Route header field.</p>
<p id="rfc.section.6.p.6">If the converter receives a 200 OK response, it should send a success indicator to the original sender. There may not be a one-to-one match between SIP responses and the original protocol, especially when non-200 responses are received. In this case, the converter must indicate failure and may send the reason text as a message to the sender.</p>
<p id="rfc.section.6.p.7">The call taker's reply, which is another SIP MESSAGE request in the reverse direction, should be sent to the origination address or number in its original format. The origination address or number can be extracted from the To header field. The From header field may contain "urn:service:sos", in which case it must be replaced with the original emergency number or string.</p>
<p id="rfc.section.6.p.8">If the sender protocol allows provisional and final responses, the converter should make use of them to indicate the status of the call taker. For example, the converter should send a 202 Accepted response upon receiving the call taker's SIP MESSAGE request, and then a 200 OK upon receiving the final success indication from the sender. If the sender protocol does not allow such elaborate responses, the converter must send a 200 OK upon receiving the call taker's SIP MESSAGE request.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">This document does not introduce new security considerations.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.8.p.1">This memo includes no request to IANA.</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3428">[RFC3428]</b></td>
<td class="top">
<a>Campbell, B</a>, <a>Rosenberg, J</a>, <a>Schulzrinne, H</a>, <a>Huitema, C</a> and <a>D Gurle</a>, "<a>Session Initiation Protocol (SIP) Extension for Instant Messaging</a>", December 2002.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-ecrit-framework">[I-D.ietf-ecrit-framework]</b></td>
<td class="top">
<a>Rosen, B</a>, <a>Schulzrinne, H</a>, <a>Polk, J</a> and <a>A Newton</a>, "<a>Framework for Emergency Calling using Internet Multimedia</a>", July 2009.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-sip-location-conveyance">[I-D.ietf-sip-location-conveyance]</b></td>
<td class="top">
<a>Polk, J</a> and <a>B Rosen</a>, "<a>Location Conveyance for the Session Initiation Protocol</a>", July 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5222">[RFC5222]</b></td>
<td class="top">
<a>Hardie, T</a>, <a>Newton , A</a>, <a>Schulzrinne , H</a> and <a>H Tschofenig </a>, "<a>LoST: A Location-to-Service Translation Protocol</a>", August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4975">[RFC4975]</b></td>
<td class="top">
<a>Campbell, B</a>, <a title="R">Mahy, R</a> and <a>C Jennings</a>, "<a>The Message Session Relay Protocol (MSRP)</a>", September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5194">[RFC5194]</b></td>
<td class="top">
<a>van Wijk, A</a> and <a>G Gybels</a>, "<a>Framework for Real-Time Text over IP Using the Session Initiation Protocol (SIP)</a>", June 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4244">[RFC4244]</b></td>
<td class="top">
<a title="B">Barnes, M</a>, "<a>An Extension to the Session Initiation Protocol (SIP) for Request History Information</a>", November 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jong Yul Kim</span> 
	  <span class="n hidden">
		<span class="family-name">Kim</span>
	  </span>
	</span>
	<span class="org vcardline">Columbia University</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">New York</span>,  
		<span class="region">NY</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jyk@cs.columbia.edu">jyk@cs.columbia.edu</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Wonsang Song</span> 
	  <span class="n hidden">
		<span class="family-name">Song</span>
	  </span>
	</span>
	<span class="org vcardline">Columbia University</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">New York</span>,  
		<span class="region">NY</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:wonsang@cs.columbia.edu">wonsang@cs.columbia.edu</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Henning Schulzrinne</span> 
	  <span class="n hidden">
		<span class="family-name">Schulzrinne</span>
	  </span>
	</span>
	<span class="org vcardline">Columbia University</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">New York</span>,  
		<span class="region">NY</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hgs@cs.columbia.edu">hgs@cs.columbia.edu</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Piotr Boni</span> 
	  <span class="n hidden">
		<span class="family-name">Boni</span>
	  </span>
	</span>
	<span class="org vcardline">Verizon</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:p.boni@verizon.com">p.boni@verizon.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Michael Armstrong</span> 
	  <span class="n hidden">
		<span class="family-name">Armstrong</span>
	  </span>
	</span>
	<span class="org vcardline">Verizon</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:michael.g.armstrong@verizon.com">michael.g.armstrong@verizon.com</a></span>

  </address>
</div>

</body>
</html>