
   Internet Engineering Task Force                  Flemming Andreasen 
   MMUSIC Working Group                                      Dave Oran 
   INTERNET-DRAFT                                             Dan Wing 
   EXPIRES: April 2005                                   Cisco Systems 
                                                         October, 2004 
    
                     Connectivity Preconditions for  
               Session Description Protocol Media Streams 
        <draft-andreasen-mmusic-connectivityprecondition-01.txt> 
 
 
Status of this memo 
    
   By submitting this Internet-Draft, I certify that any applicable 
   patent or other IPR claims of which I am aware have been disclosed, 
   and any of which I become aware will be disclosed, in accordance 
   with RFC 3668. 
    
   By submitting this Internet-Draft, I accept the provisions of 
   Section 3 of RFC 3667 (BCP 78). 
    
   Internet-Drafts are working documents of the Internet Engineering 
   Task Force (IETF), its areas, and its working groups.  Note that 
   other groups may also distribute working documents as Internet-
   Drafts. 
    
   Internet-Drafts are draft documents valid for a maximum of six 
   months and may be updated, replaced, or obsoleted by other documents 
   at any time.  It is inappropriate to use Internet-Drafts as 
   reference material or cite them other than as "work in progress". 
    
   The list of current Internet-Drafts can be accessed at 
   http://www.ietf.org/ietf/lid-abstracts.txt 
    
   The list of Internet-Draft Shadow Directories can be accessed at 
   http://www.ietf.org/shadow.html 
    
Copyright Notice 
    
   Copyright (C) The Internet Society (2004).  All Rights Reserved. 
    
Abstract 
    
   This document defines a new connectivity precondition for the 
   Session Description Protocol precondition framework described in RFC 
   3312.  A connectivity precondition can be used to delay session 
   establishment or modification until media stream connectivity has 
   been verified successfully.  






 
 

INTERNET-DRAFT         Connectivity Preconditions        October, 2004 
 
 
    
1.   Notational Conventions..........................................2 
2.   Introduction....................................................2 
3.   Connectivity Precondition Definition............................2 
4.   Examples........................................................3 
5.   Security Considerations.........................................6 
6.   IANA Considerations.............................................7 
7.   Acknowledgements................................................7 
8.   Authors' Addresses..............................................7 
9.   Normative References............................................7 
10.  Informative References..........................................7 
Intellectual Property Statement......................................8 
    
    
1. Notational Conventions 
    
   The key words "MUST", "MUST NOT", "REQUIRED", "MUST", "MUST NOT", 
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this 
   document are to be interpreted as described in [RFC2119].   
    
2. Introduction 
    
   RFC 3312 defines the concept of a Session Description Protocol (SDP) 
   [SDP] precondition, which is a condition that has to be satisfied 
   for a given media stream in order for session establishment or 
   modification to proceed.  When the precondition is not met, session 
   progress is delayed until the precondition is satisfied, or the 
   session establishment fails.  For example, RFC 3312 defines the 
   Quality of Service precondition, which is used to ensure 
   availability of network resources prior to establishing (i.e. 
   alerting) a call.   
    
   SIP sessions are typically established in order to setup one or more 
   media streams.  Even though a media stream may be negotiated 
   successfully, the actual media stream itself may fail.  For example, 
   when there is one or more Network Address Translators (NATs) or 
   firewalls in the media path, the media stream may not be received by 
   the far end.  The connectivity precondition defined in this document 
   ensures, that session progress is delayed until media stream 
   connectivity has been verified, or the session itself is abandoned.   
    
3. Connectivity Precondition Definition  
    
   The connectivity precondition type is defined by the string "con" 
   and hence we modify the grammar found in RFC 3312 as follows: 
    
     precondition-type  =  "con" | "qos" | token 
    
   RFC 3312 defines support for two kinds of status types, namely 
   segmented and end-to-end.  The connectivity precondition-type 

 
 
 
Andreasen, Oran, Wing                                         [Page 2] 

INTERNET-DRAFT         Connectivity Preconditions        October, 2004 
 
 
   defined here MUST be used with the end-to-end status type; use of 
   the segmented status type is undefined.  
    
   An entity that wishes to delay session establishment or modification 
   until media stream connectivity has been established uses this 
   precondition-type in an offer.  When a connectivity precondition is 
   received in an offer, session establishment or modification MUST be 
   delayed until the connectivity precondition has been met, i.e. media 
   stream connectivity has been established in the desired 
   direction(s).   
    
   The direction attributes are interpreted as follows: 
    
   * send:  The offerer/answerer is sending media stream packets to the 
     other party, and the offerer/answer knows the other party has 
     received at least one of those media stream packets, i.e., there 
     is connectivity in the forward (sending) direction.  
    
   * recv:  The offerer/answerer knows that the other party has 
     ascertained media stream connectivity to it, i.e., there is 
     connectivity in the backwards (receiving) direction, and it is 
     know that the other side has determined this.  
    
   Note that a "send" connectivity precondition from the offerer's 
   point of view corresponds to a "recv" connectivity precondition from 
   the answerer's point of view, and vice versa.  If media stream 
   connectivity in both directions is required before session 
   establishment continues, the desired status must be set to 
   "sendrecv".   
    
   Media stream connectivity can be ascertained in different ways and 
   this document does not mandate any particular mechanism for doing 
   so.  It is however RECOMMENDED that the No-Op RTP payload format 
   defined in [no-op] is supported by entities that support 
   connectivity preconditions.  This will ensure that all entities that 
   support the connectivity preconditions have at least one common way 
   of ascertaining connectivity.  
    
4. Examples 
    
   The call flow of Figure 1 shows a basic session establishment with 
   the Session Initiation Protocol using SDP connectivity preconditions 
   and RTP no-op.  Note that not all SDP details are provided in the 
   following.  
    
    





 
 
 
Andreasen, Oran, Wing                                         [Page 3] 

INTERNET-DRAFT         Connectivity Preconditions        October, 2004 
 
 
                  A                                            B 
    
                  |                                            | 
                  |-------------(1) INVITE SDP1--------------->| 
                  |                                            | 
                  |<------(2) 183 Session Progress SDP2--------| 
                  |                                            | 
                  |<~~~~~ Connectivity check to A ~~~~~~~~~~~~~| 
                  |                                            | 
                  |----------------(3) PRACK------------------>| 
                  |                                            | 
                  |~~~~~ Connectivity to A OK ~~~~~~~~~~~~~~~~>| 
                  |                                            | 
                  |<-----------(4) 200 OK (PRACK)--------------| 
                  |                                            | 
                  |~~~~~ Connectivity check to B ~~~~~~~~~~~~~>| 
                  |<~~~~ Connectivity to B OK ~~~~~~~~~~~~~~~~~| 
                  |                                            | 
                  |-------------(5) UPDATE SDP3--------------->| 
                  |                                            | 
                  |<--------(6) 200 OK (UPDATE) SDP4-----------| 
                  |                                            | 
                  |<-------------(7) 180 Ringing---------------| 
                  |                                            | 
                  |                                            | 
                  |                                            | 
    
                Figure 1: Example using the connectivity precondition 
    
   SDP1: A includes the end-to-end connectivity precondition with a 
   desired status of "sendrecv"; this will ensure media stream 
   connectivity in both directions before continuing with the session 
   setup.  Since media stream connectivity in either direction is 
   unknown at this point, the current status is set to "none".  A's 
   local status table (see RFC 3312) for the connectivity precondition 
   is as follows: 
    
       Direction |  Current | Desired Strength |  Confirm  
      -----------+----------+------------------+---------- 
         send    |    no    |   mandatory      |    no 
         recv    |    no    |   mandatory      |    no 
    
   and the resulting offer SDP is: 
    
     m=audio 20000 RTP/AVP 0 96 
     c=IN IP4 192.0.2.1 
     a=rtpmap:96 no-op/8000 
     a=curr:con e2e none 
     a=des:con mandatory e2e sendrecv 
    

 
 
 
Andreasen, Oran, Wing                                         [Page 4] 

INTERNET-DRAFT         Connectivity Preconditions        October, 2004 
 
 
   SDP2: When B receives the offer, B sees the bidirectional 
   connectivity preconditions.  B can ascertain connectivity to A 
   ("send" from B's point of view) by use of the RTP no-op, however B 
   needs A to inform it about connectivity in the other direction 
   ("recv" from B's point of view).  B's local status table therefore 
   looks as follows: 
    
       Direction |  Current | Desired Strength |  Confirm  
      -----------+----------+------------------+---------- 
         send    |    no    |   mandatory      |    no 
         recv    |    no    |   mandatory      |    no 
    
   Since B needs to ask A for confirmation about the "recv" (from B's 
   point of view) connectivity precondition, the resulting answer SDP 
   becomes: 
    
     m=audio 30000 RTP/AVP 0 96 
     a=rtpmap:96 no-op/8000 
     c=IN IP4 192.0.2.4 
     a=curr:con e2e none 
     a=des:con mandatory e2e sendrecv 
     a=conf:con e2e recv 
    
   Meanwhile, B performs a connectivity check to A, which succeeds and 
   hence B's local status table is updated as follows: 
    
       Direction |  Current | Desired Strength |  Confirm  
      -----------+----------+------------------+---------- 
         send    |    yes   |   mandatory      |    no 
         recv    |    no    |   mandatory      |    no 
    
   Since the "send" connectivity precondition is still not satisfied, 
   session establishment remains suspended.    
    
   SDP3: When A receives the answer SDP, A notes that confirmation was 
   requested for B's "recv" connectivity precondition, which is the 
   "send" precondition from A's point of view.  A performs a 
   connectivity check to B, which succeeds, and A's local status table 
   becomes: 
    
       Direction |  Current | Desired Strength |  Confirm  
      -----------+----------+------------------+---------- 
         send    |    yes   |   mandatory      |    yes 
         recv    |    no    |   mandatory      |    no 
    
   Since B had asked for confirmation about the "send" connectivity 
   (from A's point of view), A now sends an UPDATE (5) to B to confirm 
   the connectivity from A to B:  
    
     m=audio 20000 RTP/AVP 0 96 
     a=rtpmap:96 no-op/8000 
 
 
 
Andreasen, Oran, Wing                                         [Page 5] 

INTERNET-DRAFT         Connectivity Preconditions        October, 2004 
 
 
     c=IN IP4 192.0.2.1 
     a=curr:con e2e send 
     a=des:con mandatory e2e sendrecv 
    
   SDP4:  Upon receiving the updated offer, B now knows that there is 
   connectivity from A to B and updates the local status table as 
   follows ("send" from A corresponds to "recv" from B's point of 
   view):  
    
       Direction |  Current | Desired Strength |  Confirm  
      -----------+----------+------------------+---------- 
         send    |    yes   |   mandatory      |    no 
         recv    |    yes   |   mandatory      |    no 
    
   B responds with an answer (6) which contains the current status of 
   the connectivity precondition (i.e., sendrecv) from B's point of 
   view: 
    
     m=audio 30000 RTP/AVP 0 96 
     a=rtpmap:96 no-op/8000 
     c=IN IP4 192.0.2.4 
     a=curr:con e2e sendrecv 
     a=des:con mandatory e2e sendrecv 
    
   At this point in time, session establishment resumes and B returns a 
   180 (Ringing) response (7).   
    
5. Security Considerations 
    
   In addition to the general security for preconditions provided in 
   RFC 3312, the following security issues, which are specific to 
   connectivity preconditions, should be considered.  
    
   Connectivity preconditions rely on mechanisms beyond SDP, e.g. RTP 
   No-Op [no-op] or STUN [stun], to establish and verify connectivity 
   between an offerer and an answerer.  An attacker that prevents those 
   mechanism from succeeding can prevent media sessions from being 
   established and hence it is RECOMMENDED that such mechanisms are 
   adequately secured by message authentication and integrity 
   protection.  Also, the mechanisms SHOULD consider how to prevent 
   denial of service attacks.  Similarly, an attacker that can forge 
   packets for these mechanisms can enable sessions to be established 
   when there in fact is no media connectivity, which may lead to a 
   poor user experience.  Authentication and integrity protection of 
   such mechanisms can prevent this type of attacks and hence use of it 
   is RECOMMENDED.  
    




 
 
 
Andreasen, Oran, Wing                                         [Page 6] 

INTERNET-DRAFT         Connectivity Preconditions        October, 2004 
 
 
6. IANA Considerations  
    
   IANA is hereby requested to register a RFC 3312 precondition type 
   called "con" with the name "Connectivity precondition".  The 
   reference for this precondition type is the current document.  
    
7. Acknowledgements 
    
   The concept of a "connectivity precondition" is the result of 
   discussions with numerous people over a long period of time; the 
   authors greatly appreciate these contributions.  
    
8. Authors' Addresses 
    
   Flemming Andreasen 
   Cisco Systems, Inc. 
   499 Thornall Street, 8th Floor 
   Edison, New Jersey  08837 USA 
   EMail: fandreas@cisco.com 
    
   David Oran 
   Cisco Systems, Inc. 
   7 Ladyslipper Lane 
   Acton, MA 01720  USA 
   EMail: oran@cisco.com 
    
   Dan Wing 
   Cisco Systems, Inc. 
   170 West Tasman Drive 
   San Jose, CA  95134  USA 
   EMail: dwing@cisco.com 
    
9. Normative References 
     
   [RFC3312] G. Camarillo, W. Marshall, J. Rosenberg, "Integration of 
   Resource Management and Session Initiation Protocol (SIP)", RFC 
   3312, October 2002. 
    
   [RFC2327] M. Handley and V. Jacobson, "SDP: Session Description 
   Protocol", RFC 2327, April 1998. 
    
10.  Informative References 
     
   [RFC3551] H. Schulzrinne, and S. Casner "RTP Profile for Audio and 
   Video Conferences with Minimal Control", RFC 3550, July 2003. 
    
   [no-op] F. Andreasen, D. Oran, and D. Wing, "RTP No-Op Payload 
   Format", Work in Progress 
    


 
 
 
Andreasen, Oran, Wing                                         [Page 7] 

INTERNET-DRAFT         Connectivity Preconditions        October, 2004 
 
 
   [stun] J. Rosenberg, J. Weinberger, C. Huitema, R. Mahy, "STUN - 
   Simple Traversal of User Datagram Protocol (UDP) Through Network 
   Address Translators (NATs)", RFC 3489, March 2003.  
    
Intellectual Property Statement 
    
   The IETF takes no position regarding the validity or scope of any 
   Intellectual Property Rights or other rights that might be claimed 
   to pertain to the implementation or use of the technology described 
   in this document or the extent to which any license under such 
   rights might or might not be available; nor does it represent that 
   it has made any independent effort to identify any such rights. 
   Information on the IETF's procedures with respect to rights in IETF 
   Documents can be found in BCP 78 and BCP 79. 
    
   Copies of IPR disclosures made to the IETF Secretariat and any 
   assurances of licenses to be made available, or the result of an 
   attempt made to obtain a general license or permission for the use 
   of such proprietary rights by implementers or users of this 
   specification can be obtained from the IETF on-line IPR repository 
   at http://www.ietf.org/ipr. 
    
   The IETF invites any interested party to bring to its attention any 
   copyrights, patents or patent applications, or other proprietary 
   rights that may cover technology that may be required to implement 
   this standard. Please address the information to the IETF at  
   ietf-ipr@ietf.org. 
    
Disclaimer of Validity 
    
   This document and the information contained herein are provided on 
   an "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE 
   REPRESENTS OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE 
   INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR 
   IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF 
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED 
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE. 
    
Copyright Statement 
    
   Copyright (C) The Internet Society (2004). This document is subject 
   to the rights, licenses and restrictions contained in BCP 78, and 
   except as set forth therein, the authors retain all their rights. 
    
Acknowledgment 
    
   Funding for the RFC Editor function is currently provided by the 
   Internet Society. 
    

 
 
 
Andreasen, Oran, Wing                                         [Page 8] 

