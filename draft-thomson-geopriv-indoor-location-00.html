<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Locations with Locally-Defined Coordinate Reference Systems for the Presence Information Data Format - Location Object (PIDF-LO)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Locations with Locally-Defined Coordinate Reference Systems for the Presence Information Data Format - Location Object (PIDF-LO)">
<meta name="keywords" content="Internet-Draft, Indoor, CRS, Uncertainty, GML">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">GEOPRIV</td><td class="header">M. Thomson</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">J. Winterbottom</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Andrew Corporation</td></tr>
<tr><td class="header">Expires: April 12, 2010</td><td class="header">October 09, 2009</td></tr>
</table></td></tr></table>
<h1><br />Locations with Locally-Defined Coordinate Reference Systems for the Presence Information Data Format - Location Object (PIDF-LO)<br />draft-thomson-geopriv-indoor-location-00</h1>

<h3>Status of This Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 12, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>A method is described for constructing a Presence Information Data Format - Location Object (PIDF-LO) document that contains location information using a locally-defined coordinate reference system (CRS).  This form of representation allows for use of locally-defined coordinates with potential advantages for improved accuracy and usability in local context, in particular location applications that operate indoors.  A framework for defining a local CRS is provided.   A process for transformation of coordinates defined in the local CRS and the widely used World Geodetic System 1984 (WGS84) CRS is defined.
      
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Solution<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Example Use Case<br />
<a href="#conventions">2.</a>&nbsp;
Conventions used in this document<br />
<a href="#anchor4">3.</a>&nbsp;
Overview<br />
<a href="#anchor5">4.</a>&nbsp;
Generating Local Location Information<br />
<a href="#imageCRS">5.</a>&nbsp;
Image-based Coordinate Reference System<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#imageCS">5.1.</a>&nbsp;
Image-based Coordinate System<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#indoorDatum">5.2.</a>&nbsp;
Local or Indoor Datum<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#origin">5.2.1.</a>&nbsp;
Origin Point<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#address">5.2.2.</a>&nbsp;
Origin Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#offset">5.2.3.</a>&nbsp;
Pixel Offset<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#orientation">5.2.4.</a>&nbsp;
Orientation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#scale">5.2.5.</a>&nbsp;
Scaling<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#image">5.2.6.</a>&nbsp;
Map Image<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pixelInCell">5.2.7.</a>&nbsp;
Pixel-Coordinate Relation<br />
<a href="#anchor8">6.</a>&nbsp;
Considerations for Shape Representation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#z-axis">6.1.</a>&nbsp;
Z-Axis Inversion<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">6.2.</a>&nbsp;
Distances<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.3.</a>&nbsp;
Angles of Orientation<br />
<a href="#transform">7.</a>&nbsp;
Coordinate Transformation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">7.1.</a>&nbsp;
Conversion from WGS84 to Local CRS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">7.2.</a>&nbsp;
Conversion from Local CRS to WGS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#matrix">7.3.</a>&nbsp;
Transformation Matrix<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">7.4.</a>&nbsp;
Polygons and Prisms<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">7.5.</a>&nbsp;
Angles of Orientation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#extraunc">7.6.</a>&nbsp;
Managing Uncertainty<br />
<a href="#example">8.</a>&nbsp;
Example PIDF-LO<br />
<a href="#anchor15">9.</a>&nbsp;
GML Definitions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uom">9.1.</a>&nbsp;
Units of Measure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#codeSpace">9.2.</a>&nbsp;
Code Space Definitions<br />
<a href="#schema">10.</a>&nbsp;
XML Schema<br />
<a href="#security">11.</a>&nbsp;
Security Considerations<br />
<a href="#iana">12.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-ns">12.1.</a>&nbsp;
URN Sub-Namespace Registration for 'urn:ietf:params:xml:ns:geopriv:indoor'<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-schema">12.2.</a>&nbsp;
XML Schema Registration<br />
<a href="#anchor16">13.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">14.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">14.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">14.2.</a>&nbsp;
Informative References<br />
<a href="#whatsup">Appendix&nbsp;A.</a>&nbsp;
Calculating WGS84 ECEF Up, North and East Vectors<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Providing location information in indoor environments presents new sets of technical challenges and use cases for location determination and representation.  For use indoors, location information that is in a form specific to that locality can be both more accurate and more usable.
      
</p>
<p>The ability to specify relative coordinates simplifies the use of local applications, especially local mapping or navigation applications, which often rely on floor plan images or provide directions based on fixtures of the local environment.
      
</p>
<p>Within the confines of a building, or in any local context, location information might be determined in relation to fixtures in that environment.  This might provide location information that is highly accurate within a local region, but errors are added if conversion to a globally useful form like World Geodetic System 1984 (WGS84) are required.
      </p>
<blockquote class="text">
<p>For instance, wireless positioning systems within a building might provide excellent accuracy in relation to the wireless transmitters.  However, in converting locations in a local reference frame to a globally applicable systems such as WGS84, these systems encounter difficulties.
        
</p>
<p>On the other hand, Global Navigation Satellite Systems (GNSS), which are widely used to generate location information, operate poorly indoors or anywhere an unobstructed view of the sky cannot be found.
        
</p>
</blockquote><p>
      For these cases and others like them, avoiding conversion steps ensures that unnecessary errors are not introduced.
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Solution</h3>

<p>A means to describe a location in relation to a fixed reference is defined.  These locations use the forms defined in <a class='info' href='#OGC.GeoShape'>[OGC.GeoShape]<span> (</span><span class='info'>Thomson, M. and C. Reed, &ldquo;GML 3.1.1 PIDF-LO Shape Application Schema for use by the Internet Engineering Task Force (IETF),&rdquo; April&nbsp;2007.</span><span>)</span></a>, using a custom coordinate reference system (CRS).
        
</p>
<p>A form for defining a local CRS is described, such that locations in that CRS can be trivial translated to and from the World Geodetic System 1984 (WGS84) CRS used in PIDF-LO.  This allows for location to be expressed in a canonical form, while preserving the location information for use in the local context.
        
</p>
<p>Guidelines are further provided for constructing a <a class='info' href='#RFC4119'>Presence Information Data Format - Location Object (PIDF-LO) document<span> (</span><span class='info'>Peterson, J., &ldquo;A Presence-based GEOPRIV Location Object Format,&rdquo; December&nbsp;2005.</span><span>)</span></a> [RFC4119] so that existing applications and consumers of location information are able to operate.  These guidelines are based on those described in <a class='info' href='#RFC5491'>RFC 5491<span> (</span><span class='info'>Winterbottom, J., Thomson, M., and H. Tschofenig, &ldquo;GEOPRIV Presence Information Data Format Location Object (PIDF-LO) Usage Clarification, Considerations, and Recommendations,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5491].
        
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Example Use Case</h3>

<p>A shopper uses the information contained in a PIDF-LO to identify the location of a store in a mall.  The <a class='info' href='#OGC.GeoShape'>geodetic location information<span> (</span><span class='info'>Thomson, M. and C. Reed, &ldquo;GML 3.1.1 PIDF-LO Shape Application Schema for use by the Internet Engineering Task Force (IETF),&rdquo; April&nbsp;2007.</span><span>)</span></a> [OGC.GeoShape] or <a class='info' href='#RFC5139'>civic address information<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Revised Civic Location Format for Presence Information Data Format Location Object (PIDF-LO),&rdquo; February&nbsp;2008.</span><span>)</span></a> [RFC5139] helps the shopper identify the location of the mall.
        
</p>
<p>The relative, or indoor, location representation helps the shopper find the store within the mall.  This information can be used together with a map of the mall, providing information in a form that is more readily usable to the shopper.  The location of the store or the shopper can be overlaid on the provided map, aiding in finding the store.
        
</p>
<p>Transformation from WGS84 to the local CRS allows the shopper to use location determination methods that are not aware of the local CRS.  Conversely, the location in the local CRS can be transformed into a geodetic location for use outside of the mall, or for applications that are unaware of the local context.
        
</p>
<a name="conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions used in this document</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
      
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Overview</h3>

<p>A location in a user-defined CRS is included in a PIDF-LO document as shown in <a class='info' href='#overview'>Figure&nbsp;1<span> (</span><span class='info'>PIDF-LO Structure Overview</span><span>)</span></a>, which includes the high-level elements involved.

</p><br /><hr class="insert" />
<a name="overview"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;presence entity="pres:..."&gt;

    &lt;tuple id="geodetic"&gt;&lt;status&gt;&lt;geopriv&gt;  * geodetic tuple
      &lt;location-info&gt;
        &lt;Circle srsName="urn:..." .../&gt;     * geodetic location
      &lt;/location-info&gt; ...
    &lt;/geopriv&gt;&lt;/status&gt;&lt;/tuple&gt;

    &lt;tuple id="indoor"&gt;&lt;status&gt;&lt;geopriv&gt;    * indoor tuple
      &lt;location-info&gt;

        &lt;Circle srsName="#indoorCRS" .../&gt;  * indoor location

        &lt;ImageCRS ...&gt;                      * image CRS
          &lt;srsName&gt;#indoorCRS&lt;/srsName&gt;
          &lt;usesCartesianCS .../&gt;            * image coordinates
          &lt;usesImageDatum&gt;
            &lt;IndoorDatum .../&gt;              * indoor datum
          &lt;/usesImageDatum&gt;
        &lt;/ImageCRS&gt;
      &lt;/location-info&gt; ...
    &lt;/geopriv&gt;&lt;/status&gt;&lt;/tuple&gt;

  &lt;/presence&gt;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: PIDF-LO Structure Overview&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Two tuples are included in the PIDF-LO.  One containing geodetic location information, the second containing locally defined coordinates.  Depending on how the location generator operations, <a class='info' href='#transform'>transformation<span> (</span><span class='info'>Coordinate Transformation</span><span>)</span></a> might be used to construct one or other location element.
      
</p>
<p>The first <tt>tuple</tt> (or <tt>device</tt> or <tt>person</tt>) contains <a class='info' href='#OGC.GeoShape'>geodetic information<span> (</span><span class='info'>Thomson, M. and C. Reed, &ldquo;GML 3.1.1 PIDF-LO Shape Application Schema for use by the Internet Engineering Task Force (IETF),&rdquo; April&nbsp;2007.</span><span>)</span></a> [OGC.GeoShape].  This first tuple uses a WGS84 CRS, so that the information is usable outside of the local context.

      </p>
<blockquote class="text">
<p>Aside from being required by <a class='info' href='#RFC5491'>[RFC5491]<span> (</span><span class='info'>Winterbottom, J., Thomson, M., and H. Tschofenig, &ldquo;GEOPRIV Presence Information Data Format Location Object (PIDF-LO) Usage Clarification, Considerations, and Recommendations,&rdquo; March&nbsp;2009.</span><span>)</span></a>, this ensures that overly simplistic processors that rely on tuple ordering do not erroneously assume the use of WGS84 with the subsequent shape information.
</p>
</blockquote><p>
      
</p>
<p>A second <tt>tuple</tt> includes location information using a <a class='info' href='#OGC.GML-3.1.1'>Geography Markup Language (GML)<span> (</span><span class='info'>Cox, S., Daisey, P., Lake, R., Portele, C., and A. Whiteside, &ldquo;Geographic information - Geography Markup Language (GML),&rdquo; April&nbsp;2004.</span><span>)</span></a> [OGC.GML&#8209;3.1.1] geometry element, but using a custom, geo-referenced CRS in place of the WGS84 reference that is used for the geodetic shape.  A formal definition of the CRS is included in the tuple with the shape.
      
</p>
<p>The CRS is defined only within the scope of the PIDF-LO. A URI fragment identifier is used to identify the CRS <tt>srsName</tt> parameters that reference the CRS.
      
</p>
<p>A reference to a GML dictionary containing the CRS MAY be used in place of the fragment identifier used in this document.  An <tt>http:</tt> or <tt>https:</tt> URI MUST be used for this purpose unless an alternative scheme is known to be supported or recognized by recipients of the PIDF-LO.  Authors of PIDF-LO documents that rely on providing a reference to the CRS need to have some assurance that all potential recipients of the location information are either able to resolve the reference or do not require the local information.
      
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Generating Local Location Information</h3>

<p>When creating location information for use in a local context, a coordinate reference system definition is required.  Once the CRS is defined, the shapes from <a class='info' href='#OGC.GeoShape'>[OGC.GeoShape]<span> (</span><span class='info'>Thomson, M. and C. Reed, &ldquo;GML 3.1.1 PIDF-LO Shape Application Schema for use by the Internet Engineering Task Force (IETF),&rdquo; April&nbsp;2007.</span><span>)</span></a> can be used with an <tt>srsName</tt> attribute that references the newly defined CRS, rather than WGS84.
</p>
<p>A GML <tt>ImageCRS</tt> element is used to define an image CRS.  An image CRS is formed of an identifier and name, a coordinate system and a datum.
      
</p>
<p>The <tt>gml:id</tt> attribute of <tt>ImageCRS</tt> contains any valid XML name.  The <tt>srsName</tt> includes a <a class='info' href='#RFC3986'>URI fragment<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> [RFC3986] that refers to this identifier, this is the value that is used in the <tt>srsName</tt> in place of a WGS84 CRS URI.  The local <tt>codeSpace</tt> of <tt>#</tt> is included to indicate that definition is only valid within the scope of this document:
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;gml:ImageCRS gml:id="officeCRS"&gt;
    &lt;gml:srsName codeSpace="#"&gt;#officeCRS&lt;/gml:srsName&gt;
</pre></div>
<p>The CRS then needs a reference to the coordinate system defined in <a class='info' href='#imageCS'>this document<span> (</span><span class='info'>Image-based Coordinate System</span><span>)</span></a>.  This reference is provided using an <a class='info' href='#W3C.REC-xlink-20010627'>XLink<span> (</span><span class='info'>DeRose, S., Orchard, D., and E. Maler, &ldquo;XML Linking Language (XLink) Version 1.0,&rdquo; June&nbsp;2001.</span><span>)</span></a> [W3C.REC&#8209;xlink&#8209;20010627] attribute:
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;gml:usesCartesianCS
      xlink:href="urn:ietf:params:xml:schema:geopriv:indoor#i2d"/&gt;
</pre></div>
<p>An image datum is used to define how the coordinate system then relates to the local environment.  This uses the <tt>IndoorDatum</tt> element defined in <a class='info' href='#indoorDatum'>this document<span> (</span><span class='info'>Local or Indoor Datum</span><span>)</span></a>.  This uses similar identification to the CRS definition:
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;indoor:IndoorDatum gml:id="officeDatum"
      xmlns:indoor="urn:ietf:params:xml:ns:geopriv:indoor"&gt;
    &lt;gml:datumName codeSpace="#"&gt;#officeDatum&lt;/gml:datumName&gt;
    ...
  &lt;/indoor:IndoorDatum&gt;
</pre></div>
<p>An indoor datum requires a <a class='info' href='#origin'>reference point<span> (</span><span class='info'>Origin Point</span><span>)</span></a>, an <a class='info' href='#orientation'>orientation<span> (</span><span class='info'>Orientation</span><span>)</span></a> angle, and a <a class='info' href='#scale'>scaling factor<span> (</span><span class='info'>Scaling</span><span>)</span></a>.  An indoor datum optionally includes a <a class='info' href='#address'>civic address<span> (</span><span class='info'>Origin Address</span><span>)</span></a>, a <a class='info' href='#offset'>pixel offset<span> (</span><span class='info'>Pixel Offset</span><span>)</span></a> and a <a class='info' href='#image'>link to an image<span> (</span><span class='info'>Map Image</span><span>)</span></a>.  A complete example document is included in <a class='info' href='#example'>Section&nbsp;8<span> (</span><span class='info'>Example PIDF-LO</span><span>)</span></a>.
      
</p>
<p>If a map image is used as a reference, then pixel coordinates from an image can then be used directly.
      
</p>
<a name="imageCRS"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Image-based Coordinate Reference System</h3>

<p>A coordinate reference system (CRS) requires the definition of a coordinate system, and a description of how that coordinate system relates to a particular model of physical space.
      
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Note:</dt>
<dd>This encoding specifically uses an image-based CRS, and provides a means to relate the information to a specific image.  However, this CRS can be used in any local context, with or without an image, to describe the location in terms that are more useful within that context.
      
</dd>
</dl></blockquote>

<p>The coordinate system used in relation to images is defined in this document.  All images use the same coordinate system.  Two coordinate systems are defined:
      </p>
<ul class="text">
<li>urn:ietf:params:xml:schema:geopriv:indoor#i3d
</li>
<li>urn:ietf:params:xml:schema:geopriv:indoor#i2d
</li>
</ul><p>
      
</p>
<p>The datum that establishes the origin for the coordinate system is defined during construction of the PIDF-LO.  The datum is specific to a particular location.
      
</p>
<p><a class='info' href='#example'>Section&nbsp;8<span> (</span><span class='info'>Example PIDF-LO</span><span>)</span></a> shows an example definition of an coordinate reference system that include the definition of a location-specific image datum that corresponds to a floor plan.
      
</p>
<a name="imageCS"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Image-based Coordinate System</h3>

<p>A custom coordinate reference system (CRS) is defined for use in representing indoor locations.  This allows positions to be expressed in relation to a floor plan or map.
        
</p>
<p><a class='info' href='#schema'>Section&nbsp;10<span> (</span><span class='info'>XML Schema</span><span>)</span></a> includes the definition of two Cartesian coordinate systems.  The two-dimensional Cartesian coordinate system is identified by the URN <tt>urn:ietf:params:xml:schema:geopriv:indoor#i2d</tt>.  The three-dimensional Cartesian coordinate system is identified by the URN <tt>urn:ietf:params:xml:schema:geopriv:indoor#i3d</tt>.
        
</p>
<p>The two-dimensional coordinate system uses x- and y-axes to represent coordinates in relation to an image.
</p>
<p>Location in relation to an image generally uses a coordinate system with an origin in the upper right.  Values on the x-axis increase to the right and values on the y-axis increase towards the bottom.  This coordinate system - inherited from the path that the beam in a Cathode-ray tube follows - inverts the y-axis from mathematical convention.
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
              ----- x-axis ----&gt;
         O---------------------------+
     |   |                           |
     |   |                           |
  y-axis |                           |
     |   |                           |
     v   |                           |
         |                           |
         +---------------------------+
</pre></div>
<p>A consequence of inverting the y-axis is that the z-axis is also inverted.  
</p>
<p>Any value containing altitude that is expressed in this coordinate system has the z-axis (altitude) inverted.  A positive z-axis value corresponds to a point below the reference plane.  A negative z-axis value corresponds to a point above the reference plane.  That is, if the image is a map as viewed from above, altitude increases as values on the z-axis decrease.
        </p>
<blockquote class="text">
<p>An alternative would be to use different mathematical conventions within this coordinate system, which is inconvenient.
</p>
</blockquote><p>
        
</p>
<p>These two coordinate systems both use a unit of <a class='info' href='#uom'>pixels<span> (</span><span class='info'>Units of Measure</span><span>)</span></a> to represent coordinates.
</p>
<a name="indoorDatum"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Local or Indoor Datum</h3>

<p>The image datum establishes a relationship between the coordinate system and a physical space.
        
</p>
<p>An extension of the GML <tt>ImageDatum</tt> type is used to define a datum precisely.  This definition allows for transformation between the local CRS and WGS84.
        
</p>
<a name="origin"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
Origin Point</h3>

<p>This image datum identifies a point in space, using a geodetic shape.  The <tt>origin</tt> element allows for the inclusion of any form of GML geometry, but this MUST use one of the shapes from <a class='info' href='#OGC.GeoShape'>[OGC.GeoShape]<span> (</span><span class='info'>Thomson, M. and C. Reed, &ldquo;GML 3.1.1 PIDF-LO Shape Application Schema for use by the Internet Engineering Task Force (IETF),&rdquo; April&nbsp;2007.</span><span>)</span></a>.
          
</p>
<p>A single reference point is derived from the provided shape.  The <a class='info' href='#I-D.thomson-geopriv-uncertainty'>centroid of the geodetic shape<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Representation of Uncertainty and Confidence in PIDF-LO,&rdquo; November&nbsp;2009.</span><span>)</span></a> [I&#8209;D.thomson&#8209;geopriv&#8209;uncertainty] is used if the origin is included with uncertainty.  This reference point is used to anchor the local datum, as well as establishing the plane of the horizontal.
</p>
<a name="address"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
Origin Address</h3>

<p>A geodetic reference point provides a basis for unambiguous transformation between locations in the locally-defined CRS and WGS84.  For human consumption, <a class='info' href='#RFC5139'>civic addresses<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Revised Civic Location Format for Presence Information Data Format Location Object (PIDF-LO),&rdquo; February&nbsp;2008.</span><span>)</span></a> [RFC5139] are often more usable.
          
</p>
<p>A <tt>civicAddress</tt> element MAY be included in the <tt>address</tt> element to provide a user with more information about the reference point.  The <tt>LOC</tt> field of the civic address can be used to provide a textual description of the reference point used.
</p>
<a name="offset"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
Pixel Offset</h3>

<p>The origin point is related to a point on the image, thus establishing a common point in both coordinate reference systems.  Unless otherwise specified, the top-left corner pixel (0,0) of the image is used.  The optional <tt>offset</tt> element includes the coordinates of the reference point in the local CRS - that is, the position of the reference point on the image.
          
</p>
<a name="orientation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4"></a><h3>5.2.4.&nbsp;
Orientation</h3>

<p>Maps for use within structures are only rarely produced with geodetic North toward the top of the image.  Building maps are often oriented so that the majority of features do not appear at irregular angles on the map.  Thus, the orientation of a local datum is often rotated.
          
</p>
<p>The <tt>orientation</tt> element describes the angle between North at the reference location (see <a class='info' href='#whatsup'>Appendix&nbsp;A<span> (</span><span class='info'>Calculating WGS84 ECEF Up, North and East Vectors</span><span>)</span></a>) and the negative y-axis in the local datum.  Increasing values rotate the image in a clockwise direction as viewed from above.
          
</p>
<a name="scale"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5"></a><h3>5.2.5.&nbsp;
Scaling</h3>

<p>The <tt>scale</tt> element includes a value in pixels per meter that describes how coordinates in the local datum, specified in pixels, are translated to coordinates in meters.
          
</p>
<p>A scaling factor must be provided for each axis in the coordinate system.  For a two-dimensional coordinate system, two values can be included to allow for different scaling along the x- and y-axis independently.  For a three-dimensional coordinate system, three values can be specified for the x-, y- and z-axes.
          
</p>
<p>Alternatively, a single scaling value can be used to apply the same scaling factor to all coordinate components (x- and y-axes, and optionally the z-axis).
          
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5.1"></a><h3>5.2.5.1.&nbsp;
Implications of Scaling</h3>

<p>A means is provided for the image-based coordinate system to have different scaling factors along each axis.  While this provides for greater flexibility in accomodating images with varying aspect ratios, it also causes skewing of angles and distances.
            
</p>
<p>A consequence of this is that the unit of measure defined in this document - pixels - is context dependent.  Values in pixels can only be reliably applied along the axis upon which they were designed.  Therefore, distances are better expressed using meters.
            
</p>
<p>Distances cannot be calculated using the image-based coordinates directly unless the same scaling value is used on all axes.  Individual components MUST first be converted to meters before any calculations are performed.  This ensures that any resulting distances derived from these coordinates are correct.
            </p>
<blockquote class="text">
<p>For instance, given scaling of (4, 5), the distance between (4, 12) and (9, 24) cannot be said to be 13 pixels because the values along the x-axis are a different unit to the values along the y-axis.  To calculate a distance, the two points are first converted to coordinates in meters: (1, 2.4) and (1.25, 4.8).  Then the distance can be calculated as 2.413 meters.
              
</p>
</blockquote><p>
            
</p>
<p>Similarly, the azimuth of a vector cannot be directly determined using the components of the vector as express in pixels.  Conversion of each component to meters is required.
            
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5.2"></a><h3>5.2.5.2.&nbsp;
Other Applications of Scaling</h3>

<p>Local policy can dictate that coordinates are expressed in meters (or some other commonly used local distance measure).  Because the pixel measure is context-dependent, its definition can be aligned with any measure type for local applications.  In this way, the CRS definition is applied as an <a class='info' href='#OGC.GML-3.1.1'>engineering CRS<span> (</span><span class='info'>Cox, S., Daisey, P., Lake, R., Portele, C., and A. Whiteside, &ldquo;Geographic information - Geography Markup Language (GML),&rdquo; April&nbsp;2004.</span><span>)</span></a> [OGC.GML&#8209;3.1.1], without relying on a strict definition.
            
</p>
<p>In this case, scaling is used so that coordinates in pixels correspond to some other measure.  In this case, a single scaling value ensures that the local measure is consistent across axes.   An image reference SHOULD NOT be included to avoid any use of coordinates in relation to the image.
            
</p>
<p>Distance measures are still provided in meters to ensure that clients outside the local context can make use of the information.
            
</p>
<a name="image"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.6"></a><h3>5.2.6.&nbsp;
Map Image</h3>

<p>The optional <tt>image</tt> element includes an image, usually a map of the locality.  This image might be used to display the associated location information to a user.
          
</p>
<p>Rather than include an image inline, this uses <a class='info' href='#W3C.REC-xlink-20010627'>XLink<span> (</span><span class='info'>DeRose, S., Orchard, D., and E. Maler, &ldquo;XML Linking Language (XLink) Version 1.0,&rdquo; June&nbsp;2001.</span><span>)</span></a> [W3C.REC&#8209;xlink&#8209;20010627] to reference an image document.  The <tt>xlink:href</tt> attribute contains a URL for the image.  An <tt>http:</tt> or <tt>https:</tt> URI MUST be used unless the location generator is able to ensure that authorized recipients of this data are able to use other information.
          
</p>
<a name="pixelInCell"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.7"></a><h3>5.2.7.&nbsp;
Pixel-Coordinate Relation</h3>

<p>GML defines the <tt>pixelInCell</tt> element for image datums, allowing for fact that pixels have area.  Whole integer values for coordinates can be anchored to any point in the rectangular area defined by a single pixel.  The <tt>pixelInCell</tt> value determines where in an individual pixel coordinates with whole integer values lie.
          
</p>
<p>This document uses a single value for <tt>pixelInCell</tt>.  The value <tt>cellCenter</tt>, which is defined to be in the code space <tt>urn:ogc:def:pixelInCell:OGC:1.0:</tt> (see <a class='info' href='#OGC.ImageCRS'>[OGC.ImageCRS]<span> (</span><span class='info'>Whiteside, A., &ldquo;Recommended XML/GML 3.1.1 encoding of image CRS definitions,&rdquo; April&nbsp;2005.</span><span>)</span></a>) indicates that whole integer values for coordinates are found in the precise center of a pixel.
          
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Considerations for Shape Representation</h3>

<p>The set of shapes defined in <a class='info' href='#OGC.GeoShape'>[OGC.GeoShape]<span> (</span><span class='info'>Thomson, M. and C. Reed, &ldquo;GML 3.1.1 PIDF-LO Shape Application Schema for use by the Internet Engineering Task Force (IETF),&rdquo; April&nbsp;2007.</span><span>)</span></a> can be used with the indoor CRS defined using these guidelines.
      
</p>
<a name="z-axis"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Z-Axis Inversion</h3>

<p>The consequence of this inversion is that the upward normal of a <a class='info' href='#OGC.GeoShape'>geodetic shape<span> (</span><span class='info'>Thomson, M. and C. Reed, &ldquo;GML 3.1.1 PIDF-LO Shape Application Schema for use by the Internet Engineering Task Force (IETF),&rdquo; April&nbsp;2007.</span><span>)</span></a> [OGC.GeoShape] needs to be inverted to ensure that the resulting volume matches expectations (that is, upward normals are still required to point in a direction that matches expectations of "up").
        
</p>
<p>In practice, this does not require any changes to shape definitions.  A Polygon is still specified in an anti-clockwise direction as viewed from above.  However, the upward normal vector will have a negative inner product with the z-axis of the modified space.
        
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Distances</h3>

<p>Distances, such as radii or the semi-major and semi-minor axes of an ellipse, are represented in meters in the local system.  The pixels unit cannot be used for distance measures.
        
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Angles of Orientation</h3>

<p>Angles of orientation in the image datum are measured from the negative y-axis (the line pointing to the top of an image), consistent with the way that North is represented in images.  Thus, an angle of 0 degrees indicates a direction along the negative y-axis; an angle of 90 degrees indicates a direction along the positive x-axis.
        
</p>
<a name="transform"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Coordinate Transformation</h3>

<p>It is often important that location information be provided that can be used in a global context, as well as the local context.  To that end, a means is provided to provide information necessary to transform shapes between the WGS84 CRS and the local CRS.
      
</p>
<p>A single point is selected in the image coordinate reference system.  This might be the origin of the image (0, 0), or any other point.  The corresponding point in WGS84 (latitude, longitude, altitude) is also identified.
      
</p>
<p>Selecting a point in each coordinate system establishes a reference point: an origin point.  When converting, all coordinates are expressed relative to the corresponding point in the same coordinate system.
      
</p>
<p>The WGS84 origin point also establishes a reference plane for the image.  The reference plane is the plane of the horizontal at that point - the plane tangential to the WGS84 ellipsoid at the reference point.  This plane, along with the orientation angle, are used to create a transformation matrix.
      
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Conversion from WGS84 to Local CRS</h3>

<p>To convert coordinates specified in WGS84 to coordinates specified in the local CRS use the following algorithm:

        </p>
<ol class="text">
<li>If the coordinates do not include altitude, add an altitude of zero.  This will be removed from the final result, but an altitude value is required for this algorithm.
          
</li>
<li>Convert the WGS84 (latitude, longitude, altitude) coordinates to WGS84 ECEF (X, Y, Z) values.  One commonly used algorithm for this is documented in <a class='info' href='#I-D.thomson-geopriv-uncertainty'>[I&#8209;D.thomson&#8209;geopriv&#8209;uncertainty]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Representation of Uncertainty and Confidence in PIDF-LO,&rdquo; November&nbsp;2009.</span><span>)</span></a>.
          
</li>
<li>If necessary, find the centroid of the reference location, specified in the <tt>origin</tt> element, in WGS84 ECEF (X, Y, Z) coordinates.  Algorithms for this are documented in <a class='info' href='#I-D.thomson-geopriv-uncertainty'>[I&#8209;D.thomson&#8209;geopriv&#8209;uncertainty]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Representation of Uncertainty and Confidence in PIDF-LO,&rdquo; November&nbsp;2009.</span><span>)</span></a>.
          
</li>
<li>Subtract the ECEF reference location from the ECEF coordinates to get a relative position vector for the coordinates.
          
</li>
<li>Multiply the resulting relative position by the forward transformation matrix described in <a class='info' href='#matrix'>Section&nbsp;7.3<span> (</span><span class='info'>Transformation Matrix</span><span>)</span></a>.  This gives distances in meters for each of the axes of the image coordinate system.
          
</li>
<li>Multiply each component of the vector by the scaling factor, specified in the <tt>scale</tt> element, to obtain values in pixels.
          
</li>
<li>Add the resulting value to the image offset, specified in the <tt>offset</tt> element, to obtain the coordinates in the local CRS.
          
</li>
<li>If altitude was not originally provided, remove any vertical or z-axis component.
          
</li>
<li>If the reference location contains uncertainty, add this uncertainty to any uncertainty in the original location, see <a class='info' href='#extraunc'>Section&nbsp;7.6<span> (</span><span class='info'>Managing Uncertainty</span><span>)</span></a>.
          
</li>
</ol><p>
        
</p>
<p>The results can be summarized as:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   C[local] = offset + scale .* R * T[0] * (C[ecef] - R[ecef])
</pre></div>
<p>Where all coordinates are expressed as column vectors, <tt>*</tt> is the matrix product and <tt>.*</tt> is the Hadamard or entrywise product.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Conversion from Local CRS to WGS</h3>

<p>To convert coordinates specified in the local CRS to coordinates specified in WGS84 use the following algorithm:

        </p>
<ol class="text">
<li>If the coordinates do not include a vertical or z-axis component, set this value to zero.
          
</li>
<li>Subtract the image offset from the coordinate values.
          
</li>
<li>Divide each component of the vector by the scaling factor.
          
</li>
<li>Multiply the resulting relative position by the reverse transformation matrix described in <a class='info' href='#matrix'>Section&nbsp;7.3<span> (</span><span class='info'>Transformation Matrix</span><span>)</span></a> to get a vector relative to the reference location.
          
</li>
<li>If necessary, find the centroid of the reference location, <tt>origin</tt>, in WGS84 ECEF (X, Y, Z) coordinates.
          
</li>
<li>Add the ECEF reference location to the ECEF coordinates.
          
</li>
<li>Convert the WGS84 ECEF (X, Y, Z) coordinates to WGS84 (latitude, longitude, altitude) values.
          
</li>
<li>If vertical or z-axis values were not provided, remove the altitude value.
          
</li>
<li>If the reference location contains uncertainty, add this uncertainty to any uncertainty in the original location.
          
</li>
</ol><p>
        
</p>
<p>The results can be summarized as:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   C[ecef] = (1/scale) .* transpose(R * T[0]) * (C[local] - offset)
               + R[ecef]
</pre></div>
<p>Where <tt>transpose(...)</tt> signifies the matrix transpose and <tt>1/scale</tt> is 1 divided by the scaling factor.
</p>
<a name="matrix"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Transformation Matrix</h3>

<p>The transformation matrix used to convert coordinates between WGS84 and the local CRS uses the centroid of the origin location, contained in the <tt>origin</tt> element.
        
</p>
<p>The transformation matrix is formed from the North, East and Up vectors from the origin location.  <a class='info' href='#whatsup'>Appendix&nbsp;A<span> (</span><span class='info'>Calculating WGS84 ECEF Up, North and East Vectors</span><span>)</span></a> describes how to determine these vectors in WGS84 ECEF coordinates:
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   East  = [ -sinlng          ; coslng           ; 0      ]
   North = [ -sinlat * coslng ; -sinlat * sinlng ; coslat ]
   Up    = [ coslat * coslng  ; coslat * sinlng  ; sinlat ]
</pre></div>
<p>Without rotation, the x-axis of the coordinate system corresponds to East, the y-axis corresponds to the negative North vector and the z-axis corresponds to the negative Up vector.  This gives the following transformation matrix for the case where the orientation is zero:
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          [ -sinlng          ; coslng           ; 0       ]
   T[0] = [ sinlat * coslng  ; sinlat * sinlng  ; -coslat ]
          [ -coslat * coslng ; -coslat * sinlng ; -sinlat ]
</pre></div>
<p>The orientation of the map, included in the <tt>orientation</tt> element, affects the x-axis and y-axis parts of this matrix.  The rotation matrix is a counter-clockwise rotation matrix, as follows:
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
       [ cos(orientation) ; -sin(orientation) ; 0 ]
   R = [ sin(orientation) ; cos(orientation)  ; 0 ]
       [ 0                ; 0                 ; 1 ]
</pre></div>
<p>Both <tt>R</tt> and <tt>T[0]</tt> perform rotations.  The final transformation matrix is then the product of the rotation matrix and the coordinate transformation matrix.  This gives the following orthonormal coordinate transformation matrix.
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   T = R * T[0]
</pre></div>
<p>When transforming from local coordinates to WGS84, the transformation matrix is transposed to find its inverse.
        
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Polygons and Prisms</h3>

<p>Each point in a Polygon or Prism is transformed independently using the same process.  The transformation process causes the direction of the points to be reversed.  Therefore, no additional steps are required to ensure the correct orientation of the upward normal a Polygon or Prism.
        
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
Angles of Orientation</h3>

<p>Translation of Ellipse, Ellipsoid and ArcBand shapes requires that the included angle measures are rotated.  When translating from the local coordinate reference system, the orientation of the image datum is added to the angle.  The orientation of the image datum is subtracted when translating from WGS84 coordinates.
        
</p>
<a name="extraunc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6"></a><h3>7.6.&nbsp;
Managing Uncertainty</h3>

<p>The WGS84 origin location MAY include uncertainty if that location is not sufficiently accurate.  In this case, the centroid of the uncertainty region is used as the origin point.  The uncertainty in this location increases any uncertainty when performing a transformation.
        
</p>
<p>An increase to uncertainty is applied when transforming both to and from WGS84.  Repeated transformations can increase uncertainty indefinitely.
        
</p>
<p>Converting the origin location and the target shape to a Circle or Sphere prior to transformation simplifies the management of uncertainty.  The resulting uncertainty radius is the sum of the radius from the original shape, plus the radius from the origin location.
        
</p>
<a name="example"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Example PIDF-LO</h3>

<p>The following example PIDF-LO document contains geodetic location in the first tuple, followed by a similar location in the local CRS.  All optional elements are included in this example.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;presence xmlns="urn:ietf:params:xml:ns:pidf"
            xmlns:gml="http://www.opengis.net/gml"
            xmlns:gs="http://www.opengis.net/pidflo/1.0"
            xmlns:gp="urn:ietf:params:xml:ns:pidf:geopriv10"
            xmlns:xlink="http://www.w3.org/1999/xlink"
            entity="pres:ae3be8585902e2253ce2@lis.example"&gt;

    &lt;tuple id="geodeticLocation"&gt;
      &lt;status&gt;
        &lt;gp:geopriv&gt;
          &lt;gp:location-info&gt;
            &lt;gs:Circle srsName="urn:ogc:def:crs:EPSG::4326"&gt;
              &lt;gml:pos&gt;-34.407124 150.882673&lt;/gml:pos&gt;
              &lt;gs:radius uom="urn:ogc:def:uom:EPSG::9001"&gt;3
              &lt;/gs:radius&gt;
            &lt;/gs:Circle&gt;
          &lt;/gp:location-info&gt;
          &lt;gp:usage-rules/&gt;
        &lt;/gp:geopriv&gt;
      &lt;/status&gt;
    &lt;/tuple&gt;

    &lt;tuple id="indoorLocation"&gt;
      &lt;status&gt;
        &lt;gp:geopriv&gt;
          &lt;gp:location-info&gt;
            &lt;gs:Circle srsName="#officeCRS"&gt;
              &lt;gml:pos&gt;47.5 22&lt;/gml:pos&gt;
              &lt;gs:radius uom="urn:indoor:dict#pixels"&gt;30
              &lt;/gs:radius&gt;
            &lt;/gs:Circle&gt;

            &lt;gml:ImageCRS gml:id="officeCRS"&gt;
              &lt;gml:srsName codeSpace="#"&gt;#officeCRS&lt;/gml:srsName&gt;
              &lt;gml:usesCartesianCS
  xlink:href="urn:ietf:params:xml:schema:geopriv:indoor#i2d"/&gt;
              &lt;gml:usesImageDatum&gt;
                &lt;indoor:IndoorDatum gml:id="officeDatum"
  xmlns:indoor="urn:ietf:params:xml:ns:geopriv:indoor"&gt;
                  &lt;gml:datumName
                      codeSpace="#"&gt;#officeDatum&lt;/gml:datumName&gt;
                  &lt;gml:pixelInCell
                      codeSpace="urn:ogc:def:pixelInCell:OGC:1.0:"
                      &gt;cellCenter&lt;/gml:pixelInCell&gt;
                  &lt;indoor:origin&gt;
                    &lt;gs:Circle srsName="urn:ogc:def:crs:EPSG::4326"&gt;
                      &lt;gml:pos&gt;-34.407168 150.882533&lt;/gml:pos&gt;
                      &lt;gs:radius uom="urn:ogc:def:uom:EPSG::9001"&gt;5
                      &lt;/gs:radius&gt;
                    &lt;/gs:Circle&gt;
                  &lt;/indoor:origin&gt;
                  &lt;indoor:address&gt;
                    &lt;ca:civicAddress xml:lang="en"
  xmlns:ca="urn:ietf:params:xml:ns:pidf:geopriv10:civicAddr"&gt;
                      &lt;ca:country&gt;AU&lt;/ca:country&gt;
                      &lt;ca:A1&gt;NSW&lt;/ca:A1&gt;
                      &lt;ca:A3&gt;Wollongong&lt;/ca:A3&gt;
                      &lt;ca:A4&gt;Gwynneville&lt;/ca:A4&gt;
                      &lt;ca:RD&gt;Northfields&lt;/ca:RD&gt;
                      &lt;ca:STS&gt;Avenue&lt;/ca:STS&gt;
                      &lt;ca:LMK&gt;University of Wollongong&lt;/ca:LMK&gt;
                      &lt;ca:LOC&gt;Director's Office&lt;/ca:LOC&gt;
                      &lt;ca:FLR&gt;2&lt;/ca:FLR&gt;
                      &lt;ca:NAM&gt;Andrew Corporation&lt;/ca:NAM&gt;
                      &lt;ca:PC&gt;2500&lt;/ca:PC&gt;
                      &lt;ca:BLD&gt;39&lt;/ca:BLD&gt;
                      &lt;ca:PLC&gt;office&lt;/ca:PLC&gt;
                    &lt;/ca:civicAddress&gt;
                  &lt;/indoor:address&gt;
                  &lt;indoor:offset
  uom="urn:ietf:params:xml:schema:geopriv:indoor#px"&gt;374 184
                  &lt;/indoor:offset&gt;
                  &lt;indoor:orientation
                      uom="urn:ogc:def:uom:EPSG::9102"&gt;8.4
                  &lt;/indoor:orientation&gt;
                  &lt;indoor:scale
  uom="urn:ietf:params:xml:schema:geopriv:indoor#pxpm"&gt;20
                  &lt;/indoor:scale&gt;
                  &lt;indoor:image
                      xlink:href="http://example/floorplan.png"/&gt;
                &lt;/indoor:IndoorDatum&gt;
              &lt;/gml:usesImageDatum&gt;
            &lt;/gml:ImageCRS&gt;
          &lt;/gp:location-info&gt;
          &lt;gp:usage-rules/&gt;
          &lt;gp:method&gt;RSSI-RTT&lt;/gp:method&gt;
        &lt;/gp:geopriv&gt;
      &lt;/status&gt;
    &lt;/tuple&gt;
  &lt;/presence&gt;
</pre></div>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
GML Definitions</h3>

<p>Formal GML definitions a coordinate reference system are provided in the PIDF-LO.  However, these definitions rely on the definitions in this document, plus the formal GML definitions included in <a class='info' href='#schema'>the schema<span> (</span><span class='info'>XML Schema</span><span>)</span></a>.
      
</p>
<p>This section provides references to definitions of the various code points used in the formal definitions.
      
</p>
<a name="uom"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Units of Measure</h3>

<p>This document uses the same restricted set of units of measure as defined in <a class='info' href='#RFC5491'>[RFC5491]<span> (</span><span class='info'>Winterbottom, J., Thomson, M., and H. Tschofenig, &ldquo;GEOPRIV Presence Information Data Format Location Object (PIDF-LO) Usage Clarification, Considerations, and Recommendations,&rdquo; March&nbsp;2009.</span><span>)</span></a>, with additions for the local CRS.
        
</p>
<p>The units for meters (urn:ogc:def:uom:EPSG::9001), degrees (urn:ogc:def:uom:EPSG::9102) and radians (urn:ogc:def:uom:EPSG::9101) are used where applicable.  Meters are used for all distance measures.  Degrees or radians are used for all angular measures.
        
</p>
<p>Additional units of measure are defined for pixels (urn:ietf:params:xml:schema:geopriv:indoor#px) and pixels per meter (urn:ietf:params:xml:schema:geopriv:indoor#pxpm).  Formal definitions of these units are included in an annotation to the XML schema.  Pixels are used to describe coordinates in the local datum.  Pixels per meter are used to establish a scale for conversion between meters (used in WGS84) and pixels (used in the local CRS).
        
</p>
<p>A pixel is nominally a length measure in this definition.  However, this definition does not relate the measure to any other form of length measure.  The pixel measure is context-dependent and can be related to other length measures by different factors.  The <a class='info' href='#scale'>scaling<span> (</span><span class='info'>Scaling</span><span>)</span></a> parameters of the datum establish how pixels relate to other measures, such as meters.
        
</p>
<a name="codeSpace"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Code Space Definitions</h3>

<p>The GML definitions for the local coordinate system rely on identifiers that are defined in the <tt>http://ietf.org/rfc/rfcXXXX.txt</tt> (the URL of this document [[EDITOR NOTE: Please update this link at publication]]).  These identifiers are defined thus:
        </p>
<blockquote class="text"><dl>
<dt>ix</dt>
<dd>The x-axis of the image-based coordinate system.
          
</dd>
<dt>iy</dt>
<dd>The y-axis of the image-based coordinate system.
          
</dd>
<dt>iz</dt>
<dd>The z-axis of the image-based coordinate system.
          
</dd>
<dt>east+o</dt>
<dd>East from the reference point, rotated clockwise (about the Up vector) by the orientation angle, see <a class='info' href='#whatsup'>Appendix&nbsp;A<span> (</span><span class='info'>Calculating WGS84 ECEF Up, North and East Vectors</span><span>)</span></a> and <a class='info' href='#matrix'>Section&nbsp;7.3<span> (</span><span class='info'>Transformation Matrix</span><span>)</span></a>.
          
</dd>
<dt>south+o</dt>
<dd>South from the reference point, rotated clockwise (about the Up vector) by the orientation angle, see <a class='info' href='#whatsup'>Appendix&nbsp;A<span> (</span><span class='info'>Calculating WGS84 ECEF Up, North and East Vectors</span><span>)</span></a> and <a class='info' href='#matrix'>Section&nbsp;7.3<span> (</span><span class='info'>Transformation Matrix</span><span>)</span></a>.
          
</dd>
<dt>down</dt>
<dd>Down from the reference point, see <a class='info' href='#whatsup'>Appendix&nbsp;A<span> (</span><span class='info'>Calculating WGS84 ECEF Up, North and East Vectors</span><span>)</span></a> and <a class='info' href='#matrix'>Section&nbsp;7.3<span> (</span><span class='info'>Transformation Matrix</span><span>)</span></a>.
          
</dd>
<dt>pixel</dt>
<dd>The name for the pixels unit of measure, see <a class='info' href='#uom'>Section&nbsp;9.1<span> (</span><span class='info'>Units of Measure</span><span>)</span></a>.
          
</dd>
<dt>px</dt>
<dd>The abbreviated name for the pixels unit of measure.
          
</dd>
<dt>pixels per metre</dt>
<dd>The English name for the pixels per meter unit of measure, using the standard spelling, see <a class='info' href='#uom'>Section&nbsp;9.1<span> (</span><span class='info'>Units of Measure</span><span>)</span></a>.
          
</dd>
<dt>pixels per meter</dt>
<dd>The US English name for the pixels per meter unit of measure.
          
</dd>
<dt>pxpm</dt>
<dd>The abbreviated name for the pixels per meter unit of measure.
          
</dd>
</dl></blockquote><p>
        
</p>
<p>Documents created by this document will use a document-local code space, signified by use of the URI fragment: <tt>#</tt>.
        
</p>
<a name="schema"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
XML Schema</h3>

<p>The XML schema for the indoor location elements also includes a definition of the 2-dimensional and 3-dimensional image-based coordinate systems and units of measure used in definitions of coordinate reference systems.
      </p>
<blockquote class="text">
<p>To identify the elements that are defined in this schema, a URI is used.  This document is not identified by a URL, instead it uses the URN that is registered for identification of the schema <tt>urn:ietf:params:xml:schema:geopriv:indoor</tt>.
</p>
</blockquote><p>
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version="1.0"?&gt;
&lt;xs:schema
    xmlns:in="urn:ietf:params:xml:ns:geopriv:indoor"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:gml="http://www.opengis.net/gml"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    xmlns:ca="urn:ietf:params:xml:ns:pidf:geopriv10:civicAddr"
    targetNamespace="urn:ietf:params:xml:ns:geopriv:indoor"
    elementFormDefault="qualified"
    attributeFormDefault="unqualified"&gt;

  &lt;!-- [[NOTE TO RFC-EDITOR: Please replace all instances of the URL
       'http://ietf.org/rfc/rfcXXXX.txt' with the URL of published
       document and remove this note.]] --&gt;

  &lt;xs:annotation&gt;
    &lt;xs:appinfo
        source="urn:ietf:params:xml:schema:geopriv:indoor"&gt;
      Indoor Location for PIDF-LO

      &lt;!-- These definitions use the code-space definition
           'http://ietf.org/rfc/rfcXXXX.txt' --&gt;
      &lt;gml:Dictionary gml:id="defs"&gt;
        &lt;gml:description&gt;
          A dictionary including a Cartesian Coordinate System and
          units of measure for a system of indoor location.
        &lt;/gml:description&gt;
        &lt;gml:name&gt;Indoor Location&lt;/gml:name&gt;

        &lt;!-- urn:ietf:params:xml:schema:geopriv:indoor#i3d --&gt;
        &lt;gml:dictionaryEntry&gt;
          &lt;gml:CartesianCS gml:id="i3d"&gt;
            &lt;gml:usesAxis&gt;
              &lt;gml:CoordinateSystemAxis uom="#px"&gt;
                &lt;gml:axisAbbrev
                    codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                    &gt;x&lt;/gml:axisAbbrev&gt;
                &lt;gml:axisDirection
                    codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                    &gt;east+o&lt;/gml:axisDirection&gt;
              &lt;/gml:CoordinateSystemAxis&gt;
            &lt;/gml:usesAxis&gt;
            &lt;gml:usesAxis&gt;
              &lt;gml:CoordinateSystemAxis uom="#px"&gt;
                &lt;gml:axisAbbrev
                    codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                    &gt;y&lt;/gml:axisAbbrev&gt;
                &lt;gml:axisDirection
                    codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                    &gt;south-o&lt;/gml:axisDirection&gt;
              &lt;/gml:CoordinateSystemAxis&gt;
            &lt;/gml:usesAxis&gt;
            &lt;gml:usesAxis&gt;
              &lt;gml:CoordinateSystemAxis uom="#px"&gt;
                &lt;gml:axisAbbrev
                    codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                    &gt;z&lt;/gml:axisAbbrev&gt;
                &lt;gml:axisDirection
                    codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                    &gt;down&lt;/gml:axisDirection&gt;
              &lt;/gml:CoordinateSystemAxis&gt;
            &lt;/gml:usesAxis&gt;
          &lt;/gml:CartesianCS&gt;
        &lt;/gml:dictionaryEntry&gt;

        &lt;!-- urn:ietf:params:xml:schema:geopriv:indoor#i2d --&gt;
        &lt;gml:dictionaryEntry&gt;
          &lt;gml:CartesianCS gml:id="i2d"&gt;
            &lt;gml:usesAxis&gt;
              &lt;gml:CoordinateSystemAxis uom="#px"&gt;
                &lt;gml:axisAbbrev
                    codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                    &gt;x&lt;/gml:axisAbbrev&gt;
                &lt;gml:axisDirection
                    codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                    &gt;east+o&lt;/gml:axisDirection&gt;
              &lt;/gml:CoordinateSystemAxis&gt;
            &lt;/gml:usesAxis&gt;
            &lt;gml:usesAxis&gt;
              &lt;gml:CoordinateSystemAxis uom="#px"&gt;
                &lt;gml:axisAbbrev
                    codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                    &gt;y&lt;/gml:axisAbbrev&gt;
                &lt;gml:axisDirection
                    codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                    &gt;south-o&lt;/gml:axisDirection&gt;
              &lt;/gml:CoordinateSystemAxis&gt;
            &lt;/gml:usesAxis&gt;
          &lt;/gml:CartesianCS&gt;
        &lt;/gml:dictionaryEntry&gt;

        &lt;!-- urn:ietf:params:xml:schema:geopriv:indoor#px --&gt;
        &lt;gml:dictionaryEntry&gt;
          &lt;gml:BaseUnit gml:id="px"&gt;
            &lt;gml:description&gt;
              The pixel is the basic unit of measure used in images.
            &lt;/gml:description&gt;
            &lt;gml:name codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                      &gt;pixel&lt;/gml:name&gt;
            &lt;gml:quantityType&gt;image quanta&lt;/gml:quantityType&gt;
            &lt;gml:catalogSymbol
                codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                &gt;px&lt;/gml:catalogSymbol&gt;
            &lt;gml:unitsSystem
                xlink:href="http://ietf.org/rfc/rfcXXXX.txt"/&gt;
          &lt;/gml:BaseUnit&gt;
        &lt;/gml:dictionaryEntry&gt;

        &lt;!-- urn:ietf:params:xml:schema:geopriv:indoor#ppm --&gt;
        &lt;gml:dictionaryEntry&gt;
          &lt;gml:DerivedUnit gml:id="pxpm"&gt;
            &lt;gml:description&gt;
              A mapping of length in pixels to a length in metres.
            &lt;/gml:description&gt;
            &lt;gml:name codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                      &gt;pixels per metre&lt;/gml:name&gt;
            &lt;gml:name codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                      xml:lang="en-US"&gt;pixels per meter&lt;/gml:name&gt;
            &lt;gml:quantityType&gt;
              mapping of pixels to length
            &lt;/gml:quantityType&gt;
            &lt;gml:catalogSymbol
                codeSpace="http://ietf.org/rfc/rfcXXXX.txt"
                &gt;pxpm&lt;/gml:catalogSymbol&gt;
            &lt;gml:derivationUnitTerm uom="#px" exponent="1"/&gt;
            &lt;gml:derivationUnitTerm uom="urn:ogc:def:uom:EPSG::9001"
                                    exponent="-1"/&gt;
          &lt;/gml:DerivedUnit&gt;
        &lt;/gml:dictionaryEntry&gt;
      &lt;/gml:Dictionary&gt;
    &lt;/xs:appinfo&gt;

    &lt;xs:documentation source="http://ietf.org/rfc/rfcXXXX.txt"&gt;
      This schema defines a location representation that allows for
      the trivial creation of a locally-defined coordinate reference
      system; specifically one that is based on a local map image.
    &lt;/xs:documentation&gt;

  &lt;/xs:annotation&gt;

  &lt;xs:import namespace="http://www.opengis.net/gml"/&gt;
  &lt;xs:import namespace="http://www.w3.org/1999/xlink"/&gt;
  &lt;xs:import
      namespace="urn:ietf:params:xml:ns:pidf:geopriv10:civicAddr"/&gt;

  &lt;xs:element name="IndoorDatum" type="in:IndoorDatumType"
              substitutionGroup="gml:ImageDatum"/&gt;

  &lt;xs:complexType name="IndoorDatumType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="gml:ImageDatumType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="origin"
                      type="gml:GeometryPropertyType"/&gt;
          &lt;xs:element name="address"
                      type="in:addressType" minOccurs="0"/&gt;
          &lt;xs:element name="offset"
                      type="gml:MeasureListType" minOccurs="0"/&gt;
          &lt;xs:element name="orientation"
                      type="gml:AngleType"/&gt;
          &lt;xs:sequence minOccurs="0"&gt;
            &lt;xs:element name="scale"
                        type="gml:MeasureListType"/&gt;
            &lt;xs:element name="image"
                        type="in:linkType" minOccurs="0"/&gt;
          &lt;/xs:sequence&gt;
          &lt;xs:any namespace="##other" processContents="lax"
                  minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:anyAttribute namespace="##other" processContents="lax"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name="linkType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:restriction base="xs:anyType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:any namespace="##other" processContents="lax"
                  minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attributeGroup ref="xlink:simpleLink"/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name="addressType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:restriction base="xs:anyType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element ref="ca:civicAddress"/&gt;
        &lt;/xs:sequence&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Security Considerations</h3>

<p>This document describes information that is intended for inclusion within a location object, specifically a PIDF-LO.  The security concerns relating to the use of a location object are described in <a class='info' href='#RFC4119'>[RFC4119]<span> (</span><span class='info'>Peterson, J., &ldquo;A Presence-based GEOPRIV Location Object Format,&rdquo; December&nbsp;2005.</span><span>)</span></a>.  Further security and privacy considerations are included in <a class='info' href='#I-D.ietf-geopriv-arch'>[I&#8209;D.ietf&#8209;geopriv&#8209;arch]<span> (</span><span class='info'>Barnes, R., Lepinski, M., Cooper, A., Morris, J., Tschofenig, H., and H. Schulzrinne, &ldquo;An Architecture for Location and Location Privacy in Internet Applications,&rdquo; October&nbsp;2009.</span><span>)</span></a>.  No further considerations are known to apply.
      
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
IANA Considerations</h3>

<p>This section registers a URN for the identification of XML elements for describing a local CRS, plus the schema that defines those elements.
</p>
<a name="iana-ns"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
URN Sub-Namespace Registration for 'urn:ietf:params:xml:ns:geopriv:indoor'</h3>

<p>This section registers a new XML namespace, <tt>urn:ietf:params:xml:ns:geopriv:indoor</tt>, per the guidelines in <a class='info' href='#RFC3688'>[RFC3688]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.
        </p>
<blockquote class="text">
<p>URI: urn:ietf:params:xml:ns:geopriv:indoor
</p>
<p>Registrant Contact: IETF, GEOPRIV working group, (geopriv@ietf.org), Martin Thomson (martin.thomson@andrew.com).
</p>
<p>XML: </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      BEGIN
        &lt;?xml version="1.0"?&gt;
        &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;
        &lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"&gt;
          &lt;head&gt;
            &lt;title&gt;GEOPRIV: Indoor location representation&lt;/title&gt;
          &lt;/head&gt;
          &lt;body&gt;
            &lt;h1&gt;Namespace for Indoor location representation&lt;/h1&gt;
            &lt;h2&gt;urn:ietf:params:xml:ns:geopriv:indoor&lt;/h2&gt;
    [NOTE TO IANA/RFC-EDITOR: Please replace XXXX
    with the RFC number for this specification.]
            &lt;p&gt;See RFCXXXX&lt;/p&gt;
          &lt;/body&gt;
        &lt;/html&gt;
      END
</pre></div><p>

</p>
</blockquote>

<a name="iana-schema"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
XML Schema Registration</h3>

<p>This section registers an XML schema as per the guidelines in <a class='info' href='#RFC3688'>[RFC3688]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.
        </p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:schema:geopriv:indoor
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, GEOPRIV working group, (geopriv@ietf.org), Martin Thomson (martin.thomson@andrew.com).
          
</dd>
<dt>Schema:</dt>
<dd>
            The XML for this schema can be found in <a class='info' href='#schema'>Section&nbsp;10<span> (</span><span class='info'>XML Schema</span><span>)</span></a> of this document starting with <tt>&lt;xs:schema</tt> and ending with <tt>&lt;/xs:schema&gt;</tt>.
          
</dd>
</dl></blockquote>

<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Acknowledgements</h3>

<p>
      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4119">[RFC4119]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4119">A Presence-based GEOPRIV Location Object Format</a>,&rdquo; RFC&nbsp;4119, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4119.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5139">[RFC5139]</a></td>
<td class="author-text">Thomson, M. and J. Winterbottom, &ldquo;<a href="http://tools.ietf.org/html/rfc5139">Revised Civic Location Format for Presence Information Data Format Location Object (PIDF-LO)</a>,&rdquo; RFC&nbsp;5139, February&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5139.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5491">[RFC5491]</a></td>
<td class="author-text">Winterbottom, J., Thomson, M., and H. Tschofenig, &ldquo;<a href="http://tools.ietf.org/html/rfc5491">GEOPRIV Presence Information Data Format Location Object (PIDF-LO) Usage Clarification, Considerations, and Recommendations</a>,&rdquo; RFC&nbsp;5491, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5491.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="OGC.GeoShape">[OGC.GeoShape]</a></td>
<td class="author-text">Thomson, M. and C. Reed, &ldquo;GML 3.1.1 PIDF-LO Shape Application Schema for use by the Internet Engineering Task Force (IETF),&rdquo; OGC Best Practice&nbsp;06-142r1, Version: 1.0, April&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-xlink-20010627">[W3C.REC-xlink-20010627]</a></td>
<td class="author-text">DeRose, S., Orchard, D., and E. Maler, &ldquo;<a href="http://www.w3.org/TR/2001/REC-xlink-20010627">XML Linking Language (XLink) Version 1.0</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xlink-20010627, June&nbsp;2001 (<a href="http://www.w3.org/TR/2001/REC-xlink-20010627">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="OGC.ImageCRS">[OGC.ImageCRS]</a></td>
<td class="author-text">Whiteside, A., &ldquo;<a href="http://portal.opengeospatial.org/files/?artifact_id=10048">Recommended XML/GML 3.1.1 encoding of image CRS definitions</a>,&rdquo; OGC Recommendation Paper&nbsp;05-027r1, April&nbsp;2005.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3688">[RFC3688]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>,&rdquo; BCP&nbsp;81, RFC&nbsp;3688, January&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3688.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3986">[RFC3986]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>,&rdquo; STD&nbsp;66, RFC&nbsp;3986, January&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3986.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3986.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3986.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="OGC.GML-3.1.1">[OGC.GML-3.1.1]</a></td>
<td class="author-text">Cox, S., Daisey, P., Lake, R., Portele, C., and A. Whiteside, &ldquo;<a href="http://portal.opengeospatial.org/files/?artifact_id=4700">Geographic information - Geography Markup Language (GML)</a>,&rdquo; OpenGIS&nbsp;03-105r1, April&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-geopriv-arch">[I-D.ietf-geopriv-arch]</a></td>
<td class="author-text">Barnes, R., Lepinski, M., Cooper, A., Morris, J., Tschofenig, H., and H. Schulzrinne, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-geopriv-arch-01.txt">An Architecture for Location and Location Privacy in Internet Applications</a>,&rdquo; draft-ietf-geopriv-arch-01 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-geopriv-arch-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.thomson-geopriv-uncertainty">[I-D.thomson-geopriv-uncertainty]</a></td>
<td class="author-text">Thomson, M. and J. Winterbottom, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-thomson-geopriv-uncertainty-04.txt">Representation of Uncertainty and Confidence in PIDF-LO</a>,&rdquo; draft-thomson-geopriv-uncertainty-04 (work in progress), November&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-thomson-geopriv-uncertainty-04.txt">TXT</a>).</td></tr>
</table>

<a name="whatsup"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Calculating WGS84 ECEF Up, North and East Vectors</h3>

<p>Unit vectors corresponding to Up, North and East from a given point are used for transformation of coordinates between WGS84 and the local CRS.  These vectors are provided in the Cartesian coordinate system used by WGS84: the Earth-Centered, Earth-Fixed (ECEF) variant of WGS84 (X, Y, Z).
      
</p>
<p>These vectors change depending on location, but depend only on latitude and longitude; the altitude of the point has no affect on the vectors.
      
</p>
<p>The following values are used (where sin(x) is the sine function of x and cos(x) the cosine function): coslat = cos(latitude); sinlat = sin(latitude); coslng = cos(longitude); sinlng = sin(longitude).
      
</p>
<p>When calculating the orientation of Up, North and East vectors in Earth-Centered, Earth-Fixed (ECEF) coordinates, inverse flattening of the WGS84 ellipsoid is not considered.  These vectors are:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   East  = [ -sinlng          ; coslng           ; 0      ]
   North = [ -sinlat * coslng ; -sinlat * sinlng ; coslat ]
   Up    = [ coslat * coslng  ; coslat * sinlng  ; sinlat ]
</pre></div>
<p>These are all orthogonal unit vectors, therefore the matrix they form is also orthogonal.
</p>
<p>The Up vector plus the ECEF coordinates of a point defines the plane of the horizontal at that point:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   (x - c[x]) * Up[x] + (y - c[y]) * Up[y] + (z - c[z]) * Up[z] = 0
</pre></div>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Martin Thomson</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Andrew Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Andrew Building (39)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wollongong University Campus</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Northfields Avenue</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wollongong, NSW  2522</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">AU</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:martin.thomson@andrew.com">martin.thomson@andrew.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">James Winterbottom</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Andrew Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Andrew Building (39)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wollongong University Campus</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Northfields Avenue</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wollongong, NSW  2522</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">AU</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:james.winterbottom@andrew.com">james.winterbottom@andrew.com</a></td></tr>
</table>
</body></html>
