Internet Engineering Task Force           Mukul Goyal, Arian Durresi
INTERNET-DRAFT                            Raj Jain
draft-goyal-dpstdy-diffserv-01.txt        The Ohio State University
                                          June, 1999
                                          Expires: December, 1999

       Effect of Number of Drop Precedences in Assured Forwarding

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet- Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
        http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
         http://www.ietf.org/shadow.html.

NOTE

   This document is not to be taken as a finished product.  Some of the
   sections are rough and are included in order to obtain comments from
   the community that will benefit future iterations of this document.
   This is simply a step in the ongoing conversation about this
   document.  Finally, all the authors of this draft do not necessarily
   agree with and/or advocate all the mechanisms outlined in this
   document.

Abstract

   This informational draft presents a simulation study to compare the
   performance of two and three drop precedence levels in an Assured

Goyal, Durresi & Jain          Drop Precedence Study            [Page 1]

draft-goyal-diffserv-dpstdy-02.txt- 2 -                       June, 1999

   Forwarding traffic class for mixed TCP/UDP traffic. This is a revised
   and comprehensive version of our previous study presented at the
   March 99 IETF Meeting at Minneapolis. For this study, we consulted
   the principal authors of the Assured Forwarding Class to determine
   the parameter set and configurations under which it would be
   beneficial to have 3-drop preferences. The results presented here are
   based on 1296 simulations (different parameter/traffic pattern
   combinations). The results of the simulation study suggest that
   optimal number of drop precedence levels in a traffic class depends
   on the traffic load and amount of reserved traffic. In a mixed TCP-
   UDP traffic scenario, best performance can be achieved with either 2
   or 3 levels of drop precedence if most of the TCP packets have
   'better' drop precedence than excess UDP packets.

1. Introduction

   The Assured Forwarding PHB [juha] specifies 4 traffic classes with 3
   colors (drop precedence levels) each, in order to provide
   differentiated services to the customers on IP networks. One of the
   specified reasons for having 3 levels of drop precedence is that in
   case of mixed TCP-UDP traffic, 3 levels of drop precedence can be
   used to enforce a fair distribution of network resources among
   congestion sensitive and insensitive flows. In this study, we perform
   a wide range of simulations with 2 and 3 levels of drop precedence
   and compare their best performance for different traffic scenarios.

2. Simulation Configuration and Parameters:

   The network configuration used in the simulation study is shown in
   Figure 1. It consists of 10 customers, labeled CST_1 through CST_10.
   All customers except CST_10 carry an aggregated traffic coming from 5
   Reno TCP sources. CST_10 gets its traffic from a single UDP source
   sending data at a rate of 1.28 Mbps. All the customers belong to the
   same AF traffic class. Each customer is assigned the same amount of
   reserved (green) traffic rate (CIR). All the traffic passes through a
   traffic conditioner at the customer's site before being forwarded to
   router R_1. The traffic conditioners associated with CST_1 through
   CST_9 consist of two token buckets and mark packets on the basis of
   reserved traffic rate and a yellow traffic rate. Yellow traffic rate
   for customers CST_1 through CST_9 is same. Yellow traffic rate
   associated with CST_10 equals zero. Thus, TCP packets coming from
   CST_1 through CST_9 are marked green, yellow or red but UDP packets
   coming from CST_10 are marked either green or red. All simulation
   parameters are listed in Tables 1,2 and 3.

Goyal, Durresi & Jain          Drop Precedence Study            [Page 2]

draft-goyal-diffserv-dpstdy-02.txt- 3 -                       June, 1999

           TCP_1
           .   \
           .    ----CST_1-----------
           .   /                    |
           TCP_5                    |
                                    |
           TCP_6                    |
           .   \                    |
           .    ----CST_2--------   |
           .   /                 |  |
           TCP_10                |  |
                                 |  |                          SNK_1
           TCP_11                |  |                         /    .
           .   \                 |  |                        /     .
           .    ----CST_3-----   |  |                       /      .
           .   /              |  |  |                      /       .
           TCP_15             |  |  |                     /        .
                                 R_1 -----------------R_2          .
           .         .                                             .
           .         .           |  |                     \        .
           .         .           |  |                      \       .
           .         .           |  |                       \      .
           .         .           |  |                        \     .
                                 |  |                         \    .
           TCP_40                |  |                          SNK_46
           .   \                 |  |
           .    ----CST_9--------   |
           .   /                    |
           TCP_45                   |
                                    |
                                    |
                                    |
           UDP_46---CST_10----------

                DATA ---->                                    <----Ack

           TCP_i's are TCP Senders
           UDP_46 is the only UDP Sender
           SNK_i's are Receivers
           R_1 and R_2 are Routers
           CST_i's are customer sites with Three Color Markers

           Figure 1: Simulation Configuration

   As shown in Table 2, the simulations are repeated for four different
   values of total reserved traffic load with the purpose of observing

Goyal, Durresi & Jain          Drop Precedence Study            [Page 3]

draft-goyal-diffserv-dpstdy-02.txt- 4 -                       June, 1999

   change in the performance achieved with 2 and 3 colors with increase
   in reserved traffic load. Each customer is assigned a green packet
   rate equal to 1/10th of total reserved traffic load. Customers CST_1
   through CST_9 carrying TCP traffic are also assigned a yellow packet
   rate. This rate becomes zero for two color simulations. All the
   simulations are repeated for 2 values of yellow packet rates per
   customer - 12800 bps and 128000bps. With these values, the combined
   yellow traffic rate equals 8.5% and 85% of the link capacity. The
   yellow traffic rate is used only for generating tokens in a bucket
   and does not represent the actual load of yellow packets in the
   network.

   Router R_1 implements an RED queue [floyd] that has different drop
   thresholds and drop probabilities for packets of different colors.
   The average queue length for RED queue can be calculated based on
   total buffer occupancy and used for packets of all the colors.
   Alternately, average queue length can be calculated differently for
   different colors by counting only packets of equal or lower colors
   [ibanez]. Thus average queue for red packets will be based on buffer
   occupancy of red,yellow and green packets. Average queue for yellow
   packets will be based on buffer occupancy of yellow and green packets
   and that for green packets will be based just on the number of green
   packets in the queue. We conducted simulations with both ways of
   calculating the average queue. The observed behavior of 2 and 3
   colors was similar in both cases. In order to save space, we show
   results of only the first case where the average queue length is
   calculated based on total buffer occupancy and applies to packets of
   all colors.

   We have repeated our simulations for a wide range of drop thresholds
   and maximum drop probabilities in order to determine close to best
   performance achievable with 2 and 3 colors in a traffic class. The
   RED parameters used in these simulations are listed in Table 3.

   We have used NS simulator version 2.1b4a [NS] for these simulations.
   The code has been modified to implement the traffic conditioner and
   multi-color RED (RED_n).

Goyal, Durresi & Jain          Drop Precedence Study            [Page 4]

draft-goyal-diffserv-dpstdy-02.txt- 5 -                       June, 1999

      Table 1: Simulation Parameters Common for 2 and 3 Color Simulations

--------------------------------------------------------------------------

    Simulation Time    :           100 seconds
    TCP Window         :           64 packets
    IP Packet Size     :           576
    UDP Rate           :           1.28Mb
    Maximum queue size
    (for all queues -
     RED/DropTail)     :           60 packets

   Link between UDP_46/TCP__i's & CST__i's :

      Link Bandwidth   :           10 Mbps
      Link Delay       :           1 microsecond
      Drop Policy      :           DropTail

   Link between CST_i's & R_1 :
                           From CST_i              To CST_i
      Link Bandwidth   :   1.5 Mbps                1.5 Mbps
      Link Delay       :   5 microseconds          5 microseconds
      Drop Policy      :   DropTail(with marker)   DropTail

   Link between R_1 & R_2 :
                           From R_1                To R_1
      Link Bandwidth   :   1.5 Mbps                1.5 Mbps
      Link Delay       :   30 miliseconds          30 miliseconds
      Drop Policy      :   RED_n                   DropTail

   Link between R_2 & SNK_i's :

      Link Bandwidth   :   1.5 Mbps
      Link Delay       :   5 microseconds
      Drop Policy      :   Droptail

--------------------------------------------------------------------------

Goyal, Durresi & Jain          Drop Precedence Study            [Page 5]

draft-goyal-diffserv-dpstdy-02.txt- 6 -                       June, 1999

     Table 2: Traffic Conditioner Parameters for 2 and 3 Color Simulations

--------------------------------------------------------------------------
   Common Parameters:
   -----------------

    Reserved(Green) Traffic
    (Token Generation Rate
     for Green Bucket-CIR)  :     12800,25600,38400,76800bps Per Customer
                                  (8.5%,17%,25.6%,51.2% of Available
Bandwidth)

    Green Bucket Size       :              8 kB

    Traffic Conditioner Mode:              Color Aware

   2/3 Color-Specifc Parameters:
   ----------------------------
                           2-Color Simulations   3-Color Simulations

    Yellow Traffic
    (Token Generation Rate
     for Yellow Bucket)     :      0             12800 bps per customer
                                                   (= 8.5% of link
bandwidth)
                                                 128000 bps per customer
                                                   (= 85% of link bandwidth)

    Yellow Bucket Size      :      0             8 kB

--------------------------------------------------------------------------

Goyal, Durresi & Jain          Drop Precedence Study            [Page 6]

draft-goyal-diffserv-dpstdy-02.txt- 7 -                       June, 1999

            Table 3: RED_n Parameters for 2 and 3 Color Simulations

--------------------------------------------------------------------------
   Common Parameters:
   -----------------
    Queue Weight for Green Packets  :  0.002
    Queue Weight for Yellow Packets :  0.002
    Queue Weight for Red Packets    :  0.002

   2/3 Color Specific Parameters:
   -----------------------------
                                   2-Color Simulations   3-Color Simulations
    RED_n Thresholds               {0/60, - ,0/60}         {0/60,0/40,0/20}
    {minth_green/maxth_green,      {0/60, - ,0/40}         {0/60,0/60,0/60}
     minth_yellow/maxth_yellow,    {0/60, - ,0/20}
{40/60,20/60,0/60}
     minth_red/maxth_red}      :   {0/60, - ,0/5}
{40/60,20/60,0/20}
                                   {0/60, - ,0/10}
{40/60,20/40,0/20}
                                   {40/60, - ,0/20}
                                   {40/60, - ,0/60}
                                   {40/60, - ,0/40}
                                   {40/60, - ,20/40}
                                   {40/60, - ,20/60}
                                   {40/60, - ,0/5}
                                   {40/60, - ,0/10}

    Max Drop Probability
    {green,yellow,red}         :   {1,1,1}                 {1,1,1}
                                   {0.5,1,1}               {0.5,1,1}
                                   {0.5,1,0.5}             {0.5,0.5,1}
                                   {0.1,1,0.5}             {0.5,0.5,0.5}
                                   {0.1,1,1}               {0.1,0.5,0.5}
                                   {0.1,1,0.1}             {0.1,0.5,1}
                                                           {0.1,1,1}
                                                           {0.1,0.1,0.1}
                                                           {0.1,0.1,0.5}

--------------------------------------------------------------------------

4. Performance Metrics

   In this simulation study, our goal is to compare the best performance
   achieved by 2 and 3 colors. We have used two criteria for such a
   performance evaluation - fairness index and UDP throughput.

   For n flows sharing a link, the fairness index can be computed using
   the following formula [jain]:

   Fairness = [{sum(xi)}**2]/[n*sum(xi**2)]

Goyal, Durresi & Jain          Drop Precedence Study            [Page 7]

draft-goyal-diffserv-dpstdy-02.txt- 8 -                       June, 1999

   Where xi is the throughput of the ith flow. According to fairness
   criterion, both TCP and UDP customers should get a fair allocation of
   network resources. In other words, allocation of network resources
   should not be biased by congestion control mechanism used/not used by
   a flow.

   The other criterion for evaluating performance is how much a scheme
   can restrict UDP throughput close to its reserved rate. According to
   this criterion, the best scheme will restrict UDP throughput to its
   reserved rate while achieving fair allocation of excess resources
   among TCP flows. In our calculations with this criterion, we ignore
   the fairness among TCP sources as long as it is reasonably high. Note
   that a scheme that performs well by the fairness test may not pass
   UDP throughput criterion if the fair share of a UDP source is much
   more than its reserved bandwidth.

5. Simulation Results

   This simulation study consists of a total of 1296 simulations. In
   order to save space, we present only the most significant results.
   Tables 4 and 5 show the best results obtained by the two performance
   criteria for the case when total reserved traffic is around 8.5% of
   link capacity. For such a traffic scenario, 3 colors clearly result
   in better performance than 2 colors by both performance criteria.
   Also in both cases, best performance is achieved with high yellow
   packet rate. With low level of reserved traffic and 2 colors, excess
   TCP and UDP packets have the same color. Congestion insensitive UDP
   flow is able to grab the fair share of TCP flows that reduce their
   data rate in response to packet drop. This results in both very low
   fairness and very high UDP throughput. However, with 3 colors and
   sufficient yelow packet rate for TCP flows, there is clear
   demarkation between excess TCP and UDP packets. Harsh treatment
   applied to red UDP packets does not affect TCP flows as most of
   excess TCP packets are marked yellow. Thus, with 3 colors in this
   case, one can set RED parameters appropriately to achieve either high
   fairness or restrict UDP throughput.

Goyal, Durresi & Jain          Drop Precedence Study            [Page 8]

draft-goyal-diffserv-dpstdy-02.txt- 9 -                       June, 1999

          Table 4: Best 20 Fairness Results for Green Rate = 8.5% of 1.5Mbps
          (12800bps per customer) (+ Best 2-Color Result)

-------------------------------------------------------------------------------
   #Colors  Max_Prob    Min_Th/Max_Th    Yellow    Throughputs(bps)
Fairness
           G    Y   R   G     Y     R    Rate    UDP    Avg TCP Total

-------------------------------------------------------------------------------
   3       0.5 0.5  1   40/60 20/60 0/60  85%    175012  147111  1499012
0.9953
   3       0.1 0.5  1   40/60 20/60 0/60  85%    175012  147111  1499012
0.9953
   3       0.1 0.1  0.1 0/60  0/40  0/20  85%    90685   156436  1498605
0.9745
   3       1   1    1   40/60 20/40 0/20  85%    73359   158418  1499119
0.9705
   3       0.5 1    1   40/60 20/40 0/20  85%    73359   158418  1499119
0.9705
   3       0.1 1    1   40/60 20/40 0/20  85%    73359   158418  1499119
0.9705
   3       0.5 0.5  0.5 40/60 20/40 0/20  85%    68060   158836  1497580
0.9672
   3       0.1 0.5  0.5 40/60 20/40 0/20  85%    68060   158836  1497580
0.9672
   3       1   1    1   40/60 20/60 0/20  85%    56771   160116  1497811
0.9569
   3       0.5 1    1   40/60 20/60 0/20  85%    56771   160116  1497811
0.9569
   3       0.1 1    1   40/60 20/60 0/20  85%    56771   160116  1497811
0.9569
   3       0.5 0.5  1   40/60 20/40 0/20  85%    56771   160116  1497811
0.9569
   3       0.1 0.5  1   40/60 20/40 0/20  85%    56771   160116  1497811
0.9569
   3       0.1 0.1  0.5 0/60  0/40  0/20  85%    50043   160978  1498843
0.9507
   3       0.1 0.1  0.1 40/60 20/60 0/20  8.5%   253348  138462  1499508
0.9498
   3       0.1 0.1  0.1 40/60 20/40 0/20  8.5%   260076  137733  1499676
0.9434
   3       0.5 0.5  0.5 40/60 20/60 0/20  85%    24561   163787  1498641
0.9268
   3       0.1 0.5  0.5 40/60 20/60 0/20  85%    24561   163787  1498641
0.9268
   3       0.5 0.5  1   40/60 20/60 0/20  85%    21842   164044  1498242
0.9242
   3       0.1 0.5  1   40/60 20/60 0/20  85%    21842   164044  1498242
0.9242
   2       0.1 1    0.1 40/60  -    0/20  0%     626181  97076   1499861
0.4716

------------------------------------------------------------------------------

   Tables 6 and 7 show the best performances achieved for both
   performance criteria when total amount of reserved traffic is 17% of
   the link capacity. According to fairness criterion, in this case, 3
   colors do not perform substantially better than 2 colors. Infact,
   best fairness performance is achieved by a configuration where red
   packets get the same treatment as the yellow ones. In this case,
   reserved traffic is large enough to ensure that most of the TCP
   packets will be green. This observation is confirmed by same results
   obtained with different yellow packet rates (8.5% and 85%) and actual
   color profile of TCP packets in this configuration (not shown here).
   We expect simulation results to change if we increase the amount of
   TCP traffic entering the network so that a reserved rate of 17% is no
   longer sufficient to keep most of the packets green. Also Table 7
   shows that it is difficult to control the UDP throughput in this case
   with just 2 colors. This is because in order to control UDP
   throughput, treatment given to red packets needs to be very harsh
   (drop thresholds 0/5). Though the reserved rate is quite high, many
   of the TCP packets still overflow the bucket and get marked as red.

Goyal, Durresi & Jain          Drop Precedence Study            [Page 9]

draft-goyal-diffserv-dpstdy-02.txt- 10 -                       June, 1999

      Table 5: Best 20 UDP Control Results for Green Rate = 8.5% of 1.5Mbps
      (12800bps per customer) (+ Best 2-Color Result)

-------------------------------------------------------------------------------
   #Colors  Max_Prob    Min_Th/Max_Th    Yellow    Throughputs(bps)
Fairness
           G    Y   R   G     Y     R    Rate    UDP    Avg TCP Total

-------------------------------------------------------------------------------
   3       0.1 0.1  0.5 40/60 20/60 0/20  85%    14239   164880  1498159
0.9151
   3       0.1 0.1  0.5 40/60 20/40 0/20  85%    15160   164862  1498920
0.9173
   3       0.1 0.1  0.1 40/60 20/60 0/20  85%    16082   164791  1499202
0.9173
   3       0.1 0.1  0.1 40/60 20/40 0/20  85%    16727   164631  1498407
0.9185
   3       0.5 0.5  1   40/60 20/60 0/20  85%    21842   164044  1498242
0.9242
   3       0.1 0.5  1   40/60 20/60 0/20  85%    21842   164044  1498242
0.9242
   3       0.5 0.5  0.5 40/60 20/60 0/20  85%    24561   163787  1498641
0.9268
   3       0.1 0.5  0.5 40/60 20/60 0/20  85%    24561   163787  1498641
0.9268
   3       0.1 0.1  0.5 0/60  0/40  0/20  85%    50043   160978  1498843
0.9507
   3       1   1    1   40/60 20/60 0/20  85%    56771   160116  1497811
0.9569
   3       0.5 1    1   40/60 20/60 0/20  85%    56771   160116  1497811
0.9569
   3       0.1 1    1   40/60 20/60 0/20  85%    56771   160116  1497811
0.9569
   3       0.5 0.5  1   40/60 20/40 0/20  85%    56771   160116  1497811
0.9569
   3       0.1 0.5  1   40/60 20/40 0/20  85%    56771   160116  1497811
0.9569
   3       0.5 0.5  0.5 40/60 20/40 0/20  85%    68060   158836  1497580
0.9672
   3       0.1 0.5  0.5 40/60 20/40 0/20  85%    68060   158836  1497580
0.9672
   3       1   1    1   40/60 20/40 0/20  85%    73359   158418  1499119
0.9705
   3       0.5 1    1   40/60 20/40 0/20  85%    73359   158418  1499119
0.9705
   3       0.1 1    1   40/60 20/40 0/20  85%    73359   158418  1499119
0.9705
   3       0.1 0.1  0.1 0/60  0/40  0/20  85%    90685   156436  1498605
0.9745
   2       0.1 1    0.1 40/60  -    0/20  0%     626181  97076   1499861
0.4716

------------------------------------------------------------------------------

   Thus harsh treatment applied to red UDP packets also affects TCP
   flows as they reduce their data rate in response to packet drops.
   Reduced data rate of TCP flows enables UDP to grab much more than its
   fair share of network resources even with very harsh RED parameters.
   However, with 3 colors and appropriate RED parameters, the UDP
   throughput can be restricted to a rate very close to its reserved
   rate.

Goyal, Durresi & Jain          Drop Precedence Study           [Page 10]

draft-goyal-diffserv-dpstdy-02.txt- 11 -                       June, 1999

          Table 6: Best 20 Fairness Results for Green Rate = 17% of 1.5Mbps
          (25600bps per customer)

-------------------------------------------------------------------------------
   #Colors  Max_Prob    Min_Th/Max_Th    Yellow    Throughputs(bps)
Fairness
           G    Y   R   G     Y     R    Rate    UDP    Avg TCP Total

-------------------------------------------------------------------------------
   3       0.1 0.5  0.5 0/60  0/60  0/60  8.5%   202291  144018  1498451
0.9786
   3       0.1 0.5  0.5 0/60  0/60  0/60  85%    202291  144018  1498451
0.9786
   3       0.1 0.5  0.5 40/60 20/60 0/60  8.5%   202291  144018  1498451
0.9786
   3       0.1 0.5  0.5 40/60 20/60 0/60  85%    202291  144018  1498451
0.9786
   3       0.1 0.1  0.5 0/60  0/60  0/60  8.5%   186301  145769  1498221
0.9784
   3       0.1 0.1  0.5 0/60  0/60  0/60  85%    186301  145769  1498221
0.9784
   3       0.1 0.1  0.5 40/60 20/60 0/60  8.5%   186301  145769  1498221
0.9784
   3       0.1 0.1  0.5 40/60 20/60 0/60  85%    186301  145769  1498221
0.9784
   2       0.1 1    0.1 0/60   -    0/5   0%     245192  139227  1498232
0.9568
   2       0.1 1    0.1 40/60  -    0/5   0%     245192  139227  1498232
0.9568
   2       0.1 1    0.1 0/60   -    0/10  0%     246804  139129  1498964
0.9555
   2       0.1 1    0.1 40/60  -    0/10  0%     246804  139129  1498964
0.9555
   2       0.1 1    0.5 0/60   -    0/5   0%     252242  138373  1497602
0.9505
   2       0.1 1    0.5 40/60  -    0/5   0%     252242  138373  1497602
0.9505
   2       0.1 1    0.5 0/60   -    0/10  0%     255882  138133  1499082
0.9473
   2       0.1 1    0.5 40/60  -    0/10  0%     255882  138133  1499082
0.9473
   2       0.1 1    1   0/60   -    0/10  0%     256067  138018  1498227
0.947
   2       0.1 1    1   40/60  -    0/10  0%     256067  138018  1498227
0.947
   2       0.1 1    0.1 0/60   -    0/20  0%     256389  138133  1499589
0.9466
   2       0.1 1    0.1 40/60  -    0/20  0%     256389  138133  1499589
0.9466

------------------------------------------------------------------------------

       Table 7: Best 20 UDP Control  Results for Green Rate = 17% of 1.5Mbps
       (25600bps per customer) (+ Best 2 Color Result)

-------------------------------------------------------------------------------
   #Colors  Max_Prob    Min_Th/Max_Th    Yellow    Throughputs(bps)
Fairness
           G    Y   R   G     Y     R    Rate    UDP    Avg TCP Total

-------------------------------------------------------------------------------
   3       0.1 0.5  1   40/60 20/60 0/20  8.5%   25759   163636  1498479
0.9112
   3       0.1 0.5  1   40/60 20/60 0/20  85%    25759   163636  1498479
0.9112
   3       0.1 1    1   40/60 20/60 0/20  8.5%   25989   163582  1498229
0.9134
   3       0.1 1    1   40/60 20/60 0/20  85%    25989   163582  1498229
0.9134
   3       0.1 0.1  0.5 40/60 20/60 0/20  8.5%   26220   163556  1498220
0.9205
   3       0.1 0.1  0.5 40/60 20/60 0/20  85%    26220   163556  1498220
0.9205
   3       0.5 0.5  0.5 40/60 20/60 0/20  8.5%   26266   163538  1498106
0.9182
   3       0.5 0.5  0.5 40/60 20/60 0/20  85%    26266   163538  1498106
0.9182
   3       0.5 0.5  1   40/60 20/60 0/20  8.5%   26266   163538  1498106
0.9182
   3       0.5 0.5  1   40/60 20/60 0/20  85%    26266   163538  1498106
0.9182
   3       0.1 0.5  1   0/60  0/40  0/20  8.5%   26588   163600  1498988
0.9269
   3       0.1 0.5  1   0/60  0/40  0/20  85%    26588   163600  1498988
0.9269
   3       0.1 0.5  1   40/60 20/40 0/20  8.5%   26588   163600  1498988
0.9269
   3       0.1 0.5  1   40/60 20/40 0/20  85%    26588   163600  1498988
0.9269

Goyal, Durresi & Jain          Drop Precedence Study           [Page 11]

draft-goyal-diffserv-dpstdy-02.txt- 12 -                       June, 1999

   3       0.1 1    1   0/60  0/40  0/20  8.5%   26634   163564  1498714
0.9285
   3       0.1 1    1   0/60  0/40  0/20  85%    26634   163564  1498714
0.9285
   3       0.1 1    1   40/60 20/40 0/20  8.5%   26634   163564  1498714
0.9285
   3       0.1 1    1   40/60 20/40 0/20  85%    26634   163564  1498714
0.9285
   3       1   1    1   40/60 20/60 0/20  8.5%   26726   163227  1495766
0.9218
   3       1   1    1   40/60 20/60 0/20  85%    26726   163227  1495766
0.9218
   2       0.1 1    0.1 40/60  -    0/5   0%     245192  139227  1498232
0.9568

------------------------------------------------------------------------------

   Tables 8 and 9 show the best performing simulation configurations
   when the total reserved traffic is around 25.6% of link capacity. In
   this case, reserved traffic rate is high enough to keep most of the
   TCP packets green. Thus a clear demarkation between TCP and excess
   UDP packets can be achieved just with two colors. Now, by
   approriately setting the RED parameters, one can achieve either good
   fairness or restrict the UDP flow close to its reserved rate or both.
   However, as in case of 17% reserved traffic, with substantially
   increased TCP traffic, 2 colors may fail to maintain good
   performance. Notice that, with harsh drop thresholds for red packets
   (0/5), UDP throughput actually falls short of its reserved rate. This
   can be attributed to loss of almost all of excess red and a few green
   UDP packets.

          Table 8: Best 20 Fairness Results for Green Rate = 25.6% of
1.5Mbps
          (38400bps per customer)

-------------------------------------------------------------------------------
   #Colors  Max_Prob    Min_Th/Max_Th    Yellow    Throughputs(bps)
Fairness
           G    Y   R   G     Y     R    Rate    UDP    Avg TCP Total

-------------------------------------------------------------------------------
   2       0.5 1    1   0/60   -    0/5   0%     205194  143538  1497034
0.9809
   2       0.5 1    1   40/60  -    0/5   0%     205194  143538  1497034
0.9809
   2       0.1 1    0.1 0/60   -    0/10  0%     86630   156907  1498790
0.9775
   2       0.1 1    0.5 0/60   -    0/10  0%     79304   157724  1498824
0.9738
   2       0.1 1    0.5 40/60  -    0/10  0%     79304   157724  1498824
0.9738
   2       0.1 1    1   0/60   -    0/10  0%     76124   158027  1498364
0.9731
   2       0.1 1    1   40/60  -    0/10  0%     76124   158027  1498364
0.9731
   2       0.1 1    0.5 0/60   -    0/5   0%     74051   158124  1497171
0.9714
   2       0.1 1    0.5 40/60  -    0/5   0%     74051   158124  1497171
0.9714
   2       0.1 1    1   0/60   -    0/5   0%     74051   158124  1497171
0.9714
   2       0.1 1    1   40/60  -    0/5   0%     74051   158124  1497171
0.9714
   2       0.1 1    0.1 0/60   -    0/5   0%     72714   158516  1499354
0.9704
   2       1   1    1   0/60   -    0/20  0%     227912  141227  1498952
0.9692
   2       1   1    1   40/60  -    0/20  0%     227912  141227  1498952
0.9692
   3       0.1 0.5  0.5 0/60  0/60  0/60  8.5%   202199  144053  1498679
0.9644
   3       0.1 0.5  0.5 0/60  0/60  0/60  85%    202199  144053  1498679
0.9644
   3       0.1 0.5  0.5 40/60 20/60 0/60  8.5%   202199  144053  1498679
0.9644
   3       0.1 0.5  0.5 40/60 20/60 0/60  85%    202199  144053  1498679
0.9644
   2       0.5 1    0.5 0/60   -    0/20  0%     61839   159716  1499279
0.9625

Goyal, Durresi & Jain          Drop Precedence Study           [Page 12]

draft-goyal-diffserv-dpstdy-02.txt- 13 -                       June, 1999

   2       0.5 1    0.5 40/60  -    0/20  0%     61839   159716  1499279
0.9625

------------------------------------------------------------------------------

      Table 9: Best 20 UDP Control  Results for Green Rate = 25.6% of
1.5Mbps
      (38400bps per customer)

-------------------------------------------------------------------------------
   #Colors  Max_Prob    Min_Th/Max_Th    Yellow    Throughputs(bps)
Fairness
           G    Y   R   G     Y     R    Rate    UDP    Avg TCP Total

-------------------------------------------------------------------------------
   2       0.1 1    0.1 40/60  -    0/5   0%     37647   162284  1498207
0.9408
   3       1   1    1   40/60 20/60 0/20  8.5%   38431   162178  1498031
0.9375
   3       1   1    1   40/60 20/60 0/20  85%    38431   162178  1498031
0.9375
   3       0.5 0.5  0.5 40/60 20/60 0/20  8.5%   38569   162231  1498649
0.9365
   3       0.5 0.5  0.5 40/60 20/60 0/20  85%    38569   162231  1498649
0.9365
   3       0.5 0.5  1   40/60 20/60 0/20  8.5%   38569   162231  1498649
0.9365
   3       0.5 0.5  1   40/60 20/60 0/20  85%    38569   162231  1498649
0.9365
   2       0.1 1    0.1 40/60   -   0/10  0%     38615   162213  1498535
0.9411
   3       0.1 0.5  1   40/60 20/60 0/20  8.5%   38661   162187  1498341
0.9226
   3       0.1 0.5  1   40/60 20/60 0/20  85%    38661   162187  1498341
0.9226
   3       1   1    1   0/60  0/40  0/20  8.5%   38707   162196  1498467
0.942
   3       1   1    1   0/60  0/40  0/20  85%    38707   162196  1498467
0.942
   3       1   1    1   40/60 20/40 0/20  8.5%   38707   162196  1498467
0.942
   3       1   1    1   40/60 20/40 0/20  85%    38707   162196  1498467
0.942
   3       0.1 1    1   0/60  0/40  0/20  8.5%   38845   162204  1498685
0.9414
   3       0.1 1    1   0/60  0/40  0/20  85%    38845   162204  1498685
0.9414
   3       0.1 1    1   40/60 20/40 0/20  8.5%   38845   162204  1498685
0.9414
   3       0.1 1    1   40/60 20/40 0/20  85%    38845   162204  1498685
0.9414
   3       0.5 1    1   40/60 20/60 0/20  8.5%   38845   162133  1498045
0.9327
   3       0.5 1    1   40/60 20/60 0/20  85%    38845   162133  1498045
0.9327

------------------------------------------------------------------------------

   Tables 10 and 11 show the best performing simulation configurations
   when reserved traffic is 51.2% of link bandwidth. The results follow
   the same trends as in case of 25.6% reserved traffic. Again, reserved
   packet rate is large enough to clearly demarkate TCP packets from
   excess UDP packets. For 3 color simulations, both yellow packet rates
   (8.5% and 85%) give same results as not many TCP packets need to get
   demoted to yellow color. Very large number of green packets means
   that red packets get very harsh treatment even with not so harsh drop
   thresholds. With either 2 or 3 colors, RED parameters can be set
   appropriately in order to achieve good fairness or restrict UDP
   throughput or both.

          Table 10: Best 20 Fairness Results for Green Rate = 51.2% of
1.5Mbps
          (76800bps per customer)

-------------------------------------------------------------------------------
   #Colors  Max_Prob    Min_Th/Max_Th    Yellow    Throughputs(bps)
Fairness
           G    Y   R   G     Y     R    Rate    UDP    Avg TCP Total

Goyal, Durresi & Jain          Drop Precedence Study           [Page 13]

draft-goyal-diffserv-dpstdy-02.txt- 14 -                       June, 1999

-------------------------------------------------------------------------------
   2       0.5 1    1   40/60  -    20/60 0%     146120  150320  1499000
0.9934
   2       0.5 1    0.5 40/60  -    20/40 0%     142802  150711  1499202
0.9919
   2       0.5 1    0.5 40/60  -    0/40  0%     118103  153511  1499703
0.9914
   2       0.5 1    1   0/60   -    0/5   0%     149253  149760  1497093
0.9879
   2       0.5 1    1   40/60  -    0/5   0%     149253  149760  1497093
0.9879
   2       1   1    1   40/60  -    20/60 0%     171372  147422  1498172
0.9867
   2       0.5 1    1   0/60   -    0/10  0%     179251  146533  1498051
0.9862
   2       0.5 1    1   40/60  -    0/10  0%     179251  146533  1498051
0.9862
   2       0.5 1    0.5 0/60   -    0/5   0%     149944  149698  1497224
0.9859
   2       0.5 1    0.5 40/60  -    0/5   0%     149944  149698  1497224
0.9859
   2       0.1 1    0.1 40/60  -    20/40 0%     90225   156524  1498945
0.9790
   3       0.1 0.5  1   0/60  0/60  0/60  8.5%   209802  143156  1498202
0.9790
   3       0.1 0.5  1   0/60  0/60  0/60  85%    209802  143156  1498202
0.9790
   2       0.1 1    1   0/60   -    0/60  0%     204088  143876  1498968
0.9786
   2       0.1 1    0.1 40/60  -    0/40  0%     88105   156809  1499385
0.9758
   2       1   1    1   40/60  -    20/40 0%     78797   157858  1499517
0.9726
   2       0.1 1    0.5 40/60  -    0/40  0%     76815   158018  1498975
0.9709
   3       0.1 0.1  0.1 40/60 20/40 0/20  8.5%   76447   158089  1499247
0.9704
   3       0.1 0.1  0.1 40/60 20/40 0/20  85%    76447   158089  1499247
0.9704
   3       0.1 0.1  0.1 40/60 20/60 0/20  8.5%   76447   158089  1499247
0.9704

------------------------------------------------------------------------------

       Table 11: Best 20 UDP Control Results for Green Rate = 51.2% of
1.5Mbps
       (76800bps per customer)

-------------------------------------------------------------------------------
   #Colors  Max_Prob    Min_Th/Max_Th    Yellow    Throughputs(bps)
Fairness
           G    Y   R   G     Y     R    Rate    UDP    Avg TCP Total

-------------------------------------------------------------------------------
   3       0.5 0.5  1   40/60 20/60 0/20  85%    70963   158613  1498483
0.9602
   2       0.1 1    0.5 0/60   -    0/10  0%     71378   158560  1498418
0.9667
   2       0.1 1    0.5 40/60  -    0/10  0%     71378   158560  1498418
0.9667
   2       0.1 1    0.1 0/60   -    0/5   0%     71424   158524  1498144
0.9585
   2       0.1 1    0.1 40/60  -    0/5   0%     71424   158524  1498144
0.9585
   2       0.1 1    0.5 0/60   -    0/5   0%     71470   158524  1498190
0.9598
   2       0.1 1    0.5 40/60  -    0/5   0%     71470   158524  1498190
0.9598
   2       0.1 1    1   0/60   -    0/10  0%     71470   158524  1498190
0.9598
   2       0.1 1    1   0/60   -    0/5   0%     71470   158524  1498190
0.9598
   2       0.1 1    1   40/60  -    0/10  0%     71470   158524  1498190
0.9598
   2       0.1 1    1   40/60  -    0/5   0%     71470   158524  1498190
0.9598
   3       0.5 1    1   40/60 20/60 0/20  8.5%   71747   158489  1498147
0.9671
   3       0.5 1    1   40/60 20/60 0/20  85%    71747   158489  1498147
0.9671
   3       0.5 0.5  1   40/60 20/40 0/20  8.5%   71747   158489  1498147
0.9671
   3       0.5 0.5  1   40/60 20/40 0/20  85%    71747   158489  1498147
0.9671
   3       0.1 1    1   0/60  0/40  0/20  8.5%   71931   158524  1498651
0.9502
   3       0.1 1    1   0/60  0/40  0/20  85%    71931   158524  1498651
0.9502
   3       0.1 0.5  1   0/60  0/40  0/20  8.5%   72161   158533  1498961
0.968
   2       0.5 1    1   40/60  -    0/20  0%     72161   158551  1499121
0.9511

Goyal, Durresi & Jain          Drop Precedence Study           [Page 14]

draft-goyal-diffserv-dpstdy-02.txt- 15 -                       June, 1999

   3       0.5 1    1   40/60 20/40 0/20  8.5%   72161   158551  1499121
0.9511

------------------------------------------------------------------------------

6. Summary

   The simulations presented here suggest that the optimal number of
   colors or drop precedence levels in an Assured Forwarding traffic
   class depends on the traffic load and the amount of reserved (green)
   traffic. In a mixed TCP-UDP traffic scenario, best performance in
   terms of either fairness or restricting UDP throughput can be
   achieved with either 2 or 3 levels of drop precedence if most of the
   TCP packets have different (and 'better') color than excess UDP
   packets. With a clear distinction between TCP and excess UDP packets,
   one can use appropriate RED parameters so as to achieve desired
   results in terms of fairness or restricting UDP throughput.  With 3
   colors in a traffic class, TCP packets can be easily differentiated
   from excess UDP packets in most of the traffic scenarios.

   Note: This draft is being continuously updated. For the latest
   version, please see: http://www.cis.ohio-state.edu/~jain/ietf

7. References

   [juha] J. Heinanen, et al., Assured Forwarding PHB Group.  RFC 2597,
   June 1999.

   [floyd] S. Floyd, V. Jacobson, "Random Early Detection Gateways for
   Congestion Avoidance," IEEE/ACM Transactions on Networking, August
   1993.

   [ibanez] J. Ibanez, K. Nichols, Preliminary Simulation Evaluation of
   an Assured Service. Internet draft-Work in Progress <draft-ibanez-
   diffserv-assured-eval-00.txt>, August, 1998.

   [jain] Raj Jain, "The Art of Computer Systems Performance Analysis,"
   John Wiley and Sons Inc., 1991.

   [RFC2475] S. Blake, et al., An Architecture for Differentiated
   Services. RFC 2475, December 1998.

   [NS] NS simulator, Version 2.1 Available from http://www-
   mash.cs.berkeley.edu/ns

Authors's address

   Mukul Goyal, Arian Durresi, Raj Jain
   Computer and Information Science Dept,

Goyal, Durresi & Jain          Drop Precedence Study           [Page 15]

draft-goyal-diffserv-dpstdy-02.txt- 16 -                       June, 1999

   The Ohio State University,
   2015, Neil Avenue,Room 395,
   Columbus, OH 43210
   Phone: +1 (614) 292-3989
   Fax: +1 (614) 292 2911
   Email: {mukul,durresi,jain}@cis.ohio-state.edu

      This internet draft expires on December 1999

Goyal, Durresi & Jain          Drop Precedence Study           [Page 16]
