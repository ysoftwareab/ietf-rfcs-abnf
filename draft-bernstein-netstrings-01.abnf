buf = malloc(len + 1);       /* malloc(0) is not portable */
