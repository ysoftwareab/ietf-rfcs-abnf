<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>File Transfer Protocol LOCK Command for Using a Single Port</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Example">
<link href="#rfc.section.3" rel="Chapter" title="3 Document Conventions">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Basic Tokens">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Server Replies">
<link href="#rfc.section.4" rel="Chapter" title="4 FTP Data Transfers Over Control Connection">
<link href="#rfc.section.5" rel="Chapter" title="5 The LOCK Command (LOCK)">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 FEAT Command Response for LOCK Command">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 User-PI usage of LOCK">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 LOCK Command Errors">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Acknowledgements and Contributors">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Document History">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="One of the biggest hurdles for FTP in real life usage is its use of two connections. First, it uses a primary connection to send control commands on, and when it sends or receives data, it opens a second TCP stream for that purpose.  This document specifies a new FTP LOCK command to be used by clients to request the server to use the control connection for data transfers, using a single port instead of two.  " />
  <meta name="description" content="One of the biggest hurdles for FTP in real life usage is its use of two connections. First, it uses a primary connection to send control commands on, and when it sends or receives data, it opens a second TCP stream for that purpose.  This document specifies a new FTP LOCK command to be used by clients to request the server to use the control connection for data transfers, using a single port instead of two.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">A. Bryan</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">D. Stenberg</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">T. Tsujikawa</td>
</tr>
<tr>
<td class="left">Expires: December 10, 2011</td>
<td class="right">June 08, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">File Transfer Protocol LOCK Command for Using a Single Port<br />
  <span class="filename">draft-bryan-ftp-lock-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>One of the biggest hurdles for FTP in real life usage is its use of two connections. First, it uses a primary connection to send control commands on, and when it sends or receives data, it opens a second TCP stream for that purpose.  This document specifies a new FTP LOCK command to be used by clients to request the server to use the control connection for data transfers, using a single port instead of two.  </p>
<h1><a>Editorial Note (To be removed by RFC Editor)</a></h1>
<p>Discussion of this draft should take place on the FTPEXT2 working group mailing list (ftpext@ietf.org), although this draft is not a WG item.  Related documents (including fancy diffs) can be found at <a href="http://tools.ietf.org/wg/ftpext2/">http://tools.ietf.org/wg/ftpext2/</a>.  </p>
<p>The changes in this draft are summarized in <a href="#dochistory">Appendix Appendix A.1</a>.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 10, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Example</a>
</li>
<li>3.   <a href="#rfc.section.3">Document Conventions</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Basic Tokens</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Server Replies</a>
</li>
<li>4.   <a href="#rfc.section.4">FTP Data Transfers Over Control Connection</a>
</li>
<li>5.   <a href="#rfc.section.5">The LOCK Command (LOCK)</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">FEAT Command Response for LOCK Command</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">User-PI usage of LOCK</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">LOCK Command Errors</a>
</li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Acknowledgements and Contributors</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Document History</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">One of the biggest hurdles for FTP in real life usage is its use of two connections. First, it uses a primary connection to send control commands on, and when it sends or receives data, it opens a second TCP stream for that purpose.  This document specifies a new FTP LOCK command to be used by clients to request the server to use the control connection for data transfers, using a single port instead of two.  </p>
<p id="rfc.section.1.p.2">The use of two connections for FTP, where the second one uses dynamic port numbers and can go in either direction, has been known to give firewall administrators grief and firewalls really have to "understand" FTP at the application protocol layer to work really well.  Since firewalls need to inspect and understand FTP to be able to open ports for the secondary connection etc, there's a huge problem with encrypted FTP (FTP-SSL or FTPS) since then the control connection is sent encrypted and the firewall(s) cannot interpret the commands that deal with creating the second connection.  Things might seem fine over the control connection, but will start to fail when the data connection is attempted.</p>
<p id="rfc.section.1.p.3">This also means that if both parties are behind NATs (Network Address Translation), you cannot use FTP.</p>
<p id="rfc.section.1.p.4">Additionally, as NATs often are setup to kill idle connections and the nature of FTP makes the control channel remain quiet during long and slow FTP transfers, we often end up with the control channel getting cut off by the NAT due to idleness.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Example</h1>
<div id="#rfc.figure.1"></div>
<p></p>

<p>Example of LOCK client request:</p>
<pre>
   C&gt; LOCK
   S&gt; 200 LOCK OK to current port
   C&gt; RETR filename.ext
   S&gt; 150 Opening BINARY mode
   boundary=separator189dhde78b287734237842g3847g
   --separator189dhde78b287734237842g3847g
   
   [raw binary data]
   --separator189dhde78b287734237842g3847g--
   S&gt; 226 Transfer complete.
</pre>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Document Conventions</h1>
<p id="rfc.section.3.p.1">This specification describes conformance of File Transfer Protocol Extension for LOCK, so data transfers occur over the control connection and not a separate data connection.</p>
<p id="rfc.section.3.p.2">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14, <a href="#RFC2119">[RFC2119]</a>, as scoped to those conformance targets.</p>
<p id="rfc.section.3.p.3">This document also uses notation defined in STD 9, <a href="#RFC0959">[RFC0959]</a>.  In particular, the terms or commands "reply", "user", "file", "FTP commands", "user-PI" (user protocol interpreter), "server-FTP process", "server-PI", "control connection", "data connection", "mode", "Image type", "Stream transfer mode", "type", "LIST", "NLST", "STOR", "RETR", "STOU", "APPE", and "ASCII", are all used here as defined there.</p>
<p id="rfc.section.3.p.4">In the examples of FTP dialogs presented in this document, lines that begin "C&gt; " were sent over the control connection from the user-PI to the server-PI, and lines that begin "S&gt; " were sent over the control connection from the server-PI to the user-PI. In all cases, the prefixes shown above, including the one space, have been added for the purposes of this document, and are not a part of the data exchanged between client and server.</p>
<p id="rfc.section.3.p.5">Syntax required is defined using the Augmented BNF defined in <a href="#RFC5234">[RFC5234]</a>.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Basic Tokens</h1>
<p id="rfc.section.3.1.p.1">This document imports the core definitions given in Appendix B of <a href="#RFC5234">[RFC5234]</a>.  There definitions will be found for basic ABNF elements like ALPHA, DIGIT, SP, etc.  To that, the following term is added for use in this document.</p>
<div id="#rfc.figure.2"></div>
<p></p>

<p></p>
<pre>
   TCHAR = VCHAR / SP / HTAB    ; visible plus white space
</pre>
<p id="rfc.section.3.1.p.3">The VCHAR (from <a href="#RFC5234">[RFC5234]</a>) and TCHAR rules give basic character types from varying sub-sets of the ASCII character set for use in various commands and responses.</p>
<p id="rfc.section.3.1.p.4">Note that in ABNF, string literals are case insensitive.  That convention is preserved in this document, and implies that FTP commands and parameters that are added by this specification have values that can be represented in any case.  That is, "LOCK" is the same as "lock", "Lock", "LoCk", etc., and "ftp.example.com" is the same as "Ftp.Example.Com", "fTp.eXample.cOm", etc.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Server Replies</h1>
<p id="rfc.section.3.2.p.1">Section 4.2 of <a href="#RFC0959">[RFC0959]</a> defines the format and meaning of replies by the server-PI to FTP commands from the user-PI.  Those reply conventions are used here without change.</p>
<div id="#rfc.figure.3"></div>
<p></p>

<p></p>
<pre>
   error-response = error-code SP *TCHAR CRLF
   error-code     = ("4" / "5") 2DIGIT
</pre>
<p id="rfc.section.3.2.p.3">Implementers should note that the ABNF syntax (which was not used in <a href="#RFC0959">[RFC0959]</a>) used in this document, and other FTP related documents, sometimes shows replies using the one line format.  Unless otherwise explicitly stated, that is not intended to imply that multi-line responses are not permitted.  Implementers should assume that, unless stated to the contrary, any reply to any FTP command (including QUIT) can be of the multi-line format described in <a href="#RFC0959">[RFC0959]</a>.</p>
<p id="rfc.section.3.2.p.4">Throughout this document, replies will be identified by the three digit code that is their first element.  Thus the term "500 reply" means a reply from the server-PI using the three digit code "500".</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> FTP Data Transfers Over Control Connection</h1>
<p id="rfc.section.4.p.1">As mentioned, the use of two ports with FTP became problematic with the advent of firewalls and NATs.  </p>
<p id="rfc.section.4.p.2">By using a single port, like many other protocols, these problems are eliminated.  </p>
<p id="rfc.section.4.p.3">There are drawbacks, such as not being able to carry out control connection actions during transfer, but the benefits outweigh them. Many implementations do not really allow the client to do much on the control connection while the transfer is ongoing anyway.  </p>
<p id="rfc.section.4.p.4">The LOCK command causes anything that would normally open a data connection to be re-routed over the control connection and remain using a single connection.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#LOCK" id="LOCK">The LOCK Command (LOCK)</a>
</h1>
<p id="rfc.section.5.p.1">A new command "LOCK" is added to the FTP command set to allow the client to request that data transfers occur over the current control connection without opening up another port for a data connection.</p>
<div id="#rfc.figure.4"></div>
<p id="rfc.section.5.p.2">The syntax for the LOCK command when the current transfer mode is STREAM is: </p>

<p></p>
<pre>
   lock-command = "LOCK" CRLF
   lock-response = lock-ok / error-response
   lock-ok       = "200" SP *TCHAR CRLF	  
</pre>
<p id="rfc.section.5.p.3">Post-LOCK transfers use a MIME-style separator.  The boundary style is a subset of MIME. The first boundary string is prefixed with two dashes "--" and a blank line, while the final boundary string is prefixed and suffixed with two dashes "--".</p>
<p id="rfc.section.5.p.4">The sender MUST set the separator.  A careful sender SHOULD check the file first so that there is no occurance of the separator within the file, but this method is used by browsers and HTTP clients today without checking the file since the risk that a very long string with lots of randomness would actually exist in the file is next to none.</p>
<p id="rfc.section.5.p.5">When uploading files, the client MUST use end-of-marker solution.</p>
<div id="#rfc.figure.5"></div>
<p></p>

<p></p>
<pre>
   boundary-announce = "boundary=" separator CRLF
   boundary-start    = "--" separator CRLF CRLF
   boundary-end      = "--" separator "--" CRLF
   separator         = *TCHAR
</pre>
<p id="rfc.section.5.p.7">The following commands would usually cause a data connection to be opened, but post-LOCK they will occur over the control connection: LIST, NLST, STOR, RETR, STOU, APPE.</p>
<p id="rfc.section.5.p.8">The LOCK command will cause LIST and NLST directory listings to be sent over the control connection, instead of the data connection. Some clients issue one of these commands automatically at login, so if the server supports LOCK and the client prefers LOCK, then LOCK should be issued after login but before one of these commands.</p>
<p id="rfc.section.5.p.9">If the LOCK command is issued after a data connection has already been opened, it will continue to completion uninterrupted and close once finished.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> FEAT Command Response for LOCK Command</h1>
<p id="rfc.section.5.1.p.1">When replying to the FEAT command <a href="#RFC2389">[RFC2389]</a>, a server-FTP process that supports the LOCK command, as specified here, MUST include, a line containing exactly the string "LOCK".  This string is case insensitive, and MAY be sent in any mixture of upper or lower case, however it SHOULD be sent in upper case. That is, the response SHOULD be:</p>
<div id="#rfc.figure.6"></div>
<p></p>

<p></p>
<pre>
   C&gt; FEAT
   S&gt; 211-Extensions supported:
   S&gt;  ...
   S&gt;  LOCK
   S&gt;  ...
   S&gt; 211 END
</pre>
<p id="rfc.section.5.1.p.3">The ellipses indicate place holders where other features may be included, and are not required. The one-space indentation of the feature lines is mandatory <a href="#RFC2389">[RFC2389]</a>.</p>
<div id="#rfc.figure.7"></div>
<p></p>

<p></p>
<pre>	
   lock-feat = SP "LOCK" CRLF
</pre>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> User-PI usage of LOCK</h1>
<p id="rfc.section.5.2.p.1">The user-PI issues the FEAT command to query the server-PI if it supports the LOCK command.</p>
<div id="#rfc.figure.8"></div>
<p></p>

<p></p>
<pre>
   C&gt; FEAT
   S&gt; 211-Extensions supported:
   S&gt;  ...
   S&gt;  LOCK
   S&gt;  ...
   S&gt; 211 END
</pre>
<div id="#rfc.figure.9"></div>
<p id="rfc.section.5.2.p.3">The client requests that data transfers will be over the current connection, instead of opening another port.  </p>

<p></p>
<pre>
   C&gt; TYPE I
   S&gt; 200 Type set to I.
   C&gt; LOCK
   S&gt; 200 LOCK OK to current port
   C&gt; RETR filename.ext
   S&gt; 150 Opening BINARY mode
   boundary=separator189dhde78b287734237842g3847g
   --separator189dhde78b287734237842g3847g
   
   [raw binary data]
   --separator189dhde78b287734237842g3847g--
   S&gt; 226 Transfer complete.
</pre>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> LOCK Command Errors</h1>
<p id="rfc.section.5.3.p.1">The server-PI SHOULD reply with a 500 reply if the LOCK command is unrecognized or unimplemented.</p>
<p id="rfc.section.5.3.p.2">The server-PI SHOULD reply with a 552 reply if the user is not allowed to use the LOCK command.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.6.p.1">This new command is added to the "FTP Commands and Extensions" registry created by <a href="#RFC5797">[RFC5797]</a>.</p>
<p id="rfc.section.6.p.2">Command Name: LOCK</p>
<p id="rfc.section.6.p.3">Description: Single port data transfers for FTP.</p>
<p id="rfc.section.6.p.4">FEAT String: LOCK</p>
<p id="rfc.section.6.p.5">Command Type: Service execution/parameter setting</p>
<p id="rfc.section.6.p.6">Conformance Requirements: Optional</p>
<p id="rfc.section.6.p.7">Reference: This specification</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Security Considerations</h1>
<p id="rfc.section.7.p.1">FTP can be secured with TLS by encrypting the control connection and data connection, as per <a href="#RFC4217">[RFC4217]</a>. Under optimal conditions with LOCK, no data connection is opened and all data transfers occur over the control connection. When LOCK is in use, if data transfers need to be encrypted, then the control connection MUST be encrypted (instead of the data connection, as with non-LOCK transfers).</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC0959">[RFC0959]</b></td>
<td class="top">
<a>Postel, J.</a> and <a>J. Reynolds</a>, "<a href="http://tools.ietf.org/html/rfc0959">File Transfer Protocol</a>", STD 9, RFC 0959, October 1985.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2389">[RFC2389]</b></td>
<td class="top">
<a>Hethmon, P.</a> and <a>R. Elz</a>, "<a href="http://tools.ietf.org/html/rfc2389">Feature negotiation mechanism for the File Transfer Protocol</a>", RFC 2389, August 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5234">[RFC5234]</b></td>
<td class="top">
<a>Crocker, D.</a> and <a>P. Overell</a>, "<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>", STD 68, RFC 5234, January 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC4217">[RFC4217]</b></td>
<td class="top">
<a>Ford-Hutchinson, P.</a>, "<a href="http://tools.ietf.org/html/rfc4217">Securing FTP with TLS</a>", RFC 4217, October 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5797">[RFC5797]</b></td>
<td class="top">
<a>Klensin, J.</a> and <a>A. Hoenes</a>, "<a href="http://tools.ietf.org/html/rfc5797">FTP Command and Extension Registry</a>", RFC 5797, March 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Acknowledgements and Contributors</h1>
<p id="rfc.section.Appendix A.p.1">Thanks to the FTPEXT2 Working Group and Robert McMurray.</p>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> <a href="#dochistory" id="dochistory">Document History</a>
</h1>
<p id="rfc.section.Appendix A.1.p.1">[[ to be removed by the RFC editor before publication as an RFC. ]]</p>
<p id="rfc.section.Appendix A.1.p.2">Known issues concerning this draft: </p>

<ul><li>Should there be a way to unLOCK and go back to two connection style?</li></ul>
<p id="rfc.section.Appendix A.1.p.3">draft-bryan-ftp-lock-00 : June 7, 2011.  </p>

<ul><li>Initial draft.</li></ul>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Anthony Bryan</span> 
	  <span class="n hidden">
		<span class="family-name">Bryan</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Pompano Beach</span>,  
		<span class="region">FL</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:anthonybryan@gmail.com">anthonybryan@gmail.com</a></span>

<span class="vcardline">URI: <a href="http://www.metalinker.org">http://www.metalinker.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Daniel Stenberg</span> 
	  <span class="n hidden">
		<span class="family-name">Stenberg</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:daniel@haxx.se">daniel@haxx.se</a></span>

<span class="vcardline">URI: <a href="http://www.haxx.se/">http://www.haxx.se/</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tatsuhiro Tsujikawa</span> 
	  <span class="n hidden">
		<span class="family-name">Tsujikawa</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region">Shiga</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Japan</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:tatsuhiro.t@gmail.com">tatsuhiro.t@gmail.com</a></span>

<span class="vcardline">URI: <a href="http://aria2.sourceforge.net">http://aria2.sourceforge.net</a></span>

  </address>
</div>

</body>
</html>