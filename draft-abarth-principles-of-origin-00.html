<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Principles of the Same-Origin Policy </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Trust">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Pitfalls">
<link href="#rfc.section.3" rel="Chapter" title="3 Origin">
<link href="#rfc.section.4" rel="Chapter" title="4 Authority">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Pitfalls">
<link href="#rfc.section.5" rel="Chapter" title="5 Policy">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Object Access">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Network Access">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Pitfalls">
<link href="#rfc.section.6" rel="Chapter" title="6 Conclusion">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Acknowledgements">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The security model of the web platform has evolved over time to meet the needs of new applications and to correct earlier mistakes.  Although web security has evolved largely organically, the security model has converged towards a handful of key concepts.  This document presents those concepts and provides advice to designers of new pieces of the web platform." />
  <meta name="description" content="The security model of the web platform has evolved over time to meet the needs of new applications and to correct earlier mistakes.  Although web security has evolved largely organically, the security model has converged towards a handful of key concepts.  This document presents those concepts and provides advice to designers of new pieces of the web platform." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">websec</td>
<td class="right">A. Barth</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Google, Inc.</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">February 2011</td>
</tr>
<tr>
<td class="left">Expires: August 03, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Principles of the Same-Origin Policy <br />
  <span class="filename">draft-abarth-principles-of-origin-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The security model of the web platform has evolved over time to meet the needs of new applications and to correct earlier mistakes.  Although web security has evolved largely organically, the security model has converged towards a handful of key concepts.  This document presents those concepts and provides advice to designers of new pieces of the web platform.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 03, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Trust</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Pitfalls</a>
</li>
<li>3.   <a href="#rfc.section.3">Origin</a>
</li>
<li>4.   <a href="#rfc.section.4">Authority</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Pitfalls</a>
</li>
<li>5.   <a href="#rfc.section.5">Policy</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Object Access</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Network Access</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Pitfalls</a>
</li>
<li>6.   <a href="#rfc.section.6">Conclusion</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Acknowledgements</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The security model of the web platform has evolved over time to meet the needs of new applications and to correct earlier mistakes.  Although web security has evolved largely organically, the security model has converged towards a handful of key concepts.  This document presents those concepts and provides advice to designers of new pieces of the web platform.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#trust" id="trust">Trust</a>
</h1>
<div id="#rfc.figure.1"></div>
<pre>
           
&lt;script src="https://example.com/library.js"&gt;&lt;/script&gt;
          
        </pre>
<p id="rfc.section.2.p.1">On the web, trust is specified by URL.  For example, HTML documents designate which script to run with a URL: </p>
<p id="rfc.section.2.p.2">When a user agent process this element, the user agent will fetch the script at that URL and execute the script with the privileges of the document.  In this way, the document grants all the privileges it has to the resource specified by the URL.  In essence, the document declares that it trusts the integrity of information retrieved from that URL.</p>
<div id="#rfc.figure.2"></div>
<pre>
           
&lt;form method="POST" action="https://example.com/login"&gt;
 ... &lt;input type="password"&gt; ...
&lt;/form&gt;
          
        </pre>
<p id="rfc.section.2.p.3">In addition to importing libraries from URLs, user agents also let principals export data to URLs.  For example, consider the HTML form element: </p>
<p id="rfc.section.2.p.4">When the user enters his or her password and submits the form, the password is sent to the network endpoint designated by the URL.  In this way, the document exports its secret data to that URL.  In essence, the document declares that it trusts the confidentiality of information sent to that URL.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Pitfalls</h1>
<p id="rfc.section.2.1.p.1">When designing new pieces of the web platform, make sure that important trust distinctions are visible in URLs.  For example, if both TLS and non-TLS protected resources used the "http" URL scheme, a document would be unable to specify that it wished to retrieve a script over TLS.  By using the "https" URL scheme, documents are able to indicate that they wish to interact with resources that are protected from active network attackers.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#origin" id="origin">Origin</a>
</h1>
<p id="rfc.section.3.p.1">In principle, user agents could treat every URL as a separate principal and isolate each document from every other URL unless the document explicitly indicated that it trusted that URL.  Unfortunately, this design is cumbersome for developers because web applications often consist of a number of resource acting in concert.</p>
<p id="rfc.section.3.p.2">As an approximation, user agents group URLs together into protection domains called origins.  In particular, two URLs are part of the same origin (i.e., represent the same principal) if they have the same scheme, host, and port.</p>
<p id="rfc.section.3.p.3">Q: Why not just use the host?</p>
<p id="rfc.section.3.p.4">A: Including the scheme in the origin tuple is essential for security.  If user agents did not include the scheme, there would be no isolation between documents from http://example.com and https://example.com because the two have the same host.  However, without this isolation, an active network attacker could corrupt the document retrieved from http://example.com and then use that document as a stepping stone to compromise the confidentiality and integrity of the document retrieved from https://example.com, bypassing the protections afforded by TLS.</p>
<p id="rfc.section.3.p.5">Q: Why use the fully qualified host name instead of just the "top-level" domain?</p>
<p id="rfc.section.3.p.6">A: Although the DNS has hierarchical delegation, the trust relationships between host names vary by deployment.  For example, at many educational institutions, students can host content at https://example.edu/~student/, but that does not mean a document authored by a student should be part of the same origin (i.e., represent the same principal) as a web application for managing grades hosted at https://grades.example.edu/.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#authority" id="authority">Authority</a>
</h1>
<p id="rfc.section.4.p.1">Although user agents group URLs into origins, not every resource in an origin carries the same authority.  For example, an image is passive content and, therefore, carries no authority, meaning the image has no access to the objects and resources available to its origin.  By contrast, an HTML document contains active content and, therefore, carries the full authority of its origin.  The user agent determines how much authority to grant a resource by examining its MIME type.  For example, resources with a MIME type of image/png are treated as images and resources with a MIME type of text/html are treated as HTML documents.</p>
<p id="rfc.section.4.p.2">When hosting untrusted content (such as user-generated content), web applications can limit that content&#8217;s authority by restricting its MIME type.  For example, serving user-generated content as image/png is less risky than serving user-generated content as text/html.  Of course many web applications incorporate untrusted content in their HTML documents.  If not done carefully, these applications risk leaking their origin&#8217;s authority to the untrusted content, a vulnerability commonly known as cross-site scripting.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Pitfalls</h1>
<p id="rfc.section.4.1.p.1">When designing new pieces of the web platform, be careful not to grant authority to resources irrespective of MIME type.  Many web applications server untrusted content with restricted MIME types.  A new web platform feature that grants authority to these pieces of content risks introducing vulnerabilities into existing applications.  Instead, prefer to grant authority to MIME types that already possess the origin&#8217;s full authority or to new MIME types designed specifically to carry the new authority.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#policy" id="policy">Policy</a>
</h1>
<p id="rfc.section.5.p.1">Generally speaking, user agents isolate different origins and permit controlled communication between origins.  The details of how user agents provide isolation and communication vary depending on several factors.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Object Access</h1>
<p id="rfc.section.5.1.p.1">Most objects (also known as application programming interfaces or APIs) exposed by the user agent respect the same-origin policy.  Specifically, a script running on behalf of one document can access objects associated with another document if, and only if, the two documents belong to the same origin, e.g., were retrieved from URLs with the same scheme, host, and port.</p>
<p id="rfc.section.5.1.p.2">There are some exceptions to this general policy.  For example, some parts of HTML&#8217;s Location interface are available across origins (e.g., to allow for navigating other browsing contexts).  As another sample, HTML&#8217;s postMessage interface is visible across origins to facilitate cross-origin communication.  Exposing objects to foreign origins is dangerous and should be done only with great care because doing so exposes these objects to potential attackers.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Network Access</h1>
<p id="rfc.section.5.2.p.1">Access to network resources varies depending on whether the resources are in the same origin as the document attempting to access them.</p>
<p id="rfc.section.5.2.p.2">Generally, reading information from another origin is forbidden.  However, a document is permitted use some kinds of resources retrieved from other origins.  For example, a document is permitted to execute script, render images, and apply style sheets from any origin.  Likewise, a document can display a document from another origin in a frame.</p>
<p id="rfc.section.5.2.p.3">Generally, sending information to another origin is permitted.  However, sending information over the network in arbitrary formats is dangerous.  For this reason, user agents restrict documents to sending information using particular protocols, such as in an HTTP request without custom headers.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> Pitfalls</h1>
<p id="rfc.section.5.3.p.1">Whenever user agents allow documents from one origin to interact with resources in another origin, they invite security issues.  For example, the ability to display images from another origin leaks their height and width across origins.  Similarly, the ability to send network requests to another origin gives rise to cross-site request forgery vulnerabilities.  However, user agents tolerate these risks when the value proposition is high enough.  For example, a user agent that blocked cross-origin network requests would prevent its users from following hyperlinks, a core component of the web architecture.</p>
<p id="rfc.section.5.3.p.2">When designing new pieces of the web platform, it can be tempting to grant a privilege to one document but to withhold that privilege from another document in the same origin.  However, withholding privileges in this way is ineffective because the document without the privilege can usually obtain the privilege anyway because user agents do not isolate documents within an origin.  Instead, new pieces of the platform should grant or withhold privileges from origins as a whole (rather than discriminating between individual documents within an origin).</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#conclusion" id="conclusion">Conclusion</a>
</h1>
<p id="rfc.section.6.p.1">The web security model designates trust relationships with URLs.  URLs are grouped together into origins, which represent principals.  Some resources in an origin (active content) are granted the origin&#8217;s full authority, whereas other resources in the origin (passive content) are not granted the origin&#8217;s authority.  Documents that carry their origin&#8217;s authority are granted access to objects and network resources within their own origin.  These documents are also granted limited access to objects and network resources of other origins, but these cross-origin privileges must be carefully designed to avoid introducing security vulnerabilities into the web platform.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Acknowledgements</h1>
<p id="rfc.section.Appendix A.p.1">We would like to thank Ian Hickson, Collin Jackson, Thomas Roessler, Jesse Ruderman, and Daniel Veditz for their valuable feedback on this document.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Adam Barth</span> 
	  <span class="n hidden">
		<span class="family-name">Barth</span>
	  </span>
	</span>
	<span class="org vcardline">Google, Inc.  </span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ietf@adambarth.com">ietf@adambarth.com</a></span>

<span class="vcardline">URI: <a href="http://www.adambarth.com/">http://www.adambarth.com/</a></span>

  </address>
</div>

</body>
</html>