<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>A Flexible Authentication Framework for the Transport Layer Security (TLS) Protocol using the Extensible Authentication Protocol (EAP)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 EAP Applicability">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Comparison with Design Alternatives">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Conventions Used in This Document">
<link href="#rfc.section.2" rel="Chapter" title="2 Operating Environment">
<link href="#rfc.section.3" rel="Chapter" title="3 Protocol Overview">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 The tee_supported Extension">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 The EapFinished Handshake Message">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 The EapMsg Handshake Message">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Calculating the EapFinished message">
<link href="#rfc.section.4" rel="Chapter" title="4 Security Considerations">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 EapFinished vs. Finished">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Identity Protection">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Mutual Authentication">
<link href="#rfc.section.5" rel="Chapter" title="5 Performance Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Operational Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgments">
<link href="#rfc.section.9" rel="Chapter" title="9 Changes from Previous Versions">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 Changes in version -02">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 Changes in version -01">
<link href="#rfc.section.9.3" rel="Chapter" title="9.3 Changes from the protocol model draft">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Many of today's Web security problems have their root in the widespread usage of weak authentication mechanisms bundled with the usage of password based credentials. Dealing with both of these problems is the basis of this publication." />
  <meta name="description" content="Many of today's Web security problems have their root in the widespread usage of weak authentication mechanisms bundled with the usage of password based credentials. Dealing with both of these problems is the basis of this publication." />
  <meta name="keywords" content="Internet-Draft" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">TLS Working Group</td>
<td class="right">Y. Nir</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Check Point</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Y. Sheffer</td>
</tr>
<tr>
<td class="left">Expires: December 25, 2011</td>
<td class="right">Independent</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">H. Tschofenig</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">NSN</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">P. Gutmann</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">University of Auckland</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">June 23, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">A Flexible Authentication Framework for the Transport Layer Security (TLS) Protocol using the Extensible Authentication Protocol (EAP)<br />
  <span class="filename">draft-nir-tls-eap-12</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Many of today's Web security problems have their root in the widespread usage of weak authentication mechanisms bundled with the usage of password based credentials. Dealing with both of these problems is the basis of this publication.</p>
<p>This document extends the Transport Layer Security (TLS) protocol with a flexible and widely deployed authentication framework, namely the Extensible Authentication Protocol (EAP), to improve security of Web- as well as non-Web-based applications. The EAP framework allows so-called EAP methods, i.e. authentication and key exchange protocols, to be plugged into EAP without having to re-design the underlying protocol. The benefit of such an easy integration is the ability to run authentication protocols that fit a specific deployment environment, both from a credential choice as well as from the security and performance characteristics of the actual protocol.</p>
<p>This work follows the example of IKEv2, where EAP has been added to allow clients to seamlessly use different forms of authentication credentials, such as passwords, token cards, and shared secrets.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 25, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">EAP Applicability</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Comparison with Design Alternatives</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Conventions Used in This Document</a>
</li>
<li>2.   <a href="#rfc.section.2">Operating Environment</a>
</li>
<li>3.   <a href="#rfc.section.3">Protocol Overview</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">The tee_supported Extension</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">The EapFinished Handshake Message</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">The EapMsg Handshake Message</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Calculating the EapFinished message</a>
</li>
<li>4.   <a href="#rfc.section.4">Security Considerations</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">EapFinished vs. Finished</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Identity Protection</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Mutual Authentication</a>
</li>
<li>5.   <a href="#rfc.section.5">Performance Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Operational Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgments</a>
</li>
<li>9.   <a href="#rfc.section.9">Changes from Previous Versions</a>
</li>
<li>9.1.   <a href="#rfc.section.9.1">Changes in version -02</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">Changes in version -01</a>
</li>
<li>9.3.   <a href="#rfc.section.9.3">Changes from the protocol model draft</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li>10.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This document describes a new extension to <a href="#TLS">[TLS]</a>. This extension allows a TLS client to authenticate using <a href="#EAP">[EAP]</a> instead of performing the authentication at the application level. The extension follows <a href="#TLS-EXT">[TLS-EXT]</a>.  For the remainder of this document we will refer to this extension as TEE (TLS with EAP Extension).</p>
<p id="rfc.section.1.p.2">TEE extends the TLS handshake beyond the regular setup, to allow the EAP protocol to run between the TLS server (called an "authenticator" in EAP) and the TLS client (called either a "supplicant" or a "peer"). This allows the TLS architecture to handle client authentication before exposing the server application software to an unauthenticated client. In doing this, we follow the approach taken for IKEv2 in <a href="#RFC5996">[RFC5996]</a>.  However, similar to regular TLS, we protect the user identity by only sending the client identity after the server has authenticated. In this our solution differs from that of IKEv2.</p>
<p id="rfc.section.1.p.3">Currently used applications that rely on non-certificate user credentials use TLS to authenticate the server only. After that, the application takes over, and presents a login screen where the user is expected to present their credentials.</p>
<p id="rfc.section.1.p.4">This creates several problems. It allows a client to access the application before authentication, thus creating a potential for anonymous attacks on non-hardened applications. Additionally, web pages are not particularly well suited for long shared secrets and for interfacing with certain devices such as USB tokens.</p>
<p id="rfc.section.1.p.5">TEE allows full mutual authentication to occur for all these applications within the TLS exchange. The application receives control only when the user is identified and authenticated. The authentication can be built into the server infrastructure by connecting to an AAA server. The client side can be integrated into client software such as web browsers and mail clients. An EAP infrastructure is already built into some operating systems providing a user interface for each authentication method within EAP.</p>
<p id="rfc.section.1.p.6">We intend TEE to be used for various protocols that use TLS such as HTTPS, in cases where certificate based client authentication is not practical. This includes web-based mail services, online banking, premium content websites and mail clients.</p>
<p id="rfc.section.1.p.7">Another class of applications that may see benefit from TEE are TLS based VPN clients used as part of so-called "SSL VPN" products. No such client protocols have so far been standardized.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#eap_app" id="eap_app">EAP Applicability</a>
</h1>
<p id="rfc.section.1.1.p.1">Section 1.3 of <a href="#EAP">[EAP]</a> states that EAP is only applicable for network access authentication, rather than for "bulk data transfer". It then goes on to explain why the transport properties of EAP indeed make it unsuitable for bulk data transfer, e.g. for large file transport. Our proposed use of EAP falls squarely within the applicability as defined, since we make no further use of EAP beyond access authentication.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#alternatives" id="alternatives">Comparison with Design Alternatives</a>
</h1>
<p id="rfc.section.1.2.p.1">It has been suggested to implement EAP authentication as part of the protected application, rather than as part of the TLS handshake. A BCP document could be used to describe a secure way of doing this. The drawbacks we see in such an approach are listed below:</p>

<ul>
<li>EAP does not have a pre-defined transport method. Application designers would need to specify an EAP transport for each application. Making this a part of TLS has the benefit of a single specification for all protected applications.</li>
<li>The integration of EAP and TLS is security-sensitive and should be standardized and interoperable. We do not believe that it should be left to application designers to do this in a secure manner. Specifically on the server-side, integration with AAA servers adds complexity and is more naturally part of the underlying infrastrcture.</li>
<li>Our current proposal provides channel binding between TLS and EAP, to counter the MITM attacks described in <a href="#MITM">[MITM]</a>. TLS does not provide any standard way of extracting cryptographic material from the TLS state, and in most implementations, the TLS state is not exposed to the protected application. Because of this, it is difficult for application designers to bind the user authentication to the protected channel provided by TLS.</li>
</ul>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> <a href="#mustshouldmay" id="mustshouldmay">Conventions Used in This Document</a>
</h1>
<p id="rfc.section.1.3.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#usecase" id="usecase">Operating Environment</a>
</h1>
<div id="#rfc.figure.1"></div>
<pre>
 
     Client                         Server
 +-------------------------+     +------------------------+
 |  |GUI| | Client | |TLS+-+-----+-+TLS|   |Server      | |
 |  +-^-+ |Software| +-^-+ |     +-+-^-+   |Application | |
 |    |   +--------+   |   |     |   |     |Software    | |
 |    |                |   |     |   |     +------------+ |
 |  +-v----------------v-+ |     |   |                    |
 |  |   EAP              | |     +---|--------------------+
 |  |  Infrastructure    | |         |
 |  +--------------------+ |         |    +--------+
 +-------------------------+         |    | AAA    |
                                     |    | Server |
                                     +-----        |
                                          +--------+
</pre>
<p id="rfc.section.2.p.1">TEE will work between a client application and a server application, performing either client authentication or mutual authentication within the TLS exchange.</p>
<p id="rfc.section.2.p.2">The above diagram shows the typical deployment. The client has software that either includes a UI for some EAP methods, or else is able to invoke some operating system EAP infrastructure that takes care of the user interaction. Although the technical mechanisms have been standardized for a AAA client to dynamically discover a AAA server often the address of the AAA server is statically configured. Typically the AAA server communicates using the RADIUS protocol with EAP (<a href="#RADIUS">[RADIUS]</a> and <a href="#RAD-EAP">[RAD-EAP]</a>), or the Diameter protocol (<a href="#Diameter">[Diameter]</a> and <a href="#Dia-EAP">[Dia-EAP]</a>).</p>
<p id="rfc.section.2.p.3">As stated in the introduction, we expect TEE to be used in both browsers and applications. Further uses may be authentication and key generation for other protocols, and tunneling clients, which so far have not been standardized.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#protocol" id="protocol">Protocol Overview</a>
</h1>
<p id="rfc.section.3.p.1">When TLS is used with EAP, additional records are sent after the ChangeCipherSpec protocol message and before the Finished message, effectively creating an extended handshake before the application layer data can be sent. Each EapMsg handshake record contains exactly one EAP message.  Using EAP for client authentication allows TLS to be used with various AAA back-end servers such as RADIUS or Diameter.</p>
<p id="rfc.section.3.p.2">TLS with EAP may be used for securing a data connection such as HTTP or POP3. We believe it has three main benefits:</p>

<ul>
<li>The ability of EAP to work with backend servers can remove that burden from the application layer.</li>
<li>Moving the user authentication into the TLS handshake protects the presumably less secure application layer from attacks by unauthenticated parties.</li>
<li>Using mutual authentication methods within EAP can help thwart certain classes of phishing attacks.</li>
</ul>
<p id="rfc.section.3.p.3">The TEE extension defines the following: </p>

<ul>
<li>A new extension type called tee_supported, used to indicate that the communicating application (either client or server) supports this extension.</li>
<li>A new message type for the handshake protocol, called EapMsg, which is used to carry a single EAP message.</li>
<li>A new message type for the handshake protocol, called EapFinished, which is used to sign previous messages.</li>
</ul>
<div id="#rfc.figure.2"></div>
<pre>
      Client                                               Server
      ------                                               ------

      ClientHello(*)             --------&gt;
                                                   ServerHello(*)
                                                    (Certificate)
                                                ServerKeyExchange
                                         EapMsg(Identity-Request)
                                  &lt;--------       ServerHelloDone
      ClientKeyExchange
      (CertificateVerify)
      ChangeCipherSpec
      Finished
      EapMsg(Identity-Reply)     --------&gt;
                                                 ChangeCipherSpec
                                                         Finished
                                             EapMsg(GPSK-Request)
                                 &lt;--------    
      EapMsg(GPSK-Reply)         --------&gt;
                                             EapMsg(GPSK-Request)
                                 &lt;--------    
      EapMsg(GPSK-Reply)         --------&gt;
                                                  EapMsg(Success)
                                 &lt;--------            EaoFinished                                                      
      EapFinished                --------&gt;
         
    (*) The ClientHello and ServerHello include the tee_supported 
        extension to indicate support for TEE

</pre>
<p id="rfc.section.3.p.4">The diagram below outlines the protocol structure.  For illustration purposes only, we use EAP Generalized Pre-Shared Key (EAP-GPSK) method <a href="#RFC5433">[RFC5433]</a>.  This method is a lightweight shared-key authentication protocol supporting mutual authentication and key derivation.</p>
<p id="rfc.section.3.p.5">The client indicates in the first message its support for TEE. The server sends an EAP identity request in the reply. The client sends the identity reply after the handshake completion.  The EAP request-response sequence continues until the client is either authenticated or rejected.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#eaptls_ind" id="eaptls_ind">The tee_supported Extension</a>
</h1>
<p id="rfc.section.3.1.p.1">The tee_supported extension is a ClientHello and ServerHello extension as defined in section 2.3 of <a href="#TLS-EXT">[TLS-EXT]</a>.  The extension_type field is TBA by IANA. The extension_data is zero-length.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#eaptls_interim" id="eaptls_interim">The EapFinished Handshake Message</a>
</h1>
<p id="rfc.section.3.2.p.1">The EapFinished message is identical in syntax to the Finished message described in section 7.4.9 of <a href="#TLS">[TLS]</a>. It is calculated in exactly the same way.</p>
<p id="rfc.section.3.2.p.2">When TEE is used, application data cannot follow the "Finished" message. Instead, it may only begin after the EapFinished message</p>
<p id="rfc.section.3.2.p.3">The HandshakeType value for the EapFinished handshake message is TBA by IANA.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#eaptls_eap" id="eaptls_eap">The EapMsg Handshake Message</a>
</h1>
<p id="rfc.section.3.3.p.1">The EapMsg handshake message carries exactly one EAP message as defined in <a href="#EAP">[EAP]</a>.</p>
<p id="rfc.section.3.3.p.2">The HandshakeType value for the EapMsg handshake message is TBA by IANA.</p>
<p id="rfc.section.3.3.p.3">The EapMsg message is used to tunnel EAP messages between the authentication server, which may be co-located with the TLS server, or else may be a separate AAA server, and the supplicant, which is co-located with the TLS client. TLS on either side receives the EAP data from the EAP infrastructure, and treats it as opaque. TLS does not make any changes to the EAP payload or make any decisions based on the contents of an EapMsg handshake message.</p>
<div id="#rfc.figure.3"></div>
<pre>
      struct {
          opaque eap_payload[4..65535];
      } EapMsg;
</pre>
<p id="rfc.section.3.3.p.4">Note that it is expected that the authentication server notifies the TLS server about authentication success or failure, and so TLS need not inspect the eap_payload within the EapMsg to detect success or failure.  </p>
<p id="rfc.section.3.3.p.5">eap_payload is defined in section 4 of RFC 3748. It includes the Code, Identifier, Length and Data fields of the EAP packet.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#MSK_finished" id="MSK_finished">Calculating the EapFinished message</a>
</h1>
<div id="#rfc.figure.4"></div>
<pre>
      struct {
          opaque verify_data[12];
      } Finished;

      verify_data
          PRF(MSK, finished_label, MD5(handshake_messages) +
          SHA-1(handshake_messages)) [0..11];
</pre>
<p id="rfc.section.3.4.p.1">If the EAP method is key-generating (see <a href="#RFC5247">[RFC5247]</a>), the Finished message is calculated as follows: </p>
<p id="rfc.section.3.4.p.2">The finished_label and the PRF are as defined in section 7.4.9 of <a href="#TLS">[TLS]</a>.</p>
<p id="rfc.section.3.4.p.3">The handshake_messages field does not include all the data in the handshake. Instead it includes only the data that has not been signed by the previous Finished message. The handshake_messages field includes all of the octets beginning with and including the Finished message, up to but not including this EapFinished message.  This is the concatenation of all the Handshake structures exchanged thus far, and not yet signed, as defined in section 7.4 of <a href="#TLS">[TLS]</a>and in this document.</p>
<p id="rfc.section.3.4.p.4">The Master Session Key (MSK) is derived by the AAA server and by the client if the EAP method is key-generating. On the server-side, it is typically received from the AAA server over the RADIUS or Diameter protocol. On the client-side, it is passed to TLS by some other method.</p>
<p id="rfc.section.3.4.p.5">If the EAP method is not key-generating, then the master_secret is used to sign the messages instead of the MSK. For a discussion on the use of such methods, see <a href="#signing">Section 4.1</a>.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#signing" id="signing">EapFinished vs. Finished</a>
</h1>
<p id="rfc.section.4.1.p.1">In regular TLS, the Finished message provides two functions: it signs all preceding messages, and it signals that application data can now be sent. In TEE, it only signs, and the signal is given by EapFinished.</p>
<p id="rfc.section.4.1.p.2">Many EAP methods, such as EAP-TLS, EAP-IKEv2 and EAP-SIM, generate keys in addition to authenticating clients.  Such methods are resistant to man-in-the-middle (MITM) attacks, as discussed in <a href="#MITM">[MITM]</a> and are called key-generating methods.</p>
<p id="rfc.section.4.1.p.3">To realize the benefit of such methods, we need to verify the key that was generated within the EAP method. This is referred to as the MSK in EAP. In TEE, the EapFinished message signs the messages that have not yet been signed by the Finished message using the MSK if such exists. If not, then the messages are signed with the master_secret as in regular TLS.</p>
<p id="rfc.section.4.1.p.4">The need for signing twice arises from the fact that we need to use both the master_secret and the MSK. It was possible to use just one Finished record and blend the MSK into the master_secret. However, this would needlessly complicate the protocol and make security analysis more difficult. Instead, we have decided to follow the example of IKEv2, where two AUTH payloads are exchanged.</p>
<p id="rfc.section.4.1.p.5">It should be noted that using non-key-generating methods may expose the client to a MITM attack if the same method and credentials are used in some other situation, in which the EAP is done outside of a protected tunnel with an authenticated server. Unless it can be determined that the EAP method is never used in such a situation, non-key-generating methods SHOULD NOT be used. This issue is discussed extensively in <a href="#Compound-Authentication">[Compound-Authentication]</a>.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#iprotection" id="iprotection">Identity Protection</a>
</h1>
<p id="rfc.section.4.2.p.1">Unlike <a href="#TLS-PSK">[TLS-PSK]</a>, TEE provides identity protection for the client.  The client's identity is hidden from a passive eavesdropper using TLS encryption. Active attacks are discussed in <a href="#mauthentication">Section 4.3</a>.</p>
<p id="rfc.section.4.2.p.2">We could save one round-trip by having the client send its identity within the Client Hello message. This is similar to TLS-PSK. However, we believe that identity protection is a worthy enough goal, so as to justify the extra round-trip.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#mauthentication" id="mauthentication">Mutual Authentication</a>
</h1>
<p id="rfc.section.4.3.p.1">In order to achieve our security goals, we need to have both the server and the client authenticate. Client authentication is obviously done using the EAP method. The server authentication can be done in either of two ways:</p>

<ol>
<li>The client can verify the server certificate. This may work well depending on the scenario, but implies that the client or its user can recognize the right DN or alternate name, and distinguish it from plausible alternatives. The introduction to <a href="#I.D.Webauth-phishing">[I.D.Webauth-phishing]</a> shows that at least in HTTPS, this is not always the case.</li>
<li>The client can use a mutually authenticated (MA) EAP method, such as EAP-GPSK. The client would be authenticated to the AAA server and vice versa. Additionally authenticating the application server to the client is not necessary and the TLS handshake may as well be anonymous.  Note that the authenticated client identity may be sent from the AAA server to the application server (acting as a AAA client) if the authenticated identity indeed matters for the purpose of the service fulfillment and with the user's permission. </li>
</ol>
<p id="rfc.section.4.3.p.2">To summarize: </p>

<ul>
<li>Clients MUST NOT propose anonymous ciphersuites, unless they support MA EAP methods.</li>
<li>Clients MUST NOT accept non-MA methods if the ciphersuite is anonymous.</li>
<li>Clients MUST NOT accept non-MA methods if they are not able to verify the server credentials.  Note that this document does not define what verification involves. If the server DN is known and stored on the client, verifying certificate signature and checking revocation may be enough. For web browsers, the case is not as clear cut, and MA methods SHOULD be used.</li>
</ul>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#performance" id="performance">Performance Considerations</a>
</h1>
<p id="rfc.section.5.p.1">Regular TLS adds two round-trips to a TCP connection. However, because of the stream nature of TCP, the client does not really need to wait for the server's Finished message, and can begin sending application data immediately after its own Finished message. In practice, many clients do so, and TLS only adds one round-trip of delay.</p>
<p id="rfc.section.5.p.2">TEE adds as many round-trips as the EAP method requires. For example, EAP-MD5 requires 1 round-trip, while EAP-GPSK requires 2 round-trips. Additionally, the client MUST wait for the EAP-Success message before sending its own Finished message, so we need at least 3 round-trips for the entire handshake. The best a client can do is two round-trips plus however many round-trips the EAP method requires.</p>
<p id="rfc.section.5.p.3">It should be noted, though, that these extra round-trips save processing time at the application level. Two extra round-trips take a lot less time than presenting a log-in web page and processing the user's input.</p>
<p id="rfc.section.5.p.4">It should also be noted, that TEE reverses the order of the Finished messages. In regular TLS the client sends the Finished message first. In TEE it is the server that sends the Finished message first. This should not affect performance, and it is clear that the client may send application data immediately after the Finished message.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#opcons" id="opcons">Operational Considerations</a>
</h1>
<p><a href="#mauthentication">Section 4.3</a> defines a dependency between the TLS state and the EAP state in that it mandates that certain EAP methods should not be used with certain TLS ciphersuites. To avoid such dependencies, there are two approaches that implementations can take. They can either not use any anonymous ciphersuites, or else they can use only MA EAP methods.</p>
<p id="rfc.section.6.p.2">Where certificate validation is problematic, such as in browser-based HTTPS, we recommend the latter approach.</p>
<p id="rfc.section.6.p.3">In cases where the use of EAP within TLS is not known before opening the connection, it is necessary to consider the implications of requiring the user to type in credentials after the connection has already started. TCP sessions may time out, because of security considerations, and this may lead to session setup failure.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">IANA is asked to assign an extension type value from the "ExtensionType Values" registry for the tee_supported extension.</p>
<p id="rfc.section.7.p.2">IANA is asked to assign two handshake message types from the "TLS HandshakeType Registry", one for "EapMsg" and one for "EapFinished".</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#ia" id="ia">Acknowledgments</a>
</h1>
<p id="rfc.section.8.p.1">The authors would like to thank Josh Howlett for his comments.</p>
<p id="rfc.section.8.p.2">The TLS Inner Application Extension work (<a href="#TLS/IA">[TLS/IA]</a>) has inspired the authors to create this simplified work. TLS/IA provides a somewhat different approach to integrating non-certificate credentials into the TLS protocol, in addition to several other features available from the RADIUS namespace.</p>
<p id="rfc.section.8.p.3">The authors would also like to thank the various contributors to <a href="#RFC5996">[RFC5996]</a> whose work inspired this one.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#delta" id="delta">Changes from Previous Versions</a>
</h1>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> <a href="#delta_02" id="delta_02">Changes in version -02</a>
</h1>
<p></p>

<ul><li>Added discussion of alternative designs.</li></ul>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> <a href="#delta_01" id="delta_01">Changes in version -01</a>
</h1>
<p></p>

<ul>
<li>Changed the construction of the Finished message</li>
<li>Replaced MS-CHAPv2 with GPSK in examples.</li>
<li>Added open issues section.</li>
<li>Added reference to <a href="#Compound-Authentication">[Compound-Authentication]</a>
</li>
<li>Fixed reference to MITM attack</li>
</ul>
<h1 id="rfc.section.9.3">
<a href="#rfc.section.9.3">9.3.</a> <a href="#delta_pm" id="delta_pm">Changes from the protocol model draft</a>
</h1>
<p></p>

<ul>
<li>Added diagram for EapMsg</li>
<li>Added discussion of EAP applicability</li>
<li>Added discussion of mutually-authenticated EAP methods vs other methods in the security considerations.</li>
<li>Added operational considerations.</li>
<li>Other minor nits.</li>
</ul>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="1">[1]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="2">[2]</b></td>
<td class="top">
<a>Blake-Wilson, S.</a>, <a>Nystrom, M.</a>, <a>Hopwood, D.</a>, <a>Mikkelsen, J.</a> and <a>T. Wright</a>, "<a href="http://tools.ietf.org/html/rfc4366">Transport Layer Security (TLS) Extensions</a>", RFC 4366, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="3">[3]</b></td>
<td class="top">
<a>Aboba, B.</a>, <a>Blunk, L.</a>, <a>Vollbrecht, J.</a>, <a>Carlson, J.</a> and <a>H. Levkowetz</a>, "<a href="http://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>", RFC 3748, June 2004.</td>
</tr>
<tr>
<td class="reference"><b id="4">[4]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="1">[1]</b></td>
<td class="top">
<a title="Nokia Research Center ">Asokan, N</a>, <a title="Nokia Research Center ">Niemi, V</a> and <a title="Nokia Research Center ">K Nyberg</a>, "<a>Man-in-the-Middle in Tunneled Authentication Protocols</a>", IACR ePrint Archive , October 2002.</td>
</tr>
<tr>
<td class="reference"><b id="2">[2]</b></td>
<td class="top">
<a>Rigney, C.</a>, <a>Willens, S.</a>, <a>Rubens, A.</a> and <a>W. Simpson</a>, "<a href="http://tools.ietf.org/html/rfc2865">Remote Authentication Dial In User Service (RADIUS)</a>", RFC 2865, June 2000.</td>
</tr>
<tr>
<td class="reference"><b id="3">[3]</b></td>
<td class="top">
<a>Aboba, B.</a> and <a>P. Calhoun</a>, "<a href="http://tools.ietf.org/html/rfc3579">RADIUS (Remote Authentication Dial In User Service) Support For Extensible Authentication Protocol (EAP)</a>", RFC 3579, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="4">[4]</b></td>
<td class="top">
<a>Funk, P</a>, <a>Blake-Wilson, S</a>, <a>Smith, H</a>, <a>Tschofenig, N</a> and <a>T Hardjono</a>, "<a href="http://tools.ietf.org/html/draft-funk-tls-inner-application-extension-03">TLS Inner Application Extension (TLS/IA)</a>", Internet-Draft draft-funk-tls-inner-application-extension-03, June 2006.</td>
</tr>
<tr>
<td class="reference"><b id="5">[5]</b></td>
<td class="top">
<a>Eronen, P.</a> and <a>H. Tschofenig</a>, "<a href="http://tools.ietf.org/html/rfc4279">Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)</a>", RFC 4279, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="6">[6]</b></td>
<td class="top">
<a title="Microsoft">Kaufman, C</a>, <a title="VPN Consortium">Hoffman, P</a>, <a title="Check Point">Nir, Y</a> and <a title="Nokia">P Eronen</a>, "<a href="http://tools.ietf.org/html/rfc5996">Internet Key Exchange Protocol: IKEv2</a>", RFC 5996, September 2010.</td>
</tr>
<tr>
<td class="reference"><b id="7">[7]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Loughney, J.</a>, <a>Guttman, E.</a>, <a>Zorn, G.</a> and <a>J. Arkko</a>, "<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>", RFC 3588, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="8">[8]</b></td>
<td class="top">
<a>Eronen, P.</a>, <a>Hiller, T.</a> and <a>G. Zorn</a>, "<a href="http://tools.ietf.org/html/rfc4072">Diameter Extensible Authentication Protocol (EAP) Application</a>", RFC 4072, August 2005.</td>
</tr>
<tr>
<td class="reference"><b id="9">[9]</b></td>
<td class="top">
<a>Clancy, T</a> and <a>H Tschofenig</a>, "<a href="http://tools.ietf.org/html/rfc5433">EAP Generalized Pre-Shared Key (EAP-GPSK)</a>", RFC 5433, February 2009.</td>
</tr>
<tr>
<td class="reference"><b id="10">[10]</b></td>
<td class="top">
<a>Hartman, S</a>, "<a href="http://tools.ietf.org/html/draft-hartman-webauth-phishing-09">Requirements for Web Authentication Resistant to Phishing</a>", Internet-Draft draft-hartman-webauth-phishing-09, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="11">[11]</b></td>
<td class="top">
<a>Aboba, B</a>, <a>Simon, D</a> and <a>P Eronen</a>, "<a href="http://tools.ietf.org/html/rfc5247">Extensible Authentication Protocol (EAP) Key Management Framework</a>", RFC 5247, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="12">[12]</b></td>
<td class="top">
<a title="Intel Corporation">Puthenkulam, J</a>, <a title="Intel Corporation">Lortz, V</a>, <a title="Microsoft">Palekar, A</a> and <a title="Microsoft">D Simon</a>, "<a href="http://tools.ietf.org/html/draft-puthenkulam-eap-binding-04">The Compound Authentication Binding Problem</a>", Internet-Draft draft-puthenkulam-eap-binding-04, October 2003.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Yoav Nir</span> 
	  <span class="n hidden">
		<span class="family-name">Nir</span>
	  </span>
	</span>
	<span class="org vcardline">Check Point Software Technologies Ltd.</span>
	<span class="adr">
	  <span>5 Hasolelim st.</span>

	  <span class="vcardline">
		<span class="locality">Tel Aviv</span>,  
		<span class="region"></span>
		<span class="code">67897</span>
	  </span>
	  <span class="country-name vcardline">Israel</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ynir@checkpoint.com">ynir@checkpoint.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Yaron Sheffer</span> 
	  <span class="n hidden">
		<span class="family-name">Sheffer</span>
	  </span>
	</span>
	<span class="org vcardline">Independent</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:yaronf.ietf@gmail.com">yaronf.ietf@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Hannes Tschofenig</span> 
	  <span class="n hidden">
		<span class="family-name">Tschofenig</span>
	  </span>
	</span>
	<span class="org vcardline">Nokia Siemens Networks</span>
	<span class="adr">
	  <span>Linnoitustie 6</span>

	  <span class="vcardline">
		<span class="locality">Espoo</span>,  
		<span class="region"></span>
		<span class="code">02600</span>
	  </span>
	  <span class="country-name vcardline">Finland</span>
	</span>
	<span class="vcardline">Phone: +358 (50) 4871445</span>

<span class="vcardline">EMail: <a href="mailto:Hannes.Tschofenig@gmx.net">Hannes.Tschofenig@gmx.net</a></span>

<span class="vcardline">URI: <a href="http://www.tschofenig.priv.at">http://www.tschofenig.priv.at</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Peter Gutmann</span> 
	  <span class="n hidden">
		<span class="family-name">Gutmann</span>
	  </span>
	</span>
	<span class="org vcardline">University of Auckland</span>
	<span class="adr">
	  <span>Department of Computer Science</span>

	  <span class="vcardline">
		<span class="locality">University of Auckland</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">New Zealand</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:pgut001@cs.auckland.ac.nz">pgut001@cs.auckland.ac.nz</a></span>

  </address>
</div>

</body>
</html>