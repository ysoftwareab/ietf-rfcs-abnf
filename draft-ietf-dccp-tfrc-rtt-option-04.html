<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Sender RTT Estimate Option for DCCP</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Problems caused by sampling the RTT at the receiver">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 List of problems encountered with a real implementation">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Other areas affected by the RTT sampling problems">
<link href="#rfc.section.2.2.1" rel="Chapter" title="2.2.1 Measured Receive Rate X_recv">
<link href="#rfc.section.2.2.2" rel="Chapter" title="2.2.2 Disambiguation and Accuracy of Loss Intervals">
<link href="#rfc.section.2.2.3" rel="Chapter" title="2.2.3 Determining Quiescence">
<link href="#rfc.section.2.2.4" rel="Chapter" title="2.2.4 Practical Considerations">
<link href="#rfc.section.3" rel="Chapter" title="3 Specification">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Conventions">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Options and Features">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 RTT Estimate Option">
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 Send RTT Estimate Feature">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Basic Usage">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Receiver Robustness Measures">
<link href="#rfc.section.4" rel="Chapter" title="4 Security Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Option Types">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Feature Numbers">
<link href="#rfc.references" rel="Chapter" title="6 References">
<link href="#rfc.references.1" rel="Chapter" title="6.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="6.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document specifies an update to the round trip time (RTT) estimation algorithm used for TFRC (TCP Friendly Rate Control) congestion control by the Datagram Congestion Control Protocol (DCCP). It updates specifications for the CCID-3 and CCID-4 Congestion Control IDs of DCCP." />
  <meta name="description" content="This document specifies an update to the round trip time (RTT) estimation algorithm used for TFRC (TCP Friendly Rate Control) congestion control by the Datagram Congestion Control Protocol (DCCP). It updates specifications for the CCID-3 and CCID-4 Congestion Control IDs of DCCP." />
  <meta name="keywords" content="DCCP, TFRC, CCID-3, CCID-4, Internet-Draft" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">DCCP Working Group</td>
<td class="right">G. Renker</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">G. Fairhurst</td>
</tr>
<tr>
<td class="left">Updates: 4342, 5622 (if approved)</td>
<td class="right">University of Aberdeen</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">March 09, 2011</td>
</tr>
<tr>
<td class="left">Expires: September 10, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Sender RTT Estimate Option for DCCP<br />
  <span class="filename">draft-ietf-dccp-tfrc-rtt-option-04.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies an update to the round trip time (RTT) estimation algorithm used for TFRC (TCP Friendly Rate Control) congestion control by the Datagram Congestion Control Protocol (DCCP). It updates specifications for the CCID-3 and CCID-4 Congestion Control IDs of DCCP.</p>
<p>The update addresses parameter-estimation problems occurring with TFRC-based DCCP congestion control. It uses a recommendation made in the original TFRC specification to avoid the inherent problems of receiver-based RTT sampling, by utilising higher-accuracy RTT samples already available at the sender.</p>
<p>It is integrated into the feature set of DCCP as an end-to-end negotiable extension.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 10, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Problems caused by sampling the RTT at the receiver</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">List of problems encountered with a real implementation</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Other areas affected by the RTT sampling problems</a>
</li>
<li>2.2.1.   <a href="#rfc.section.2.2.1">Measured Receive Rate X_recv</a>
</li>
<li>2.2.2.   <a href="#rfc.section.2.2.2">Disambiguation and Accuracy of Loss Intervals</a>
</li>
<li>2.2.3.   <a href="#rfc.section.2.2.3">Determining Quiescence</a>
</li>
<li>2.2.4.   <a href="#rfc.section.2.2.4">Practical Considerations</a>
</li>
<li>3.   <a href="#rfc.section.3">Specification</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Conventions</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Options and Features</a>
</li>
<li>3.2.1.   <a href="#rfc.section.3.2.1">RTT Estimate Option</a>
</li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">Send RTT Estimate Feature</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Basic Usage</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Receiver Robustness Measures</a>
</li>
<li>4.   <a href="#rfc.section.4">Security Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Option Types</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Feature Numbers</a>
</li>
<li>6.   <a href="#rfc.references">References</a>
</li>
<li>6.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>6.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#INTRO" id="INTRO">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This document defines a Standards Track update to both a sender and receiver that implement DCCP CCID-3 <a href="#RFC4342">[RFC4342]</a> or CCID-4 <a href="#RFC5622">[RFC5622]</a>, addressing RTT estimation problems that were observed when using a real implementation.</p>
<p id="rfc.section.1.p.2">To fix these problems, this document presents a solution based on a concept first recommended in <a href="#RFC5348">[RFC5348]</a>, 3.2.1; i.e. to measure the RTT at the sender. This results in a higher reliability and frequency of samples, and avoids the inherent problems of receiver-based RTT sampling discussed below.</p>
<p id="rfc.section.1.p.3">We begin by analysing the encountered problems in the next section. The update is presented in <a href="#SPECIFICATION">Section 3</a>. We then discuss security considerations in <a href="#SECURITY">Section 4</a>, and list the resulting IANA considerations in <a href="#IANA">Section 5</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#RATIONALE" id="RATIONALE">Problems caused by sampling the RTT at the receiver</a>
</h1>
<p id="rfc.section.2.p.1">There are at least six areas that make a TFRC receiver vulnerable to inaccuracies or absence of (receiver-based) RTT samples: </p>

<ul>
<li>the measured sending rate, X_recv (<a href="#RFC5348">[RFC5348]</a>, 6.2);</li>
<li>synthesis of the first loss interval (<a href="#RFC5348">[RFC5348]</a>, 6.3.1);</li>
<li>disambiguation of loss events (<a href="#RFC4342">[RFC4342]</a>, 10.2);</li>
<li>validation of loss intervals (<a href="#RFC4342">[RFC4342]</a>, 6.1);</li>
<li>ensuring that at least one feedback packet is sent per RTT (<a href="#RFC4342">[RFC4342]</a>, 10.3);</li>
<li>determining quiescence periods (<a href="#RFC4342">[RFC4342]</a>, 6.4).</li>
</ul>

<p> </p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> List of problems encountered with a real implementation</h1>
<p id="rfc.section.2.1.p.1">This section summarizes several years of experience using the Linux implementation of CCID-3 and CCID-4. It lists the problems encountered with receiver-based RTT sampling over real networks, in a variety of wired and wireless environments and under different link-layer conditions.</p>
<p id="rfc.section.2.1.p.2">The Linux DCCP/TFRC implementation is based on the RTT-sampling algorithm specified in <a href="#RFC4342">[RFC4342]</a>, 8.1.  This algorithm relies on a coarse-grained window-counter (units of RTT/4), and uses packet inter-arrival times to estimate the current RTT of the network.</p>
<p id="rfc.section.2.1.p.3">The algorithm is effective only for packets with modulo-16 CCVal differences less than 5, due to limitations noted in sections 8.1 and 10.3 of <a href="#RFC4342">[RFC4342]</a>. A CCVal difference less than 4 means sampling at sub-RTT scale; <a href="#RFC4342">[RFC4342]</a>, 8.1 thus suggests differences between 2 and 4, the latter being preferable (equivalent to a full RTT). The same section limits the maximum CCVal difference between data-carrying packets to 5, in order to avoid wrap-around. As a consequence, it is not possible to determine the timing interval for adjacent packets with a CCVal difference greater than 4: such samples have to be discarded.</p>
<p id="rfc.section.2.1.p.4">A second problem arises when there are holes in the sequence space. Because the 4-bit CCVal counter may cycle around multiple times, it is not possible to determine window-counter wrap-around whenever sequence numbers of subsequent packets are not immediately adjacent. This problem occurs when packets are delayed, reordered, or lost in the network.</p>
<p id="rfc.section.2.1.p.5">As a consequence, RTT sampling has to be paused during times of loss. This however aggravates the problem, since the sender now requires new feedback from the receiver, but the receiver is unable to provide accurate and up-to-date information: the receiver is unable to sample the RTT, accordingly also not able to estimate X_recv correctly, which then in turn affects X_Bps at the sender.</p>
<p id="rfc.section.2.1.p.6">The third limitation arises from using inter-arrival times as representatives of network inter-packet gaps. It is well known that the inter-packet gap of packets is not constant along a network path.  Furthermore, modern network interface cards do not necessarily deliver each packet at the time it is received, but rather in a bunch, to avoid  overly frequent interrupts <a href="#MR97">[MR97]</a>.  As a result, inter-packet arrival times may converge to zero, when subsequent packets are being delivered at virtually the same time.</p>
<p id="rfc.section.2.1.p.7">The fourth problem is that of under-sampling and thus related to the first limitation. If loss occurs while the receiver has not yet had a chance to sample the RTT, it needs to fall back to some fixed RTT constant to plug into the equation of <a href="#RFC5348">[RFC5348]</a>, 6.3.1. (The sender, for example, uses a fixed value of 1 second when it is unable to obtain an initial RTT sample, see <a href="#RFC5348">[RFC5348]</a>, 4.2).</p>
<p id="rfc.section.2.1.p.8">In particular, if the loss is caused by a transient condition, this fourth problem causes a subsequent deterioration of the connection (rate reduction), further aggravated by the fact that TFRC takes longer than common window-based protocols to recover from a reduction of its allowed sending rate.</p>
<p id="rfc.section.2.1.p.9">Trying to smooth over these effects by imposing heavy filtering on the RTT samples did not substantially improve the situation, nor does it solve the problem of under-sampling.</p>
<p id="rfc.section.2.1.p.10">The TFRC sender, on the other hand, is much better equipped to estimate the RTT and can do this more accurately.  This is in particular due to the use of timestamps and elapsed time information (<a href="#RFC5348">[RFC5348]</a>, 3.2.2), which are mandatory in CCID-3 (sections 6 and 8.2 of <a href="#RFC4342">[RFC4342]</a>).</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Other areas affected by the RTT sampling problems</h1>
<p id="rfc.section.2.2.p.1">We here analyse the impact that unreliability of receiver-based RTT sampling has on the areas listed at the begin of this section.</p>
<p id="rfc.section.2.2.p.2">In addition, benefits of sender-based RTT sampling have already been pointed out in <a href="#RFC5348">[RFC5348]</a>, and in the specification of CCID-3 <a href="#RFC4342">[RFC4342]</a>, at the end of section 10.2.</p>
<h1 id="rfc.section.2.2.1">
<a href="#rfc.section.2.2.1">2.2.1.</a> Measured Receive Rate X_recv</h1>
<p id="rfc.section.2.2.1.p.1">A key problem is that the reliability of X_recv <a href="#RFC4342">[RFC4342]</a> depends directly upon the reliability and accuracy of RTT samples. This means that failures propagate from one parameter to another.</p>
<p id="rfc.section.2.2.1.p.2">Errata IDs 610 and 611 update <a href="#RFC4342">[RFC4342]</a> to use the definition of the receive rate as specified in <a href="#RFC5348">[RFC5348]</a>.</p>
<p id="rfc.section.2.2.1.p.3">Having an explicit (rather than a coarse-grained) RTT estimate allows measurement of X_recv with greater accuracy, and isolates failure.</p>
<p id="rfc.section.2.2.1.p.4">An explicit RTT estimate also enables the receiver to more accurately perform the test in step (2) of <a href="#RFC4342">[RFC4342]</a>, 6.2, i.e. to check whether less or more than one RTT has passed since the last feedback.</p>
<h1 id="rfc.section.2.2.2">
<a href="#rfc.section.2.2.2">2.2.2.</a> Disambiguation and Accuracy of Loss Intervals</h1>
<p id="rfc.section.2.2.2.p.1">Since a loss event is defined as one or more lost (or ECN-marked) data packets in one RTT (<a href="#RFC5348">[RFC5348]</a>, 5.2), the receiver needs accurate RTT estimates to validate and accurately separate loss events.  Moreover, <a href="#RFC5348">[RFC5348]</a>, 5.2 expressly points out the sender RTT estimate as RECOMMENDED for this purpose.</p>
<p id="rfc.section.2.2.2.p.2">Having the sender RTT Estimate available further increases the accuracy of the information reported by the receiver.  The definition of Loss Intervals in <a href="#RFC4342">[RFC4342]</a>, 6.1 needs the RTT to separate the lossy parts; in particular, lossy parts spanning a period of more than one RTT are invalid.</p>
<p id="rfc.section.2.2.2.p.3">A similar benefit arises in the computation of the loss event rate: as discussed in section 9.2 of <a href="#RFC4342">[RFC4342]</a>, it may happen that sender and receiver compute different loss event rates, due to differences in the available timing information. An explicit RTT estimate increases the accuracy of information available at the receiver, thus the sender may not need to recompute the (less reliable) loss event rate reported by the receiver.</p>
<h1 id="rfc.section.2.2.3">
<a href="#rfc.section.2.2.3">2.2.3.</a> Determining Quiescence</h1>
<p id="rfc.section.2.2.3.p.1">The quiescence period is defined as max(2 * RTT, 0.2 sec) in section 6.4 of <a href="#RFC4342">[RFC4342]</a>.  An explicit RTT estimate avoids under- and over-estimating quiescence periods.</p>
<h1 id="rfc.section.2.2.4">
<a href="#rfc.section.2.2.4">2.2.4.</a> Practical Considerations</h1>
<p id="rfc.section.2.2.4.p.1">Using explicit RTT estimates contributes to greater robustness and can also result in simpler implementation.</p>
<p id="rfc.section.2.2.4.p.2">First, it becomes easier to separate adjacent loss events. The 4-bit counter value wraps relatively frequently, which requires additional procedures to avoid aliasing effects.</p>
<p id="rfc.section.2.2.4.p.3">Second, the receiver is better able to determine when to send feedback packets. It can perform the test described in step (2) of <a href="#RFC5348">[RFC5348]</a>, 6.2 more accurately. Moreover, unnecessary expiration of the nofeedback timer (as described in <a href="#RFC4342">[RFC4342]</a>, 10.3) can be avoided.</p>
<p id="rfc.section.2.2.4.p.4">Lastly, a sender-based RTT estimate option can be used by middleboxes to verify that a flow uses conforming end-to-end congestion control (<a href="#RFC4342">[RFC4342]</a>, 10.2).</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#SPECIFICATION" id="SPECIFICATION">Specification</a>
</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Conventions</h1>
<p id="rfc.section.3.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.3.1.p.2">This document uses the conventions of <a href="#RFC5348">[RFC5348]</a>, <a href="#RFC4340">[RFC4340]</a>, <a href="#RFC4342">[RFC4342]</a>, and <a href="#RFC5622">[RFC5622]</a>.</p>
<p id="rfc.section.3.1.p.3">All multi-byte field descriptions presented in this documented are in network byte order (most significant byte first).</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Options and Features</h1>
<p id="rfc.section.3.2.p.1">This document defines a single TFRC-specific option, RTT Estimate, described in the next subsection.</p>
<p id="rfc.section.3.2.p.2">Following the guidelines in <a href="#RFC4340">[RFC4340]</a>, section 15, the use of the RTT Estimate Option is governed by an associated feature, Send RTT Estimate Feature.  This feature is described in the second subsection.</p>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> <a href="#option" id="option">RTT Estimate Option</a>
</h1>
<p id="rfc.section.3.2.1.p.1">The sender communicates its current RTT estimate to the receiver using a RTT Estimate Option.</p>
<div id="#rfc.table.1"></div>
<div id="#option_table"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>The RTT Estimate Option defined by this document</caption>
<thead><tr>
<th class="center">Type</th>
<th class="center">Option Length</th>
<th class="center">Meaning</th>
<th class="center">DCCP Data?</th>
</tr></thead>
<tbody><tr>
<td class="center">XX</td>
<td class="center">3/4/5</td>
<td class="center">RTT Estimate</td>
<td class="center">Y</td>
</tr></tbody>
</table>
<p id="rfc.section.3.2.1.p.2">Column meanings are as per <a href="#RFC4340">[RFC4340]</a>, section 5.8 (table 3).  This option MAY be placed in any DCCP packet, has option number XX and a length of 3-5 bytes.</p>
<p id="rfc.section.3.2.1.p.3">A Sender RTT Estimate Option is valid if it satisfies one of the three following formats:</p>
<div id="#rfc.figure.1"></div>
<pre>
   +--------+--------+--------+
   |xxxxxxxx|00000011|  RTT   |
   +--------+--------+--------+
    Type=XX  Length=3  Estimate
</pre>
<div id="#rfc.figure.2"></div>
<pre>
   +--------+--------+--------+--------+
   |xxxxxxxx|00000100|       RTT       |
   +--------+--------+--------+--------+
    Type=XX  Length=4      Estimate
</pre>
<div id="#rfc.figure.3"></div>
<pre>
   +--------+--------+--------+--------+--------+
   |xxxxxxxx|00000101|           RTT            |
   +--------+--------+--------+--------+--------+
    Type=XX  Length=5          Estimate
</pre>
<p id="rfc.section.3.2.1.p.4">The 1..3 value bytes of the option data carry the current RTT estimate of the sender, using a granularity of 1 microsecond. This allows values up to 16.7 seconds (corresponding to 0xFFFFFE) to be communicated.</p>
<p id="rfc.section.3.2.1.p.5">The value 0xFFFFFF is reserved to indicate significant delay spikes, larger than 16.7 seconds. This is qualitative rather than quantitative information, to alert the receiver that there is a network problem (for instance jamming on a wireless channel).</p>
<p id="rfc.section.3.2.1.p.6">The use of the RTT Estimate Option on networks  with RTTs larger than 16.7 seconds is not specified by this document.</p>
<p id="rfc.section.3.2.1.p.7">A value of 0 indicates the absence of a valid RTT sample. The sender MUST set the value to 0 if it does not yet have an RTT estimate.</p>
<p id="rfc.section.3.2.1.p.8">The sender SHOULD select the smallest format suitable to carry the RTT estimate (i.e., less than 1 byte of leading zeroes).</p>
<h1 id="rfc.section.3.2.2">
<a href="#rfc.section.3.2.2">3.2.2.</a> <a href="#feature" id="feature">Send RTT Estimate Feature</a>
</h1>
<p id="rfc.section.3.2.2.p.1">The Send RTT Estimate feature lets endpoints negotiate whether the sender MUST provide RTT Estimate options on its data packets.</p>
<p id="rfc.section.3.2.2.p.2">Send RTT Estimate has feature number YY and is server-priority.  It takes one-byte Boolean values; values greater than 1 are reserved.</p>
<div id="#rfc.table.2"></div>
<div id="#feat_table"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>The Send RTT Estimate feature defined by this document</caption>
<thead><tr>
<th class="center">Number</th>
<th class="center">Meaning</th>
<th class="center">Rec'n Rule</th>
<th class="center">Initial Value</th>
<th class="center">Req'd</th>
</tr></thead>
<tbody><tr>
<td class="center">YY</td>
<td class="center">Send RTT Estimate</td>
<td class="center">SP</td>
<td class="center">0</td>
<td class="center">N</td>
</tr></tbody>
</table>
<p id="rfc.section.3.2.2.p.3">The column meanings are described in <a href="#RFC4340">[RFC4340]</a>, section 6.4.</p>
<p id="rfc.section.3.2.2.p.4">The Send RTT Estimate feature is OPTIONAL. An extension may implement it, but this specification does not require the feature to be understood by every DCCP implementation (see [RFC4340], section 15).  The feature is off by default (initial value of 0).</p>
<p id="rfc.section.3.2.2.p.5">DCCP B sends a "Mandatory Change R(Send RTT Estimate, 1)" to require DCCP A to send RTT Estimate options as part of its data traffic (DCCP A will reset the connection if it does not understand this feature).</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#usage" id="usage">Basic Usage</a>
</h1>
<p id="rfc.section.3.3.p.1">When the Send RTT Estimate Feature is enabled, the sender MUST provide an RTT Estimate Option on all of its Data, DataAck, Sync, and SyncAck packets. It MAY in addition provide the RTT Estimate Option on other packet types, such as DCCP-Ack.</p>
<p id="rfc.section.3.3.p.2">The sender MUST implement and continue to update the CCVal window counter as specified in <a href="#RFC4342">[RFC4342]</a>, section 8.1, even when the Send RTT Estimate Feature is on.</p>
<p id="rfc.section.3.3.p.3">When the Send RTT Estimate Feature is enabled, the receiver MUST use the value reported by the RTT Estimate Option in all places that require a RTT (listed at the begin of <a href="#RATIONALE">Section 2</a>).  If the receiver encounters an invalid RTT Estimate Option (<a href="#option">Section 3.2.1</a>), it MUST reset the connection with Reset Code 5, "Option Error", where the Data 1..3 fields are set to the first 3 bytes of the offending RTT Estimate Option.</p>
<p id="rfc.section.3.3.p.4">The receiver SHOULD track the long-term RTT estimate using a moving average, such as the one specified in <a href="#RFC5348">[RFC5348]</a>, 4.3. This long-term estimate is referred to as "receiver_RTT" below.</p>
<p id="rfc.section.3.3.p.5">When the Send RTT Estimate Feature is disabled, the receiver MUST estimate the RTT as previously specified in  <a href="#RFC4340">[RFC4340]</a>,  <a href="#RFC4342">[RFC4342]</a>, and  <a href="#RFC5622">[RFC5622]</a>.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#robustness" id="robustness">Receiver Robustness Measures</a>
</h1>
<p id="rfc.section.3.4.p.1">This subsection specifies robustness measures for the receiver when the Send RTT Estimate Feature is on.</p>
<p id="rfc.section.3.4.p.2">The 0-valued and 0xFFFFFF-valued RTT Estimate Options are both referred to as "no-number RTT options".  RTT Estimate Options with values in the range of 1..0xFFFFFE are analogously called "numeric RTT options".</p>
<p id="rfc.section.3.4.p.3">Until the first numeric RTT option arrives, the receiver MUST use a value of 0.5 seconds for receiver_RTT (to match the initial 2 second timeout of the TFRC nofeedback timer, <a href="#RFC5348">[RFC5348]</a>, 4.2).</p>
<p id="rfc.section.3.4.p.4">If the path RTT is known, e.g. from a previous connection <a href="#RFC2140">[RFC2140]</a>, the receiver MAY reuse the previously known path RTT value to seed its long-term RTT estimate.</p>
<p id="rfc.section.3.4.p.5">The sender MAY occasionally send no-number RTT options, covering for transient changes and spurious disruptions. During these times, the receiver SHOULD continue to use its long-term receiver_RTT value.</p>
<div id="#rfc.figure.4"></div>
<pre>
          receiver_RTT = MIN(2 * receiver_RTT, t_mbi)
</pre>
<p id="rfc.section.3.4.p.6">To avoid under-estimating the RTT in the absence of numeric options, the receiver MUST back off receiver_RTT in the following manner: if the sender supplies no-number RTT options for longer than receiver_RTT units of time, the receiver sets <a href="#RFC5348">[RFC5348]</a>, Appendix A). For the next round of no-number RTT options, the updated  value of receiver_RTT applies.</p>
<p id="rfc.section.3.4.p.7">This back-off mechanism ensures that short-term disruptions do not have a lasting impact, whereas long-term problems will result in asymptotically high receiver_RTT values.</p>
<p id="rfc.section.3.4.p.8">To bail out from a hanging session, the receiver MAY close the connection when receiver_RTT has reached the value MAX_RTT.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#SECURITY" id="SECURITY">Security Considerations</a>
</h1>
<p id="rfc.section.4.p.1">Security considerations for CCID-3 have been discussed in section 11 of <a href="#RFC4342">[RFC4342]</a>; for CCID-4 these have been discussed in section 13 of <a href="#RFC5622">[RFC5622]</a>, referring back to the same section of <a href="#RFC4342">[RFC4342]</a>.</p>
<p id="rfc.section.4.p.2">This document introduces an extension to communicate the current RTT estimate of the sender to the receiver of a TFRC communication.</p>
<p id="rfc.section.4.p.3">By altering the value of the RTT Estimate Option, it is possible to interfere with the behaviour of a flow using TFRC. In particular, since accuracy of the RTT estimate directly influences the accuracy of the measured sending rate X_recv, it would be possible to obtain either higher or lower sending rates than are warranted by the current network conditions.</p>
<p id="rfc.section.4.p.4">This is only possible if an attacker is on the same path as the DCCP sender and receiver, and is able to guess valid sequence numbers.  Therefore the considerations of section 18 in <a href="#RFC4340">[RFC4340]</a> apply.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">This document requests identical allocation in the dccp-ccid3-parameters and the dccp-ccid4-parameters registries.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Option Types</h1>
<p id="rfc.section.5.1.p.1">This document defines a single CCID-specific option for communicating RTT estimates from the HC-sender to the HC-receiver. Following <a href="#RFC4340">[RFC4340]</a>, 10.3, this requires an option number for the RTT Estimate Option in the range 128...191.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Feature Numbers</h1>
<p id="rfc.section.5.2.p.1">This document defines a single CCID-specific feature number for the Send RTT Estimate feature which is located at the HC-sender. Following <a href="#RFC4340">[RFC4340]</a>, 10.3, a feature number in the range 128...191 is required.</p>
<h1 id="rfc.references">
<a href="#rfc.references">6.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">6.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4340">[RFC4340]</b></td>
<td class="top">
<a>Kohler, E.</a>, <a>Handley, M.</a> and <a>S. Floyd</a>, "<a href="http://tools.ietf.org/html/rfc4340">Datagram Congestion Control Protocol (DCCP)</a>", RFC 4340, March 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4342">[RFC4342]</b></td>
<td class="top">
<a>Floyd, S.</a>, <a>Kohler, E.</a> and <a>J. Padhye</a>, "<a href="http://tools.ietf.org/html/rfc4342">Profile for Datagram Congestion Control Protocol (DCCP) Congestion Control ID 3: TCP-Friendly Rate Control (TFRC)</a>", RFC 4342, March 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5348">[RFC5348]</b></td>
<td class="top">
<a>Floyd, S.</a>, <a>Handley, M.</a>, <a>Padhye, J.</a> and <a>J. Widmer</a>, "<a href="http://tools.ietf.org/html/rfc5348">TCP Friendly Rate Control (TFRC): Protocol Specification</a>", RFC 5348, September 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">6.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2140">[RFC2140]</b></td>
<td class="top">
<a href="mailto:touch@isi.edu" title="University of Southern California/Information Sciences Institute">Touch, J.</a>, "<a href="http://tools.ietf.org/html/rfc2140">TCP Control Block Interdependence</a>", RFC 2140, April 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5622">[RFC5622]</b></td>
<td class="top">
<a>Floyd, S.</a> and <a>E. Kohler</a>, "<a href="http://tools.ietf.org/html/rfc5622">Profile for Datagram Congestion Control Protocol (DCCP) Congestion ID 4: TCP-Friendly Rate Control for Small Packets (TFRC-SP)</a>", RFC 5622, August 2009.</td>
</tr>
<tr>
<td class="reference"><b id="MR97">[MR97]</b></td>
<td class="top">
<a>Mogul, J. C.</a> and <a>K. K. Ramakrishnan</a>, "<a>Eliminating Receive Livelock in an Interrupt-Driven Kernel</a>", ACM Transactions on Computer Systems (TOCS), 15(3):217-252, August 1997.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Gerrit Renker</span> 
	  <span class="n hidden">
		<span class="family-name">Renker</span>
	  </span>
	</span>
	<span class="org vcardline">University of Aberdeen</span>
	<span class="adr">
	  <span>School of Engineering</span>
<span>Fraser Noble Building</span>

	  <span class="vcardline">
		<span class="locality">Aberdeen</span>,  
		<span class="region"></span>
		<span class="code">AB24 3UE</span>
	  </span>
	  <span class="country-name vcardline">Scotland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:gerrit@erg.abdn.ac.uk">gerrit@erg.abdn.ac.uk</a></span>

<span class="vcardline">URI: <a href="http://www.erg.abdn.ac.uk">http://www.erg.abdn.ac.uk</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Godred Fairhurst</span> 
	  <span class="n hidden">
		<span class="family-name">Fairhurst</span>
	  </span>
	</span>
	<span class="org vcardline">University of Aberdeen</span>
	<span class="adr">
	  <span>School of Engineering</span>
<span>Fraser Noble Building</span>

	  <span class="vcardline">
		<span class="locality">Aberdeen</span>,  
		<span class="region"></span>
		<span class="code">AB24 3UE</span>
	  </span>
	  <span class="country-name vcardline">Scotland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:gorry@erg.abdn.ac.uk">gorry@erg.abdn.ac.uk</a></span>

<span class="vcardline">URI: <a href="http://www.erg.abdn.ac.uk">http://www.erg.abdn.ac.uk</a></span>

  </address>
</div>

</body>
</html>