<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IPv6 Firewall Routing Header</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IPv6 Firewall Routing Header">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">T. Hain</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Cisco Systems</td></tr>
<tr><td class="header">Intended status:  Standards Track</td><td class="header">April 22, 2009</td></tr>
<tr><td class="header">Expires:  October 24, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />IPv6 Firewall Routing Header<br />draft-hain-ipv6-fwrh-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on October 24, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document specifies a routing header for use by firewalls to enforce routing symmetry. 
</p>
<p>The draft is being discussed on the ipv6@ietf.org list. 
</p>
<h3>Legal</h3>

<p>This documents and the information contained therein are provided on
      an "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
      OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
      THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR
      IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
      INFORMATION THEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
      WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
Mechanisms<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Firewall Routing Header Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
Routing Header Required ICMP Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
ReturnPathForwarding ICMP Error Message<br />
<a href="#anchor7">4.</a>&nbsp;
Examples<br />
<a href="#anchor8">5.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor9">6.</a>&nbsp;
Security Considerations<br />
<a href="#acks">7.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>With the deprecation of RH0   <a class='info' href='#RFC5095'>[RFC5095]<span> (</span><span class='info'>Abley, J., &ldquo;Deprecation of Type 0 Routing Headers in IPv6,&rdquo; December&nbsp;2007.</span><span>)</span></a>, the ability of a node to avoid the selection of different firewalls in opposing directions was eliminated.  Operation of stateful firewalls requires path symmetry at least through that device. The likelihood of asymmetry is particularly true on the Internet side, but is also a problem when the exit path changes on the private side during an established packet exchange. This document targets the specific use case of symmetric firewall selection, and then defines an IPv6 Firewall Routing Header and associated IPv6 ICMP error messages. Other use cases may take advantage of these mechanisms, but are explicitly out of scope for the development and definition here. While this Firewall Routing Header mechanism allows for changes in the firewalls in use during a packet exchange, any mechanisms that would be used to pass state between disperse firewalls is out of scope here. If those state passing mechanisms exist, it will be possible for an end-to-end packet exchange to persist during a routing shift, even over vast geographic path changes. Since the ability to force routing through a single intermediary can be used by attackers to receive traffic they otherwise would not, the ICMP error messages used here may be signed, and in any event should be dropped if originating outside of a policy domain. The method that a node would use to verify that signature is out of scope here.
</p>
<p>To deal with the asymmetry issue, a function specific IPv6 routing header is defined, the Firewall Routing Header (FWRH).  This routing header is used to pass information to a correspondent, so that return packets are routed through a firewall that is maintaining state for this transaction. A flag (Origin Flag) will be used to indicate which instance this is in the case where there are firewalls on each end (note: this assumes that a firewall would allow an initial inbound packet, then enforce subsequent packets through itself). There can be at most 2 (one with each value of the Origin Flag) FWRH's in any given extension header chain.
</p>
<p>An originating node is probably unaware of the presence of a firewall on its path to any given destination, so it will likely send an initial packet without the FWRH option.  (It may have cached the value received in a prior ICMP error message for non-local prefixes, and if so can optimistically minimize the chance for an initial error by including the cached value in the optional FWRH.) On receipt of any ICMP Routing Header Required message, the origin node will extract the return-via address from the ICMP, optionally verify any signature that may be present, then cache it for use over the lifetime of the current packet exchange, and optionally for use with other non-local prefixes. The packet which generated the error is reconstructed with the appropriate FWRH option, and resent. If the FWRH option with the appropriate Origin Flag value is missing when a packet is being sent outbound (from the perspective of the firewall - private toward public), or if the return-via address in the FWRH option does not match any address on the firewall that is processing the packet, an ICMP error (RHR type ???) is returned to the source address of the packet, indicating the value that is expected to result in return-path symmetry through an interface on this specific firewall. That ICMP error SHOULD be signed, and if so the ICMP packet indicates which signing method was used. Outbound packets with the matching Origin Flag and return-via address will receive normal firewall handling before forwarding. If the source address prefix does not match any prefix that being exchanged in routing protocols with the next hop, an RPF-error (type ??? +1) ICMP message should be returned. 
</p>
<p>The correspondent node will extract the return-via address from a received FWRH option with an Origin Flag that is opposite the one it will use when sending, and cache it for use related to this specific packet exchange.  When constructing packets related to this specific exchange; after all normal processing is complete, the ultimate destination address will be swapped into the FWRH with the appropriate Origin Flag, and the previously cached value from any received FWRH with the opposing Origin Flag will be swapped as the initial destination address of the packet. 
</p>
<p>Inbound packets to the public side of a firewall will be addressed with it as the destination address of the base IPv6 header, and the FWRH with the Origin flag matching existing state will contain the address of the ultimate destination.  The contents of the FWRH with the matching Origin flag will be swapped with the destination addresses in the packet, before normal firewall processing and forwarding. 
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate           Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Mechanisms</h3>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Firewall Routing Header Option</h3>

<p>The Firewall Routing header is used by an IPv6 source to list a single intermediate 
node to be "visited" by returning packets.  The Firewall Routing header is identified by a Next 
Header value of 43 in the immediately preceding header, and has the following format:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Next Header  |  Hdr Ext Len  |  Routing Type |     Flags     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                            Reserved                           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    +                            Address                            +
    |                        return-via or                          |
    +                      ultimate destination                     +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Next Header	8-bit selector.
	Identifies the type of header immediately following the
	Routing header. Uses the same values as the IPv4 Protocol
	field    [RFC-1700 et seq.].

   Hdr Ext Len	8-bit unsigned integer.  Length of the Routing
	header in 8-octet units, not including the first 8 octets.

   Routing Type	8-bit identifier of this particular Routing
	header variant.

   Origin Flag	The Origin Flag (Flags - bit 0)
	is used to indicate the direction that corresponds to
	this instance of the FWRH. A value of 1 indicates
	that a firewall exists in the initial packet direction
	(for TCP this is the SYN), while a value of 0 indicates
	that a firewall exists in the response direction
	(for TCP this is the SYN-ACK).

   Reserved	32-bit reserved field.
	Initialized to zero for transmission; ignored on reception.

   Address	Direction/location dependent address,
	where from the origin node toward a correspondent it
	contains the address of the firewall to be returned
	through and from the correspondent to the intermediate
	firewall contains the ultimate destination address
	that the firewall will deliver the packet to.

</pre></div>
<p>**** Within an enterprise network both FWRH options might contain the same address if there was an audit function, or traffic engineering reason to route both directions through the same mid-point.
</p>
<p>A FWRH option SHOULD NOT contain an address that matches either the source or destination addresses of the packet.  If there are two FWRH options present:
Their Origin Flag values MUST be different
Both options SHOULD NOT contain the same address
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Routing Header Required ICMP Message</h3>

<p>Informing the originating endpoint that it needs to insert a routing header is accomplished with a specific ICMP error - 'Routing Header Required' (type ???).  This ICMP error may optionally be signed to mitigate a man-in-the-middle attack vector which could be used to route all return-path traffic through an attacker's node. 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |     Code      |          Checksum             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            Reserved                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                                                               +
   |                     Return-Via  IPv6 address                  |
   +                                                               +
   |                                                               |
   +                                                               +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Sig-type      |           Signature-length                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                                                               +
   |                            Signature                          |
   |                                                               |
   +                                                               +
   |                                                               |
   +                                                               +
IPv6 Fields:

   Destination Address

                        Copied from the Source Address field of the
                        invoking packet.

   ICMPv6 Fields:

   Type           ???? - 5

   Code           0 -  unsigned
		    1 -  signed

   Reserved             32-bit reserved field.  Initialized to zero
                        for transmission; ignored on reception.


   Sig-type       0 -  unused
		    1 -  MD5
		    2 -  SHA1
		    ...

   Sig-length    Length of the signature option
   Signature     Value of the signature function</pre></div>
<p>The optional signature covers the source and destination address of this specific packet exchange, plus the FWRH option address.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
ReturnPathForwarding ICMP Error Message</h3>

<p>Informing the origin that the source prefix is not appropriate for the next hop as a symmetric return path.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Next Header  |  Hdr Ext Len  |  Routing Type |     Flags     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                            Reserved                           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    +                            Address                            +
    |                        return-via or                          |
    +                      ultimate destination                     +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Next Header	8-bit selector.  Identifies the type of header
	immediately following the Routing header. Uses the same
	values as the IPv4 Protocol field   [RFC-1700 et seq.].

   Hdr Ext Len	8-bit unsigned integer.
	Length of the Routing header in 8-octet units, not
	including the first 8 octets.

   Routing Type	8-bit
	identifier of this particular Routing header variant.

   Origin Flag	The Origin Flag (Flags - bit 0)
	is used to indicate the direction that corresponds to
	this instance of the FWRH. A value of 1 indicates
	that a firewall exists in the initial packet direction
	(for TCP this is the SYN), while a value of 0 indicates
	that a firewall exists in the response direction
	(for TCP this is the SYN-ACK).

   Reserved	32-bit reserved field.
	Initialized to zero for transmission; ignored on reception.

   Address	Direction/location dependent address,
	where from the origin node toward a correspondent it
	contains the address of the firewall to be returned
	through and from the correspondent to the intermediate
	firewall contains the ultimate destination address that
	the firewall will deliver the packet to.
</pre></div>
<p>The optional signature covers the source and destination address of this specific packet exchange, plus the source prefix in this option.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Examples</h3>

<p>Example 1 - Single firewall connecting a private network to the Internet.
</p><br /><hr class="insert" />
<a name="fig-1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>       A	   FW1		   B
       |__Private__|  |__Internet__|

Initial packet exchange sequence -
A   -&gt;&gt;		DST = B
FW1 ICMP(5) &lt;&lt;-	DST = A : SRC = FW1(P) : value - FW1(I)
A   -&gt;&gt;		DST = B : FWRH(OF=1) = FW1(I)
B   &lt;&lt;-		DST = FW1(I) : FWRH(OF=1) = A
FW1 &lt;&lt;-		DST = A : FWRH(OF=1) = FW1(I)
A   -&gt;&gt;		DST = B : FWRH(OF=1) = FW1(I)
B   &lt;&lt;-		DST = FW1(I) : FWRH(OF=1) = A
FW1 &lt;&lt;-		DST = A : FWRH(OF=1) = FW1(I)
			...
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In this case as node A attempts to connect to node B, FW1 rejects the first attempt with an error message informing that the FWRH is required.  The subsequent packet including the FWRH with Origin Flag set is forwarded by FW1 toward B. B sends the return packet to FW1, where the DST is swapped with the locator for A in the FWRH with the Origin Flag set.
</p><br /><hr class="insert" />
<a name="fig-2"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>       A	   FW1		   B
       |__Private__|  |__Internet__|
		   |               |
		   FW2 _ Internet _|

Initial packet exchange sequence -
A   -&gt;&gt;		DST = B
FW1 ICMP(5) &lt;&lt;-	DST = A : SRC = FW1(P) : value - FW1(I)
A   -&gt;&gt;		DST = B : FWRH(OF=1) = FW1(I)
B   &lt;&lt;-		DST = FW1(I) : FWRH(OF=1) = A
FW1 &lt;&lt;-		DST = A : FWRH(OF=1) = FW1(I)
	--- FW1 dies
A   -&gt;&gt;		DST = B : FWRH(OF=1) = FW1(I)
FW2 ICMP(5) &lt;&lt;-	DST = A : SRC = FW2(P) : value - FW2(I)
FW2 ICMP(6) &lt;&lt;-	DST = A : SRC = FW2(P) : value - /48 FW2(I)
A   -&gt;&gt;		DST = B : FWRH(OF=1) = FW2(I)
B   &lt;&lt;-		DST = FW2(I) : FWRH(OF=1) = A
FW2 &lt;&lt;-		DST = A : FWRH(OF=1) = FW1(I)
			...</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>This case is the same as above, except there is an alternate firewall available to A.  At some point after the connection is established, FW1 dies, and routing redirects packets to B through FW2. FW2 has acquired state from FW1, so the connection between A &amp; B does not have to be reset, but FW2 still rejects the next packet with an error message informing that the FWRH does not have the public address of FW2. The subsequent packet including the FWRH with Origin Flag set is forwarded by FW2 toward B. B sends the return packet to FW2, where the DST is swapped with the locator for A in the FWRH with the Origin Flag set. 
</p><br /><hr class="insert" />
<a name="fig-3"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>       A	   FW1		   FW2		 B
       |__Private__|  |__Internet__| |__Private__|

Initial packet exchange sequence -
A   -&gt;&gt;		DST = B
FW1 ICMP(5) &lt;&lt;-	DST = A : SRC = FW1(P) : value - FW1(I)
A   -&gt;&gt;		DST = B : FWRH(OF=1) = FW1(I)
FW2 -&gt;&gt;		(presumes that FW2 allows initial pkt without state)
B   &lt;&lt;-		DST = FW1(I) : FWRH(OF=1) = A
FW2 ICMP(5) -&gt;&gt;	DST = B : SRC = FW2(P) : value - FW2(I)
B   &lt;&lt;-		DST = FW1(I) : FWRH(OF=1) = A : FWRH(OF=0) = FW2(I)
FW1 &lt;&lt;-		DST = A : FWRH(OF=1) = FW1(I) : FWRH(OF=0) = FW2(I)
A   -&gt;&gt;		DST= FW2(I) : FWRH(OF=1) = FW1(I) : FWRH(OF=0) = B
FW2 -&gt;&gt;		DST = B : FWRH(OF=1) = FW1(I) : FWRH(OF=0) = FW2(I)
			...</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In this case there are firewalls at each end, and both require a FWRH.  The value of the Origin Flag identifies which FWRH option is associated with each firewall. Note that before forwarding to the private side of each firewall, the DST &amp; FWRH(OF=1) was swapped at FW1, while DST &amp; FWRH(OF=0) was swapped at FW2.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>This specification registers a Routing Header type &amp; two ICMP message types
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>A routing header is used to cause packets to traverse a specific node, and if used maliciously would allow an attacker to see all packets in an exchange.  The risk of this attack is minimized by filtering out any ICMP Routing Header Required and ICMP RPF-error messages that originate outside the policy domain, and/or signing &amp; verifying those ICMP error messages when generated internally.
</p>
<a name="acks"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgements</h3>

<p>The need to resolve routing symmetry for firewalls was initially championed by William Dixon, and discussed with many attendees at IETF 74. 
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate
          Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC5095">[RFC5095]</a></td>
<td class="author-text"><a href="mailto:jabley@ca.afilias.info">Abley, J.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc5095">Deprecation of Type 0 Routing Headers in IPv6</a>,&rdquo; RFC&nbsp;5095, December&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc5095.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc5095.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc5095.xml">XML</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tony Hain</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">500 108th Ave NE</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bellevue, WA  98004</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 425 468-1061</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:alh-ietf@tndh.net">alh-ietf@tndh.net</a></td></tr>
</table>
</body></html>
