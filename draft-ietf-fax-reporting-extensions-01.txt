Fax Working Group                                               Dan Wing 
Internet Draft                                             Cisco Systems
August 7, 1998
Expires January 1999                
draft-ietf-fax-reporting-extensions-01.txt

                 Fax Offramp Extensions to DSN and MDN 

Status of this memo

   This document is an Internet-Draft. Internet-Drafts are working
   documents of the Internet Engineering Task Force (IETF), its areas,
   and its working groups.  Note that other groups may also distribute
   working documents as Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   To view the entire list of current Internet-Drafts, please check
   the "1id-abstracts.txt" listing contained in the Internet-Drafts
   Shadow Directories on ftp.is.co.za (Africa), ftp.nordu.net
   (Northern Europe), ftp.nis.garr.it (Southern Europe), munnari.oz.au
   (Pacific Rim), ftp.ietf.org (US East Coast), or ftp.isi.edu
   (US West Coast).

Copyright Notice

   Copyright (C) The Internet Society (1998).  All Rights Reserved.
 
1.  Abstract

   Offramp fax gateways need a standard format for indicating
   fax-specific information such as call length, actual number
   dialed, pages transmitted, and other information.
   
   This memo describes a format usable by fax offramps for
   generating Message Disposition Notifications [RFC2298] and
   Delivery Status Notifications [RFC1894].  
   
2. Introduction
 
   This document describes extensions useful for fax offramps.

   These extensions can be used in Message Disposition Notifications
   [RFC2298] or Delivery Status Notifications [RFC1894], as appropriate
   for the offramp implementation.  Fax offramps implemented as MUAs
   (typically using POP or IMAP) will use the MDN format, and fax
   offramps implemented as MTAs (SMTP servers) will use the DSN format.

   The fields defined in this document are:
      
     *  call length
     *  dialed number
     *  number of pages transmitted
     *  media features

   This draft is being discussed on the "ietf-fax" mailing list.  To
   subscribe, send a message to:
      ietf-fax-request@imc.org
   with the line:
      subscribe
   in the body of the message.  Archives are available from
   <http://www.imc.org/ietf-fax>.

3.  Extensions for use by DSN and MDN

   A message that is gatewayed by a fax offramp will cause a telephone
   call to be made.  This section describes mechanisms for the fax
   offramp to provide information about the telephone call:  the the
   length of the call, number of pages transmitted, and the dialed
   telephone number.
   
   The following extensions are available to both DSN [RFC1894]
   and MDN [RFC2298] messages.

3.1.  New Message Fields

   For a DSN message, the following per-recipient fields are defined
   (section 2.3 of [RFC1894]).  For an MDN message, the following
   extension fields are defined (section 3.1 of [RFC2298]).

      extension-field = [ call-begin-time ]
                        [ call-end-time ]
                        [ transmitted-pages ]
                        [ media-features ]
                        [ bit-rate-field ]
                        [ call-attempts ]

      call-begin-time   = "Call-Begin" ":" begin-time
      call-end-time     = "Call-End" ":" end-time
      transmitted-pages = "Transmitted-Pages" ":" xmit-pages
      media-features    = "Media-Features" ":" media-feature-tags
      bit-rate-field    = "Bit-Rate" ":" bit-rate
      call-attempts     = "Call-Attempts" ":" attempt-count

      begin-time     = <rfc822 date format>
      end-time       = <rfc822 date format>
      xmit-pages     = 1*DIGIT
      media-feature-tags = *text <per [MEDIA-FEATURES] with LWS wrapping>
      bit-rate       = "110" / "300" / "1200" / "2400" / "4800" / "9600" / 
                       "14400" / "28800"
      attempt-count  = 1*DIGIT
      
   Examples:
   
      Call-Begin: Fri, 8 Aug 1998 09:03:02 -0700
      Call-End: Fri, 8 Aug 1998 09:05:07 -0700
      Call-Attemps: 1
      Transmitted-Pages: 8
      Bit-Rate: 9600
      Media-Features: pagesize=a4
      
   If a coverpage is generated and transmitted by the offramp,
   its pagecount is included in the xmit-pages value.
   
   "Call-Attempts" indicates the number of call attempts, which will
   always be at least 1 if the faxmodem was brought off-hook.

3.2.  Use of Existing Message Fields

   Many existing MDN and DSN fields can be used to indicate
   fax-related events.
   
3.2.1.  Final-Recipient

   The Final-Recipient field (which is present in both [RFC1894]
   and [RFC2298] message formats) can be used to indicate the actual
   number dialed.
   
   The "address-type" is "phone".  The "generic-address" is a telephone
   number which SHOULD be in the format of "global-phone" (as defined in
   [RFC2303]).

   Examples:
   
     Final-Recipient: phone; +1-408-457-5208
     Final-Recipient: phone; +599-78760
     Final-Recipient: phone; 1234
     
4.  Extensions for DSN

   The following extensions are only applicable to DSN reports [RFC1894]
   or to the SMTP server's response to the end-of-mail-data indicator if
   the SMTP server implements [RFC2034].

4.1.  Enhanced Mail System Status Codes

   While Enhanced Mail System Status Codes [RFC1893] is quite complete
   in its description of events specific to email, it does not provide
   error codes which map directly to all the error codes necessary for
   other services such as gatewaying to GSTN-based fax.

   This document describes how existing codes from [ENH-CODES] can be
   used with a fax offramp, and documents new codes that are necessary
   to support fax offramps.  [ENH-CODES] allows new codes to be defined.
   The following table maps fax-specific codes to [ENH-CODES] codes
   where possible, and defines new fax-specific codes if [ENH-CODES]
   doesn't already have a suitable mapping.

4.1.1.  New Enhanced Mail System Status Codes for Fax

   The new fax-specific per-recipient codes are as follows.
   
   Specific to one telephone number ("Mailbox Status"):

     "X.2.50   no carrier"

         The number was successfully dialed, but no fax carrier
         was ever heard by the sending fax modem.  
      
     "X.2.51   unable to train"

         The number was successfully dialed, and a fax carrier was
         heard, but the fax modem was unable to communicate with the
         remote fax machine successfully.  
         
     "X.2.52   no confirmation received"

         After transmission of a page to the remote fax machine the
         remote fax machine did not acknowledge receiving the page.
         
     "X.2.53   SIT detected"

         A Special Information Tone (SIT) was detected.  This
         is usually because of a telephone number change.  This
         is primarily useful as a permanent error condition.
         
     "X.2.54   T.30 protocol error"

         A T.30 protocol error caused a call failure, such as
         data underflow, missing EOLs, no response to DCS, and
         other failures.

   Specific to the GSTN network ("Network and Routing Status"):

     "X.4.50   No network service"

         No dialtone was detected.
         
4.1.2.  Use of Existing Enhanced Mail System Status Codes 

   Many of the codes described in [ENH-CODES] map well to fax
   offramp failure and success codes, and should be used to
   promote interoperability between fax and email.  The text
   shown in parentheses is from [RFC1893].

      "X.1.1   No such telephone number"
              ("Bad destination mailbox address" in [RFC1893])

         The telephone number does not exist or is not a dialable
         telephone number.  This code is only useful for permanent
         failures (5.X.X).

      "X.1.3   Unable to parse telephone number"
              ("Bad destination mailbox address syntax" in [RFC1893])

         The destination address was syntactically invalid.  This can
         apply to any field in the address.  This code is only useful
         for permanent failures (5.X.X).

      "X.4.1   No answer"
              ("No answer from host" in [RFC1893])

         The outbound connection attempt was not answered.  This is
         useful for both permanent (5.X.X) and persistent transient
         error (4.X.X).

      "X.3.2   Persistently Busy"
              ("System not accepting network messages" in [RFC1893])
   
         The dialed telephone number was busy.  This is useful for both
         permanent (5.X.X) and presistent transient errors (4.X.X).

5.  Security Considerations

  The Final-Recipient could disclose long-distance access codes that
  would be otherwise unknown to the sender.
  
6.  Acknowledgments

   XXX

7.  References

   [EIFAX] L. Masinter, D. Wing, "Extended Facsimile Using Internet
   Mail", Internet Draft, Work in Progress, draft-ietf-fax-eifax-XX.txt

   [FAX-REQ] L. Masinter, "Requirements for Internet FAX", Internet
   Draft, Work in Progress, draft-ietf-fax-requirements-XX.txt.
   
   [MEDIA-FEATURES] L. Masinter, K. Holtman, D. Wing, "Media Features
   for Display, Print, and Fax", Internet Draft, Work in Progress,
   draft-masinter-media-features-XX.txt.

   [RFC1891] K. Moore, "SMTP Service Extension for Delivery Status
   Notifications", RFC 1891, January 1996.

   [RFC1893] G. Vaudreuil, "Enhanced Mail System Status Codes", RFC
   1893, January 1996.
   
   [RFC1894] K. Moore, G. Vaudreuil, "An Extensible Message Format for
   Delivery Status Notifications", RFC 1894, January 1996.

   [RFC2034] N. Freed, "SMTP Service Extension for Returning Enhanced
   Error Codes", RFC 2034, October 1996.
   
   [RFC2303] C. Allocchio, "Minimal PSTN address format in Internet 
   Mail", RFC 1303, March 1998.

   [RFC2305] K. Toyoda, H. Ohno, J. Murai, D. Wing, "A Simple Mode of
   Facsimile Using Internet Mail", RFC 2305, March 1998.

   [RFC2234] D. Crocker, P. Overell, "Augmented BNF for Syntax
   Specifications:  ABNF", RFC 2234, November 1997.
   
   [RFC2298] R. Fajman, "An Extensible Message Format for Message
   Disposition Notifications", RFC 2298, March 1998.


9.  Copyright

   Copyright (C) The Internet Society 1998.  All Rights Reserved.
 
   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implmentation may be prepared, copied, published and
   distributed, in whole or in part, without restriction of any kind,
   provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the  purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.
 
   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.
 
   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

10.  Author's Address

   Dan Wing
   Cisco Systems, Inc.
   101 Cooper Street
   Santa Cruz, CA 95060  USA

   Phone: +1 408 457 5200
   Fax:   +1 408 457 5208
   EMail: dwing@cisco.com
