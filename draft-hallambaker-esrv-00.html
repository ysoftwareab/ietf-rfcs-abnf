<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>DNS Extended Service Parameters (ESRV) Record.</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="DNS Extended Service Parameters (ESRV) Record.">
<meta name="keywords" content="DNS">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">P. Hallam-Baker</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Comodo Inc.</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">B. Smith</td></tr>
<tr><td class="header">Expires: March 11, 2011</td><td class="header">DNS.com</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">September 7, 2010</td></tr>
</table></td></tr></table>
<h1><br />DNS Extended Service Parameters (ESRV) Record.<br />draft-hallambaker-esrv-00</h1>

<h3>Abstract</h3>

<p>
                Extended Service Description (ESRV) records are DNS Resource Records that
                provide information to applications attempting to establish a network connection.
                When authenticated using an appropriate means ESRV records may be
                used to prevent a downgrade attack in cases where use of security enhancements
                with an application protocol are optional.
            
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may not be modified, and derivative works of it may
not be created, except to format it for publication as an RFC or
to translate it into languages other than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on March 11, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Definitions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements Language<br />
<a href="#anchor3">2.</a>&nbsp;
Extended Service Discription<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.1.</a>&nbsp;
ESRV Prefixes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.2.</a>&nbsp;
ESRV Properties<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.3.</a>&nbsp;
Protocol Properties<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.4.</a>&nbsp;
Security Properties<br />
<a href="#anchor8">3.</a>&nbsp;
ESRV Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.1.</a>&nbsp;
DNS Resource Record Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.2.</a>&nbsp;
Tag Specifications<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.2.1.</a>&nbsp;
ESRV Processing Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.2.2.</a>&nbsp;
ref<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">3.2.3.</a>&nbsp;
prot<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">3.2.4.</a>&nbsp;
disc<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">3.2.5.</a>&nbsp;
ssl<br />
<a href="#anchor16">4.</a>&nbsp;
Security Considerations<br />
<a href="#anchor17">5.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">6.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">6.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">6.2.</a>&nbsp;
Non-Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Definitions</h3>

<p>The following definitions are used in this document:
</p>
<p>
                </p>
<blockquote class="text"><dl>
<dt>DNS Resource Record</dt>
<dd>
                        [TBS]
                    
</dd>
</dl></blockquote><p>

            
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Language</h3>

<p>
                    The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
                    "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
                    document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
                
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Extended Service Discription</h3>

<p>
                Extended Service Discrpition (ESRV) DNS Resource Records extend the
                principles of named service discovery first proposed in SRV <a class='info' href='#RFC2782'>RFC 2782<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> [RFC2782] and later extended
                in NAPTR <a class='info' href='#RFC3403'>RFC 3403<span> (</span><span class='info'>Mealling, M., &ldquo;Dynamic Delegation Discovery System (DDDS) Part Three: The Domain Name System (DNS) Database,&rdquo; October&nbsp;2002.</span><span>)</span></a> [RFC3403]
                and related specifications. The ESRV record provides an extensible
                container that MAY be used to provide a description of an abstract Internet
                service bound to a domain name or a specific instance of that Internet
                Service on a specific host.
            
</p>
<p>
                Existing SRV records provide a means of allowing a client to discover
                a host and port number for a specific Internet protocol. ESRV records
                allow a further layer of abstraction in which the discovery is of an
                Internet Service and the service provider MAY declare a range of
                supported protocol options.
            
</p>
<p>
                For example, POP <a class='info' href='#RFC1939'>RFC 1939<span> (</span><span class='info'>Myers, J. and M. Rose, &ldquo;Post Office Protocol - Version 3,&rdquo; May&nbsp;1996.</span><span>)</span></a> [RFC1939] and IMAP
                <a class='info' href='#RFC2060'>RFC 2060<span> (</span><span class='info'>Crispin, M., &ldquo;Internet Message Access Protocol - Version 4rev1,&rdquo; December&nbsp;1996.</span><span>)</span></a> [RFC2060] both provide means by which a mail client can
                access mail messages but the only means by which a client might discover
                that both protocols are supported is to attempt to connect to each in turn.
            
</p>
<p>
                Although discovery by polling is practical when there are only two options,
                it is impractical in application areas such as federated authentication
                (also known as 'identity') where the number of protocols that might be
                employed is very large (e.g. Kerberos, SAML, OpenID, etc.) and the number
                of ways in which those protocols might be employed is even larger still.
                Not only is polling inefficient in such circumstances, a client that fails
                to find a means of connection has no way to know how it might have succeeded.
            
</p>
<p>
                ESRV records provide a means by which Internet clients and Servers can
                negotiate choice of protocols and protocol properties. In particular,
                when publication of the ESRV record is appropriately secure (e.g. through
                a use of DNSSEC <a class='info' href='#RFC4033'>RFC 4033<span> (</span><span class='info'>Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;DNS Security Introduction and Requirements,&rdquo; March&nbsp;2005.</span><span>)</span></a> [RFC4033]), the ESRV
                record provides a means of securely negotiating
                critical security properties.
            
</p>
<p>
                Today use of Internet security is the exception rather than the rule.
                As a result, an attacker can frequently bypass security enhancements
                by persuading the parties that they do not exist.
            
</p>
<p>
                This form of attack is a downgrade attack. While protocols such as SSL
                <a class='info' href='#RFC5246'>RFC 5246<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5246]
                and S/MIME have measures that are intended to prevent downgrade attacks
                in which weaker algorithms are substituted for strong, there is
                currently no in-band mechanism for specifying that these enhancements
                are available or that they should or must be used.
            
</p>
<p>
                While it is possible to infer such information from existing DNS records
                such as the port number specification in an SRV record, such approaches
                represent heuristics and as such are not appropriate as a means of
                achieving an essential security objective.
            
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
ESRV Prefixes</h3>

<p>
                    ESRV makes use of the same system of protocol prefixes originally
                    proposed for use with SRV and subsequently applied to NAPTR and URI.
                
</p>
<p>
                    For example, the ESRV record for a HTTP service at example.com
                    would use the prefix _http._tcp. The following record specifies that
                    a connection to the web service at example.com requires use of SSL.
                
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
_http._tcp.example.com   ESRV "ssl=required"
</pre></div>
<p>
                    When processing ESRV records, a distinction is maintained between
                    the domain name and the prefix. In the case above, the domain name is
                    'example.com' and the prefix is '_http._tcp'.
                
</p>
<p>
                    An ESRV record may be used to declare support for a group of protocols
                    that support different aspects of a single Internet service. For example,
                    a mail service will typically comprise the SMTP, SUBMIT and at least
                    one of IMAP and POP.
                
</p>
<p>
                    In order to support such services a new DNS protocol prefix registry for
                    abstract services is proposed with the extension _as. For example, the
                    abstract service mail would be specified as follows:
                
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
_mail._as.example.com   ESRV
                "prot=_submit._tcp,_smtp._tcp,_imap._tcp,_pop._tcp,"
</pre></div>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
ESRV Properties</h3>

<p>
                    ESRV properties specify properties that control the interpretation
                    of the ESRV tag itself.
                
</p>
<p>
                    Only one ESRV property is defined:
                
</p>
<p>
                    </p>
<blockquote class="text"><dl>
<dt>ref</dt>
<dd>
                            The ref tag supports delegation and wildcard semantics for ESRV
                            Records
                        
</dd>
</dl></blockquote><p>
                
</p>
<p>
                    As has been noticed by other authors, it is not possible to use
                    DNSSEC to authenticate a DNS wildcard record of the form x.*.y.z.
                    This has proved inconvenient when prefixed records such as SRV
                    are employed and their use is thus discouraged.
                
</p>
<p>
                    The ref tag allows these limitations to be avoided and provides
                    a means of supporting delegation.
                
</p>
<p>
                    For example, the following ESRV wildcard record redirects all
                    attempts to establish a service connection made to a non-existent
                    DNS node in *.example.com to the ESRV record at example.com.
                
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
*.example.com   ESRV "ref=example.com"
</pre></div>
<p>
                    When the response to an initial ESRV query contains a ref tag, the
                    client first checks to see if the referenced domain name is the
                    same as the domain name of the original query. If the two domain
                    names are the same the
                    ref tag field is ignored and the remaining tags are processed
                    as if the ref tag had not been specified.
                
</p>
<p>
                    Otherwise the original domain name is replaced by the domain name
                    specified in the ref tag value and a new referenced ESRV query is made.
                    All subsequent prefixed queries (e.g. for SRV records) are made relative
                    to the referenced domain name and not the original.
                
</p>
<p>
                    Processing of ESRV tags is not recursive. 
                    A client MUST process the
                    first ref tag occuring in the result returned in an initial query
                    and a client MUST NOT process any ref tag returned in a reference
                    query.
                
</p>
<p>
                    When processing of a tag other than a ref tag results in an ESRV
                    query being made, the query is made as an initial query but the same
                    non recursion principle is applied.
                
</p>
<p>
                    When querying for a prefixed record following a ref tag redirect,
                    the target domain of the ref tag is used as the base for further prefixes.
                
</p>
<p>
                    For example, consider the zone example.com with the following
                    records:
                
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
_http._tcp.example.com   ESRV "ssl=optional"
*.example.com   ESRV "ref=example.com"
_imap._tcp.example.com   ESRV "ref=example.net"

_imap._tcp.example.net   ESRV
                      "ref=internal.example.net ssl=optional disc=srv"
_imap._tcp.internal.example.net   ESRV
                      "ssl=required disc=srv"
</pre></div>
<p>
                    Attempting to resolve services and domains has effect as follows:
                
</p>
<p>
                    </p>
<blockquote class="text"><dl>
<dt>_http._tcp at example.com</dt>
<dd>
                            The client queries the ESRV record for
                            _http._tcp.example.com. There is a record at this node so
                            the wildcard record is not returned. There is an ESRV record
                            and so the ESRV record stating that SSL is always offered
                            is returned.
                        
</dd>
<dt>_http._tcp at www.example.com</dt>
<dd>
                            The client queries the ESRV record for
                            _http._tcp.www.example.com and the wildcard record for
                            *.example.com is returned. The client then queries for
                            _http._tcp.example.com and the ESRV record ecord stating that
                            SSL is always offered is returned.
                        
</dd>
<dt>_imap._tcp at example.com</dt>
<dd>
                            The query for the IMAP service at example.com leads to a redirect
                            to example.net. Although this record also contains a ref tag,
                            it is ignored. The client is informaed that the IMAP service
                            always offers SSL. The host providing the service is discovered
                            by querying for the SRV record(s) at _imap._tcp.example.net.
                        
</dd>
<dt>_imap._tcp at example.net</dt>
<dd>
                            The query for the IMAP service at example.net leads to a redirect
                            to internal.example.net. This allows the operator of example.net
                            to require use of IMAP for example.net even though it is only
                            an option for other domains that delegate their IMAP service to
                            example.net. The client is informed that the IMAP service
                            always offers SSL. The host providing the service is discovered
                            by querying for the SRV record(s) at _imap._tcp.internal.example.net.
                        
</dd>
</dl></blockquote><p>
                
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Protocol Properties</h3>

<p>
                    Protocol properties allow a service provider to describe the
                    protocols and service discovery mechanisms supported by an
                    Internet protocol instance.
                
</p>
<p>
                    </p>
<blockquote class="text"><dl>
<dt>prot</dt>
<dd>
                            The prot tag specification lists protocols supported by an
                            Internet service. For example an abstract 'mail' Internet
                            service might list SUBMIT, POP, IMAP and LDAP as supported
                            protocols. The prot tag is the protocol equivalent of the
                            ref tag, specifying a new protocol prefix as opposed to
                            a new domain name.
                        
</dd>
<dt></dt>
<dd>
                            Support for the prot specifier is optional.
                        
</dd>
<dt>disc</dt>
<dd>
                            The disc tag specification lists the means of service discovery
                            supported by a protocol. For example discovery by means of SRV,
                            NAPTR or URI may be specified.
                        
</dd>
</dl></blockquote><p>
                
</p>
<p>
                    As with the ref tag, the principle of non recursion is applied.
                    If resolution of an ESRV record returns a prot tag that specifies a
                    new prefix, a client MUST NOT resolve any further prot tags in
                    the ESRV record returned.
                
</p>
<p>
                    When processing of a prot or disc tag results in a new ESRV query,
                    thje query made is always an initial query and ref tags MUST be
                    processed.
                
</p>
<p>
                    The ref, prot and disc tags may be used in combination to effect a
                    gradual refinement of the service characteristics. For example,
                    consider the following DNS zone:
                
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
_mail._as.example.com             ESRV
                    "prot=_submit._tcp,_smtp._tcp,_imap._tcp,_pop._tcp"
_submit._tcp.example.com          ESRV "disc=srv-e"

_submit._tcp.example.com          SRV 1 1 587 submit1.example.com
_submit._tcp.submit1.example.com  ESRV "ssl=required"
submit1.example.com               A    10.1.1.1

_submit._tcp.example.com          SRV 1 1 587 submit2.example.com
_submit._tcp.submit2.example.com  ESRV "ssl=required"
submit1.example.com               A    10.1.1.2
</pre></div>
<p>
                    A mail client attempting to configure a service through which to
                    submit mail could in principle make queries for five DNS records
                    of which two queries may be made in parallel).
                
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Security Properties</h3>

<p>
                    Security properties allow a service provider to describe the
                    security critieria for a service. When an ESRV record is secured
                    using an appropriate means (e.g. DNSSEC), the security properties
                    MAY be used to prevent a downgrade attack on the security
                    enhancements offered.
                
</p>
<p>
                    Only one security property is currently defined:
                
</p>
<p>
                    </p>
<blockquote class="text"><dl>
<dt>ssl</dt>
<dd>
                            Specifies the use of ssl. Valid values are refused, optional
                            and required.
                        
</dd>
</dl></blockquote><p>
                
</p>
<p>
                    It is anticipated that the list of tags will be expanded at a future
                    date to support other Internet security protocols such as IPSEC and
                    WS-Security.
                
</p>
<p>
                    If the values optional or required are specified, the corresponding
                    service MUST support TLS version 1.1 or above.
                
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
ESRV Syntax</h3>

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
DNS Resource Record Syntax</h3>

<p>
                    The ESRV record has the same DNS record syntax as the existing TXT field
                    specified in <a class='info' href='#RFC1035'>RFC 1035<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a> [RFC1035].

                
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
/                   ESRV-DATA                   /
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
</pre></div>
<p>
                    where:
                
</p>
<p>

                    ESRV-DATA        One or more &lt;character-strings&gt;.
                
</p>
<p>
                    ESRV record data consists of a sequence of (tag, value) tuples encoded in
                    tag=value format following the format established in DKIM
                    (<a class='info' href='#RFC4871'>RFC 4871<span> (</span><span class='info'>Allman, E., Callas, J., Delany, M., Libbey, M., Fenton, J., and M. Thomas, &ldquo;DomainKeys Identified Mail (DKIM) Signatures,&rdquo; May&nbsp;2007.</span><span>)</span></a> [RFC4871])
                
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
tag-list  =  tag-spec 0*( ";" tag-spec ) [ ";" ]
tag-spec  =  [FWS] tag-name [FWS] "=" [FWS] tag-value [FWS]
tag-name  =  ALPHA 0*ALNUMPUNC
tag-value =  [ tval 0*( 1*(WSP / FWS) tval ) ]
; WSP and FWS prohibited at beginning and end

tval      =  1*VALCHAR
VALCHAR   =  %x21-3A / %x3C-7E
; EXCLAMATION to TILDE except SEMICOLON

ALNUMPUNC =  ALPHA / DIGIT / "_"
</pre></div>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Tag Specifications</h3>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
ESRV Processing Rules</h3>

<p>
                        The purpose of ESRV service discovery is to refine an abstract specification
                        of a DNS host name and protocol prefix to a concrete specification for
                        the name of a specific network host, a specific network port number and a
                        specific network protocol and associated protocol parameters.
                    
</p>
<p>
                        The ESRV Resource Record is used in combination with the SRV and URI Resource
                        Records to perform extended service discovery. An API call for ESRV processing
                        has the following signature:
                    
</p>
<p>
                        </p>
<blockquote class="text"><dl>
<dt>name (input/output)</dt>
<dd>
                                The DNS name of the service.
                            
</dd>
<dt>protocol (input/output)</dt>
<dd>
                                The DNS prefix of the protocol.
                            
</dd>
<dt>protocol_list (input)</dt>
<dd>
                                The DNS prefixes of the supported protocols.
                            
</dd>
<dt>port (output)</dt>
<dd>
                                The IP port number to conect to at the host
                            
</dd>
<dt>uri (output)</dt>
<dd>
                                The canonical uri of the service to connect to
                            
</dd>
<dt>attributes (output)</dt>
<dd>
                                A list of attribute value pairs that specify characteristics of the
                                connection to the service.
                            
</dd>
</dl></blockquote><p>
                    
</p>
<p>
                        During the course of ESRV service discovery, a client MAY encounter
                        between zero and six ESRV records. Processing of ESRV record tags
                        is managed using a Finite State Machine as follows:
                    
</p>
<p>
                        </p>
<blockquote class="text"><dl>
<dt>START</dt>
<dd>
                                If a ref tag is present, the ref tag is processed and all
                                other tag specifications MUST be ignored, the next state
                                is START-REF. Otherwise the processing rules for all the
                                remaining tag specifications are processed and the next
                                state is set to PROT if a prot tag specification is present,
                                DISC if a disc tag specification is present and FINAL otherwise.
                            
</dd>
<dt>START-REF</dt>
<dd>
                                If a ref tag is present it MUST be ignored. The processing rules
                                for all the
                                remaining tag specifications are processed and the next
                                state is set to PROT-REF if a prot tag specification is present,
                                DISC if a disc tag specification is present and FINAL otherwise.
                            
</dd>
<dt>PROT</dt>
<dd>
                                If a ref tag is present, the ref tag is processed and all
                                other tag specifications MUST be ignored, the next state
                                is PROT-REF.
                                Otherwise the processing rules for all the
                                remaining tag specifications except for prot are processed and the next
                                state is set to
                                DISC if a disc tag specification is present and FINAL otherwise.
                            
</dd>
<dt>PROT-REF</dt>
<dd>
                                If a ref tag is present it MUST be ignored. The processing rules
                                for all the
                                remaining tag specifications except for prot are processed and the next
                                state is set to
                                DISC if a disc tag specification is present and FINAL otherwise.
                            
</dd>
<dt>DISC</dt>
<dd>
                                If a ref tag is present, the ref tag is processed and all
                                other tag specifications MUST be ignored, the next state
                                is DISC-REF.
                                Otherwise the processing rules for all the
                                remaining tag specifications except for prot and disc are
                                processed and the next
                                state is set to FINAL.

                            
</dd>
<dt>DISC-REF</dt>
<dd>
                                If a ref tag is present it MUST be ignored. The processing rules
                                for all the
                                remaining tag specifications except for prot and disc
                                are processed and the next
                                state is set to FINAL.
                            
</dd>
<dt>FINAL</dt>
<dd>
                                Terminal state. No processing is performed.
                            
</dd>
</dl></blockquote><p>
                    
</p>
<p>
                        After each state transition that causes a change in the value of either 
                        'name' or 'protocol', a DNS query is issued for the ESRV record at 
                        prefix + '.' name. If the ESRV query is successful the values of any 
                        tag specifications in the returned record override those previously 
                        specified.
                    
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
ref</h3>

<p>
                        The ref tag specification supports delegation and wildcard semantics
                        for ESRV Records.
                    
</p>
<p>
                        Clients MUST perform processing of ref tags when in the states START, PROT,
                        or DISC. Clients MUST NOT perform processing of ref tags when in any other
                        state.
                    
</p>
<p>
                        The tag-value specified in a ref tag specification MUST be a DNS Domain name
                        in DNS format (i.e. with UNICODE characters encoded in punycode format).
                    
</p>
<p>
                        To process a ref tag the client replaces the state variable 'name' with the domain
                        specified in the tag-value, the state. If the current state is START, the
                        new state is set to START-REF, if the current state is PROT, the new state is
                        set to PROT-REF and if the current state is DISC the new state is set to DISC-REF.
                        A new ESRV query is made for the new target
                        specification.
                    
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.3"></a><h3>3.2.3.&nbsp;
prot</h3>

<p>
                        The prot tag specification lists DNS prefixes of protocols supported by an
                        Internet service as a list of comma separated values.
                    
</p>
<p>
                        Clients MAY perform processing of prot tags when in the states START or START-REF.
                        Clients MUST NOT perform processing of prot tags when in any other
                        state.
                    
</p>
<p>
                        To process a prot tag the client selects a supported protocol prefix from the
                        list of prefixes specified in the prot tag. The state value 'protocol' is
                        replaced by the selected value, the state is set to PROT if the current state is START
                        and PROT-REF if the current state is START-REF and an ESRV request
                        attempted for the new value of prefix + '.' name.
                    
</p>
<p>
                        Should a client be unable to identify any acceptable protcol prefix, the discovery
                        attempt has failed.
                    
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.4"></a><h3>3.2.4.&nbsp;
disc</h3>

<p>
                        The prot tag specification advises a client that the specified mode of discovery is
                        supported.
                    
</p>
<p>
                        Clients MUST perform processing of disc tags when in the states START, START-REF,
                        PROT or PROT-REF.
                        Clients MUST NOT perform processing of disc tags when in any other
                        state.
                    
</p>
<p>Two discovery tag values are defined:
</p>
<p>
                        </p>
<blockquote class="text"><dl>
<dt>srv</dt>
<dd>
                                Service discovery is performed by means of the DNS SRV record <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119]
                            
</dd>
<dt>naptr</dt>
<dd>
                               Service discovery is performed by means of the DNS NAPTR record NAPTR <a class='info' href='#RFC3403'>RFC 3403<span> (</span><span class='info'>Mealling, M., &ldquo;Dynamic Delegation Discovery System (DDDS) Part Three: The Domain Name System (DNS) Database,&rdquo; October&nbsp;2002.</span><span>)</span></a> [RFC3403]
                            
</dd>
<dt>uri</dt>
<dd>
                                Service discovery is performed by means of the DNS URI record 
                                [draft-faltstrom-uri-05]
                            
</dd>
</dl></blockquote><p>

                    
</p>
<p>
                        Clients MUST support the use of SRV discovery and SHOULD support the use of URI 
                        discovery.
                    
</p>
<p>
                        To process a disc tag the client selects the preferred discovery mode
                        from those specified and retrieves the corresponding Resource Records for the 
                        current value of the 'name' and 'protocol' state values. If the discovery
                        process results in a new host name, port number and/or URI stem value being
                        specified, these replace the current values in the state table. The state
                        is set to DISC and an ESRV value attempted for the new name and protocol.
                    
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.5"></a><h3>3.2.5.&nbsp;
ssl</h3>

<p>
                        The ssl tag specification describes the level of support for SSl/TLS
                        transport layer security at a service instance.
                    
</p>
<p>
                        The ssl tag only declares protocol properties and thus does not have
                        processing rules.
                    
</p>
<p>
                        Three tag values are
                        defined:
                    
</p>
<p>
                        </p>
<blockquote class="text"><dl>
<dt>refused</dt>
<dd>
                                The service does not support use of TLS transport layer security.
                                Requests to establish an SSL connection will be refused.
                            
</dd>
<dt>optional</dt>
<dd>
                                The service always offers use of TLS transport layer security using SSL
                                version 3.0 or Transport Layer Security version 1.0 or above.
                            
</dd>
<dt>required</dt>
<dd>
                                The service requires use of TLS transport layer security using SSL
                                version 3.0 or Transport Layer Security version 1.0 or above.
                            
</dd>
</dl></blockquote><p>
                    
</p>
<p>
                        The tag values 'optional' and 'required' MAY be used to prevent downgrade
                        attacks. When expressed in an ESRV record secured using an appropriate
                        DNS security mechanism (e.g. DNSSEC), these tag values provide notice
                        that the authoritative service offers TLS security and that any service
                        that does not offer TLS security MUST be considered non-authoritative.
                    
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>
                TBS
            
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>
                TBS
            
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2782">[RFC2782]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P., and <a href="mailto:levone@microsoft.com">L. Esibov</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782, February&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2782.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3403">[RFC3403]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3403">Dynamic Delegation Discovery System (DDDS) Part Three: The Domain Name System (DNS) Database</a>,&rdquo; RFC&nbsp;3403, October&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3403.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4871">[RFC4871]</a></td>
<td class="author-text">Allman, E., Callas, J., Delany, M., Libbey, M., Fenton, J., and M. Thomas, &ldquo;<a href="http://tools.ietf.org/html/rfc4871">DomainKeys Identified Mail (DKIM) Signatures</a>,&rdquo; RFC&nbsp;4871, May&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4871.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[RFC5246]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5246.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.2.&nbsp;Non-Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1035">[RFC1035]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1035, November&nbsp;1987 (<a href="http://www.rfc-editor.org/rfc/rfc1035.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1939">[RFC1939]</a></td>
<td class="author-text"><a href="mailto:jgm+@cmu.edu">Myers, J.</a> and <a href="mailto:mrose@dbc.mtview.ca.us">M. Rose</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1939">Post Office Protocol - Version 3</a>,&rdquo; STD&nbsp;53, RFC&nbsp;1939, May&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1939.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2060">[RFC2060]</a></td>
<td class="author-text"><a href="mailto:MRC@CAC.Washington.EDU">Crispin, M.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2060">Internet Message Access Protocol - Version 4rev1</a>,&rdquo; RFC&nbsp;2060, December&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2060.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2905">[RFC2905]</a></td>
<td class="author-text">Vollbrecht, J., Calhoun, P., Farrell, S., Gommans, L., Gross, G., de Bruijn, B., de Laat, C., Holdrege, M., and D. Spence, &ldquo;<a href="http://tools.ietf.org/html/rfc2905">AAA Authorization Application Examples</a>,&rdquo; RFC&nbsp;2905, August&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2905.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3851">[RFC3851]</a></td>
<td class="author-text">Ramsdell, B., &ldquo;<a href="http://tools.ietf.org/html/rfc3851">Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.1 Message Specification</a>,&rdquo; RFC&nbsp;3851, July&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3851.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4033">[RFC4033]</a></td>
<td class="author-text">Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;<a href="http://tools.ietf.org/html/rfc4033">DNS Security Introduction and Requirements</a>,&rdquo; RFC&nbsp;4033, March&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4033.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Phillip Hallam-Baker</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Comodo Inc.</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:philliph@comodo.com">philliph@comodo.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Brian Smith</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">DNS.com</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:brian@dns.com">brian@dns.com</a></td></tr>
</table>
</body></html>
