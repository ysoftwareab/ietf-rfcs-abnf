<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IVI Update to SIIT and NAT-PT</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IVI Update to SIIT and NAT-PT">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Behave</td><td class="header">X. Li</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">C. Bao</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfc2765'>2765</a>, <a href='http://tools.ietf.org/html/rfc2766'>2766</a></td><td class="header">CERNET Center/Tsinghua University</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">F. Baker</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">K. Yin</td></tr>
<tr><td class="header">Expires: March 21, 2009</td><td class="header">Cisco Systems</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">September 17, 2008</td></tr>
</table></td></tr></table>
<h1><br />IVI Update to SIIT and NAT-PT<br />draft-baker-behave-ivi-01</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on March 21, 2009.</p>

<h3>Abstract</h3>

<p>This note proposes an address and service architecture designed to
      facilitate transition from an IPv4 Internet to an IPv6 Internet. This
      service contains three parts: A DNS Application Layer Gateway, a
      stateful Network Address Translator that enables IPv6 clients to
      initiate connections to IPv4 servers and peers, and a stateless Network
      Address Translator that enables IPv4 and IPv6 systems to interoperate
      freely.
</p>
<p>It is couched as an update to RFCs 2765 and 2766. This is because the
      stateless service is essentially the SIIT with a different address
      format, and because the DNS Application Layer Gateway and the stateful
      translator have significant similarities to NAT-PT. There are, however,
      important differences from NAT-PT, responsive to the issues raised in
      RFC 4966.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#ivi-service">2.</a>&nbsp;
The IVI model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">2.1.</a>&nbsp;
IVI Network Model and communication objectives<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ivi_address_format">2.2.</a>&nbsp;
IVI Address Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#routing">2.3.</a>&nbsp;
Routing in IVI networks<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dns_service">2.4.</a>&nbsp;
DNS service in IVI networks<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#host">2.5.</a>&nbsp;
Host operation in IVI networks<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#addr_selection">2.5.1.</a>&nbsp;
Interaction of IVI Addresses with RFC3484 Address Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ivi-IPv4">2.5.2.</a>&nbsp;
Interaction of IPv4 and IVI addresses on the same host<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ops">2.6.</a>&nbsp;
Operation of the IVI Gateway<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stateless">2.6.1.</a>&nbsp;
Stateless (1:1) Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stateful">2.6.2.</a>&nbsp;
Stateful (1:n) Operation<br />
<a href="#phases">3.</a>&nbsp;
Transition plan<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#phase1">3.1.</a>&nbsp;
IPv4-only Network<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#phase2">3.2.</a>&nbsp;
IPv4+IPv6 Dual Stack Network<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#phase3">3.3.</a>&nbsp;
IPv6+IPv4-accessible Network<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#phase4">3.4.</a>&nbsp;
IPv6 Network<br />
<a href="#future">4.</a>&nbsp;
Future extensions of the IVI Model<br />
<a href="#natpt">5.</a>&nbsp;
Reflections on RFC 4966<br />
<a href="#IANA">6.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">7.</a>&nbsp;
Security Considerations<br />
<a href="#Acknowledgements">8.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This note documents the prototype being used for translation between
      the IPv4 CERNET and the IPv6 CNGI-CERNET2 networks. This uses the
      algorithms of <a class='info' href='#RFC2765'>SIIT<span> (</span><span class='info'>Nordmark, E., &ldquo;Stateless IP/ICMP Translation Algorithm (SIIT),&rdquo; February&nbsp;2000.</span><span>)</span></a> [RFC2765] with a modified address
      format, and a modified version of <a class='info' href='#RFC2766'>NAT-PT<span> (</span><span class='info'>Tsirtsis, G. and P. Srisuresh, &ldquo;Network Address Translation - Protocol Translation (NAT-PT),&rdquo; February&nbsp;2000.</span><span>)</span></a> [RFC2766].
      In general, we recommend the use of native communication and dual stack
      deployment. However, in several scenarios, the temporary use of
      translation can simplify service deployment. Hence, we describe a
      translation function.
</p>
<p>It should be understood that protocol translation in any form is not
      a viable long term solution for IPv6 deployment; it has value during a
      certain part of the adoption curve, but will become less relevant at
      later points in the adoption curve. The objective of any transition
      strategy, of which IVI is an example, is to facilitate transition, not
      to enter a phase of heightened operational and capital expenditure
      running two networks in parallel only to stay there. When IPv6 is widely
      deployed and economic conditions support the move, we expect service
      providers to withdraw IPv4 service.
</p>
<p>The objectives of the translation function are to enable systems that
      are unable to communicate with each other due to routing,
      implementation, or parameter differences to communicate. Almost any
      translation function will connect IPv6 systems with IPv4 systems or
      systems in an IPv4 network. The difficulty is that this gives no
      incentive to administrations to move their servers and peers from the
      IPv4 domain to the IPv6 domain. Noting that dual stack implementations
      such as recommended in <a class='info' href='#RFC4213'>[RFC4213]<span> (</span><span class='info'>Nordmark, E. and R. Gilligan, &ldquo;Basic Transition Mechanisms for IPv6 Hosts and Routers,&rdquo; October&nbsp;2005.</span><span>)</span></a> are not being
      widely deployed by operators, the IVI model is designed to facilitate
      placing servers and peers in the IPv6 domain, achieving native IPv6
      connectivity without giving up IPv4 accessibility.
</p>
<p>More specifically, the objectives are several: </p>
<ul class="text">
<li>As with any network, IPv4 systems connected by an IPv4 network
          can talk among themselves and IPv6 systems connected by an IPv6
          network can talk among themselves. The first objective is to
          preserve this and its scaling characteristics.
</li>
<li>If one or both domains are IPv4+IPv6 but there exist systems with
          only one architecture, we presume that IPv4 and IPv6 routing crosses
          the gateway or a parallel router, and the systems are able to
          communicate directly.
</li>
<li>We want to enable systems that have no IPv6 address to access
          servers and peers with IPv4-derived IPv6 addresses (IVI addresses)
          in the IPv6 domain. This requires translation similar to that
          described in <a class='info' href='#RFC2765'>SIIT<span> (</span><span class='info'>Nordmark, E., &ldquo;Stateless IP/ICMP Translation Algorithm (SIIT),&rdquo; February&nbsp;2000.</span><span>)</span></a> [RFC2765]. This operation is
          stateless.
</li>
<li>We want to enable systems that have no IPv4 address to access
          servers and peers in the IPv4 domain. For systems with IPv4-derived
          IPv6 addresses (IVI addresses), this is solved by the SIIT extension
          described in this document, given the appropriate AAAA record by IVI
          DNS ALG. This operation is also stateless. Other systems with
          non-IVI IPv6 addresses require some form of stateful translation.
          This has similarities to the mechanisms described in <a class='info' href='#RFC2766'>NAT-PT<span> (</span><span class='info'>Tsirtsis, G. and P. Srisuresh, &ldquo;Network Address Translation - Protocol Translation (NAT-PT),&rdquo; February&nbsp;2000.</span><span>)</span></a> [RFC2766]. We wish to do this with a minimum of
          maintained state.
</li>
</ul>

<p>Some have questioned the need for IPv4 access to IPv6-only servers
      and peers, noting that in the Internet of 2008 there is no market
      requirement for such access and any server or peer will require
      accessibility from an IPv4 network. The issue is that this presumes a
      certain point in the adoption curve; at another point in the adoption
      curve, one hopes that there will be few takers for IPv4-only service. In
      between, before IPv6 service for a server or peer becomes a requirement,
      IPv6-only service for a server or peer must be feasible (it must be
      conceivable that a server or peer with an IPv6 address will be useful).
      We argue that it is easier for IPv6 service for a server or peer to
      become feasible if it is possible to configure it with an IPv4-derived
      IPv6 address than if it must also have IPv4 service. In the long term,
      we believe that translation is not a service that service providers will
      normally use, but is a helpful and perhaps necessary step in
      transitioning to an IPv6 world.
</p>
<a name="ivi-service"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
The IVI model</h3>

<p>The Name "IVI" contracts "IV&lt;-&gt;VI"; we are describing a
      translation connection between systems using IPv4 or IPv6 that cannot
      communicate using either IPv4 or IPv6. In any normal case where native
      communication is possible between two systems, we argue that it is
      preferable.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
IVI Network Model and communication objectives</h3>

<p>An IVI Network, as shown in <a class='info' href='#ivi_network'>Figure&nbsp;1<span> (</span><span class='info'>IVI Network Model</span><span>)</span></a>,
        consists of two or more network domains connected by one or more IVI
        gateways. One of those networks either routes IPv4 but not IPv6, or
        contains some hosts that only implement IPv4. The other network either
        routes IPv6 but not IPv4, or contains some hosts that only implement
        IPv6. Both networks contain clients, servers, and peers. It would be
        advisable and preferable to implement a dual stack architecture in
        both domains, but either due to address scarcity or the process
        involved in IPv6 turn-up, that is not practical at the moment.
</p><br /><hr class="insert" />
<a name="ivi_network"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>        -----------                -----------
     ///   IPv4    \\\          ///   IPv6    \\\
   //     Network     \\      //     Network     \\
  /                     \    /              +-----+\
 |                       |  |               |IPv6 | |
|                    +---------+            +-----+  |
|                    |   IVI   |                     |
|                    | Gateway |            +-----+  |
|     +-----+        +---------+            |IPv6/|  |
 |    |IPv4 |            |  |               | IVI | |
  \   +-----+           /    \              +-----+/
   \\                 //      \\                 //
     \\\           ///          \\\           ///
        -----------                -----------
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: IVI Network Model&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Clearly, there are issues in IP addressing, and routing, DNS, and
        the specifics of translation.
</p>
<a name="ivi_address_format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
IVI Address Format</h3>

<p>The IVI Address is an IPv4 address embedded in an IPv6 address and
        predictable by the gateway and systems on either side. The selection
        of the LIR prefix, including its length and absolute value, is at the
        option of the network administration; it is not fixed. <a class='info' href='#ivi_address'>Figure&nbsp;2<span> (</span><span class='info'>Example IVI Address Format</span><span>)</span></a> shows one possible model. It enables the
        IPv6 domain to assign the equivalent of IPv4 /24 prefixes to IPv6 LANs
        (/64).
</p><br /><hr class="insert" />
<a name="ivi_address"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
          IPv4 /24 routes in IPv6 domain
0  8  16 24 32 40 48 56 64                    127
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|  LIR Prefix  | IPv4 addr |  entirely 0        |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|&lt;-----prefix part ----&gt;|&lt;---   host part   ---&gt;|
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Example IVI Address Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In the IPv4 domain, this represents a prefix no longer than /24. In
        the IPv6 domain, the "default route" advertising the entire IPv4
        address space is the LIR /40 prefix. More specific prefixes up to /64
        may be advertised as needed, or host (/128) routes.
</p>
<p>The objective here is to enable the network administration to be in
        control of the impact of the tradeoff on its routing.
</p>
<p>The need to change the address format used by SIIT bears
        repetition, although it has come up in other discussions. <a class='info' href='#RFC4291'>[RFC4291]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a> deprecated the address format with the
        brusque comment that "current IPv6 transition mechanisms no longer use
        these addresses." The reason that they were not widely deployed was
        that they gave network operators little control in routing, or ways to
        ensure that route redistribution worked correctly. A prefix that lets
        the LIR specify the upper bits gives the operator the flexibility to
        identify the IVI gateway advertising the prefix and better control the
        distribution of routes.
</p>
<a name="routing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Routing in IVI networks</h3>

<p>The IVI Gateway may be a general purpose router; in that mode, it
        operates like any other router. However, it also advertises one or
        more prefixes into both the IPv4 and the IPv6 domain, and when a
        datagram is directed to an address within the translation prefix(es),
        it translates the datagram.
</p>
<p>As a Network Address Translator, the IVI Gateway offers one or both
        of two services: stateless translation of addresses conforming to
        <a class='info' href='#ivi_address'>Figure&nbsp;2<span> (</span><span class='info'>Example IVI Address Format</span><span>)</span></a> to and from IPv4 addresses, and
        stateful translation between IPv6 addressing and a combination of an
        IPv4 address and transport source port as is done in normal NATs.
</p>
<p>In IPv4, the IVI gateway advertises the IPv4 prefix being used for
        stateless IVI address translation; for example, if an IPv4 /20 is
        being used as a set of /24 prefixes in the IPv6 domain, it would
        advertise a /20 into the IPv4 domain. If the IVI gateway is offering
        stateful translation, it may also advertise the addresses or prefix
        being used for that service unless another router handles this.
</p>
<p>In IPv6, the IVI gateway advertises a &ldquo;default route for
        global IPv4&rdquo; - in the example given in <a class='info' href='#ivi_address'>Figure&nbsp;2<span> (</span><span class='info'>Example IVI Address Format</span><span>)</span></a>, it would normally advertise the /40 LIR
        prefix. If that is inappropriate - there are multiple non-overlapping
        IPv4 domains or other concerns apply - it would advertise
        "more-specific" prefixes as appropriate.
</p>
<p>In the IPv6 domain, the routers or hosts that have been assigned
        IVI prefixes or addresses subsidiary to the IVI prefix for a service
        advertise the IVI /64s corresponding to those IPv4 /24s.
</p>
<p>Clearly, there may be multiple non-overlapping IPv4 domains,
        multiple non-overlapping IPv6 domains, and there may be multiple IVI
        gateways. These are handled in a manner consistent with normal routing
        practice in the Internet.
</p>
<p>As shown in <a class='info' href='#ivi-reachability'>Figure&nbsp;3<span> (</span><span class='info'>IVI Reachability example</span><span>)</span></a>, routing is
        slightly more complex in an IVI service, but follows simple routing
        concepts. In this example, </p>
<ul class="text">
<li>IPv4 interfaces can open a session to any IVI address (e.g.
            4Host1 -&gt; IVI1),
</li>
<li>IPv4 interfaces cannot open sessions to non-IVI IPv6 addresses
            (e.g. 4Host1 X-&gt; 6Host1),
</li>
<li>IPv6 IVI interfaces can open a session to any IPv4 interface,
            statelessly (e.g. IVI1 -&gt; 4Host1),
</li>
<li>Non-IVI IPv6 hosts can open sessions to IPv4 interfaces,
            statefully (e.g. 6Host1 -&gt; 4Host1),
</li>
<li>Any two IPv4 hosts can open a session to either each other
            using native routing (e.g. 4Host1 -&gt; 4Host2, 4Host2 -&gt;
            4Host1),
</li>
<li>Any two IPv6 hosts can open a session to either each other
            using native routing, even using the IVI addresses (e.g. 6Host1
            -&gt; IVI1, IVI1 -&gt; 6Host1, 6Host1 -&gt; 6Host2, IVI1 -&gt;
            IVI2).
</li>
</ul>
<br /><hr class="insert" />
<a name="ivi-reachability"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>       -------------           ------------
      / IPv4 Domain \         / IPv6 Domain \
     /               \       /               \
    /        |        \     /        | +----+ \
   /+------+ |         \   /         |-|IVI1|  \
  / |4Host1|-| +--+ |   \ /   | +--+ | +----+   \
 /  +------+ |-|R1|-|    V    |-|R3|-| +------+  \
 |           | +--+ |    |    | +--+ |-|6Host1|  |
 |                  | +-----+ |      | +------+  |
 |                  |-|XLATE|-|                  |
 |                  | +-----+ |                  |
 |           | +--+ |    |    | +--+ | +------+  |
 |  +------+ |-|R2|-|    |    |-|R4|-|-|6Host2|  |
 \  |4Host2|-| +--+ |    A    | +--+ | +------+  /
  \ +------+ |          / \          | +----+   /
   \         |         /   \         |-|IVI2|  /
    \                 /     \        | +----+ /
     \               /       \               /
      ---------------         ---------------
 Route Advertisements:
       R1: its IPv4 LAN        R3: its IPv6 LAN
       R2: its IPv4 LAN        R3: its IVI /64
       XLATE: IPv4 IVI prefix  R4: its IPv6 LAN
       possible IPv4 overlay   R4: its IVI /64
                   prefix      XLATE:  IVI /40
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: IVI Reachability example&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="dns_service"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
DNS service in IVI networks</h3>

<p>Rather than using the DNS Application Layer Gateway described in
        <a class='info' href='#RFC2766'>[RFC2766]<span> (</span><span class='info'>Tsirtsis, G. and P. Srisuresh, &ldquo;Network Address Translation - Protocol Translation (NAT-PT),&rdquo; February&nbsp;2000.</span><span>)</span></a> as specified, the IVI DNS ALG is a
        one-way translation of A and MX records to AAAA records with a
        predictable address. The DNS server may be in the gateway or in a
        separate system related to it.
</p>
<p>As illustrated in <a class='info' href='#dns'>Figure&nbsp;4<span> (</span><span class='info'>Normal DNS Service</span><span>)</span></a>, in the IPv4 domain,
        the DNS server holds and advertises A records for systems with IPv4
        addresses and for systems (servers or peers) that have IVI addresses.
        These are generally pre-populated, if only via Dynamic DNS. The IPv4
        network cannot distinguish them from other A records or from other
        IPv4 addresses, so this works without host changes.
</p><br /><hr class="insert" />
<a name="dns"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>     IPv4 Domain                 IPv6 Domain
                |               |
 A/MX Request\  |               |  / AAAA Request
              \ |    DNS ALG    | /
               \|    as         |/
               /|    Standard   |\
              / |    DNS        | \
A/MX Response/  |    Service    |  \ AAAA Response
                |               |
                |               |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Normal DNS Service&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Also as illustrated in <a class='info' href='#dns'>Figure&nbsp;4<span> (</span><span class='info'>Normal DNS Service</span><span>)</span></a>, in the IPv6
        domain, the DNS server holds and advertises AAAA records in the usual
        fashion for systems with general IPv6 addresses.
</p>
<p>As illustrated in <a class='info' href='#dns_alg'>Figure&nbsp;5<span> (</span><span class='info'>DNS Record Translation Service</span><span>)</span></a>, in the IPv6
        domain, when the DNS ALG receives a request for a AAAA record for
        which it has nothing to reply, or for which normal DNS processing
        receives a failure, it obtains an A or MX record from its own database
        or another server, manufactures a corresponding AAAA record using an
        IVI address, and returns that. The IPv6 network cannot distinguish
        between these and other AAAA records, or between these and any other
        address. Routing takes traffic through the gateway without host
        changes.
</p><br /><hr class="insert" />
<a name="dns_alg"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>     IPv4 Domain                      IPv6 Domain
                   |               |
                   |               |    AAAA Request
                   |               |&lt;---------
                   |               |
 A/MX Request      |               |
     &lt;-------------|   DNS ALG     |
                   |   as IPv4     |
                   |   to IPv6     |
     -------------&gt;|  translator   |
A/MX Response      |               |
                   |               |
                   |               |---------&gt;
                   |               |    AAAA Response
                   |               |
                   |               |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: DNS Record Translation Service&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>To avoid conflicts, the DNS server should have access to all AAAA
        records advertised in the IPv6 domain. Otherwise, it may not know when
        to create AAAA records from A or MX records.
</p>
<p>An issue arises with Dynamic DNS, in that the IVI host will only
        know to post its IPv6 addresses. The DNS service should store the AAAA
        records as generated by the host, and also generate an A record for
        each IVI address posted. Whether the IVI address itself is stored as a
        AAAA record as well as in an A record is at the implementer's option;
        if it is not stored it will be created from the A record if
        needed.
</p>
<a name="host"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Host operation in IVI networks</h3>

<p>Host behavior is unchanged by this specification. However, the
        local administration might want to configure host <a class='info' href='#RFC3484'>[RFC3484]<span> (</span><span class='info'>Draves, R., &ldquo;Default Address Selection for Internet Protocol version 6 (IPv6),&rdquo; February&nbsp;2003.</span><span>)</span></a> address selection tables to optimize session
        behavior.
</p>
<a name="addr_selection"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.1"></a><h3>2.5.1.&nbsp;
Interaction of IVI Addresses with RFC3484 Address Selection</h3>

<p><a class='info' href='#RFC3484'>[RFC3484]<span> (</span><span class='info'>Draves, R., &ldquo;Default Address Selection for Internet Protocol version 6 (IPv6),&rdquo; February&nbsp;2003.</span><span>)</span></a> could be summarized as saying that
          IPv6 systems should select source and destination addresses that are
          as similar as possible. "Similarity" is defined in terms of prefix
          length. Each remote address is compared to each local address, and
          the remote address is considered to be most similar to the local
          address with the longest string of equivalent prefix bits. The
          specification recommends that sessions between the two systems
          should prefer the address pair with the longest "similar"
          prefix.
</p>
<p>For example, if Alice has the addresses </p>
<ul class="text">
<li>2001:db8:1234:1::A and
</li>
<li>2001:db8:5678::A,
</li>
</ul>

<p>and Bob has the following addresses </p>
<ul class="text">
<li>2001:db8:1234:2::B and
</li>
<li>2001:db8:5ABC:B,
</li>
</ul>

<p>2001:db8:1234:1::A is more similar to 2001:db8:1234:2::B (the
          first 48 bits are the same as opposed to only the first 33) and
          2001:db8:5678::A is more similar to 2001:db8:5ABC:B (the first 36
          bits are the same as opposed to the first 33). When Alice and Bob
          communicate, the default address policy selects the address pair in
          2001:db8:1234::/48 over 2001:db8:5000::/36 because it has a longer
          "similar" prefix.
</p>
<p>IPv4-only systems connect to IPv6 systems having IVI addresses
          through the gateway, and lack a means to initiate a connection to
          other IPv6 systems. Since IPv4 addresses appear in the IPv6 domain
          as IVI addresses, <a class='info' href='#RFC3484'>[RFC3484]<span> (</span><span class='info'>Draves, R., &ldquo;Default Address Selection for Internet Protocol version 6 (IPv6),&rdquo; February&nbsp;2003.</span><span>)</span></a> will guide
          IPv6-only systems with IVI addresses to connect from their IVI
          address when communicating with IPv4-only systems, as they are the
          "most similar" addresses to those of their IPv4 counterparts. This
          is important, because it promotes stateless translation
          operation.
</p>
<p>IVI systems may also find the IVI address pair "most similar"
          when communicating with other systems with IVI addresses. This is
          acceptable, as to the IPv6 domain they are simply IPv6 addresses and
          will communicate directly.
</p>
<p>In general, a system with both an IPv4 address and an IPv6
          address can connect to a similar system using either technology.
          There need be no preference order, and if one is chosen that is a
          local matter.
</p>
<a name="ivi-IPv4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.2"></a><h3>2.5.2.&nbsp;
Interaction of IPv4 and IVI addresses on the same host</h3>

<p>Systems that have both native IPv4 and translated IVI addresses
          require attention to the configuration of the address choice
          mechanism described in <a class='info' href='#RFC3484'>[RFC3484]<span> (</span><span class='info'>Draves, R., &ldquo;Default Address Selection for Internet Protocol version 6 (IPv6),&rdquo; February&nbsp;2003.</span><span>)</span></a>. In such a
          case, the redundancy suggests different uses for those addresses and
          the possibility that IPv4 reachability has been fragmented.
</p>
<p>For example, consider a host with a private IPv4 address and an
          IVI address attempting to open a session with an IPv4 system with a
          public address. Apart from actually successfully opening a session,
          the addresses give no clue to actual reachability; the remote host
          might be reachable via IPv4, or that might be a private network
          disconnected from the Internet. If the remote host is reachable,
          there is likely to be a NAT between the host and that system, making
          the point moot. Similarly, the remote host might be reachable via
          IVI, but it might not. It might be reachable via both
          simultaneously, and it might not be reachable at all.
</p>
<p>In general, native operation should be preferred to translated
          operation, but the specifics of the environment may guide this
          choice otherwise. As such, if an application is unable to open a
          session using one address, it should try another, and the local
          administration may consider configuring the <a class='info' href='#RFC3484'>[RFC3484]<span> (</span><span class='info'>Draves, R., &ldquo;Default Address Selection for Internet Protocol version 6 (IPv6),&rdquo; February&nbsp;2003.</span><span>)</span></a> tables to manage the case.
</p>
<a name="ops"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6"></a><h3>2.6.&nbsp;
Operation of the IVI Gateway</h3>

<p>The IVI Gateway has two modes, depending on the address of the IPv6
        system using its services. These are the Stateless Mode, used to
        connect between IPv6-only systems with IVI addresses and IPv4 systems,
        and the Stateful Mode, used to connect other (non-IVI) IPv6-only
        systems with IPv4 systems. IPv6 routing should not take traffic
        between IPv6 systems in the same IPv6 domain through the gateway, as
        it will follow more specific routes.
</p>
<p>In either mode, the gateway is subject to the usual ills of Network
        Address Translation. Protocols that exchange IP addresses should in
        general not be exchanged across an IVI gateway, as the addresses are
        not necessarily translatable or meaningful after translation. Also,
        IPsec AH is compromised, so end-to-end privacy and authentication
        issues should be dealt with in another way such as IPsec ESP.
</p>
<p>In general, native (IPv6&lt;-&gt;IPv6 or IPv4&lt;-&gt;IPv4)
        communications are preferable to any form of translation, and
        stateless translation is preferable to stateful translation. In the
        first case, this derives from the End-to-End principle discussed in
        <a class='info' href='#Saltzer'>[Saltzer]<span> (</span><span class='info'>Saltzer, JH., Reed, DP., and DD. Clark, &ldquo;End-to-end arguments in system design,&rdquo; Nov&nbsp;1984.</span><span>)</span></a> - the utility of the network to the
        applications that use it is generally maximized by staying out of
        their way. In the latter case, this is due to the Simplicity Principle
        discussed in <a class='info' href='#RFC3439'>[RFC3439]<span> (</span><span class='info'>Bush, R. and D. Meyer, &ldquo;Some Internet Architectural Guidelines and Philosophy,&rdquo; December&nbsp;2002.</span><span>)</span></a>; given an easy and a hard
        way to do something, and given equivalence of outcome, the easy way is
        generally better for all concerned. Stateful and Stateless operation
        both enable communication at the cost of a header exchange. Stateful
        operation requires supporting dynamically-created per-flow tables in
        the gateway while stateless operation transforms datagrams
        algorithmically without per-flow state.
</p>
<a name="stateless"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6.1"></a><h3>2.6.1.&nbsp;
Stateless (1:1) Operation</h3>

<p>In the stateless mode, the IVI gateway translates datagrams
          exchanged between IPv4 systems and IPv6 systems that have an IVI
          address. The translation is as described in <a class='info' href='#RFC2765'>SIIT<span> (</span><span class='info'>Nordmark, E., &ldquo;Stateless IP/ICMP Translation Algorithm (SIIT),&rdquo; February&nbsp;2000.</span><span>)</span></a> [RFC2765], with the exception that the address format is as
          described in <a class='info' href='#ivi_address_format'>Section&nbsp;2.2<span> (</span><span class='info'>IVI Address Format</span><span>)</span></a> rather than
          the IPv4 Compatible Address described in section 2.1 of that
          document and deprecated in <a class='info' href='#RFC4291'>[RFC4291]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a>. This
          includes the necessary correction of transport layer checksums.
</p>
<p>This is referred to as 'stateless', because the transformation
          between IPv4 and IPv6 communication is entirely algorithmic and
          requires no long-term state in either the hosts or the gateway.
</p>
<a name="stateful"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6.2"></a><h3>2.6.2.&nbsp;
Stateful (1:n) Operation</h3>

<p>In the stateful mode, the IVI gateway operates as a standard
          Network Address Translator, but between IPv4 and IPv6 domains. This
          is similar in many respects to the translation carried out in <a class='info' href='#RFC2766'>NAT-PT<span> (</span><span class='info'>Tsirtsis, G. and P. Srisuresh, &ldquo;Network Address Translation - Protocol Translation (NAT-PT),&rdquo; February&nbsp;2000.</span><span>)</span></a> [RFC2766]. This includes the necessary
          correction of transport layer checksums.
</p>
<p>IPv4 addresses and port numbers are mapped to IPv6 addresses in a
          stateful manner, much as is done in IPv4-IPv4 network address
          translation. The difference is that it is unidirectional; while the
          source port in an IPv6-&gt; IPv4 translation may have to be changed
          to provide adequate flow identification, there is no necessity to
          change the source port in the IPv4-&gt;IPv6 direction.
</p>
<a name="phases"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Transition plan</h3>

<p>Merriam-Webster defines a "transition" as "passage from one state,
      stage, subject, or place to another". Any transition plan that it
      doesn't describe how one can expect to transition from an IPv4 to an
      IPv6 network using it is incomplete. Coexistence is a necessary part,
      and is likely to last for a period of time measured in the durations of
      contracts. But if the increased operations and capital expenditures
      implied in a state of IPv4+IPv6 coexistence doesn't ultimately lead to
      the reduced expenditure state of a single network, it has not solved the
      problem it was intended to address.
</p>
<p>In the IVI model, the network is presumed to traverse four relatively
      stable states. These are: </p>
<ul class="text">
<li>IPv4-only Network
</li>
<li>IPv4+IPv6 Dual Stack Network
</li>
<li>IPv6+IPv4-accessible Network
</li>
<li>IPv6 Network
</li>
</ul>

<a name="phase1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
IPv4-only Network</h3>

<p>The Internet, by and large, runs on IPv4 today. There are
        experimental uses of IPv6 and infrastructure uses of supporting
        internetwork protocols like MPLS and ATM, but end-to-end the protocol
        is IPv4.
</p>
<a name="phase2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
IPv4+IPv6 Dual Stack Network</h3>

<p><a class='info' href='#RFC4213'>[RFC4213]<span> (</span><span class='info'>Nordmark, E. and R. Gilligan, &ldquo;Basic Transition Mechanisms for IPv6 Hosts and Routers,&rdquo; October&nbsp;2005.</span><span>)</span></a> recommends the deployment of a dual
        stack architecture. The reason is straightforward: if while we can map
        IPv4 and IPv6 addresses 1:1 we aggressively deploy IPv6, we have two
        opportunities. First, should there be a problem (and there are always
        problems), user connectivity can be supported using IPv4 while the
        IPv6 issues are sorted out. Second, at the point where the
        availability of IPv4 addresses becomes a serious issue, IPv6
        connectivity will be widespread, meaning that one can progress to the
        next phase rather than scrambling for business continuity.
</p>
<p>We presume that service providers and enterprise networks can
        deploy IPv6 in parallel with IPv4, enabling current hosts (which are
        mostly if not all IPv4+IPv6 capable) to communicate with either
        architecture.
</p>
<a name="phase3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
IPv6+IPv4-accessible Network</h3>

<p>The problem with <a class='info' href='#phase2'>Section&nbsp;3.2<span> (</span><span class='info'>IPv4+IPv6 Dual Stack Network</span><span>)</span></a> is that, although
        people have had warning, they have chosen to not make use of it.
        Hence, we are likely to see an interval in the near future during
        which large numbers of IPv4 addresses are not available to extend
        services and IPv6 is not readily available as a deployed and
        purchasable service.
</p>
<p>In such a case, a service provider has two main choices: obtain
        what IPv4 addresses can be obtained at whatever cost they may be
        available and extend his IPv4 service lifetime for a limited time
        period, or obtain those addresses and use them in a strategic manner
        to encourage movement to IPv6.
</p>
<p>The IVI model suggests that remaining available IPv4 addresses
        could be mapped to IPv6 addresses in such a manner than both IPv4 and
        IPv6 systems can access servers and peers using them. A subscriber
        might be given an IPv6 /56 or /48 prefix for native use and a smaller
        IPv4 /30 or /24 prefix for translated use for servers and peers,
        giving him an IPv6-only network whose servers and peers are available
        using IPv4 via translation. Since the vast majority of systems operate
        as clients or as peer-to-peer application peers, this would in fact
        work.
</p>
<a name="phase4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
IPv6 Network</h3>

<p>At some point, enough systems have IPv6 addresses that it no longer
        makes economic sense to support the two networks in parallel. At this
        point, one can expect customers to no longer purchase IPv4 or IVI
        connectivity, IPv4 and IVI services to become economically
        uninteresting, and a global IPv6-only network to emerge.
</p>
<a name="future"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Future extensions of the IVI Model</h3>

<p>If the IPv6 hosts can be modified, the IVI model can have a stateless
      (1:n)operation, which can support both IPv6 initiated communication as
      well as IPv4 initiated communication.
</p>
<p>For the operation and management concerns, the IVI model has ICMP
      extension, which can be used in the traceroute or similar cases.
</p>
<p>The IVI model can also support the use of multicast between IPv4 and
      IPv6.
</p>
<p>These extensions will be addressed in other documents.
</p>
<a name="natpt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Reflections on RFC 4966</h3>

<p>RFCs <a class='info' href='#RFC4291'>[RFC4291]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a> and <a class='info' href='#RFC4966'>[RFC4966]<span> (</span><span class='info'>Aoun, C. and E. Davies, &ldquo;Reasons to Move the Network Address Translator - Protocol Translator (NAT-PT) to Historic Status,&rdquo; July&nbsp;2007.</span><span>)</span></a> commented on the SIIT and NAT-PT proposals, and
      called for an improved proposal. This note is in response to that
      request. It would be of value to summarize the responses to the
      issues.
</p>
<p>The DNS Application layer Gateway used by IVI, described in <a class='info' href='#dns_service'>Section&nbsp;2.4<span> (</span><span class='info'>DNS service in IVI networks</span><span>)</span></a>, is essentially that of <a class='info' href='#I-D.bagnulo-behave-nat64'>DNS64<span> (</span><span class='info'>Bagnulo, M., Matthews, P., and I. Beijnum, &ldquo;NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4  Servers,&rdquo; March&nbsp;2009.</span><span>)</span></a> [I&#8209;D.bagnulo&#8209;behave&#8209;nat64] apart from the exact
      format of the address. NAT-PT has a problem with its DNS Application
      Layer gateway in that the overlay relationship between IPv4 addresses
      and ports and IPv6 addresses is dynamic, created when the RR is
      requested. There are complexities, scoping, and timing issues with that
      approach. The DNS Application Layer Gateway used by IVI could be
      configured as a completely static mapping, although that would not
      scale. The form of the relationship between A/MX and AAAA records is
      algorithmic and fixed, and the translation is done on the fly without
      saved state. So the DNS Application Layer Gateway is simpler and more
      predictable.
</p>
<p>The stateless data plane translation algorithm, described in <a class='info' href='#stateless'>Section&nbsp;2.6.1<span> (</span><span class='info'>Stateless (1:1) Operation</span><span>)</span></a>, is essentially that of <a class='info' href='#RFC2765'>SIIT<span> (</span><span class='info'>Nordmark, E., &ldquo;Stateless IP/ICMP Translation Algorithm (SIIT),&rdquo; February&nbsp;2000.</span><span>)</span></a> [RFC2765] apart from the address format. As noted,
      <a class='info' href='#RFC4291'>[RFC4291]<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; February&nbsp;2006.</span><span>)</span></a> deprecated the address format with the
      brusque comment that "current IPv6 transition mechanisms no longer use
      these addresses." The reason that they were not widely deployed was that
      they gave network operators little control in routing, or ways to ensure
      that route redistribution worked correctly. A prefix that lets the LIR
      specify the upper bits gives the operator the flexibility to identify
      the IVI gateway advertising the prefix and better control the
      distribution of routes. In addition, moving the IPv4-mapped portion of
      the IVI address into the upper 64 bits of the address enables and
      encourages the network operator to permit IPv4-capable systems to be in
      various places topologically while retaining an address format familiar
      from other IPv6 addresses. The stateless mode applies to every session
      initiated from the IPv4 side of the gateway, as IVI does not provide DNS
      reachability to non-IVI addresses. It also applies to sessions initiated
      from IVI addresses on the IPv6 side of the gateway.
</p>
<p>The stateful data plane algorithm, described in <a class='info' href='#stateful'>Section&nbsp;2.6.2<span> (</span><span class='info'>Stateful (1:n) Operation</span><span>)</span></a>, is similar to that performed in normal
      IPv4/IPv4 NATs. Traffic from a non-IVI IPv6 address is overlaid on an
      IPv4 address and disambiguated by the source port number, and traffic to
      that IPv4 address using that port number as its destination is mapped
      back to the IPv6 address and port. This is essentially the
      "Address+Port" model proposed in <a class='info' href='#APNAT'>[APNAT]<span> (</span><span class='info'>Maennel, O., Bush, R., Cittadini, L., and S. Bellovin, &ldquo;A Better Approach than Carrier-Grade-NAT,&rdquo; Aug&nbsp;2008.</span><span>)</span></a>.
</p>
<p>These three algorithms have two years of operational experience
      behind them in the CERNET/CNGI-CERNET2 network. In a world of "rough
      consensus and running code", these are running code.
</p>
<p>Many of the issues raised in <a class='info' href='#RFC4966'>[RFC4966]<span> (</span><span class='info'>Aoun, C. and E. Davies, &ldquo;Reasons to Move the Network Address Translator - Protocol Translator (NAT-PT) to Historic Status,&rdquo; July&nbsp;2007.</span><span>)</span></a> are in
      fact not specific to NAT-PT, but are true of NATs in general and in
      particular NATs that translate between Internet Protocols with different
      address formats. In that sense, the document is not so much a complaint
      about NAT-PT as it is a complaint about translation. IVI's stateful mode
      suffers many of the same limitations, as would any translator. IVI's
      stateless mode suffers from less of them due to its stateless nature,
      but is nonetheless a translation and therefore breaks some of the
      end-to-end semantics of the Internet.
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>This memo adds no new IANA considerations.
</p>
<p>Note to RFC Editor: This section will have served its purpose if it
      correctly tells IANA that no new assignments or registries are required,
      or if those assignments or registries are created during the RFC
      publication process. From the author's perspective, it may therefore be
      removed upon publication as an RFC at the RFC Editor's discretion.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>Three error cases are apparent: DNS errors, IPsec issues, and
      application address errors.
</p>
<p>As noted in <a class='info' href='#dns'>Figure&nbsp;4<span> (</span><span class='info'>Normal DNS Service</span><span>)</span></a>, the errors that happen in
      NAT-PT implementations can happen in an IVI network as well. These
      mostly relate to the propagation of DNS records outside their domain of
      applicability.
</p>
<p>As noted in <a class='info' href='#ops'>Section&nbsp;2.6<span> (</span><span class='info'>Operation of the IVI Gateway</span><span>)</span></a>, the side-effects of Network
      Address Translation between IPv4 and IPv4 apply when translating between
      IPv4 and IPv6. IPsec AH, whose checksum covers the IP header, fails when
      the header is changed. IPsec ESP, either directly on IP or over UDP are
      usable across NATs and presumably across translators as long as the IPv4
      address is not in the certificate.
</p>
<p>Protocols that exchange IP addresses should not normally be used
      across a translator, as the addresses are generally not applicable on
      the far side. Such protocols should be filtered, or permitted but used
      with care.
</p>
<p><a class='info' href='#APNAT'>[APNAT]<span> (</span><span class='info'>Maennel, O., Bush, R., Cittadini, L., and S. Bellovin, &ldquo;A Better Approach than Carrier-Grade-NAT,&rdquo; Aug&nbsp;2008.</span><span>)</span></a> raises a variety of issues with Carrier
      Grade Network Address Translators; those issues apply to the stateful
      mode of IVI, and in fact to any NAT. The stateless mode mitigates most
      of the issues raised there, however. If anything, this is the reason
      that we recommend dual stack deployment of IPv4 and IPv6 where possible
      in the near term, and target general IPv6 deployment in the medium term,
      as opposed to remaining in a dual address space environment forever.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgements</h3>

<p>Dan Wing and Tony Hain helped with the review of the document.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2765">[RFC2765]</a></td>
<td class="author-text"><a href="mailto:nordmark@sun.com">Nordmark, E.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2765">Stateless IP/ICMP Translation Algorithm (SIIT)</a>,&rdquo; RFC&nbsp;2765, February&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2765.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2766">[RFC2766]</a></td>
<td class="author-text"><a href="mailto:george.tsirtsis@bt.com">Tsirtsis, G.</a> and <a href="mailto:srisuresh@yahoo.com">P. Srisuresh</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2766">Network Address Translation - Protocol Translation (NAT-PT)</a>,&rdquo; RFC&nbsp;2766, February&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2766.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="APNAT">[APNAT]</a></td>
<td class="author-text">Maennel, O., Bush, R., Cittadini, L., and S. Bellovin, &ldquo;<a href="http://rip.psg.com/~randy/080820.alt-to-cgn.pdf">A Better Approach than Carrier-Grade-NAT</a>,&rdquo; Aug&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.bagnulo-behave-nat64">[I-D.bagnulo-behave-nat64]</a></td>
<td class="author-text">Bagnulo, M., Matthews, P., and I. Beijnum, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-bagnulo-behave-nat64-03.txt">NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4  Servers</a>,&rdquo; draft-bagnulo-behave-nat64-03 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-bagnulo-behave-nat64-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3439">[RFC3439]</a></td>
<td class="author-text">Bush, R. and D. Meyer, &ldquo;<a href="http://tools.ietf.org/html/rfc3439">Some Internet Architectural Guidelines and Philosophy</a>,&rdquo; RFC&nbsp;3439, December&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3439.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3484">[RFC3484]</a></td>
<td class="author-text">Draves, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3484">Default Address Selection for Internet Protocol version 6 (IPv6)</a>,&rdquo; RFC&nbsp;3484, February&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3484.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4213">[RFC4213]</a></td>
<td class="author-text">Nordmark, E. and R. Gilligan, &ldquo;<a href="http://tools.ietf.org/html/rfc4213">Basic Transition Mechanisms for IPv6 Hosts and Routers</a>,&rdquo; RFC&nbsp;4213, October&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4213.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4291">[RFC4291]</a></td>
<td class="author-text">Hinden, R. and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc4291">IP Version 6 Addressing Architecture</a>,&rdquo; RFC&nbsp;4291, February&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4291.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4966">[RFC4966]</a></td>
<td class="author-text">Aoun, C. and E. Davies, &ldquo;<a href="http://tools.ietf.org/html/rfc4966">Reasons to Move the Network Address Translator - Protocol Translator (NAT-PT) to Historic Status</a>,&rdquo; RFC&nbsp;4966, July&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4966.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="Saltzer">[Saltzer]</a></td>
<td class="author-text">Saltzer, JH., Reed, DP., and DD. Clark, &ldquo;<a href="http://mit.edu/Saltzer/www/publications/endtoend/endtoend.pdf">End-to-end arguments in system design</a>,&rdquo; ACM Transactions on Computer Systems (TOCS)&nbsp;v.2 n.4, p277-288, Nov&nbsp;1984.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Xing Li</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">CERNET Center/Tsinghua University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Room 225, Main Building, Tsinghua University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing,   100084</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86 62785983</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:xing@cernet.edu.cn">xing@cernet.edu.cn</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Congxiao Bao</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">CERNET Center/Tsinghua University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Room 225, Main Building, Tsinghua University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing,   100084</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86 62785983</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:congxiao@cernet.edu.cn">congxiao@cernet.edu.cn</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Fred Baker</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Santa Barbara, California  93117</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 408 526 4257</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:fred@cisco.com">fred@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kevin Yin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">No. 2 Jianguomenwai Ave, Chaoyang District</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing,   100022</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86 10 8515 5094</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:kyin@cisco.com">kyin@cisco.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
