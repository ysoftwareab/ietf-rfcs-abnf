Network Working Group               G. Sidebottom, L. Ong, Guy Mousseau
INTERNET-DRAFT                                          Nortel Networks
                                                             Ian Rytina
                                                               Ericsson
                                             Hanns-Juergen Schwarzbauer
                                                                Siemens
                                                          Ken Morneault
                                                                  Cisco
                                                          Mallesh Kalla
                                                              Telcordia

Expires in six months                                     10 March 2000



                SS7 MTP3-User Adaptation Layer (M3UA)
                  <draft-ietf-sigtran-m3ua-02.txt>


Status of This Memo

This document is an Internet-Draft and is in full conformance with all 
provisions of Section 10 of RFC 2026. Internet-Drafts are working
documents of the Internet Engineering Task Force (IETF), its areas,
and its working groups.  Note that other groups may also distribute 
working documents as Internet-Drafts.

Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any
time.  It is inappropriate to use Internet-Drafts as reference
material or to cite them other than as 'work in progress.'


     The list of current Internet-Drafts can be accessed at
     http://www.ietf.org/ietf/1id-abstracts.txt

     The list of Internet-Draft Shadow Directories can be accessed at
     http://www.ietf.org/shadow.html.



To learn the current status of any Internet-Draft, please check the
'1id-abstracts.txt' listing contained in the Internet- Drafts Shadow
Directories on ftp.is.co.za (Africa), nic.nordu.net (Europe),
munnari.oz.au (Pacific Rim), ftp.ietf.org (US East Coast), or
ftp.isi.edu (US West Coast).




Abstract

This Internet Draft defines a protocol for the transport of any SS7 
MTP3-User signaling (e.g., ISUP and SCCP messages) over IP using the 
Simple Control Transport Protocol.  Also, provision is made for 
protocol elements that enable a seamless operation of the MTP3-User 
peers in the SS7 and IP domains. This protocol would be used between a 
Signaling Gateway (SG) and a Media Gateway Controller (MGC) or IP-
resident Database.  It is assumed that the SG receives SS7 signaling 
over a standard SS7 interface using the SS7 Message Transfer Part (MTP) 
to provide transport. 



Sidebottom et al                                              [Page 1]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


                        TABLE OF CONTENTS

1. Introduction.......................................................3
    1.1 Scope.........................................................3
    1.2 Terminology...................................................5
    1.3 Signalling Transport Architecture.............................5
    1.4 Services Provided by the M3UA Layer..........................13
    1.5 Internal Functions in the M3UA...............................15
    1.6 Definition of M3UA Boundaries................................18
2. M3UA Protocol Elements............................................18
    2.1 Common Message Header........................................19
    2.2 Transfer Messages............................................20 
    2.3 SS7 Signaling Network management (SSNM) Messages.............21
    2.4 Application Server Process Maintenance Messages..............27
    2.5 Management Messages..........................................31
3. Procedures........................................................34
    3.1 Procedures to Support the Services of the M3UA Layer.........34
    3.2 Procedures to Support the M3UA Services in Section 1.4.2.....34
    3.3 Procedures to Support the M3UA Services in Section 1.4.4.....35
    3.4 Procedures to Support the M3UA Services in Section 1.4.3.....43 
4. Examples of M3UA Procedures.......................................45
    4.1 Establishment of Association and Traffic 
        Between SGs and ASPs.........................................45
    4.2 ASP traffic Failover Examples................................47
    4.3 M3UA/MTP3-User Boundary Examples.............................48
5. Security..........................................................52
    5.1 Introduction.................................................52
    5.2 Threats......................................................52
    5.3 Protecting Confidentiality...................................53
6. IANA Considerations...............................................53
7. Acknowledgements..................................................53
8. References........................................................53
9. Author's Addresses................................................55



















Sidebottom et al                                              [Page 2]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


1.  Introduction

1.1 Scope

There is a need for SCN signaling protocol delivery from an SS7 
Signaling Gateway (SG) to a Media Gateway Controller (MGC) or IP-
resident Database as described in the Framework Architecture for 
Signalling Transport [1].  The delivery mechanism should meet the 
following criteria: 

*  Support for transfer of all SS7 MTP3-User Part messages (e.g., ISUP, 
   SCCP, TUP, etc.)
*  Support for the seamless operation of MTP3-User protocol peers
*  Support for the management of SCTP transport associations and 
   traffic between an SG and one or more MGCs or IP-resident Databases 
*  Support for MGC or IP-resident Database failover and loadsharing
*  Support for the asynchronous reporting of status changes to 
   management 

In simplistic terms, the SG will terminate SS7 MTP2 and MTP3 protocols 
and deliver ISUP, SCCP and/or any other MTP3-User protocol messages 
over SCTP transport associations to MTP3-User peers in MGCs or IP-
resident Databases.


1.2 Terminology

Application Server (AS) - A logical entity serving a specific Routing 
Key. An example of an Application Server is a virtual switch element 
handling all call processing for a unique range of PSTN trunks, 
identified by an SS7 DPC/OPC/CIC_range.  Another example is a virtual 
database element, handling all HLR transactions for a particular SS7 
DPC/OPC/SCCP_SSN combination.  The AS contains a set of one or more 
unique Application Server Processes, of which one or more is normally 
actively processing traffic.

Application Server Process (ASP) - A process instance of an Application 
Server. An Application Server Process serves as an active or standby 
process of an Application Server (e.g., part of a distributed virtual  
switch or database element). Examples of ASPs are processes (or process 
instances of) MGCs, IP SCPs or IP HLRs.  An ASP contains an SCTP end-
point and may be configured to process signalling traffic within more 
than one Application Server. 

Association - An association refers to an SCTP association.  The 
association provides the transport for the delivery of MTP3-User 
protocol data units and M3UA adaptation layer peer messages.

Routing Key: At the SG, the Routing Key describes a set of SS7 
parameter/parameter-ranges that uniquely defines the range of  


Sidebottom et al                                              [Page 3]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000

signalling traffic configured to be handled by a particular Application
Server. For example, where all traffic directed to a particular SS7 
DPC, OPC and ISUP CIC_range(s) or SCCP SSN is to be sent to a 
particular Application Server, that SS7 data defines the associated  
Routing Key.  Routing Keys are mutually exclusive in the sense that a 
received SS7 signalling message cannot be directed to more than one 
Routing Key.   Also, a Routing Key cannot extend across more than a 
single SS7 DPC, in order to more easily support SS7 Management 
procedures.  It is not necessary for the parameter ranges within a 
particular Routing Key to be contiguous.  For example, an ASP could be 
configured to support call processing for multiple ranges of PSTN 
trunks that are not represented by contiguous CIC values.

Routing Context û An Application Server Process may be configured to 
process traffic within more than one Application Server.  In this case, 
the Routing Context parameter is exchanged beween the SG and the ASP, 
identifying the relevant Application Server.  From the perspective of 
an ASP, the Routing Context uniquely identifies the range of traffic 
associated with a particular Application Server, which the ASP is 
configured to receive from the SG.  There is a 1:1 relationship between 
a Routing Context value and a Routing Key at an SG.  Therefore the 
Routing Context can be viewed as an index into an SG Table containing 
the SG Routing Keys. 

Fail-over - The capability to re-route signaling traffic as required to 
an alternate Application Server Process, or group of ASPs, within an 
Application Server in the event of failure or unavailability of a 
currently used Application Server Process.  Fail-back may apply upon 
the return to service of a previously unavailable Application Server 
Process.

Signalling Point Management Cluster (SPMC) A complete set of 
Application Servers represented to the SS7 network under the same SS7 
Point Code.  SPMCs are used to sum the 
availability/congestion/User_Part status of an SS7 destination point 
code that is distributed in the IP domain, for the purpose of 
supporting MTP3 management procedures at an SG.  In some cases, the SG 
itself may also be a member of the SPMC.  In this case, the SG 
availability/congestion/User_Part status must also be taken into 
account when considering any supporting MTP3 management actions.  

MTP3-User - Any protocol normally using the services of the SS7 MTP3 
(e.g., ISUP, SCCP, TUP, etc.).

Network Appearance û The Network Appearance identifies an SS7 network 
context for the purposes of logically separating the signaling traffic 
between the SG and the Application Server Processes over a common SCTP 
Association.  An example is where an SG is logically partitioned to 
appear as an element in four separate national SS7 networks.  A Network 
Appearance implicitly defines the SS7 Point Code(s), Network Indicator 
and MTP3 protocol type/variant/version used within a specific SS7 


Sidebottom et al                                              [Page 4]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


network partition.  An physical SS7 route-set or link-set at an SG can 
appear in only one network appearance. The Network Appearance is not 
globally significant and requires coordination only between the SG and 
the ASP.

Network Byte Order: Most significant byte first, a.k.a Big Endian.

Layer Management û Layer Management is a nodal function in an SG or ASP 
that handles the inputs and outputs between the M3UA layer and a local 
management entity.  

Host - The computing platform that the ASP process is running on.

Stream - A stream refers to an SCTP stream.


1.3 Signaling Transport Architecture

1.3.1 Protocol Architecture.  

The framework architecture that has been defined for SCN signaling 
transport over IP [1] uses multiple components, including a signaling 
common transport protocol and an adaptation module to support the 
services expected by a particular SCN signaling protocol from its 
underlying protocol layer.  

Within the framework architecture, this document defines an MTP3-User 
adaptation module that is suitable for the transport of SS7 ISDN User 
Part (ISUP) [2,3,4] and Signalling Connection Control Part (SCCP) 
[5,6,7] messages but could be equally used to transport other SS7 MTP3-
User Part messages such as, for example, the Telephone User Part (TUP) 
[8].  TCAP [9,10,11] or RANAP [12] messages are transported 
transparently by the M3UA as SCCP payload, as they are SCCP-User 
protocols.  The M3UA uses the services of the Simple Common Transport 
protocol [13] as the underlying reliable signaling common transport 
protocol. 

In a Signaling Gateway, it is expected that the SS7 MTP3-User signaling
is transmitted and received from the PSTN over a standard SS7 network 
interface, using the SS7 Message Transfer Part (MTP) [14,15,16] to 
provide reliable transport of the MTP3-User signaling messages to and 
from an SS7 Signaling End Point (SEP) or Signaling Transfer Point 
(STP).  The SG then provides a functional inter-working of transport 
functions with the IP transport, in order to transfer the MTP3-User 
signaling messages to and from an Application Server Process where the 
peer MTP3-User protocol layer exists.  

The use of standard MTP Level 2 signaling links in the SS7 network 
interface is not the only possibility.  ATM-based High Speed Links 
could also be used, using the services of the Signaling ATM Adaptation 


Sidebottom et al                                              [Page 5]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


Layer (SAAL) [17,18].  For that matter, it is possible that IP-based 
links could be present, using the services of the MTP2-User Adaptation 
Layer (M2UA) [19].  Also note that STPs may be present in the SS7 path 
between the SS7 SEP and the SG.

Where ATM-base High Speed Links are used in the SS7 network, it is 
possible for the SG to use the services of the MTP-3b [20] for reliable 
transport to and from an SS7 SEP or STP. The maximum Service Data Unit 
(SDU) supported by the MTP-3b is 4096 octets compared to the 272 octet 
maximum of the MTP.  However, for MTP3-Users to take advantage of the 
larger SDU between MTP3-User peers, network architects should ensure 
that MTP3-b is used end-to-end between the SG and the SS7-resident 
peer.  

Three example cases are shown below:

1.3.1.1 Example 1: ISUP transport

  ********   SS7   *****************   IP   ********
  * SEP  *---------*      SG       *--------* ASP  *
  ********         *****************        ********

  +------+                                  +------+
  | ISUP |               (NIF)              | ISUP |
  +------+         +------+-+------+        +------+
  | MTP3 |         | MTP3 | | M3UA |        | M3UA |
  +------|         +------+ +------+        +------+
  | MTP2 |         | MTP2 | | SCTP |        | SCTP |
  +------+         +------+ +------+        +------+
  |  L1  |         |  L1  | |  IP  |        |  IP  |
  +------+         +------+ +------+        +------+ 
      |_______________|         |______________|

    SEP - SS7 Signaling End Point
    SCTP - Simple Common Transport Protocol
    NIF û Nodal Interworking Function

Within the SG, MTP-TRANSFER indication primitives received from the MTP 
Level 3 upper layer interface are sent to the local M3UA-resident 
network address translation and mapping function for ongoing routing to 
the final IP destination.  MTP-TRANSFER primitives received from the 
local M3UA network address translation and mapping function are sent to 
the MTP Level 3 upper layer interface as MTP-TRANSFER request 
primitives for on-going MTP Level 3 routing to an SS7 SEP.  

For internal SG modelling purposes, this may be accomplished with the 
use of an implementation-dependent nodal inter-working function within 
the SG that serves to transport messages within the SG between the MTP3 
and M3UA.  This nodal inter-working function has no visible peer 
protocol with either the ASP or SEP.


Sidebottom et al                                              [Page 6]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


1.3.1.2  Example 2: SCCP transport where an SCCP function at the SG is 
invoked:

  ********   SS7   *****************   IP   ********
  * SEP  *---------*               *--------*      *
  *  or  *         *      SG       *        * ASP  *
  * STP  *         *               *        *      *
  ********         *****************        ********

  +------+         +---------------+        +------+
  | SCCP |         |     SCCP      |        | SCCP |
  +------+         +------+-+------+        +------+
  | MTP3 |         | MTP3 | | M3UA |        | M3UA |
  +------|         +------+ +------+        +------+
  | MTP2 |         | MTP2 | | SCTP |        | SCTP |
  +------+         +------+ +------+        +------+
  |  L1  |         |  L1  | |  IP  |        |  IP  |
  +------+         +------+ +------+        +------+
      |_______________|         |______________|

    STP - SS7 Signaling Transfer Point

In this example, the SG contains an instance of the SS7 SCCP protocol
layer that may, for example, perform the SCCP Global Title Translation 
(GTT) function for messages logically addressed to the SG SCCP.  If the 
result of a GTT for an SCCP message yields an SS7 DPC or DPC/SSN 
address result of an SCCP peer located in the IP domain, the resulting 
MTP-TRANSFER request primitive is sent to the local M3UA-resident 
network address translation and mapping function for ongoing routing to 
the final IP destination.  

Similarly, the SCCP instance in an SG can perform the SCCP GTT service 
for messages logically addressed to it from SCCP peers in the IP 
domain.  In this case, MTP-TRANSFER messages are sent from the local 
M3UA-resident network address translation and mapping function to the 
SCCP for GTT.  If the result of the GTT yields the address of an SCCP 
peer in the SS7 network then the resulting MTP-TRANSFER request is 
given to the MTP3 for delivery to an SS7-resident node.

It is possible that the above SCCP GTT at the SG could yield the 
address of an SCCP peer in the IP domain and the resulting MTP-TRANSFER 
primitive would be sent back to the M3UA for delivery to an IP 
destination.

For internal SG modelling purposes, this may be accomplished with the 
use of an implementation-dependent nodal inter-working function within 
the SG that effectively sits below the SCCP and routes MTP-TRANSFER 
messages to/from both the MTP3 and the M3UA, based on the SS7 DPC or 
DPC/SSN address information.  This nodal inter-working function has no 
visible peer protocol with either the ASP or SEP.


Sidebottom et al                                              [Page 7]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


Note that the services and interface provided by M3UA are the same as 
in Example 1 and the functions taking place in the SCCP entity are 
transparent to M3UA.  The SCCP protocol functions are not reproduced in 
the M3UA protocol.


1.3.1.3 Example 3 û Seamless Handling of MTP3 Management

  ********   SS7   *****************   IP   ********
  * SEP  *---------*               *--------*      *
  *  or  *         *      SG       *        * ASP  *
  * STP  *         *               *        *      *
  ********         *****************        ********

                         (NIF)
  +------+         +------+-+------+        +------+
  | MTP3 |         | MTP3 | | M3UA |        | M3UA |
  +------|         +------+ +------+        +------+
  | MTP2 |         | MTP2 | | SCTP |        | SCTP |
  +------+         +------+ +------+        +------+
  |  L1  |         |  L1  | |  IP  |        |  IP  |
  +------+         +------+ +------+        +------+
      |_______________|         |______________| 

In the case of SS7 MTP3 network management, it is required that the 
MTP3-User protocols at ASPs receive indications of SS7 signaling point 
availability, SS7 network congestion and User Part availability as 
would be expected an SS7 SEP node.  To accomplish this, the MTP-PAUSE, 
MTP-RESUME and MTP-STATUS indication primitives received at the MTP3 
upper layer interface at the SG need to be made available to the remote 
MTP3-User lower layer interface at the ASP.  Note: These indication 
primitives are also made available to any existing local MTP3-Users at 
the SG, such as the SCCP in the previous example.

For internal SG modelling purposes, this may be accomplished with the 
use of an implementation-dependent nodal inter-working function within 
the SG that effectively sits above the MTP3 and delivers MTP-PAUSE, 
MTP-RESUME and MTP-STATUS indication primitives received from the MTP 
Level 3 upper layer interface to the local M3UA-resident management 
function.  This nodal inter-working function has no visible peer 
protocol with either the ASP or SEP.

It is important to clarify that MTP3 management messages such as TFPs 
or TFAs received from the SS7 network are not "encapsulated" and sent 
blindly to the ASPs.  Rather, the existing MTP3 management procedures 
are followed within the MTP3 function of the SG to re-calculate the 
MTP3 route set status and initiate any signaling-route-set-test 
procedures into the SS7 network.  Only when a route set status changes 
are MTP-PAUSE or MTP-RESUME primitives invoked.  These primitives can 
also be invoked due to local SS7 link set conditions as per existing 
MTP3 procedures.

Sidebottom et al                                              [Page 8]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


1.3.2 Signaling Network Architecture

A Signaling Gateway is used to support the transport of MTP3-User 
signaling traffic received from the SS7 network to multiple distributed 
ASPs (e.g., MGCs and IP Databases).  Clearly, the M3UA protocol 
description cannot in itself meet any performance and reliability 
requirements for such transport.  A physical network architecture is 
required, with data on the availability and transfer performance of the 
physical nodes involved in any particular exchange of information.  
However, the M3UA protocol must be flexible enough allow its operation 
and management in a variety of physical configurations that will enable 
Network Operators to meet their performance and reliability 
requirements.  

To meet the stringent SS7 signaling reliability and performance 
requirements for carrier grade networks, these Network Operators should 
ensure that there is no single point of failure provisioned in the end-
to-end network architecture between an SS7 node and an IP ASP.  
Depending of course on the reliability of the SG and ASP functional 
elements, this can typically be met by the use of redundant SGs, the 
provision of redundant QOS-bounded IP network paths for SCTP 
Associations between SCTP End Points, and redundant Hosts.  The 
distribution of ASPs within the available Hosts is also important.  For 
a particular Application Server, the related ASPs should be distributed 
over at least two Hosts.

An example physical network architecture relevant to carrier-grade 
operation in the IP network domain is shown in Figure 1 below:
























Sidebottom et al                                              [Page 9]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


  ********                                         ************** 
  *      *_________________________________________*  ********  * Host1 
  *      *                                _________*  * ASP1 *  * 
  *  SG1 *   SCTP Associations           |         *  ********  * 
  *      *_______________________        |         *  ********  * 
  *      *                       |       |         *  * ASP2 *  * 
  *      *                       |       |         *  ********  * 
  *      *                       |       |         *  ********  * 
  *      *                       |       |         *  * ASP3 *  * 
  ********                       |       |         *  ********  * 
                                 |       |         *      .     * 
  ********                       |       |         *      .     * 
  *      *_______________________________|         *            *
  *      *                       |                 *  ********  * 
  *  SG2 *    SCTP Associations  |                 *  * ASPn *  * 
  *      *____________           |                 *  ********  * 
  *      *            |          |                 **************
  *      *            |          |                 **************    
  *      *            |          |_________________*  ********  * Host2 
  *      *            |____________________________*  * ASP1 *  * 
  ********                                         *  ********  *
                                                   *  ********  * 
                                                   *  * ASP2 *  * 
                                                   *  ********  * 
                                                   *  ********  * 
                                                   *  * ASP3 *  * 
                                                   *  ********  * 
                                                   *      .     * 
                                                   *      .     * 
                                                   *            *
                                                   *  ********  * 
                                                   *  * ASPn *  * 
                                                   *  ********  * 
                                                   **************
                                                           .
                                                           .
                                                           .

                    Figure 1 û Physical Model


For carrier grade networks, Operators should ensure that under failure 
or isolation of a particular ASP, stable calls or transactions are not 
lost.  This implies that ASPs need, in some cases, to share the 
call/transaction state or be able to pass the call/transaction state 
between each other.  Also, in the case of ASPs performing call 
processing, coordination may be required with the related Media Gateway 
to transfer the MGC control for a particular trunk termination.  
However, this sharing or communication is outside the scope of this 
document.


Sidebottom et al                                             [Page 10]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000



1.3.3 SS7 Point Code Representation

Within an SS7 network, a Signaling Gateway is charged with representing 
a set of nodes in the IP domain into the SS7 network for routing 
purposes.  The SG itself, as a physical node in the SS7 network, must 
be addressable with an SS7 Point Code for MTP3 Management purposes.  
The SG Point Code will also be used for addressing any local MTP3-Users 
at the SG such as an SG-resident SCCP function.  

Where an SG is logically partitioned to operate in multiple SS7 network 
appearances, the SG must be addressable with a Point Code in each 
network appearance and represents a set of nodes in the IP domain into 
each SS7 network.  Alias PCs may also be used within an SG network 
appearance, but SG MTP3 management messages to/from the SS7 network 
will not use the alias PCs. 

The M3UA places no restrictions on the SS7 Point Code representation of 
any of the ASPs.  ASPs can be represented under the same PC of the SG, 
their own individual Point Codes or grouped with other ASPs for Point 
Code preservation purposes.  A single Point Code may be used to 
represent the SG and all the ASPs together, if desired. 

If an ASP or group of ASPs is available to the SS7 network via more 
than one SG, each with its own Point Code, the ASP(s) can be 
represented by a Point Code that is separate from any SG Point Code.  
This allows these SGs to be viewed from the SS7 network as "STPs", each 
having an ongoing  "route" to the same ASP(s).  Under failure 
conditions where an ASP becomes unavailable from one of the SGs, this 
approach enables MTP3 route management messaging between the SG and SS7 
network, allowing simple SS7 re-routing through an alternate SG without 
changing the Destination Point Code Address of SS7 traffic to the ASPs. 
 
                           +--------+ 
                           |        | 
              +------------+  SG 1  +--------------+ 
  +-------+   |            | "STP"  |              |     ---- 
  |  SEP  +---+            +--------+              +---/      \ 
  |   or  |                                           |  ASPs  | 
  |  STP  +---+            +--------+              +---\      / 
  +-------+   |            |        |              |     ---- 
              +------------+  SG 2  +--------------+ 
                           | "STP"  | 
                           +--------+

Note: there is no SG to SG communication shown, so each SG can be 
reached only via the direct Linkset from the SS7 network.





Sidebottom et al                                             [Page 11]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


1.3.4 ASP Fail-over Model and Terminology

The network address translation and mapping function of the M3UA 
supports ASP fail-over functions in order to support a high 
availability of call and transaction processing capability.  All MTP3-
User messages (e.g., ISUP, SCCP) incoming to an SG from the SS7 network 
are assigned to a unique Application Server, based on the information 
in the message.  The information examined may be one or more of the MTP 
DPC, OPC, SLS, or any MTP3-User specific fields such as, for example, 
the ISUP CIC, SCCP SSN, or TCAP TRID.  Some example possibilities are 
the DPC alone, the DPC/OPC combination, the DPC/OPC/CIC combination, or 
the DPC/SSN combination.  The information used to point to an AS is not 
limited by the M3UA and none of the examples are mandated.  

The Application Server is in practical terms a list of all ASPs 
currently configured/registered to process MTP3-User messages within a 
certain range of routing information, known as a Routing Key.  One or 
more ASPs in the list are normally active (i.e., handling traffic) 
while any others may be unavailable or inactive, to be possibly used in 
the event of failure or unavailability of the active ASP(s).  

The fail-over model supports an "n+k" redundancy model, where "n" ASPs 
is the minimum number of redundant ASPs required to handle traffic and 
"k" ASPs are available to take over for a failed or unavailable ASP.  
Note that "1+1" active/standby redundancy is a subset of this model. A 
simplex "1+0" model is also supported as a subset, with no ASP 
redundancy.

To avoid a single point of failure, it is recommended that a minimum of 
two ASPs be in the list, resident in separate hosts  and therefore 
available over different SCTP Associations.  For example, in the 
network shown in Figure 1, all messages to DPC x could be sent to ASP1 
in Host1 or ASP1 in Host2.  The AS list at SG1 might look like this:

    Routing Key {DPC=x) "Application Server #1"
        ASP1/Host1  û State=Up, Active
        ASP1/Host2  û State=Up, Inactive

In this "1+1" redundancy case, ASP1 in Host1 would be sent any incoming 
message with DPC=x.  ASP1 in Host2 would normally be brought to the 
active state upon failure of, or loss of connectivity to, ASP1/Host1. 
In this example, both ASPs are Up, meaning that the related SCTP 
association and far-end M3UA peer is ready.

The AS List at SG1 might also be set up in loadshare mode:

    Routing Key {DPC=x) - Application Server #1
        ASP1/Host1 û State = Up, Active
        ASP1/Host2 û State = Up, Active



Sidebottom et al                                             [Page 12]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


In this case, both the ASPs would be sent a portion of the traffic.  
For example the two ASPs could together form a database, where incoming 
queries may be sent to any active ASP.

Care must be exercised by a Network Operator in the selection of the 
routing information to be used as the Routing Key for a particular AS.  
For example, where Application Servers are defined using ranges of ISUP 
CIC values, the Operator is implicitly splitting up control of the 
related circuit groups.  Some CIC value range assignments may interfere 
with ISUP circuit group management procedures.  Similarly, within an 
AS, if a loadbalancing algorithm were to use CIC values to balance the 
load across the ASPs, the span of circuit contol assigned to particular 
ASPs must also be weighed against the ISUP circuit group management 
procedures.  

In the process of fail-over or fail-back, it is recommended that in the 
case of ASPs supporting call processing, stable calls do not fail.  It 
is possible that calls in "transition" may fail, although measures of 
communication between the ASPs involved can be used to mitigate this.  
For example, the two ASPs may share call state via shared memory, or 
may use an ASP to ASP protocol to pass call state information.

1.3.5 Client/Server Model

The SG takes on the role of server while the ASP is the client. ASPs 
must initiate the SCTP association to the SG.

The SCTP (and UDP/TCP) Registered User Port Number Assignment for M3UA 
is 2905.


1.4 Services Provided by the M3UA Layer

The M3UA Layer at the ASP provides the equivalent set of primitives at 
its upper layer to the MTP3-Users as provided by the MTP Level 3 to its 
local users at an SS7 SEP.  In this way, the ISUP and/or SCCP layer at 
an ASP is unaware that the expected MTP3 services are offered remotely 
from an MTP3 Layer at an SG and not by a local MTP3 layer.  In effect, 
the M3UA extends access to the MTP3 layer services to a remote ASP û 
the M3UA does not itself provide the MTP3 services so does not 
duplicate MTP3 procedures.

1.4.1 Support for the transport of MTP3-User Messages

The M3UA provides the transport of MTP-TRANSFER primitives across SCTP 
associations between an SG and an ASP. The MTP-TRANSFER primitives are 
encoded as MTP3-User messages with attached MTP3 Routing Labels as 
described in the message format sections of the SCCP and ISUP 
recommendations.  In this way, the SCCP and ISUP messages received from 
the SS7 network are not re-encoded into a different format for 


Sidebottom et al                                             [Page 13]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


transport to/from the ASP. As well, all the required MTP3 Routing Label 
information (OPC, DPC, SIO) is available at the ASP as is expected by 
the MTP3-User protocol layer.  

Note that M3UA does not itself impose a 272-octet user information 
block limit as specified by the MTP Level 3.  Larger information blocks 
can be accommodated directly by M3UA/SCTP without the need for an upper 
layer segmentation/re-assembly procedure such as specified in recent 
SCCP or ISUP versions. However, in the context of an SG, the maximum 
272-octet block size must be followed when inter-working to a SS7 
network that does not support the transfer of larger information blocks 
to the final destination, as is possible in the Broadband MTP [20].  
This will avoid ISUP or SCCP fragmentation requirements at the SG.  
However, if the SS7 network is provisioned to support the Broadband MTP 
to the final SS7 destination, the information block size limit may be 
increased past 272 octets.  

1.4.2 Native Management Functions

The M3UA may provide management of the underlying SCTP transport 
protocol to ensure that SG-ASP transport is available to the degree 
called for by the MTP3-User signaling applications.

The M3UA provides the capability to indicate errors associated with 
received M3UA messages and to notify, as appropriate, local management 
and/or the remote peer M3UA.

1.4.3 Inter-working with MTP3 Network Management Functions

At the SG, the M3UA must also provide inter-working with MTP3
management functions to support seamless operation of the user SCN
signaling applications in the SS7 and IP domains.  This includes:
 
  - Providing an indication to MTP3-Users at an ASP that a remote 
destination in the SS7 network is not reachable.

  - Providing an indication to MTP3-Users at an ASP that a remote 
destination in the SS7 network is now reachable.

  - Providing an indication to MTP3-Users at an ASP that messages to a 
remote MTP3-User peer in the SS7 network are experiencing SS7 
congestion

  - Providing an indication to MTP3-Users at an ASP that a remote MTP3-
User peer is unavailable.  

The M3UA layer at an ASP may initiate an audit of the availability or 
the congested state of remote SS7 destinations.  This information is 
requested from the M3UA at the SG. 



Sidebottom et al                                             [Page 14]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


1.4.4 Support for the management of SCTP associations between the SG 
and ASPs.

The M3UA layer at the SG maintains the availability state of all 
configured remote ASPs, in order to manage the SCTP Associations and 
the traffic between the SG and ASPs.  As well, the active/inactive 
state of remote ASPs is also maintained - Active ASPs are those 
currently receiving traffic from the SG.

The M3UA layer at either the SG or ASP can be instructed by local 
management to establish an SCTP association to a peer M3UA node.  This 
can be achieved using the M-SCTP ESTABLISH primitive to request, 
indicate and confirm the establishment of an SCTP association with a 
peer M3UA node.

The M3UA layer may also need to inform local management of the status 
of the underlying SCTP associations using the M-SCTP STATUS request and 
indication primitive. For example, the M3UA may inform local management 
of the reason for the release of an SCTP association, determined either 
locally within the M3UA layer or by a primitive from the SCTP.

Also the M3UA layer may need to inform the local management of the 
change in availability status of an ASP.  This can be achieved using 
the M-ASP STATUS primitive to change and indicate the status of an ASP.


1.5 Internal Functions in the M3UA

1.5.1 Address Translation and Mapping at the SG M3UA

In order to direct messages received from the SS7 MTP3 network to the
desired IP destination, the SG M3UA must perform address translation
and mapping functions using information from the received MTP3-User 
message.

To support this mapping, the SG must maintain a network address 
translation table, mapping incoming SS7 message information to an 
Application Server serving a particular application and range of 
traffic.  This is accomplished by comparing a set of the information in 
an incoming SS7 message to provisioned SG Routing Keys to determine an 
Application Server that serves a particular range of traffic. 

Possible SS7 address/routing information that may comprise a Routing 
Key entry includes, for example, the OPC, DPC, SIO, ISUP CIC range or 
SCCP Subsystem Number.  The particular information used in an SG M3UA 
Routing Key is application and network dependent.  

An Application Server contains a list of one or more ASPs which are 
capable of processing the traffic.  This list is assumed to be dynamic, 
taking into account the availability status of the individual ASPs in


Sidebottom et al                                             [Page 15]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


the list, configuration changes, and possible fail-over mechanisms.  
The M3UA protocol includes messages to convey the availability status 
of the individual ASPs as input to a fail-over mechanism.

Normally, one or more ASPs is active in the ASP (i.e., currently 
processing traffic) but in certain failure and transition cases it is 
possible that there may not be an active ASP available.  Both 
loadsharing and backup scenarios are supported.

Where there is no Routing Key match for an incoming SS7 message, a 
default treatment must be specified.  Possible solutions are to provide 
a "Default" Application Server at the SG that will direct all 
unallocated traffic to a (set of) "Default" ASP(s), or to drop the 
messages and provide a notification to management.


1.5.2 SG Redundancy

It is possible that the ASP could route signaling messages destined to 
the SS7 network through more than one SG.  A primary/back-up case is 
possible where the unavailability of the SCTP assocation to a primary 
SG, or the unavailability of the SS7 destination node from the primary 
SG, could be used to reroute affected traffic to a next-preferred SG.  
Also, a load-sharing case is possible where the signaling messages are 
load-shared across two (or more) SGs. 

>From the perspective of an ASP, it is assumed that a particular SG is 
capable of handling traffic to an SS7 destination if an SCTP 
association to the SG is available, the SG has received an indication 
from the ASP that it is currently actively handling traffic, and the SG 
has not indicated that the SS7 destination is unavailable.  Where an 
ASP is configured to use two or more SGs for directing traffic to the 
SS7 network, the ASP must maintain knowledge of the current capability 
of the SG to handle traffic to destinations of interest, for the 
purpose of efficiently supporting the redirection/loadsharing of 
traffic. The ASP may also use information received from the SGs of 
congestion to concerned destinations.

1.5.3 SCTP Stream Mapping.  

The M3UA at both the SG and ASP also supports the assignment of 
signaling traffic into streams within an SCTP association.  Traffic 
that requires sequencing must be assigned to the same stream.  To 
accomplish this, MTP3-User traffic may be assigned to individual 
streams based on the SLS value in the MTP3 Routing Label or the ISUP 
CIC assignment, subject of course to the maximum number of streams 
supported by the underlying SCTP association.  





Sidebottom et al                                             [Page 16]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


1.5.4 Congestion Control.

The M3UA Layer is informed of local and IP network congestion by means 
of an implementation-dependent function (e.g., an implementation-
dependent indication from the SCTP of IP network congestion). When an 
SG determines that the transport of SS7 messages to an Signalling Point 
Management Cluster (SPMC) is encountering congestion, the SG may 
optionally trigger SS7 MTP3 Transfer Controlled management messages to 
originating SS7 nodes. The triggering of SS7 MTP3 Management messages 
from an SG is an implementation-dependent function.  At an ASP, 
congestion is indicated to local MTP3-Users by means of an MTP-Status 
primitive indicating congestion, to invoke appropriate upper layer 
responses, as per current MTP3 procedures.

1.5.5 Seamless Network Management Inter-working.

The M3UA at an SG must maintain knowledge of SS7 node and Signalling 
Point Management Cluster (SPMC) status in their respective domains in 
order to perform as seamless as possible inter-working of the two 
domains.  For example, SG M3UA knowledge of the availability and/or 
congestion status of SPMC and SS7 nodes must be maintained and 
disseminated in the respective networks so that end-to-end operation is 
transparent to the communicating SCN protocol peers at the SS7 node and 
ASP.

When an SG M3UA determines that the transport of SS7 messages to an 
SPMC is encountering congestion, the SG may optionally inform the MTP3 
route management function (by an implementation-dependent mechanism).  
This information is used by the MTP3 to mark the route to the affected 
destination as congested and to trigger MTP Transfer Controlled (TFC) 
messages to any SS7 SEPs generating traffic to the congested DPC, as 
per current MTP3 procedures.

When an SG M3UA determines that the transport of SS7 messages to all 
ASPs in a particular SPMC is interrupted, the SG M3UA may similarly 
optionally inform the MTP3 route management function. This information 
is used by the MTP3 to mark the route to the affected destination as 
unavailable and to trigger MTP Transfer Prohibited (TFP) messages to 
the adjacent SS7 nodes which are generating traffic to the unavailable 
DPC as per current MTP procedures.  If the SG is considered part of the 
SPMC, MTP TFP messages must not be triggered into the SS7 network, as 
SS7 procedures do not support the sending of TFPs by an SS7 node to 
indicate its own unavailability.

When an SG M3UA determines that the transport of SS7 messages to an ASP 
in a particular SPMC can be resumed, the SG M3UA may similarly 
optionally inform the MTP3 route management function. This information 
is used by the MTP3 to mark the route to the affected destination as 
now available and to trigger MTP Transfer Allowed (TFA) messages to the 
adjacent SS7 nodes as per current MTP3 procedures.


Sidebottom et al                                             [Page 17]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


Note: In some SS7 network architectures, the sending of TFP and TFA 
messages from the SG into the SS7 network should be suppressed.  For 
example, in the case where an SG seen by the adjacent SS7 nodes as an 
SEP (i.e., in ANSI MTP terms the SG is connected via A-links or F-
links), TFP or TFA messages would not normally be expected by the 
adjacent SS7 node.

1.5.6 Management Inhibit/Uninhibit

Local Management at an ASP or SG may wish to stop traffic across an 
SCTP association in order to temporarily remove the association from 
service or to perform testing and maintenance activity.  The function 
could optionally be used to control the start of traffic on to a newly-
available SCTP association.

1.5.7 Active Association Control

At an SG, an Application Server list may contain active and inactive 
ASPs to support ASP loads-haring and fail-over procedures. When, for 
example, both a primary and a back-up ASP are available, M3UA peer 
protocol is required to control which ASP is currently active.  The 
ordered list of ASPs within a logical Application Server is kept 
updated in the SG to reflect the active Application Server Process(es). 


1.6 Definition of M3UA Boundaries

1.6.1 Definition of the boundary between M3UA and an MTP3-User.

>From ITU Q.701 [2]:

MTP-TRANSFER request
MTP-TRANSFER indication
MTP-PAUSE indication
MTP-RESUME indication
MTP-STATUS indication  

1.6.2 Definition of the boundary between M3UA and SCTP

The upper layer primitives provided by the SCTP are provided in [13]


2.0 M3UA Protocol Elements

The general M3UA message format includes a Common Message Header 
followed by zero or more parameters as defined by the Message Type.  
For forward compatibility, all Message Types may have attached 
parameters even if none are specified in this version.




Sidebottom et al                                             [Page 18]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


2.1 Common Message Header

The protocol messages for MTP3-User Adaptation require a message 
structure which contains a version, message type, message length, and 
message contents.   This message header is common among all signaling 
protocol adaptation layers:


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Version    |     Spare     |         Message Type          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Message Length                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |


All fields in an M3UA message MUST be transmitted in the network byte order, 
unless otherwise stated.


2.1.1 M3UA Protocol Version

The version field (Vers.) contains the version of the M3UA adaptation 
layer.  The supported versions are:

      0000 0001   Release 1.0 protocol

2.1.2  Message Types

The following list contains the message types for the defined messages.

     Transfer Messages

        Data                                       0101

     SS7 Signaling Network Management (SSNM) Messages

        Destination Unavailable (DUNA)             0201
        Destination Available (DAVA)               0202
        Destination State Audit (DAUD)             0203
        SS7 Network Congestion State (SCON)        0204
        Destination User Part Unavailable (DUPU)   0205

     Application Server Process Maintenance (ASPM) messages

        ASP Up                                     0301
        ASP Down                                   0302
        Heartbeat                                  0303
        ASP Active                                 0401
        ASP Inactive                               0402

Sidebottom et al                                             [Page 19]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000

     
     Management (MGMT) Messages

         Error                                     0000
         Notify                                    0001

2.1.3 Message Length

The Message Length defines the length of the message in octets, not 
including the header.


2.2 Transfer Messages

The following section describes the Transfer messages and parameter 
contents.  The general message format includes a Common Message Header 
together with a list of zero or more parameters as defined by the 
Message Type.  All Message Types can have attached parameters.  

2.2.1 Data Message

The Data message contains the SS7 MTP3-User protocol data, which is an 
MTP-TRANSFER primitive, including the complete MTP3 Routing Label. The 
Data message contains the following parameters:

     NETWORK APPEARANCE (Optional)
     PROTOCOL DATA

The format for the Data Message parameters is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Tag (0x1)          |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Network Appearance*                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Tag (0x3)          |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                         Protocol Data                         |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


The optional Network Appearance parameter identifies the SS7 network 
context for the message, for the purposes of logically separating the 
signaling traffic between the SG and the Application Server Process 
over a common SCTP Association.  An example is where an SG is logically 
partitioned to appear as an element in four different national SS7 
networks.

Sidebottom et al                                             [Page 20]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000

In a Data message, the Network Appearance defines the SS7 Point Codes 
used, the SS7 Network Indicator value and MTP3/MTP3-User protocol 
type/variant/version used within the SS7 network partition.  Where an 
SG operates in the context of a single SS7 network, or individual SCTP 
associations are dedicated to each SS7 network context, or the Network 
Indicator in the SIO of the MTP-Transfer primitive is sufficient, the 
Network Appearance parameter is not required.

The format is an integer, the values of which are assigned according to 
network operator policy. The values used are of local significance 
only, coordinated between the SG and ASP.

Where the optional Network Appearance parameter is present, it must be 
the first parameter in the message as it defines the format of the 
Protocol Data field.

The Protocol Data field contains the MTP3-User application message, 
which is in effect an MTP-TRANSFER primitive.  As defined for a 
specific value of the Protocol Identifier, this will include the MTP-
User Data and includes the MTP Routing Label (SS7 OPC, DPC, SLS), and 
the SIO (Service Indicator, Network Indicator & optional Message 
Priority codes). Note: in the case of ISUP messages, the Circuit 
Identification Code is also included. 

2.3  SS7 Signaling Network Management (SSNM) Messages

2.3.1 Destination Unavailable (DUNA)

The DUNA message is sent from the SG to all concerned ASPs to indicate 
that the SG has determined that one or more SS7 destinations are 
unreachable.  The MTP3-User at the ASP is expected to stop traffic to 
the affected destination through the SG initiating the DUNA as per the 
defined MTP3-User procedures. 

The DUNA message contains the following parameters:

     Network Appearance (Optional)
     Affected Destination
     Info String (Optional)














Sidebottom et al                                             [Page 21]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000

The format for DUNA Message parameters is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |           Tag (0x1)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Network Appearance*                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x5)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Spare      |                 Affected DPC 1                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                              ...                              |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Spare      |                 Affected DPC n                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x4)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                          INFO String*                         |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


The optional Network Appearance parameter identifies the SS7 network 
context for the message, for the purposes of logically separating the 
signaling traffic between the SG and the Application Server Process 
over a common SCTP Association.  An example is where an SG is logically 
partitioned to appear as an element in four different national SS7 
networks.  

In an SSNM message, the Network Appearance parameter defines the format 
of the Affected DPC(s) in the Affected Destination parameter.  The DPC 
point code length (e.g., 14-, 16-, or 24-bit) and sub-field definitions 
(e.g., ANSI network/cluster/member, ITU-international 
zone/region/signal_point, many national field variants, ...) are fixed 
within a particular Network Appearance.  Where an SG operates in the 
context of a single SS7 network, or individual SCTP associations are 
dedicated to each SS7 network context, the Network Appearance parameter 
is not required and the format of the Affected DPC(s) is understood 
implicitly.

The format of the Network Appearance parameter is an integer, the 
values of which are assigned according to network operator policy. The 
values used are of local significance only, coordinated between the SG 
and ASP.




Sidebottom et al                                             [Page 22]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


Where the optional Network Appearance parameter is present, it must be 
the first parameter in the message as it defines the format of the 
Affected DPCs in the Affected Destination parameter.

The Affected Destination parameter contains one or optionally more 
Affected Destination Point Codes, each a three-octet parameter to allow 
14-, 16- and 24-bit binary formatted SS7 Point Codes.  Where the 
Affected Point Code is less than 24-bits, it is padded on the left to 
the 24-bit boundary.

It is optional to send an Affected Destination parameter with more than 
one Affected DPC but it is mandatory to receive it.  Also all the 
Affected DPCs included must be part of the same Network Appearance.  
Including multiple Affected DPCs may be useful when, for example, ANSI 
Cluster Route Sets are used at the SG, or a linkset event at the SG is 
simultaneously affecting the status of many destinations.

The optional INFO String parameter can carry any meaningful 8-BIT ASCII 
character string along with the message.  Length of the INFO String 
parameter is from 0 to 255 characters.  No procedures are presently 
identified for its use but the INFO String may be used by Operators to 
identify in text form the location reflected by the Affected DPC for 
debugging purposes.

2.3.2 Destination Available (DAVA)   

The DAVA message is sent from the SG to all concerned ASPs to indicate 
that the SG has determined that one or more SS7 destinations are now 
reachable. The ASP MTP3-User protocol is expected to resume traffic to 
the affected destination through the SG initiating the DUNA. 

The DAVA message contains the following parameters:

     Network Appearance (Optional)
     Affected Destination
     Info String (Optional)

The format and description of DAVA Message parameters is the same as 
for the DUNA message (See Section 2.3.2.1.)  

2.3.3 Destination State Audit (DAUD)

The DAUD message can be sent from the ASP to the SG to audit the 
availability/congestion state of SS7 routes to one or more affected 
destinations.  See Section 3.4.3 for the audit procedures.







Sidebottom et al                                             [Page 23]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


The DAUD message contains the following parameters:

     Network Appearance (Optional)
     Affected Destination
     Info String (Optional)

The format and description of DAUD Message parameters is the same as 
for the DUNA message (See Section 2.3.2.1.) 

Multiple Affected Destination Point Codes parameters may optionally be 
included in a DAUD message.  However all the Affected Destination Point 
Codes must be part of the same Network Appearance.

2.3.4 SS7 Network Congestion (SCON)

The SCON message can be sent from the SG to all concerned ASPs to 
indicate that the congestion level in the SS7 network to one or more 
destinations has changed.

The SCON message contains the following parameters:

     Network Appearance (Optional)
     Affected Destination
     Congestion Level           
     Info String (Optional)

The format for SCON Message parameters is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x1)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |                       Network Appearance*                     | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x5)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Cong. Level 1 |                 Affected DPC 1                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                              ...                              |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Cong. Level n |                 Affected DPC n                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x4)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                         INFO String*                          |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Sidebottom et al                                             [Page 24]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


The format and description of the Network Appearance, Affected 
Destination and Info String parameters is the same as for the DUNA 
message (See Section 2.3.2.1.)

The valid values for the optional Congestion Level parameter are shown 
in the following table.

                Value       Description
                 00     No Congestion or Undefined
                 01     Congestion Level 1
                 02     Congestion Level 2
                 03     Congestion Level 3

The congestion levels are as defined in the national congestion method 
in the ITU MTP recommendation [14] or in the ANSI MTP standard [15]. 
For MTP congestion methods that do not employ congestion levels (e.g., 
the ITU international method, the parameter is always "Undefined".

2.3.5 Destination User Part Unavailable (DUPU)

The DUPU message is used by an SG to inform an ASP that a remote peer 
MTP3-User User Part (e.g., ISUP or SCCP) at an SS7 node is unavailable.

The DUPU message contains the following parameters:

     Network Appearance (Optional)
     Affected Destination
     Unavailability Cause
     MTP3-User Identity
     Info String (Optional)






















Sidebottom et al                                             [Page 25]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000



The format for DUPU Message parameters is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x1)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |                      Network Appearance*                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x5)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Cause | User  |              Affected Destination             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x4)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                          INFO String*                         |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

The format and description of the Network Appearance, Affected 
Destination and Info String parameters is the same as for the DUNA 
message (See Section 2.3.2.1.) One exception is that the Affected 
Desination parameter in the DUPU message can only contain one Affected 
DPC. 

The Unavailability Cause parameter provides the reason for the 
unavailability of the MTP3-User.  The valid values for the 
Unavailability Cause parameter are shown in the following table.  The 
values agree with those provided in the SS7 MTP3 User Part Unavailable 
message.  Depending on the MTP3 protocol used in the network context, 
additional values may be used û the specification of the relevant MTP3 
protocol variant/version is definitive.

         Value       Description
           00         Unknown
           01         Unequipped Remote User
           02         Inaccessible Remote User

The MTP3-User Identity describes the specific MTP3-User that is 
unavailable (e.g., ISUP, SCCP, ...).  The valid values for the MTP3-
User Identity are shown below.  The values agree with those provided in 
the SS7 MTP3 User Part Unavailable message and Service Indicator.  
Depending on the MTP3 protocol used in the network context, additional 







Sidebottom et al                                             [Page 26]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


values may be used û the specification of the relevant MTP3 protocol 
variant/version is definitive.

         Value       Description
        00 - 02       Reserved
           03         SCCP
           04         TUP
           05         ISUP
        06 û 08       Reserved
           09         Broadband ISUP
           10         Satellite ISUP           
 

2.4 Application Server Process Maintenance (ASPM) Messages

2.4.1 ASP Up (ASPUP)

The ASP UP (ASPUP) message is used to indicate to a remote M3UA peer 
that the Adaptation layer is ready to receive traffic or maintenance 
messages.

The ASPUP message contains the following parameters:

     Adaptation Layer Identifer (optional)
     Protocol Identifier (optional)
     INFO String (optional)
     
The format for ASPUP Message parameters is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x2)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    
   |                 Adaptation Layer Identifier*                  |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x4)           |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    
   |                          INFO String*                         |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

The format and description of the optional Info String parameters is 
the same as for the DUNA message (See Section 2.3.2.1.)

The optional Adaptation Layer Identifier (ALI) is a string that 
identifies the adaptation layer.  This string must be set to "M3UA" 
which results in a length of 4.  The ALI would normally only be used in 

Sidebottom et al                                             [Page 27]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


the initial ASP Up message across a new SCTP association to ensure both 
peers are assuming the same adaptation layer protocol.

Note: Strings are padded to 32-bit boundaries.  The length field 
indicates the end of the string.

2.4.2 ASP Down (ASPDN)

The ASP Down (ASPDN) message is used to indicate to a remote M3UA peer 
that the adaptation layer is not ready to receive traffic or 
maintenance messages.

The ASPDN message contains the following parameters:

     Reason
     INFO String (Optional)

The format for the ASPDN message parameters is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              Reason                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x4)           |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
 
   |                         INFO String*                          |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

The format and description of the optional Info String parameter is the 
same as for the DUNA message (See Section 2.3.2.1.)

The Reason parameter indicates the reason that the remote M3UA 
adaptation layer is unavailable.  The valid values for Reason are shown 
in the following table.

     Value         Description
     0x1        Processor Outage
     0x2        Management Inhibit

2.4.3 ASP Active (ASPAC)

The ASPAC message is sent by an ASP to indicate to an SG that it is 
Active and ready to be used.






Sidebottom et al                                             [Page 28]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


The ASPAC message contains the following parameters:

     Type
     Routing Context (Optional)
     INFO String (Optional)

The format for the ASPAC message is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |                             Type                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x6)           |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 
   |                       Routing Context*                        | 

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |         Tag (0x4)             |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                          INFO String*                         |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


The Type parameter identifies the traffic mode of operation of the ASP 
within an AS. The valid values for Type are shown in the following 
table.

    Value          Description
     0x1            Over-ride
     0x2            Load-share
     0x3            New traffic

Within a particular Routing Context, only one Type can be used.  The 
Over-ride value indicates that the ASP is operating in Over-ride mode, 
where the ASP takes over all traffic in an Application Server (i.e., 
primary/back-up operation), over-riding any currently active ASPs in 
the AS.  In loadshare mode, the ASP will share in the traffic 
distribution with any other currently active ASPs.  In New Traffic mode 
the ASP wishes to take on traffic in the AS but does not expect to 
receive messages related to calls/transactions that are pending 
completion in another ASP.

An SG that receives an ASPAC with an incorrect type for a particular 
Routing Context will respond with an Error Message.




Sidebottom et al                                             [Page 29]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


The optional Routing Context parameter contains (a list of) integers 
indexing the Application Server traffic that the sending ASP is 
configured/registered to receive.  There is one-to-one relationship 
between an index entry and an SG Routing Key or AS Name.  Because an AS 
can only appear in one Network Appearance, the Network Appearance 
parameter is not required in the ASPAC message

An Application Server Process may be configured to process traffic for 
more than one logical Application Server.  From the perspective of an 
ASP, a Routing Context defines a range of signaling traffic that the 
ASP is currently configured to receive from the SG.  For example, an 
ASP could be configured to support call processing for multiple ranges 
of PSTN trunks and therefore receive related signaling traffic, 
identified by separate SS7 DPC/OPC/CIC_ranges. 

The format and description of the optional Info String parameter is the 
same as for the DUNA message (See Section 2.3.2.1.)


2.4.4  ASP Inactive (ASPIA)

The ASPIA message is sent by an ASP to indicate to an SG that it is no 
longer an active ASP to be used from within a list of ASPs.  The SG 
will respond with an ASPIA message and either discard incoming messages 
or buffer for a timed period and then discard.

The ASPIA message contains the following parameters:

     Type 
     Routing Context (Optional)
     INFO String (Optional)

The format for the ASPIA message parameters is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |                             Type                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x6)           |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 
   |                       Routing Context*                        | 

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |           Tag (0x4)           |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                          INFO String*                         |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Sidebottom et al                                             [Page 30]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


The Type parameter identifies the traffic mode of operation of the ASP 
within an AS. The valid values for Type are shown in the following 
table.

    Value          Description
     0x1            Over-ride
     0x2            Load-share
     0x3            Graceful Withdrawal

The format and description of the optional Routing Context and Info 
String parameters is the same as for the ASPAC message (See Section 
2.3.3.3.)

2.4.5	Heartbeat (BEAT)

The Heartbeat message is optionally used to ensure that the M3UA peers 
are still available to each other.  It is recommended for use when the 
M3UA runs over a transport layer other than the SCTP, which has its own 
heartbeat.

The BEAT message contains no parameters.


2.5  Management Messages

2.5.1  Error (ERR)

The ERR message is sent when an invalid value is found in an incoming 
message.  

The ERR message contains the following parameters:

     Error Code
     Diagnostic Information (optional)

The format for the ERR message is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Error Code                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Tag (0x7)           |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 
   |                     Diagnostic Information*                   |
 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+




Sidebottom et al                                             [Page 31]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


The Error Code parameter indicates the reason for the Error Message.  
The Error parameter value can be one of the following values:

     Invalid Version                        0x1
     Invalid Network Appearance             0x2
     Invalid Adaptation Layer Identifier    0x3
     Invalid Message Type                   0x4
     Invalid Traffic Handling Mode          0x5

The optional Diagnostic information can be any information germain to 
the error condition, to assist in identification of the error 
condition.  In the case of an Invalid Version Error Code the Diagnostic 
information includes the supported Version parameter.  In the other 
cases, the Diagnostic information may be the first 40 bytes of the 
offending message.

Error messages are not generated in response to other Error messages.

2.5.2 Notify (NTFY)

The Notify message used to provide an autonomous indication of M3UA 
events to an M3UA peer.  

The NTFY message contains the following parameters:

     Status Type 
     Status Identification
     Routing Context (Optional)
     INFO String (Optional)

The format for the NTFY message is as follows:

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |        Status Type            |    Status Identification      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Tag (0x6)             |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 
   |                       Routing Context*                        | 

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |         Tag (0x4)             |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   |                          INFO String*                         |

   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+



Sidebottom et al                                             [Page 32]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


The Status Type parameter identifies the type of the Notify message.  
Following are the valid Status Type values:

      Value          Description
       0x1   Application Server state change (AS_State_Change)
       0x2   Application Server Process state change (ASP_State_Change)
       0x3   Other 

The Status Information parameter contains more detailed information for 
the notification, based on the value of the Status Type.  If the Status 
Type is AS_State_Change the following Status Information values are 
used:

      Value          Description     
       0x1	 Application Server Down (AS_Down)
       0x2	 Application Server Up (AS_Up)
       0x3	 Application Server Active (AS_Active)
       0x4	 Application Server Pending (AS_Pending)

These notifications are sent from an SG to an ASP upon a change in 
status of a particular Application Server.  The value reflects the new 
state of the Application Server.  

If the Status type is ASP_State_Change, the Status Information values 
are:

      Value          Description     
       0x1	 Application Server Process (ASP) Down
       0x2	 Application Server Process (ASP) Up
       0x3	 Application Server Process (ASP) Active
       0x4	 Application Server Process (ASP) Active_Old
       0x5   Application Server Process (ASP) Active_New

These notifications are sent from an SG to an ASP upon a change in 
status of a particular Application Server process within the ASP list 
of a particular Application Server.  The value reflects the new state 
of the Application Server Process.  

If the Status Type is Other, then the following Status Information 
values are defined:

      Value          Description     
       0x1    Insufficient ASP resources active in AS

This notification is not based on the SG reporting the state change of 
an ASP or AS.  For the value defined the SG is indicating to an ASP(s) 
in the AS that another ASP is required in order to handle the load of 
the AS. 

The format and description of the optional Routing Context and Info 
String parameters is the same as for the ASPAC message (See Section 
2.3.3.3.)

Sidebottom et al                                             [Page 33]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


3.0 Procedures

The M3UA layer needs to respond to various local primitives it receives 
from other layers as well as the messages that it receives from the 
peer M3UA layers.  This section describes the M3UA procedures in 
response to these events.


3.1 Procedures to support the services of the M3UA layer

The services of the M3UA layer are described in Section 1.4.1.  These 
procedures support the M3UA transport of MTP3-User/MTP3 boundary 
primitives.

3.1.1 Receipt of Local primitives

On receiving an MTP-Transfer primitive from an upper layer, or the 
nodal inter-working function at an SG, the M3UA layer will send a 
corresponding Data message (see Section 2) to its M3UA peer.  The M3UA 
layer must fill in various fields of the common and specific headers 
correctly.  

At an SG, the M3UA address translation and mapping function determines 
the Application Server (AS) based on the information in the incoming 
message.  From an ordered list of ASPs within the AS table, an Active 
ASP is selected and a Data message is constructed and issued on the 
corresponding SCTP Association.  If more than one ASP is active (i.e., 
traffic is to be load-shared across all the active ASPs), one of the 
active ASPs from the list is selected.  The selection algorithm is 
implementation dependent but could be roud-robin or based on, for 
example, the SLS or ISUP CIC.  The appropriate selection algorithm must 
be chosen carefully as it is dependent on application assumptions and 
understanding of the degree of state coordination between the active 
ASPs in the AS. 

In addition, the message needs to be sent on the appropriate SCTP 
stream, again taking care to meet the message sequencing needs of the 
signaling application. 


3.2 Procedures to support the M3UA services in Section 1.4.2

3.2.1 Local Layer Management primitives procedures

On receiving these primitives from the local layer management, the M3UA 
layer will send the corresponding management message (Error) to its 
peer.  The M3UA layer must fill in the various fields of the common and 
specific headers correctly.



Sidebottom et al                                             [Page 34]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


3.2.2 Receipt of Peer Management messages

Upon receipt of Management messages, the M3UA layer must invoke the 
corresponding Layer Management primitive indications (M-ERROR ind.) to 
the local layer management.


3.3 Procedures to support the M3UA services in Section 1.4.4

These procedures support the M3UA management of SCTP Associations 
between SGs and ASPs

3.3.1 State Maintenance

The M3UA layer on the SG maintains the state of each AS, in each 
Appliction Server that it is configured to receive traffic, as input to 
the SGs address translation and mapping function.

3.3.1.1  ASP States

The state of each ASP, in each AS that it is configured, is maintained 
in the M3UA layer in the SG. The state of a particular ASP in a 
particular AS changes due to events. The events include:

   * Reception of messages from the peer M3UA layer at the ASP
   * Reception of some messages from the peer M3UA layer at other ASPs  
     in the AS
   * Reception of indications from the SCTP layer
   * Switch-over Time triggers

The ASP state transition diagram is shown in Figure 4.  The possible 
states of an ASP are:

ASP-DOWN: The remote M3UA peer at the ASP is unavailable and/or the 
SCTP association is down.  Initially all ASPs will be in this state.

ASP-UP: The remote M3UA peer at the ASP is available (and the SCTP 
association is up) but application traffic is stopped.

ASP-ACTIVE: The remote M3UA peer at the ASP is available and 
application traffic is active (for a particular Routing Context or set 
of Routing Contexts).

ASP-ACT-OLD: The remote M3UA peer at the ASP is available and 
application traffic is active (for a particular Routing Context or set 
of Routing Contexts), but for draining of current call/transactions 
only (i.e., no new calls/transactions)





Sidebottom et al                                             [Page 35]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


ASP-ACT-NEW: The remote M3UA peer at the ASP is available and 
application traffic is active (for a particular Routing Context or set 
of Routing Contexts), but for new calls/transactions only (i.e., not 
for traffic related to completing calls/transactions in another ASP).               
                
                 Figure 4: ASP State Transition Diagram

                                  +-------------+
           |----------------------|             |      
           |       Some other    /|  ASP-ACTIVE |<--------\
           |       ASP        /   +-------------+         |
           |       Takeover  /        ^     |             | Ts
           |               /   ASP    |     | ASP         |
           |              /    Active |     | Inactive    | 
           |             v            |     v             |
           | +-------------+      +-------------+       +-------------+
           | |             |      |             |       |             |
           | | ASP-ACT-OLD |----->|  ASP-UP     |------>| ASP-ACT-NEW |
           | +-------------+ Ts / +-------------+ ASP   +-------------+
           |    |    ASP Inactive  ^    |        Takeover   |
           |<---|                  |    |                   |
           |                       |    |                   |
 ASP Down/ |                  ASP  |    | ASP Down /        | ASP
 SCTP CDI  |                  Up   |    | SCTP CDI          | Down/
           |                       |    v                   | SCTP
           |                   +-------------+              | CDI
           |                   |             |              |
           |------------------>|             |<-------------|
                               |  ASP-DOWN   |
                               +-------------+


SCTP CDI: The local SCTP layer's Communication Down Indication to the  
Upper Layer Protocol (M3UA) on an SG. The local SCTP will send this 
indication when it detects the loss of connectivity to the ASP's peer 
SCTP layer.

Ts: Switch-over Time Triggers.  This timer is configurable by the 
Operator on a per AS basis.

3.3.1.2  AS States

The state of the AS is maintained in the M3UA layer on the SG.

The state of an AS changes due to events. These events include:

   * ASP state transitions
   * Recovery timer triggers




Sidebottom et al                                             [Page 36]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


The possible states of an AS are:

AS-DOWN: The Application Server is unavailable.  This state implies 
that all related ASPs are in the ASP-DOWN state for this AS. Initially 
the AS will be in this state.

AS-UP: The Application Server is available but no application traffic 
is active (i.e., one or more related ASPs are in the ASP-UP state, but 
none in the ASP-Active state). 

AS-ACTIVE: The Application Server is available and application traffic 
is active.  This state implies that one ASP is in the ASP-ACTIVE state.

AS-PENDING: An active ASP has transitioned from active to inactive or 
down and it was the last remaining active ASP in the AS. A recovery 
timer T(r) will be started and all incoming SCN messages will be queued 
by the SG. If an ASP becomes active before T(r) expires, the AS will 
move to AS-ACTIVE state and all the queued messages will be sent to the 
active ASP. 

If T(r) expires before an ASP becomes active, the SG stops queuing 
messages and  discards all previously queued messages. The AS will move 
to AS-UP if at least one ASP is in ASP-UP state, otherwise it will move 
to AS-DOWN state.




























Sidebottom et al                                             [Page 37]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


                 Figure 5: AS State Transition Diagram

      +----------+  one ASP trans ACTIVE   +-------------+
      |          |------------------------>|             |      
      |  AS-UP   |                         |  AS-ACTIVE  |
      |          |                         |             |
      |          |<                       -|             |
      +----------+ \                     / +-------------+
         ^   |      \ Tr Trigger        /       ^    |
         |   |       \ at least one    /        |    |
         |   |        \ ASP in UP     /         |    |
         |   |         \             /          |    |
         |   |          \           /           |    |
         |   |           \     /---/            |    |
 one ASP |   |            \   /        one ASP  |    | Last ACTIVE ASP
 trans   |   | all ASP     \-/----\    trans to |    | trans to UP or
 to UP   |   | trans to     /      \   ACTIVE   |    | DOWN
         |   | DOWN        /        \           |    | 
         |   |            /          \          |    |
         |   |           /            \         |    |
         |   |          /all ASP       \        |    |
         |   v         / trans to       \       |    v         
      +----------+    /  DOWN            \ +-------------+
      |          |<--/                    -|             |      
      | AS-DOWN  |                         | AS-PENDING  |
      |          |                         |  (queueing) |
      |          |<------------------------|             |
      +----------+    Tr Trigger no ASP    +-------------+
                       in UP state

    Tr = Recovery Timer


3.3.2 ASPM procedures for primitives

Before the establishment of an SCTP association the ASP state at both 
the SG and ASP is assumed to be "Down".  

As the ASP is responsible for initiating the setup of an SCTP 
association to an SG, the M3UA layer at an ASP receives an M-SCTP 
ESTABLISH request primitive from the Layer Management, the M3UA layer 
will try to establish an SCTP association with the remote M3UA peer at 
an SG.  Upon reception of an eventual SCTP-Communication Up confirm 
primitive from the SCTP, the M3UA layer will invoke the primitive M-
SCTP ESTABLISH confirm to the Layer Management.

At the SG, the M3UA layer will receive an SCTP Communication Up 
indication primitive from the SCTP. The M3UA layer will then invoke the 
primitive M-SCTP ESTABLISH indication to the Layer Management. 



Sidebottom et al                                             [Page 38]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


Once the SCTP association is established, The M3UA layer at an ASP will 
then find out the state of its local M3UA-user from the Layer 
Management using the primitive M-ASP STATUS.  Based on the status of 
the local M3UA-User, the local ASP M3UA Application Server Process 
Maintenance (ASPM) function will initiate the ASPM procedures, using 
the ASP-Up/-Down/-Active/-Inactive messages to convey the ASP-state to 
the SG - see Section 3.3.3. 

If the M3UA layer subsequently receives an SCTP-Communication Down 
indication from the underlying SCTP layer, it will inform the Layer 
Management by invoking the M-SCTP STATUS indication primitive. The 
state of the ASP will be moved to "Down" at both the SG and ASP.

At an ASP, the Layer Management may try to reestablish the SCTP 
association using M-SCTP ESTABLISH request primitive. 

3.3.3 ASPM procedures for peer-to-peer messages

All ASPM messages are sent on a sequenced stream to ensure ordering.  
SCTP stream '0' is used.

3.3.3.1 ASP-Up

After an ASP has successfully established an SCTP association to an SG, 
the SG waits for the ASP to send an ASP-Up message, indicating that the 
ASP M3UA peer is available.  The ASP is always the initiator of the 
ASP-Up exchange.  

When an ASP-Up message is received at an SG and internally the ASP is 
not locked-out for local management reasons, the SG marks the remote 
ASP as 'Up'.  The SG responds with an Notify (ASP-Up) message to the 
ASP in acknowledgement.  The SG sends a Notify (ASP-Up) message in 
response to a received ASP-Up message from the ASP even if the ASP is 
already marked as "Up" at the SG.  

If for any local reason the SG cannot respond with an ASP-Up, the SG 
responds to a ASP-Up with a ASP-Down message.  

At the ASP, the Notify (ASP-Up) message received from the SG is not 
acknowledged by the ASP.  If the ASP does not receive a response from 
the SG, or an ASP-Down is received, the ASP may resend ASP-Up messages 
every 2 seconds until it receives a Notify (ASP-Up) message from the 
SG.  The ASP may decide to reduce the frequency (say to every 5 
seconds) if a Notify (ASP-Up) is not received after a few tries.

The ASP must wait for the Notify (ASP-Up) message from the SG before 
sending any ASP traffic control messages (ASPAC or ASPIA) or Data 
messages or it will risk message loss.  If the SG receives Data 
messages before an ASP Up is received, the SG should discard.



Sidebottom et al                                             [Page 39]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


3.3.3.2 ASP-Down

The ASP will send an ASP-Down to an SG when the ASP is to be removed 
from the list of ASPs in all Application Servers that it is a member.

The SG marks the ASP as "Down" and returns an Notify (ASP-Down) message 
to the ASP if one of the following events occur:

    - an ASP-Down message is received from the ASP,
    - another ASPM message is received from the ASP and the SG has  
      locked out the ASP for management reasons.

The SG sends a Notify (ASP-Down) message in response to a received ASP-
Down message from the ASP even if the ASP is already marked as "Down" 
at the SG.  

If the ASP does not receive a response from the SG, the ASP may send 
ASP-Down messages every 2 seconds until it receives a ASP-Down message 
from the SG or the SCTP association goes down.  The ASP may decide to 
reduce the frequency (say to every 5 seconds) if an ASP-Down is not 
received after a few tries.

3.3.3.3 M3UA Version Control

If a ASP-Up message with an unsupported version is received, the 
receiving end responds with an Error message, indicating the version 
the receiving node supports.

This is useful when protocol version upgrades are being performed in a 
network.  A node upgraded to a newer version should support the older 
versions used on other nodes it is communicating with.  Because ASPs 
initiate the ASP-Up procedure it is assumed that the Error message 
would normally come from the SG.

3.3.3.4 ASP-Active

Anytime after the ASP has received a Notify (ASP-Up) acknowledgement 
from the SG, the ASP sends an ASP-Active (ASPAC) to the SG indicating 
that the ASP is ready to start processing traffic.  In the case where 
an ASP is configured/registered to process the traffic for more than 
one Application Server across an SCTP association, the ASPAC contains 
one or more Routing Contexts to indicate for which Application Servers 
the ASPAC applies. 

When an ASP Active (ASPAC) message is received, the SG responds to the 
ASP with a Notify message acknowledging that the ASPAC was received and 
starts sending traffic for the associated Application Server(s) to that 
ASP.




Sidebottom et al                                             [Page 40]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


There are three modes of Application Server traffic handling in the SG 
M3UA - Over-ride, Load-balancing and New Traffic.  The Type parameter 
in the ASPAC messge indicates the traffic handling mode used in a 
particular Application Server. If the SG determines that the mode 
indicated in an ASPAC is incompatible with the mode currently used in 
the AS, the SG responds with an Error message indicating "Invalid 
Traffic Handling Mode".

In the case of an Over-ride mode AS, reception of an ASPAC message at 
an SG causes the redirection of all traffic for the AS to the ASP which 
sent the ASPAC.  Any previously active ASP in the AS is now considered 
Inactive and will no longer receive traffic within the AS.  The SG 
responds to the ASPAC with a Notify (ASP-Active) message to the ASP.  
The SG sends a Notify (ASP-Up) to the previously active ASP in the AS, 
after stopping all traffic to the ASP.

In the case of a Loadshare mode AS, reception of an ASPAC message at an 
SG causes the direction of traffic to the ASP sending the ASPAC, in 
addition to all the other ASPs that are currently active in the AS.  
The algorithm at the SG for loadsharing traffic within an AS to all the 
active ASPs is application and network dependent.  The algorithm could, 
for example be round-robin or based on information in the Data message 
(e.g, such as the SLS, SCCP SSN, ISUP CIC value), depending on the 
requirements of the application and the call/transaction state handling 
assumptions of the collection of ASPs in the AS. The SG responds to the 
ASPAC with a Notify (ASP-Active) message to the ASP.

In the case of a New Traffic mode AS, reception of an ASPAC message at 
an SG causes the direction of traffic to the ASP sending the ASPAC.  
However, traffic related to completing calls/transactions in another 
ASP is not sent to the new ASP (i.e., new calls/transactions only). How 
an SG accomplishes the differentiation of old and new transactions and 
any loadsharing of traffic is application and implementation dependent.  
The SG responds to the ASPAC with a Notify (ASP-Active_New) message to 
the ASP. After a configurable time Ts, the ASP is moved to the ASP-
Active state and a Notify (ASP-Active) is sent to the ASP.

3.3.3.5 ASP Inactive

When an ASP wishes to withdraw from receiving traffic the ASP sends an 
ASP Inactive (ASPIA) to the SG.  In the case where an ASP is 
configured/registered to process the traffic for more than one 
Application Server across an SCTP association, the ASPIA contains one 
or more Routing Contexts to indicate for which Application Servers the 
ASPIA applies.

There are three modes of Application Server traffic handling in the SG 
M3UA when withdrawing an ASP from service - Over-ride, Load-balancing 
and Graceful Withdrawal.  The Type parameter in the ASPIA messge 
indicates the mode used in a particular Application Server. If the SG 



Sidebottom et al                                             [Page 41]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


determines that the mode indicates in an ASPAC is incompatible with the 
traffic handling mode currently used in the AS, the SG responds with an 
Error message indicating "Invalid Traffic Handling Mode".

In the case of an Over-ride mode AS, where normally another ASP has 
already taken over the traffic within the AS with an Over-ride ASPAC, 
the ASP which sent the ASPIA is already considered by the SG to be 
"Inactive".  A Notify (ASP_Up) message is resent to the ASP, after 
ensuring that all traffic is stopped to the ASP.  

In the case of a Loadshare mode AS, the SG moves the ASP to the 
"Inactive" state and the AS traffic is re-allocated across the 
remaining "active" ASPs per the laoadsharing algorithm currently used 
within the AS.  A Notify (ASP-Up) message is sent to the ASP after al 
traffic is halted to the ASP.

In the case of Graceful Withdrawal, the SG diverts all traffic related 
to new calls/transactions to other "active" ASPs and therafter sends 
only traffic related to incomplete transactons to the ASP. A Notify 
(ASP-Act_Old) is sent to the ASP and the ASP is moved to the 
"Active_Old" state.  When the outstanding calls/transactions are 
drained, or after a configurable time Ts, the SG moves the ASP to the 
"Up" state and sends a Notify (ASP-Up) message to the ASP.

If no other ASPs are "Active" in the Application Server, the SG either 
discards all incoming messages (except messages related to an 
"Active_Old" ASP) for the AS or starts buffering the incoming messages 
for T(r)seconds after which messages will be discarded.  T(r) is 
configurable by the network operator.  If the SG receives an ASPAC from 
an ASP in the AS before expiry of T(r), the buffered traffic is 
directed to the ASP and the timer is cancelled.

3.3.3.6 Notify

In the case where a Notify (AS-Up) message is sent by an SG that now 
has no ASPs active to service the traffic, the Notify does not force 
the ASP(s) receiving the message to become active. The ASPs remain in 
control of what (and when) action is taken.

3.3.3.7 Heartbeat

The optional Heartbeat procedures may be used when operating over 
transport layers that do not have their own heartbeat mechanism for 
detecting loss of the transport association (i.e., other than the 
SCTP).  

Once the ASP sends an ASP-Up message to the SG, the ASP sends Beat 
messages periodically, subject to a provisionable timer T(beat).  The 
SG M3UA, upon receiving a BEAT message from the ASP, responds with a 


Sidebottom et al                                             [Page 42]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


BEAT message.  If no BEAT message (or any other M3UA message), is 
received from the ASP within the timer 2*T(beat), the ASP will consider 
the remote M3UA as 'Down".

At the ASP, if no BEAT message (or any other M3UA message) is received 
from the SG within 2*T(beat), the SG is considered unavailable.  
Transmission of BEAT messages is stopped and ASP-Up procedures are used 
to re-establish communication with the SG M3UA peer.

Note: Heartbeat related events are not shown in Figure 4 "ASP state 
transition diagram".  


3.4 Procedures to support the M3UA services in Section 1.4.3

3.4.1 At an SG

On receiving an MTP-PAUSE, MTP-RESUME, or MTP-STATUS indication 
primitive from the nodal inter-working function at an SG, the SG M3UA 
layer will send a corresponding SSNM DUNA, DAVA, SCON, or DUPU message 
(see Section 2) to the M3UA peers at concerned ASPs.  The M3UA layer 
must fill in various fields of the SSNM messages consistently with the 
information received in the primitives.  

The SG M3UA determines the set of concerned ASPs to be informed based 
on the SS7 network partition for which the primitive indication is 
relevant. In this way, all ASPs configured to send/receive traffic 
within a particular network appearance are informed.  If the SG 
operates within a single SS7 network appearance, then all ASPs are 
informed.  

Optionally, the SG M3UA may filter further based on the Affected Point 
Code in the MTP-PAUSE, MTP-Resume, or MTP-Status indication primitives.  
In this way ASPs can be informed only of affected destinations to which 
they actually communicate.  The SG M3UA may also suppress DUPU messages 
to ASPs that do not implement an MTP3-User protocol peer for the 
affected MTP3-User.

DUNA, DAVA, SCON messages must be sent on a sequenced stream as these 
primitives should arrive in order.  Stream 0 is used.  Sequencing is 
not required for the DUPU or DAUD message, which may optionally be sent 
un-sequenced.

3.4.2 At an ASP

At an ASP, upon receiving an SSNM message from the remote M3UA Peer, 
the M3UA layer invokes the appropriate primitive indications to the 
resident M3UA-Users.  Local management is informed. 




Sidebottom et al                                             [Page 43]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


3.4.3 ASP Auditing

An ASP may optionally initiate an audit procedure in order to enquire 
of an SG the availability or congestion status of an SS7 destination or 
set of destinations.  A Destination Audit (DAUD) message is sent from 
the ASP to the SG requesting the current availability or congestion 
status of one or more SS7 Destination Point Codes.

The DAUD may be sent by the ASP in the following cases.  The DAUD may 
be sent unsequenced.

   - Periodic.  A Timer originally set upon reception of DUVA or SCON  
     message has expired without a subsequent DAVA, DUVA or SCON  
     updating the availability/congestion status of the affected  
     Destination Point Codes.  The Timer is reset upon issuing a DAUD.   
     In this case the DAUD is sent to the SG that originally sent the  
     SSNM message.
 
   - the ASP is newly "Up" or "Active" or has been isolated from an SG  
     for an extended period.  The SG can request the  
     availabilty/congestion status of one or more SS7 destinations to  
     which it expects to communicate.

In the first case, the DAUD procedure must not be invoked for the case 
of a received SCON containing a congestion level value of "no 
congestion" or "undefined" (i.e., congestion Level = "0").  This is 
because the value indicates either congestion abatement or that the ITU 
MTP3 international congestion method is being used.  In the 
international congestion method, the MTP3 at the SG does not maintain 
the congestion status of any destinations and therefore cannot provide 
any congestion information in response to the DAUD.  For the same 
reason, in the second case a DAUD cannot reveal any congested 
destination(s).

The SG must respond to a DAUD with the MTP3 status of the routeset 
associated with each Destination Point Code(s) in the DAUD.  The status 
of each SS7 destination requested is indicated in a DUNA (if 
unavailable), DAVA (if available/uncongested) or an SCON (if 
available/congested).  Optionally, any DUNA or DAVA in response to a 
DAUD may contain more than one Affected Point Code.

Note that from the point of view of an ASP sending an DAUD, the 
subsequent reception of an SCON implies that the Affected Destination 
is available.  The reception of a DAVA implies that the routeset to the 
Affected Destination are not congested.  Obviously with the reception 
of an DUNA, the routeset to the Affected Destination can not also be 
congested.





Sidebottom et al                                             [Page 44]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000



4.0 Examples of M3UA Procedures

4.1 Establishment of Association and Traffic between SGs and ASPs

4.1.1 Single ASP in an Application Server ("1+0" sparing)

This scenario shows the example M3UA message flows for the 
establishment of traffic between an SG and an ASP, where only one ASP 
is configured within an AS (no backup).  It is assumed that the SCTP 
association is already set-up.

             SG                       ASP1
              |
              |<---------ASP Up----------| 
              |------NTFY (ASP-Up)------>|
              |                      -   | 
              |<-------ASP Active--------| 
              |----NTFY (ASP_Active)---->|
              |                          |

4.1.2 Two ASPs in Application Server ("1+1" sparing)

This scenario shows the example M3UA message flows for the 
establishment of traffic between an SG and two ASPs in the same 
Application Server, where ASP1 is configured to be "active" and ASP2 a 
"standby" in the event of communication failure or the withdrawal from 
service of ASP1.  ASP2 may act as a hot, warm, or cold standby 
depending on the extent to which ASP1 and ASP2 share call/transaction 
state or can communicate call state under failure/withdrawal events.  
The example message flow is the same whether the ASP-Active messages 
are Over-ride or Load-share mode although typically this example would 
use an Over-ride mode.

       SG                        ASP1                        ASP2
        |                         |                          |
        |<--------ASP Up----------|                          | 
        |-------TFY (ASP-Up)----->|                          |
        |                         |                          |
        |<-----------------------------ASP Up----------------|
        |----------------------------NTFY (ASP-Up)---------->|
        |                         |                          | 
        |                         |                          |
        |<-------ASP Active-------|                          | 
        |----NTFY(ASP-Active)---->|                          | 
        |                         |                          |






Sidebottom et al                                             [Page 45]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


4.1.3 Two ASPs in an Application Server ("1+1" sparing, load-sharing 
case)

This scenario shows a similar case to Section 4.1.2 but where the two 
ASPs are brought to "active" and loadshare the traffic load.  In this 
case, one ASP is sufficient to handle the total traffic load.

       SG                       ASP1                       ASP2
        |                         |                          |
        |<---------ASP Up---------|                          | 
        |-------NTFY(ASP-Up)----->|                          |
        |                         |                          |
        |<------------------------------ASP Up---------------|
        |-----------------------------NTFY(ASP Up)---------->|
        |                         |                          | 
        |                         |                          |
        |<--ASP Active (Ldshr)----|                          | 
        |----NTFY(ASP-Active)---->|                          | 
        |                         |                          |
        |<----------------------------ASP Active (Ldshr)-----| 
        |-----------------------------NTFY(ASP-Active)------>| 
        |                         |                          |


4.1.4 Three ASPs in an Application Server ("n+k" sparing, load-sharing 
case) 

This scenario shows the example M3UA message flows for the 
establishment of traffic between an SG and three ASPs in the same 
Application Server, where two of the ASPs are brought to "active" and 
share the load. In this case, a minimum of two ASPs are required to 
handle the total traffic load (2+1 sparing).

   SG                  ASP1                 ASP2                 ASP3 
    |                    |                   |                   |
    |<------ASP Up-------|                   |                   | 
    |----NTFY(ASP-Up)--->|                   |                   |
    |                    |                   |                   |
    |<--------------------------ASP Up-------|                   |
    |------------------------NTFY(ASP-Up)--->|                   |
    |                    |                   |                   |
    |<---------------------------------------------ASP Up--------|
    |--------------------------------------------NTFY(ASP-Up)--->|
    |                    |                   |                   | 
    |                    |                   |                   |
    |<-ASP Act. (Ldshr)--|                   |                   | 
    |---NTFY(ASP-Act.)-->|                   |                   | 
    |                    |                   |                   |
    |<--------------------ASP Act. (Ldshr)---|                   | 
    |----------------------NTFY(ASP-Act.)--->|                   | 
    |                    |                   |                   |

Sidebottom et al                                             [Page 46]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


4.2 ASP Traffic Fail-over Examples

4.2.1 (1+1 Sparing, withdrawal of ASP, Back-up Over-ride) 

Following on from the example in Section 4.1.2, and ASP withdraws from 
service:

       SG                       ASP1                       ASP2 
        |                         |                          |
        |<-----ASP Inactive-------|                          |
        |---NTFY(ASP Inactive)--->|                          |
        |--------------------NTFY(ASP-Inactive) (Optional)-->| 
        |                         |                          | 
        |<------------------------------ ASP Active----------| 
        |-----------------------------NTFY(ASP-Active)------>| 
        |                                                    |

Note: If the SG detects loss of the M3UA peer (M3UA heartbeat loss or 
detection of SCTP failure), the initial SG-ASP1 ASP Inactive message 
exchange would not occur.

4.2.2 (1+1 Sparing, Back-up Over-ride)

Following on from the example in Section 4.1.2, and ASP2 wishes to 
over-ride ASP1 and take over the traffic:

       SG                       ASP1                       ASP2 
        |                         |                          | 
        |<------------------------------ ASP Active----------| 
        |-----------------------------NTFY(ASP-Active)------>|
        |----NTFY(ASP-Inactive)-->| 
        |                         |                          | 


4.2.3 (n+k Sparing, Load-sharing case, withdrawal of ASP)

Following on from the example in Section 4.1.4, and ASP1 withdraws from 
service:

   SG                  ASP1                 ASP2                 ASP3 
    |                    |                   |                   |
    |<----ASP Inact.-----|                   |                   | 
    |--NTFY(ASP-Inact.)->|                   |                   |
    |                    |                   |                   | 
    |---------------------------------NTFY(Ins. ASPs)(Optional)->| 
    |                    |                   |                   |
    |<-----------------------------------------ASP Act. (Ldshr)--| 
    |-------------------------------------------ASP Act. (Ack)-->|
    |                    |                   |                   |



Sidebottom et al                                             [Page 47]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


The Notify message to ASP3 is optional, as well as the ASP-Active from 
ASP3.  The optional Notify can only occur if the SG maintains knowledge 
of the minimum ASP resources required û for example if the SG knows 
that "n+k" = "2+1" for a loadshare AS and "n" currently equals "1". 

Note: If the SG detects loss of the ASP1 M3UA peer (M3UA heartbeat loss 
or detection of SCTP failure), the first SG-ASP1 ASP Inactive message 
exchange would not occur.  


4.3  M3UA/MTP3-User Boundary Examples

4.3.1 At an ASP

This section describes the primitive mapping from the MTP3 User to M3UA 
at an ASP.  

4.3.1.1	Support for MTP-Transfer on the ASP

4.3.1.1.1 Support for MTP-Transfer Request
When the MTP3-User on the ASP has data to send into the SS7 network, it 
will use the MTP-Transfer Request primitive.  The M3UA on the ASP will 
do the following when it receives an MTP-Transfer Request primitive 
from the M3UA user:

  - Determine the correct SG

  - Determine the correct association to the chosen SG

  - Determine the correct stream in the association (e.g., based on  
    SLS)

  - Determine whether to complete the optional fields of the Data  
    message

  - Map the MTP-Transfer Request primitive into the Protocol Data  
    field of an m3ua Data message

  - Send the Data message to the remote M3UA peer in the SG, over the  
    SCTP association

        SG                       ASP   
        |                         |                  
        |<-----Data Message-------|<--MTP-Transfer req. 
        |                         | 

        




             
Sidebottom et al                                             [Page 48]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


4.3.1.1.2 Support for MTP Transfer Indication

When the M3UA on the ASP has received Data messages from the remote 
M3UA peer in the SG it will do the following:

  - Evaluate the optional fields of the Data message if present

  - Map the Payload of a Data message into the MTP-Transfer Indication  
    primitive

  - Pass the MTP-Transfer Indication primitive to the user part. In  
    case of multiple user parts, the optional fields of the Data
    message are used to determine the concerned user part.

        SG                       ASP   
        |                         |
        |------Data Message------>|---MTP-Transfer ind.?
        |                         |          


4.3.1.1.3 Support for ASP Querying of SS7 Destination States

There are situations such as temporary loss of connectivity to the SG 
that may cause the M3UA on the ASP to audit SS7 destination 
availability states.  Note: there is no primitive for the MTP3-User to 
request this audit from the M3UA as this is initiated by an internal 
M3UA management function.  

The M3UA on the ASP normally sends Destination State Audit (DAUD) 
messages for each of the destinations that the ASP supports.

       SG                        ASP   
        |                         |                  
        |<-----DAUD Message ------| 
        |<-----DAUD Message ------| 
        |<-----DAUD Message ------| 
        |                         |                     
        |                         |             

4.3.2 At an SG 

This section describes the MTP3 upper layer primitive mapping to the 
M3UA at the SG.

4.3.2.1 Support for MTP-Transfer Request at the SG

When the M3UA on the SG has received Data messages from its peer 
destined to the SS7 network it will do the following:




Sidebottom et al                                             [Page 49]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


  - Evaluate the optional fields of the Data message if present to  
    determine the network appearance

  - Map the Protocol data of the Data message into an MTP-Transfer  
    Request primitive

  - Pass the MTP-Transfer Request primitive to the MTP3 of the  
    concerned network appearance.

                            SG                        ASP
                             |                         |
        <---MTP-Transfer req.|<------Data Message------|
                             |                         |


4.3.2.2 Support for MTP-Transfer Indication at the SG

When the MTP3 on the SG has data to pass its user parts, it will use 
the MTP-Transfer Indication primitive.  The M3UA on the S>G will do the 
following when it receives an MTP-Transfer Indication:

  - Determine the correct ASP

  - Determine the correct association to the chosen ASP

  - Determine the correct stream in the association (e.g., based on  
    SLS)

  - Determine whether to complete the optional fields of the Data  
    message

  - Map the MTP-Transfer Indication primitive into the Protocol Data  
    field of an M3UA Data message

  - Send the Data message to the remote M3UA peer in the ASP, over the  
    SCTP association 

                           SG                        ASP
                            |                         |
       --MTP-Transfer ind.->|------Data Message------>|
                            |                         |


4.3.2.3 Support for MTP-PAUSE, MTP-RESUME, MTP-STATUS

The MTP-PAUSE, MTP-RESUME and MTP-STATUS indication primitives from the 
MTP3 upper layer interface at the SG need to be made available to the 
remote MTP3 User Part lower layer interface at the concerned ASP(s).




Sidebottom et al                                             [Page 50]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


4.3.2.3.1 Destination Unavailable 

The MTP3 on the SG will generate an MTP-PAUSE primitive when it 
determines locally that an SS7 destination is unreachable.  The M3UA 
will map this primitive to a Destination Unavailable (DUNA) message.  
It will determine which ASP(s) to send the DUNA based on the Network 
Appearance information.

                   SG                       ASP   
                    |                         |
 --MTP-PAUSE ind.-->|------DUNA Message ----->|--MTP-PAUSE ind.-->
                    |                         |


4.3.2.3.2 Destination Available

The MTP3 on the SG will generate an MTP-RESUME primitive when it 
determines locally that an SS7 destination that was previously 
unreachable is now reachable.  The M3UA will map this primitive to a 
Destination Unavailable (DAVA) message.  It will determine which ASP(s) 
to send the DUNA based on the Network Appearance information.

                   SG                       ASP   
                    |                         |
--MTP-RESUME ind.-->|------DAVA Message ----->|--MTP-RESUME ind.-->
                    |                         |


4.3.2.3.3  SS7 Network Congestion 

The MTP3 on the SG will generate an MTP-STATUS primitive when it 
determines locally that the route to an SS7 destination is congested.  
The M3UA will map this primitive to a SS7 Network Congestion State 
(SCON) message.  It will determine which ASP(s) to send the DUPU to 
based on the intended Application Server.
 
                     SG                       ASP   
                       |                         |                  
   --MTP-STATUS ind.-->|------SCON Message ----->|--MTP-STATUS ind.--> 
                       |                         |











 
Sidebottom et al                                             [Page 51]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


4.3.2.3.4 Destination User Part Unavailable

The MTP3 on the SG will generate an MTP-STATUS primitive when it 
determines locally that an SS7 destination User Part is unavailable.  
The M3UA will map this primitive to a Destination User Part Unavailable 
(DUPU) message.  It will determine which ASP(s) to send the DUPU to 
based on the intended Application Server.

                      SG                       ASP   
                       |                         |                  
   --MTP-STATUS ind.-->|------DUPU Message ----->|--MTP-STATUS ind.--> 
                       |                         | 


5.0 Security

5.1 Introduction

M3UA is designed to carry signaling messages for telephony services. As such, 
M3UA must involve the security needs of several parties: the end users
of the services; the network providers and the applications involved.
Additional requirements may come from local regulation.  While having some
overlapping security needs, any security solution should fulfill all of the
different parties' needs. 

5.2 Threats

There is no quick fix, one-size-fits-all solution for security.  As a
transport protocol, M3UA has the following security objectives:

 * Availability of reliable and timely user data transport.
 * Integrity of user data transport.
 * Confidentiality of user data.

M3UA runs on top of SCTP.  SCTP [6] provides certain transport related
security features, such as:

 * Blind Denial of Service Attacks
 * Flooding
 * Masquerade
 * Improper Monopolization of Services

When M3UA is running in professionally managed corporate or service provider
network, it is reasonable to expect that this network includes an
appropriate security policy framework. The "Site Security Handbook" [21]
should be consulted for guidance.






Sidebottom et al                                             [Page 52]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


When the network in which M3UA runs in involves more than one party, it may
not be reasonable to expect that all parties have implemented security in a
sufficient manner.  In such a case, it is recommended that IPSEC is used to
ensure confidentiality of user payload.  Consult [22] for more information on
configuring IPSEC services.

5.3 Protecting Confidentiality 

Particularly for mobile users, the requirement for confidentiality may
include the masking of IP addresses and ports.  In this case application
level encryption is not sufficient; IPSEC ESP should be used instead.
Regardless of which level performs the encryption, the IPSEC ISAKMP service
should be used for key management.


6.0 IANA Considerations

A request will be made to IANA to assign an M3UA value for the Payload Protocol 
Identifier in SCTP Payload Data chunk.  The following SCTP Payload Protocol 
Identifier will be registered:

        M3UA    tbd

The SCTP Payload Protocol Identifier is included in each SCTP Data chunk, to 
indicate which protocol the SCTP is carrying. This Payload Protocol Identifier 
is not directly used by SCTP but may be used by certain network entities to 
identify the type of information being carried in a Data chunk.

The User Adaptation peer may use the Payload Protocol Identifier as a way of 
determining additional information about the data being presented to it by SCTP.


7.0 Acknowledgements

The authors would like to thank John Loughney, Neil Olson, Norm Glaude, 
Michael Tuexen, Nikhil Jain, Steve Lorusso, Dan Brendes, Heinz Prantner 
for their valuable comments and suggestions.

8.0  References

[1] RFC 2719, "Framework Architecture for Signaling Transport"

[2] ITU-T Recommendations Q.761 to Q.767, 'Signalling System No.7 (SS7)  
    û ISDN User Part (ISUP)'

[3] ANSI T1.113 - 'Signaling System Number 7 û ISDN User Part

[4] ETSI ETS 300 356-1 "Integrated Services Digital Network (ISDN);  
    Signalling System No.7; ISDN User Part (ISUP) version 2 for the  
    international interface; Part 1: Basic services"


Sidebottom et al                                             [Page 53]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


[5] ITU-T Recommendations Q.711-715, 'Signalling System No. 7 (SS7) -  
    Signalling Connection Control Part (SCCP)'

[6] ANSI T1.112 'Signaling System Number 7 û Signaling Connection 
    Control Part'

[7] ETSI ETS 300 009-1, "Integrated Services Digital Network (ISDN);  
    Signalling System No.7; Signalling Connection Control Part (SCCP)  
    (connectionless and connection-oriented class 2) to support  
    international interconnection; Part 1: Protocol specification"

[8] ITU-T Recommendations Q.720, 'Telephone User Part'

[9] ITU-T Recommendation Q.771-775 'Signalling System No. 7 SS7) -  
    Transaction Capabilities (TCAP)

[10] ANSI T1.114 'Signaling System Number 7 û Transaction Capabilities 
     Application Part'

[11] ETSI ETS 300 287-1, "Integrated Services Digital Network (ISDN);  
     Signalling System No.7; Transaction Capabilities (TC) version 2; 
     Part 1: Protocol specification"

[12] 3G TS 25.410 V3.1.0 (2000-01) Technical Specification û 3rd  
     Generation partnership Project; Technical Specification Group  
     Radio Access Network; UTRAN Iu Interface: General Aspects and  
     Principles (3G TS 25.410 Version 3.1.0 Release 1999) 

[13] Simple Control Transport Protocol <draft-ietf-sigtran-sctp- 
     05.txt>, Dec. 1999, Work in Progress
 
[14] ITU-T Recommendations Q.701-Q.705, 'Signalling System No. 7 (SS7)  
     - Message Transfer Part (MTP)'

[15] ANSI T1.111 'Signalling System Number 7 - Message Transfer Part'

[16] ETSI ETS 300 008-1, "Integrated Services Digital Network (ISDN);  
     Signalling System No.7; Message Transfer Part (MTP) to support  
     international interconnection; Part 1: Protocol specification"

[17] ITU-T Recommendation Q.2140 'B-ISDN ATM Adaptation Layer - Service 
     Specific Coordination Function for signaling at the Network Node  
     Interface (SSCF at NNI)

[18] ITU-T Recommendation Q.2110 'B-ISDN ATM Adaptation Layer - Service  
     Specific Connection Oriented Protocol (SSCOP)

[19] MTP2-User Adaptation Layer <draft-ietf-sigtran-m2ua-01.txt>, Nov.  
     1999, Work in Progress



Sidebottom et al                                             [Page 54]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


[20] ITU-T Recommendation Q.2210 'B-ISDN MTP'

[21] RFC 2196, "Site Security Handbook", B. Fraser Ed., September 1997

[22]	RFC 2401, "Security Architecture for the Internet Protocol", S.
Kent, R. Atkinson, November 1998.




9.0  Author's Addresses

Lyndon Ong
Nortel Networks
4401 Great America Pkwy
Santa Clara, CA, USA  95054
long@nortelnetworks.com

Greg Sidebottom
Nortel Networks
3685 Richmond Rd,
Nepean, Ontario, Canada  K2H 5B7
gregside@nortelnetworks.com

Guy Mousseau
Nortel Networks
3685 Richmond Rd
Nepean, Ontario, Canada  K2H 5B7

Ian Rytina
Ericsson Australia
37/360 Elizabeth Street 
Melbourne, Victoria 3000, Australia
ian.rytina@ericsson.com

Hanns Juergen Schwarzbauer
SIEMENS AG
Hofmannstr. 51
81359 Munich, Germany
HannsJuergen.Schwarzbauer@icn.siemens.de

Ken Morneault
Cisco Systems Inc.
13615 Dulles Technology Drive
Herndon, VA, USA  20171
EMail: kmorneau@cisco.com






Sidebottom et al                                             [Page 55]

Internet Draft       SS7 MTP3-User Adaptation Layer         March 2000


Malleswar Kalla
Telcordia Technologies
MCC 1J211R
445 South Street
Morristown, NJ, USA  07960
EMail: kalla@research.telcordia.com
















This draft expires September 2000.

