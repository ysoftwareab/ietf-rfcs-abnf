Network Working Group                                    Jong Oh. Kim
INTERNET-DRAFT                                          SoongSil UNIV
<draft-kim-mobile-diff-00.txt>                                 
Expiration Date : August 1999                                  Y. Mun     
                                                        SoongSil UNIV                                                               
                                                       Feburary  1999

                                                      
                                                      
          Mobility Support in the Differentiated Services


       
Status of this Memo


   This document is an Internet-Draft and is in full conformance with 
   all provisions of Section 10 of RFC2026 except for the right to
   produce derivative works.

   This document is an Internet-Draft. Internet-Drafts are working
   documents of the Internet Engineering Task Force (IETF), its areas,
   and its working groups. Note that other groups may also distribute 
   working documents as Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six
   months and may be updated, replaced, or obsoleted by other
   documents at any time. It is inappropriate to use Internet-Drafts
   as reference material or to cite them other than as "work in
   progress."

   To view the entire list of current Internet-Drafts, please check
   the "1id-abstracts.txt" listing contained in the Internet-Drafts
   Shadow Directories on ftp.is.co.za (Africa), ftp.nordu.net
   (Northern Europe), ftp.nis.garr.it (Southern Europe),
   munnari.oz.au (Pacific Rim), ftp.ietf.org (US East Coast), or
   ftp.isi.edu (US West Coast).
 
   The distribution of this document before its expiry date is
   unlimited.


0. Abstract

    
   This document provides a method to be able to support mobility 
   service in the Differentiate Service Architecture[1]. For this 
   service we used Mobile IP[2] as mobility scheme. So we define new 
   functions and operations and we modify the header formats already 
   defined in Mobile IP[2] suggested in IETF support under IPv4 and 
   IPv6.


Kim, Mun                     Expires August 1999                [Page 1]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


1. Introduction


   Diff-Serv is a mechanism by which network service providers can 
   offer differing levels of network service to different traffic, 
   in so providing quality of service (QoS) to their customers. 
   Because this mechanism has been deployed just for fixed hosts 

   Diff-Serv have been suggested can not be satisfied with mobility
   service. The new  mechanism this document describes is designed 
   for user wants to have mobility service in the Internet. 
 
   Mobile IP[2] is a modification to IP that allows nodes to continue 
   to receive datagrams no matter where they happen to be attached to 
   the Internet. It involves some additional control messages that 
   allow the IP nodes involved to manage their IP routing tables
   reliably. For mobility support in the DS we adopts Mobile IP 
   mechanism is already on the status of RFC (Request for comment) in 
   the IETF(Internet Engineering Task Force). When we apply the Mobile
   IP in the DS new functions are required in Boundary router of DS. 

   This document presents new functions under the IPv4 and IPv6 for 
   mobility in DS model. One of issues we noticed adopting the Mobile IP 
   is that there are different functions required according to Agent of
   Mobile IP is located in Boundary router of DS or is separated from 
   Boundary router of DS. 
   This document only considers that Agent functions and DS Edge Router 
   functions are isolated and illustrates the mechanism in that 
   situation. 
  
   The document is organized as follows. In section 2 the document 
   describes the network architecture  we premise and operation for 
   supporting mobility service in the Diff-Serv model under IPv4. 
   In section 3 we define new mechanism for mobility support in IPv4 
   while section 4 illustrates a functioin needed for mobility service
   under IPv6


2. Mobility Support in DS of IPv4


   In this section we will describe how transparent mobility service 
   can be supported in the IPv4 while mobile host is away form Home 
   Domain we define newly. We premise in this document that location 
   of Agents defined in Mobile IP are located in subnetwork in each 
   and there can be constructed more than two subneworks in a DS Domain.


2.1. Network Architecture


Kim, Mun                     Expires August 1999                [Page 2]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


   The Network Architecture premised in this draft is same one defined 
   in [1]. that is, there is DS Domain where DS Edge Node to separate 
   DS Domains and connects with non-DS Domains are constructed in DS 
   boundary. Functions of DS Edge Node suggested in [1] that are 
   forwarding packets and traffic conditioning according to the DS 
   codepoint defined by PHB groups are carried on identically. But one
   situation differs from [1] is that we premise mobile host that is 
   located in DS Domain. That is shown in Figure 1. It explains that 
   mobile host can be move out of the its own Domain.


  	 Home Domain
  	+-----------------------+
        |   +-----+             | 
        |   |home |         +---|--------+
        |   |agent|---------|  Home Edge | 
        |    +--+---+       |   Rouer    |      
        | ---|--|-------+-  +---|-------|+                     
        |    |          |       |       | 
        |   +------+ +--+--+    |       | 
        |   |Mobile| |fixed|    |     +-+-------------+  
        |   |host  | |host |    |     |  Foreign Edge |           
        |   +---\--+ +-----+    |     |   Router------|-----------+          
        +-------\---------------+     +---|-------+---+           |    
                \                         |       |               |          
                \                         |    +--+----+          |  
                \                 Foreign |    |Foreign|          | 
                \                  Domain |    | Agent |          |
                \                         |    +----+--+          | 
                 \                        |  -------|--------|--  |  
                   \                      |   +-----+-+  +---+-+  |
                    \                     |   |Mobile |  |Fixed|  |
                      \ ==================|==>| Host  |  | host|  |
                                          |   +-------+  +-----+  | 
                                          +-----------------------+
 
                        Figure 1 Mobile Ds Architecture                     

   One Domain can be constructed more than two subnetworks where Agent 
   defined in [2] supports mobility service for mobile hosts. Although 
   we take in the Mobile IP mechanism in subnetworks constructed in a
   domain. When mobile hosts move out of the Domain Mobile IP must be 
   modified for transparent mobility service for mobile node. So we 
   focus that how can be supported transparent mobility service in the 
   case of movement between Domains.

   One of terminologies defined in this draft newly is the Home Domain
   and the Foreign Domain. Home Domain is the Domain for mobile host to
   contract service originally and get service first. Foreign Domain is


Kim, Mun                     Expires August 1999                [Page 3]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


   the Domain for mobile host to stay when mobile host is away form 
   Home Domain.
   Important components in this model are the Home Edge Router and 
   Foreign Edge Router that have core functions for mobility service. 
   Hone Edge Router is a router that offers function needed for 
   transparent mobility service in the Home Domain of mobile host when 
   mobile host moves from its own Domain to another Domain. And Home 
   Edge Router also supports the functions as Edge router defined in 
   [3] identically. 

   Foreign Edge Router is a router that brings in  mobility service for
   mobile host in a Domain to which mobile host moves from Home Domain. 
   Of course Foreign Edge Router is also  located in DS boundary as Edge 
   router suggested in [3]. 
   In another meaning Home Edge Router and Foreign Edge Router are 
   router have a function of agent to be able to give the mobility 
   service for mobile host.


2.2 Registration


   When mobile host which is communicating with a correspondent host 
   moves out of subnetwork there are two cases considered. 
   First case is that mobile host can just move between subnetwork in 
   same Domain. In this case after mobile hosts detect its  movement 
   with advertisements Foreign Agent broadcasts it sends  Registration 
   message defined in [2] to Foreign Agent. Because we premise Foreign 
   Agent already knows address of Edge routers that are located in a 
   its own Domain by manual configuration  Foreign Agent can compares 
   address of Edge router it has with the field  of Registration message
   mobile host sends contains address of Edge router. The field of Edge
   router address is one of the fields we have modified. If Foreign 
   Agent has the address of Edge router contained in Registration 
   message among its own Edge router list Foreign Agent decides that 
   mobile host is being in its Home domain and forwards Registration 
   message mobile host sent to Home Agent directly.

   But in the case of movement between Home Domain and Foreign Domain 
   another procedures defined newly are needed. First mobile host 
   makes an attempts to get Care-of-Address after migration from its 
   Home Domain to Foreign Domain. After acquisition of Care-of-Address 
   mobile host sends Registration message to Foreign Agent which is 
   located in a subnetwork of Foreign Domain. Mobile host inserts 
   address of its own Home Edge Router in Registration message and sends
   it to Foreign Agent. Foreign Agent receives Registration message 
   mobile host sent decides that mobile host is being in a  Foreign 
   Domain moving out of its Home Domain because Foreign Agent has not 
   found Edge router address contained in Registration message among 


Kim, Mun                     Expires August 1999                [Page 4]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


   Edge router List it has. 

   Then Foreign Agent forwards Registration message to Foreign Edge 
   router, not Home Agent directly after Foreign Agent set the N flag
   and inserts one of the  Foreign Edge routers Addresses in Registra-
   tion message. 
   Home Edge Router received Registration message starts to negotiate 
   SLA[1] because N flag is set in Registration message. Here one 
   assumption is that all Agents know address of Edge Routers through 
   manual configuration.
  
   First step of negotiation is that Home Edge Router takes Registrat-
   ion message Foreign Edge router forwards in Foreign Domain. And Home
   Edge Router decides whether mobile host is one of the hosts it has 
   given quality of service to. Next step is that Home Edge Router sends
   Traffic profile that is on quality of service level mobile  host 
   contracted to Foreign Edge Router if N flag is set. For above 
   procedure the field of Foreign Edge Router address is needed in 
   Registration message. So Home Edge Router can cognize which Foreign 
   Edge Router takes care of the mobile host temporally through this 
   field and can decide the Foreign Edge Router to which it must give 
   the information of Traffic profile.


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type      |S|B|D|M|G|V|N| |          Lifetime             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Home Address                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           Home Agent                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Care-of Address                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +                         Identification                        +
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                Home Edge Router Address                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   |              Foreign Edge Router Address                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
   | Extensions ...   
   +-+-+-+-+-+-+-+-


      Flag N : It indicates that Foreign Agent require SLA negotiation 
               between Home Edge router and Foreign Edge router


Kim, Mun                     Expires August 1999                [Page 5]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999   


      Home Edge Router Address :  It is necessary for Foreign Edge
                   Router to send Registration message to Home Edge
                   Router
    
      Foreign Edge Router Address : It is necessary for Home Edge
                   Router to send traffic profile information of
                   mobile host to Home Edge Router.

 figure 2 Registration Request Format of Mobile IP for mobility service


   So Foreign Edge Router can decide whether it can give the quality of 
   service what Home Edge Router required for mobile host according to 
   the Profile information Home Edge Router sent in its Domain. If the
   request of Home Edge Router is accepted Foreign Edge Router sends 
   ACK message that indicates request acceptance to Home Edge Router. 
   Therefor one of message we define is ACK message additionally.

   But if request is denied by Foreign Edge Router Home Edge Router is 
   supposed to get NACK message. And then mobile host can be just given
   best-effort service in Foreign Domain. Through this procedure quality
   of service is given to mobile host in Foreign Domain and additionally
   Profile Information of mobile host should be cached in Guest list of
   Foreign Edge Router we suggest in addition. Fields needed in guest 
   list are a IP address and port number and Care-of-Address , lifetime
   and Identification that are binding information of mobile host. 
   Among these fields binding information is used for Route Optimizati-
   on[7] in order to make efficiency better. Procedure will be 
   explained in section 2.2 in detail. Irrespective of the negotiation
   between Foreign Edge Router and Home Edge Router Registration
   message is arrived in Home Agent. By operation defined in Mobile IP
   after Registration is completed Reply message is sent to mobile host.
 

2.3 Delivering Datagrams


   If the correspondent host does not notice movement of mobile host 
   wants to deliver datagrams to mobile host correspondent host sends 
   datagrams using IP address of mobile host. Then Home Agent intercepts
   the datagrams correspondent host sent and encapsulates the datagrams.
   Encapsulated datagrams are forwarded to Foreign Edge Router. And If 
   Traffic conditioning is necessary it is carried on by Foreign Edge
   Router. Therefor Home Edge Router and Foreign Edge Router are 
   included in Tunneling. And If Remaking is needed Home Edge Router 
   should not modify only DS filed in encapsulated IP header but also 
   DS field in originated IP header. This is why adequate forwarding 
   pattern has to be decided in the case of being router to mobile 
   host after decapsulation


Kim, Mun                     Expires August 1999                [Page 6]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999 


   When correspondent host delivers datagrams to mobile host is being
   in Home Domain triangular routing problem occurs. Although the
   problem can somehow be solved by Route Optimization[7] if mobile
   host is in Foreign Domain datagrams correspondent host sent has 
   to be gone by way of Home Edge Router to get binding information
   from Home Agent of mobile host getting out of current Domain totally.
   This is another inefficiency. 

   In this case it is more effient to use binding information in Guest 
   list Edge Router has if Edge router can carry on the function of Home 
   Agent partly. That is, instead of forwarding datagrams to Home Agent
   of Home Domain Foreign Edge Router returns binding information of 
   mobile host using guest list it has because Foreign Edge Router can 
   know that  mobile host is one of the hosts it has given quality of 
   service.
   So one of the function required in Edge Router is the decaptuaaltion.
   Then encapsulated datagrams Foreign Agent encapsulates can be 
   decapsulated by Edge Router. 

   After decapsulation Edge Router delivers datagrams to mobile host 
   and returns binding information to correspondent host. Through 
   this procedure propagation time can be saved. Next delivering 
   datagrams correspondent host can use this binding information. 
   In the case of delivering datagrams of mobile host to correspondent
   host mobile host can deliver datagrams to correspondent host directly
   using DS forwarding mechanism without any modification.
 

2.4 Cache Update


   When a mobile host moves to another Domain resources allocated for 
   mobile host in former Domain where mobile host stayed has to be 
   released. To release network resource Guest list update message we
   define is used whenever mobile host moves to another Domain. 
   Because Edge Router allocates resources for mobile host temporally 
   after mobile host moves to another Domain resource allocated has to
   be release using Guest list update message. The operation using 
   Guest list update message is that mobile host should sends one to 
   Foreign Edge Router mobile host know temporally. Especially a mobile
   host should sends one periodically to Foreign Edge Router has its 
   traffic profile and contracts SLA temporally with Home Edge Router
   while Registration takes place. If Foreign Edge Router receives the 
   Guest list update message before the timer Foreign Edge Router has
   expires the cache information in Guest list for mobile host should 
   be kept. If Foreign Edge Router however does not receive the guest 
   list update message in timeout it deems mobile host is away from
   current Domain and deletes the cache information in Guest list. 


Kim, Mun                     Expires August 1999                [Page 7]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


   One of issues we have considered is that there might be more than 
   two Foreign Edge Routers in Domain. In this case the cache 
   information of mobile host Foreign Edge Router has must be shared 
   with other Edge Routers. Therefore the Foreign Edge Router receive
   the Guest list update message from mobile host should notify other
   Foreign Edge Route of cache information of mobile host available. 


2.5 Deregistration


   When mobile host returns Home network mobile host set value of the 
   lifetime to zero and send Registration message. Deregistration is 
   done as above. It is defined in Mobile IP[2]. After deregisteration 
   resource allocated in Foreign Edge Router has to be released. This 
   is done by what we described in section 2.4.
  
   In the case that mobile host just returns to the Home Domain not 
   exact Home network because mobile host detects whether it is in 
   Home Domain or not by mechanism we described mobile host does not
   send Guest list update message to Foreign Edge Router. Therefor 
   resource allocated is released after timeout.


3. Mobility Support in DS of IPv6


   In this section we describe how mobility service can be supported 
   when mobile host moves out of DS Domain where mobile host is given
   quality of service under IPv6[8]
 

3.1 Network Architecture


   When mobile host moves to another subnetwork it can find out its 
   movement using movement detection[9] supported in IPv6 and obtains a
   Care-of-Address through the Stateless or Stateful address Autoconf-
   iguration[10]. Therefore one of the different situations is that the
   function of Foreign Agent is not necessary any more. With the 
   exception of this the network architecture we have considered is 
   that Home Domain and Foreign Domain exist as we defined in IPv4. 
   And the functions of DS Edge Node suggested in [1] that are forwar-
   ding packets and traffic conditioing according to the DS codepoint 
   defined by PHB groups are carried on identically. We premise mobile
   host that is located in DS Domain. One Domain can be constructed 
   more than two subnetworks where Agent defined in [2] supports 
   mobility service for mobile hosts. Although we take operation in [9]
   in subnetworks located in a domain when mobile host moves out of 


Kim, Mun                     Expires August 1999                [Page 8]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


   the Domain Mobile IP must be modified for transparent mobility 
   service for mobile node. So we focus how can be supported transparent
   mobility service in the case of movement between Domains.


3.2 Registration


   We have considered two cases that mobile host is in Home Domain and
   it is in Foreign Domain as Registration procedure. First when mobile
   host moves between subnetworks in Home Domain it took the Care-of-
   Address sends Registration message to Home Agent. But one of the 
   procedures needed is to decide whether mobile host is being in Home 
   Domain or not before sends Registration message. This operation is as
   follows. First mobile host sends Router Solicitation message to 
   router in subnetwork which mobile host found through Router Discovery
   offered in IPv6 after mobile host detects its movement using movement
   detection supported in IPv6. Router Solicitation message mobile host
   sends should be modified when mobile host uses this message for 
   Registration. So we modify this message, and also Router Advertise-
   ment message for reply in Solicitation message. The fields added in 
   message are one that is able to contain Edge Router Address of Home 
   Domain. 

   Mobile host compares Edge Router Address in Router Advertisement 
   message with Edge router list it has. After this operation mobile 
   host can decide whether it is in Home Domain or not. That is, if 
   mobile host has same Edge Router Address in Edge Router list it is 
   being in Home Domain. In this case mobile host just sends Registr-
   ation message to Home Agent. After this Registration procedure is 
   exactly same with procedure defined in [9]. We premise here that 
   every router in the Domain has Edge Route address. If there are more
   than two  Edge Router in a Domain those should be contained in Router
   Advertisement message.

   But in the case that mobile host moves to Foreign Domain another 
   procedures needed are as follows.  If mobile host takes a  Care-of-
   Address after movement detection Registration procedure starts. 
   Of course it takes place for mobile host to send Router Solicitation
   message before Registration procedure starts. We define the Router 
   Solicitation message mobile host sends to router first  for Registra-
   tion which is a message to change a value of field in Router Solicit-
   ation message[11]. The message including changed field is shown in 
   figure 3.
     

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     

Kim, Mun                     Expires August 1999                [Page 9]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |     Type =133 |     Code=1    |          Checksum             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                           Reserved                            |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |Option code =1 |Option Length=1|                               |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                         Sender's Link Address                 |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


      Type : 133 , code : 1

      Figure 3  Edge Router Solicitation Message for mobility service


   The values of the two fields, Type and code defined in RFC 2461 are 
   133 and 0 respectively. Using this option we define new Edge Router
   Solicitation message for Registration of mobile host as the value of
   Type and Code field is 133 and 1 respectively.
   
   The Router Advertisement message a router received the Edge Router 
   Solicitation message should reply must contain Edge Router Address. 
   A mobile host compares Edge Router List it has in default with Edge 
   Router Address in Router Advertisement message it received. In the 
   case that mobile host moves out of the Home Domain there is no Edge 
   Router address matched. New option to contain Edge Router Address 
   we suggest in the format of Router Advertisement message defined in
   RFC 2461 should be supplement to the options already defined, Source 
   link-layer address option, MTU option and Prefix information option.
   That is, when router replies in Edge Router Solicitation new option 
   should be extended in Router Advertisement message. Option consists 
   of option code fields which value is 7 and option length  which is 
   variable. The reason why the value of option length is variable is 
   that Edge Router Address router has may be more than two Address. 
   And  Edge Router Addresses fills the body of option part. Router 
   Advertisement message to add new option is shown in figure 4.


      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |     Type =134 |     Code=0    |          Checksum             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Cur Hop Limit |M|O|  Reserved |       Router Lifetime         |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                         Reachable Time                        |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                          Retrans Timer                        |


Kim, Mun                     Expires August 1999               [Page 10]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |Option code    |Option Length  |          Reserved             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+--+-+|
     |                         Edge Router Address[i]                |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                            .......                            |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                         Edge Router Address[N]                |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

        option code  : 7
        option  length : variable
        Edge router's Address[I] :  Edge router IP Address of ith  
          
       Figure 4  Router advertisement message for mobility service 


   When a mobile host detects that it is in Foreign Domain through 
   Router Advertisement message instead of mobile host does not sends 
   Registration message to Home Agent directly mobile host sends 
   Registration message with N flag set to Edge Router of Foreign 
   Domain. It means that SLA negotiation initializes between Foreign 
   Edge Router and Home Edge Router for quality of service level mobile 
   host wants. If mobile host moves between subnetworks in Home Domain
   or non-DS Domain N flag has to be set to zero. 

   In the case that mobile host moves between subnetowks in a same 
   Foreign Domain whenever mobile host moves Registration message has 
   not to be deliverd to Home Agent. Instead of, Foreign Edge Router 
   plays a role as Home Agent temporally. 
   Foreign Edge Router forwards Registration message from mobile host
   to Home Edge Router and starts SLA negotiation. SLA negotiation 
   procedure is the same as we describe in IPv4. While SLA negotiation 
   proceeds Registration message arrives in Home Agent. After SLA 
   negotiation If mobile host can get quality of service mobile host 
   information including binding information caches in Guest list in 
   Foreign Edge Router.
 

3.3 Delivering Datagrams


   In the case that mobile host delivers datagrams correspondent host
   DS forwarding mechanism is enough  for mobile host without any 
   modification. But if correspondent host wants to deliver datagrams
   to mobile host a little modification is needed. 
   If the correspondent host does not notice movement of mobile host 
   correspondent host sends datagrams using original IP address of 
   mobile host. Then Home Agent intercepts the datagrams correspondent


Kim, Mun                     Expires August 1999               [Page 11]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


   host sent in Home Domain and encapsulates[12] the datagrams.
   Encapsulated datagrams are forwarded to mobile host. And If Traffic
   conditioning is necessary it is carried on between Home Edge Router
   and Foreign Edge Router holding datagrams. And If Remaking is needed
   Home Edge Router should only modify DS filed in encapsulated IP 
   header. It is one of the difference with operation of IPv4. This is 
   why de-capsulation is done in mobile host in IPv6.

   If Home Agent and correspondent host are located in different Domain
   and correspondent host and mobile host are being in same Domain we 
   can use Foreign Edge Router as Foreign Agent in IPv4. This is, when 
   mobile host just moves in Foreign Domain Registration message has not
   to be sends to Home Agent. Instead of, Foreign Edge Router manages 
   location of mobile host using Guest list. What a figure 5 explains 
   is that mobile host registers its location to Home Agent when mobile
   host moves to Foreign Domain. After Registration correspondent host
   does not know movement of mobile host tries to  deliver datagrams. 


        Home Domain
        |------------------+
        |  +-----+         | 
        |  |home |     +---|--------+
        |  |agent|-----|  Home Edge | 
        |  +-----+     |   Rouer    |      
        |    ------+---+---|--------+                     
        |          |       |      | 
        |       +--+--+    |      | 
        |       |fixed|    |   ++-------------+  
        |       |host |    |   |  Foreign Edge|           
        |       +-----+    |   |   Router-----|-----------+          
        +------------------+   +-|----\-+/\\--+-----+     |    
                                 |    \    \    +---+---+ |  
                         Foreign |    \     \   |  Home | | 
                          Domain |    \      \  | Agent | |
                                 |    \       \ +-----+-+ | 
                                 |  --\--------\-----|--- |  
                                 | +-\\/+--+  +-\----+-+  |
                                 | |Mobile |  |corres- |  |
                                 | | Host  |  |pondent |  |
                                 | +-------+  | host   |  |
                                 +------------+--------+--+


                 Figure 5 Delivering Datagrams 
      

   By the scheme of IPv6 already suggested datagrams correspondent host
   sends has to be via Home Agent first. Then first delivering mobile 


Kim, Mun                     Expires August 1999               [Page 12]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


   host received datagrams sends its binding information to correspond-
   ent host. If mobile host moves to another subnetwork in the same 
   Domain frequently above procedure is not efficient. If Foreign Edge 
   Router plays a role as Agent it can be solved. Thant is, datagrams 
   correspondent host sent have not to be delivered to Home Agent, just 
   to Foreign Edge Router. Foreign Edge Router receives the datagrams 
   forwards these to mobile host.  For this operation Foreign Edge 
   Router should have the encapsulation function.


3.4  Cache Update


   If mobile host does not exist in current Foreign Domain resources 
   allocated for mobile host in Foreign Domain where mobile host stayed
   has to be released. For deallocation of network resource making use
   of Update message including the timer is more efficient rather than
   using explicit signal whenever mobile host moves to another Domain. 
   Because resources are allocated resources for mobile host temporally
   by Edge Router after mobile host moves to another Domain resource 
   allocated has to be release using Guest list update message we define.
   The operation using Guest list update message is as follows.
   A mobile host should sends Guest list update message periodically to
   Foreign Edge Router has its traffic profile and contracts SLA 
   temporally with Home Edge Router while Registration takes place. 
   If Foreign Edge Router receives the Guest list update message before
   the timer Foreign Edge Router has expires the cache information 
   in Guest list for mobile host should be kept for a lifetime. 
 
   If Foreign Edge Router however does not receive the guest list 
   update message in timeout it decides that mobile host moves to 
   another Domain and deletes the cache information of mobile host in 
   Guest list. 
   One of considerations we have is that because there might be more 
   than two Foreign Edge Routers in Domain in this case the cache 
   information of mobile host Foreign Edge Router has must be shared 
   with other Edge Routers. Therefore the Foreign Edge Router receives 
   the Guest list update message from mobile host should forwards 
   update message mobile host sent to other Foreign Edge Route of 
   cache information of mobile host available. 


3.5 Deregistration


   After mobile host returns Home network it set a value of the lifetime
   to zero and sends Registration message[2] for Deregistration. After
   deregisteration resource allocated in Foreign Edge Router has to be 
   released. This is done by using Guest list update message described 


Kim, Mun                     Expires August 1999               [Page 13]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


   in section 3.4
   Because a mobile host is able to detect whether it is in Home domain
   or not by mechanism we described in section 3.2 when mobile host 
   returns to a Home domain not a exact home network mobile host does
   not send Guest list update message to Foreign Edge Router. 
   Then resource allocated is released after timeout.
 

4. Conclusion 


   Over the past several years there has been a considerable amount of 
   research within the field quality of service for real time and
   multimedia data service in the Internet. Among these research 
   Differentiated Service model suggested in Diff-Serv working group 
   of IETF is being upheld recently. Because this model just however 
   considers the fixed host for quality of service mobility service 
   required gradually in the Internet can not be supported. So to be 
   satisfied with quality of service and mobility service in the Inte-
   rnet at the same time we suggested new operation and modified some
   header format already designed applying Mobile IP defined in IETF. 
   Through what we design mobility service and mobility service can be
   realized  in the Internet.


5. Reference 


   [1] S. Blake , D. Black, M. Carlson, E. Davies, Z. Wang, and W. 
       Weiss. An Architecture for Differentiated Services. RFC2475 
       December 1998

   [2] C. Perkins, IP Mobility Support. RFC2002. October 1996 

   [3] D. Durham and F. Reichmeyer. Requirements of Diff-serv Boundary 
       Routers. draft-bernet-diffedge-01.txt. Internet Draft. 
       November, 1998. Work in Progress

   [4] Blake, Yoram Bernet, James Binder, Steven Blake, Mark Carlson, 
       Srinivasan Keshav, Elwyn Davies Borje Ohlman, Dinesh Verma, 
       Zheng Wang and Walter Weiss . A Framework for Differentiated 
       Services. draft-ietf-diffserv-framework-01.txt. InternetDraft. 
       October, 1998. Work in Progress.

   [5] C. Perkins . IP encapsulation in IP  RFC2003, October 1996

   [6] W. Simpson. IP in IP tunneling. RFC1835, October 1995

   [7] Charles Perkins and David B. Johnson. Route Optimization in 


Kim, Mun                     Expires August 1999               [Page 14]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999


       Mobile IP. draft-ietf-mobileip-optim-07.txt. Internet Draft. 
       November 1997. Work in Progress

   [8] S. Deering, R. Hinden and  Nokia Internet Protocol, Version 6 
       Specification(IPv6). RFC2460. December 1998.

   [9] David B. Johnson and  Charles Perkins. Mobility Support in IPv6.
       draft-ietf-mobileip-ipv6-07.txt. Internet Draft. November 1998. 
       Work in Progress

   [10] S.Thomson and T.Narten. IPv6 Stateless Address Autoconfiguration.
        RFC2462. December 1998.

   [11] T. Narten, E. Nordmark and  W. Simpson. Neighbor Discovery for
        IP Version 6 (IPv6). RFC2461. December 1998

   [12] A. Conta S. Deering. Generic Packet Tunneling in IPv6 
        Specification. RFC2473. December 1998


6. Author Information


   JongOh Kim 
   Email: fido@computing.soongsil.ac.kr Tel: 082-2-820-0689
   1-1 Sanddo 5 Dong Dongjack-Gu, Seoul Korea
   
   Y.Mun
   Email: Mun@computing.soongsil.ac.kr Tel: 082-2-820-0676
   1-1 Sanddo 5 Dong Dongjack-Gu, Seoul Korea



















Kim, Mun                     Expires August 1999               [Page 15]



Internet Draft         draft-kim-mobile-diff-00.txt        Feburary 1999

