



Inter-Domain Routing                                            T. Kumar
Internet-Draft                                                  Ericsson
Intended status: Standards Track                            May 23, 2017
Expires: November 24, 2017


  Procedures to handle duplicate Route Targets (RT) received by a BGP
                                Speaker
                   draft-anup-idr-bgp-duplicate-rt-00

Abstract

   This document describes why duplicate suppression should not be
   applied to BGP Route Target (RT) Address Family.  It also explains
   the problems incurred if duplicate suppression is applied to BGP
   route constraints AF

Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [RFC2119] .

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on November 24, 2017.

Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of



Kumar                   Expires November 24, 2017               [Page 1]

Internet-Draft         BGP Duplicate Route Targets              May 2017


   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Problem . . . . . . . . . . . . . . . . . . . . . . . . . . .   3
     2.1.  Summary of the Problem  . . . . . . . . . . . . . . . . .   3
   3.  Problem scenario - An Example . . . . . . . . . . . . . . . .   3
   4.  Existing workaround for the above problem . . . . . . . . . .   4
   5.  Solution to the Problem . . . . . . . . . . . . . . . . . . .   4
   6.  Acknowledgments . . . . . . . . . . . . . . . . . . . . . . .   4
   7.  Security Considerations . . . . . . . . . . . . . . . . . . .   4
   8.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   4
   9.  Contributors  . . . . . . . . . . . . . . . . . . . . . . . .   5
   10. References  . . . . . . . . . . . . . . . . . . . . . . . . .   5
     10.1.  Normative References . . . . . . . . . . . . . . . . . .   5
     10.2.  Informative References . . . . . . . . . . . . . . . . .   5
   Author's Address  . . . . . . . . . . . . . . . . . . . . . . . .   5

1.  Introduction

   Address families like ipv4 unicast are used for exchange of routing
   or reachability information.  Receipt of an ipv4 unicast update by
   router R means that the peer has the ipv4 route and hence, has sent
   it to R, while the receiving router R computes bestpath and uses the
   route for forwarding.

   With respect to receiving ipv4 unicast update, we have two
   possibilities:

      1) The receiving router does not have the original route in its
      database.  It treats the update as fresh update.  So, the received
      ipv4 unicast update is processed and downloaded for forwarding.

      2) The receiving router already has the route in its database. It
      treats the update as duplicate and drops it.  It is guaranteed by
      BGP base protocol that the receiver had processed and
      installed the route when the earlier update was seen, and hence it
      can drop the duplicate ipv4 unicast update.  Even if the duplicate
      is processed again and installed again, there is no problem with
      duplicate processing and installation.




Kumar                   Expires November 24, 2017               [Page 2]

Internet-Draft         BGP Duplicate Route Targets              May 2017


2.  Problem

   This section explains the problem when duplicate suppression is
   applied to BGP updates carrying Route Targets (RT) Address Family
   information.

   RT address family is used to exchange VPN subscription information.
   Receipt of an RT update means that the sender is interested in
   getting vpn routes from this router.  This router is expected to send
   matching vpn routes in response.  Which means, receipt of an RT
   update, unlike ipv4 unicast update, does not end with local
   installation of route, but also necessarily entails sending vpn
   routes in response.

   Like before, we have two cases to analyze with respect to receiving
   duplicate RT updates:

      1) The receiving router does not have earlier RT in its database.
      It treats the RT as fresh update, and it sends vpn routes in
      response.

      2) The receiving router already has the RT in its database.  It
      treats the incoming RT as duplicate and drops it.  But, when the 
      receiver gets the duplicate RT, whether the sender has vpn routes
      or not, is not known at the receiver side.  So, dropping the
      duplicate RT without sending vpn routes in response, is a problem.

2.1.  Summary of the Problem

   When a duplicate RT is received, it is not guaranteed that the sender
   of the RT has the required vpn routes.  So the receiver cannot choose
   to ignore an RT as duplicate, because unlike Ipv4 unicast route, an
   RT indicates a subscription or a want of vpn routes and the receiver
   does not know whether the sender has the vpn routes or not.

3.  Problem scenario - An Example

      First time when the import RT is configured the sender will not
      have vpn routes, and it sends the RT to its peers, thereby
      conveying its want of vpn routes.

      The receiver also sees this RT coming from the sender for the
      first time, and It sends vpn routes in response to the sender of
      the RT.

      Now, certain Destructive operations can lead to cleanup of vpn
      routes.  Example: Remove and add of vpn configurations, 'without'
      affecting bgp peer session state.



Kumar                   Expires November 24, 2017               [Page 3]

Internet-Draft         BGP Duplicate Route Targets              May 2017


      Here, due to removal of vpn config, the sender will cleanup the
      vpn routes.

      Then, due to quick addition of vpn config, the sender will request
      for vpn routes by sending all the configured RTs.

      But, the receiver still has the earlier RTs that was sent by the
      peer.  So, the receiver treats the RTs as duplicate and drops
      them.

      Thus no vpn routes are sent to the sender

4.  Existing workaround for the above problem

   Implementations solve this problem at the sender side by sending a
   request for Route refresh (known as a bgp soft in request), after any
   modification to vpn configuration.  But, this is only a workaround.
   The real problem is in the way bgp treats received RT.  The
   corrective measure should be at the receiver's side, by sending out
   vpn routes in response, though the RT might be a duplicate.  Further,
   when the receiver has the ability to use RTs to walk only the
   required VPN tables with an objective to avoid full walk, sending a
   request for full route refresh will prevent the receiver from
   utilizing its ability to walk required VPN tables for the RT.  So,
   sending a request for route refresh not only masks the problem in
   2.1, but also leads to inefficient vpn walks at the sender capable of
   selective vpn update generation per received RT.

5.  Solution to the Problem

   When the received RT is a duplicate, the receiver should respond with
   vpn routes, rather than simply dropping the duplicate RT.

6.  Acknowledgments

   The author would like to thank P. Muthu and team for their
   comments and review.

7.  Security Considerations

   There are no additional security considerations than the base BGP
   RFC.

8.  IANA Considerations

   This document has no actions for IANA.






Kumar                   Expires November 24, 2017               [Page 4]

Internet-Draft         BGP Duplicate Route Targets              May 2017


9.  Contributors

10.  References

10.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

   [RFC4271]  Rekhter, Y., Ed., Li, T., Ed., and S. Hares, Ed., "A
              Border Gateway Protocol 4 (BGP-4)", RFC 4271,
              DOI 10.17487/RFC4271, January 2006,
              <http://www.rfc-editor.org/info/rfc4271>.

10.2.  Informative References

   [RFC4684]  Marques, P., Bonica, R., Fang, L., Martini, L., Raszuk,
              R., Patel, K., and J. Guichard, "Constrained Route
              Distribution for Border Gateway Protocol/MultiProtocol
              Label Switching (BGP/MPLS) Internet Protocol (IP) Virtual
              Private Networks (VPNs)", RFC 4684, DOI 10.17487/RFC4684,
              November 2006, <http://www.rfc-editor.org/info/rfc4684>.

Author's Address

   Anup Kumar T
   Ericsson India Pvt Ltd
   Ferns Icon, Doddanakkundi, Mahadevapura
   Bengaluru  560037
   India

   Email: anupkumar.t@ericsson.com












Kumar                   Expires November 24, 2017               [Page 5]