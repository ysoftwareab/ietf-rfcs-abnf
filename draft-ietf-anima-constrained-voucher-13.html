<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Constrained Voucher Artifacts for Bootstrapping Protocols</title>
<meta content="Michael Richardson" name="author">
<meta content="Peter van der Stok" name="author">
<meta content="Panos Kampanakis" name="author">
<meta content="Esko Dijk" name="author">
<meta content="
       This document defines a protocol to securely assign a Pledge to an
owner and to enroll it into the owner's network.
The protocol uses an artifact that is signed by the Pledge's manufacturer.
This artifact is known as a &quot;voucher&quot;. 
       This document builds upon the work in   and  , but defines an encoding of
the voucher in CBOR rather than JSON, and enables the Pledge to perform its transactions using CoAP rather than HTTPS. 
       The use of Raw Public Keys instead of X.509 certificates for security operations is also explained. 
    " name="description">
<meta content="xml2rfc 3.9.1" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-anima-constrained-voucher-13" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.9.1
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.1
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 57.4.0
    six 1.16.0
-->
<link href="/tmp/constrained-voucher-eoucuhdq.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Constrained Voucher</td>
<td class="right">July 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Richardson, et al.</td>
<td class="center">Expires 26 January 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">anima Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-anima-constrained-voucher-13</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-07-25" class="published">25 July 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-01-26">26 January 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Richardson</div>
<div class="org">Sandelman Software Works</div>
</div>
<div class="author">
      <div class="author-name">P. van der Stok</div>
<div class="org">vanderstok consultancy</div>
</div>
<div class="author">
      <div class="author-name">P. Kampanakis</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">E. Dijk</div>
<div class="org">IoTconsultancy.nl</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Constrained Voucher Artifacts for Bootstrapping Protocols</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines a protocol to securely assign a Pledge to an
owner and to enroll it into the owner's network.
The protocol uses an artifact that is signed by the Pledge's manufacturer.
This artifact is known as a "voucher".<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">This document builds upon the work in <span>[<a href="#RFC8366" class="xref">RFC8366</a>]</span> and <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span>, but defines an encoding of
the voucher in CBOR rather than JSON, and enables the Pledge to perform its transactions using CoAP rather than HTTPS.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
<p id="section-abstract-3">The use of Raw Public Keys instead of X.509 certificates for security operations is also explained.<a href="#section-abstract-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 26 January 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact ulBare ulEmpty toc">
<li class="compact ulBare ulEmpty toc" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="xref">3</a>.  <a href="#name-requirements-language" class="xref">Requirements Language</a></p>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-overview-of-protocol" class="xref">Overview of Protocol</a></p>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-brski-est-protocol" class="xref">BRSKI-EST Protocol</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-discovery-uris-and-content-" class="xref">Discovery, URIs and Content Formats</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-extensions-to-brski" class="xref">Extensions to BRSKI</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-extensions-to-est-coaps" class="xref">Extensions to EST-coaps</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.5.2.3.2.1">
                    <p id="section-toc.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="xref">5.3.1</a>.  <a href="#name-pledge-extensions" class="xref">Pledge Extensions</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.5.2.3.2.2">
                    <p id="section-toc.1-1.5.2.3.2.2.1"><a href="#section-5.3.2" class="xref">5.3.2</a>.  <a href="#name-registrar-extensions" class="xref">Registrar Extensions</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-brski-masa-protocol" class="xref">BRSKI-MASA Protocol</a></p>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-pinning-in-voucher-artifact" class="xref">Pinning in Voucher Artifacts</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-registrar-identity-selectio" class="xref">Registrar Identity Selection and Encoding</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-masa-pinning-policy" class="xref">MASA Pinning Policy</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-pinning-of-raw-public-keys" class="xref">Pinning of Raw Public Keys</a></p>
</li>
            </ul>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-artifacts" class="xref">Artifacts</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-voucher-request-artifact" class="xref">Voucher Request artifact</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="xref">8.1.1</a>.  <a href="#name-tree-diagram" class="xref">Tree Diagram</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.1.2.2">
                    <p id="section-toc.1-1.8.2.1.2.2.1"><a href="#section-8.1.2" class="xref">8.1.2</a>.  <a href="#name-sid-values" class="xref">SID values</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.1.2.3">
                    <p id="section-toc.1-1.8.2.1.2.3.1"><a href="#section-8.1.3" class="xref">8.1.3</a>.  <a href="#name-yang-module" class="xref">YANG Module</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.1.2.4">
                    <p id="section-toc.1-1.8.2.1.2.4.1"><a href="#section-8.1.4" class="xref">8.1.4</a>.  <a href="#name-example-voucher-request-art" class="xref">Example voucher request artifact</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-voucher-artifact" class="xref">Voucher artifact</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="xref">8.2.1</a>.  <a href="#name-tree-diagram-2" class="xref">Tree Diagram</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.2.2.2">
                    <p id="section-toc.1-1.8.2.2.2.2.1"><a href="#section-8.2.2" class="xref">8.2.2</a>.  <a href="#name-sid-values-2" class="xref">SID values</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.2.2.3">
                    <p id="section-toc.1-1.8.2.2.2.3.1"><a href="#section-8.2.3" class="xref">8.2.3</a>.  <a href="#name-yang-module-2" class="xref">YANG Module</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.2.2.4">
                    <p id="section-toc.1-1.8.2.2.2.4.1"><a href="#section-8.2.4" class="xref">8.2.4</a>.  <a href="#name-example-voucher-artifacts" class="xref">Example voucher artifacts</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-signing-voucher-and-voucher" class="xref">Signing voucher and voucher-request artifacts with COSE</a></p>
</li>
            </ul>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-design-considerations" class="xref">Design Considerations</a></p>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-raw-public-key-use-consider" class="xref">Raw Public Key Use Considerations</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-the-registrar-trust-anchor" class="xref">The Registrar Trust Anchor</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-the-pledge-voucher-request" class="xref">The Pledge Voucher Request</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="xref">10.3</a>.  <a href="#name-the-voucher-response" class="xref">The Voucher Response</a></p>
</li>
            </ul>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-clock-sensitivity" class="xref">Clock Sensitivity</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-protect-voucher-pki-in-hsm" class="xref">Protect Voucher PKI in HSM</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#section-11.3" class="xref">11.3</a>.  <a href="#name-test-domain-certificate-val" class="xref">Test Domain Certificate Validity when Signing</a></p>
</li>
            </ul>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="xref">12.1</a>.  <a href="#name-resource-type-registry" class="xref">Resource Type Registry</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="xref">12.2</a>.  <a href="#name-the-ietf-xml-registry" class="xref">The IETF XML Registry</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#section-12.3" class="xref">12.3</a>.  <a href="#name-the-yang-module-names-regis" class="xref">The YANG Module Names Registry</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.12.2.4">
                <p id="section-toc.1-1.12.2.4.1"><a href="#section-12.4" class="xref">12.4</a>.  <a href="#name-the-rfc-sid-range-assignmen" class="xref">The RFC SID range assignment sub-registry</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.12.2.5">
                <p id="section-toc.1-1.12.2.5.1"><a href="#section-12.5" class="xref">12.5</a>.  <a href="#name-media-types-registry" class="xref">Media Types Registry</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.12.2.5.2.1">
                    <p id="section-toc.1-1.12.2.5.2.1.1"><a href="#section-12.5.1" class="xref">12.5.1</a>.  <a href="#name-application-voucher-cosecbo" class="xref">application/voucher-cose+cbor</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.12.2.6">
                <p id="section-toc.1-1.12.2.6.1"><a href="#section-12.6" class="xref">12.6</a>.  <a href="#name-coap-content-format-registr" class="xref">CoAP Content-Format Registry</a></p>
</li>
            </ul>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-acknowledgements" class="xref">Acknowledgements</a></p>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="xref">14</a>. <a href="#name-changelog" class="xref">Changelog</a></p>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="xref">15</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#section-15.1" class="xref">15.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#section-15.2" class="xref">15.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-library-support-for-brski" class="xref">Library support for BRSKI</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#appendix-A.1" class="xref">A.1</a>.  <a href="#name-opensssl" class="xref">OpensSSL</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.16.2.2">
                <p id="section-toc.1-1.16.2.2.1"><a href="#appendix-A.2" class="xref">A.2</a>.  <a href="#name-mbedtls" class="xref">mbedTLS</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.16.2.3">
                <p id="section-toc.1-1.16.2.3.1"><a href="#appendix-A.3" class="xref">A.3</a>.  <a href="#name-wolfssl" class="xref">wolfSSL</a></p>
</li>
            </ul>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-constrained-brski-est-messa" class="xref">Constrained BRSKI-EST messages</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.17.2.1">
                <p id="section-toc.1-1.17.2.1.1"><a href="#appendix-B.1" class="xref">B.1</a>.  <a href="#name-enrollstatus" class="xref">enrollstatus</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.17.2.2">
                <p id="section-toc.1-1.17.2.2.1"><a href="#appendix-B.2" class="xref">B.2</a>.  <a href="#name-voucher_status" class="xref">voucher_status</a></p>
</li>
            </ul>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#appendix-C" class="xref">Appendix C</a>.  <a href="#name-cose-examples" class="xref">COSE examples</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.18.2.1">
                <p id="section-toc.1-1.18.2.1.1"><a href="#appendix-C.1" class="xref">C.1</a>.  <a href="#name-pledge-registrar-and-masa-k" class="xref">Pledge, Registrar and MASA keys</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.18.2.1.2.1">
                    <p id="section-toc.1-1.18.2.1.2.1.1"><a href="#appendix-C.1.1" class="xref">C.1.1</a>.  <a href="#name-pledge-private-key" class="xref">Pledge private key</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.18.2.1.2.2">
                    <p id="section-toc.1-1.18.2.1.2.2.1"><a href="#appendix-C.1.2" class="xref">C.1.2</a>.  <a href="#name-registrar-private-key" class="xref">Registrar private key</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.18.2.1.2.3">
                    <p id="section-toc.1-1.18.2.1.2.3.1"><a href="#appendix-C.1.3" class="xref">C.1.3</a>.  <a href="#name-masa-private-key" class="xref">MASA private key</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.18.2.2">
                <p id="section-toc.1-1.18.2.2.1"><a href="#appendix-C.2" class="xref">C.2</a>.  <a href="#name-pledge-registrar-and-masa-c" class="xref">Pledge, Registrar and MASA certificates</a></p>
<ul class="compact ulEmpty ulBare toc">
<li class="compact ulEmpty ulBare toc" id="section-toc.1-1.18.2.2.2.1">
                    <p id="section-toc.1-1.18.2.2.2.1.1"><a href="#appendix-C.2.1" class="xref">C.2.1</a>.  <a href="#name-pledge-idevid-certificate" class="xref">Pledge IDevID certificate</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.18.2.2.2.2">
                    <p id="section-toc.1-1.18.2.2.2.2.1"><a href="#appendix-C.2.2" class="xref">C.2.2</a>.  <a href="#name-registrar-certificate" class="xref">Registrar Certificate</a></p>
</li>
                  <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.18.2.2.2.3">
                    <p id="section-toc.1-1.18.2.2.2.3.1"><a href="#appendix-C.2.3" class="xref">C.2.3</a>.  <a href="#name-masa-certificate" class="xref">MASA Certificate</a></p>
</li>
                </ul>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.18.2.3">
                <p id="section-toc.1-1.18.2.3.1"><a href="#appendix-C.3" class="xref">C.3</a>.  <a href="#name-cose-signed-voucher-request" class="xref">COSE signed voucher request from Pledge to Registrar</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.18.2.4">
                <p id="section-toc.1-1.18.2.4.1"><a href="#appendix-C.4" class="xref">C.4</a>.  <a href="#name-cose-signed-voucher-request-" class="xref">COSE signed voucher request from Registrar to MASA</a></p>
</li>
              <li class="compact ulEmpty ulBare toc" id="section-toc.1-1.18.2.5">
                <p id="section-toc.1-1.18.2.5.1"><a href="#appendix-C.5" class="xref">C.5</a>.  <a href="#name-cose-signed-voucher-from-ma" class="xref">COSE signed voucher from MASA to Pledge via Registrar</a></p>
</li>
            </ul>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.19">
            <p id="section-toc.1-1.19.1"><a href="#appendix-D" class="xref"></a><a href="#name-contributors" class="xref">Contributors</a></p>
</li>
          <li class="compact ulBare ulEmpty toc" id="section-toc.1-1.20">
            <p id="section-toc.1-1.20.1"><a href="#appendix-E" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Secure enrollment of new nodes into constrained networks with constrained nodes
presents unique challenges. There are network bandwidth and code size issues to contend with.
A solution for autonomous enrollment such as BRSKI <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span> may be too large in terms of
code size or bandwidth required.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Therefore, this document defines a constrained version of the voucher artifact <span>[<a href="#RFC8366" class="xref">RFC8366</a>]</span>, along with a constrained version of <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span> that makes use of the constrained CoAP-based version of EST, EST-coaps <span>[<a href="#I-D.ietf-ace-coap-est" class="xref">I-D.ietf-ace-coap-est</a>]</span> rather than EST over HTTPS <span>[<a href="#RFC7030" class="xref">RFC7030</a>]</span>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">While the <span>[<a href="#RFC8366" class="xref">RFC8366</a>]</span> voucher is by default serialized to JSON with a signature in CMS,
this document defines a new voucher serialization to CBOR (<span>[<a href="#RFC7049" class="xref">RFC7049</a>]</span>) with a signature in COSE <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>.
This COSE-signed CBOR-encoded voucher can be transported using secured CoAP or HTTP.
The CoAP connection (between Pledge and Registrar) is to be protected by either OSCORE+EDHOC or DTLS (CoAPS).
The HTTP connection (between Registrar and MASA) is to be protected using TLS (HTTPS).<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This document specifies a constrained voucher-request artifact based on Section 3 of <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span>, and
voucher(-request) transport over CoAP based on Section 3 of <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span> and on <span>[<a href="#I-D.ietf-ace-coap-est" class="xref">I-D.ietf-ace-coap-est</a>]</span>.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">The CBOR definitions for the constrained voucher format are defined using the mechanism described in <span>[<a href="#I-D.ietf-core-yang-cbor" class="xref">I-D.ietf-core-yang-cbor</a>]</span> using the SID mechanism explained in <span>[<a href="#I-D.ietf-core-sid" class="xref">I-D.ietf-core-sid</a>]</span>.
As the tooling to convert YANG documents into a list of SID keys is still in its infancy, the table of SID values presented here MUST be considered normative rather than the output of the pyang tool.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">There is additional work when the voucher is integrated into the key-exchange, described in <span>[<a href="#I-D.selander-ace-ake-authz" class="xref">I-D.selander-ace-ake-authz</a>]</span>.
This work is not in scope for this document.<a href="#section-1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">The following terms are defined in <span>[<a href="#RFC8366" class="xref">RFC8366</a>]</span>, and are used identically as in that document:
artifact, domain, imprint, Join Registrar/Coordinator (JRC), Manufacturer Authorized Signing Authority
(MASA), Pledge, Registrar, Trust of First Use (TOFU), and Voucher.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The following terms from <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span> are used identically as in that document:
Domain CA, enrollment, IDevID, Join Proxy, LDevID, manufacturer, nonced, nonceless, PKIX.<a href="#section-2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="reqlang">
<section id="section-3">
      <h2 id="name-requirements-language">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
      </h2>
<p id="section-3-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="survey">
<section id="section-4">
      <h2 id="name-overview-of-protocol">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-overview-of-protocol" class="section-name selfRef">Overview of Protocol</a>
      </h2>
<p id="section-4-1"><span>[<a href="#RFC8366" class="xref">RFC8366</a>]</span> provides for vouchers that assert proximity, that authenticate the Registrar and that can offer varying levels of anti-replay protection.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">This document does not make any extensions to the semantic meaning of vouchers, only the encoding has been changed to optimize for constrained devices and networks.
The two main parts of the BRSKI protocol are named separately in this document: BRSKI-EST for the protocol between Pledge and Registrar, and BRSKI-MASA for the
protocol between the Registrar and the MASA.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">Time-based vouchers are supported in this definition, but given that constrained devices are extremely unlikely to have accurate time, their use will be uncommon.
Most Pledges using these constrained vouchers will be online during enrollment and will use live nonces to provide anti-replay protection rather than expiry times.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4"><span>[<a href="#RFC8366" class="xref">RFC8366</a>]</span> defines the voucher artifact, while the Voucher Request artifact was defined in <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span>.
This document defines both a constrained voucher and a constrained voucher-request.
They are presented in the order "voucher-request", followed by a "voucher" response as this is
the order that they occur in the protocol.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">The constrained voucher request MUST be signed by the Pledge.
It signs using the private key associated with its IDevID X.509 certificate, or if an IDevID is not available, then the private key associated with its manufacturer-installed raw public key (RPK).
<a href="#rpk-considerations" class="xref">Section 10</a> provides additional details on PKIX-less operations.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">The constrained voucher MUST be signed by the MASA.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">For the constrained voucher request this document defines two distinct methods for the Pledge to identify the Registrar: using either the Registrar's X.509 certificate, or using a raw public key (RPK) of the Registrar.<a href="#section-4-7" class="pilcrow">¶</a></p>
<p id="section-4-8">For the constrained voucher also these two methods are supported to indicate (pin) a trusted domain identity: using either a pinned domain X.509 certificate, or a pinned raw public key (RPK).<a href="#section-4-8" class="pilcrow">¶</a></p>
<p id="section-4-9">The BRSKI architectures mandates that the MASA be aware of the capabilities of the pledge.
This is not a hardship as the pledges are constructed by a manufacturer who also arranges for the MASA to be aware of the inventory of devices.<a href="#section-4-9" class="pilcrow">¶</a></p>
<p id="section-4-10">The MASA therefore knows if the pledge supports PKIX operations, PKIX format certificates, or if the pledge is limited to Raw Public Keys (RPK).
Based upon this, the MASA can select which attributes to use in the voucher for certain operations, like the pinning of the Registrar identity.
This is described in more detail in <a href="#yang-voucher" class="xref">Section 8.2.3</a>, <a href="#pinning" class="xref">Section 7</a> and <a href="#pinned-with-rpk" class="xref">Section 7.3</a> (for RPK specifically).<a href="#section-4-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="brski-est">
<section id="section-5">
      <h2 id="name-brski-est-protocol">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-brski-est-protocol" class="section-name selfRef">BRSKI-EST Protocol</a>
      </h2>
<p id="section-5-1">This section describes the constrained BRSKI extensions to EST-coaps <span>[<a href="#I-D.ietf-ace-coap-est" class="xref">I-D.ietf-ace-coap-est</a>]</span> to transport the voucher between Registrar and Pledge (optionally via a Join Proxy) over CoAP.
The extensions are targeting low-resource networks with small packets.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The constrained BRSKI-EST protocol described in this section is between the Pledge and the Registrar only.<a href="#section-5-2" class="pilcrow">¶</a></p>
<div id="discovery-uris-and-content-formats">
<section id="section-5.1">
        <h3 id="name-discovery-uris-and-content-">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-discovery-uris-and-content-" class="section-name selfRef">Discovery, URIs and Content Formats</a>
        </h3>
<p id="section-5.1-1">To keep the protocol messages small the EST-coaps and constrained-BRSKI URIs are shorter than the respective EST and BRSKI URIs.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The EST-coaps server URIs differ from the EST URIs by replacing the scheme https by coaps and by specifying shorter resource path names. Below are some examples;
the first two using a discovered short path name and the last one using the well-known URI of EST which requires no discovery.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.1-3">
<pre>
  coaps://server.example.com/est/&lt;short-name&gt;
  coaps://server.example.com/e/&lt;short-name&gt;
  coaps://server.example.com/.well-known/est/&lt;short-name&gt;
</pre><a href="#section-5.1-3" class="pilcrow">¶</a>
</div>
<p id="section-5.1-4">Similarly the constrained BRSKI server URIs differ from the BRSKI URIs by replacing the scheme https by coaps and by specifying shorter resource path names. Below are some examples;
the first two using a discovered short path name and the last one using the well-known URI prefix which requires no discovery.
This is the same "/.well-known/brski" prefix as defined in <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span> Section 5.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.1-5">
<pre>
  coaps://server.example.com/brski/&lt;short-name&gt;
  coaps://server.example.com/b/&lt;short-name&gt;
  coaps://server.example.com/.well-known/brski/&lt;short-name&gt;
</pre><a href="#section-5.1-5" class="pilcrow">¶</a>
</div>
<p id="section-5.1-6">Figure 5 in section 3.2.2 of <span>[<a href="#RFC7030" class="xref">RFC7030</a>]</span> enumerates the operations supported by EST, for which Table 1 in Section 5.1 of <span>[<a href="#I-D.ietf-ace-coap-est" class="xref">I-D.ietf-ace-coap-est</a>]</span> enumerates the corresponding
EST-coaps short path names. Similarly, <a href="#est-uri" class="xref">Table 1</a> provides the mapping from the supported BRSKI extension URI paths to the constrained-BRSKI URI paths.<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<span id="name-brski-uri-paths-mapping-to-"></span><div id="est-uri">
<table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-brski-uri-paths-mapping-to-" class="selfRef">BRSKI URI paths mapping to constrained BRSKI URI paths</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">BRSKI resource</th>
              <th class="text-left" rowspan="1" colspan="1">constrained-BRSKI resource</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">/requestvoucher</td>
              <td class="text-left" rowspan="1" colspan="1">/rv</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">/voucher_status</td>
              <td class="text-left" rowspan="1" colspan="1">/vs</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">/enrollstatus</td>
              <td class="text-left" rowspan="1" colspan="1">/es</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-5.1-8">Note that /requestvoucher indicated above occurs between the Pledge and Registrar (in scope of the BRSKI-EST protocol), but it also occurs between Registrar and MASA. However,
as described in <a href="#brski-est" class="xref">Section 5</a>, this section and above table addresses only the BRSKI-EST protocol.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
<p id="section-5.1-9">Pledges that wish to discover the available BRSKI bootstrap options/formats, or reduce the size of the CoAP headers by eliminating the "/.well-known/brski" path, can do a discovery operation using <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span> Section 4 by sending a discovery query to the Registrar.<a href="#section-5.1-9" class="pilcrow">¶</a></p>
<p id="section-5.1-10">For example, if the Registrar supports a short BRSKI URL (/b) and supports the voucher format "application/voucher-cose+cbor" (TBD3), and status reporting in both CBOR and JSON formats:<a href="#section-5.1-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.1-11">
<pre>
  REQ: GET /.well-known/core?rt=brski*

  RES: 2.05 Content
  Content-Format: 40
  Payload:
  &lt;/b&gt;;rt=brski,
  &lt;/b/rv&gt;;rt=brski.rv;ct=TBD3,
  &lt;/b/vs&gt;;rt=brski.vs;ct="50 60",
  &lt;/b/es&gt;;rt=brski.es;ct="50 60"
</pre><a href="#section-5.1-11" class="pilcrow">¶</a>
</div>
<p id="section-5.1-12">The Registrar is under no obligation to provide shorter URLs, and MAY respond to this query with only the "/.well-known/brski/&lt;short-name&gt;" end points for the short names as defined in <a href="#est-uri" class="xref">Table 1</a>.<a href="#section-5.1-12" class="pilcrow">¶</a></p>
<p id="section-5.1-13">Registrars that have implemented shorter URLs MUST also respond in equivalent ways to the corresponding "/.well-known/brski/&lt;short-name&gt;" URLs, and MUST NOT distinguish between them.
In particular, a Pledge MAY use the longer and shorter URLs in combination.<a href="#section-5.1-13" class="pilcrow">¶</a></p>
<p id="section-5.1-14">When responding to a discovery request for BRSKI resources, the server MAY in addition return
the full resource paths and the content types which are supported at those end-points as shown in above example.
This is useful when multiple content types are specified for a particular resource on the server.
The server responds with only the root path for the BRSKI resource (rt=brski, resource /b in above example) and no others in case the client queries for only rt=brski type resources.
(So, a query for rt=brski, without the wildcard character.)<a href="#section-5.1-14" class="pilcrow">¶</a></p>
<p id="section-5.1-15">The return of multiple content-types in the "ct" attribute allows the Pledge to choose the most appropriate one.
Note that Content-Format TBD3 ("application/voucher-cose+cbor") is defined in this document.<a href="#section-5.1-15" class="pilcrow">¶</a></p>
<p id="section-5.1-16">The Content-Format 50 ("application/json") MAY be supported and Content-Format 60 ("application/cbor") MUST be supported by the Registrar for the /vs and /es resources.
Content-Format TBD3 MUST be supported by the Registrar for the /rv resource.
If the "ct" attribute is not indicated for the /rv resource in the link format description, this implies that at least TBD3 is supported.<a href="#section-5.1-16" class="pilcrow">¶</a></p>
<p id="section-5.1-17">The Pledge and MASA need to support one or more formats (at least TBD3) for the voucher and for the voucher request.
The MASA needs to support all formats that the Pledge, produced by that manufacturer, supports.<a href="#section-5.1-17" class="pilcrow">¶</a></p>
</section>
</div>
<div id="brski-extensions">
<section id="section-5.2">
        <h3 id="name-extensions-to-brski">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-extensions-to-brski" class="section-name selfRef">Extensions to BRSKI</a>
        </h3>
<p id="section-5.2-1">A Pledge that only supports the BRSKI bootstrap method and already knows the IP address and port of a Registrar or Join Proxy to use SHOULD NOT use discovery.
In such case it is more efficient to just try its supported bootstrap method (e.g. /rv) via the well-known BRSKI resource on the known address and port. This avoids
the Pledge having to unnecessarily implement CoRE Link Format parsing. The method via which the Pledge learns the address/port of a Registrar or Join Proxy to use
is out of scope of this document.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">A Registrar SHOULD host any discoverable BRSKI resources on the same (UDP) server port that the Pledge's initial DTLS connection is using.
This avoids the overhead of the Pledge having to reconnect using DTLS, in order to access discovered resource(s).<a href="#section-5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="brski-est-extensions">
<section id="section-5.3">
        <h3 id="name-extensions-to-est-coaps">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-extensions-to-est-coaps" class="section-name selfRef">Extensions to EST-coaps</a>
        </h3>
<p id="section-5.3-1">A Pledge that already is DTLS-connected to either a Join Proxy or Registrar, and which only supports the EST-coaps enrollment method, SHOULD NOT use discovery for EST-coaps resources.
This is because it is more efficient to just try its supported enrollment method (e.g. /sen) via the well-known EST resource on the current DTLS connection.
This avoids an additional round-trip of packets and avoids the Pledge having to unnecessarily implement CoRE Link Format parsing.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">A Registrar SHOULD host any discoverable EST-coaps resources on the same (UDP) server port that the Pledge's DTLS initial connection is using.
This avoids the Pledge having to reconnect using DTLS, in order to proceed with EST enrollment after the BRSKI bootstrap.
[TBD EDNOTE: a Registrar that does host EST resources on another port won't be able to onboard Pledges that skip the discovery, so not interoperable. Should we fix this?]<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<div id="brski-extensions-pledge">
<section id="section-5.3.1">
          <h4 id="name-pledge-extensions">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-pledge-extensions" class="section-name selfRef">Pledge Extensions</a>
          </h4>
<p id="section-5.3.1-1">A constrained Pledge SHOULD NOT support the optional EST "CSR attributes request" (/att) to minimize network traffic and reduce code size.<a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<p id="section-5.3.1-2">When creating the CSR, the Pledge selects which attributes to include. One or more Subject Distinguished Name fields MUST be included.
If the Pledge has no specific information on what attributes/fields are desired in the CSR, it MUST use the Subject Distinguished Name fields from its IDevID unmodified.
The Pledge can receive such information via the voucher (encoded in a vendor-specific way) or some other, out-of-band means.<a href="#section-5.3.1-2" class="pilcrow">¶</a></p>
<p id="section-5.3.1-3">A constrained Pledge MAY use the following optimized EST-coaps procedure to minimize both network traffic and code size:<a href="#section-5.3.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3.1-4">
<li id="section-5.3.1-4.1">if the voucher, that validates the current Registrar, contains a single pinned domain CA certificate, the Pledge provisionally considers this certificate as the EST trust anchor, in other words,
it provisionally accepts this CA certificate as if it were the result of "CA certificates request" (/crts) to the Registrar.<a href="#section-5.3.1-4.1" class="pilcrow">¶</a>
</li>
            <li id="section-5.3.1-4.2">Using this CA certificate as trust anchor it proceeds with EST simple enrollment (/sen) to obtain its provisionally trusted LDevID.<a href="#section-5.3.1-4.2" class="pilcrow">¶</a>
</li>
            <li id="section-5.3.1-4.3">If the Pledge validates that the trust anchor CA was used to sign its LDevID, the Pledge accepts the pinned domain CA certificate as the legitimate trust anchor CA for the Registrar's domain and accepts the associated LDevID.<a href="#section-5.3.1-4.3" class="pilcrow">¶</a>
</li>
            <li id="section-5.3.1-4.4">If the trust anchor CA was NOT used to sign its LDevID, the Pledge MUST perform an actual "CA certificates request" (/crts) to the EST server to obtain the EST CA trust anchor(s) since these differ from the (temporary) pinned domain CA.<a href="#section-5.3.1-4.4" class="pilcrow">¶</a>
</li>
            <li id="section-5.3.1-4.5">When doing this /crts request, the Pledge MAY use a CoAP Accept Option with value TBD287 ("application/pkix-cert") to limit the number of returned EST CA trust anchors to only one.<a href="#section-5.3.1-4.5" class="pilcrow">¶</a>
</li>
            <li id="section-5.3.1-4.6">If the Pledge cannot obtain the single CA certificate or the finally validated CA certificate cannot be chained to the LDevID, then the Pledge MUST abort the enrollment process and report the error using the enrollment status telemetry (/es).<a href="#section-5.3.1-4.6" class="pilcrow">¶</a>
</li>
          </ol>
</section>
</div>
<div id="registrar-extensions">
<section id="section-5.3.2">
          <h4 id="name-registrar-extensions">
<a href="#section-5.3.2" class="section-number selfRef">5.3.2. </a><a href="#name-registrar-extensions" class="section-name selfRef">Registrar Extensions</a>
          </h4>
<p id="section-5.3.2-1">The Content-Format 50 MAY be supported and 60 MUST be supported by the Registrar for the /vs and /es resources.
Content-Format TBD3 MUST be supported by the Registrar for the /rv resource.<a href="#section-5.3.2-1" class="pilcrow">¶</a></p>
<p id="section-5.3.2-2">When a Registrar receives a "CA certificates request" (/crts) request with a CoAP Accept Option with value TBD287 ("application/pkix-cert") it SHOULD return only the
single CA certificate that is the envisioned or actual authority for the current, authenticated Pledge making the request. The only exception case
is when the Registrar is configured to not support a request for a single CA certificate for operational or security reasons, e.g. because every device
enrolled into the domain needs to use multiple CAs.
In such exception case the Registrar returns the CoAP response 4.06 Not Acceptable to indicate
that only the default Content-Format of 281 "application/pkcs7-mime;smime-type=certs-only" which supports multiple certificates is available.<a href="#section-5.3.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="brski-masa">
<section id="section-6">
      <h2 id="name-brski-masa-protocol">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-brski-masa-protocol" class="section-name selfRef">BRSKI-MASA Protocol</a>
      </h2>
<p id="section-6-1"><span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span> section 5.4 describes a connection between the Registrar and the MASA as being a normal TLS connection using HTTPS.
This document does not change that. The Registrar MAY use the new format "application/voucher-cose+cbor" in its voucher request to MASA, or the existing BRSKI
format "application/voucher-cms+json" defined by <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span>. The MASA MUST support both formats. The Registrar indicates the voucher
format it wants to receive from MASA using the HTTP Accept header.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">At the moment of writing the creation of coaps based MASAs is deemed unrealistic.
The use of CoAP for the BRSKI-MASA connection can be the subject of another document.
Some consideration was made to specify CoAP support for consistency, but:<a href="#section-6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-3.1">the Registrar is not expected to be so constrained that it cannot support HTTPS client connections.<a href="#section-6-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-6-3.2">the technology and experience to build Internet-scale HTTPS responders (which the MASA is) is common, while the experience doing the same for CoAP is much less common.<a href="#section-6-3.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-6-3.3">in many Enterprise networks, outgoing UDP connections are often treated as suspicious, and there seems to be no advantage to using CoAP in that environment.<a href="#section-6-3.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-6-3.4">a Registrar is likely to provide onboarding services to both constrained and non-constrained devices.  Such a Registrar would need to speak HTTPS anyway.<a href="#section-6-3.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-6-3.5">similarly, a manufacturer is likely to offer both constrained and non-constrained devices, so there may in practice be no situation in which the MASA could be CoAP-only.  Additionally, as the MASA is intended to be a function that can easily be oursourced to a third-party service provider, reducing the complexity would also seem to reduce the cost of that function.<a href="#section-6-3.5" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="pinning">
<section id="section-7">
      <h2 id="name-pinning-in-voucher-artifact">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-pinning-in-voucher-artifact" class="section-name selfRef">Pinning in Voucher Artifacts</a>
      </h2>
<p id="section-7-1">The voucher is a statement by the MASA for use by the Pledge that provide the identity of the Pledge's owner.
This section describes how the owner's identity is determined and how it is encoded within the voucher.<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="registrar-identity-selection-and-encoding">
<section id="section-7.1">
        <h3 id="name-registrar-identity-selectio">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-registrar-identity-selectio" class="section-name selfRef">Registrar Identity Selection and Encoding</a>
        </h3>
<p id="section-7.1-1">Section 5.5 of <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span> describes BRSKI policies for selection of the owner identity. It indicates some of the flexibility that is possible for the Registrar.
The recommendation made there is for the Registrar to include only certificates in the voucher request (CMS) signing structure that participate in the certificate chain that is to be pinned.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">The MASA is expected to evaluate the certificates included by the Registrar in its voucher request, forming them into a chain with the Registrar's (signing) identity on one end. Then, it pins a certificate selected from the chain.
For instance, for a domain with a two-level certification authority (see <a href="#fig-twoca" class="xref">Figure 1</a>), where the voucher-request has been signed by "Registrar", its signing structure includes two additional CA certificates:<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<span id="name-two-level-ca-pki"></span><div id="fig-twoca">
<figure id="figure-1">
          <div class="artwork art-text alignLeft" id="section-7.1-3.1">
<pre>
 .------------------.
 |  domain CA (1)   |
 |  trust anchor    |
 '------------------'
           |
           v
    .------------.
    | domain (2) |
    | Sub-CA     |
    '------------'
           |
           |
           v
  .----------------.
  |   domain       |
  | Registrar (3)  |
  | EE certificate |
  '----------------'
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-two-level-ca-pki" class="selfRef">Two-Level CA PKI</a>
          </figcaption></figure>
</div>
<p id="section-7.1-4">When the Registrar is using a COSE-signed constrained voucher request towards MASA, instead of a regular CMS-signed voucher request, the COSE_Sign1 object contains a protected and an unprotected header.
The Registrar MUST place all the certificates for the chain in an "x5bag" attribute in the unprotected header <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span>.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="masa-pinning-policy">
<section id="section-7.2">
        <h3 id="name-masa-pinning-policy">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-masa-pinning-policy" class="section-name selfRef">MASA Pinning Policy</a>
        </h3>
<p id="section-7.2-1">The MASA, having assembled and verified the chain in the signing structure of the voucher request, will now need to select a certificate to pin.
(For the case that only the Registrar's End-Entity certificate is included, only this certificate can be selected and this section does not apply.)
The BRSKI policy for pinning by the MASA as described in Section 5.5.2 of <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span> leaves much flexibility to the manufacturer. The present
document adds the following rules to the MASA pinning policy to reduce the network load:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.2-2">
<li id="section-7.2-2.1">for a voucher containing a nonce, it SHOULD select the most specific (lowest-level) CA certificate in the chain.<a href="#section-7.2-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-7.2-2.2">for a nonceless voucher, it SHOULD select the least-specific (highest-level) CA certificate in the chain that is allowed under the MASA's policy for this specific domain.<a href="#section-7.2-2.2" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-7.2-3">The rationale for 1. is that in case of a voucher with nonce, the voucher is valid only in scope of the present DTLS connection between Pledge and Registrar anyway, so it would have no
benefit to pin a higher-level CA. By pinning the most specific CA the constrained Pledge can validate its DTLS connection using less crypto operations. The
rationale for pinning a CA instead of the Registrar's End-Entity certificate directly is the following benefit on constrained networks: the pinned certificate in the voucher
can in common cases be re-used as a Domain CA trust anchor during the EST enrollment and during the operational phase that follows after EST enrollment, as explained in <a href="#brski-extensions-pledge" class="xref">Section 5.3.1</a>.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<p id="section-7.2-4">The rationale for 2. follows from the flexible BRSKI trust model for, and purpose of, nonceless vouchers (Sections 5.5.* and 7.4.1 of <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span>).<a href="#section-7.2-4" class="pilcrow">¶</a></p>
<p id="section-7.2-5">Using the previous example of a domain with a two-level certification authority, the most specific CA ("Sub-CA") is the identity that is pinned by MASA in a nonced voucher.
A Registrar that wished to have only the Registrar's End-Entity certificate pinned would omit the "domain CA" and "Sub-CA" certificates from the voucher-request.<a href="#section-7.2-5" class="pilcrow">¶</a></p>
<p id="section-7.2-6">In case of a nonceless voucher, the MASA would depending on trust level pin only "Registrar" certificate (low trust in customer), or the "Sub-CA" certificate (in case of
medium trust, implying that any Registrar of that sub-domain is acceptable), or even the "domain CA" certificate (in case of high trust in the customer, and possibly a pre-agreed need of the
customer to obtain flexible long-lived vouchers).<a href="#section-7.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pinned-with-rpk">
<section id="section-7.3">
        <h3 id="name-pinning-of-raw-public-keys">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-pinning-of-raw-public-keys" class="section-name selfRef">Pinning of Raw Public Keys</a>
        </h3>
<p id="section-7.3-1">Specifically for constrained use cases, the pinning of the raw public key (RPK) of the Registrar is also supported in the constrained voucher, instead of an X.509 certificate.
If an RPK is pinned it MUST be the RPK of the Registrar.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">When the Pledge is known by MASA to support RPK but not X.509 certificates, the voucher produced by the MASA pins the RPK of the Registrar in either the "pinned-domain-pubk"
or "pinned-domain-pubk-sha256" field of a voucher.
This is described in more detail in <a href="#yang-voucher" class="xref">Section 8.2.3</a>. A Pledge that does not support X.509 certificates cannot use EST to enroll; it has to use
another method for enrollment without certificates and the Registrar has to support this method also.
It is possible that the Pledge will not enroll, but instead only a network join operation will occur, such as described in <span>[<a href="#I-D.ietf-6tisch-minimal-security" class="xref">I-D.ietf-6tisch-minimal-security</a>]</span>.
How the Pledge discovers this method and details of the enrollment method are out of scope of this document.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
<p id="section-7.3-3">When the Pledge is known by MASA to support PKIX format certificates, the "pinned-domain-cert" field present in a voucher typically pins a domain certificate.
That can be either the End-Entity certificate of the Registrar, or the certificate of a domain CA of the Registrar's domain as specified in <a href="#masa-pinning-policy" class="xref">Section 7.2</a>.
However, if the Pledge is known to also support RPK pinning and the MASA intends to pin the Registrar's identity (not a CA), then MASA SHOULD pin the RPK (RPK3 in <a href="#fig-pinning" class="xref">Figure 2</a>) of the Registrar instead of the Registrar's End-Entity certificate to save space in the voucher.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
<span id="name-raw-public-key-pinning"></span><div id="fig-pinning">
<figure id="figure-2">
          <div class="artwork art-text alignLeft" id="section-7.3-4.1">
<pre>
 .------------.
 | pub-CA (1) |
 '------------'
        |
        v
 .------------.
 | sub-CA (2) |
 '------------'
        |
        v
.--------------.
| Registrar(3) |
|    RPK3      |
'--------------'
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-raw-public-key-pinning" class="selfRef">Raw Public Key pinning</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="artifacts">
<section id="section-8">
      <h2 id="name-artifacts">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-artifacts" class="section-name selfRef">Artifacts</a>
      </h2>
<p id="section-8-1">This section describes for both the voucher request and
the voucher first the abstract (tree) definition as explained
in <span>[<a href="#I-D.ietf-netmod-yang-tree-diagrams" class="xref">I-D.ietf-netmod-yang-tree-diagrams</a>]</span>.  This provides a high-level
view of the contents of each artifact.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Then the assigned SID values are presented. These have been assigned using
the rules in <span>[<a href="#I-D.ietf-core-sid" class="xref">I-D.ietf-core-sid</a>]</span>.<a href="#section-8-2" class="pilcrow">¶</a></p>
<div id="voucher-request-artifact">
<section id="section-8.1">
        <h3 id="name-voucher-request-artifact">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-voucher-request-artifact" class="section-name selfRef">Voucher Request artifact</a>
        </h3>
<div id="tree-diagram">
<section id="section-8.1.1">
          <h4 id="name-tree-diagram">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-tree-diagram" class="section-name selfRef">Tree Diagram</a>
          </h4>
<p id="section-8.1.1-1">The following diagram is largely a duplicate of the contents of <span>[<a href="#RFC8366" class="xref">RFC8366</a>]</span>,
with the addition of the fields proximity-registrar-pubk, proximity-registrar-pubk-sha256,
proximity-registrar-cert, and prior-signed-voucher-request.<a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1.1-2">prior-signed-voucher-request is only used between the Registrar and the MASA.
proximity-registrar-pubk or proximity-registrar-pubk-sha256 optionally replaces proximity-registrar-cert
for the most constrained cases where RPK is used by the Pledge.<a href="#section-8.1.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1.1-3">
<pre>
module: ietf-constrained-voucher-request

  grouping voucher-request-constrained-grouping
    +-- voucher
       +-- created-on?                        yang:date-and-time
       +-- expires-on?                        yang:date-and-time
       +-- assertion                          enumeration
       +-- serial-number                      string
       +-- idevid-issuer?                     binary
       +-- pinned-domain-cert?                binary
       +-- domain-cert-revocation-checks?     boolean
       +-- nonce?                             binary
       +-- last-renewal-date?                 yang:date-and-time
       +-- proximity-registrar-pubk?          binary
       +-- proximity-registrar-pubk-sha256?   binary
       +-- proximity-registrar-cert?          binary
       +-- prior-signed-voucher-request?      binary
</pre><a href="#section-8.1.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sid-values">
<section id="section-8.1.2">
          <h4 id="name-sid-values">
<a href="#section-8.1.2" class="section-number selfRef">8.1.2. </a><a href="#name-sid-values" class="section-name selfRef">SID values</a>
          </h4>
<div class="artwork art-text alignLeft" id="section-8.1.2-1">
<pre>

      SID Assigned to
--------- --------------------------------------------------
     2501 data /ietf-constrained-voucher-request:voucher
     2502 data .../assertion
     2503 data .../created-on
     2504 data .../domain-cert-revocation-checks
     2505 data .../expires-on
     2506 data .../idevid-issuer
     2507 data .../last-renewal-date
     2508 data /ietf-constrained-voucher-request:voucher/nonce
     2509 data .../pinned-domain-cert
     2510 data .../prior-signed-voucher-request
     2511 data .../proximity-registrar-cert
     2513 data .../proximity-registrar-pubk
     2512 data .../proximity-registrar-pubk-sha256
     2514 data .../serial-number

 WARNING, obsolete definitions
</pre><a href="#section-8.1.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="yang-voucher-request">
<section id="section-8.1.3">
          <h4 id="name-yang-module">
<a href="#section-8.1.3" class="section-number selfRef">8.1.3. </a><a href="#name-yang-module" class="section-name selfRef">YANG Module</a>
          </h4>
<p id="section-8.1.3-1">In the constrained-voucher-request YANG module, the voucher is "augmented" within the "used" grouping statement such that one continuous set of SID values is generated for the constrained-voucher-request module name, all voucher attributes, and the constrained-voucher-request attributes. Two attributes of the voucher are "refined" to be optional.<a href="#section-8.1.3-1" class="pilcrow">¶</a></p>
<div id="section-8.1.3-2">
<pre class="sourcecode">&lt;CODE BEGINS&gt; file "ietf-constrained-voucher-request@2021-04-15.yang"

module ietf-constrained-voucher-request {
  yang-version 1.1;

  namespace
    "urn:ietf:params:xml:ns:yang:ietf-constrained-voucher-request";
  prefix "constrained";

  import ietf-restconf {
    prefix rc;
    description
      "This import statement is only present to access
       the yang-data extension defined in RFC 8040.";
    reference "RFC 8040: RESTCONF Protocol";
  }

  import ietf-voucher {
    prefix "v";
  }

  organization
   "IETF ANIMA Working Group";

  contact
   "WG Web:   &lt;http://tools.ietf.org/wg/anima/&gt;
    WG List:  &lt;mailto:anima@ietf.org&gt;
    Author:   Michael Richardson
              &lt;mailto:mcr+ietf@sandelman.ca&gt;
    Author:   Peter van der Stok
              &lt;mailto: consultancy@vanderstok.org&gt;
    Author:   Panos Kampanakis
              &lt;mailto: pkampana@cisco.com&gt;";

  description
   "This module defines the format for a voucher request,
    which is produced by a pledge to request a voucher.
    The voucher-request is sent to the potential owner's
    Registrar, which in turn sends the voucher request to
    the manufacturer or its delegate (MASA).

    A voucher is then returned to the pledge, binding the
    pledge to the owner.  This is a constrained version of the
    voucher-request present in
    {{I-D.ietf-anima-bootstrap-keyinfra}}

    This version provides a very restricted subset appropriate
    for very constrained devices.
    In particular, it assumes that nonce-ful operation is
    always required, that expiration dates are rather weak, as no
    clocks can be assumed, and that the Registrar is identified
    by either a pinned Raw Public Key of the Registrar, or by a
    pinned X.509 certificate of the Registrar or domain CA.

    The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL',
    'SHALL NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'MAY',
    and 'OPTIONAL' in the module text are to be interpreted as
    described in RFC 2119.";

  revision "2021-04-15" {
    description
     "Initial version";
    reference
     "RFC XXXX: Voucher Profile for Constrained Devices";
  }

  rc:yang-data voucher-request-constrained-artifact {
    // YANG data template for a voucher.
    uses voucher-request-constrained-grouping;
  }

  // Grouping defined for future usage
  grouping voucher-request-constrained-grouping {
    description
      "Grouping to allow reuse/extensions in future work.";

    uses v:voucher-artifact-grouping {

      refine voucher/created-on {
          mandatory  false;
      }

      refine voucher/pinned-domain-cert {
          mandatory  false;
      }


      augment "voucher" {
        description "Base the constrained voucher-request upon the
          regular one";

        leaf proximity-registrar-pubk {
          type binary;
          description
            "The proximity-registrar-pubk replaces
             the proximity-registrar-cert in constrained uses of
             the voucher-request.
             The proximity-registrar-pubk is the
             Raw Public Key of the Registrar. This field is encoded
             as specified in RFC7250, section 3.
             The ECDSA algorithm MUST be supported.
             The EdDSA algorithm as specified in
             draft-ietf-tls-rfc4492bis-17 SHOULD be supported.
             Support for the DSA algorithm is not recommended.
             Support for the RSA algorithm is a MAY, but due to
             size is discouraged.";
        }

        leaf proximity-registrar-pubk-sha256 {
          type binary;
          description
            "The proximity-registrar-pubk-sha256
             is an alternative to both
             proximity-registrar-pubk and pinned-domain-cert.
             In many cases the public key of the domain has already
             been transmitted during the key agreement protocol,
             and it is wasteful to transmit the public key another
             two times.
             The use of a hash of public key info, at 32-bytes for
             sha256 is a significant savings compared to an RSA
             public key, but is only a minor savings compared to
             a 256-bit ECDSA public-key.
             Algorithm agility is provided by extensions to this
             specification which may define a new leaf for another
             hash type.";
        }

        leaf proximity-registrar-cert {
          type binary;
          description
            "An X.509 v3 certificate structure as specified by
             RFC 5280,
             Section 4 encoded using the ASN.1 distinguished encoding
             rules (DER), as specified in ITU-T X.690.

             The first certificate in the Registrar TLS server
             certificate_list sequence  (see [RFC5246]) presented by
             the Registrar to the Pledge. This field or one of its
             alternatives MUST be populated in a
             Pledge's voucher request if the proximity assertion is
             populated.";
        }

        leaf prior-signed-voucher-request {
          type binary;
          description
            "If it is necessary to change a voucher, or re-sign and
             forward a voucher that was previously provided along a
             protocol path, then the previously signed voucher
             SHOULD be included in this field.

             For example, a pledge might sign a proximity voucher,
             which an intermediate registrar then re-signs to
             make its own proximity assertion.  This is a simple
             mechanism for a chain of trusted parties to change a
             voucher, while maintaining the prior signature
             information.

             The pledge MUST ignore all prior voucher information
             when accepting a voucher for imprinting. Other
             parties MAY examine the prior signed voucher
             information for the purposes of policy decisions.
             For example, this information could be useful to a
             MASA to determine that both pledge and registrar
             agree on proximity assertions. The MASA SHOULD
             remove all prior-signed-voucher-request information when
             signing a voucher for imprinting so as to minimize the
             final voucher size.";
        }
      }
    }
  }
}

&lt;CODE ENDS&gt;</pre><a href="#section-8.1.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="example2">
<section id="section-8.1.4">
          <h4 id="name-example-voucher-request-art">
<a href="#section-8.1.4" class="section-number selfRef">8.1.4. </a><a href="#name-example-voucher-request-art" class="section-name selfRef">Example voucher request artifact</a>
          </h4>
<p id="section-8.1.4-1">Below is a CBOR serialization of an example constrained voucher request from a Pledge to a Registrar, shown in CBOR diagnostic notation. The enum value of the assertion field is calculated to be 2 by following the algorithm described in section 9.6.4.2 of <span>[<a href="#RFC7950" class="xref">RFC7950</a>]</span>.
Four dots ("....") in a CBOR byte string denotes a sequence of bytes that are not shown for brevity.<a href="#section-8.1.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1.4-2">
<pre>
{
  2501: {
    +2 : "2016-10-07T19:31:42Z", / SID=2503, created-on /
    +4 : "2016-10-21T19:31:42Z", / SID=2505, expires-on /
    +1 : 2,                      / SID=2502, assertion "proximity" /
    +13: "JADA123456789",        / SID=2514, serial-number /
    +5 : h'08C2BF36....B3D2B3',  / SID=2506, idevid-issuer /
    +10: h'30820275....82c35f',  / SID=2511, proximity-registrar-cert/
    +3 : true,                   / SID=2504, domain-cert
                                                   -revocation-checks/
    +6 : "2017-10-07T19:31:42Z"  / SID=2507, last-renewal-date /
  }
}
&lt;CODE ENDS&gt;
</pre><a href="#section-8.1.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="voucher-artifact">
<section id="section-8.2">
        <h3 id="name-voucher-artifact">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-voucher-artifact" class="section-name selfRef">Voucher artifact</a>
        </h3>
<p id="section-8.2-1">The voucher's primary purpose is to securely assign a Pledge to an
owner.  The voucher informs the Pledge which entity it should
consider to be its owner.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<div id="tree-diagram-1">
<section id="section-8.2.1">
          <h4 id="name-tree-diagram-2">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-tree-diagram-2" class="section-name selfRef">Tree Diagram</a>
          </h4>
<p id="section-8.2.1-1">The following diagram is largely a duplicate of the contents of <span>[<a href="#RFC8366" class="xref">RFC8366</a>]</span>,
with only the addition of the fields pinned-domain-pubk and pinned-domain-pubk-sha256.<a href="#section-8.2.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.2.1-2">
<pre>
module: ietf-constrained-voucher

  grouping voucher-constrained-grouping
    +-- voucher
       +-- created-on?                      yang:date-and-time
       +-- expires-on?                      yang:date-and-time
       +-- assertion                        enumeration
       +-- serial-number                    string
       +-- idevid-issuer?                   binary
       +-- pinned-domain-cert?              binary
       +-- domain-cert-revocation-checks?   boolean
       +-- nonce?                           binary
       +-- last-renewal-date?               yang:date-and-time
       +-- pinned-domain-pubk?              binary
       +-- pinned-domain-pubk-sha256?       binary
&lt;CODE ENDS&gt;
</pre><a href="#section-8.2.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sid-values-1">
<section id="section-8.2.2">
          <h4 id="name-sid-values-2">
<a href="#section-8.2.2" class="section-number selfRef">8.2.2. </a><a href="#name-sid-values-2" class="section-name selfRef">SID values</a>
          </h4>
<div class="artwork art-text alignLeft" id="section-8.2.2-1">
<pre>

      SID Assigned to
--------- --------------------------------------------------
     2451 data /ietf-constrained-voucher:voucher
     2452 data /ietf-constrained-voucher:voucher/assertion
     2453 data /ietf-constrained-voucher:voucher/created-on
     2454 data .../domain-cert-revocation-checks
     2455 data /ietf-constrained-voucher:voucher/expires-on
     2456 data /ietf-constrained-voucher:voucher/idevid-issuer
     2457 data .../last-renewal-date
     2458 data /ietf-constrained-voucher:voucher/nonce
     2459 data .../pinned-domain-cert
     2460 data .../pinned-domain-pubk
     2461 data .../pinned-domain-pubk-sha256
     2462 data /ietf-constrained-voucher:voucher/serial-number

 WARNING, obsolete definitions
&lt;CODE ENDS&gt;
</pre><a href="#section-8.2.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="yang-voucher">
<section id="section-8.2.3">
          <h4 id="name-yang-module-2">
<a href="#section-8.2.3" class="section-number selfRef">8.2.3. </a><a href="#name-yang-module-2" class="section-name selfRef">YANG Module</a>
          </h4>
<p id="section-8.2.3-1">In the constrained-voucher YANG module, the voucher is "augmented" within the "used" grouping statement such that one continuous set of SID values is generated for the constrained-voucher module name, all voucher attributes, and the constrained-voucher attributes.
Two attributes of the voucher are "refined" to be optional.<a href="#section-8.2.3-1" class="pilcrow">¶</a></p>
<div id="section-8.2.3-2">
<pre class="sourcecode">&lt;CODE BEGINS&gt; file "ietf-constrained-voucher@2021-04-15.yang"

module ietf-constrained-voucher {
  yang-version 1.1;

  namespace
    "urn:ietf:params:xml:ns:yang:ietf-constrained-voucher";
  prefix "constrained";

  import ietf-restconf {
    prefix rc;
    description
      "This import statement is only present to access
       the yang-data extension defined in RFC 8040.";
    reference "RFC 8040: RESTCONF Protocol";
  }

  import ietf-voucher {
    prefix "v";
  }

  organization
   "IETF ANIMA Working Group";

  contact
   "WG Web:   &lt;http://tools.ietf.org/wg/anima/&gt;
    WG List:  &lt;mailto:anima@ietf.org&gt;
    Author:   Michael Richardson
              &lt;mailto:mcr+ietf@sandelman.ca&gt;
    Author:   Peter van der Stok
              &lt;mailto: consultancy@vanderstok.org&gt;
    Author:   Panos Kampanakis
              &lt;mailto: pkampana@cisco.com&gt;";

description
  "This module defines the format for a voucher, which
   is produced by a pledge's manufacturer or its delegate
   (MASA) to securely assign one or more pledges to an 'owner',
   so that a pledge may establish a secure connection to the
   owner's network infrastructure.

   This version provides a very restricted subset appropriate
   for very constrained devices.
   In particular, it assumes that nonce-ful operation is
   always required, that expiration dates are rather weak, as no
   clocks can be assumed, and that the Registrar is identified
   by either a pinned Raw Public Key of the Registrar, or by a
   pinned X.509 certificate of the Registrar or domain CA.

   The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL',
   'SHALL NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'MAY',
   and 'OPTIONAL' in the module text are to be interpreted as
   described in RFC 2119.";

  revision "2021-04-15" {
    description
     "Initial version";
    reference
     "RFC XXXX: Voucher Profile for Constrained Devices";
  }

  rc:yang-data voucher-constrained-artifact {
    // YANG data template for a voucher.
    uses voucher-constrained-grouping;
  }

  // Grouping defined for future usage
  grouping voucher-constrained-grouping {
    description
      "Grouping to allow reuse/extensions in future work.";

    uses v:voucher-artifact-grouping {

      refine voucher/created-on {
          mandatory  false;
      }

      refine voucher/pinned-domain-cert {
          mandatory  false;
      }

      augment "voucher" {
        description "Base the constrained voucher
                                   upon the regular one";
        leaf pinned-domain-pubk {
          type binary;
          description
            "The pinned-domain-pubk may replace the
             pinned-domain-cert in constrained uses of
             the voucher. The pinned-domain-pubk
             is the Raw Public Key of the Registrar.
             This field is encoded as a Subject Public Key Info block
             as specified in RFC7250, in section 3.
             The ECDSA algorithm MUST be supported.
             The EdDSA algorithm as specified in
             draft-ietf-tls-rfc4492bis-17 SHOULD be supported.
             Support for the DSA algorithm is not recommended.
             Support for the RSA algorithm is a MAY.";
        }

        leaf pinned-domain-pubk-sha256 {
          type binary;
          description
            "The pinned-domain-pubk-sha256 is a second
             alternative to pinned-domain-cert.  In many cases the
             public key of the domain has already been transmitted
             during the key agreement process, and it is wasteful
             to transmit the public key another two times.
             The use of a hash of public key info, at 32-bytes for
             sha256 is a significant savings compared to an RSA
             public key, but is only a minor savings compared to
             a 256-bit ECDSA public-key.
             Algorithm agility is provided by extensions to this
             specification which can define a new leaf for another
             hash type.";
        }
      }
    }
  }
}

&lt;CODE ENDS&gt;</pre><a href="#section-8.2.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="example1">
<section id="section-8.2.4">
          <h4 id="name-example-voucher-artifacts">
<a href="#section-8.2.4" class="section-number selfRef">8.2.4. </a><a href="#name-example-voucher-artifacts" class="section-name selfRef">Example voucher artifacts</a>
          </h4>
<p id="section-8.2.4-1">Below the CBOR serialization of an example constrained voucher is shown in CBOR diagnostic notation.
The enum value of the assertion field is calculated to be zero by following the algorithm described in section 9.6.4.2 of <span>[<a href="#RFC7950" class="xref">RFC7950</a>]</span>.
Four dots ("....") in a CBOR byte string denotes a sequence of bytes that are not shown for brevity.<a href="#section-8.2.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.2.4-2">
<pre>
{
  2451: {
    +2 : "2016-10-07T19:31:42Z", / SID = 2453, created-on /
    +4 : "2016-10-21T19:31:42Z", / SID = 2455, expires-on /
    +1 : 0,                      / SID = 2452, assertion "verified" /
    +11: "JADA123456789",        / SID = 2462, serial-number /
    +5 : h'E40393B4....68A3',    / SID = 2456, idevid-issuer /
    +8 : h'30820275....C35F',    / SID = 2459, pinned-domain-cert/
    +3 : true,                   / SID = 2454, domain-cert /
                                 /               -revocation-checks /
    +6 : "2017-10-07T19:31:42Z"  / SID = 2457, last-renewal-date /
  }
}



&lt;CODE ENDS&gt;
</pre><a href="#section-8.2.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="signing-voucher-and-voucher-request-artifacts-with-cose">
<section id="section-8.3">
        <h3 id="name-signing-voucher-and-voucher">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-signing-voucher-and-voucher" class="section-name selfRef">Signing voucher and voucher-request artifacts with COSE</a>
        </h3>
<p id="section-8.3-1">The COSE-Sign1 structure is discussed in section 4.2 of <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>.
The CBOR object that carries the body, the signature, and the information about the body  and signature is called the COSE_Sign1 structure.
It is used when only one signature is used on the body.
Support for ECDSA with sha256 (secp256k1 and prime256v1 curves) is REQUIRED.
Support for EdDSA is encouraged. [TBD EDNOTE: Expand and add a reference why. ]<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">An example of the supported COSE-sign1 object structure is shown in <a href="#fig-cose" class="xref">Figure 3</a>.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<span id="name-cose-sign1-example-in-cbor-"></span><div id="fig-cose">
<figure id="figure-3">
          <div class="artwork art-text alignLeft" id="section-8.3-3.1">
<pre>
COSE_Sign1(
  [
    h'A101382E',        # { "alg": ES256K }
    {
      "kid" : h'7890....1234'  # hash256(public key)
    },
    h'1234....5678', #voucher-request binary content
    h'4567....1234', #voucher-request binary public signature
  ]
)
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-cose-sign1-example-in-cbor-" class="selfRef">cose-sign1 example in CBOR diagnostic notation</a>
          </figcaption></figure>
</div>
<p id="section-8.3-4">The <span>[<a href="#COSE-registry" class="xref">COSE-registry</a>]</span> specifies the integers that replace the strings and the mnemonics in <a href="#fig-cose" class="xref">Figure 3</a>.
The value of the key identifier "kid" parameter is an example value.
Usually a hash of the public key is used to identify the public key. The choice of key identifier method is
vendor-specific.
The public key and its hash are derived from the relevant certificate (Pledge, Registrar or MASA certificate).
[TBD EDNOTE: how can MASA know which kid method the Registrar has used/supports? Does it matter?]<a href="#section-8.3-4" class="pilcrow">¶</a></p>
<p id="section-8.3-5">In <a href="#cosesign" class="xref">Appendix C</a> a binary cose-sign1 object is shown based on the voucher-request example of <a href="#example2" class="xref">Section 8.1.4</a>.<a href="#section-8.3-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="design-considerations">
<section id="section-9">
      <h2 id="name-design-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-design-considerations" class="section-name selfRef">Design Considerations</a>
      </h2>
<p id="section-9-1">The design considerations for the CBOR encoding of vouchers are much the same as for JSON vouchers in <span>[<a href="#RFC8366" class="xref">RFC8366</a>]</span>.
One key difference is that the names of the leaves in the YANG definition do not affect the size of the resulting CBOR, as the SID translation process assigns integers to the names.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">Any POST request to the Registrar with resource /vs or /es returns a 2.04 Changed response with empty payload. The client should be aware that the server may use a piggybacked CoAP response (ACK, 2.04) but may also respond with a separate CoAP response, i.e. first an (ACK, 0.0) that is an acknowledgement of the request reception followed by a (CON, 2.04) response in a separate CoAP message.<a href="#section-9-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rpk-considerations">
<section id="section-10">
      <h2 id="name-raw-public-key-use-consider">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-raw-public-key-use-consider" class="section-name selfRef">Raw Public Key Use Considerations</a>
      </h2>
<p id="section-10-1">This section explains techniques to reduce the number of bytes that are sent over the wire during the BRSKI bootstrap.
The use of a raw public key (RPK) in the pinning process can significantly reduce the number of bytes and round trips, but it comes with a few significant operational limitations.<a href="#section-10-1" class="pilcrow">¶</a></p>
<div id="the-registrar-trust-anchor">
<section id="section-10.1">
        <h3 id="name-the-registrar-trust-anchor">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-the-registrar-trust-anchor" class="section-name selfRef">The Registrar Trust Anchor</a>
        </h3>
<p id="section-10.1-1">When the Pledge first connects to the Registrar, the connection to the Registrar is provisional, as explained in section 5.6.2 of <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span>.
The Registrar provides its public key in a TLSServerCertificate, and the Pledge uses that to validate that integrity of the (D)TLS connection, but it does not validate the identity of
the provided certificate.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<p id="section-10.1-2">As the TLSServerCertificate object is never verified directly by the pledge, sending it can be considered superfluous.
Instead of using a (TLSServer)Certificate of type X509 (see section 4.4.2 of <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>),
a RawPublicKey object is used.<a href="#section-10.1-2" class="pilcrow">¶</a></p>
<p id="section-10.1-3">A Registrar operating in a mixed environment can determine whether to send a Certificate or a Raw Public key: this is determined by the pledge including the server_certificate_type of RawPublicKey.
This is shown in section 5 of <span>[<a href="#RFC7250" class="xref">RFC7250</a>]</span>.<a href="#section-10.1-3" class="pilcrow">¶</a></p>
<p id="section-10.1-4">The Pledge continues to send a client_certificate_type of X509, so that the Registrar can properly identify the pledge and distill the MASA URI information from its certificate.<a href="#section-10.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="the-pledge-voucher-request">
<section id="section-10.2">
        <h3 id="name-the-pledge-voucher-request">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-the-pledge-voucher-request" class="section-name selfRef">The Pledge Voucher Request</a>
        </h3>
<p id="section-10.2-1">The Pledge puts the Registrar's public key into the proximity-registrar-pubk
field of the voucher-request.
(The proximity-registrar-pubk-sha256 can also be used if the 32-bytes of a SHA256 hash turns out to be smaller than a typical ECDSA key.)<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<p id="section-10.2-2">As the format of the pubk field is identical to the TLS Certificate RawPublicKey, no manipulation at all is needed to insert this into a voucher-request.<a href="#section-10.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="the-voucher-response">
<section id="section-10.3">
        <h3 id="name-the-voucher-response">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-the-voucher-response" class="section-name selfRef">The Voucher Response</a>
        </h3>
<p id="section-10.3-1">A returned voucher will have a pinned-domain-subk field with the identical key as was found in the proximity-registrar-pubk field above, as well as in the TLS connection.
Validation of this key by the pledge is what takes the DTLS connection out of the provisional state (see <span>[<a href="#BRSKI" class="xref">BRSKI</a>]</span> section 5.6.2).<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<p id="section-10.3-2">The voucher needs to be validated first.
The Pledge needs to have a public key to validate the signature from the MASA on the voucher.<a href="#section-10.3-2" class="pilcrow">¶</a></p>
<p id="section-10.3-3">In certain cases, the MASA's public key counterpart of the (private) signing key is already installed in the Pledge at manufacturing time.
In other cases, if the MASA signing key is based upon a PKI (see <span>[<a href="#I-D.richardson-anima-masa-considerations" class="xref">I-D.richardson-anima-masa-considerations</a>]</span> Section 2.3), then a certificate chain may need to be included with the voucher in order for the pledge to validate the signature.
In CMS signed artifacts, the CMS structure has a place for such certificates.
In the COSE-signed Constrained Vouchers described in this document, the x5bag attribute from <span>[<a href="#I-D.ietf-cose-x509" class="xref">I-D.ietf-cose-x509</a>]</span> is to be used for this.<a href="#section-10.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-11">
      <h2 id="name-security-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="clock-sensitivity">
<section id="section-11.1">
        <h3 id="name-clock-sensitivity">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-clock-sensitivity" class="section-name selfRef">Clock Sensitivity</a>
        </h3>
<p id="section-11.1-1">TBD.<a href="#section-11.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="protect-voucher-pki-in-hsm">
<section id="section-11.2">
        <h3 id="name-protect-voucher-pki-in-hsm">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-protect-voucher-pki-in-hsm" class="section-name selfRef">Protect Voucher PKI in HSM</a>
        </h3>
<p id="section-11.2-1">TBD.<a href="#section-11.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="test-domain-certificate-validity-when-signing">
<section id="section-11.3">
        <h3 id="name-test-domain-certificate-val">
<a href="#section-11.3" class="section-number selfRef">11.3. </a><a href="#name-test-domain-certificate-val" class="section-name selfRef">Test Domain Certificate Validity when Signing</a>
        </h3>
<p id="section-11.3-1">TBD.<a href="#section-11.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-12">
      <h2 id="name-iana-considerations">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="resource-type-registry">
<section id="section-12.1">
        <h3 id="name-resource-type-registry">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-resource-type-registry" class="section-name selfRef">Resource Type Registry</a>
        </h3>
<p id="section-12.1-1">Additions to the sub-registry "Resource Type Link Target Attribute Values", within the "CoRE parameters" IANA registry are specified below.<a href="#section-12.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-12.1-2">
<pre>
 brski    needs registration with IANA
 brski.rv needs registration with IANA
 brski.vs needs registration with IANA
 brski.es needs registration with IANA
</pre><a href="#section-12.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="the-ietf-xml-registry">
<section id="section-12.2">
        <h3 id="name-the-ietf-xml-registry">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-the-ietf-xml-registry" class="section-name selfRef">The IETF XML Registry</a>
        </h3>
<p id="section-12.2-1">This document registers two URIs in the IETF XML registry <span>[<a href="#RFC3688" class="xref">RFC3688</a>]</span>.
Following the format in <span>[<a href="#RFC3688" class="xref">RFC3688</a>]</span>, the following registration is requested:<a href="#section-12.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-12.2-2">
<pre>
  URI: urn:ietf:params:xml:ns:yang:ietf-constrained-voucher
  Registrant Contact: The ANIMA WG of the IETF.
  XML: N/A, the requested URI is an XML namespace.

  URI: urn:ietf:params:xml:ns:yang:ietf-constrained-voucher-request
  Registrant Contact: The ANIMA WG of the IETF.
  XML: N/A, the requested URI is an XML namespace.
</pre><a href="#section-12.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="the-yang-module-names-registry">
<section id="section-12.3">
        <h3 id="name-the-yang-module-names-regis">
<a href="#section-12.3" class="section-number selfRef">12.3. </a><a href="#name-the-yang-module-names-regis" class="section-name selfRef">The YANG Module Names Registry</a>
        </h3>
<p id="section-12.3-1">This document registers two YANG modules in the YANG Module Names registry <span>[<a href="#RFC6020" class="xref">RFC6020</a>]</span>.  Following the format defined in <span>[<a href="#RFC6020" class="xref">RFC6020</a>]</span>, the the following registration is requested:<a href="#section-12.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-12.3-2">
<pre>
  name:         ietf-constrained-voucher
  namespace:    urn:ietf:params:xml:ns:yang:ietf-constrained-voucher
  prefix:       vch
  reference:    RFC XXXX

  name:         ietf-constrained-voucher-request
  namespace:    urn:ietf:params:xml:ns:yang:ietf-constrained
                                           -voucher-request
  prefix:       vch
  reference:    RFC XXXX
</pre><a href="#section-12.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="the-rfc-sid-range-assignment-sub-registry">
<section id="section-12.4">
        <h3 id="name-the-rfc-sid-range-assignmen">
<a href="#section-12.4" class="section-number selfRef">12.4. </a><a href="#name-the-rfc-sid-range-assignmen" class="section-name selfRef">The RFC SID range assignment sub-registry</a>
        </h3>
<div class="artwork art-text alignLeft" id="section-12.4-1">
<pre>
------------ ------ --------------------------- ------------
Entry-point | Size | Module name               | RFC Number
------------ ------ --------------------------- ------------
2450          50     ietf-constrained-voucher    [ThisRFC]
2500          50     ietf-constrained-voucher    [ThisRFC}
                                 -request
----------- ------  --------------------------- ------------
</pre><a href="#section-12.4-1" class="pilcrow">¶</a>
</div>
<p id="section-12.4-2">Warning: These SID values are defined in <span>[<a href="#I-D.ietf-core-sid" class="xref">I-D.ietf-core-sid</a>]</span>, not as an Early Allocation.<a href="#section-12.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="media-types-registry">
<section id="section-12.5">
        <h3 id="name-media-types-registry">
<a href="#section-12.5" class="section-number selfRef">12.5. </a><a href="#name-media-types-registry" class="section-name selfRef">Media Types Registry</a>
        </h3>
<p id="section-12.5-1">This section registers the 'application/voucher-cose+cbor' in the IANA "Media Types" registry.
This media type is used to indicate that the content is a CBOR voucher or voucher request
signed with a COSE_Sign1 structure <span>[<a href="#I-D.ietf-cose-rfc8152bis-struct" class="xref">I-D.ietf-cose-rfc8152bis-struct</a>]</span>.<a href="#section-12.5-1" class="pilcrow">¶</a></p>
<div id="applicationvoucher-cosecbor">
<section id="section-12.5.1">
          <h4 id="name-application-voucher-cosecbo">
<a href="#section-12.5.1" class="section-number selfRef">12.5.1. </a><a href="#name-application-voucher-cosecbo" class="section-name selfRef">application/voucher-cose+cbor</a>
          </h4>
<div class="artwork art-text alignLeft" id="section-12.5.1-1">
<pre>
Type name:  application
Subtype name:  voucher-cose+cbor
Required parameters:  none
Optional parameters:  none
Encoding considerations:  binary
Security considerations:  Security Considerations of THIS RFC.
Interoperability considerations:  The format is designed to be
  broadly interoperable.
Published specification:  THIS RFC.
Applications that use this media type:  ANIMA, 6tisch, and other
  zero-touch onboarding systems
Additional information:
  Magic number(s):  None
  File extension(s):  .vch
  Macintosh file type code(s):  none
Person &amp; email address to contact for further information:  IETF
  ANIMA WG
Intended usage:  LIMITED
Restrictions on usage:  NONE
Author:  ANIMA WG
Change controller:  IETF
Provisional registration? (standards tree only):  NO
</pre><a href="#section-12.5.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="coap-content-format-registry">
<section id="section-12.6">
        <h3 id="name-coap-content-format-registr">
<a href="#section-12.6" class="section-number selfRef">12.6. </a><a href="#name-coap-content-format-registr" class="section-name selfRef">CoAP Content-Format Registry</a>
        </h3>
<p id="section-12.6-1">Additions to the sub-registry "CoAP Content-Formats", within the "CoRE
Parameters" registry are needed for two media types. These can be registered
either in the Expert Review range (0-255) or IETF Review range (256-9999).<a href="#section-12.6-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-12.6-2">
<pre>
Media type                    Encoding   ID  References
----------------------------  --------- ---- ----------
application/voucher-cose+cbor           TBD3 [This RFC]
</pre><a href="#section-12.6-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="acknowledgements">
<section id="section-13">
      <h2 id="name-acknowledgements">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-13-1">We are very grateful to Jim Schaad for explaining COSE and CMS choices.
Also thanks to Jim Schaad for correcting earlier version of the COSE Sign1 objects.<a href="#section-13-1" class="pilcrow">¶</a></p>
<p id="section-13-2">Michel Veillette did extensive work on <em>pyang</em> to extend it to support the SID allocation process, and this document was among its first users.<a href="#section-13-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="changelog">
<section id="section-14">
      <h2 id="name-changelog">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-changelog" class="section-name selfRef">Changelog</a>
      </h2>
<p id="section-14-1">-10
    Design considerations extended
    Examples made consistent<a href="#section-14-1" class="pilcrow">¶</a></p>
<p id="section-14-2">-08
    Examples for cose_sign1 are completed and improved.<a href="#section-14-2" class="pilcrow">¶</a></p>
<p id="section-14-3">-06
    New SID values assigned; regenerated examples<a href="#section-14-3" class="pilcrow">¶</a></p>
<p id="section-14-4">-04
    voucher and request-voucher MUST be signed
    examples for signed request are added in appendix
    IANA SID registration is updated
    SID values in examples are aligned
    signed cms examples aligned with new SIDs<a href="#section-14-4" class="pilcrow">¶</a></p>
<p id="section-14-5">-03<a href="#section-14-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-14-6">
<pre>
Examples are inverted.
</pre><a href="#section-14-6" class="pilcrow">¶</a>
</div>
<p id="section-14-7">-02<a href="#section-14-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-14-8">
<pre>
Example of requestvoucher with unsigned appllication/cbor is added
attributes of voucher "refined" to optional
CBOR serialization of vouchers improved
Discovery port numbers are specified
</pre><a href="#section-14-8" class="pilcrow">¶</a>
</div>
<p id="section-14-9">-01<a href="#section-14-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-14-10">
<pre>
application/json is optional, application/cbor is compulsory
Cms and cose mediatypes are introduced
</pre><a href="#section-14-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<section id="section-15">
      <h2 id="name-references">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-15.1">
        <h3 id="name-normative-references">
<a href="#section-15.1" class="section-number selfRef">15.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="BRSKI">[BRSKI]</dt>
        <dd>
<span class="refAuthor">Pritikin, M.</span>, <span class="refAuthor">Richardson, M.</span>, <span class="refAuthor">Eckert, T.</span>, <span class="refAuthor">Behringer, M.</span>, and <span class="refAuthor">K. Watsen</span>, <span class="refTitle">"Bootstrapping Remote Secure Key Infrastructure (BRSKI)"</span>, <span class="seriesInfo">RFC 8995</span>, <span class="seriesInfo">DOI 10.17487/RFC8995</span>, <time datetime="2021-05" class="refDate">May 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8995">https://www.rfc-editor.org/info/rfc8995</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-6tisch-minimal-security">[I-D.ietf-6tisch-minimal-security]</dt>
        <dd>
<span class="refAuthor">Vucinic, M.</span>, <span class="refAuthor">Simon, J.</span>, <span class="refAuthor">Pister, K.</span>, and <span class="refAuthor">M. Richardson</span>, <span class="refTitle">"Constrained Join Protocol (CoJP) for 6TiSCH"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-6tisch-minimal-security-15</span>, <time datetime="2019-12-10" class="refDate">10 December 2019</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-6tisch-minimal-security-15.txt">https://www.ietf.org/archive/id/draft-ietf-6tisch-minimal-security-15.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-coap-est">[I-D.ietf-ace-coap-est]</dt>
        <dd>
<span class="refAuthor">Stok, P. V. D.</span>, <span class="refAuthor">Kampanakis, P.</span>, <span class="refAuthor">Richardson, M. C.</span>, and <span class="refAuthor">S. Raza</span>, <span class="refTitle">"EST over secure CoAP (EST-coaps)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-coap-est-18</span>, <time datetime="2020-01-06" class="refDate">6 January 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-ace-coap-est-18.txt">https://www.ietf.org/archive/id/draft-ietf-ace-coap-est-18.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-sid">[I-D.ietf-core-sid]</dt>
        <dd>
<span class="refAuthor">Veillette, M.</span>, <span class="refAuthor">Pelov, A.</span>, <span class="refAuthor">Petrov, I.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"YANG Schema Item iDentifier (YANG SID)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-sid-16</span>, <time datetime="2021-06-24" class="refDate">24 June 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-core-sid-16.txt">https://www.ietf.org/archive/id/draft-ietf-core-sid-16.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-yang-cbor">[I-D.ietf-core-yang-cbor]</dt>
        <dd>
<span class="refAuthor">Veillette, M.</span>, <span class="refAuthor">Petrov, I.</span>, <span class="refAuthor">Pelov, A.</span>, and <span class="refAuthor">C. Bormann</span>, <span class="refTitle">"CBOR Encoding of Data Modeled with YANG"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-yang-cbor-16</span>, <time datetime="2021-06-24" class="refDate">24 June 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-core-yang-cbor-16.txt">https://www.ietf.org/archive/id/draft-ietf-core-yang-cbor-16.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-rfc8152bis-struct">[I-D.ietf-cose-rfc8152bis-struct]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Structures and Process"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-rfc8152bis-struct-15</span>, <time datetime="2021-02-01" class="refDate">1 February 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-cose-rfc8152bis-struct-15.txt">https://www.ietf.org/archive/id/draft-ietf-cose-rfc8152bis-struct-15.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-cose-x509">[I-D.ietf-cose-x509]</dt>
        <dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE): Header parameters for carrying and referencing X.509 certificates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-cose-x509-08</span>, <time datetime="2020-12-14" class="refDate">14 December 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-cose-x509-08.txt">https://www.ietf.org/archive/id/draft-ietf-cose-x509-08.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.selander-ace-ake-authz">[I-D.selander-ace-ake-authz]</dt>
        <dd>
<span class="refAuthor">Selander, G.</span>, <span class="refAuthor">Mattsson, J. P.</span>, <span class="refAuthor">Vucinic, M.</span>, <span class="refAuthor">Richardson, M.</span>, and <span class="refAuthor">A. Schellenbaum</span>, <span class="refTitle">"Lightweight Authorization for Authenticated Key Exchange."</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-selander-ace-ake-authz-03</span>, <time datetime="2021-05-04" class="refDate">4 May 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-selander-ace-ake-authz-03.txt">https://www.ietf.org/archive/id/draft-selander-ace-ake-authz-03.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ieee802-1AR">[ieee802-1AR]</dt>
        <dd>
<span class="refAuthor">IEEE Standard, .</span>, <span class="refTitle">"IEEE 802.1AR Secure Device Identifier"</span>, <time datetime="2009" class="refDate">2009</time>, <span>&lt;<a href="http://standards.ieee.org/findstds/standard/802.1AR-2009.html">http://standards.ieee.org/findstds/standard/802.1AR-2009.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3688">[RFC3688]</dt>
        <dd>
<span class="refAuthor">Mealling, M.</span>, <span class="refTitle">"The IETF XML Registry"</span>, <span class="seriesInfo">BCP 81</span>, <span class="seriesInfo">RFC 3688</span>, <span class="seriesInfo">DOI 10.17487/RFC3688</span>, <time datetime="2004-01" class="refDate">January 2004</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3688">https://www.rfc-editor.org/info/rfc3688</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5652">[RFC5652]</dt>
        <dd>
<span class="refAuthor">Housley, R.</span>, <span class="refTitle">"Cryptographic Message Syntax (CMS)"</span>, <span class="seriesInfo">STD 70</span>, <span class="seriesInfo">RFC 5652</span>, <span class="seriesInfo">DOI 10.17487/RFC5652</span>, <time datetime="2009-09" class="refDate">September 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5652">https://www.rfc-editor.org/info/rfc5652</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6020">[RFC6020]</dt>
        <dd>
<span class="refAuthor">Bjorklund, M., Ed.</span>, <span class="refTitle">"YANG - A Data Modeling Language for the Network Configuration Protocol (NETCONF)"</span>, <span class="seriesInfo">RFC 6020</span>, <span class="seriesInfo">DOI 10.17487/RFC6020</span>, <time datetime="2010-10" class="refDate">October 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6020">https://www.rfc-editor.org/info/rfc6020</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7049">[RFC7049]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span> and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Concise Binary Object Representation (CBOR)"</span>, <span class="seriesInfo">RFC 7049</span>, <span class="seriesInfo">DOI 10.17487/RFC7049</span>, <time datetime="2013-10" class="refDate">October 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7049">https://www.rfc-editor.org/info/rfc7049</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7250">[RFC7250]</dt>
        <dd>
<span class="refAuthor">Wouters, P., Ed.</span>, <span class="refAuthor">Tschofenig, H., Ed.</span>, <span class="refAuthor">Gilmore, J.</span>, <span class="refAuthor">Weiler, S.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Using Raw Public Keys in Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)"</span>, <span class="seriesInfo">RFC 7250</span>, <span class="seriesInfo">DOI 10.17487/RFC7250</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7250">https://www.rfc-editor.org/info/rfc7250</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7950">[RFC7950]</dt>
        <dd>
<span class="refAuthor">Bjorklund, M., Ed.</span>, <span class="refTitle">"The YANG 1.1 Data Modeling Language"</span>, <span class="seriesInfo">RFC 7950</span>, <span class="seriesInfo">DOI 10.17487/RFC7950</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7950">https://www.rfc-editor.org/info/rfc7950</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8366">[RFC8366]</dt>
        <dd>
<span class="refAuthor">Watsen, K.</span>, <span class="refAuthor">Richardson, M.</span>, <span class="refAuthor">Pritikin, M.</span>, and <span class="refAuthor">T. Eckert</span>, <span class="refTitle">"A Voucher Artifact for Bootstrapping Protocols"</span>, <span class="seriesInfo">RFC 8366</span>, <span class="seriesInfo">DOI 10.17487/RFC8366</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8366">https://www.rfc-editor.org/info/rfc8366</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-15.2">
        <h3 id="name-informative-references">
<a href="#section-15.2" class="section-number selfRef">15.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="COSE-registry">[COSE-registry]</dt>
        <dd>
<span class="refAuthor">IANA, .</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE) registry"</span>, <time datetime="2017" class="refDate">2017</time>, <span>&lt;<a href="https://www.iana.org/assignments/cose/cose.xhtml">https://www.iana.org/assignments/cose/cose.xhtml</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-netmod-yang-tree-diagrams">[I-D.ietf-netmod-yang-tree-diagrams]</dt>
        <dd>
<span class="refAuthor">Bjorklund, M.</span> and <span class="refAuthor">L. Berger</span>, <span class="refTitle">"YANG Tree Diagrams"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-netmod-yang-tree-diagrams-06</span>, <time datetime="2018-02-08" class="refDate">8 February 2018</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-netmod-yang-tree-diagrams-06.txt">https://www.ietf.org/archive/id/draft-ietf-netmod-yang-tree-diagrams-06.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.richardson-anima-masa-considerations">[I-D.richardson-anima-masa-considerations]</dt>
        <dd>
<span class="refAuthor">Richardson, M.</span> and <span class="refAuthor">J. Yang</span>, <span class="refTitle">"Operatonal Considerations for Voucher infrastructure for BRSKI MASA"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-richardson-anima-masa-considerations-05</span>, <time datetime="2021-03-12" class="refDate">12 March 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-richardson-anima-masa-considerations-05.txt">https://www.ietf.org/archive/id/draft-richardson-anima-masa-considerations-05.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6690">[RFC6690]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refTitle">"Constrained RESTful Environments (CoRE) Link Format"</span>, <span class="seriesInfo">RFC 6690</span>, <span class="seriesInfo">DOI 10.17487/RFC6690</span>, <time datetime="2012-08" class="refDate">August 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6690">https://www.rfc-editor.org/info/rfc6690</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7030">[RFC7030]</dt>
      <dd>
<span class="refAuthor">Pritikin, M., Ed.</span>, <span class="refAuthor">Yee, P., Ed.</span>, and <span class="refAuthor">D. Harkins, Ed.</span>, <span class="refTitle">"Enrollment over Secure Transport"</span>, <span class="seriesInfo">RFC 7030</span>, <span class="seriesInfo">DOI 10.17487/RFC7030</span>, <time datetime="2013-10" class="refDate">October 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7030">https://www.rfc-editor.org/info/rfc7030</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="libsup">
<section id="appendix-A">
      <h2 id="name-library-support-for-brski">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-library-support-for-brski" class="section-name selfRef">Library support for BRSKI</a>
      </h2>
<p id="appendix-A-1">For the implementation of BRSKI, the use of a software library to manipulate certificates and use crypto algorithms is often beneficial. Two C-based examples are OPENSSL and mbedtls. Others more targeted to specific platforms or languages exist. It is important to realize that the library interfaces differ significantly between libraries.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">Libraries do not support all known crypto algorithms. Before deciding on a library, it is important to look at their supported crypto algorithms and the roadmap for future support. Apart from availability, the library footprint, and the required execution cycles should be investigated beforehand.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">The handling of certificates usually includes the checking of a certificate chain. In some libraries, chains are constructed and verified on the basis of a set of certificates, the trust anchor (usually self signed root CA), and the target certificate. In other libraries, the chain must be constructed beforehand and obey order criteria. Verification always includes the checking of the signatures. Less frequent is the checking the validity of the dates or checking the existence of a revoked certificate in the chain against a set of revoked certificates. Checking the chain on the consistency of the certificate extensions which specify the use of the certificate usually needs to be programmed explicitly.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<p id="appendix-A-4">A libary can be used to construct a (D)TLS connection. It is useful to realize that differences beetween (D)TLS implementations will occur due to the differences in the certicate checks supported by the library. On top of that, checks between client and server certificates enforced by (D)TLS are not always helpful for a BRSKI implementation. For example, the certificates of Pledge and Registrar are usually not related when the BRSKI protocol is started. It must be verified that checks on the relation between client and server certificates do not hamper a succeful DTLS connection establishment.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<div id="opensssl">
<section id="appendix-A.1">
        <h3 id="name-opensssl">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-opensssl" class="section-name selfRef">OpensSSL</a>
        </h3>
<p id="appendix-A.1-1">from openssl's apps/verify.c<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-A.1-2">
<pre>
    X509 *x = NULL;
    int i = 0, ret = 0;
    X509_STORE_CTX *csc;
    STACK_OF(X509) *chain = NULL;
    int num_untrusted;

    x = load_cert(file, "certificate file");
    if (x == NULL)
        goto end;

    csc = X509_STORE_CTX_new();
    if (csc == NULL) {
        BIO_printf(bio_err, "error %s: X.509 store context"
                   "allocation failed\n",
                   (file == NULL) ? "stdin" : file);
        goto end;
    }

    X509_STORE_set_flags(ctx, vflags);
    if (!X509_STORE_CTX_init(csc, ctx, x, uchain)) {
        X509_STORE_CTX_free(csc);
        BIO_printf(bio_err,
                   "error %s: X.509 store context"
                   "initialization failed\n",
                   (file == NULL) ? "stdin" : file);
        goto end;
    }
    if (tchain != NULL)
        X509_STORE_CTX_set0_trusted_stack(csc, tchain);
    if (crls != NULL)
        X509_STORE_CTX_set0_crls(csc, crls);

    i = X509_verify_cert(csc);
    X509_STORE_CTX_free(csc);
&lt;CODE ENDS&gt;
</pre><a href="#appendix-A.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="mbedtls">
<section id="appendix-A.2">
        <h3 id="name-mbedtls">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-mbedtls" class="section-name selfRef">mbedTLS</a>
        </h3>
<div class="artwork art-text alignLeft" id="appendix-A.2-1">
<pre>
    mbedtls_x509_crt cert;
    mbedtls_x509_crt caCert;
    uint32_t         certVerifyResultFlags;
    ...
    int result = mbedtls_x509_crt_verify(&amp;cert, &amp;caCert, NULL, NULL,
                                 &amp;certVerifyResultFlags, NULL, NULL);
</pre><a href="#appendix-A.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="wolfssl">
<section id="appendix-A.3">
        <h3 id="name-wolfssl">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-wolfssl" class="section-name selfRef">wolfSSL</a>
        </h3>
<p id="appendix-A.3-1">To be added (TBD).<a href="#appendix-A.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="constrained-brski-est-messages">
<section id="appendix-B">
      <h2 id="name-constrained-brski-est-messa">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-constrained-brski-est-messa" class="section-name selfRef">Constrained BRSKI-EST messages</a>
      </h2>
<p id="appendix-B-1">This section extends the examples from Appendix A of <span>[<a href="#I-D.ietf-ace-coap-est" class="xref">I-D.ietf-ace-coap-est</a>]</span> with the constrained BRSKI requests. The CoAP headers are only worked out for the enrollstatus example.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<div id="es">
<section id="appendix-B.1">
        <h3 id="name-enrollstatus">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-enrollstatus" class="section-name selfRef">enrollstatus</a>
        </h3>
<p id="appendix-B.1-1">A coaps enrollstatus message can be :<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-B.1-2">
<pre>
    POST coaps://192.0.2.1:8085/b/es
</pre><a href="#appendix-B.1-2" class="pilcrow">¶</a>
</div>
<p id="appendix-B.1-3">The corresponding CoAP header fields are shown below.<a href="#appendix-B.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-B.1-4">
<pre>
  Ver = 1
  T = 0 (CON)
  Code = 0x02 (0.02 is POST)
  Options
   Option  (Uri-Path)
     Option Delta = 0xb   (option nr = 11)
     Option Length = 0x1
     Option Value = "b"
   Option  (Uri-Path)
     Option Delta = 0x0   (option nr = 11)
     Option Length = 0x2
     Option Value = "es"
   Option  (Content-Format)
     Option Delta = 0x1   (option nr = 12)
     Option Length = 0x1
     Option Value = 60    (application/cbor)
  Payload Marker = 0xFF
  Payload = &lt;binary CBOR enrollstatus document&gt;
</pre><a href="#appendix-B.1-4" class="pilcrow">¶</a>
</div>
<p id="appendix-B.1-5">The Uri-Host and Uri-Port Options are omitted because they coincide with the transport protocol destination address and port respectively.
TBD - Show the binary CBOR payload of this example.<a href="#appendix-B.1-5" class="pilcrow">¶</a></p>
<p id="appendix-B.1-6">A 2.04 Changed response from the Registrar will then be:<a href="#appendix-B.1-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-B.1-7">
<pre>
   2.04 Changed
</pre><a href="#appendix-B.1-7" class="pilcrow">¶</a>
</div>
<p id="appendix-B.1-8">With CoAP fields:<a href="#appendix-B.1-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-B.1-9">
<pre>
   Ver=1
   T=2 (ACK)
   Code = 0x44 (2.04 Changed)
</pre><a href="#appendix-B.1-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="voucherstatus">
<section id="appendix-B.2">
        <h3 id="name-voucher_status">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-voucher_status" class="section-name selfRef">voucher_status</a>
        </h3>
<p id="appendix-B.2-1">A coaps voucher_status message can be:<a href="#appendix-B.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-B.2-2">
<pre>
   POST coaps://[2001:db8::2:1]:61616/b/vs
     Content-Format: 60 (application/cbor)
     Payload =
a46776657273696f6e0166737461747573f466726561736f6e7828496e66
6f726d61746976652068756d616e2d7265616461626c65206572726f7220
6d6573736167656e726561736f6e2d636f6e74657874a100764164646974
696f6e616c20696e666f726d6174696f6e
&lt;CODE ENDS&gt;
</pre><a href="#appendix-B.2-2" class="pilcrow">¶</a>
</div>
<p id="appendix-B.2-3">The request payload above is binary CBOR but represented here in hexadecimal for readability. Below is the equivalent CBOR diagnostic format.<a href="#appendix-B.2-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-B.2-4">
<pre>
{"version": 1, "status": false,
"reason": "Informative human-readable error message",
"reason-context": { 0: "Additional information" } }

&lt;CODE ENDS&gt;
</pre><a href="#appendix-B.2-4" class="pilcrow">¶</a>
</div>
<p id="appendix-B.2-5">A 2.04 Changed response without payload will then be sent by the Registrar back to the Pledge.<a href="#appendix-B.2-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-B.2-6">
<pre>
   2.04 Changed
</pre><a href="#appendix-B.2-6" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="cosesign">
<section id="appendix-C">
      <h2 id="name-cose-examples">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-cose-examples" class="section-name selfRef">COSE examples</a>
      </h2>
<p id="appendix-C-1">These examples are generated on a Pi 4 and a PC running BASH. Keys and Certificates have been generated with openssl with the following shell script:<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C-2">
<pre>
#!/bin/bash
#try-cert.sh
export dir=./brski/intermediate
export cadir=./brski
export cnfdir=./conf
export format=pem
export default_crl_days=30
sn=8

DevID=pledge.1.2.3.4
serialNumber="serialNumber=$DevID"
export hwType=1.3.6.1.4.1.6715.10.1
export hwSerialNum=01020304 # Some hex
export subjectAltName="otherName:1.3.6.1.5.5.7.8.4;SEQ:hmodname"
echo  $hwType - $hwSerialNum
echo $serialNumber
OPENSSL_BIN="openssl"

# remove all files
rm -r ./brski/*
#
# initialize file structure
# root level
cd $cadir
mkdir certs crl csr newcerts private
chmod 700 private
touch index.txt
touch serial
echo 11223344556600 &gt;serial
echo 1000 &gt; crlnumber
# intermediate level
mkdir intermediate
cd intermediate
mkdir certs crl csr newcerts private
chmod 700 private
touch index.txt
echo 11223344556600 &gt;serial
echo 1000 &gt; crlnumber
cd ../..



# file structure is cleaned start filling

echo "#############################"
echo "create registrar keys and certificates "
echo "#############################"


echo "create root registrar certificate using ecdsa with sha 256 key"
$OPENSSL_BIN ecparam -name prime256v1 -genkey \
   -noout -out $cadir/private/ca-regis.key

$OPENSSL_BIN req -new -x509 \
 -config $cnfdir/openssl-regis.cnf \
 -key $cadir/private/ca-regis.key \
 -out $cadir/certs/ca-regis.crt \
 -extensions v3_ca\
 -days 365 \
 -subj "/C=NL/ST=NB/L=Helmond/O=vanderstok/OU=consultancy \
/CN=registrar.stok.nl"

# Combine authority certificate and key
echo "Combine authority certificate and key"
$OPENSSL_BIN pkcs12 -passin pass:watnietweet -passout pass:watnietweet\
   -inkey $cadir/private/ca-regis.key \
   -in $cadir/certs/ca-regis.crt -export \
   -out $cadir/certs/ca-regis-comb.pfx

# converteer authority pkcs12 file to pem
echo "converteer authority pkcs12 file to pem"
$OPENSSL_BIN pkcs12 -passin pass:watnietweet -passout pass:watnietweet\
   -in $cadir/certs/ca-regis-comb.pfx \
   -out $cadir/certs/ca-regis-comb.crt -nodes

#show certificate in registrar combined certificate
$OPENSSL_BIN  x509 -in $cadir/certs/ca-regis-comb.crt -text

#
# Certificate Authority for MASA
#
echo "#############################"
echo "create MASA keys and certificates "
echo "#############################"

echo "create root MASA certificate using ecdsa with sha 256 key"
$OPENSSL_BIN ecparam -name prime256v1 -genkey -noout \
   -out $cadir/private/ca-masa.key

$OPENSSL_BIN req -new -x509 \
 -config $cnfdir/openssl-masa.cnf \
 -days 1000 -key $cadir/private/ca-masa.key \
  -out $cadir/certs/ca-masa.crt \
 -extensions v3_ca\
 -subj "/C=NL/ST=NB/L=Helmond/O=vanderstok/OU=manufacturer\
/CN=masa.stok.nl"

# Combine authority certificate and key
echo "Combine authority certificate and key for masa"
$OPENSSL_BIN pkcs12 -passin pass:watnietweet -passout pass:watnietweet\
   -inkey $cadir/private/ca-masa.key \
   -in $cadir/certs/ca-masa.crt -export \
   -out $cadir/certs/ca-masa-comb.pfx

# converteer authority pkcs12 file to pem for masa
echo "converteer authority pkcs12 file to pem for masa"
$OPENSSL_BIN pkcs12 -passin pass:watnietweet -passout pass:watnietweet\
   -in $cadir/certs/ca-masa-comb.pfx \
   -out $cadir/certs/ca-masa-comb.crt -nodes

#show certificate in pledge combined certificate
$OPENSSL_BIN  x509 -in $cadir/certs/ca-masa-comb.crt -text


#
# Certificate for Pledge derived from MASA certificate
#
echo "#############################"
echo "create pledge keys and certificates "
echo "#############################"


# Pledge derived Certificate

echo "create pledge derived certificate using ecdsa with sha 256 key"
$OPENSSL_BIN ecparam -name prime256v1 -genkey -noout \
   -out $dir/private/pledge.key

echo "create pledge certificate request"
$OPENSSL_BIN req -nodes -new -sha256 \
   -key $dir/private/pledge.key -out $dir/csr/pledge.csr \
  -subj "/C=NL/ST=NB/L=Helmond/O=vanderstok/OU=manufacturing\
 /CN=uuid:$DevID/$serialNumber"

# Sign pledge derived Certificate
echo "sign pledge derived certificate "
$OPENSSL_BIN ca -config $cnfdir/openssl-pledge.cnf \
 -extensions 8021ar_idevid\
 -days 365 -in $dir/csr/pledge.csr \
 -out $dir/certs/pledge.crt

# Add pledge key and pledge certificate to pkcs12 file
echo "Add derived pledge key and derived pledge \
 certificate to pkcs12 file"
$OPENSSL_BIN pkcs12  -passin pass:watnietweet -passout pass:watnietweet\
   -inkey $dir/private/pledge.key \
   -in $dir/certs/pledge.crt -export \
   -out $dir/certs/pledge-comb.pfx

# converteer pledge pkcs12 file to pem
echo "converteer pledge pkcs12 file to pem"
$OPENSSL_BIN pkcs12 -passin pass:watnietweet -passout pass:watnietweet\
   -in $dir/certs/pledge-comb.pfx \
   -out $dir/certs/pledge-comb.crt -nodes

#show certificate in pledge-comb.crt
$OPENSSL_BIN  x509 -in $dir/certs/pledge-comb.crt -text

#show private key in pledge-comb.crt
$OPENSSL_BIN ecparam -name prime256v1\
  -in $dir/certs/pledge-comb.crt -text
&lt;CODE ENDS&gt;
</pre><a href="#appendix-C-2" class="pilcrow">¶</a>
</div>
<p id="appendix-C-3">The xxxx-comb certificates have been generated as required by libcoap for the DTLS connection generation.<a href="#appendix-C-3" class="pilcrow">¶</a></p>
<div id="pledge-registrar-and-masa-keys">
<section id="appendix-C.1">
        <h3 id="name-pledge-registrar-and-masa-k">
<a href="#appendix-C.1" class="section-number selfRef">C.1. </a><a href="#name-pledge-registrar-and-masa-k" class="section-name selfRef">Pledge, Registrar and MASA keys</a>
        </h3>
<p id="appendix-C.1-1">This first section documents the public and private keys used in the
subsequent test vectors below.  These keys come from test code and are not used in any
production system, and should only be used only to validate implementations.<a href="#appendix-C.1-1" class="pilcrow">¶</a></p>
<div id="pledge-private-key">
<section id="appendix-C.1.1">
          <h4 id="name-pledge-private-key">
<a href="#appendix-C.1.1" class="section-number selfRef">C.1.1. </a><a href="#name-pledge-private-key" class="section-name selfRef">Pledge private key</a>
          </h4>
<div class="artwork art-text alignLeft" id="appendix-C.1.1-1">
<pre>
Private-Key: (256 bit)
priv:
    9b:4d:43:b6:a9:e1:7c:04:93:45:c3:13:d9:b5:f0:
    41:a9:6a:9c:45:79:73:b8:62:f1:77:03:3a:fc:c2:
    9c:9a
pub:
    04:d6:b7:6f:74:88:bd:80:ae:5f:28:41:2c:72:02:
    ef:5f:98:b4:81:e1:d9:10:4c:f8:1b:66:d4:3e:5c:
    ea:da:73:e6:a8:38:a9:f1:35:11:85:b6:cd:e2:04:
    10:be:fe:d5:0b:3b:14:69:2e:e1:b0:6a:bc:55:40:
    60:eb:95:5c:54
ASN1 OID: prime256v1
NIST CURVE: P-256
&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.1.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="jrcpriv">
<section id="appendix-C.1.2">
          <h4 id="name-registrar-private-key">
<a href="#appendix-C.1.2" class="section-number selfRef">C.1.2. </a><a href="#name-registrar-private-key" class="section-name selfRef">Registrar private key</a>
          </h4>
<div class="artwork art-text alignLeft" id="appendix-C.1.2-1">
<pre>
Private-Key: (256 bit)
priv:
    81:df:bb:50:a3:45:58:06:b5:56:3b:46:de:f3:e9:
    e9:00:ae:98:13:9e:2f:36:68:81:fc:d9:65:24:fb:
    21:7e
pub:
    04:50:7a:c8:49:1a:8c:69:c7:b5:c3:1d:03:09:ed:
    35:ba:13:f5:88:4c:e6:2b:88:cf:30:18:15:4f:a0:
    59:b0:20:ec:6b:eb:b9:4e:02:b8:93:40:21:89:8d:
    a7:89:c7:11:ce:a7:13:39:f5:0e:34:8e:df:0d:92:
    3e:d0:2d:c7:b7
ASN1 OID: prime256v1
NIST CURVE: P-256
&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.1.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="masapriv">
<section id="appendix-C.1.3">
          <h4 id="name-masa-private-key">
<a href="#appendix-C.1.3" class="section-number selfRef">C.1.3. </a><a href="#name-masa-private-key" class="section-name selfRef">MASA private key</a>
          </h4>
<div class="artwork art-text alignLeft" id="appendix-C.1.3-1">
<pre>
Private-Key: (256 bit)
priv:
    c6:bb:a5:8f:b6:d3:c4:75:28:d8:d3:d9:46:c3:31:
    83:6d:00:0a:9a:38:ce:22:5c:e9:d9:ea:3b:98:32:
    ec:31
pub:
    04:59:80:94:66:14:94:20:30:3c:66:08:85:55:86:
    db:e7:d4:d1:d7:7a:d2:a3:1a:0c:73:6b:01:0d:02:
    12:15:d6:1f:f3:6e:c8:d4:84:60:43:3b:21:c5:83:
    80:1e:fc:e2:37:85:77:97:94:d4:aa:34:b5:b6:c6:
    ed:f3:17:5c:f1
ASN1 OID: prime256v1
NIST CURVE: P-256
&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.1.3-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="pledge-registrar-and-masa-certificates">
<section id="appendix-C.2">
        <h3 id="name-pledge-registrar-and-masa-c">
<a href="#appendix-C.2" class="section-number selfRef">C.2. </a><a href="#name-pledge-registrar-and-masa-c" class="section-name selfRef">Pledge, Registrar and MASA certificates</a>
        </h3>
<p id="appendix-C.2-1">Below the certificates that accompany the keys. The certificate description is followed by the hexadecimal DER of the certificate<a href="#appendix-C.2-1" class="pilcrow">¶</a></p>
<div id="pledge-idevid-certificate">
<section id="appendix-C.2.1">
          <h4 id="name-pledge-idevid-certificate">
<a href="#appendix-C.2.1" class="section-number selfRef">C.2.1. </a><a href="#name-pledge-idevid-certificate" class="section-name selfRef">Pledge IDevID certificate</a>
          </h4>
<div class="artwork art-text alignLeft" id="appendix-C.2.1-1">
<pre>
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 4822678189204992 (0x11223344556600)
        Signature Algorithm: ecdsa-with-SHA256
        Issuer: C=NL, ST=NB, L=Helmond, O=vanderstok, OU=manufacturer,
                                                      CN=masa.stok.nl
        Validity
            Not Before: Dec  9 10:02:36 2020 GMT
            Not After : Dec 31 23:59:59 9999 GMT
        Subject: C=NL, ST=NB, L=Helmond, O=vanderstok, OU=manufacturing,
                   CN=uuid:pledge.1.2.3.4/serialNumber=pledge.1.2.3.4
        Subject Public Key Info:
            Public Key Algorithm: id-ecPublicKey
                Public-Key: (256 bit)
                pub:
                    04:d6:b7:6f:74:88:bd:80:ae:5f:28:41:2c:72:02:
                    ef:5f:98:b4:81:e1:d9:10:4c:f8:1b:66:d4:3e:5c:
                    ea:da:73:e6:a8:38:a9:f1:35:11:85:b6:cd:e2:04:
                    10:be:fe:d5:0b:3b:14:69:2e:e1:b0:6a:bc:55:40:
                    60:eb:95:5c:54
                ASN1 OID: prime256v1
                NIST CURVE: P-256
        X509v3 extensions:
            X509v3 Basic Constraints:
                CA:FALSE
            X509v3 Authority Key Identifier:
                keyid:
      E4:03:93:B4:C3:D3:F4:2A:80:A4:77:18:F6:96:49:03:01:17:68:A3

    Signature Algorithm: ecdsa-with-SHA256
         30:46:02:21:00:d2:e6:45:3b:b0:c3:00:b3:25:8d:f1:83:fe:
         d9:37:c1:a2:49:65:69:7f:6b:b9:ef:2c:05:07:06:31:ac:17:
         bd:02:21:00:e2:ce:9e:7b:7f:74:50:33:ad:9e:ff:12:4e:e9:
         a6:f3:b8:36:65:ab:7d:80:bb:56:88:bc:03:1d:e5:1e:31:6f

&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.2.1-1" class="pilcrow">¶</a>
</div>
<p id="appendix-C.2.1-2">This is the hexadecimal representation in (request-)voucher examples referred to as pledge-cert-hex.<a href="#appendix-C.2.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C.2.1-3">
<pre>
30820226308201cba003020102020711223344556600300a06082a8648ce3d04
0302306f310b3009060355040613024e4c310b300906035504080c024e423110
300e06035504070c0748656c6d6f6e6431133011060355040a0c0a76616e6465
7273746f6b31153013060355040b0c0c6d616e75666163747572657231153013
06035504030c0c6d6173612e73746f6b2e6e6c3020170d323031323039313030
3233365a180f39393939313233313233353935395a308190310b300906035504
0613024e4c310b300906035504080c024e423110300e06035504070c0748656c
6d6f6e6431133011060355040a0c0a76616e64657273746f6b31163014060355
040b0c0d6d616e75666163747572696e67311c301a06035504030c1375756964
3a706c656467652e312e322e332e34311730150603550405130e706c65646765
2e312e322e332e343059301306072a8648ce3d020106082a8648ce3d03010703
420004d6b76f7488bd80ae5f28412c7202ef5f98b481e1d9104cf81b66d43e5c
eada73e6a838a9f1351185b6cde20410befed50b3b14692ee1b06abc554060eb
955c54a32e302c30090603551d1304023000301f0603551d23041830168014e4
0393b4c3d3f42a80a47718f6964903011768a3300a06082a8648ce3d04030203
49003046022100d2e6453bb0c300b3258df183fed937c1a24965697f6bb9ef2c
05070631ac17bd022100e2ce9e7b7f745033ad9eff124ee9a6f3b83665ab7d80
bb5688bc031de51e316f&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.2.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="registrar-certificate">
<section id="appendix-C.2.2">
          <h4 id="name-registrar-certificate">
<a href="#appendix-C.2.2" class="section-number selfRef">C.2.2. </a><a href="#name-registrar-certificate" class="section-name selfRef">Registrar Certificate</a>
          </h4>
<div class="artwork art-text alignLeft" id="appendix-C.2.2-1">
<pre>
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            70:56:ea:aa:30:66:d8:82:6a:55:5b:90:88:d4:62:bf:9c:f2:8c:fd
        Signature Algorithm: ecdsa-with-SHA256
        Issuer: C=NL, ST=NB, L=Helmond, O=vanderstok, OU=consultancy,
                                                 CN=registrar.stok.nl
        Validity
            Not Before: Dec  9 10:02:36 2020 GMT
            Not After : Dec  9 10:02:36 2021 GMT
        Subject: C=NL, ST=NB, L=Helmond, O=vanderstok, OU=consultancy,
                                                  CN=registrar.stok.nl
        Subject Public Key Info:
            Public Key Algorithm: id-ecPublicKey
                Public-Key: (256 bit)
                pub:
                    04:50:7a:c8:49:1a:8c:69:c7:b5:c3:1d:03:09:ed:
                    35:ba:13:f5:88:4c:e6:2b:88:cf:30:18:15:4f:a0:
                    59:b0:20:ec:6b:eb:b9:4e:02:b8:93:40:21:89:8d:
                    a7:89:c7:11:ce:a7:13:39:f5:0e:34:8e:df:0d:92:
                    3e:d0:2d:c7:b7
                ASN1 OID: prime256v1
                NIST CURVE: P-256
        X509v3 extensions:
            X509v3 Subject Key Identifier:
      08:C2:BF:36:88:7F:79:41:21:85:87:2F:16:A7:AC:A6:EF:B3:D2:B3
            X509v3 Authority Key Identifier:
                keyid:
      08:C2:BF:36:88:7F:79:41:21:85:87:2F:16:A7:AC:A6:EF:B3:D2:B3

            X509v3 Basic Constraints: critical
                CA:TRUE
            X509v3 Extended Key Usage:
                CMC Registration Authority, TLS Web Server
                Authentication, TLS Web Client Authentication
            X509v3 Key Usage: critical
                Digital Signature, Non Repudiation, Key Encipherment,
                Data Encipherment, Certificate Sign, CRL Sign
    Signature Algorithm: ecdsa-with-SHA256
         30:44:02:20:74:4c:99:00:85:13:b2:f1:bc:fd:f9:02:1a:46:
         fb:17:4c:f8:83:a2:7c:a1:d9:3f:ae:ac:f3:1e:4e:dd:12:c6:
         02:20:11:47:14:db:f5:1a:5e:78:f5:81:b9:42:1c:6e:47:02:
         ab:53:72:70:c5:ba:fb:2d:16:c3:de:9a:a1:82:c3:5f

&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.2.2-1" class="pilcrow">¶</a>
</div>
<p id="appendix-C.2.2-2">This the hexadecimal representation, in (request-)voucher examples referred to as regis-cert-hex<a href="#appendix-C.2.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C.2.2-3">
<pre>
308202753082021ca00302010202147056eaaa3066d8826a555b9088d462bf9c
f28cfd300a06082a8648ce3d0403023073310b3009060355040613024e4c310b
300906035504080c024e423110300e06035504070c0748656c6d6f6e64311330
11060355040a0c0a76616e64657273746f6b31143012060355040b0c0b636f6e
73756c74616e6379311a301806035504030c117265676973747261722e73746f
6b2e6e6c301e170d3230313230393130303233365a170d323131323039313030
3233365a3073310b3009060355040613024e4c310b300906035504080c024e42
3110300e06035504070c0748656c6d6f6e6431133011060355040a0c0a76616e
64657273746f6b31143012060355040b0c0b636f6e73756c74616e6379311a30
1806035504030c117265676973747261722e73746f6b2e6e6c3059301306072a
8648ce3d020106082a8648ce3d03010703420004507ac8491a8c69c7b5c31d03
09ed35ba13f5884ce62b88cf3018154fa059b020ec6bebb94e02b8934021898d
a789c711cea71339f50e348edf0d923ed02dc7b7a3818d30818a301d0603551d
0e0416041408c2bf36887f79412185872f16a7aca6efb3d2b3301f0603551d23
04183016801408c2bf36887f79412185872f16a7aca6efb3d2b3300f0603551d
130101ff040530030101ff30270603551d250420301e06082b0601050507031c
06082b0601050507030106082b06010505070302300e0603551d0f0101ff0404
030201f6300a06082a8648ce3d04030203470030440220744c99008513b2f1bc
fdf9021a46fb174cf883a27ca1d93faeacf31e4edd12c60220114714dbf51a5e
78f581b9421c6e4702ab537270c5bafb2d16c3de9aa182c35f&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.2.2-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="masa-certificate">
<section id="appendix-C.2.3">
          <h4 id="name-masa-certificate">
<a href="#appendix-C.2.3" class="section-number selfRef">C.2.3. </a><a href="#name-masa-certificate" class="section-name selfRef">MASA Certificate</a>
          </h4>
<div class="artwork art-text alignLeft" id="appendix-C.2.3-1">
<pre>
Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
            14:26:b8:1c:ce:d8:c3:e8:14:05:cb:87:67:0d:be:ef:d5:81:25:b4
        Signature Algorithm: ecdsa-with-SHA256
        Issuer: C=NL, ST=NB, L=Helmond, O=vanderstok,
            OU=manufacturer, CN=masa.stok.nl

        Validity
            Not Before: Dec  9 10:02:36 2020 GMT
            Not After : Sep  5 10:02:36 2023 GMT
        Subject: C=NL, ST=NB, L=Helmond, O=vanderstok,
            OU=manufacturer, CN=masa.stok.nl
        Subject Public Key Info:
            Public Key Algorithm: id-ecPublicKey
                Public-Key: (256 bit)
                pub:
                    04:59:80:94:66:14:94:20:30:3c:66:08:85:55:86:
                    db:e7:d4:d1:d7:7a:d2:a3:1a:0c:73:6b:01:0d:02:
                    12:15:d6:1f:f3:6e:c8:d4:84:60:43:3b:21:c5:83:
                    80:1e:fc:e2:37:85:77:97:94:d4:aa:34:b5:b6:c6:
                    ed:f3:17:5c:f1
                ASN1 OID: prime256v1
                NIST CURVE: P-256
        X509v3 extensions:
            X509v3 Subject Key Identifier:
      E4:03:93:B4:C3:D3:F4:2A:80:A4:77:18:F6:96:49:03:01:17:68:A3
            X509v3 Authority Key Identifier:
                keyid:
       E4:03:93:B4:C3:D3:F4:2A:80:A4:77:18:F6:96:49:03:01:17:68:A3

            X509v3 Basic Constraints: critical
                CA:TRUE
            X509v3 Extended Key Usage:
                CMC Registration Authority,
                TLS Web Server Authentication,
                TLS Web Client Authentication
            X509v3 Key Usage: critical
                Digital Signature, Non Repudiation, Key Encipherment,
                      Data Encipherment, Certificate Sign, CRL Sign
    Signature Algorithm: ecdsa-with-SHA256
         30:44:02:20:2e:c5:f2:24:72:70:20:ea:6e:74:8b:13:93:67:
         8a:e6:fe:fb:8d:56:7f:f5:34:18:a9:ef:a5:0f:c3:99:ca:53:
         02:20:3d:dc:91:d0:e9:6a:69:20:01:fb:e4:20:40:de:7c:7d:
         98:ed:d8:84:53:61:84:a7:f9:13:06:4c:a9:b2:8f:5c


&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.2.3-1" class="pilcrow">¶</a>
</div>
<p id="appendix-C.2.3-2">This is the hexadecimal representation, in (request-)voucher examples referred to as masa-cert-hex.<a href="#appendix-C.2.3-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C.2.3-3">
<pre>
3082026d30820214a00302010202141426b81cced8c3e81405cb87670dbeefd5
8125b4300a06082a8648ce3d040302306f310b3009060355040613024e4c310b
300906035504080c024e423110300e06035504070c0748656c6d6f6e64311330
11060355040a0c0a76616e64657273746f6b31153013060355040b0c0c6d616e
7566616374757265723115301306035504030c0c6d6173612e73746f6b2e6e6c
301e170d3230313230393130303233365a170d3233303930353130303233365a
306f310b3009060355040613024e4c310b300906035504080c024e423110300e
06035504070c0748656c6d6f6e6431133011060355040a0c0a76616e64657273
746f6b31153013060355040b0c0c6d616e756661637475726572311530130603
5504030c0c6d6173612e73746f6b2e6e6c3059301306072a8648ce3d02010608
2a8648ce3d0301070342000459809466149420303c6608855586dbe7d4d1d77a
d2a31a0c736b010d021215d61ff36ec8d48460433b21c583801efce237857797
94d4aa34b5b6c6edf3175cf1a3818d30818a301d0603551d0e04160414e40393
b4c3d3f42a80a47718f6964903011768a3301f0603551d23041830168014e403
93b4c3d3f42a80a47718f6964903011768a3300f0603551d130101ff04053003
0101ff30270603551d250420301e06082b0601050507031c06082b0601050507
030106082b06010505070302300e0603551d0f0101ff0404030201f6300a0608
2a8648ce3d040302034700304402202ec5f224727020ea6e748b1393678ae6fe
fb8d567ff53418a9efa50fc399ca5302203ddc91d0e96a692001fbe42040de7c
7d98edd884536184a7f913064ca9b28f5c&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.2.3-3" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="cose-signed-voucher-request-from-pledge-to-registrar">
<section id="appendix-C.3">
        <h3 id="name-cose-signed-voucher-request">
<a href="#appendix-C.3" class="section-number selfRef">C.3. </a><a href="#name-cose-signed-voucher-request" class="section-name selfRef">COSE signed voucher request from Pledge to Registrar</a>
        </h3>
<p id="appendix-C.3-1">In this example the voucher request has been signed by the Pledge, and has been sent to the JRC over CoAPS.
The Pledge uses the proximity assertion together with an included proximity-registrar-cert field to inform
MASA about its proximity to the specific Registrar.<a href="#appendix-C.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C.3-2">
<pre>
    POST coaps://registrar.example.com/b/rv
    (Content-Format: application/voucher-cose+cbor)
    signed_request_voucher
</pre><a href="#appendix-C.3-2" class="pilcrow">¶</a>
</div>
<p id="appendix-C.3-3">The payload signed_request_voucher is shown as hexadecimal dump (with lf added):<a href="#appendix-C.3-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C.3-4">
<pre>
d28444a101382ea104582097113db094eee8eae48683e7337875c0372164
be89d023a5f3df52699c0fbfb55902d2a11909c5a60274323032302d3132
2d32335431323a30353a32325a0474323032322d31322d32335431323a30
353a32325a01020750684ca83e27230aff97630cf2c1ec409a0d6e706c65
6467652e312e322e332e340a590279308202753082021ca0030201020214
7056eaaa3066d8826a555b9088d462bf9cf28cfd300a06082a8648ce3d04
03023073310b3009060355040613024e4c310b300906035504080c024e42
3110300e06035504070c0748656c6d6f6e6431133011060355040a0c0a76
616e64657273746f6b31143012060355040b0c0b636f6e73756c74616e63
79311a301806035504030c117265676973747261722e73746f6b2e6e6c30
1e170d3230313230393130303233365a170d323131323039313030323336
5a3073310b3009060355040613024e4c310b300906035504080c024e4231
10300e06035504070c0748656c6d6f6e6431133011060355040a0c0a7661
6e64657273746f6b31143012060355040b0c0b636f6e73756c74616e6379
311a301806035504030c117265676973747261722e73746f6b2e6e6c3059
301306072a8648ce3d020106082a8648ce3d03010703420004507ac8491a
8c69c7b5c31d0309ed35ba13f5884ce62b88cf3018154fa059b020ec6beb
b94e02b8934021898da789c711cea71339f50e348edf0d923ed02dc7b7a3
818d30818a301d0603551d0e0416041408c2bf36887f79412185872f16a7
aca6efb3d2b3301f0603551d2304183016801408c2bf36887f7941218587
2f16a7aca6efb3d2b3300f0603551d130101ff040530030101ff30270603
551d250420301e06082b0601050507031c06082b0601050507030106082b
06010505070302300e0603551d0f0101ff0404030201f6300a06082a8648
ce3d04030203470030440220744c99008513b2f1bcfdf9021a46fb174cf8
83a27ca1d93faeacf31e4edd12c60220114714dbf51a5e78f581b9421c6e
4702ab537270c5bafb2d16c3de9aa182c35f58473045022063766c7bbd1b
339dbc398e764af3563e93b25a69104befe9aac2b3336b8f56e1022100cd
0419559ad960ccaed4dee3f436eca40b7570b25a52eb60332bc1f2991484
e9
&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.3-4" class="pilcrow">¶</a>
</div>
<p id="appendix-C.3-5">The representiation of signed_voucher_request in CBOR diagnostic format is:<a href="#appendix-C.3-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C.3-6">
<pre>
Diagnose(signed_request_voucher) =
18([
h'A101382E',     // {"alg": -47}
{4: h'97113DB094EEE8EAE48683E7337875C0372164B
      E89D023A5F3DF52699C0FBFB5'},
h'1234',         // request_voucher
h'3045022063766C7BBD1B339DBC398E764AF3563E93B
25A69104BEFE9AAC2B3336B8F56E1022100CD0419559A
D960CCAED4DEE3F436ECA40B7570B25A52EB60332BC1F
2991484E9'
])

Diagnose(request_voucher) =
{2501: {2: "2020-12-23T12:05:22Z",
        4: "2022-12-23T12:05:22Z",
        1: 2,
        7: h'684CA83E27230AFF97630CF2C1EC409A',
        13: "pledge.1.2.3.4",
        10: h'1234' // regis-cert-hex
}}
&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.3-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="cose-signed-voucher-request-from-registrar-to-masa">
<section id="appendix-C.4">
        <h3 id="name-cose-signed-voucher-request-">
<a href="#appendix-C.4" class="section-number selfRef">C.4. </a><a href="#name-cose-signed-voucher-request-" class="section-name selfRef">COSE signed voucher request from Registrar to MASA</a>
        </h3>
<p id="appendix-C.4-1">TBD - modify example to use full paths to MASA, not short-names.
Also not use CoAP but HTTP protocol.<a href="#appendix-C.4-1" class="pilcrow">¶</a></p>
<p id="appendix-C.4-2">In this example the voucher request has been signed by the JRC using the private key from
<a href="#jrcpriv" class="xref">Appendix C.1.2</a>.  Contained within this voucher request is the voucher
request from the Pledge to JRC.<a href="#appendix-C.4-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C.4-3">
<pre>
    POST coaps://masa.example.com/b/rv
    (Content-Format: application/voucher-cose+cbor)
    signed_masa_request_voucher
</pre><a href="#appendix-C.4-3" class="pilcrow">¶</a>
</div>
<p id="appendix-C.4-4">The payload signed_masa_voucher_request is shown as hexadecimal dump (with lf added):<a href="#appendix-C.4-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C.4-5">
<pre>
d28444a101382ea1045820e8735bc4b470c3aa6a7aa9aa8ee584c09c1113
1b205efec5d0313bad84c5cd05590414a11909c5a60274323032302d3132
2d32385431303a30333a33355a0474323032322d31322d32385431303a30
333a33355a07501551631f6e0416bd162ba53ea00c2a050d6e706c656467
652e312e322e332e3405587131322d32385431303a30333a33355a075015
51631f6e0416bd162ba53ea00c2a050d6e706c656467652e312e322e332e
3405587131322d32385431303a300000000000000000000000000416bd16
2ba53ea00c2a050d6e706c656467652e312e322e332e3405587131322d32
385431303a09590349d28444a101382ea104582097113db094eee8eae486
83e7337875c0372164be89d023a5f3df52699c0fbfb55902d2a11909c5a6
0274323032302d31322d32385431303a30333a33355a0474323032322d31
322d32385431303a30333a33355a010207501551631f6e0416bd162ba53e
a00c2a050d6e706c656467652e312e322e332e340a590279308202753082
021ca00302010202147056eaaa3066d8826a555b9088d462bf9cf28cfd30
0a06082a8648ce3d0403023073310b3009060355040613024e4c310b3009
06035504080c024e423110300e06035504070c0748656c6d6f6e64311330
11060355040a0c0a76616e64657273746f6b31143012060355040b0c0b63
6f6e73756c74616e6379311a301806035504030c11726567697374726172
2e73746f6b2e6e6c301e170d3230313230393130303233365a170d323131
3230393130303233365a3073310b3009060355040613024e4c310b300906
035504080c024e423110300e06035504070c0748656c6d6f6e6431133011
060355040a0c0a76616e64657273746f6b31143012060355040b0c0b636f
6e73756c74616e6379311a301806035504030c117265676973747261722e
73746f6b2e6e6c3059301306072a8648ce3d020106082a8648ce3d030107
03420004507ac8491a8c69c7b5c31d0309ed35ba13f5884ce62b88cf3018
154fa059b020ec6bebb94e02b8934021898da789c711cea71339f50e348e
df0d923ed02dc7b7a3818d30818a301d0603551d0e0416041408c2bf3688
7f79412185872f16a7aca6efb3d2b3301f0603551d2304183016801408c2
bf36887f79412185872f16a7aca6efb3d2b3300f0603551d130101ff0405
30030101ff30270603551d250420301e06082b0601050507031c06082b06
01050507030106082b06010505070302300e0603551d0f0101ff04040302
01f6300a06082a8648ce3d04030203470030440220744c99008513b2f1bc
fdf9021a46fb174cf883a27ca1d93faeacf31e4edd12c60220114714dbf5
1a5e78f581b9421c6e4702ab537270c5bafb2d16c3de9aa182c35f584730
45022063766c7bbd1b339dbc398e764af3563e93b25a69104befe9aac2b3
336b8f56e1022100cd0419559ad960ccaed4dee3f436eca40b7570b25a52
eb60332bc1f2991484e958473045022100e6b45558c1b806bba23f4ac626
c9bdb6fd354ef4330d8dfb7c529f29cca934c802203c1f2ccbbac89733d1
7ee7775bc2654c5f1cc96afba2741cc31532444aa8fed8

&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.4-5" class="pilcrow">¶</a>
</div>
<p id="appendix-C.4-6">The representiation of signed_masa_voucher_request in CBOR diagnostic format is:<a href="#appendix-C.4-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C.4-7">
<pre>
Diagnose(signed_registrar_request-voucher)
18([
h'A101382E',     // {"alg": -47}
h'E8735BC4B470C3AA6A7AA9AA8EE584C09C11131B205EFEC5D0313BAD84
C5CD05'},
h'1234', // registrar_request_voucher',
h'3045022100E6B45558C1B806BBA23F4AC626C9BDB6FD354EF4330D8DFB
7C529F29CCA934C802203C1F2CCBBAC89733D17EE7775BC2654C5F1CC96A
FBA2741CC31532444AA8FED8'
])


Diagnose(registrar_request_voucher)
{2501:
    {2: "2020-12-28T10:03:35Z",
     4: "2022-12-28T10:03:35Z",
     7: h'1551631F6E0416BD162BA53EA00C2A05',
    13: "pledge.1.2.3.4",
     5: h'31322D32385431303A30333A33355A07501551631F6E0416BD
          162BA53EA00C2A050D6E706C656467652E312E322E332E3405
          587131322D32385431303A3000000000000000000000000004
          16BD162BA53EA00C2A050D6E706C656467652E312E322E332E
          3405587131322D32385431303A',
     9: h'1234'  // signature
}}
&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.4-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="cose-signed-voucher-from-masa-to-pledge-via-registrar">
<section id="appendix-C.5">
        <h3 id="name-cose-signed-voucher-from-ma">
<a href="#appendix-C.5" class="section-number selfRef">C.5. </a><a href="#name-cose-signed-voucher-from-ma" class="section-name selfRef">COSE signed voucher from MASA to Pledge via Registrar</a>
        </h3>
<p id="appendix-C.5-1">The resulting voucher is created by the MASA and returned via the JRC to the
Pledge.  It is signed by the MASA's private key <a href="#masapriv" class="xref">Appendix C.1.3</a> and can be
verified by the Pledge using the MASA's public key contained within the MASA certificate.<a href="#appendix-C.5-1" class="pilcrow">¶</a></p>
<p id="appendix-C.5-2">This is the raw binary signed_voucher, encoded in hexadecimal (with lf added):<a href="#appendix-C.5-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C.5-3">
<pre>
d28444a101382ea104582039920a34ee92d3148ab3a729f58611193270c9
029f7784daf112614b19445d5158cfa1190993a70274323032302d31322d
32335431353a30333a31325a0474323032302d31322d32335431353a3233
3a31325a010007506508e06b2959d5089d7a3169ea889a490b6e706c6564
67652e312e322e332e340858753073310b3009060355040613024e4c310b
300906035504080c024e423110300e06035504070c0748656c6d6f6e6431
133011060355040a0c0a76616e64657273746f6b31143012060355040b0c
0b636f6e73756c74616e6379311a301806035504030c1172656769737472
61722e73746f6b2e6e6c03f458473045022022515d96cd12224ee5d3ac67
3237163bba24ad84815699285d9618f463ee73fa022100a6bff9d8585c1c
9256371ece94da3d26264a5dfec0a354fe7b3aef58344c512f

&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.5-3" class="pilcrow">¶</a>
</div>
<p id="appendix-C.5-4">The representiation of signed_voucher in CBOR diagnostic format is:<a href="#appendix-C.5-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-C.5-5">
<pre>
Diagnose(signed_voucher) =
18([
h'A101382E',     # {"alg": -47}
{4: h'39920A34EE92D3148AB3A729F58611193270C9029F7784DAF112614B194
45D51'},
h'voucher',
h'3045022022515D96CD12224EE5D3AC673237163BBA24AD84815699285D9618F
463EE73FA022100A6BFF9D8585C1C9256371ECE94DA3D26264A5DFEC0A354FE7B
3AEF58344C512F'
])


Diagnose(voucher) =
{2451:
   {2: "2020-12-23T15:03:12Z",
    4: "2020-12-23T15:23:12Z",
    1: 0,
    7: h'6508E06B2959D5089D7A3169EA889A49',
   11: "pledge.1.2.3.4",
    8: h'regis-cert-hex',
    3: false}}
&lt;CODE ENDS&gt;
</pre><a href="#appendix-C.5-5" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="contributors">
<section id="appendix-D">
      <h2 id="name-contributors">
<a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Russ Housley</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:housley@vigilsec.com" class="email">housley@vigilsec.com</a>
</div>
</address>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-E">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Michael Richardson</span></div>
<div dir="auto" class="left"><span class="org">Sandelman Software Works</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mcr+ietf@sandelman.ca" class="email">mcr+ietf@sandelman.ca</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Peter van der Stok</span></div>
<div dir="auto" class="left"><span class="org">vanderstok consultancy</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:stokcons@bbhmail.nl" class="email">stokcons@bbhmail.nl</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Panos Kampanakis</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:pkampana@cisco.com" class="email">pkampana@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Esko Dijk</span></div>
<div dir="auto" class="left"><span class="org">IoTconsultancy.nl</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:esko.dijk@iotconsultancy.nl" class="email">esko.dijk@iotconsultancy.nl</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
