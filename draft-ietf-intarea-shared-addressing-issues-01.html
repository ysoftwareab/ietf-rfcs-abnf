<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Issues with IP Address Sharing</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Issues with IP Address Sharing">
<meta name="keywords" content="IPv4 address exhaustion completion shared sharing issues">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">M. Ford, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Internet Society</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">M. Boucadair</td></tr>
<tr><td class="header">Expires: January 1, 2011</td><td class="header">France Telecom</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">A. Durand</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Juniper Networks</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">P. Levis</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">France Telecom</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">P. Roberts</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Internet Society</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">June 30, 2010</td></tr>
</table></td></tr></table>
<h1><br />Issues with IP Address Sharing<br />draft-ietf-intarea-shared-addressing-issues-01</h1>

<h3>Abstract</h3>

<p>The completion of IPv4 address allocations from IANA and the RIRs is causing service
				providers around the world to question how they will continue providing IPv4
				connectivity service to their subscribers when there are no longer sufficient IPv4
				addresses to allocate them one per subscriber. Several possible solutions to this
				problem are now emerging based around the idea of shared IPv4 addressing. These
				solutions give rise to a number of issues and this memo identifies those common to
				all such address sharing approaches. Solution-specific discussions are out of
				scope.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on January 1, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Shared Addressing Solutions<br />
<a href="#anchor3">3.</a>&nbsp;
Analysis of Issues as they Relate to First and Third Parties<br />
<a href="#anchor4">4.</a>&nbsp;
Content Provider Example<br />
<a href="#anchor5">5.</a>&nbsp;
Port Allocation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#OutgoingPorts">5.1.</a>&nbsp;
Outgoing Ports<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#IncomingPorts">5.2.</a>&nbsp;
Incoming Ports<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#PortNegotiation">5.2.1.</a>&nbsp;
Port Negotiation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#WKP">5.2.2.</a>&nbsp;
Connection to a Well-Known Port Number<br />
<a href="#anchor8">6.</a>&nbsp;
Impact on Applications<br />
<a href="#Geoloc">7.</a>&nbsp;
Geo-location and Geo-proximity<br />
<a href="#Usage">8.</a>&nbsp;
Tracking Service Usage<br />
<a href="#ICMP">9.</a>&nbsp;
ICMP<br />
<a href="#anchor9">10.</a>&nbsp;
Fragmentation<br />
<a href="#Traceability">11.</a>&nbsp;
Traceability<br />
<a href="#Security">12.</a>&nbsp;
Security<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">12.1.</a>&nbsp;
Abuse Logging and Penalty Boxes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">12.2.</a>&nbsp;
Authentication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">12.3.</a>&nbsp;
Spam<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">12.4.</a>&nbsp;
Port Randomisation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">12.5.</a>&nbsp;
IPsec<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">12.6.</a>&nbsp;
Policing Forwarding Behaviour<br />
<a href="#anchor16">13.</a>&nbsp;
TCP Control Block Sharing<br />
<a href="#anchor17">14.</a>&nbsp;
Reverse DNS<br />
<a href="#LoadBalancing">15.</a>&nbsp;
Load Balancing<br />
<a href="#anchor18">16.</a>&nbsp;
IPv6 Transition Issues<br />
<a href="#anchor19">17.</a>&nbsp;
Introduction of Single Points of Failure<br />
<a href="#anchor20">18.</a>&nbsp;
State Maintenance Reduces Battery Life<br />
<a href="#anchor21">19.</a>&nbsp;
Support of Multicast<br />
<a href="#anchor22">20.</a>&nbsp;
Support of Mobile-IP<br />
<a href="#IANA">21.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor23">22.</a>&nbsp;
Security Considerations<br />
<a href="#anchor24">23.</a>&nbsp;
Contributors<br />
<a href="#Acknowledgements">24.</a>&nbsp;
Acknowledgements<br />
<a href="#Annex">25.</a>&nbsp;
Annex<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">25.1.</a>&nbsp;
Classes of Address Sharing Solution<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#asmf">25.2.</a>&nbsp;
Address Space Multiplicative Factor<br />
<a href="#rfc.references1">26.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Allocations of IPv4 addresses from the Internet Assigned Numbers Authority (IANA) are
				currently forecast to be complete during 2011 <a class='info' href='#IPv4_Report'>[IPv4_Report]<span> (</span><span class='info'>Huston, G., &ldquo;IPv4 Address Report,&rdquo; 2009.</span><span>)</span></a>.
				Allocations from some Regional Internet Registries (RIRs) are anticipated to be
				complete around a year later, although the exact date will vary from registry to
				registry. This is causing service providers around the world to start to question
				how they will continue providing IPv4 connectivity service to their subscribers when
				there are no longer sufficient IPv4 addresses to allocate them one per subscriber.
				Several possible solutions to this problem are now emerging based around the idea of
				shared IPv4 addressing. These solutions give rise to a number of issues and this
				memo identifies those common to all such address sharing approaches and collects
				them in a single document.
</p>
<p>Over the long term, deploying IPv6 is the only way to ease pressure on the public
				IPv4 address pool and thereby mitigate the need for address sharing mechanisms that
				give rise to the issues identified herein. In the short term, maintaining growth of
				IPv4 services in the presence of IPv4 address depletion will require address
				sharing. Address sharing will cause issues for end-users, service providers and
				third parties such as law enforcement agencies and content providers. This memo is
				intended to highlight and briefly discuss these issues.
</p>
<p>Increased IPv6 deployment should reduce the burden being placed on an address sharing
				solution, and should reduce the costs of operating that solution. Increasing IPv6
				deployment should cause a reduction in the number of concurrent IPv4 sessions per
				subscriber. If the percentage of end-to-end IPv6 traffic significantly increases, so
				that the volume of IPv4 traffic begins decreasing, then the number of IPv4 sessions
				will decrease. The smaller the number of concurrent IPv4 sessions per subscriber,
				the higher the number of subscribers able to share the same IPv4 public address, and
				consequently, the lower the number of IPv4 public addresses required. However, this
				effect will only occur for subscribers who have both an IPv6 access and a shared
				IPv4 access. This motivates a strategy to systematically bind a shared IPv4 access
				to an IPv6 access. It is difficult to foresee to what extent growing IPv6 traffic
				will reduce the number of concurrent IPv4 sessions, but in any event, IPv6
				deployment and use should reduce the pressure on the available public IPv4 address
				pool.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Shared Addressing Solutions</h3>

<p> In many networks today a subscriber is provided with a single public IPv4 address at
				their home or small business. For instance, in fixed broadband access, an IPv4
				public address is assigned to each CPE (Customer Premises Equipment). CPEs embed a
				NAT function which is responsible for translating private IPv4 addresses (<a class='info' href='#RFC1918'>[RFC1918]<span> (</span><span class='info'>Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G., and E. Lear, &ldquo;Address Allocation for Private Internets,&rdquo; February&nbsp;1996.</span><span>)</span></a> addresses) assigned to hosts within the local network, to the
				public IPv4 address assigned by the service provider (and vice versa). Therefore,
				devices located with the LAN share the single public IPv4 address and they are all
				associated with a single subscriber account and a single network operator.
</p>
<p> A number of proposals currently under consideration in the IETF rely upon the
				mechanism of multiplexing multiple subscribers' connections over a smaller number of
				shared IPv4 addresses. This is a significant change. These proposals include Carrier
				Grade NAT (CGN) <a class='info' href='#I-D.nishitani-cgn'>[I&#8209;D.nishitani&#8209;cgn]<span> (</span><span class='info'>Yamagata, I., Nishitani, T., Miyakawa, S., Nakagawa, A., and H. Ashida, &ldquo;Common requirements for IP address sharing schemes,&rdquo; March&nbsp;2010.</span><span>)</span></a> , Dual-Stack-Lite <a class='info' href='#I-D.ietf-softwire-dual-stack-lite'>[I&#8209;D.ietf&#8209;softwire&#8209;dual&#8209;stack&#8209;lite]<span> (</span><span class='info'>Durand, A., Droms, R., Haberman, B., Woodyatt, J., Lee, Y., and R. Bush, &ldquo;Dual-Stack Lite Broadband Deployments Following IPv4 Exhaustion,&rdquo; March&nbsp;2010.</span><span>)</span></a> , NAT64 <a class='info' href='#I-D.ietf-behave-v6v4-xlate-stateful'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate&#8209;stateful]<span> (</span><span class='info'>Bagnulo, M., Matthews, P., and I. Beijnum, &ldquo;Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers,&rdquo; March&nbsp;2010.</span><span>)</span></a> , IVI <a class='info' href='#I-D.ietf-behave-v6v4-xlate'>[I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate]<span> (</span><span class='info'>Li, X., Bao, C., and F. Baker, &ldquo;IP/ICMP Translation Algorithm,&rdquo; May&nbsp;2010.</span><span>)</span></a> , Address+Port (A+P) proposals <a class='info' href='#I-D.ymbk-aplusp'>[I&#8209;D.ymbk&#8209;aplusp]<span> (</span><span class='info'>Bush, R., &ldquo;The A+P Approach to the IPv4 Address Shortage,&rdquo; October&nbsp;2009.</span><span>)</span></a> , <a class='info' href='#I-D.boucadair-port-range'>[I&#8209;D.boucadair&#8209;port&#8209;range]<span> (</span><span class='info'>Boucadair, M., Levis, P., Bajko, G., and T. Savolainen, &ldquo;IPv4 Connectivity Access in the Context of IPv4 Address Exhaustion: Port Range based IP Architecture,&rdquo; July&nbsp;2009.</span><span>)</span></a> and SAM
					<a class='info' href='#I-D.despres-sam'>[I&#8209;D.despres&#8209;sam]<span> (</span><span class='info'>Despres, R., &ldquo;Scalable Multihoming across IPv6 Local-Address Routing Zones Global-Prefix/Local-Address Stateless Address Mapping (SAM),&rdquo; July&nbsp;2009.</span><span>)</span></a>. <a class='info' href='#Annex'>Section&nbsp;25<span> (</span><span class='info'>Annex</span><span>)</span></a> provides a
				classification of these different types of solution and discusses some of the design
				considerations to be borne in mind when deploying large-scale address sharing.
				Whether we're talking about Dual-Stack-Lite, A+P, NAT64 or CGN isn't especially
				important - it's the view from the outside that matters, and given that, most of the
				issues identified below apply regardless of the specific address sharing scenario in
				question. Issues specific to A+P proposals are addressed in <a class='info' href='#I-D.thaler-port-restricted-ip-issues'>[I&#8209;D.thaler&#8209;port&#8209;restricted&#8209;ip&#8209;issues]<span> (</span><span class='info'>Thaler, D., &ldquo;Issues With Port-Restricted IP Addresses,&rdquo; February&nbsp;2010.</span><span>)</span></a>.
</p>
<p>In these new proposals, a single public IPv4 address would be shared by multiple
				homes or small businesses (i.e. multiple subscribers) so the operational paradigm
				described above would no longer apply. In this document we refer to this new
				paradigm as large-scale address sharing. All these proposals extend the address
				space by adding port information, they differ in the way they manage the port value. 
</p>
<p> Security issues associated with NAT have long been documented (see <a class='info' href='#RFC2663'>[RFC2663]<span> (</span><span class='info'>Srisuresh, P. and M. Holdrege, &ldquo;IP Network Address Translator (NAT) Terminology and Considerations,&rdquo; August&nbsp;1999.</span><span>)</span></a> and <a class='info' href='#RFC2993'>[RFC2993]<span> (</span><span class='info'>Hain, T., &ldquo;Architectural Implications of NAT,&rdquo; November&nbsp;2000.</span><span>)</span></a> ). However, sharing IPv4
				addresses across multiple subscribers by any means, either moving the NAT
				functionality from the home gateway to the core of the service provider network, or
				restricting the port choice in the subscriber's NAT, creates additional issues for
				subscribers, content providers and network operators. Many of these issues are
				created today by public wi-fi hotspot deployments. As such large-scale address
				sharing solutions become more widespread in the face of IPv4 address depletion,
				these issues will become both more severe and more commonly felt. NAT issues in the
				past typically only applied to a single legal entity; as large-scale address sharing
				becomes more prevalent these issues will increasingly span across multiple legal
				entities simultaneously.
</p>
<p> All large-scale address sharing proposals share technical and operational issues and
				these are addressed in the sections that follow. These issues are common to any
				service-provider NAT, enterprise NAT, and also non-NAT solutions that share
				individual IPv4 addresses across multiple subscribers. This document is intended to
				bring all of these issues together in one place.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Analysis of Issues as they Relate to First and Third Parties</h3>

<p>In this section we present an analysis of whether the issues identified in the
				remainder of this document are applicable to the organisation deploying the shared
				addressing mechanism (and by extension their subscribers) and/or whether these
				issues impact third parties (e.g. content providers, law enforcement agencies,
				etc.). In this analysis, issues that affect end-users are deemed to affect 1st
				parties, as end-users can be expected to complain to their service provider when
				problems arise. Where issues can expect to be foreseen and addressed by the party
				deploying the shared addressing solution, they are not attributed.
</p>
<p>In <a class='info' href='#Figure1'>Figure&nbsp;1<span> (</span><span class='info'>Shared addressing issues for first and third parties</span><span>)</span></a> we have also tried to indicate (with 'xx') where issues
				are newly created in addition to what could be expected from the introduction of a
				traditional NAT device. Issues marked with a single 'x' are already present today in
				the case of typical CPE NAT, however they can be expected to be more severe and
				widespread in the case of large-scale address sharing.
</p><br /><hr class="insert" />
<a name="Figure1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+------------------------------------------------+--------+---------+
|                   Issue                        |   1st  |   3rd   |
|                                                |  party | parties |
+------------------------------------------------+--------+---------+
| Overly restrictive allocations of outgoing     |    x   |         |
| ports will impact performance for end users    |        |         |
|                                                |        |         |
| Incoming port negotiation mechanisms may fail  |    xx  |         |
|                                                |        |         |
| Incoming connections to Well-Known Ports will  |    x   |         |
| not work                                       |        |         |
|                                                |        |         |
| Some applications will fail to operate         |    x   |    x    |
|                                                |        |         |
| TCP control block sharing will be affected     |    x   |    x    |
|                                                |        |         |
+------------------------------------------------+--------+---------+

+------------------------------------------------+--------+---------+
|                   Issue                        |   1st  |   3rd   |
|                                                |  party | parties |
+------------------------------------------------+--------+---------+
| Reverse DNS will be affected                   |    x   |    x    |
|                                                |        |         |
| Inbound ICMP will fail in many cases           |    x   |    x    |
|                                                |        |         |
| Amplification of security issues               |    xx  |    xx   |
|                                                |        |         |
| Fragmentation will require special handling    |    x   |         |
|                                                |        |         |
| Single points of failure and increased         |    x   |         |
| network instability                            |        |         |
|                                                |        |         |
| Port randomisation will be affected            |    x   |         |
|                                                |        |         |
| Service usage monitoring and abuse logging     |    xx  |    xx   |
| will be impacted for all elements in the chain |        |         |
| between service provider and content provider  |        |         |
|                                                |        |         |
| Penalty boxes will no longer work              |    xx  |    xx   |
|                                                |        |         |
| Spam blacklisting will be affected             |    xx  |    xx   |
|                                                |        |         |
| Geo-location services will be impacted         |    xx  |    xx   |
|                                                |        |         |
| Geo-proximity mechanisms will be impacted      |    xx  |    xx   |
|                                                |        |         |
| Load balancing algorithms may be impacted      |        |    xx   |
|                                                |        |         |
| Authentication mechanisms may be impacted      |        |    x    |
|                                                |        |         |
| Traceability of network usage and abusage will |        |    xx   |
| be affected                                    |        |         |
|                                                |        |         |
| IPv6 transition mechanisms will be affected    |    xx  |         |
|                                                |        |         |
| Frequent keep-alives reduce battery life       |    x   |         |
|                                                |        |         |
+------------------------------------------------+--------+---------+</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Shared addressing issues for first and third parties&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>As can be seen from <a class='info' href='#Figure1'>Figure&nbsp;1<span> (</span><span class='info'>Shared addressing issues for first and third parties</span><span>)</span></a>, deployment of large-scale address
				sharing will create almost as many problems for third parties as it does for the
				service provider deploying the address sharing mechanism. Several of these issues
				are specific to the introduction of large-scale address sharing as well. All of
				these issues are discussed in further detail below.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Content Provider Example</h3>

<p>Taking a content provider as an example of a third-party, and focussing on the issues
				that are created specifically by the presence of large-scale address sharing, we
				identify the following issues as being of particular concern:</p>
<ul class="text">
<li>Degraded geolocation for targeted advertising and licensed content
						restrictions (see <a class='info' href='#Geoloc'>Section&nbsp;7<span> (</span><span class='info'>Geo-location and Geo-proximity</span><span>)</span></a>).
</li>
<li>Additional latency due to indirect routing and degraded geoproximity (see <a class='info' href='#Geoloc'>Section&nbsp;7<span> (</span><span class='info'>Geo-location and Geo-proximity</span><span>)</span></a>).
</li>
<li>Exposure to new amplification attacks (see <a class='info' href='#Security'>Section&nbsp;12<span> (</span><span class='info'>Security</span><span>)</span></a>).
</li>
<li>Service usage monitoring is made more complicated (see <a class='info' href='#Usage'>Section&nbsp;8<span> (</span><span class='info'>Tracking Service Usage</span><span>)</span></a>).
</li>
<li>Incoming port negotiation mechanisms may fail (see <a class='info' href='#PortNegotiation'>Section&nbsp;5.2.1<span> (</span><span class='info'>Port Negotiation</span><span>)</span></a>).
</li>
<li>IP blocking for abuse/spam will cause collateral damage (see <a class='info' href='#Security'>Section&nbsp;12<span> (</span><span class='info'>Security</span><span>)</span></a>).
</li>
<li>Load balancing algorithms may be impacted (see <a class='info' href='#LoadBalancing'>Section&nbsp;15<span> (</span><span class='info'>Load Balancing</span><span>)</span></a>).
</li>
<li>Traceability of network usage and abuse will be impacted (see <a class='info' href='#Traceability'>Section&nbsp;11<span> (</span><span class='info'>Traceability</span><span>)</span></a>).
</li>
</ul>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Port Allocation</h3>

<p>When we talk about port numbers we need to make a distinction between outgoing
				connections and incoming connections. For outgoing connections, the actual source
				port number used is usually irrelevant. (While this is true today, in a port-range
				solution it is necessary for the source port to be within the allocated range). But
				for incoming connections, the specific port numbers allocated to subscribers matter
				because they are part of external referrals (used by third parties to contact
				services run by the subscribers).
</p>
<p>The total number of subscribers able to share a single IPv4 address will depend upon
				assumptions about the average number of ports required per active subscriber, and
				the average number of simultaneously active subscribers. It is important to realise
				that the TCP design makes it undesirable for clients to re-use ports while they
				remain in the TIME-WAIT state (typically 4 minutes after the connection has
				concluded). TIME-WAIT state removes the hazard of old duplicates for "fast" or
				"long" connections, in which clock-driven Initial Sequence Number selection is
				unable to prevent overlap of the old and new sequence spaces. The TIME-WAIT delay
				allows all old duplicate segments time enough to die in the Internet before the
				connection is reopened <a class='info' href='#RFC1337'>[RFC1337]<span> (</span><span class='info'>Braden, B., &ldquo;TIME-WAIT Assassination Hazards in TCP,&rdquo; May&nbsp;1992.</span><span>)</span></a>. Therefore ports in this state must
				be included in calculations concerning port usage per subscriber.
</p>
<p>Most of the time the source port selected by a client application will be translated
				(unless there is direct knowledge of a port-range restriction in the client's
				stack), either by a NAT in the subscriber's device, or by a CPE NAT, or by a CPE NAT
				and a CGN.
</p>
<p> IANA has classified the whole port space into three categories (as defined in
				http://www.iana.org/assignments/port-numbers): </p>
<ul class="text">
<li>The Well Known Ports are those from 0 through 1023.
</li>
<li>The Registered Ports are those from 1024 through 49151.
</li>
<li>The Dynamic and/or Private Ports are those from 49152 through 65535.
</li>
</ul><p>
			
</p>
<p>
				<a class='info' href='#RFC4787'>[RFC4787]<span> (</span><span class='info'>Audet, F. and C. Jennings, &ldquo;Network Address Translation (NAT) Behavioral Requirements for Unicast UDP,&rdquo; January&nbsp;2007.</span><span>)</span></a> notes that current NATs have different policies with regard
				to this classification; some NATs restrict their translations to the use of dynamic
				ports, some also include registered ports, some preserve the port if it is in the
				well-known range. <a class='info' href='#RFC4787'>[RFC4787]<span> (</span><span class='info'>Audet, F. and C. Jennings, &ldquo;Network Address Translation (NAT) Behavioral Requirements for Unicast UDP,&rdquo; January&nbsp;2007.</span><span>)</span></a> makes it clear that the use of port space
				(1024-65535) is safe: "mapping a source port to a source port that is already
				registered is unlikely to have any bad effects". Therefore, for all address sharing
				solutions, there is no reason to only consider a subset of the port space
				(1024-65535) for outgoing source ports. 
</p>
<a name="OutgoingPorts"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Outgoing Ports</h3>

<p> According to measurements the average number of outgoing ports consumed per
					active subscriber is much, much smaller than the maximum number of ports a
					subscriber can use at any given time. However, the distribution is heavy-tailed,
					so there are typically a small number of subscribers who use a very high number
					of ports <a class='info' href='#CGN_Viability'>[CGN_Viability]<span> (</span><span class='info'>Alcock, S., &ldquo;Research into the Viability of Service-Provider NAT,&rdquo; 2008.</span><span>)</span></a>. This means that an algorithm that
					dynamically allocates outgoing port numbers from a central pool will typically
					allow more subscribers to share a single IPv4 address than algorithms that
					statically divide the resource by pre-allocating a fixed number of ports to each
					subscriber. Similarly, such an algorithm should be more able to accommodate
					subscribers wishing to use a relatively high number of ports. 
</p>
<p> It is important to note here that the desire to dynamically allocate outgoing
					port numbers will make a service provider's job of maintaining records of
					subscriber port number allocations considerably more onerous (see <a class='info' href='#Traceability'>Section&nbsp;11<span> (</span><span class='info'>Traceability</span><span>)</span></a>). The number of records per subscriber will increase
					from 1 in a scheme where ports are statically allocated, to a much larger number
					equivalent to the total number of outgoing ports consumed by that subscriber
					during the time period for which detailed logs must be kept. 
</p>
<p>A potential problem with dynamic allocation occurs when one of the subscriber
					devices behind such a port-shared IPv4 address becomes infected with a worm,
					which then quickly sets about opening many outbound connections in order to
					propagate itself. Such an infection could rapidly exhaust the shared resource of
					the single IPv4 address for all connected subscribers. It is therefore necessary
					to impose limits on the total number of ports available to an individual
					subscriber to ensure that the shared resource (the IPv4 address) remains
					available in some capacity to all the subscribers using it.
</p>
<a name="IncomingPorts"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Incoming Ports</h3>

<p> It is desirable to ensure that incoming ports remain stable over time. This is
					challenging as the network doesn't know anything in particular about the
					applications that it is supporting and therefore has no real notion of how long
					an application/service session is still ongoing and therefore requiring port
					stability.
</p>
<p> Early measurements <a class='info' href='#CGN_Viability'>[CGN_Viability]<span> (</span><span class='info'>Alcock, S., &ldquo;Research into the Viability of Service-Provider NAT,&rdquo; 2008.</span><span>)</span></a> also seem to indicate that, on
					average, only very few ports are used by subscribers for incoming connections.
					However, a majority of subscribers accept at least one inbound connection. 
</p>
<p>This means that it is not necessary to pre-allocate a large number of incoming
					ports to each subscriber. It is possible to either pre-allocate a small number
					of ports for incoming connections or do port allocation on demand when the
					application wishing to receive a connection is initiated. The bulk of incoming
					ports can be reserved as a centralized resource shared by all subscribers using
					a given public IPv4 address.
</p>
<a name="PortNegotiation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
Port Negotiation</h3>

<p>In current deployments, one important and widely used feature of many CPE
						devices is the ability to open incoming ports (port forwarding) either
						manually, or with a protocol such as UPnP IGD. If a CGN is present, the port
						must also be open in the CGN. The situation may be alleviated somewhat if
						the CGN architecture is composed of only one NAT level (no NAT in the CPE)
						as for DS-Lite, although a service provider operating this solution will
						still be required to offer some means for configuring incoming ports by
						their subscribers. This may be either via a UPnP or NAT-PMP relay over a
						tunnelled direct connection between the CPE and CGN, or a web interface to
						configure the incoming port mapping on the CGN. Note, that such an interface
						effectively makes public what was previously a private management interface
						and this raises security concerns that must be addressed.
</p>
<p>For port-range solutions, port forwarding capabilities may still be present
						at the CPE, with the limitation that the open incoming port must be within
						the allocated port-range (for instance it is not possible to open port 5002
						for incoming connections if port 5002 is not within the allocated
						port-range).
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.1"></a><h3>5.2.1.1.&nbsp;
Universal Plug and Play (UPnP)</h3>

<p>Using the UPnP semantic, an application asks "I want to use port number
							X, is that ok?" and the answer is yes or no. If the answer is no, the
							application will typically try the next port in sequence, until it
							either finds one that works or gives up after a limited number of
							attempts. UPnP has, currently, no way to redirect the application to use
							another port number. UPnP IGD 2.0, currently being defined, should
							improve this and allow for allocation of any available port.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1.2"></a><h3>5.2.1.2.&nbsp;
NAT Port Mapping Protocol (NAT-PMP)</h3>

<p>NAT-PMP already has a better semantic here, enabling the NAT to redirect
							the application to an available port number.
</p>
<a name="WKP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
Connection to a Well-Known Port Number</h3>

<p>Once an IPv4 address sharing mechanism is in place, connections to well-known
						port numbers will not work in the general case. Any application that is not
						port-agile cannot be expected to work. Some workaround (e.g. redirects to a
						port-specific URI) could be deployed given sufficient incentives. There
						exist several proposals for 'application service location' protocols which
						would provide a means of addressing this problem, but historically these
						proposals have not gained much deployment traction.
</p>
<p> For example, the use of DNS SRV records <a class='info' href='#RFC2782'>[RFC2782]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> provides a
						potential solution for subscribers wishing to host services in the presence
						of a shared-addressing scheme. SRV records make it possible to specify a
						port value related to a service, thereby making services accessible on ports
						other than the Well-Known ports. It is worth noting that this mechanism is
						not applicable to HTTP. 
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Impact on Applications</h3>

<p> Address sharing solutions will have an impact on the following types of
				applications: </p>
<ul class="text">
<li>Applications that establish inbound communications - these applications will
						have to ensure that ports selected for inbound communications are either
						within the allocated range (for port-range solutions) or are forwarded
						appropriately by the CGN (for CGN-based solutions). See <a class='info' href='#IncomingPorts'>Section&nbsp;5.2<span> (</span><span class='info'>Incoming Ports</span><span>)</span></a> for more discussion of this;
</li>
<li>Applications that carry address and/or port information in their payload -
						where translation of port and/or address information is performed at the IP
						and transport layers by the address sharing solution, an ALG will also be
						required to ensure application layer data is appropriately modified;
</li>
<li>Applications that use fixed ports (e.g. well-known ports) - see <a class='info' href='#WKP'>Section&nbsp;5.2.2<span> (</span><span class='info'>Connection to a Well-Known Port Number</span><span>)</span></a> for more discussion of this;
</li>
<li>Applications that do not use any port (e.g. ICMP) - where address sharing
						solutions map subscribers to (private) IP addresses on a one-to-one basis
						this will not be an issue, otherwise such applications will require special
						handling - see <a class='info' href='#ICMP'>Section&nbsp;9<span> (</span><span class='info'>ICMP</span><span>)</span></a> for more discussion of this;
</li>
<li>Applications that assume the uniqueness of source addresses (e.g. IP address
						as identifier) - such applications will fail to operate correctly in the
						presence of multiple, discrete, simultaneous connections from the same
						source IP address;
</li>
<li>Applications that explicitly prohibit concurrent connections from the same
						address - such applications will fail when multiple subscribers sharing an
						IP address attempt to use them simultaneously.
</li>
<li>Applications that do not use TCP or UDP for transport - All IP address
						sharing mechanisms proposed to date are limited to TCP, UDP, and ICMP,
						thereby preventing end users from fully utilizing the Internet (e.g., SCTP,
						DCCP, RSVP, protocol 41 (IPv6-over-IPv4), protocol 50 (IPsec ESP)).
</li>
</ul><p>
			
</p>
<p> Applications already frequently implement mechanisms in order to circumvent the
				presence of NATs (typically CPE NATs): </p>
<ul class="text">
<li> Application Layer Gateways (ALGs): Many CPE devices today embed ALGs that
						allow applications to behave correctly despite the presence of NAT on the
						CPE. When the NAT belongs to the subscriber, the subscriber has flexibility
						to tailor the device to his or her needs. For CGNs, subscribers will be
						dependent on the set of ALGs that their service provider makes available. A
						service provider-based NAT may, or may not, support NAT-traversal for IKE
							<a class='info' href='#RFC3947'>[RFC3947]<span> (</span><span class='info'>Kivinen, T., Swander, B., Huttunen, A., and V. Volpe, &ldquo;Negotiation of NAT-Traversal in the IKE,&rdquo; January&nbsp;2005.</span><span>)</span></a> for example. For port-range solutions, ALGs
						will require modification to deal with the port-range restriction, but will
						otherwise have the same capabilities as today. 
</li>
<li>NAT Traversal Techniques: There are several commonly-deployed mechanisms that
						support operating servers behind a NAT by forwarding specific TCP or UDP
						ports to specific internal hosts (<a class='info' href='#UPnP-IGD'>[UPnP&#8209;IGD]<span> (</span><span class='info'>UPnP Forum, &ldquo;Universal Plug and Play (UPnP) Internet Gateway Device (IGD),&rdquo; November&nbsp;2001.</span><span>)</span></a>, <a class='info' href='#I-D.cheshire-nat-pmp'>[I&#8209;D.cheshire&#8209;nat&#8209;pmp]<span> (</span><span class='info'>Cheshire, S., &ldquo;NAT Port Mapping Protocol (NAT-PMP),&rdquo; April&nbsp;2008.</span><span>)</span></a>, and manual configuration). All of these
						mechanisms assume the NAT's WAN address is a publicly-routable IP address,
						and fail to work normally when that assumption is wrong. There have been
						attempts to avoid that problem by automatically disabling the NAT function
						and bridging traffic instead upon assignment of a private IP address to the
						WAN interface (as is required for <a class='info' href='#Windows-Logo'>[Windows&#8209;Logo]<span> (</span><span class='info'>Microsoft, &ldquo;Windows Logo Program Device Requirements,&rdquo; 2006.</span><span>)</span></a>
						certification). Bridging (rather than NATting) has other side effects (DHCP
						requests are served by an upstream DHCP server which can increase complexity
						of in-home networking).
</li>
</ul><p>
			
</p>
<a name="Geoloc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Geo-location and Geo-proximity</h3>

<p>IP addresses are frequently used to indicate, with some level of granularity and some
				level of confidence, where a host is physically located. Geo-location services are
				used by content providers to allow them to conform with regional content licensing
				restrictions, to target advertising at specific geographic areas, or to provide
				customised content. Geo-location services are also necessary for emergency services
				provision. In some deployment contexts (e.g. centralised CGN), shared addressing
				will reduce the level of confidence and level of location granularity that IP-based
				geo-location services can provide. Viewed from the content provider, a subscriber
				behind a CGN geolocates to wherever the prefix of the CGN appears to be; very often
				that will be in a different city, and sometimes in a different country, than the
				subscriber. Other forms of geo-location will still work as usual.
</p>
<p>A slightly different use of an IP address is to calculate the proximity of a
				connecting host to a particular service delivery point. This use of IP address
				information impacts the efficient delivery of content to an end-user. If a CGN is
				introduced in communications and it is far from an end-user connected to it,
				application performance may be degraded insofar as IP-based geo-proximity is a
				factor.
</p>
<a name="Usage"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Tracking Service Usage</h3>

<p>As large-scale address sharing becomes more commonplace, monitoring the number of
				unique users of a service will become more complex than simply counting the number
				of connections from unique IP addresses. While this is a somewhat inexact
				methodology today due to the widespread use of CPE NAT, it will become a much less
				useful approach in the presence of widespread large-scale address sharing solutions.
				In general, all elements that monitor usage or abusage in the chain between a
				service provider that has deployed address sharing and a content provider will need
				to be upgraded to take account of the port value in addition to IP addresses.
</p>
<a name="ICMP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
ICMP</h3>

<p>ICMP does not carry any port information and is consequently problematic for address
				sharing mechanisms. Sourcing ICMP from hosts behind an address sharing solution does
				not pose problems, although responses to outgoing ICMP will require special
				handling, such as making use of the ICMP identifier value to route the response
				appropriately.
</p>
<p>For inbound ICMP there are two cases. The first case is that of ICMP sourced from
				outside the network of the address sharing solution provider. Several applications
				make use of this (e.g. P2P applications) and measurements derived by such
				applications in the presence of an address sharing solution will be erroneous. The
				second case is that of ICMP sourced from within the network of the address sharing
				solution provider (e.g. for network management and diagnostic purposes). In this
				case ICMP can be routed normally for CGN-based solutions owing to the presence of
				locally unique private IP addresses for each CPE device. For port-range solutions,
				ICMP will not be routable without special handling, e.g. placing a port number in
				the ICMP identifier field, and having port-range routers make routing decisions
				based upon that field. 
</p>
<p>Another concern relating to ICMP in the presence of large-scale address sharing is
				that a malevolent user could send an ICMP "Packet Too Big" (Type 3, Code 4) message
				indicating a Next-Hop MTU of anything down to 68 octets. This value will be cached
				by the off-net server for all subscribers sharing the address of the malevolent
				user. This could lead to a DoS against both the remote server and the large-scale
				NAT device itself (as they will both have to handle many more packets per
				second).
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Fragmentation</h3>

<p>When a packet is fragmented, transport-layer port information (either UDP or TCP) is
				only present in the first fragment. Subsequent fragments will not carry the port
				information and so will require special handling.
</p>
<a name="Traceability"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Traceability</h3>

<p>In many jurisdictions, service providers are legally obliged to provide the identity
				of a subscriber upon request to the appropriate authorities. Where one public IPv4
				address is shared between several subscribers, the knowledge of the IP address alone
				is not enough to identify the appropriate subscriber. The legal request should
				include the information: [IP address - Port - Protocol- Timestamp] (this does not
				preclude the possibility that a real legal request may include additional
				information). Accurate time-keeping (e.g. use of NTP or SNTP) is vital because port
				assignments are dynamic. A densely populated CGN could mean even very small amounts
				of clock skew between a content provider and the CGN operator will result in
				ambiguity about which customer was using a specific port at a given time.
</p>
<p>Considering that it is unrealistic to expect all servers to start logging port
				information of connection attempts, address sharing service providers may need to
				start logging IP destination addresses as well, giving rise to privacy concerns.
</p>
<p>If multiple subscribers are accessing the same (popular) server at nearly the same
				time, it can be impossible to disambiguate which subscriber accessed the server,
				especially with protocols that involve several connections (e.g. HTTP). Thus,
				logging the destination address on the NAT is inferior to logging the source port at
				the server.
</p>
<p>If the server is not logging source port numbers and the NAT is not logging
				destination IP addresses, the service provider cannot trace the offending activity
				to a specific subscriber. In this circumstance, the service provider would need to
				disclose the identity of all subscribers who had active sessions on the NAT during
				the time period in question. This may be a large number of subscribers.
</p>
<p>Address sharing solutions must record and store all mappings (typically during 6
				months to one year, depending on the jurisdiction) that they create. If we consider
				one mapping per session, a service provider should record and retain traces of all
				sessions created by all subscribers during one year (if the legal storage duration
				is one year). This may be challenging due to the volume of data requiring storage,
				the volume of data to repeatedly transfer to the storage location, and the volume of
				data to search in response to a query.
</p>
<p>Address sharing solutions may mitigate these issues to some extent by pre-allocating
				groups of ports. Then only the allocation of the group needs to be recorded, and not
				the creation of every session binding within that group. There are trade-offs to be
				made between the sizes of these groups, the ratio of public addresses to
				subscribers, whether or not these groups timeout, the impact on logging requirements
				and port randomisation security.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Security</h3>

<p>Before noting some specific security-related issues caused by large-scale address
				sharing, it is perhaps worth noting that, in general, address sharing creates a
				vector for attack amplification in numerous ways. See <a class='info' href='#ICMP'>Section&nbsp;9<span> (</span><span class='info'>ICMP</span><span>)</span></a> for one
				example.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Abuse Logging and Penalty Boxes</h3>

<p>When an abuse is reported today, it is usually done in the form: IPv4 address X
					has done something bad at time T0. This is not enough information to uniquely
					identify the subscriber responsible for the abuse when that IPv4 address is
					shared by more than one subscriber. Law enforcement authorities may be
					particularly impacted because of this. This particular issue can be fixed by
					logging port numbers, although this will increase logging data storage
					requirements.
</p>
<p>A number of services on the network today log the IPv4 source addresses used in
					connection attempts to protect themselves from certain attacks. For example, if
					a server sees too many requests from the same IPv4 address in a short period of
					time, it may decide to put that address in a penalty box for a certain time
					during which requests are denied, or it may require completion of a CAPTCHA for
					future requests. If an IPv4 address is shared by multiple subscribers, this
					would have unintended consequences in a couple of ways. First it may become the
					natural behavior to see many login attempts from the same address because it is
					now shared across a potentially large number of subscribers. Second and more
					likely is that one user who fails a number of login attempts may block out other
					users who have not made any previous attempts but who will now fail on their
					first attempt. In the presence of widespread large-scale address sharing,
					penalty box solutions to service abuse simply will not work.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
Authentication</h3>

<p> Simple address-based identification mechanisms that are used to populate access
					control lists will fail when an IP address is no longer sufficient to identify a
					particular subscriber. Including port numbers in access control list definitions
					may be possible at the cost of extra complexity, and may also require the
					service provider to make static port assignments, which conflicts with the
					requirement for dynamic assignments discussed in <a class='info' href='#OutgoingPorts'>Section&nbsp;5.1<span> (</span><span class='info'>Outgoing Ports</span><span>)</span></a>
					. 
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3"></a><h3>12.3.&nbsp;
Spam</h3>

<p>Another case of identifying abusers has to do with spam blacklisting. When a
					spammer is behind a CGN or using a port-shared address, blacklisting of their IP
					address will result in all other subscribers sharing that address having their
					ability to source SMTP packets restricted to some extent.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.4"></a><h3>12.4.&nbsp;
Port Randomisation</h3>

<p> A blind attack that can be performed against TCP relies on the attacker's
					ability to guess the 5-tuple (Protocol, Source Address, Destination Address,
					Source Port, Destination Port) that identifies the transport protocol instance
					to be attacked. <a class='info' href='#I-D.ietf-tsvwg-port-randomization'>[I&#8209;D.ietf&#8209;tsvwg&#8209;port&#8209;randomization]<span> (</span><span class='info'>Larsen, M. and F. Gont, &ldquo;Transport Protocol Port Randomization Recommendations,&rdquo; May&nbsp;2010.</span><span>)</span></a> describes a
					number of methods for the random selection of the source port number, such that
					the ability of an attacker to correctly guess the 5-tuple is reduced. With
					shared IPv4 addresses, the port selection space is reduced. Preserving port
					randomisation is important and may be more or less difficult depending on the
					address sharing solution and the size of the port space that is being
					manipulated. Allocation of non-contiguous port ranges could help to mitigate
					this issue. 
</p>
<p>It should be noted that guessing the port information may not be sufficient to
					carry out a successful blind attack. The exact TCP Sequence Number (SN) should
					also be known. A TCP segment is processed only if all previous segments have
					been received, except for some Reset Segment implementations which immediately
					process the Reset as long as it is within the Window. If SN is randomly chosen
					it will be difficult to guess it (SN is 32 bits long); port randomisation is one
					protection among others against blind attacks.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.5"></a><h3>12.5.&nbsp;
IPsec</h3>

<p> The impact of large-scale IP address sharing for IPsec operation should be
					evaluated and assessed. <a class='info' href='#RFC3947'>[RFC3947]<span> (</span><span class='info'>Kivinen, T., Swander, B., Huttunen, A., and V. Volpe, &ldquo;Negotiation of NAT-Traversal in the IKE,&rdquo; January&nbsp;2005.</span><span>)</span></a> proposes a solution to solve
					issues documented in <a class='info' href='#RFC3715'>[RFC3715]<span> (</span><span class='info'>Aboba, B. and W. Dixon, &ldquo;IPsec-Network Address Translation (NAT) Compatibility Requirements,&rdquo; March&nbsp;2004.</span><span>)</span></a> . The applicability of <a class='info' href='#RFC3947'>[RFC3947]<span> (</span><span class='info'>Kivinen, T., Swander, B., Huttunen, A., and V. Volpe, &ldquo;Negotiation of NAT-Traversal in the IKE,&rdquo; January&nbsp;2005.</span><span>)</span></a> in the context of shared IP address solutions should be
					evaluated. In particular, service providers may wish to ensure that CGN
					deployments do not inadvertently block NAT traversal for security protocols such
					as IKE (refer to <a class='info' href='#I-D.gont-behave-nat-security'>[I&#8209;D.gont&#8209;behave&#8209;nat&#8209;security]<span> (</span><span class='info'>Gont, F. and P. Srisuresh, &ldquo;Security implications of Network Address Translators (NATs),&rdquo; October&nbsp;2009.</span><span>)</span></a> for more
					information). 
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.6"></a><h3>12.6.&nbsp;
Policing Forwarding Behaviour</h3>

<p>
					<a class='info' href='#RFC2827'>[RFC2827]<span> (</span><span class='info'>Ferguson, P. and D. Senie, &ldquo;Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing,&rdquo; May&nbsp;2000.</span><span>)</span></a> motivates and discusses a simple, effective, and
					straightforward method for using ingress traffic filtering to prohibit
					Denial-of-Service (DoS) attacks which use forged IP addresses. Following this
					recommendation, service providers operating shared-addressing mechanisms should
					ensure that source addresses, or source ports in the case of port-range schemes,
					are set correctly in outgoing packets from their subscribers or they should drop
					the packets. 
</p>
<p>If some form of IPv6 ingress filtering is deployed in the broadband network and
					DS-Lite service is restricted to those subscribers, then tunnels terminating at
					the CGN and coming from registered subscriber IPv6 addresses cannot be spoofed.
					Thus a simple access control list on the tunnel transport source address is all
					that is required to accept traffic on the southbound interface of a CGN.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
TCP Control Block Sharing</h3>

<p><a class='info' href='#RFC2140'>[RFC2140]<span> (</span><span class='info'>Touch, J., &ldquo;TCP Control Block Interdependence,&rdquo; April&nbsp;1997.</span><span>)</span></a> defines a performance optimisation for TCP based on sharing
				state between TCP control blocks that pertain to connections to the same host, as
				opposed to maintaining state for each discrete connection. This optimisation assumes
				that an address says something about the properties of the path between two hosts,
				which is clearly not the case if the address in question is shared by multiple hosts
				at different physical network locations. While CPE NAT today causes problems for
				sharing TCP control block state across multiple connections to a given IP address,
				large-scale address sharing will make these issues more severe and more widespread.
			
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
Reverse DNS</h3>

<p>Many service providers populate forward and reverse DNS zones for the public IPv4
				addresses that they allocate to their subscribers. In the case where public
				addresses are shared across multiple subscribers, such strings are, by definition,
				no longer sufficient to identify an individual subscriber without additional
				information.
</p>
<a name="LoadBalancing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
Load Balancing</h3>

<p> Algorithms used to balance traffic load for popular destinations may be affected by
				the introduction of address sharing. Where balancing is achieved by
				deterministically routing traffic from specific source IP addresses to specific
				servers, sudden imbalances in load may be experienced as address sharing is enabled
				for some of those source IP addresses. This will require re-evaluation of the
				algorithms used in the load-balancing design. In general, as the scale of address
				sharing grows, load-balancing designs will need to be re-evaluated and any
				assumptions about average load per source IP address revisited. 
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16"></a><h3>16.&nbsp;
IPv6 Transition Issues</h3>

<p>IPv4 address sharing solutions may interfere with existing IPv4 to IPv6 transition
				mechanisms, which were not designed with IPv4 shortage considerations in mind. With
				port-range solutions for instance, incoming 6to4 packets should be able to find
				their way from a 6to4 relay to the appropriate 6to4 CPE router, despite the lack of
				direct port range information (UDP/TCP initial source port did not pass through the
				CPE port range translation process). One solution would be for a 6to4 IPv6 address
				to embed not only an IPv4 address but also a port range value.
</p>
<p>Subscribers allocated with private addresses will not be able to utilise 6to4 to
				access IPv6, but may be able to utilise Teredo.
</p>
<p>Shared addresses should be drawn from space designated as such <a class='info' href='#RFC1918'>[RFC1918]<span> (</span><span class='info'>Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G., and E. Lear, &ldquo;Address Allocation for Private Internets,&rdquo; February&nbsp;1996.</span><span>)</span></a>. Otherwise their use will break the widely implemented assumption that public
				IPv4 addresses are globally unique addresses and hence break many protocols and
				applications, e.g. 6to4 <a class='info' href='#RFC3056'>[RFC3056]<span> (</span><span class='info'>Carpenter, B. and K. Moore, &ldquo;Connection of IPv6 Domains via IPv4 Clouds,&rdquo; February&nbsp;2001.</span><span>)</span></a>. Some routers enable 6to4 on their
				WAN link. 6to4 requires a publicly-routable IPv4 address. Enabling 6to4 when the
				apparently public IPv4 WAN address is in fact behind a NAT creates a disconnected
				IPv6 island. Issues created by sharing public address space across multiple hosts
				are specifically addressed in <a class='info' href='#I-D.thaler-port-restricted-ip-issues'>[I&#8209;D.thaler&#8209;port&#8209;restricted&#8209;ip&#8209;issues]<span> (</span><span class='info'>Thaler, D., &ldquo;Issues With Port-Restricted IP Addresses,&rdquo; February&nbsp;2010.</span><span>)</span></a>.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.17"></a><h3>17.&nbsp;
Introduction of Single Points of Failure</h3>

<p>In common with all deployments of new network functionality, the introduction of new
				nodes or functions to handle the multiplexing of multiple subscribers across shared
				IPv4 addresses could create single points of failure in the network. Any IP address
				sharing solution should consider the opportunity to add redundancy features in order
				to alleviate the impact on the robustness of the offered IP connectivity service.
				The ability of the solution to allow hot swapping from one machine to another should
				be considered. This is especially important where the address sharing solution in
				question requires the creation of per-flow state in the network.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.18"></a><h3>18.&nbsp;
State Maintenance Reduces Battery Life</h3>

<p>In order for hosts to maintain network state in the presence of NAT, keep-alive
				messages have to be sent at frequent intervals. For battery-powered devices, sending
				these keep-alive messages can result in significantly reduced battery performance
				than would otherwise be the case <a class='info' href='#Mobile_Energy_Consumption'>[Mobile_Energy_Consumption]<span> (</span><span class='info'>Haverinen, H., Siren, J., and P. Eronen, &ldquo;Energy Consumption of Always-On Applications in WCDMA Networks,&rdquo; 2007.</span><span>)</span></a>.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.19"></a><h3>19.&nbsp;
Support of Multicast</h3>

<p>
				<a class='info' href='#RFC5135'>[RFC5135]<span> (</span><span class='info'>Wing, D. and T. Eckert, &ldquo;IP Multicast Requirements for a Network Address Translator (NAT) and a Network Address Port Translator (NAPT),&rdquo; February&nbsp;2008.</span><span>)</span></a> specifies requirements for a NAT that supports Any Source
				IP Multicast or Source-Specific IP Multicast. Port-range routers that form part of
				port-range solutions will need to support similar requirements if multicast support
				is required. 
</p>
<p>[Placeholder for more details of impact of address sharing on multicast
				deployments.]
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.20"></a><h3>20.&nbsp;
Support of Mobile-IP</h3>

<p>IP address sharing within the context of Mobile-IP deployments (in the home network
				and/or in the visited network), will require Home Agents and/or Foreign Agents to be
				updated so as to take into account the relevant port information. There may also be
				issues raised when an additional layer of encapsulation is required thereby causing,
				or increasing the need for, fragmentation and reassembly.
</p>
<p>Issues for Mobile-IP in the presence of NAT are discussed in <a class='info' href='#I-D.haddad-mext-nat64-mobility-harmful'>[I&#8209;D.haddad&#8209;mext&#8209;nat64&#8209;mobility&#8209;harmful]<span> (</span><span class='info'>Haddad, W. and C. Perkins, &ldquo;A Note on NAT64 Interaction with Mobile IPv6,&rdquo; April&nbsp;2010.</span><span>)</span></a>
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.21"></a><h3>21.&nbsp;
IANA Considerations</h3>

<p>This memo includes no request to IANA.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.22"></a><h3>22.&nbsp;
Security Considerations</h3>

<p> This memo does not define any protocol and raises no security issues. <a class='info' href='#Security'>Section&nbsp;12<span> (</span><span class='info'>Security</span><span>)</span></a> discusses some of the security and identity-related
				implications of address sharing. 
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.23"></a><h3>23.&nbsp;
Contributors</h3>

<p>This document is based on sources co-authored by J.L. Grimault and A. Villefranque of
				France Telecom.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.24"></a><h3>24.&nbsp;
Acknowledgements</h3>

<p>This memo was partly inspired by conversations that took place as part of Internet
				Society (ISOC) hosted roundtable events for operators and content providers
				deploying IPv6. Participants in those discussions included John Brzozowski, Leslie
				Daigle, Tom Klieber, Yiu Lee, Kurtis Lindqvist, Wes George, Lorenzo Colliti, Erik
				Kline, Igor Gashinsky, Jason Fesler, Rick Reed, Adam Bechtel, Larry Campbell, Tom
				Coffeen, David Temkin, Pete Gelbman, Mark Winter, Will Charnock, Martin Levy, Greg
				Wood and Christian Jacquenet. The authors are also grateful to Christian Jacquenet,
				Iain Calder, Joel Halpern, Brian Carpenter, Gregory Lebovitz, Bob Briscoe, Marcelo
				Bagnulo and Dan Wing for their helpful comments and suggestions for improving this
				document. 
</p>
<p>This memo was created using the xml2rfc tool.
</p>
<a name="Annex"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.25"></a><h3>25.&nbsp;
Annex</h3>

<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.25.1"></a><h3>25.1.&nbsp;
Classes of Address Sharing Solution</h3>

<p> IP address sharing solutions fall into two classes. Either a service-provider
					operated NAT function is introduced and subscribers are allocated addresses from
						<a class='info' href='#RFC1918'>[RFC1918]<span> (</span><span class='info'>Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G., and E. Lear, &ldquo;Address Allocation for Private Internets,&rdquo; February&nbsp;1996.</span><span>)</span></a> space, or public IPv4 addresses are shared across
					multiple subscribers by restricting the range of ports available to each
					subscriber. These classes of solution are described in a bit more detail below.
						</p>
<ul class="text">
<li> CGN-based solutions: These solutions propose the introduction of a NAPT
							function in the service provider's network, denoted also as Carrier
							Grade NAT (CGN), or Large Scale NAT (LSN) <a class='info' href='#I-D.nishitani-cgn'>[I&#8209;D.nishitani&#8209;cgn]<span> (</span><span class='info'>Yamagata, I., Nishitani, T., Miyakawa, S., Nakagawa, A., and H. Ashida, &ldquo;Common requirements for IP address sharing schemes,&rdquo; March&nbsp;2010.</span><span>)</span></a> , or Provider NAT. The CGN is
							responsible for translating private addresses to publicly routable
							addresses. Private addresses are assigned to subscribers, a pool of
							public addresses is assigned to the CGN, and the number of public
							addresses is smaller than the number of subscribers. A public IPv4
							address in the CGN pool is shared by several subscribers at the same
							time. Solutions making use of a service provider-based NAT include <a class='info' href='#I-D.shirasaki-nat444'>[I&#8209;D.shirasaki&#8209;nat444]<span> (</span><span class='info'>Yamagata, I., Shirasaki, Y., Nakagawa, A., Yamaguchi, J., and H. Ashida, &ldquo;NAT444,&rdquo; March&nbsp;2010.</span><span>)</span></a> (two layers of NAT) and <a class='info' href='#I-D.ietf-softwire-dual-stack-lite'>[I&#8209;D.ietf&#8209;softwire&#8209;dual&#8209;stack&#8209;lite]<span> (</span><span class='info'>Durand, A., Droms, R., Haberman, B., Woodyatt, J., Lee, Y., and R. Bush, &ldquo;Dual-Stack Lite Broadband Deployments Following IPv4 Exhaustion,&rdquo; March&nbsp;2010.</span><span>)</span></a> (a single layer of
							NAT). 
</li>
<li> Port-range solutions: These solutions avoid the presence of a CGN
							function. A single public IPv4 address is assigned to several
							subscribers at the same time. A restricted port range is also assigned
							to each subscriber so that two subscribers with the same IPv4 address
							have two different port ranges that do not overlap. These solutions are
							called A+P (Address+Port) <a class='info' href='#I-D.ymbk-aplusp'>[I&#8209;D.ymbk&#8209;aplusp]<span> (</span><span class='info'>Bush, R., &ldquo;The A+P Approach to the IPv4 Address Shortage,&rdquo; October&nbsp;2009.</span><span>)</span></a> , or Port
							Range <a class='info' href='#I-D.boucadair-port-range'>[I&#8209;D.boucadair&#8209;port&#8209;range]<span> (</span><span class='info'>Boucadair, M., Levis, P., Bajko, G., and T. Savolainen, &ldquo;IPv4 Connectivity Access in the Context of IPv4 Address Exhaustion: Port Range based IP Architecture,&rdquo; July&nbsp;2009.</span><span>)</span></a> , or SAM (Stateless
							Address Mapping) <a class='info' href='#I-D.despres-sam'>[I&#8209;D.despres&#8209;sam]<span> (</span><span class='info'>Despres, R., &ldquo;Scalable Multihoming across IPv6 Local-Address Routing Zones Global-Prefix/Local-Address Stateless Address Mapping (SAM),&rdquo; July&nbsp;2009.</span><span>)</span></a> . 
</li>
</ul><p>
				
</p>
<a name="asmf"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.25.2"></a><h3>25.2.&nbsp;
Address Space Multiplicative Factor</h3>

<p>The purpose of sharing public IPv4 addresses is to increase the addressing space.
					A key parameter is the factor by which service providers want or need to
					multiply their IPv4 public address space; and the consequence is the number of
					subscribers sharing the same public IPv4 address. We refer to this parameter as
					the address space multiplicative factor, the inverse is called the compression
					ratio. 
</p>
<p> The multiplicative factor can only be applied to the subset of subscribers that
					are eligible for a shared address. The reasons a subscriber cannot have a shared
					address can be: </p>
<ul class="text">
<li>It would not be compatible with the service they are currently subscribed
							to (for example: business subscriber).
</li>
<li>Subscriber CPE is not compatible with the address sharing solution
							selected by the service provider (for example it does not handle port
							restriction for port-range solutions or it does not allow IPv4 in IPv6
							encapsulation for the DS-Lite solution), and its replacement is not
							easy.
</li>
</ul><p>
				
</p>
<p>Different service providers may have very different needs. A long-lived service
					provider, whose number of subscribers is rather stable, may have an existing
					address pool that will only need a small extension to cope with the next few
					years, assuming that this address pool can be re-purposed for an address sharing
					solution (small multiplicative factor, less than 10). A new entrant or a new
					line of business will need a much bigger multiplicative factor (e.g. 1000). A
					mobile operator may see its addressing needs grow dramatically as the IP-enabled
					mobile handset market grows.
</p>
<p> When the multiplicative factor is large, the average number of ports per
					subscriber is small. Given the large measured disparity between average and peak
					port consumption <a class='info' href='#CGN_Viability'>[CGN_Viability]<span> (</span><span class='info'>Alcock, S., &ldquo;Research into the Viability of Service-Provider NAT,&rdquo; 2008.</span><span>)</span></a> , this will create service
					problems in the event that ports are allocated statically. In this case, it is
					essential for port allocation to map to need as closely as possible, and to
					avoid allocating ports for longer than necessary. Therefore, the larger the
					multiplicative factor, the more dynamic the port assignment has to be. 
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>26.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CGN_Viability">[CGN_Viability]</a></td>
<td class="author-text">Alcock, S., &ldquo;<a href="http://www.wand.net.nz/~salcock/someisp/flow_counting/result_page.html">Research into the Viability of Service-Provider NAT</a>,&rdquo; 2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.boucadair-port-range">[I-D.boucadair-port-range]</a></td>
<td class="author-text">Boucadair, M., Levis, P., Bajko, G., and T. Savolainen, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-boucadair-port-range-02.txt">IPv4 Connectivity Access in the Context of IPv4 Address Exhaustion: Port Range based IP Architecture</a>,&rdquo; draft-boucadair-port-range-02 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-boucadair-port-range-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.cheshire-nat-pmp">[I-D.cheshire-nat-pmp]</a></td>
<td class="author-text">Cheshire, S., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-cheshire-nat-pmp-03.txt">NAT Port Mapping Protocol (NAT-PMP)</a>,&rdquo; draft-cheshire-nat-pmp-03 (work in progress), April&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-cheshire-nat-pmp-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.despres-sam">[I-D.despres-sam]</a></td>
<td class="author-text">Despres, R., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-despres-sam-03.txt">Scalable Multihoming across IPv6 Local-Address Routing Zones Global-Prefix/Local-Address Stateless Address Mapping (SAM)</a>,&rdquo; draft-despres-sam-03 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-despres-sam-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.gont-behave-nat-security">[I-D.gont-behave-nat-security]</a></td>
<td class="author-text">Gont, F. and P. Srisuresh, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-gont-behave-nat-security-03.txt">Security implications of Network Address Translators (NATs)</a>,&rdquo; draft-gont-behave-nat-security-03 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-gont-behave-nat-security-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.haddad-mext-nat64-mobility-harmful">[I-D.haddad-mext-nat64-mobility-harmful]</a></td>
<td class="author-text">Haddad, W. and C. Perkins, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-haddad-mext-nat64-mobility-harmful-01.txt">A Note on NAT64 Interaction with Mobile IPv6</a>,&rdquo; draft-haddad-mext-nat64-mobility-harmful-01 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-haddad-mext-nat64-mobility-harmful-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</a></td>
<td class="author-text">Li, X., Bao, C., and F. Baker, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-20.txt">IP/ICMP Translation Algorithm</a>,&rdquo; draft-ietf-behave-v6v4-xlate-20 (work in progress), May&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-20.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-v6v4-xlate-stateful">[I-D.ietf-behave-v6v4-xlate-stateful]</a></td>
<td class="author-text">Bagnulo, M., Matthews, P., and I. Beijnum, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-stateful-11.txt">Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers</a>,&rdquo; draft-ietf-behave-v6v4-xlate-stateful-11 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-stateful-11.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-softwire-dual-stack-lite">[I-D.ietf-softwire-dual-stack-lite]</a></td>
<td class="author-text">Durand, A., Droms, R., Haberman, B., Woodyatt, J., Lee, Y., and R. Bush, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-softwire-dual-stack-lite-04.txt">Dual-Stack Lite Broadband Deployments Following IPv4 Exhaustion</a>,&rdquo; draft-ietf-softwire-dual-stack-lite-04 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-softwire-dual-stack-lite-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-tsvwg-port-randomization">[I-D.ietf-tsvwg-port-randomization]</a></td>
<td class="author-text">Larsen, M. and F. Gont, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-port-randomization-08.txt">Transport Protocol Port Randomization Recommendations</a>,&rdquo; draft-ietf-tsvwg-port-randomization-08 (work in progress), May&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-port-randomization-08.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.nishitani-cgn">[I-D.nishitani-cgn]</a></td>
<td class="author-text">Yamagata, I., Nishitani, T., Miyakawa, S., Nakagawa, A., and H. Ashida, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-nishitani-cgn-04.txt">Common requirements for IP address sharing schemes</a>,&rdquo; draft-nishitani-cgn-04 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-nishitani-cgn-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.shirasaki-nat444">[I-D.shirasaki-nat444]</a></td>
<td class="author-text">Yamagata, I., Shirasaki, Y., Nakagawa, A., Yamaguchi, J., and H. Ashida, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-shirasaki-nat444-01.txt">NAT444</a>,&rdquo; draft-shirasaki-nat444-01 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-shirasaki-nat444-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.thaler-port-restricted-ip-issues">[I-D.thaler-port-restricted-ip-issues]</a></td>
<td class="author-text">Thaler, D., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-thaler-port-restricted-ip-issues-00.txt">Issues With Port-Restricted IP Addresses</a>,&rdquo; draft-thaler-port-restricted-ip-issues-00 (work in progress), February&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-thaler-port-restricted-ip-issues-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ymbk-aplusp">[I-D.ymbk-aplusp]</a></td>
<td class="author-text">Bush, R., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ymbk-aplusp-05.txt">The A+P Approach to the IPv4 Address Shortage</a>,&rdquo; draft-ymbk-aplusp-05 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ymbk-aplusp-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IPv4_Report">[IPv4_Report]</a></td>
<td class="author-text">Huston, G., &ldquo;<a href="http://www.potaroo.net/tools/ipv4/index.html">IPv4 Address Report</a>,&rdquo; 2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="Mobile_Energy_Consumption">[Mobile_Energy_Consumption]</a></td>
<td class="author-text">Haverinen, H., Siren, J., and P. Eronen, &ldquo;<a href="http://research.nokia.com/node/5597">Energy Consumption of Always-On Applications in WCDMA Networks</a>,&rdquo; 2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1337">[RFC1337]</a></td>
<td class="author-text"><a href="mailto:EMail: Braden@ISI.EDU">Braden, B.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1337">TIME-WAIT Assassination Hazards in TCP</a>,&rdquo; RFC&nbsp;1337, May&nbsp;1992 (<a href="http://www.rfc-editor.org/rfc/rfc1337.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1918">[RFC1918]</a></td>
<td class="author-text"><a href="mailto:yakov@cisco.com">Rekhter, Y.</a>, <a href="mailto:rgm3@is.chrysler.com">Moskowitz, R.</a>, <a href="mailto:Daniel.Karrenberg@ripe.net">Karrenberg, D.</a>, <a href="mailto:GeertJan.deGroot@ripe.net">Groot, G.</a>, and <a href="mailto:lear@sgi.com">E. Lear</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1918">Address Allocation for Private Internets</a>,&rdquo; BCP&nbsp;5, RFC&nbsp;1918, February&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1918.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2140">[RFC2140]</a></td>
<td class="author-text"><a href="mailto:touch@isi.edu">Touch, J.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2140">TCP Control Block Interdependence</a>,&rdquo; RFC&nbsp;2140, April&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2140.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2140.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2140.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2663">[RFC2663]</a></td>
<td class="author-text"><a href="mailto:srisuresh@lucent.com">Srisuresh, P.</a> and <a href="mailto:holdrege@lucent.com">M. Holdrege</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2663">IP Network Address Translator (NAT) Terminology and Considerations</a>,&rdquo; RFC&nbsp;2663, August&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2663.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2782">[RFC2782]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P., and <a href="mailto:levone@microsoft.com">L. Esibov</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782, February&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2782.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2827">[RFC2827]</a></td>
<td class="author-text">Ferguson, P. and D. Senie, &ldquo;<a href="http://tools.ietf.org/html/rfc2827">Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing</a>,&rdquo; BCP&nbsp;38, RFC&nbsp;2827, May&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2827.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2993">[RFC2993]</a></td>
<td class="author-text">Hain, T., &ldquo;<a href="http://tools.ietf.org/html/rfc2993">Architectural Implications of NAT</a>,&rdquo; RFC&nbsp;2993, November&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2993.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3056">[RFC3056]</a></td>
<td class="author-text">Carpenter, B. and K. Moore, &ldquo;<a href="http://tools.ietf.org/html/rfc3056">Connection of IPv6 Domains via IPv4 Clouds</a>,&rdquo; RFC&nbsp;3056, February&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3056.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3715">[RFC3715]</a></td>
<td class="author-text">Aboba, B. and W. Dixon, &ldquo;<a href="http://tools.ietf.org/html/rfc3715">IPsec-Network Address Translation (NAT) Compatibility Requirements</a>,&rdquo; RFC&nbsp;3715, March&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3715.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3947">[RFC3947]</a></td>
<td class="author-text">Kivinen, T., Swander, B., Huttunen, A., and V. Volpe, &ldquo;<a href="http://tools.ietf.org/html/rfc3947">Negotiation of NAT-Traversal in the IKE</a>,&rdquo; RFC&nbsp;3947, January&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3947.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4787">[RFC4787]</a></td>
<td class="author-text">Audet, F. and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4787">Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</a>,&rdquo; BCP&nbsp;127, RFC&nbsp;4787, January&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4787.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5135">[RFC5135]</a></td>
<td class="author-text">Wing, D. and T. Eckert, &ldquo;<a href="http://tools.ietf.org/html/rfc5135">IP Multicast Requirements for a Network Address Translator (NAT) and a Network Address Port Translator (NAPT)</a>,&rdquo; BCP&nbsp;135, RFC&nbsp;5135, February&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5135.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="UPnP-IGD">[UPnP-IGD]</a></td>
<td class="author-text">UPnP Forum, &ldquo;<a href="http://www.upnp.org/standardizeddcps/igd.asp">Universal Plug and Play (UPnP) Internet Gateway Device (IGD)</a>,&rdquo; November&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="Windows-Logo">[Windows-Logo]</a></td>
<td class="author-text">Microsoft, &ldquo;<a href="http://www.microsoft.com/whdc/winlogo/hwrequirements/default.mspx">Windows Logo Program Device Requirements</a>,&rdquo; 2006.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mat Ford (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Internet Society</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Geneva</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Switzerland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ford@isoc.org">ford@isoc.org</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mohamed Boucadair</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France Telecom</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mohamed.boucadair@orange-ftgroup.com">mohamed.boucadair@orange-ftgroup.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Alain Durand</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Juniper Networks</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:adurand@juniper.net">adurand@juniper.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Pierre Levis</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France Telecom</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">42 rue des Coutures</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BP 6243</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Caen Cedex 4  14066</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:pierre.levis@orange-ftgroup.com">pierre.levis@orange-ftgroup.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Phil Roberts</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Internet Society</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Reston, VA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:roberts@isoc.org">roberts@isoc.org</a></td></tr>
</table>
</body></html>
