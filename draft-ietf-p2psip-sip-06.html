<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>A SIP Usage for RELOAD</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Overview">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Registering AORs">
<link href="#rfc.section.4" rel="Chapter" title="4 Looking up an AOR">
<link href="#rfc.section.5" rel="Chapter" title="5 Forming a Direct Connection">
<link href="#rfc.section.6" rel="Chapter" title="6 GRUUs">
<link href="#rfc.section.7" rel="Chapter" title="7 SIP-REGISTRATION Kind Definition">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Overview">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 SIP-Specific Issues">
<link href="#rfc.section.8.2.1" rel="Chapter" title="8.2.1 Fork Explosion">
<link href="#rfc.section.8.2.2" rel="Chapter" title="8.2.2 Malicious Retargeting">
<link href="#rfc.section.8.2.3" rel="Chapter" title="8.2.3 Privacy Issues">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Change Log">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Changes since draft-ietf-p2psip-reload-00">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document defines a SIP Usage for REsource LOcation And Discovery (RELOAD), The SIP Usage provides the functionality of a SIP proxy or registrar in a fully-distributed system. The SIP Usage provides lookup service for AoRs stored in the overlay. The SIP Usage also defines GRUUs that allow the registrations to map an AoR to a specific node reachable through the overlay. The AppAttach method is used to establish a direct connection between nodes through which SIP messages are exchanged." />
  <meta name="description" content="This document defines a SIP Usage for REsource LOcation And Discovery (RELOAD), The SIP Usage provides the functionality of a SIP proxy or registrar in a fully-distributed system. The SIP Usage provides lookup service for AoRs stored in the overlay. The SIP Usage also defines GRUUs that allow the registrations to map an AoR to a specific node reachable through the overlay. The AppAttach method is used to establish a direct connection between nodes through which SIP messages are exchanged." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">P2PSIP</td>
<td class="right">C. Jennings</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Cisco</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">B. B. Lowekamp, Ed.</td>
</tr>
<tr>
<td class="left">Expires: January 09, 2012</td>
<td class="right">Skype</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">E.K. Rescorla</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">RTFM, Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">S.A. Baset</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">H.G. Schulzrinne</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Columbia University</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 08, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">A SIP Usage for RELOAD<br />
  <span class="filename">draft-ietf-p2psip-sip-06</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document defines a SIP Usage for REsource LOcation And Discovery (RELOAD), The SIP Usage provides the functionality of a SIP proxy or registrar in a fully-distributed system. The SIP Usage provides lookup service for AoRs stored in the overlay. The SIP Usage also defines GRUUs that allow the registrations to map an AoR to a specific node reachable through the overlay. The AppAttach method is used to establish a direct connection between nodes through which SIP messages are exchanged.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 09, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may contain material from IETF Documents or IETF Contributions published or made publicly available before November 10, 2008.  The person(s) controlling the copyright in some of this material may not have granted the IETF Trust the right to allow modifications of such material outside the IETF Standards Process. Without obtaining an adequate license from the person(s) controlling the copyright in such materials, this document may not be modified outside the IETF Standards Process, and derivative works of it may not be created outside the IETF Standards Process, except to format it for publication as an RFC or to translate it into languages other than English.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Overview</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Registering AORs</a>
</li>
<li>4.   <a href="#rfc.section.4">Looking up an AOR</a>
</li>
<li>5.   <a href="#rfc.section.5">Forming a Direct Connection</a>
</li>
<li>6.   <a href="#rfc.section.6">GRUUs</a>
</li>
<li>7.   <a href="#rfc.section.7">SIP-REGISTRATION Kind Definition</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Overview</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">SIP-Specific Issues</a>
</li>
<li>8.2.1.   <a href="#rfc.section.8.2.1">Fork Explosion</a>
</li>
<li>8.2.2.   <a href="#rfc.section.8.2.2">Malicious Retargeting</a>
</li>
<li>8.2.3.   <a href="#rfc.section.8.2.3">Privacy Issues</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Acknowledgments</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Change Log</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Changes since draft-ietf-p2psip-reload-00</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Overview</h1>
<p id="rfc.section.1.p.1">The SIP Usage of RELOAD allows SIP user agents to provide a peer-to-peer telephony service without the requirement for permanent proxy or registration servers. In such a network, the RELOAD overlay itself performs the registration and rendezvous functions ordinarily associated with such servers.</p>
<p id="rfc.section.1.p.2">The SIP Usage involves two basic functions: </p>

<dl>
<dt>Registration: </dt>
<dd style="margin-left: 8">SIP UAs can use the RELOAD data storage functionality to store a mapping from their AOR to their Node-ID in the overlay, and to retrieve the Node-ID of other UAs.</dd>
<dt>Rendezvous: </dt>
<dd style="margin-left: 8">Once a SIP UA has identified the Node-ID for an AOR it wishes to call, it can use the RELOAD message routing system to set up a direct connection which can be used to exchange SIP messages.</dd>
</dl>
<p id="rfc.section.1.p.3">For instance, Bob could register his Node-ID, "1234", under his AOR, "bob@dht.example.com". When Alice wants to call Bob, she queries the overlay for "bob@dht.example.com" and gets back Node-ID 1234. She then uses the overlay to establish a direct connection with Bob and can use that direct connection to perform a standard SIP INVITE. The way this works is as follows:</p>
<p></p>

<ol>
<li>Bob, operating Node-ID 1234, stores a mapping from his URI to his Node-ID in the overlay. I.e., "bob@dht.example.com -&gt; 1234".</li>
<li>Alice, operating Node-ID 5678, decides to call Bob. She looks up "bob@dht.example.com" in the overlay and retrieves "1234".</li>
<li>Alice uses the overlay to route an AppAttach message to Bob's peer. Bob responds with his own AppAttach and they set up a direct connection, as shown below.</li>
</ol>
<div id="#rfc.figure.1"></div>
<pre>

Alice       Peer1      Overlay     PeerN      Bob
(5678)                                     (1234)
-------------------------------------------------
AppAttach -&gt;
            AppAttach -&gt;
                      AppAttach -&gt; 
                                  AppAttach -&gt;
                                     &lt;- AppAttach
                            &lt;- AppAttach
                 &lt;- AppAttach
     &lt;- AppAttach

&lt;------------------ ICE Checks -----------------&gt;
INVITE -----------------------------------------&gt;
&lt;--------------------------------------------- OK
ACK --------------------------------------------&gt;
&lt;------------ ICE Checks for media -------------&gt;
&lt;-------------------- RTP ----------------------&gt;

    </pre>
<p id="rfc.section.1.p.5">It is important to note that RELOAD's only role here is to set up the direct SIP connection between Alice and Bob. As soon as the ICE checks complete and the connection is established, then ordinary SIP is used.  In particular, the establishment of the media channel for the phone call happens via the usual SIP mechanisms, and RELOAD is not involved. Media never goes over the overlay. After the successful exchange of SIP messages, call peers run ICE connectivity checks for media.</p>
<p id="rfc.section.1.p.6">As well as allowing mappings from AORs to Node-IDs, the SIP Usage also allows mappings from AORs to other AORs. For instance, if Bob wanted his phone calls temporarily forwarded to Charlie, he could store the mapping "bob@dht.example.com -&gt; charlie@dht.example.com". When Alice wants to call Bob, she retrieves this mapping and can then fetch Charlie's AOR to retrieve his Node-ID.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<p id="rfc.section.2.p.2">We use the terminology and definitions from <a href="#I-D.ietf-p2psip-concepts">Concepts and Terminology for Peer to Peer SIP</a> <cite title="NONE">[I-D.ietf-p2psip-concepts]</cite> and the <a href="#I-D.ietf-p2psip-base">RELOAD Base Protocol</a> <cite title="NONE">[I-D.ietf-p2psip-base]</cite> extensively in this document.</p>
<p id="rfc.section.2.p.3">The term AOR is the SIP "Address of Record" used to inditify a user in SIP. For example, alice@example.com could be the AOR for Alice. For the purposes of this specification, an AOR is consiered not to include the scheme (e.g sip:) as the AOR needs to match the rfc822Name in the X509v3 certificates.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Registering AORs</h1>
<p id="rfc.section.3.p.1">In ordinary SIP, a UA registers its AOR and location with a registrar. In RELOAD, this registrar function is provided by the overlay as a whole. To register its location, a RELOAD peer stores a SipRegistration structure under its own AOR. This uses the SIP-REGISTRATION Kind-ID, which is formally defined in <a href="#sec.sip-reg-kind">Section 7</a>. </p>

<dl>
<dt>Note:</dt>
<dd style="margin-left: 8">GRUUs are handled via a separate mechanism, as described in <a href="#sec-gruus">Section 6</a>.</dd>
</dl>
<p id="rfc.section.3.p.2">As a simple example, if Alice's AOR were "alice@dht.example.com" and her Node-ID were "1234", she might store the mapping "alice@example.org -&gt; 1234". This would tell anyone who wanted to call Alice to contact node "1234".</p>
<p id="rfc.section.3.p.3">RELOAD peers MAY store two kinds of SIP mappings:</p>
<p></p>

<ul>
<li>From AORs to destination lists (a single Node-ID is just a trivial destination list.)</li>
<li>From AORs to other AORs.</li>
</ul>
<p id="rfc.section.3.p.5">The meaning of the first kind of mapping is "in order to contact me, form a connection with this peer." The meaning of the second kind of mapping is "in order to contact me, dereference this AOR". This allows for forwarding. For instance, if Alice wants calls to her to be forwarded to her secretary, Sam, she might insert the following mapping "alice@dht.example.org -&gt; sam@dht.example.org".</p>
<p id="rfc.section.3.p.6">The contents of a SipRegistration structure are as follows:</p>
<div id="#rfc.figure.2"></div>
<pre>

       enum {sip_registration_uri (1), sip_registration_route (2), 
          (255)} SipRegistrationType;
      
       select (SipRegistration.type) {
         case sip_registration_uri:
           opaque               uri&lt;0..2^16-1&gt;;

         case sip_registration_route:
           opaque               contact_prefs&lt;0..2^16-1&gt;;
           Destination          destination_list&lt;0..2^16-1&gt;;

         /* This type can be extended */

       } SipRegistrationData;

       struct {
          SipRegistrationType   type;
          uint16                length;
          SipRegistrationData   data;          
      } SipRegistration;


                </pre>
<p id="rfc.section.3.p.7">The contents of the SipRegistration PDU are:</p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8"></dd>
<dt>type </dt>
<dd style="margin-left: 8"></dd>
<dt></dt>
<dd style="margin-left: 8">the type of the registration</dd>
<dt></dt>
<dd style="margin-left: 8"></dd>
<dt>length </dt>
<dd style="margin-left: 8"></dd>
<dt></dt>
<dd style="margin-left: 8">the length of the rest of the PDU</dd>
<dt></dt>
<dd style="margin-left: 8"></dd>
<dt>data </dt>
<dd style="margin-left: 8"></dd>
<dt></dt>
<dd style="margin-left: 8">the registration data</dd>
</dl>
<p></p>

<ul>
<li>If the registration is of type "sip_registration_uri", then the contents are an opaque string containing the URI.</li>
<li>If the registration is of type "sip_registration_route", then the contents are an opaque string containing the callee's contact preferences and a destination list for the peer.</li>
</ul>
<p id="rfc.section.3.p.10">RELOAD explicitly supports multiple registrations for a single AOR.  The registrations are stored in a Dictionary with the dictionary keys being Node-IDs. Consider, for instance, the case where Alice has two peers:</p>
<p></p>

<ul>
<li>her desk phone (1234)</li>
<li>her cell phone (5678)</li>
</ul>
<p id="rfc.section.3.p.12">Alice might store the following in the overlay at resource "alice@dht.example.com".</p>
<p></p>

<ul>
<li>A SipRegistration of type "sip_registration_route" with dictionary key "1234" and value "1234".</li>
<li>A SipRegistration of type "sip_registration_route" with dictionary key "5678" and value "5678".</li>
</ul>
<p id="rfc.section.3.p.14">Note that this structure explicitly allows one Node-ID to forward to another Node-ID. For instance, Alice could set calls to her desk phone to ring at her cell phone. It's not clear that this is useful in this case, but may be useful if Alice has two AORs.</p>
<p id="rfc.section.3.p.15">In order to prevent hijacking, registrations are subject to access control rules. Before a Store is permitted, the storing peer MUST check that:</p>
<p></p>

<ul>
<li>The certificate contains a username that is a SIP AOR that hashes to the Resource-ID it is being stored at.</li>
<li>The certificate contains a Node-ID that is the same as the dictionary key it is being stored at.</li>
</ul>
<p id="rfc.section.3.p.17">Note that these rules permit Alice to forward calls to Bob without his permission. However, they do not permit Alice to forward Bob's calls to her. See <a href="#sec-security-malicious-retargeting">Section 8.2.2</a> for more on this point.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Looking up an AOR</h1>
<p id="rfc.section.4.p.1">When a RELOAD user wishes to call another user, starting with a non-GRUU AOR, he follows the following procedure. (GRUUs are discussed in <a href="#sec-gruus">Section 6</a>).</p>
<p></p>

<ol>
<li>Check to see if the domain part of the AOR matches the domain name of an overlay of which he is a member. If not, then this is an external AOR, and he MUST do one of the following: <ul>
<li>Fail the call.</li>
<li>Use ordinary SIP procedures.</li>
<li>Attempt to become a member of the overlay indicated by the domain part, if that overlay is a RELOAD overlay.)</li>
</ul>
</li>
<li>Perform a Fetch for kind SIP-REGISTRATION at the Resource-ID corresponding to the AOR. This Fetch SHOULD NOT indicate any dictionary keys, so that it will fetch all the stored values.</li>
<li>If any of the results of the Fetch are non-GRUU AORs, then repeat step 1 for that AOR.</li>
<li>Once only GRUUs and destination lists remain, the peer removes duplicate destination lists and GRUUs from the list and forms a SIP connection to the appropriate peers as described in the following sections. If there are also external AORs, the peer follows the appropriate procedure for contacting them as well.</li>
</ol>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Forming a Direct Connection</h1>
<p id="rfc.section.5.p.1">Once the peer has translated the AOR into a set of destination lists, it then uses the overlay to route AppAttach messages to each of those peers. The "application" field MUST be 5060 to indicate SIP. If certificate-based authentication is in use, the responding peer MUST present a certificate with a Node-ID matching the terminal entry in the route list. Note that it is possible that the peers already have a RELOAD connection between them. This MUST NOT be used for SIP messages.  However, if a SIP connection already exists, that MAY be used. Once the AppAttach succeeds, the peer sends SIP messages over the connection as in normal SIP.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#sec-gruus" id="sec-gruus">GRUUs</a>
</h1>
<p id="rfc.section.6.p.1">GRUUs do not require storing data in the Overlay Instance. Rather, they are constructed by embedding a base64-encoded destination list in the gr URI parameter of the GRUU. The base64 encoding is done with the alphabet specified in table 1 of RFC 4648 with the exception that ~ is used in place of =. An example GRUU is "alice@example.com;gr=MDEyMzQ1Njc4OTAxMjM0NTY3ODk~". When a peer needs to route a message to a GRUU in the same P2P network, it simply uses the destination list and connects to that peer.</p>
<p id="rfc.section.6.p.2">Because a GRUU contains a destination list, it MAY have the same contents as a destination list stored elsewhere in the resource dictionary.</p>
<p id="rfc.section.6.p.3">Anonymous GRUUs are done in roughly the same way but require either that the enrollment server issue a different Node-ID for each anonymous GRUU required or that a destination list be used that includes a peer that compresses the destination list to stop the Node-ID from being revealed.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#sec.sip-reg-kind" id="sec.sip-reg-kind">SIP-REGISTRATION Kind Definition</a>
</h1>
<p id="rfc.section.7.p.1">This section defines the SIP-REGISTRATION kind.</p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8"></dd>
<dt>Name</dt>
<dd style="margin-left: 8">SIP-REGISTRATION</dd>
<dt></dt>
<dd style="margin-left: 8"></dd>
<dt>Kind IDs</dt>
<dd style="margin-left: 8">The Resource Name for the SIP-REGISTRATION Kind-ID is the AOR of the user. The data stored is a SipRegistration, which can contain either another URI or a destination list to the peer which is acting for the user.</dd>
<dt></dt>
<dd style="margin-left: 8"></dd>
<dt>Data Model</dt>
<dd style="margin-left: 8">The data model for the SIP-REGISTRATION Kind-ID is dictionary. The dictionary key is the Node-ID of the storing peer. This allows each peer (presumably corresponding to a single device) to store a single route mapping.</dd>
<dt></dt>
<dd style="margin-left: 8"></dd>
<dt>Access Control</dt>
<dd style="margin-left: 8">USER-NODE-MATCH. Note that this matches the SIP AOR against the rfc822Name in the X509v3 certificate. The rfc822Name does not include the scheme so that "sip:" prefix needs to be removed from the SIP AOR before matching.</dd>
</dl>
<p id="rfc.section.7.p.3">Data stored under the SIP-REGISTRATION kind is of type SipRegistration. This comes in two varieties: </p>

<dl>
<dt></dt>
<dd style="margin-left: 8"></dd>
<dt>sip_registration_uri </dt>
<dd style="margin-left: 8"></dd>
<dt></dt>
<dd style="margin-left: 8">a URI which the user can be reached at.</dd>
<dt></dt>
<dd style="margin-left: 8"></dd>
<dt>sip_registration_route </dt>
<dd style="margin-left: 8"></dd>
<dt></dt>
<dd style="margin-left: 8">a destination list which can be used to reach the user's peer.</dd>
</dl>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Security Considerations</h1>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> Overview</h1>
<p id="rfc.section.8.1.p.1">RELOAD provides a generic storage service, albeit one designed to be useful for P2PSIP. In this section we discuss security issues that are likely to be relevant to any usage of RELOAD. In <a href="#section.sip-issues">Section 8.2</a> we describe issues that are specific to SIP.</p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> <a href="#section.sip-issues" id="section.sip-issues">SIP-Specific Issues</a>
</h1>
<h1 id="rfc.section.8.2.1">
<a href="#rfc.section.8.2.1">8.2.1.</a> Fork Explosion</h1>
<p id="rfc.section.8.2.1.p.1">Because SIP includes a forking capability (the ability to retarget to multiple recipients), fork bombs are a potential DoS concern. However, in the SIP usage of RELOAD, fork bombs are a much lower concern because the calling party is involved in each retargeting event and can therefore directly measure the number of forks and throttle at some reasonable number.</p>
<h1 id="rfc.section.8.2.2">
<a href="#rfc.section.8.2.2">8.2.2.</a> <a href="#sec-security-malicious-retargeting" id="sec-security-malicious-retargeting">Malicious Retargeting</a>
</h1>
<p id="rfc.section.8.2.2.p.1">Another potential DoS attack is for the owner of an attractive number to retarget all calls to some victim. This attack is difficult to ameliorate without requiring the target of a SIP registration to authorize all stores. The overhead of that requirement would be excessive and in addition there are good use cases for retargeting to a peer without there explicit cooperation.</p>
<h1 id="rfc.section.8.2.3">
<a href="#rfc.section.8.2.3">8.2.3.</a> Privacy Issues</h1>
<p id="rfc.section.8.2.3.p.1">All RELOAD SIP registration data is public. Methods of providing location and identity privacy are still being studied.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> IANA Considerations</h1>
<p id="rfc.section.9.p.1">IANA [shall register/has registered] code point TBD to represent the SIP-REGISTRATION kind, as described in <a href="#sec.sip-reg-kind">Section 7</a>.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Acknowledgments</h1>
<p id="rfc.section.10.p.1">This draft is a merge of the "REsource LOcation And Discovery (RELOAD)" draft by David A. Bryan, Marcia Zangrilli and Bruce B.  Lowekamp, the "Address Settlement by Peer to Peer" draft by Cullen Jennings, Jonathan Rosenberg, and Eric Rescorla, the "Security Extensions for RELOAD" draft by Bruce B. Lowekamp and James Deverick, the "A Chord-based DHT for Resource Lookup in P2PSIP" by Marcia Zangrilli and David A. Bryan, and the Peer-to-Peer Protocol (P2PP) draft by Salman A. Baset, Henning Schulzrinne, and Marcin Matuszewski.</p>
<p id="rfc.section.10.p.2">Thanks to Michael Chen for his contributions.</p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-p2psip-base">[I-D.ietf-p2psip-base]</b></td>
<td class="top">
<a>Jennings, C</a>, <a>Lowekamp, B</a>, <a>Rescorla, E</a>, <a>Baset, S</a> and <a>H Schulzrinne</a>, "<a href="http://tools.ietf.org/html/draft-ietf-p2psip-base-16">REsource LOcation And Discovery (RELOAD) Base Protocol</a>", Internet-Draft draft-ietf-p2psip-base-16, July 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody><tr>
<td class="reference"><b id="I-D.ietf-p2psip-concepts">[I-D.ietf-p2psip-concepts]</b></td>
<td class="top">
<a>Bryan, D</a>, <a>Matthews, P</a>, <a>Shim, E</a>, <a>Willis, D</a> and <a>S Dawkins</a>, "<a href="http://tools.ietf.org/html/draft-ietf-p2psip-concepts-04">Concepts and Terminology for Peer to Peer SIP</a>", Internet-Draft draft-ietf-p2psip-concepts-04, October 2011.</td>
</tr></tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#sec-changes" id="sec-changes">Change Log</a>
</h1>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> Changes since draft-ietf-p2psip-reload-00</h1>
<p></p>

<ul><li>Split SIP Usage from combined draft into new draft.</li></ul>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Cullen Jennings</span> 
	  <span class="n hidden">
		<span class="family-name">Jennings</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  <span>170 West Tasman Drive</span>
<span>MS: SJC-21/2</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 408 421-9990</span>

<span class="vcardline">EMail: <a href="mailto:fluffy@cisco.com">fluffy@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Bruce B. Lowekamp</span> editor
	  <span class="n hidden">
		<span class="family-name">Lowekamp</span>
	  </span>
	</span>
	<span class="org vcardline">Skype</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Palo Alto</span>,  
		<span class="region">CA</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:bbl@lowekamp.net">bbl@lowekamp.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Eric Rescorla</span> 
	  <span class="n hidden">
		<span class="family-name">Rescorla</span>
	  </span>
	</span>
	<span class="org vcardline">RTFM, Inc.</span>
	<span class="adr">
	  <span>2064 Edgewood Drive</span>

	  <span class="vcardline">
		<span class="locality">Palo Alto</span>,  
		<span class="region">CA</span> 
		<span class="code">94303</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 650 678 2350</span>

<span class="vcardline">EMail: <a href="mailto:ekr@rtfm.com">ekr@rtfm.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Salman A. Baset</span> 
	  <span class="n hidden">
		<span class="family-name">Baset</span>
	  </span>
	</span>
	<span class="org vcardline">Columbia University</span>
	<span class="adr">
	  <span>1214 Amsterdam Avenue</span>

	  <span class="vcardline">
		<span class="locality">New York</span>,  
		<span class="region">NY</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:salman@cs.columbia.edu">salman@cs.columbia.edu</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Henning Schulzrinne</span> 
	  <span class="n hidden">
		<span class="family-name">Schulzrinne</span>
	  </span>
	</span>
	<span class="org vcardline">Columbia University</span>
	<span class="adr">
	  <span>1214 Amsterdam Avenue</span>

	  <span class="vcardline">
		<span class="locality">New York</span>,  
		<span class="region">NY</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hgs@cs.columbia.edu">hgs@cs.columbia.edu</a></span>

  </address>
</div>

</body>
</html>