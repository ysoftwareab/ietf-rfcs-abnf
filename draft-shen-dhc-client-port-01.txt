



Networking Working Group                                         N. Shen
Internet-Draft                                                   E. Chen
Intended status: Standards Track                           Cisco Systems
Expires: January 8, 2017                                    July 7, 2016


               Generalized Source UDP Port of DHCP Relay
                     draft-shen-dhc-client-port-01

Abstract

   This document extends the DHCP and DHCPv6 protocols for the UDP
   transport from relay agent to server and allows the port to be any
   valid number on the DHCP relay system.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on January 8, 2017.

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





Shen & Chen              Expires January 8, 2017                [Page 1]

Internet-Draft           DHCP Relay Source Port                July 2016


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Requirements Language . . . . . . . . . . . . . . . . . .   3
   2.  Changes to DHCP and DHCPv6 Specifications . . . . . . . . . .   3
     2.1.  Changes to DHCP in RFC 2131 . . . . . . . . . . . . . . .   3
     2.2.  Changes to DHCPv6 in RFC 3315 . . . . . . . . . . . . . .   3
   3.  Relay Agent Source Port Sub-option and Option . . . . . . . .   3
     3.1.  DHCP Relay Agent Source Port Sub-option . . . . . . . . .   3
     3.2.  DHCPv6 Relay Agent Source Port Option . . . . . . . . . .   4
   4.  Compatibility . . . . . . . . . . . . . . . . . . . . . . . .   5
   5.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   5
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .   5
   7.  Acknowledgments . . . . . . . . . . . . . . . . . . . . . . .   5
   8.  Document Change Log . . . . . . . . . . . . . . . . . . . . .   5
     8.1.  Changes to draft-shen-dhc-client-port-01  . . . . . . . .   6
     8.2.  Changes to draft-shen-dhc-client-port-00  . . . . . . . .   6
   9.  Normative References  . . . . . . . . . . . . . . . . . . . .   6
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   6

1.  Introduction

   RFC 2131 [RFC2131] and RFC 3315 [RFC3315] specify the DHCP transport
   protocol as UDP.  They also define both the server side and client
   side port numbers.  The DHCP server port is UDP number (67) and the
   client port is UDP number (68); for DHCPv6 the server port is (546)
   and the client port is (547).

   This fixed client port number of DHCP protocol scheme creates
   problems in certain DHCP relay operations and environments.  For
   instance, in a large scale DHCP relay implementation on a single
   switch node, the DHCP relay functionality may be partitioned among
   multiple relay processes running under different CPUs.  All those
   DHCP relay processes may share the same IP address of the switch
   node.  If the UDP source port has to be a fixed number, the transport
   socket operation of DHCP packets needs to go through a central
   location or process which defeats the purpose of distributed DHCP
   relay functionality.

   This document proposes to relax the fixed source port requirement for
   the DHCP relay agents.  This extension requires the DHCP server or
   relay agent, in the case of relay chaining [RFC3315], to remember the
   inbound packet's UDP port number along with the IP/IPv6 address.  The
   DHCP server MUST use the UDP port number that the incoming relay
   agent uses instead of blindly setting the DHCP fixed port number.






Shen & Chen              Expires January 8, 2017                [Page 2]

Internet-Draft           DHCP Relay Source Port                July 2016


1.1.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [RFC2119].

2.  Changes to DHCP and DHCPv6 Specifications

2.1.  Changes to DHCP in RFC 2131

   Section 4.1 of RFC 2131 [RFC2131] asserts that: DHCP uses UDP as its
   transport protocol.  DHCP messages from a client to a server are sent
   to the 'DHCP server' port (67), and DHCP messages from a server to a
   client are sent to the 'DHCP client' port (68).

   This specification adds to the above paragraph in the paragraph
   below.

   DHCP messages from a relay agent to a server are sent to the 'DHCP
   server' port (67), and the UDP source port it uses can be any valid
   UDP port available on the relay system, including the DHCP port 67.

2.2.  Changes to DHCPv6 in RFC 3315

   Section 5.2 of RFC 3315 [RFC3315] asserts that: Clients listen for
   DHCP messages on UDP port 546.  Servers and relay agents listen for
   DHCP messages on UDP port 547.

   This specification adds to the above paragraph in the paragraph
   below.

   DHCP relay agents can listen for DHCP messages from server or another
   relay agent on any valid UDP port available on the relay system
   including the DHCP UDP port 547.

3.  Relay Agent Source Port Sub-option and Option

   Although the DHCP or DHCPv6 server can implicitly detect a source UDP
   port that is different from the standard DHCP port number when it
   receives an inbound message from relay agents, this sub-option makes
   the request explicit for the server to use a non-DHCP UDP port in the
   reply message.

3.1.  DHCP Relay Agent Source Port Sub-option

   The Relay Agent Source Port sub-option is part of the relay-agent-
   information option for DHCPv4 [RFC3046].  It SHOULD be used by the




Shen & Chen              Expires January 8, 2017                [Page 3]

Internet-Draft           DHCP Relay Source Port                July 2016


   relay agent that uses a non-DHCP UDP port communicating with the DHCP
   server.

   The format of the DHCPv4 Relay Agent Source Port Sub-option is shown
   below:

            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            | SubOpt Code   |      Len      |
            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Where:



      SubOpt Code:  TBD. 8 bits value, to be assigned by IANA.

      Len:     8 bits value to be set to 0.

   When a DHCP server receives a message from relay agent with this
   Relay Source Port sub-option, it MUST remember the inbound message
   UDP source port from the relay agent and use the same port number for
   the UDP destination port that sends the reply message to the same
   relay agent.

3.2.  DHCPv6 Relay Agent Source Port Option

   The Relay Agent Source Port Option is a new DHCPv6 option.  It SHOULD
   be used by the DHCPv6 relay agent that uses a non-DHCP UDP port
   communicating with the DHCP server and upstream relay agent.

   The format of the DHCPv6 Relay Agent Source Port Option is shown
   below:

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          Option-Code          |         Option-Len            |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

   Where:



      Option-Code:  TBD. 16 bits value, to be assigned by IANA.

      Option-Len:  16 bits value to be set to 0.





Shen & Chen              Expires January 8, 2017                [Page 4]

Internet-Draft           DHCP Relay Source Port                July 2016


   When a DHCPv6 server or relay agent receives a message from a
   downstream relay agent with this Relay Source Port Option, it MUST
   remember the inbound message UDP source port from the relay agent and
   use the same port number for the UDP destination port sending the
   reply message to the same relay agent.

4.  Compatibility

   With this extension of DHCP and DHCPv6 source port generalization,
   the server behavior is compatible with the relay agent that uses the
   DHCP fixed UDP port.  The DHCP server will reflect back the UDP well-
   known port number (67/547) that the client uses when relaying back to
   the relay agent.  It is recommended to upgrade the server side first.

   The implementation is advised to allow the configuration for
   specifying a fixed DHCP relay port number.  This is for the case
   where the DHCP relay agent is upgraded with this extension before the
   server side upgrade.

5.  IANA Considerations

   A new sub-option, DHCP Relay Agent Source Port, is defined in this
   document within the DHCPv4 Relay Agent Information Option.  It needs
   to be assigned by IANA from the DHCP Relay Agent sub-options space
   [RFC3046].

   A new option, DHCPv6 Relay Source Port, is defined in this document
   for DHCPv6 and it needs to be assigned by IANA for the DHCPv6 option
   code.

6.  Security Considerations

   If the network uses firewall to block or allow DHCP packets with both
   static UDP source and destination port numbers, this may no longer
   match the packets from new DHCP relay agent and server software.  The
   firewall rules need to be modified only to match the DHCP server side
   of the UDP port number, and if necessary, IP addresses and other
   attributes.

7.  Acknowledgments

   TBD.

8.  Document Change Log







Shen & Chen              Expires January 8, 2017                [Page 5]

Internet-Draft           DHCP Relay Source Port                July 2016


8.1.  Changes to draft-shen-dhc-client-port-01

   o  Submitted July 2016

   o  Changed the document title from "Generalize Client UDP Port Number
      of DHCP Relay" to "Generalized Source UDP Port of DHCP Relay".

   o  Changed the document text such that the source port extension is
      only applied for DHCP and DHCPv6 relay agents.

   o  Defined the DHCPv4 Relay Agent Source Port sub-option and the
      DHCPv6 Relay Agent Source Port option.

8.2.  Changes to draft-shen-dhc-client-port-00

   o  Initial version of the draft is published in June 2016.

9.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

   [RFC2131]  Droms, R., "Dynamic Host Configuration Protocol",
              RFC 2131, DOI 10.17487/RFC2131, March 1997,
              <http://www.rfc-editor.org/info/rfc2131>.

   [RFC3046]  Patrick, M., "DHCP Relay Agent Information Option",
              RFC 3046, DOI 10.17487/RFC3046, January 2001,
              <http://www.rfc-editor.org/info/rfc3046>.

   [RFC3315]  Droms, R., Ed., Bound, J., Volz, B., Lemon, T., Perkins,
              C., and M. Carney, "Dynamic Host Configuration Protocol
              for IPv6 (DHCPv6)", RFC 3315, DOI 10.17487/RFC3315, July
              2003, <http://www.rfc-editor.org/info/rfc3315>.

Authors' Addresses

   Naiming Shen
   Cisco Systems
   560 McCarthy Blvd.
   Milpitas, CA  95035
   US

   Email: naiming@cisco.com





Shen & Chen              Expires January 8, 2017                [Page 6]

Internet-Draft           DHCP Relay Source Port                July 2016


   Enke Chen
   Cisco Systems
   560 McCarthy Blvd.
   Milpitas, CA  95035
   US

   Email: enkechen@cisco.com












































Shen & Chen              Expires January 8, 2017                [Page 7]
