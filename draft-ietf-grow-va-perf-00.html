<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Performance of Virtual Aggregation</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Performance of Virtual Aggregation">
<meta name="keywords" content="I-D, Internet-Draft, GROW">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">GROW Working Group</td><td class="header">H. Ballani</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Cornell U.</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">P. Francis</td></tr>
<tr><td class="header">Expires: February 8, 2010</td><td class="header">MPI-SWS</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">D. Jen</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">UCLA</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">X. Xu</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Huawei</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">L. Zhang</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">UCLA</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">August 07, 2009</td></tr>
</table></td></tr></table>
<h1><br />Performance of Virtual Aggregation<br />draft-ietf-grow-va-perf-00.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on February 8, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
The document "FIB Suppression with Virtual Aggregation"
<a class='info' href='#I-D.francis-intra-va'>[I&#8209;D.francis&#8209;intra&#8209;va]<span> (</span><span class='info'>Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;FIB Suppression with Virtual Aggregation,&rdquo; April&nbsp;2009.</span><span>)</span></a>
describes how router FIB size may be reduced.
This approach entails a trade-off between path-length and load
versus FIB size.
It also has the potential to reduce convergence time.
This document describes the results of several studies that examine
these characteristics.  The results of a study for a Tier-1
ISP with a relatively sophisticated deployment of VA, shows that
FIB size could be reduced ten times or more with a worst-case
latency penalty of 4ms and a worst-case load increase of &lt;1.5%.
Another study, examining a much simpler style of VA deployment, also for
a Tier-1 ISP, shows that FIB size can be reduced by four times (in
routers serving as APRs), and more than 10 times in other routers.
Here, worst-case latency increase was 16 ms, though this is almost
certainly an over-estimate, both because traceroute was used to
make the measurement, and because popular prefixes were
not considered.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-temp">1.2.</a>&nbsp;
Temporary Sections<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-changed">1.2.1.</a>&nbsp;
Document revisions<br />
<a href="#nsdi-summ-sec">2.</a>&nbsp;
The NSDI 2009 Study on FIB size versus load and stretch<br />
<a href="#anchor3">3.</a>&nbsp;
The IETF74 Study<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Evaluation Setup<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
Evaluation Results<br />
<a href="#sec-converge">4.</a>&nbsp;
Convergence Time<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-top-conf">4.1.</a>&nbsp;
Topology Convergence Time<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-boot-conv">4.2.</a>&nbsp;
Boot Convergence Time<br />
<a href="#sec-ack">5.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">6.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">6.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">6.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
The document "FIB Suppression with Virtual Aggregation"
<a class='info' href='#I-D.francis-intra-va'>[I&#8209;D.francis&#8209;intra&#8209;va]<span> (</span><span class='info'>Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;FIB Suppression with Virtual Aggregation,&rdquo; April&nbsp;2009.</span><span>)</span></a>
describes how router FIB size may be reduced.
This approach entails a trade-off between path-length and load
versus FIB size.
This document describes the results of two independent studies that examine
these tradeoffs.

</p>
<p>
One of the studies is <a class='info' href='#nsdi09'>[nsdi09]<span> (</span><span class='info'>Ballani, H., Francis, P., Cao, T., and J. Wang, &ldquo;Making Routers Last Longer with ViAggre,&rdquo; April&nbsp;2009.</span><span>)</span></a>,
published in NSDI 2009.
In this study, the router topology and traffic matrix of a Tier-1
ISP were used to model the expected performance of 
relatively sophisticated VA deployments on that Tier-1 network.
The primary results of this study are that FIB size could be reduced
to 10% of DFZ FIB size or better, with a latency increase of no more than
4ms and a maximum load increase of &lt;1.5%. Further, the load
increase was relatively uniform across the ISP's routers.
With these savings, it is estimated that the lifetime of routers with FIB
space for only 1/4 million IPv4 routes could easily be extended five
to ten years.

</p>
<p>The other study <a class='info' href='#ietf74'>[ietf74]<span> (</span><span class='info'>Jen, D., &ldquo;Scaling FIBs with Virtual Aggregation: How Much Stretch? How Much FIB savings?,&rdquo; March&nbsp;2009.</span><span>)</span></a> evaluates a more straight-forward
	deployment style for VA.  This evaluation results were presented at the 74th IETF and are summarized in this document.  In a nutshell, the IETF evaluation measures the benefits that an ISP might receive under a relatively simpler deployment of VA.  While the NSDI evaluation makes assumptions on packet delivery speed and topological deployments that help optimize the benefits of VA, the IETF evaluation looks at a very intuitive and easy-to-manage deployment of VA, one that may be more realistic for an ISP early on.  We find that even with a very simple, intuitive, low-maintenance deployment of VA, the ISP we studied would still be able to reduce FIB sizes by 75% or more on all of its routers, at a cost of no more than 16ms additional delivery latency in the worst case. 
With the use of popular prefixes, this worst-case latency 
increase could almost certainly be reduced significantly, though this
was not studied.
In particular, routers in these POPs could have FIB-installed those
prefixes that are reachable via the POP, thus avoiding the round-trip
to another POP and back.


</p>
<p>
Both studies have their limitations.  Neither study actually deployed
VA per se---rather they modeled the effect that VA would have on an ISP
given certain data from that ISP.
The NSDI09 study estimated latency by the speed of light distance between
routers, and so is almost certainly under-estimating latency
increase by a small amount.
The IETF74 study, on the other hand, used trace-routes to estimate latency,
and so is probably over-estimating latency increase.
Overall, the NSDI09 reflects the best that VA could do, but might only
be achievable after considerable deployment experience.
The IETF74 study, on the other hand, better reflects what an ISP might
see in its initial, simple deployment.

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Terminology</h3>

<p>
This document adopts the terminology from
<a class='info' href='#I-D.francis-intra-va'>[I&#8209;D.francis&#8209;intra&#8209;va]<span> (</span><span class='info'>Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;FIB Suppression with Virtual Aggregation,&rdquo; April&nbsp;2009.</span><span>)</span></a>.
The following terminology is additionally defined:

</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>Latency Increase:</dt>
<dd>
    In VA, routers don't maintain the entire DFZ FIB and hence,
    traffic must be routed through APRs. This, in turn, increases
    the length of the path traversed by packets. "Latency
    increase" is defined as the increase in latency for packets
    traversing an ISP due to the adoption of VA as compared to the status
    quo. Note that traversal latency can have different meanings:
    the NSDI09 study uses propagation latency while
    the IETF74 uses delay measured by traceroute.

</dd>
<dt>Stretch:</dt>
<dd>
	Same as latency increase.

</dd>
<dt>Worst-case Latency Increase:</dt>
<dd>
    The maximum increase in latency for packets destined to
    any routable prefix and ingressing at any ISP router.

</dd>
<dt>Load Increase:</dt>
<dd>
    VA requires APRs to forward traffic which otherwise need
    not be routed through them. The increase in the amount
    of traffic forwarded as a fraction of the original
    traffic forwarded by a router is termed as load increase.

</dd>
<dt>Worst-case Load Increase:</dt>
<dd>
	The maximum increase in load across all the ISP's routers.

</dd>
</dl></blockquote>

<a name="sec-temp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Temporary Sections</h3>

<p>
This section contains temporary information, and will be removed
in the final version.

</p>
<a name="sec-changed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2.1"></a><h3>1.2.1.&nbsp;
Document revisions</h3>

<p>
This is the first document revision.

</p>
<a name="nsdi-summ-sec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
The NSDI 2009 Study on FIB size versus load and stretch</h3>

<p>
The NSDI09 paper describes and analyzes a "config-only" approach to
deploying VA.  Specifically, it shows how VA can be deployed with today's
legacy routers without software or protocol changes.  
It has two types of analysis.  The first studies the trade-off between
FIB size and stretch and load.  That analysis is presented in this
section.
The second looks, somewhat superficially,
at router convergence time (specifically, the time
it takes for a booting router to fully initialize BGP).
That analysis is presented in 
<a class='info' href='#sec-converge'>Section&nbsp;4<span> (</span><span class='info'>Convergence Time</span><span>)</span></a>.

</p>
<p>
The NSDI09 paper describes two
approaches to VA, one where control-plane
Route Reflectors (RR) are used to filter out prefixes that need to
be suppressed, and another where each data-plane router does the filtering
at the boundary between the RIB and the routing table.  The latter
deployment is closer to the intent of the VA internet drafts, but for
the purpose of FIB size/load-latency
performance evaluation, either approach applies equally.

</p>
<p>
The core performance issue is to understand the trade-off between
FIB size on one hand, and latency and load penalty on the other.
To understand this trade-off, the NSDI09 study closely modeled how
VA would perform on a Tier-1 ISP.  The model was based on knowledge
of the Tier-1 ISP's router-level topology including router
geographic location, routing tables, and traffic
matrix.  This information was obtained directly from the Tier-1 ISP.
Some additional information required for the study that was not
directly available was inferred.  This includes the latency between
routers, which is approximated as the speed-of-light time for
geographic distances between routers.   It also includes the IGP
link-weights, which were also approximated using (the inverse
of) the router distance.  Finally, queuing delay was not considered,
though given that load increase is quite low, the queuing delay
should not increase significantly.
Switching time at routers was also not considered, though again this
is a relatively minor component of delay.
Overall, however, this study slightly under-estimates latency increase.

</p>
<p>
In the study, VA was deployed in such a way that all routers can
be APRs.  In other words, the different router roles (edge, core,
aggregation between edge and core) were not differentiated.
As a result, ALL routers in the ISP see significant FIB savings.

</p>
<p>
When deploying VA, two important questions to answer are, how are
VPs structured, and how are APRs selected (i.e., what is the assignment
of VP to APR)? With regards to the first question, the distribution of
prefixes across the VPs directly impacts the FIB size reduction that
can be achieved. If the VPs are structured such that they all have
similar number of prefixes, the ISP can ensure that all its routers
see substantial savings. As a contrast, if some VPs have a lot of
prefixes, one (or, a few) of the ISP's routers would need to maintain
them which, in turn, limits the reduction in worst-case FIB size.


</p>
<p>
The NSDI09 study considered two approaches. In one, every VP is a \7.
This leads to 128 VPs: 0/7, 2/7, ..., 254/7, with the largest VP
containing 22,722 prefixes or 8.9% of today's routing table. In the second, the set of
VPs was selected such that the number of prefixes in each VP is
relatively uniform and each VP is larger than any real prefix.  This latter
approach yielded 1024 VPs with the largest
containing 4,551 prefixes or 1.78% of the BGP routing
table. In the rest of this section, we summarize results using
the latter approach. Results using the /7 VPs can be found in the
NSDI paper. The next section also present results
assuming /8 VPs and other simplifying assumptions.

</p>
<p>
With regards to the second question, APRs were assigned using an
automated greedy algorithm that ensures that the maximum latency
increase for traffic to any prefix from any ISP router is below a
specified constraint while trying to minimize the FIB size across
the ISP's routers.


</p>
<p>
The analysis was split into two parts, one that looks only at FIB
size versus worst case latency increase,
and another that adds analysis
of load.  This is appropriate, because load is decreased simply by
adding popular prefixes, which increases FIB size without changing
worst case latency.
Note that the use of popular prefixes is necessary to achieve
acceptable performance in this study, so the analysis that ignores load
should not be interpreted as the numbers one would see in practice.

</p>
<p>
A VA deployment such that there is an APR for every VP in each
of the ISP's POPs is able to reduce the worst-case FIB size to
25% of the DFZ FIB size. In this case, all traffic redirection is
within a POP and hence, the stretch imposed on traffic is virtually 0.
The ISP can also choose to incur traffic stretch to further reduce
router FIB requirements. The resulting FIB versus latency analysis
produced a range of results but there
is a performance sweet-spot at the point where worst-case stretch is
capped at 4ms.  In this case, the worst-case FIB size is 5% of the
DMZ FIB size (in other words, 20 times reduction).  Capping the latency
at higher values did not significantly shrink FIB size.

</p>
<p>
Besides looking at percentage of FIB reduction, the paper analyzed
how long the lifetime of current routers could extend into the future
before running out of FIB space.  Using DMZ growth predictions
based on growth history<a class='info' href='#atnac06'>[atnac06]<span> (</span><span class='info'>Huston, G. and G. Armitage, &ldquo;Projection Future IPv4 Router Requirements from Trends in Dynamic BGP Behaviour,&rdquo; December&nbsp;2006.</span><span>)</span></a>,
Cat6500 routers that can hold 249K IPv4 FIB entries
(and therefore could not hold full DFZ as of 2007), would last
a decade with virtually no increased latency, and over two decades
at 4ms increased latency.

</p>
<p>
The above analysis, however, ignores load.  In VA, load is reduced by
installing so-called "popular prefixes" into the FIB.  These are the
prefixes that have the heaviest traffic volumes.  Without installing
popular prefixes, load increases by about 40%, which is clearly
unacceptable.

</p>
<p>
In the Tier-1 ISP studied, 1.5% of most popular
prefixes carry 75.5% of the traffic, while 5% of the
prefixes carry 90.2% of the traffic (as of late-2007).
This "power-law" distribution has been the norm over many studies
spanning many years.
Because of this distribution, installing a relatively
small number of popular prefixes improves load tremendously.
Note too that prefixes that are popular at one time tend to stay
popular over time.  The 5% of popular prefixes that produces 90%
of the traffic on one day will still produce roughly 85% of the
traffic one month later.
This means that an ISP could measure its popular prefixes and
reconfigure its routers relatively infrequently---once per week
or even less frequently.

</p>
<p>
In the analysis,
when 5% of most popular prefixes are installed, the worst-case load
reduces to 1.38%.

These 5% popular prefixes add to the FIB size and so with a 4ms cap
on the worst case latency increase, the actual FIB size is 10% of
the total.
In other words, overall this Tier-1 ISP could reduce FIB size by
ten times while increasing worst case latency by &lt;4ms, and worst case
load by &lt;1.5%.

</p>
<p>
Besides studying the Tier-1 ISP in detail, the NSDI09 paper also
used Rocketfuel to make rough estimates of FIB size and latency
for 9 other ISPs (load could not be estimated because Rocketfuel
does not have the traffic matrix of these ISPs).  Because Rocketfuel
tends to underestimate the number of routers in an ISP, the analysis
is conservative (more routers means more aggregate FIB over which to
spread the routing table).
In this analysis, assuming worst case latency increase of 5ms, the
FIB could be reduced to 5-15% of DFZ.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
The IETF74 Study</h3>

<p>
While the NSDI09 results might suggest that Virtual Aggregation offers a great tradeoff for ISPs, the relatively management complexity that would
result from the style of deployment used in that study suggests that
ISPs would not see that level of performance in initial deployments.
The IETF74 study described here
uses a much simpler style of VA deployment, something that
better reflects what an ISP would use early on.
In particular, the IETF74 study considers
ease of management when assigning APRs and virtual prefixes to use.  
As such, it better reflects the 
stretch/savings tradeoff they would actually 
experience if they deployed VA in their networks today.  

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Evaluation Setup</h3>

<p>
The results of a VA evaluation will depend heavily on which VA deployment is evaluated.  VA deployments can differ in the amount of VPs used, which VPs are used, how often they change, the amount of APRs used, the VP-APR mappings, and the placement of APRs.  These variables must be given values to define a particular flavor of VA that's being evaluated.  The NSDI study selected these variable values in order to maximize FIB savings and minimize additional packet latency.  This allows us to evaluate just how good the VA stretch/savings tradeoff could potentially be, but the variable values probably described a VA deployment that would not realistically occur.  For this study, selections of these variable values will be based on what we consider most simple and intuitive.  In this subsection, we present the values we selected for these variables, as well as justifications for our selections.

</p>
<p>
We start by describing where we decided to place the APRs for our study.  Again, our aim is for simplicity and ease of management.  The topology of the tier-1 ISP we used for this evaluation revealed that the ISP consists of a many small PoPs with a few routers, and a few large PoPs consisting of many routers.  While exact numbers cannot be revealed due to confidentiality agreements, the discrepancy between the number of routers in small and large PoPs is significant.  The discrepancy between the number of large and small PoPs was also significant.  Based on these observations, we decided that it would be intuitive to have an APR for every VP at each large PoP.  Furthermore, only large PoPs should contain APRs, which makes them easy to locate.  When forwarding packets, nodes in large PoPs should obviously use their local APRs, while routers in small PoPs should use the APRs from their nearest major PoP.  Unlike the VA deployment used for the NSDI evaluation, APR placement does not change with the routing table.  This significantly reduces troubleshooting efforts compared to the architecture proposed by the NSDI evaluation.  We also had to decide how many APRs each major PoP should have.  This question is independent of the number of VPs an ISP decides to use.  For example, an ISP could choose to use 8 different VPs.  However, the ISP could have 1 APR be responsible for all 8 VPs, or assign 2 VPs to each of 4 different APRs, or assign 5 VPs to one APR and the remaining 3 to another APR, etc.  We decided that each large PoP would evenly distribute the FIB storage requirements amongst 8 different APRs.  We chose 8 APRs in particular simply because each large PoP in our studied tier-1 ISP had at least 8 routers storing complete global routing tables, and these machines would have the storage capacities to be APRs.

</p>
<p>
The next decision involved which virtual prefixes to use.  The more virtual prefixes you have, the finer the granularity for assigning virtual prefixes to APRs.  This increases an ISP's flexibility to divide FIB storage evenly amongst its different APRs, and thus keep worst-case FIB size at a minimum.  Of course, in order for VA to work properly, VPs must be longer than any real prefixes.  For these reasons, the NSDI study maximized the number of VPs used by looking at the global routing table on a certain date, and carefully adding virtual prefixes that were never longer than any of the real prefixes it covered, which yielded 1024 prefixes.  However, note that as the global routing table changes, the VPs used may have to change as well.  A static VP list would be much easier to manage.  Therefore, we decided to use VPs of length 8, which allows us to cover the v4 space using 256 VPs.  While this number is smaller than the 1024 used in the NSDI study, this allows us to maintain a static VP list where each VP is still never longer than any of the real prefixes it covers.

</p>
<p>
We have now decided on a VP list and a placement of APRs we decided would be simple and easy to manage.  Our final task to complete the description of our VA deployment was to decide which VPs to assign to which APRs.  In accordance to the concept of manageability, we used a simple and straightforward greedy algorithm for assigning virtual prefixes to APRs.  The aim was for this algorithm to be computationally cheap and quickly run at regular intervals to still evenly distribute FIB storage responsibilities amongst the APRs.  The algorithm basically assigns VPs to an APR one by one until the APR has VPs covering at least 1/8 of the DFZ.  We then starts assigning the remaining VPs to another APR.  The algorithm is as follows:

</p>
<p></p>
<blockquote class="text">
<p>Select one of the eight APRs
</p>
<p>For VPs 0/8 thru 255/8:
</p>
<p></p>
<blockquote class="text">
<p>Assign VP to selected APR
</p>
<p>If number of entries in APR > 1/8 of GRT: Select a previously unselected APR
</p>
</blockquote>

</blockquote>

<p>
We have now assigned values to all of the variables required to describe a particular deployment of VA.  We can now evaluate the costs and benefits of this VA deployment for the ISP. 
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Evaluation Results</h3>

<p>
FIB savings for VA routers are calculated by counting the number of FIB entries in the VA router and comparing this to the size of the global routing table. 
</p>
<p>
To distribute FIB storage requirements evenly amongst the 8 different APRs, we ran the algorithm described above on global routing table contents for the first days of the months between 06/08 and 02/09.  The algorithm, while simple, works quite well.  In the worst case, an APR was assigned to cover 14% of the global routing table, as opposed to the ideal amount of 12.5%(1/8th).  
</p>
<p>
Under VA, routers have to also store peer-to-label mapping for each external router that peers with the ISP.  An operator for the ISP we studied estimated the number of external peerings at around 20,000.  
</p>
<p>
It turns out that even with this simple deployment of VA, the largest storage requirements for an APR still reduces its FIB storage requirements by 75%.  For non-APR routers, FIB storage requirements were reduced by 93%. 
</p>
<p>
For each PoP, we calculated the worst-case stretch that a packet ingressing from the PoP could experience.  Stretch is defined as the additional time the packet takes to exit the ISP due to suboptimal paths introduced by the VA architecture.  Worst-case stretch occurs when the nearest APR for the packet is in the opposite direction of the egress router out of the ISP, and thus the packet is stretched a round-trip distance from the ingress PoP to the APR and back.

</p>
<p>
When calculating the worst-case stretch for each PoP, we did not simply assume speed of light and shortest distance between PoPs as the NSDI evaluation did.  We wanted to capture the actual delay that a user would experience for the packet, which would include processing time as well as propagation time.  Thus we used traceroute to capture the true stretch experienced by packets due to VA.  To determine the worst case stretch for a given PoP, we tracerouted from this PoP to all of the major PoPs.  This allowed us to map the PoP to its 'nearest' major PoP.  We then used traceroute to determine the time it takes to go to the nearest major PoP and back, thus giving us the worst-case stretch for that PoP.  We did this for every PoP, and found that all PoPs can send a packet to a large PoP in 8ms or less, and thus the worst-case stretch for any PoP in our studied ISP is 16ms.  Furthermore, 70% of PoPs experience a worst-case stretch of 8ms or less, and over 30% of all PoPs experience no stretch at all.  This is because they were either a major PoP, or they naturally defaulted to a major PoP for all of their traffic anyway, so VA did not change their natural delivery path whatsoever.

</p>
<a name="sec-converge"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Convergence Time</h3>

<p>
Regarding convergence time, in general we expect convergence with
VA to be faster than convergence without VA.
The basic argument is simple:  updating FIB entries takes time.
If there are fewer FIB entries to update, then convergence goes faster.
There are two forms of convergence discussed here:  convergence time
for a given router when a link or some other router goes down or comes up,
and time to fully initialize BGP when a router boots up.
We call the first topology-convergence, and the second boot-convergence.
Each is discussed in turn.

</p>
<a name="sec-top-conf"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Topology Convergence Time</h3>

<p>
A simple experiment was run to demonstrate the improved
topology-convergence aspect of VA.
Before discussing the experiment, it is important to note 
that the benefit demonstrated by this experiment could also
be had using the "Prefix Independent Convergence" mechanism.
In other words, VA isn't the only way, or even the simplest way,
to achieve this kind of fast convergence.

</p>
<p>
The following topology was used in the experiment.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

                 _.--------.
            ,--''           `---.             ,-------.
          ,'                     `.        ,-'   AS2   `-.
        ,' +----+         +----+   `.     /     +----+    \
       /   | R1 |.........| R3 |.....\...(......| R2 |     )
      /    +----+         +----+      \   \     +----+    /
     ;         \            /          :   `-.         ,-'
     |          \          /           |      `-------'
     :           \        /            ;
      \           +----+ /       AS1  /
       \          | R4 |             /
        `.        +----+           ,'
          `.                     ,'
            `---.           _.--'
                 `--------''

</pre></div>
<p>
Router R2 advertised a number of routes (ranging from 5000 to 220K)
to R3, which in turn distributed them in AS1 with full-mesh iBGP.
Packets were transmitted to R1 (via a test-box not shown) for
destinations within the advertised routes.
At time T0, the link R1--R3 is taken down.
This results in a period of time during which some fraction of
transmitted packets are dropped at R1.
The elapsed time until all transmitted packets are successfully
received at R2 is then measured.

</p>
<p>
The following table shows the elapsed time for a varying number
of advertised routes, for both with VA and without VA.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    Number of  |   With   |  Without |
     Routes    |    VA    |    VA    |
  =============|==========|==========|
      5000     |  2 sec   |  2 sec   |
  -------------|----------|----------|
     50000     |  2 sec   |  10 sec  |
  -------------|----------|----------|
    100000     |  2 sec   |  17 sec  |
  -------------|----------|----------|
    150000     |  3 sec   |  24 sec  |
  -------------|----------|----------|
    200000     |  3 sec   |  30 sec  |
  -------------|----------|----------|
    220000     |  3 sec   |  35 sec  |
  -------------|----------|----------|

</pre></div>
<p>
As can be seen from the table, convergence time for the VA
scenario is pretty much independent of routing table size.
This is because the only change in the FIB is that of the
best igp next-hop to the APR.
In the non-VA case, however, the igp next-hop needs to be changed
for all prefixes before routes to all prefixes converge.

</p>
<p>
It should be noted that this experiment intentionally puts VA
topology-convergence in the best light.  Router R1 only has a single
FIB entry that it needs to update: that of the VP.
In practice, any given router may have both VP sub-prefixes (those
needed by virtue of being an APR) and popular prefixes in the FIB.
Certainly at least the new next-hops to the VP sub-prefixes and VPs would have
to be FIB-installed before convergence.  
Realistically, however, the popular prefixes should be installed too,
since until they are load is increased.
Therefore, in practice the improvement in convergence time will be
less than shown here.

</p>
<a name="sec-boot-conv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Boot Convergence Time</h3>

<p>
The NSDI09 paper 
<a class='info' href='#nsdi09'>[nsdi09]<span> (</span><span class='info'>Ballani, H., Francis, P., Cao, T., and J. Wang, &ldquo;Making Routers Last Longer with ViAggre,&rdquo; April&nbsp;2009.</span><span>)</span></a>
experimented with the time it takes for a
router to boot and fully populate its routing tables and advertise
all updates (i.e. initialize BGP).
It is important to note that the NSDI09 paper did not implement
the VA draft 
<a class='info' href='#I-D.francis-intra-va'>[I&#8209;D.francis&#8209;intra&#8209;va]<span> (</span><span class='info'>Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;FIB Suppression with Virtual Aggregation,&rdquo; April&nbsp;2009.</span><span>)</span></a>
per se.  Rather it deployed VA using legacy routers configured
to implement VA.  In fact, the NSDI09 paper experimented with two
distinct configurations of VA.  In one, control-plane Route
Reflectors (RR) were used to filter out the prefixes not needed by
data-plane routers (i.e. prefixes that could be FIB-suppressed according
to the rules of VA).
In this setting, both the RIBs and FIBs of data-plane routers were
shrunk.

</p>
<p>
The second configuration approach better reflects the spirit of the VA
draft.
Here, data-plane routers ran BGP as normal (i.e. the RIBs were
populated more-or-less as they would be in the absence of VA),
and did FIB-suppression by setting the administrative distance 
for suppressible prefixes to 255.  In the Cisco routers used in
the experiment, such prefixes were then FIB-suppressed, but otherwise
treated normally.

</p>
<p>
In the test setup, the VA routers' FIBs held roughly 1/2 of the full
DFZ.
VA as deployed with control-plane RRs was able to
initialize BGP about twice as fast as regular (full DFZ) routers
(for example, 124 seconds versus 273 seconds).
With the "admin-distance = 255" approach, it took roughly twice
as long for the VA routers to initialize compared to the
regular routers (for example, 487 seconds versus 273 seconds).
The reason for this is that these Cisco routers were not designed to
deal with large admin-distance access lists efficiently.  We believe
that this inefficiency can be overcome, but in fact there are at
this time no hard numbers to back up this supposition.  

</p>
<a name="sec-ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Acknowledgements</h3>

<p>
	Tuan Cao, a PhD student at Cornell, did much of the heavy lifting
	on the NSDI09 measurement study.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.francis-intra-va">[I-D.francis-intra-va]</a></td>
<td class="author-text">Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-francis-intra-va-01.txt">FIB Suppression with Virtual Aggregation</a>,&rdquo; draft-francis-intra-va-01 (work in progress), April&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-francis-intra-va-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="atnac06">[atnac06]</a></td>
<td class="author-text">Huston, G. and G. Armitage, &ldquo;Projection Future IPv4 Router Requirements from Trends
in Dynamic BGP Behaviour,&rdquo; ATNAC 2006&nbsp;caia.swin.edu.au/pubs/ATNAC06/Huston_1m.pdf, December&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="ietf74">[ietf74]</a></td>
<td class="author-text">Jen, D., &ldquo;Scaling FIBs with Virtual Aggregation: How Much Stretch?
How Much FIB savings?,&rdquo; IRTF Routing Research Group Meeting&nbsp;http://www.ietf.org/proceedings/09mar/slides/RRG-2.pdf, March&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="nsdi09">[nsdi09]</a></td>
<td class="author-text">Ballani, H., Francis, P., Cao, T., and J. Wang, &ldquo;Making Routers Last Longer with ViAggre,&rdquo; ACM Usenix NSDI 2009&nbsp;http://www.usenix.org/events/nsdi09/tech/full_papers/ballani/ballani.pdf, April&nbsp;2009.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hitesh Ballani</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cornell University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4130 Upson Hall</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ithaca, NY  14853</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 607 279 6780</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hitesh@cs.cornell.edu">hitesh@cs.cornell.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Paul Francis</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Max Planck Institute for Software Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gottlieb-Daimler-Strasse</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kaiserslautern  67633</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+49 631 930 39600</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:francis@mpi-sws.org">francis@mpi-sws.org</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dan Jen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UCLA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4805 Boelter Hall</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Los Angeles, CA  90095</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jenster@cs.ucla.edu">jenster@cs.ucla.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Xiaohu Xu</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">No.3 Xinxi Rd., Shang-Di Information Industry Base, Hai-Dian District</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing, Beijing  100085</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.R.China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86 10 82836073</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:xuxh@huawei.com">xuxh@huawei.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Lixia Zhang</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UCLA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3713 Boelter Hall</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Los Angeles, CA  90095</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:lixia@cs.ucla.edu">lixia@cs.ucla.edu</a></td></tr>
</table>
</body></html>
