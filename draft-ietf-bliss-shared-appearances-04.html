<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Shared Appearances of a Session Initiation Protocol (SIP) Address of Record (AOR)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Shared Appearances of a Session Initiation Protocol (SIP) Address of Record (AOR)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">BLISS</td><td class="header">A. Johnston, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Avaya</td></tr>
<tr><td class="header">Expires: April 29, 2010</td><td class="header">M. Soroushnejad</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">V. Venkataramanan</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Sylantro Systems Corp</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 26, 2009</td></tr>
</table></td></tr></table>
<h1><br />Shared Appearances of a Session Initiation Protocol (SIP) Address of Record (AOR)<br />draft-ietf-bliss-shared-appearances-04</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 29, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
This document describes the requirements and implementation of a group telephony feature commonly known as Bridged Line Appearance (BLA) or Multiple Line Appearance (MLA), or Shared Call/Line Appearance (SCA).  When implemented using the Session Initiation Protocol (SIP), it is referred to as shared appearances of an Address of Record (AOR) since SIP does not have the concept of lines. This feature is commonly offered in IP Centrex services and IP-PBX offerings and is likely to be implemented on SIP IP telephones and SIP feature servers used in a business environment.  This document discusses use cases, lists requirements and defines SIP extensions to implement this feature.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Conventions used in this document<br />
<a href="#anchor3">3.</a>&nbsp;
Usage Scenarios<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Executive/Assistant Arrangement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
Call Group<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
Single Line Extension<br />
<a href="#anchor7">4.</a>&nbsp;
Requirements and Implementation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.1.</a>&nbsp;
Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.2.</a>&nbsp;
Implementation<br />
<a href="#anchor10">5.</a>&nbsp;
Normative Description<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.1.</a>&nbsp;
Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#extensions">5.2.</a>&nbsp;
Shared Appearance Dialog Package Extensions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.2.1.</a>&nbsp;
The &lt;appearance&gt; element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">5.2.2.</a>&nbsp;
The &lt;exclusive&gt; element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">5.2.3.</a>&nbsp;
The &lt;joined-dialog&gt; element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">5.2.4.</a>&nbsp;
The &lt;replaced-dialog&gt; element<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">5.3.</a>&nbsp;
Shared Appearance User Agents<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">5.4.</a>&nbsp;
Appearance Agent<br />
<a href="#schema">6.</a>&nbsp;
XML Schema Definition<br />
<a href="#anchor18">7.</a>&nbsp;
User Interface Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">7.1.</a>&nbsp;
Appearance Number Rendering<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">7.1.1.</a>&nbsp;
Single Appearance UAs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">7.1.2.</a>&nbsp;
Dual Appearance UAs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">7.1.3.</a>&nbsp;
Shared Appearance UAs with Fixed Appearance Number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">7.1.4.</a>&nbsp;
Shared Appearance UAs with Variable Appearance Number<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">7.2.</a>&nbsp;
Call State Rendering<br />
<a href="#anchor25">8.</a>&nbsp;
Interop with non-Shared Appearance UAs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">8.1.</a>&nbsp;
Appearance Assignment<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">8.2.</a>&nbsp;
Appearance Release<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">8.3.</a>&nbsp;
UAs Supporting Dialog Events but Not Shared Appearance<br />
<a href="#anchor29">9.</a>&nbsp;
Provisioning Considerations<br />
<a href="#anchor30">10.</a>&nbsp;
Example Message Flows<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">10.1.</a>&nbsp;
Registration and Subscription<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">10.2.</a>&nbsp;
Appearance Selection for Incoming Call<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">10.3.</a>&nbsp;
Outgoing Call without Appearance Seizure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor34">10.4.</a>&nbsp;
Outgoing Call with Appearance Seizure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor35">10.5.</a>&nbsp;
Outgoing Call without using an Appearance Number<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">10.6.</a>&nbsp;
Appearance Release<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor37">10.7.</a>&nbsp;
Appearance Pickup<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor38">10.8.</a>&nbsp;
Calls between UAs within the Group<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor39">10.9.</a>&nbsp;
Consultation Hold with Appearances<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor40">10.10.</a>&nbsp;
Joining or Bridging an Appearance<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor41">10.11.</a>&nbsp;
Appearance Allocation - Loss of Appearance<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor42">10.12.</a>&nbsp;
Appearance Seizure Contention Race Condition<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor43">10.13.</a>&nbsp;
Appearance Agent Subscription to UAs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor44">10.14.</a>&nbsp;
Appearance Pickup Race Condition Failure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor45">10.15.</a>&nbsp;
Appearance Seizure Incoming/Outgoing Contention Race Condition<br />
<a href="#anchor46">11.</a>&nbsp;
 Incoming Appearance Assignment<br />
<a href="#anchor47">12.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor48">12.1.</a>&nbsp;
SIP Event Package Parameter: shared<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor49">12.2.</a>&nbsp;
URN Sub-Namespace Registration: sa-dialog-info<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor50">12.3.</a>&nbsp;
XML Schema Registration<br />
<a href="#anchor51">13.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor52">14.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">15.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>  
The feature and functionality requirements for SIP user agents (UAs) supporting business telephony applications differ greatly from basic SIP user agents, both in terms of services and end user experience. In addition to basic SIP support <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, many of the services in a business environment require the support for SIP extensions such as REFER <a class='info' href='#RFC3515'>[RFC3515]<span> (</span><span class='info'>Sparks, R., &ldquo;The Session Initiation Protocol (SIP) Refer Method,&rdquo; April&nbsp;2003.</span><span>)</span></a>, SUBSCRIBE/NOTIFY primitives <a class='info' href='#I-D.ietf-sipcore-rfc3265bis'>[I&#8209;D.ietf&#8209;sipcore&#8209;rfc3265bis]<span> (</span><span class='info'>Roach, A., &ldquo;SIP-Specific Event Notification,&rdquo; February&nbsp;2010.</span><span>)</span></a> PUBLISH <a class='info' href='#RFC3903'>[RFC3903]<span> (</span><span class='info'>Niemi, A., &ldquo;Session Initiation Protocol (SIP) Extension for Event State Publication,&rdquo; October&nbsp;2004.</span><span>)</span></a>, the SIP Replaces <a class='info' href='#RFC3891'>[RFC3891]<span> (</span><span class='info'>Mahy, R., Biggs, B., and R. Dean, &ldquo;The Session Initiation Protocol (SIP) &quot;Replaces&quot; Header,&rdquo; September&nbsp;2004.</span><span>)</span></a>,  and Join <a class='info' href='#RFC3911'>[RFC3911]<span> (</span><span class='info'>Mahy, R. and D. Petrie, &ldquo;The Session Initiation Protocol (SIP) &quot;Join&quot; Header,&rdquo; October&nbsp;2004.</span><span>)</span></a>  header fields, etc. Many of the popular business services have been documented in the SIP Service Examples <a class='info' href='#RFC5359'>[RFC5359]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;2008.</span><span>)</span></a>. 

</p>
<p>
This specification details a method for implementing a group telephony feature known variously in telephony as Bridged Line Appearance (BLA) or Multiple Line Appearances (MLA), one of the more popular advanced features expected of SIP IP telephony devices in a business environment. Other names for this feature include Shared Call/Line Appearance (SCA), Shared Call Status and Multiple Call Appearance (MCA).  A variant of this feature is known as Single Line Extension.

</p>
<p>
This document looks at how this feature can be implemented using standard SIP <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> in conjunction with SIP events <a class='info' href='#I-D.ietf-sipcore-rfc3265bis'>[I&#8209;D.ietf&#8209;sipcore&#8209;rfc3265bis]<span> (</span><span class='info'>Roach, A., &ldquo;SIP-Specific Event Notification,&rdquo; February&nbsp;2010.</span><span>)</span></a>  and publication <a class='info' href='#RFC3903'>[RFC3903]<span> (</span><span class='info'>Niemi, A., &ldquo;Session Initiation Protocol (SIP) Extension for Event State Publication,&rdquo; October&nbsp;2004.</span><span>)</span></a> for exchanging status among user agents, and the SIP dialog state event package <a class='info' href='#RFC4235'>[RFC4235]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2005.</span><span>)</span></a> to exchange dialog state information to achieve the same.  Different approaches will be discussed including the use of URI parameters, feature tags, and dialog package extensions along with the strengths and weaknesses of the various approaches.

</p>
<p>
In traditional telephony, the line is physical. A common scenario in telephony is for a number of business telephones to share a single or a small number of lines.  The sharing or appearance of these lines between a number of phones is what gives this feature its name.   A common scenario in SIP is for a number of business telephones to share a single or a small number of Address of Record (AOR) URIs.  In addition, an AOR can have multiple appearances on a single UA in terms of the user interface.  The appearance number relates to the user interface for the telephone - typically each appearance or an AOR has a visual display (lamp that can change color or blink or a screen icon) and a button (used to select the appearance). The telephony concept of line appearance is still relevant to SIP due to the user interface considerations. It is important to keep the appearance number construct because:

</p>
<p> </p>
<ol class="text">
<li>

Human users are used to the concept and will expect it in replacement systems (e.g. an overhead page announcement says "Joe pickup line 3").

</li>
<li>

It is a useful structure for user interface representation.

</li>
</ol>

<p>

In this document, we will use the term "appearance" rather than "line appearance" since SIP does not have the concept of lines. Note that this does not mean that a conventional telephony user interface (lamps and buttons) must be used - implementations may use another metaphor as long as the appearance number is readily apparent to the user.  Each AOR has a separate appearance numbering space.  As a result, a given UA user interface may have multiple occurrences of the same appearance number, but they will be for different AORs.


</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions used in this document</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC-2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>  and indicate requirement levels for compliant mechanisms.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Usage Scenarios</h3>

<p>
The following examples are common applications of the Shared Appearances feature and are mentioned here as informative use cases.   All these example usages can be supported by the Shared Appearances feature described in this document.  The differences relate to the user interface considerations of the device.  

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Executive/Assistant Arrangement</h3>

<p>
The appearances on the executive's UA also appear on the assistant's UA.  The assistant may answer incoming calls to the executive
and then place the call on hold for the executive to pick up.  The
assistant can always see the state of all calls on the executive's UA. 

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Call Group</h3>

<p>
Users with similar business needs or tasks can be assigned to specific groups and share the line appearances of each other on each others SIP telephony devices.  For example, an IT department staff of five might answer a help line which has three appearances on each phone in the IT work area.  A call answered on one phone can be put on hold and picked up on another phone.  A shout or an IM to another staff member can result in them taking over a call on a particular appearance.  Another phone can request to be added, joined, or bridged to an existing appearance resulting in a conference call.

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Single Line Extension</h3>

<p>
In this scenario, incoming calls are offered to a group of UAs.  When one answers, the other UAs are informed.  If another UA in the group seizes the line (i.e. goes off hook), it is immediately bridged or joined in with the call.  This mimics the way residential telephone extensions usually operate.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Requirements and Implementation</h3>

<p>
The next section details the requirements and discusses the implementation of the shared appearances of an AOR feature.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Requirements</h3>

<p> 
The basic requirements of the shared appearance feature can be summarized as follows:

</p>
<p>
REQ-1 Incoming calls to the AOR must be offered to a group of UAs and can be answered by any of them.

</p>
<p>
REQ-2 Each UA in the group must be able to learn the call status of the others in the group for the purpose of rendering this information to the user.

</p>
<p>
REQ-3 Calls can be joined (also called bridged or conferenced together) or can be picked up (taken) by another UA in the group in a secure way.

</p>
<p>
REQ-4 The mechanism should require the minimal amount of configuration.  UAs registering against the group AOR should be able to participate in the appearance group without manual configuration of group members.

</p>
<p>
REQ-5 The mechanism must scale for large numbers of appearances, n, and large numbers of UAs, N, without introducing excessive messaging traffic.

</p>
<p>
REQ-6 Each call or session (incoming or outgoing) must be assigned a common "appearance" number from a managed pool administered for the AOR group.  Once the session has terminated, the appearance number is released back into the pool and can be reused by another incoming or outgoing session.

</p>
<p>
REQ-7 Each UA in the group must be able to learn the appearance status of the the group.

</p>
<p>
REQ-8 There must be mechanisms to resolve appearance contention among the UAs in the group.

</p>
<p>
REQ-9 The mechanism must allow all UAs receiving an incoming session request to utilize the same appearance number at the time of alerting. 

</p>
<p>
REQ-10 The mechanism must have a way of reconstructing appearance state after an outage that does not result in excessive traffic and processing. 

</p>
<p>
REQ-11 The mechanism must have backwards compatibility such that a UA which is unaware of the feature can still register against the group AOR and make and receive calls.

</p>
<p>
REQ-12 The mechanism must not allow UAs outside the group to select, seize or manipulate appearance numbers.

</p>
<p>
REQ-13 For privacy reasons, there must be a mechanism so that appearance information is not leaked outside the group of UAs. (e.g. "So who do you have on line 1?")

</p>
<p>
REQ-14 The mechanism must support a way for UAs to request exclusivity
on a line appearance. Exclusivity means that the UA requesting it
desires to  have a private conversation with the external party and
other UAs must not  be allowed to be joined or taken. Exclusivity may be requested
at the start of an incoming or outgoing session or during the session.
An exclusivity request may be accepted or rejected by the entity
providing the shared appearance service. Therefore, the mechanism must provide a way
of communicating the result back to the requester UA.

</p>
<p>
REQ-15  The mechanism should support a way for a UA to seize a particular appearance number for outgoing requests prior to sending the actual request.   This is often called seizure. 

</p>
<p>
REQ-16  The mechanism should support a way for a UA to seize a particular appearance number and also send the request at the same time.  This is needed when a ringdown feature is combined with shared appearances - in this case, seizing the line is the same thing as dialing.

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Implementation</h3>

<p>
Many of the requirements for this service can be met using standard SIP mechanisms such as:

</p>
<p>
 - A SIP Forking Proxy and Registrar/Location Service meets REQ-1.

</p>
<p>
 - The SIP Dialog Package meets REQ-2.

</p>
<p>
 - The SIP Replaces and Join header fields meets REQ-3.

</p>
<p>
- The use of a State Agent for the Dialog Package meets REQ-4 and REQ-5.

</p>
<p>
REQ-6 suggests the need for an entity which manages the appearance resource. Just as conferencing systems commonly have a single point of control, known as a focus, a Shared Appearance group has a single point of control of the appearance shared resource. This is defined as an Appearance Agent for a group. While an Appearance Agent can be part of a centralized server, it could also be co-resident in a member User Agent who has taken on this functionality for a group. The Appearance Agent knows or is able to determine the dialog state of all members of the group.

</p>
<p>
While the appearance resource could be managed co-operatively by a group of UAs without any central control, this is outside the scope of this draft.  It is also possible that the Appearance Agent logic could be distributed in all UAs in the group.  For example, rules that govern assigning appearance numbers for incoming requests (e.g. lowest available appearance number) and rules for contention handling (e.g. when two UAs request the use of the same appearance number, hash dialog identifiers and compare with the lowest hash winning) would need to be defined and implemented.

</p>
<p>
The next section discusses the operations used to implement parts of the shared appearance feature.  An analysis of other mechanisms has been performed, with the mechanism described here best meeting the requirements of Section 4.1.

</p>
<p></p>
<ol class="text">
<li>
A UA is configured with the AOR of a shared appearance group.  It registers against the AOR, then attempts a dialog state subscription to the AOR.  If the subscription fails, loops back to itself, or returns an error, it knows there is no State Agent, and hence no Appearance Agent and this feature is not implemented. 

</li>
<li>
If the subscription receives a 200 OK, the UA knows there is a State Agent and that the feature is implemented.  The UA then follows the steps in this list.

</li>
<li>
Information learned about the dialog state of other UAs in the group is rendered to the user. 

</li>
<li>
Incoming calls are forked to all UAs in the group, and any may answer.  UAs receive the appearance number to use in rendering the incoming call in a NOTIFY from the Appearance Agent and in the INVITE itself.   The UA will also receive a notification if the call is answered by another UA in the group so this information can be rendered to the user.

</li>
<li>
For outgoing calls, the operation depends on the implementation.  If the user seizes a particular appearance number for the call, the UA publishes this information and waits for a 200 OK before sending the INVITE.  

</li>
<li>
For outgoing calls, if the user does not seize a particular appearance or does not care, the INVITE can be sent immediately, and the appearance number learned as the call progresses from a notification from the Appearance Agent.  

</li>
<li>
For outgoing calls, if the user does not wish to seize an appearance (such as during a consultation call), the UA also publishes this prior to sending the INVITE.

</li>
<li>
Established calls within the group may be joined (bridged) or taken (picked) by another UA.  Information in the dialog package notifications can be used to construct Join or Replaces header fields.  Since the same appearance number is used for these types of operations, this information is published prior to sending the INVITE Join or INVITE Replaces.

</li>
<li>
In some cases, the Appearance Agent may not have full access to the complete dialog state of some or all of the UAs in the group.  If this is the case, the Appearance Agent will subscribe to the dialog state of individual UAs in the group to obtain this information.  Normal notifications will be sent every time the dialog state changes, including calls placed, answered, placed on and off hold, and hangups.

</li>
</ol><p>

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Normative Description</h3>

<p>
This section normatively describes the shared appearance feature extensions. The following definitions are used throughout this document:

</p>
<p>
Seizing: An appearance can be reserved prior to a call being placed by seizing the appearance.  An appearance can be seized by communicating an
artificial state of "trying" prior to actually initiating a dialog,
in order to appear as it was already initiating a dialog.   The appearance
number is confirmed prior to sending the INVITE. 

</p>
<p>
Selecting(or Not-Seizing): An appearance is merely selected
(i.e., not seized) if there is no such communication of 
artificial state of "trying" prior to initiating a dialog: i.e., the state is 
communicated when the dialog is actually initiated. The appearance 
number is learned after the INVITE is sent.  This is a user interface only issue.

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Elements</h3>

<p>
A complete system to implement this feature consists of:

</p>
<p></p>
<ol class="text">
<li>
User Agents that support publications, subscriptions, and notifications for the SIP dialog event package, and the shared appearance dialog package extensions and behavior.

</li>
<li>
An Appearance Agent consisting of a State Agent for the dialog event package that implements an Event State Compositor (ESC) and the shared appearance dialog package extensions and behavior.  The Appearance Agent also has logic for assigning and releasing appearance numbers, and resolving appearance number contention.

</li>
<li>
A forking proxy server that can communicate with the State Agent

</li>
<li>
A registrar that supports the registration event package.

</li>
</ol><p>

</p>
<p>
The behavior of these elements is described normatively in the following sections after the definitions of the dialog package extensions.

</p>
<a name="extensions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Shared Appearance Dialog Package Extensions</h3>

<p>
This specification defines four new elements as extensions to the SIP Dialog Event package <a class='info' href='#I-D.ietf-sipcore-rfc3265bis'>[I&#8209;D.ietf&#8209;sipcore&#8209;rfc3265bis]<span> (</span><span class='info'>Roach, A., &ldquo;SIP-Specific Event Notification,&rdquo; February&nbsp;2010.</span><span>)</span></a>.  The schema is defined in <a class='info' href='#schema'>Section&nbsp;6<span> (</span><span class='info'>XML Schema Definition</span><span>)</span></a>.  The elements are &lt;appearance&gt;, &lt;exclusive&gt;, &lt;joined-dialog&gt;, and &lt;replaced-dialog&gt; which are sub-elements of the &lt;dialog&gt; element.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
The &lt;appearance&gt; element</h3>

<p>
The &lt;appearance&gt; element is used to convey the appearance number.  The appearance number is a non-negative integer.  When sent in a publication in state Trying to the Appearance Agent, it is used to request an appearance number.  When sent by the Appearance Agent, it indicates that the appearance number is associated with a dialog.

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
The &lt;exclusive&gt; element</h3>

<p>
The &lt;exclusive&gt; element is a boolean used to indicate whether the UA will accept Join or Replaces INVITEs for this dialog. For example, some shared appearance systems only allow call pickup when the call is on hold.  In this case, the &lt;exclusive&gt; element should be used to explicitly indicate this, rather than implicitly by the hold state.

</p>
<p>
It is important to note that this element is a hint. Although a UA may set exclusive to true, the UA must still be ready to reject an INVITE Join relating to this dialog.  Also, an INVITE Replaces might be sent to the non-shared appearance UA to take the call.  For this reason, a UA MAY also not report full dialog identifier information to the Appearance Agent for calls set to exclusive.  If these dialog identifiers have already been shared with the Appearance Agent, the UA could send an INVITE Replaces to change them and then not report the new ones to the Appearance Agent.

</p>
<p>
If the proxy knows which dialogs are marked exclusive, the proxy MAY enforce this exclusivity by rejecting INVITE Join and INVITE Replaces requests containing those dialog identifiers with a 403 Forbidden response.

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
The &lt;joined-dialog&gt; element</h3>

<p>
The &lt;joined-dialog&gt; element is used to convey dialog identifiers of any other dialogs which are joined (mixed or bridged) with the dialog.  Only the UA which is performing the actual media mixing should include this element in notifications to the Appearance Agent.  Note that this element should still be used even when the Join header field was not used to join the dialogs.  For example, two separate dialogs on a UA could be joined without any SIP call control operations. Joined dialogs will share the same appearance number.

</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4"></a><h3>5.2.4.&nbsp;
The &lt;replaced-dialog&gt; element</h3>

<p>
The &lt;replaced-dialog&gt; element is used to convey dialog identifiers of any other dialogs which will be or have been replaced with this dialog. For example, a UA in the group picking up a call on another UA by sending an INVITE with Replaces would include this element for the replacing dialog.  Replaced dialogs will share the same appearance number.

</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Shared Appearance User Agents</h3>

<p>
User Agents that support the Shared Appearance feature MUST support
   the dialog state package <a class='info' href='#RFC4235'>[RFC4235]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2005.</span><span>)</span></a> with the shared appearance extensions and the 
   'shared' dialog event package parameter defined in Section 11. 

</p>
<p>
   User Agents MUST support the dialog package extensions in <a class='info' href='#extensions'>Section&nbsp;5.2<span> (</span><span class='info'>Shared Appearance Dialog Package Extensions</span><span>)</span></a> along with SUBSCRIBE and NOTIFY <a class='info' href='#I-D.ietf-sipcore-rfc3265bis'>[I&#8209;D.ietf&#8209;sipcore&#8209;rfc3265bis]<span> (</span><span class='info'>Roach, A., &ldquo;SIP-Specific Event Notification,&rdquo; February&nbsp;2010.</span><span>)</span></a> and PUBLISH <a class='info' href='#RFC3903'>[RFC3903]<span> (</span><span class='info'>Niemi, A., &ldquo;Session Initiation Protocol (SIP) Extension for Event State Publication,&rdquo; October&nbsp;2004.</span><span>)</span></a>.  SUBSCRIBE, NOTIFY, and PUBLISH requests for the dialog event package SHOULD include the 'shared' Event header field parameter.

</p>
<p></p>
<blockquote class="text">
<p>
The presence of the 'shared' Event package parameter tells the Appearance Agent that this UA supports this specification.

</p>
</blockquote>

<p>
Upon initialization, the UA SHOULD subscribe to the dialog event package of the AOR and refresh the subscription per the SIP Events Framework.   If the SUBSCRIBE request fails, loops back to itself, then no Appearance Agent is present and this feature is not active for this AOR.  The UA MAY periodically retry the subscription to see if conditions have changed. 

</p>
<p>

   User Agents which implement call pickup, joining and bridging MUST support sending an INVITE with Replaces <a class='info' href='#RFC3891'>[RFC3891]<span> (</span><span class='info'>Mahy, R., Biggs, B., and R. Dean, &ldquo;The Session Initiation Protocol (SIP) &quot;Replaces&quot; Header,&rdquo; September&nbsp;2004.</span><span>)</span></a>  or Join <a class='info' href='#RFC3911'>[RFC3911]<span> (</span><span class='info'>Mahy, R. and D. Petrie, &ldquo;The Session Initiation Protocol (SIP) &quot;Join&quot; Header,&rdquo; October&nbsp;2004.</span><span>)</span></a>.  All User Agents supporting INVITE MUST support receiving an INVITE with a Replaces <a class='info' href='#RFC3891'>[RFC3891]<span> (</span><span class='info'>Mahy, R., Biggs, B., and R. Dean, &ldquo;The Session Initiation Protocol (SIP) &quot;Replaces&quot; Header,&rdquo; September&nbsp;2004.</span><span>)</span></a>  or a Join <a class='info' href='#RFC3911'>[RFC3911]<span> (</span><span class='info'>Mahy, R. and D. Petrie, &ldquo;The Session Initiation Protocol (SIP) &quot;Join&quot; Header,&rdquo; October&nbsp;2004.</span><span>)</span></a> header field. 

</p>
<p>
   When publishing or notifying dialog package information, a UA MUST include all 
   dialog identification available at the time of publication, with 
   the exception that a UA may omit information if it wishes to prevent 
   other UAs from joining or picking up a call. Dialog identification 
   includes local and remote target URIs, call-id, to-tag, and 
   from-tag. When calls are placed on hold, the "+sip.rendering=no" feature tag    
   MUST be included in dialog package notifications. 

</p>
<p></p>
<blockquote class="text">
<p>

The accurate rendering of the idle/active/alerting/hold state of other UAs in the group is an important part of the shared appearance feature.

</p>
</blockquote>

<p>

A UA MUST send dialog package PUBLISH requests in the following situations:

</p>
<p></p>
<ol class="text">
<li>
When the user seizes a particular appearance number for an outgoing call (i.e. seizing the appearance and going "off-hook", if the UA's user interface uses this metaphor).  

</li>
<li>
When the user has requested that an appearance number not be used for an outgoing call (i.e. during a consultation call or for a call not considered part of the shared appearance group).  

</li>
<li>
When the user has selected to join (or bridge) an existing call.

</li>
<li>
When the user has selected to replace (or take) an existing call.

</li>
</ol><p>

</p>
<p>
In all these cases, the INVITE SHOULD NOT be sent until the 200 OK response to the PUBLISH has been received, except for an emergency call, when a UA MUST never wait for a confirmed seizure before sending an INVITE.  Instead, the emergency call MUST
   proceed regardless of the status of PUBLISH transaction. 

</p>
<p>

Note that when a UA seizes an appearance prior to establishment of a dialog (#1 and #2 in above list), not all dialog information will be available. In particular, when a UA publishes an attempt to seize an appearance prior to knowing the destination URI, minimal or no dialog information may be available.  For example, in some cases, only the local target URI for the call will be known and no dialog information. If no dialog identification information is present in the initial PUBLISH, the UA MUST PUBLISH again after receiving the 100 Trying response.

</p>
<p></p>
<blockquote class="text">
<p>
The first publication will cause the Appearance Agent to reserve the appearance number for this UA.  If the publication does not have any dialog identifiers (e.g. Call-ID, or local tag) the Appearance Agent cannot assign the appearance number to a particular dialog of the UA until the second publication which will contain some dialog identifiers.

</p>
</blockquote>

<p>
This publication state SHOULD be refreshed during the early dialog state or the Appearance Agent may reassign the appearance number.  Once the dialog has transitioned to the confirmed state, no publication refreshes are necessary.

</p>
<p>
UAs SHOULD render information about other appearances to the user.  This includes the state (idle, active, busy, joined, etc.).
   UAs can tell that a set of dialogs are joined (bridged or mixed)
   together by the presence of one or more &lt;joined-dialog&gt;  elements
   containing other SIP dialog identifiers. A UA SHOULD render the appearance number to the user or display appearance status information to the user in a way that preserves the appearance order.  Appearance numbers of dialogs can be learned by dialog package notifications containing the &lt;appearance&gt; element from the Appearance Agent or from the 'appearance' Alert-Info parameter in an incoming INVITE.  Should they conflict, the dialog package notification takes precedence. 


</p>
<p>

   A UA that does not need to seize a particular appearance number (or
   doesn't care) would just send an INVITE as normal to place an
   outbound call. 

</p>
<p>
A UA wanting to place a call but not have an appearance number assigned publishes before sending the INVITE without an 'appearance' element but with the 'shared' event package parameter present.  If the Appearance Agent policy does not allow calls without an assigned appearance number, a 409 Conflict response will be received, and the UA will republish either selecting/seizing an appearance number or without one, in which case the Appearance Agent will assign one.

</p>
<p>
   When an INVITE is generated to attempt to bridge or
   take a call (i.e. contains Join or Replaces with a dialog identifier
   of another dialog in the shared appearance group), the appearance number of the joined or replaced call SHOULD be used. The publication MUST contain the appearance number of the dialog to be joined or replaced and the dialog identifier in the 'joined-dialog' or 'replaced-dialog' elements.  

</p>
<p></p>
<blockquote class="text">
<p>
Note that this information is provided to the Appearance Agent so that it can provide proper appearance assignment behavior.  With Join, the goal is to prevent the Appearance Agent from generating a 409 Conflict response due to the reuse of an appearance number.  For Replaces, the goal is to prevent a race condition where the BYE could cause the appearance number to be released when it should stay with the replacing dialog.

</p>
</blockquote>

<p>

   A UA SHOULD register against the AOR only if it is likely the UA will
   be answering incoming calls.  If the UA is mainly going to be
   monitoring the status of the shared appearance group calls and picking or joining
   calls, the UA SHOULD only subscribe to the AOR and not
   register against the AOR.


</p>
<p></p>
<blockquote class="text">
<p>
All subscribed UAs will received NOTIFYs of Trying state for incoming INVITEs.

</p>
</blockquote>

<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Appearance Agent</h3>

<p>
An Appearance Agent defined in this specification MUST implement a dialog package state agent for the UAs registered against the AOR. The Appearance Agent MUST support the appearance dialog package extensions defined in <a class='info' href='#extensions'>Section&nbsp;5.2<span> (</span><span class='info'>Shared Appearance Dialog Package Extensions</span><span>)</span></a>.  The Appearance Agent MUST support publications and subscriptions for this event package.

</p>
<p>
The Appearance Agent MUST have a way of discovering the state of all dialogs associated with the AOR.  If this information is not available from a call stateful proxy or B2BUA, the Appearance Agent MAY use the registration event package <a class='info' href='#RFC3680'>[RFC3680]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Session Initiation Protocol (SIP) Event Package for Registrations,&rdquo; March&nbsp;2004.</span><span>)</span></a> to learn of UAs associated with the AOR and MAY subscribe to their dialog event state.  As a result, the registrar MUST support the registration event package.  The Appearance Agent SHOULD send dialog event state notifications whenever the following events happen to UAs in the AOR group:

</p>
<p></p>
<ol class="text">
<li>
A call is received, placed, answered, or terminated.

</li>
<li>
A call is placed on or off hold.

</li>
<li>
A call is joined or replaced.

</li>
<li>
An appearance number is reserved or released.

</li>
</ol>

<p>
The Appearance Agent MUST allocate an appearance number for all incoming calls and send immediate notifications to the UAs subscribed to the shared group AOR.  The Appearance Agent MUST be able to communicate with the forking proxy to learn about incoming calls and also to pass the appearance number to the proxy to insert in the Alert-Info header field.

</p>
<p>
An Appearance Agent SHOULD assign an appearance number to an outgoing INVITE if a PUBLISH has not been received selecting/seizing a particular appearance number. 

</p>
<p></p>
<blockquote class="text">
<p>
Note that if the appearance group has non-shared appearance UAs, the Appearance Agent will still allocate appearance numbers for INVITEs sent by those UAs.

</p>
</blockquote>

<p>
An Appearance Agent receiving a PUBLISH with an appearance number checks to make sure the publication is valid.  An appearance number can be assigned to only one dialog unless there is a 'joined-dialog' or 'replaced-dialog' element indicating that the dialog will be/has been replaced or joined.  A 409 Conflict response is returned if the chosen appearance number is invalid, and an immediate NOTIFY should be sent to the UA containing full dialog event state.

</p>
<p>
An Appearance Agent receiving a PUBLISH without an appearance number but with the 'shared' event package parameter present interprets this as a request by the UA to not assign an appearance number.  If the Appearance Agent policy does not allow this, a 409 Conflict response is returned.  If policy does allow this, a 200 OK response is returned and no appearance number is allocated.  In general, the dialog state will not be shared with the other UAs in the group.

</p>
<p>
The Appearance Agent allocates an appearance number to a dialog from the time the appearance is requested via a PUBLISH or from the receipt of an INVITE, to the time when the last dialog associated with the appearance is terminted, including all dialogs which are joined or replaced.  During the early dialog state, the Appearance Agent controls the rate of dialog state publication using the Expires header field in 200 OK responses to PUBLISH requests. An interval of 3 minutes is RECOMMENDED.  After the dialog associated with the publication has been confirmed, the expiration of the publication state has no effect on the appearance allocation.  If the publication contains no dialog state information, the Appearance Agent MUST reserve the appearance number for the UA but can not assign the appearance to any particular dialog of the UA.  When the publication state is updated with any dialog information, the appearance number can then be assigned to the particular dialog.

</p>
<p>
During dynamic situations, such as during a call pickup or join action, the Appearance Agent MAY choose to implement rate limiting to reduce the amount of notification traffic.  For example, an Appearance Agent may choose not to generate immediate NOTIFYs upon receipt of PUBLISHes.  Instead, a single NOTIFY can convey the effects of a number of PUBLISHes, thus reducing the NOTIFY traffic within the group.

</p>
<p>

If an INVITE is sent and no appearance number is available, the proxy
   MAY reject the INVITE with a 403 Forbidden response code.



</p>
<a name="schema"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
XML Schema Definition</h3>

<p>
   The 'appearance', 'joined-dialog', 'replaced-dialog', and 'exclusive' elements are defined within a new XML
   namespace URI.  This namespace is "urn:ietf:params:xml:ns:sa-dialog-info".
   The schema for these elements is:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;xs:schema
    targetNamespace="urn:ietf:params:xml:ns:sa-dialog-info-info"
    xmlns="urn:ietf:params:xml:ns:sa-dialog-info"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    elementFormDefault="qualified"&gt;


   &lt;xs:element name="joined-dialog" minOccurs="0"
                                         maxOccurs="unbounded"&gt;
          &lt;xs:complexType&gt;
            &lt;xs:attribute name="call-id" type="xs:string"
              use="mandatory"/&gt;
            &lt;xs:attribute name="local-tag" type="xs:string"
              use="mandatory"/&gt;
            &lt;xs:attribute name="remote-tag" type="xs:string"
              use="mandatory"/&gt;
           &lt;/xs:complexType&gt;
        &lt;/xs:element&gt;

   &lt;xs:element name="replaced-dialog" minOccurs="0"
                                          maxOccurs="unbounded"&gt;
          &lt;xs:complexType&gt;
            &lt;xs:attribute name="call-id" type="xs:string"
              use="mandatory"/&gt;
            &lt;xs:attribute name="local-tag" type="xs:string"
              use="mandatory"/&gt;
            &lt;xs:attribute name="remote-tag" type="xs:string"
              use="mandatory"/&gt;
           &lt;/xs:complexType&gt;
        &lt;/xs:element&gt;

        &lt;xs:element name="appearance" minOccurs="0" maxOccurs="1"&gt;
          &lt;xs:simpleType type="xs:integer"&gt;
          &lt;/xs:simpleType&gt;
        &lt;/xs:element&gt;

        &lt;xs:element name="exclusive" minOccurs="0" maxOccurs="1"&gt;
         &lt;xs:simpleType type="xs:boolean"&gt;
         &lt;/xs:simpleType&gt;
        &lt;/xs:element&gt;
  &lt;/xs:schema&gt;

</pre></div>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
User Interface Considerations</h3>

<p>
The "appearance number" allocated to a call is an important concept that
enables calls to be handled by multiple devices with heterogeneous user
interfaces in a manner that still allows users to see a consistent model.
Careful treatment of the appearance number is essential to meet the
expectations of the users.  Also, rendering the correct call/appearance state to users is also important.

</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Appearance Number Rendering</h3>

<p>
Since different UAs have different user interface capabilities, it
is usual to find that some UAs have restrictions that others do not.
Perfect interoperability across all UAs is clearly not possible, but
by careful design, interoperability up to the limits of each UA can
be achieved.

</p>
<p>
The following guidelines suggest how the appearance number should be
handled in three typical user interface implementations.

</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1"></a><h3>7.1.1.&nbsp;
Single Appearance UAs</h3>

<p>
 These devices are constrained by only having the
capability of displaying status indications for a single appearance.
Despite this, it is important that devices of this type do not ignore
the appearance number.  The UA should still send messages annotated with
an appropriate appearance number (i.e. "0").  Any call indications for
appearances other than for number "0" should be rejected with a 486 or 480 response.

</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.2"></a><h3>7.1.2.&nbsp;
Dual Appearance UAs</h3>

<p>
These devices are essentially single appearance phones that implement call waiting.  They have a very simple user interface that allows them to switch between two appearances (toggle or flash hook) and perhaps audible tones to indicate the status of the other appearance.

</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.3"></a><h3>7.1.3.&nbsp;
Shared Appearance UAs with Fixed Appearance Number</h3>

<p>
This UA is the typical 'business-class' hard-phone.  A number of appearances are
typically configured statically and labeled on buttons, and calls may be managed using these configured appearances.  Any calls outside this range should be ignored, and not mapped to a free button.  Users of these devices often seize specific appearance numbers for outgoing calls, and the UA will need to seize the appearance number and wait for confirmation from the Appearance Agent before proceeding with calls.

</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.4"></a><h3>7.1.4.&nbsp;
Shared Appearance UAs with Variable Appearance Number</h3>

<p>
This UA is typically a soft-phone or graphically rich user interface hard-phone.  In these cases,
even the idea of an appearance index may seem unnecessary.  However,
for these phones to be able to interwork successfully with other phone
types, it is important that they still use the appearance index to govern
the order of appearance of calls in progress.  No specific guidance
on presentation is given except that the order should be consistent.
Thought should also be given to how an appearance number that has no call
associated with it should be rendered to the user.  These devices can typically make calls without waiting for confirmation from the Appearance Agent on the appearance number.

</p>
<p>
The problems faced by each style of user interface are readily seen in
this example:

</p>
<p></p>
<ol class="text">
<li>
A call arrives at the shared appearance group, and is assigned an appearance number
of 0.  All UAs should be able to render to the user the arrival of this call.

</li>
<li>
Another call arrives at the shared appearance group, and is assigned an appearance
number of 1.  The single appearance UA should not present this call to the user.  Other user agents should have no problems presenting this call distinctly from the first call.

</li>
<li>
The first call clears, releasing appearance number "0".  
The single appearance UA should now be indicating no calls since it is unable 
to manage calls other than on the first appearance.  Both shared appearance UAs should clearly show that appearance number 0 is now free, but that
there is still a call on appearance number 1.

</li>
<li>
A third call arrives, and is assigned the appearance number of 0.
All UAs should be able to render the arrival of this new call to the user.
Multiple appearnce UAs should continue to indicate the presence of the second
call, and should also ensure that the presentation order is related to
the appearance number and not the order of call arrival.

</li>
</ol>

<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Call State Rendering</h3>

<p>
UAs that implement the shared appearance feature typically have a user interface that provides the state of other appearances in the group.  As dialog state NOTIFYs from the Appearance Agent are processed, this information can be rendered.  Even the simplest user interface typically has three states: idle, active, and hold.  The idle state, usually indicated by lamp off, is indicated for an appearance when the appearance number is not associated with any dialogs, as reported by the Appearance Agent.  The active state, usually indicated by a lamp on, is indicated by an appearance number being associated with at least one dialog, as reported by the Appearance Agent.  The hold state, often indicated by a blinking lamp, means the call state from the perspective of the UA in the shared appearance group is hold.  This can be determined by the presence of the "sip+rendering=no" feature tag <a class='info' href='#RFC3840'>[RFC3840]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and P. Kyzivat, &ldquo;Indicating User Agent Capabilities in the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a> with the local target URI.  Note that the hold state of the remote target URI is not relevant to this display.  For joined dialogs, the state is rendered as hold only if all local target URIs are indicated with the "sip+rendering=no" feature tag.

</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Interop with non-Shared Appearance UAs</h3>

<p>
It is desirable to allow a basic UA that does not directly
support shared appearance to be part of a shared appearance group. To support this the Proxy
must collaborate with the Appearance Agent. This is not required in
the basic shared appearance architecture, consequently shared appearance interop with non-shared appearance UAs
will not be available in all shared appearance deployments.

</p>
<p>
First, a UA which does not support dialog events or the shared appearance feature will be discussed.  Then, a UA which does support dialog events but not the shared appearance feature will be discussed.

</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Appearance Assignment</h3>

<p>
A UA that has no knowledge of appearances must have appearance numbers assigned by the Appearance Agent for both incoming and outgoing calls.  If the non-shared appearance UA does not support Join or Replaces, all dialogs could be marked "exclusive" to indicate that these options are not available.

</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Appearance Release</h3>

<p>
In all cases the Appearance Agent must be aware of dialog lifetime to release appearances back into the group. 

</p>
<p>
It is also desirable that any dialog state changes (such as hold, etc) be made available to other UAs in the group through the Dialog Event Package. If the Appearance Agent includes a proxy which Record-Routes for dialogs from the non-shared appearance aware UA, the Appearance Agent will know about the state of dialogs including hold, etc.  This information could be determined from inspection of INVITE and re-INVITE messages and added to the dialog information conveyed to other UAs.  

</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
UAs Supporting Dialog Events but Not Shared Appearance</h3>

<p>
Interoperability with UAs which support dialog events but not the shared appearance feature is more straightforward.  As before, all appearance number assignment must be done by the Appearance Agent.  This type of UA will be detected by the Appearance Agent by the absence of the 'shared' event parameter in SUBSCRIBE or PUBLISH messages.  The Appearance Agent can include appearance information in NOTIFYs - this UA will simply ignore this extra information.  This type of UA will ignore appearance number limitations and may attempt to Join or Replace dialogs marked exclusive.  As a result, the Proxy or UAs may need to reject such requests.

</p>
<p>
The need for close cooperation between the Proxy and the Appearance Agent is not needed as the Appearance Agent will learn about all dialogs from the UA itself.

</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Provisioning Considerations</h3>

<p>
UAs can automatically discover if this feature is active for an AOR by sending a SUBSCRIBE to the AOR, so no provisioning for this is needed.

</p>
<p>
The registrar will need to be provisioned to accept either first or third party registrations for the shared AOR.  First party registration means the To and From URIs in the REGISTER request are the shared AOR URI.  Third party registration means the To URI is the shared AOR URI and the From URI is a different AOR, perhaps that of the individual user.  Either the credentials of the shared AOR or the user MUST be accepted by the registrar and the Appearance Agent, depending on the authorization policy in place for the domain.

</p>
<p>
If the Appearance Agent needs to subscribe to the dialog state of the UAs, then the Appearance Agent and the UAs need to be provisioned with credentials so the UAs can authenticate the Appearance Agent.

</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Example Message Flows</h3>

<p>
The next section shows call flow and message examples.  The flows and descriptions are non-normative.

</p>
<p>
Note that the first twelve examples assume the Appearance Agent is aware of dialog state events.  Example 10.13 shows the case where this is not the case and as a result the Appearance Agent initiates a subscription to users of the shared AOR.  Any of the other call flow examples could have shown this mode of operation as it is equally valid.  

</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1"></a><h3>10.1.&nbsp;
Registration and Subscription</h3>

<p>
Bob and Alice are in an appearance group identified by the shared appearance AOR sip:HelpDesk@example.com. Bob REGISTERs using contact sip:bob@ua2.example.com. Alice REGISTERs with contact sip:alice@ua1.example.com. 

</p>
<p>
User Agents for Alice and Bob subscribe to the dialog package for the appearance AOR and publish dialog state to the Appearance Agent. Message exchanges between the Registrar, Appearance Agent, Alice, and Bob are shown below.
The call flow examples below do not show the authentication of subscriptions, publications, and notifications. It should be noted that for security purposes, all subscriptions must be authorized before the same is accepted.

</p>
<p>
Also note that registrations and subscriptions must all be refreshed by Alice at intervals determined by the expiration intervals returned by the Registrar or Appearance Agent.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Registrar     Appearance Agent          Alice             Bob
|                    |                    |                |
|                    |                    |                |
|&lt;--------------------------- REGISTER F1&lt;|                |
|                    |                    |                |
|&gt;F2 200 OK -----------------------------&gt;|                |
|                    |                    |                |
|                    |&lt;----- SUBSCRIBE F3&lt;|                |
|                    |                    |                |
|                    |&gt;F4 200 OK --------&gt;|                |
|                    |                    |                |
|                    |&gt;F5 NOTIFY --------&gt;|                |
|                    |                    |                |
|                    |&lt;-------- 200 OK F6&lt;|                |
|                    |                    |                |
|&lt;-------------------------------------------- REGISTER F7&lt;|
|                    |                    |                |
|&gt;F8 200 OK ----------------------------------------------&gt;|
|                    |                    |                |
|                    |&lt;---------------------- SUBSCRIBE F9&lt;|
|                    |                    |                |
|                    |&gt;F10 200 OK ------------------------&gt;|
|                    |                    |                |
|                    |&gt;F11 NOTIFY ------------------------&gt;|
|                    |                    |                |
|                    |&lt;------------------------ 200 OK F12&lt;|
|                    |                    |                |

Figure 1.

F1-F2: Alice registers AOR with
       contact: &lt;sip:alice@ua1.example.com&gt;

F1 Alice ----&gt; Registrar

REGISTER sip:registrar.example.com SIP/2.0
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bK527b54da8ACC7B09
From: &lt;sip:alice@example.com&gt;;tag=CDF9A668-909E2BDD
To: &lt;sip:HelpDesk@example.com&gt;
CSeq: 2 REGISTER
Call-ID: d3281184-518783de-cc23d6bb
Contact: &lt;sip:alice@ua1.example.com&gt;
Max-Forwards: 70
Expires: 3600
Content-Length: 0


F2 Registrar ----&gt; Alice

SIP/2.0 200 OK
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bKfbf176ef7F1D5FA2
CSeq: 2 REGISTER
Call-ID: d3281184-518783de-cc23d6bb
From: &lt;sip:alice@example.com&gt;;tag=CDF9A668-909E2BDD
To: &lt;sip:HelpDesk@example.com&gt;;tag=1664573879820199
Contact:  &lt;sip:alice@ua1.example.com&gt;
Expires:  3600
Content-Length: 0


F3 to F6: Alice also subscribes to the events associated with the
Appearance AOR. Appearance Agent also notifies Alice of the status.

F3 Alice ----&gt; Appearance Agent

SUBSCRIBE sip:HelpDesk@example.com SIP/2.0
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bKf10fac97E7A76D6A
From: &lt;sip:alice@example.com&gt;;tag=925A3CAD-CEBB276E
To: &lt;sip:HelpDesk@example.com&gt;
CSeq: 91 SUBSCRIBE
Call-ID: ef4704d9-bb68aa0b-474c9d94
Contact: &lt;sip:alice@ua1.example.com&gt;
Event: dialog;shared
Accept: application/dialog-info+xml
Max-Forwards: 70
Expires: 3700
Content-Length: 0


F4 Appearance Agent ----&gt; Alice

SIP/2.0 200 OK
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bKf10fac97E7A76D6A
CSeq: 91 SUBSCRIBE
Call-ID: ef4704d9-bb68aa0b-474c9d94
From: &lt;sip:alice@example.com&gt;;tag=925A3CAD-CEBB276E
To: &lt;sip:HelpDesk@example.com&gt;;tag=1636248422222257
Allow-Events: dialog
Expires: 3700
Contact: &lt;sip:appearanceagent.example.com&gt;
Content-Length: 0


F5 Appearance Agent ----&gt; Alice

NOTIFY sip:alice@ua1.example.com SIP/2.0
From: &lt;sip:HelpDesk@example.com&gt;;tag=1636248422222257
To: &lt;sip:alice@example.com&gt;;tag=925A3CAD-CEBB276E
Call-ID: ef4704d9-bb68aa0b-474c9d94
CSeq: 232 NOTIFY
Via: SIP/2.0/UDP appearanceagent.example.com;branch=z9hG4bK1846
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Event: dialog;shared
Subscription-State: active
Contact: &lt;appearanceagent.example.com&gt;
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             version="40"
             state="full"
             entity="sip:HelpDesk@example.com"&gt;
&lt;/dialog-info&gt;


F6 Alice ----&gt; Appearance Agent

SIP/2.0 200 OK
Via: SIP/2.0/UDP appearanceagent.example.com;branch=z9hG4bK1846
From: &lt;sip:HelpDesk@example.com&gt;;tag=1636248422222257
To: &lt;sip:alice@example.com&gt;;tag=925A3CAD-CEBB276E
CSeq: 232 NOTIFY
Call-ID: ef4704d9-bb68aa0b-474c9d94
Contact: &lt;sip:alice@ua1.example.com&gt;
Event: dialog;shared
Content-Length: 0


F7 Bob ----&gt; Registrar

REGISTER sip:registrar.example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4b53b54d87B
From: &lt;sip:bob@example.com&gt;;tag=34831131
To: &lt;sip:HelpDesk@example.com&gt;
CSeq: 72 REGISTER
Call-ID: 139490230230249348
Contact: &lt;sip:bob@ua2.example.com&gt;
Max-Forwards: 70
Expires: 3600
Content-Length: 0


F8 Registrar ----&gt; Bob

SIP/2.0 200 OK
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4b53b54d87B
From: &lt;sip:bob@example.com&gt;;tag=34831131
To: &lt;sip:HelpDesk@example.com&gt;;tag=fkwlwqi1
CSeq: 72 REGISTER
Call-ID: 139490230230249348
Contact: &lt;sip:alice@ua1.example.com&gt;;expires=3200
Contact: &lt;sip:bob@ua2.example.com&gt;;expires=3600
Content-Length: 0



</pre></div>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2"></a><h3>10.2.&nbsp;
Appearance Selection for Incoming Call</h3>

<p>
In the call flow below Bob and Alice are in an appearance group. Carol places a call to the appearance group AOR. The Appearance Agent sends NOTIFYs to Alice and Bob telling them what appearance the call is using.  Both Alice and Bob's devices are alerted of the incoming call. Bob answers the call. 

</p>
<p>
Note that it is possible that both Alice and Bob answer the call and send 200 OK responses to Carol.  It is up to Carol to resolve this situation.  Typically, Carol will send ACKs to both 200 OKs but send a BYE to terminate one of the dialogs.  As a result, either Alice or Bob will receive the BYE and publish that their dialog is over.  However, if Carol answers both Alice and Bob and keeps both dialogs active, then the Appearance Agent will need to resolve the situation by moving either Alice or Bob's dialog to a different appearance.

</p>
<p>
All NOTIFY messages in the call flow below carry dialog events and only dialog states are mentioned for simplicity. For brevity, the details of some messages are not shown below.  Note that the order of F2 - F5 and F7 - F8 could be reversed.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           Forking     Appearance
Carol      Proxy         Agent         Alice      Bob
|            |             |             |         |
|&gt;F1 INVITE &gt;|             |             |         |
|            |&lt; - - - - - &gt;|             |         |
|            |             |&gt;F2 NOTIFY -----------&gt;|
|            |             |             |         |
|            |             |&lt;F3 200 OK -----------&lt;|
|            |             |             |         |
|            |             |&gt;F4 NOTIFY -&gt;|         |
|            |             |             |         |
|            |             |&lt;-200 OK F5-&lt;|         |
|&lt;- 100 F6 -&lt;|             |             |         |
|            |&gt;F7 INVITE (appearance=1) ----------&gt;|
|            |             |             |         |
|            |&gt;F8 INVITE (appearance=1) &gt;|         |
|            |             |             |         |
|            |&lt;-------------------- Ringing 180 F9&lt;|
|&lt; 180 F10 -&lt;|             |             |         |
|            |&lt;--------- 180 Ringing F11&lt;|         |
|&lt; 180 F12 -&lt;|             |             |         |
|            |             |             |         |
|            |&lt;------------------------ 200 OK F13&lt;|
|&lt; 200 F14 -&lt;|             |             |         |
|            |             |             |         |
|            |&gt;F15 CANCEL --------------&gt;|         |
|            |             |             |         |
|            |&lt;-------------- 200 OK F16&lt;|         |
|            |             |             |         |
|            |&lt;Request Cancelled 487 F17&lt;|         |
|            |             |             |         |
|            |&gt;F18 ACK -----------------&gt;|         |
|&gt;F19 ACK --&gt;|             |             |         |
|            |&gt;F20 ACK ---------------------------&gt;|
|            |             |             |         |
|&lt;=============Both way RTP established===========&gt;|
|            |             |             |         |
|            |&lt; - - - - - &gt;|             |         |
|            |             |             |         |
|            |             |&gt;F21 NOTIFY &gt;|         |
|            |             |             |         |
|            |             |&lt;- 200 F22 -&lt;|         |
|            |             |             |         |
|            |             |&gt;F23 NOTIFY ----------&gt;|
|            |             |             |         |
|            |             |&lt;F24 200 OK ----------&lt;|
|            |             |                       |

Figure 2.


F4 Appearance Agent ----&gt; Alice

NOTIFY sip:alice@ua1.example.com SIP/2.0
From: &lt;sip:HelpDesk@example.com&gt;;tag=151702541050937
To: &lt;sip:alice@example.com&gt;;tag=18433323-C3D237CE
Call-ID: 1e361d2f-a9f51109-bafe31d4
CSeq: 12 NOTIFY
Via: SIP/2.0/UDP appearanceagent.example.com;branch=z9hG4bK1403
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Event: dialog;shared
Subscription-State: active
Contact: &lt;appearanceagent.example.com&gt;
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="13"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
   &lt;dialog id="2a7294823093f5274e3fd2ec54a2d76c"
        call-id="14-1541707345"
        remote-tag="44BAD75D-E3128D42"
        direction="recipient"&gt;
      &lt;sa:appearance&gt;1&lt;/sa:appearance&gt;
      &lt;state&gt;trying&lt;/state&gt;
      &lt;remote&gt;
        &lt;identity&gt;sip:carol@ua.example.com&lt;/identity&gt;
      &lt;/remote&gt;
   &lt;/dialog&gt;
&lt;/dialog-info&gt;


F7 Proxy ----&gt; Bob

INVITE sip:bob@ua2.example.com SIP/2.0
Via: SIP/2.0/UDP ua3.example.com;branch=z9hG4bK4324ea
Via: SIP/2.0/UDP proxy.example.com;branch=z9hG4bK38432ji
From: &lt;sip:carol@example.com&gt;;tag=44BAD75D-E3128D42
To: &lt;sip:HelpDesk@example.com&gt;
CSeq: 106 INVITE
Call-ID: 14-1541707345
Contact: &lt;sip:carol@ua3.example.com&gt;
Max-Forwards: 69
Alert-Info: &lt;urn:alert:tone:normal&gt;;appearance=1
Content-Type: application/sdp
Content-Length: ...

v=0
o=- 1102980499 1102980499 IN IP4 ua3.example.com
s=
c=IN IP4 ua3.example.com
t=0 0
m=audio 2238 RTP/AVP 0 8 101
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:101 telephone-event/8000


F21 Appearance Agent ----&gt; Alice

NOTIFY sip:alice@ua1.example.com SIP/2.0
From: &lt;sip:HelpDesk@example.com&gt;;tag=151702541050937
To: &lt;sip:alice@example.com&gt;;tag=18433323-C3D237CE
Call-ID: 1e361d2f-a9f51109-bafe31d4
CSeq: 12 NOTIFY
Via: SIP/2.0/UDP appearanceagent.example.com;branch=z9hG4bK1403
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Event: dialog;shared
Subscription-State: active
Contact: &lt;appearanceagent.example.com&gt;
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="13"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
   &lt;dialog id="2a7294823093f5274e3fd2ec54a2d76c"
        call-id="14-1541707345"
        remote-tag="44BAD75D-E3128D42"
        local-tag="7349dsfjkFD03s"
        direction="recipient"&gt;
      &lt;sa:appearance&gt;1&lt;/sa:appearance&gt;
      &lt;state&gt;confirmed&lt;/state&gt;
      &lt;local&gt;
        &lt;target&gt;sip:bob@ua2.example.com&lt;/target&gt;
      &lt;/local&gt;
      &lt;remote&gt;
        &lt;identity&gt;sip:carol@ua.example.com&lt;/identity&gt;
      &lt;/remote&gt;
   &lt;/dialog&gt;
&lt;/dialog-info&gt;

</pre></div>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.3"></a><h3>10.3.&nbsp;
Outgoing Call without Appearance Seizure</h3>

<p>
In this scenario, Bob's UA places a call without first selecting/seizing an appearance number.  After Bob sends the INVITE, the appearance assigns an appearance number for it and notifies both Alice and Bob. 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|              |               |              |                  |
|              |&lt;------------------------------------- INVITE F1&lt;|
|              |               |              |                  |
|              |&gt;F2 100 Trying ---------------------------------&gt;|
|&lt;-- INVITE F3&lt;|               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;-- NOTIFY F4&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F5 200 OK --&gt;|                  |
|              |               |              |------- NOTIFY F6&gt;|
|              |               |              |                  |
|              |               |              |&lt;F7 200 OK ------&lt;|
|&gt;F8 180  ----&gt;|               |              |                  |
|              |&gt;F9 180 Ringing --------------------------------&gt;|
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F10&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F11 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F12&gt;|
|              |               |              |                  |
|              |               |              |&lt;F13 200 OK -----&lt;|
|&gt;F14 200 OK -&gt;|               |              |                  |
|              |&gt;F15 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;--------------------------------------- ACK F16&lt;|
|&lt;---- ACK F17&lt;|               |              |                  |
|              |               |              |                  |
|&lt;================= Both way RTP established ===================&gt;|
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F18&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F19 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F20&gt;|
|              |               |              |                  |
|              |               |              |&lt;F21 200 OK -----&lt;|
|              |               |              |                  |

Figure 3.


F1 Bob ----&gt; Proxy

INVITE sip:carol@example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bK98c87c52123A08BF
From: &lt;sip:HelpDesk@example.com&gt;;tag=15A3DE7C-9283203B
To: &lt;sip:carol@example.com&gt;
CSeq: 1 INVITE
Call-ID: f3b3cbd0-a2c5775e-5df9f8d5
Contact: &lt;sip:bob@ua2.example.com&gt;
Max-Forwards: 70
Content-Type: application/sdp
Content-Length: 223

v=0
o=- 1102980499 1102980499 IN IP4 ua2.example.com
s=IP SIP UA
c=IN IP4 ua2.example.com
t=0 0
a=sendrecv
m=audio 2236 RTP/AVP 0 8 101
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:101 telephone-event/8000


F4 Appearance Agent ----&gt; Alice

NOTIFY sip:alice@ua1.example.com SIP/2.0
Via: SIP/2.0/UDP appearanceagent.example.com;branch=z9hG4bK81d84f62
From: &lt;sip:HelpDesk@example.com&gt;;tag=1636248422222257
To: &lt;sip:alice@example.com&gt;;tag=925A3CAD-CEBB276E
Call-ID: ef4704d9-bb68aa0b-474c9d94
CSeq: 233 NOTIFY
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Event: dialog;shared
Subscription-State: active
Contact: &lt;appearanceagent.example.com&gt;
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="27"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
    &lt;dialog id="fa02538339df3ce597f9e3e3699e28fc"
         call-id="f3b3cbd0-a2c5775e-5df9f8d5"
         local-tag="15A3DE7C-9283203B"    direction="initiator"&gt;
            &lt;sa:appearance&gt;0&lt;/sa:appearance&gt;
            &lt;sa:exclusive&gt;false&lt;/sa:exclusive&gt;
	       &lt;state&gt;trying&lt;/state&gt;
	        &lt;local&gt;
		    &lt;target uri="sip:bob@ua2.example.com"&gt;
 		    &lt;/target&gt;
		   &lt;/local&gt;
	&lt;/dialog&gt;
&lt;/dialog-info&gt;


F6 Appearance Agent ----&gt; Bob

NOTIFY sip:bob@ua1.example.com SIP/2.0
From: &lt;sip:HelpDesk@example.com&gt;;tag=497585728578386
To: &lt;sip:bob@example.com&gt;;tag=633618CF-B9C2EDA4
Call-ID: a7d559db-d6d7dcad-311c9e3a
CSeq: 7 NOTIFY
Via: SIP/2.0/UDP appearanceagent.example.com
 ;branch=z9hG4bK1711759878512309
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Event: dialog;shared
Subscription-State: active
Contact: &lt;sip:appearanceagent.example.com&gt;
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="27"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
    &lt;dialog id="fa02538339df3ce597f9e3e3699e28fc"
         call-id="f3b3cbd0-a2c5775e-5df9f8d5"
         local-tag="15A3DE7C-9283203B"    direction="initiator"&gt;
            &lt;sa:appearance&gt;0&lt;/sa:appearance&gt;
            &lt;sa:exclusive&gt;false&lt;/sa:exclusive&gt;
	       &lt;state&gt;trying&lt;/state&gt;
	        &lt;local&gt;
		    &lt;target uri="sip:bob@ua2.example.com"&gt;
 		    &lt;/target&gt;
		   &lt;/local&gt;
	&lt;/dialog&gt;
&lt;/dialog-info&gt;
</pre></div>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.4"></a><h3>10.4.&nbsp;
Outgoing Call with Appearance Seizure</h3>

<p>
In this scenario, Bob's UA sends out a dialog event PUBLISH with state (trying) selecting/seizing an appearance number before sending the INVITE.  After receiving the 200 OK from the Appearance Agent confirming the appearance number, Bob's UA sends the INVITE to Carol and establishes a session.  For brevity, details of some of the messages are not included in the message flows.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|              |               |              |&lt;----- PUBLISH F1&lt;|
|              |               |              |                  |
|              |               |              |&gt;F2 200 OK ------&gt;|
|              |               |              |                  |
|              |               |&lt;-- NOTIFY F3&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F4 200 OK --&gt;|                  |
|              |               |              |------- NOTIFY F5&gt;|
|              |               |              |                  |
|              |               |              |&lt;F6 200 OK ------&lt;|
|              |               |              |                  |
|              |&lt;------------------------------------- INVITE F7&lt;|
|              |               |              |                  |
|              |&gt;F8 100 Trying ---------------------------------&gt;|
|&lt;-- INVITE F9&lt;|               |              |                  |
|              |               |              |&lt;---- PUBLISH F10&lt;|
|              |               |              |                  |
|              |               |              |&gt;F11 200 OK -----&gt;|
|              |               |              |                  |
|&gt;F12 180  ---&gt;|               |              |                  |
|              |&gt;F13 180 Ringing -------------------------------&gt;|
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F14&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F15 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F16&gt;|
|              |               |              |                  |
|              |               |              |&lt;F17 200 OK -----&lt;|
|&gt;F18 200 OK -&gt;|               |              |                  |
|              |&gt;F19 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;--------------------------------------- ACK F20&lt;|
|&lt;---- ACK F21&lt;|               |              |                  |
|              |               |              |                  |
|&lt;================= Both way RTP established ===================&gt;|
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F22&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F23 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F24&gt;|
|              |               |              |                  |
|              |               |              |&lt;F25 200 OK -----&lt;|
|              |               |              |                  |

Figure 4.
</pre></div>
<p>
F1 to F4: Bob uses the shared appearance of the Help Desk on his UA to place an outgoing call (e.g., he goes off-hook). Before sending the outgoing INVITE request, Bob publishes to the state agent that Alice line appearance is in (trying) state. The Appearance Agent notifies Alice (and all other appearances) of
   the same event by forwarding the NOTIFY payload provided by Bob.
   Since the Appearance Agent is combining Bob's dialog status with
   statuses provided by other appearances, it may have to change the
   dialog id attributes in the XML to prevent values from being
   duplicated by different appearances.  Note the shortened expiration interval in F2 of 60 seconds.  As long as Bob is using the appearance number, he must refresh the publication every 60 seconds or loose the appearance.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

F1 Bob ----&gt; Appearance Agent

PUBLISH sip:HelpDesk@example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bK61314d6446383E79
From: &lt;sip:bob@example.com&gt;;tag=44150CC6-A7B7919D
To: &lt;sip:HelpDesk@example.com&gt;
CSeq: 7 PUBLISH
Call-ID: 44fwF144-F12893K38424
Contact: &lt;sip:bob@ua2.example.com&gt;
Event: dialog;shared
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="6"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
    &lt;dialog id="id3d4f9c83" direction="initiator"&gt;
        &lt;sa:appearance&gt;0&lt;/sa:appearance&gt;
        &lt;sa:exclusive&gt;false&lt;/sa:exclusive&gt;
        &lt;state&gt;trying&lt;/state&gt;
        &lt;local&gt;
            &lt;target uri="sip:bob@ua2.example.com"&gt;
            &lt;/target&gt;
        &lt;/local&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;


F2 Appearance Agent  ----&gt; Bob

SIP/2.0 200 OK
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bK61314d6446383E79
From: &lt;sip:bob@example.com&gt;;tag=44150CC6-A7B7919D
To: &lt;sip:HelpDesk@example.com&gt;
CSeq: 7 PUBLISH
Call-ID: 44fwF144-F12893K38424
Contact: &lt;sip:bob@ua2.example.com&gt;
Event: dialog;shared
SIP-Etag: 482943245
Allow-Events: dialog
Expires: 60
Content-Length: 0


F7 Bob ---&gt; Proxy

INVITE sip:carol@example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bK342122
Max-Forwards: 70
From: &lt;sip:HelpDesk@example.com&gt;;tag=15A3DE7C-9283203B
To: &lt;sip:carol@example.com&gt;
Call-ID: f3b3cbd0-a2c5775e-5df9f8d5
CSeq: 31 INVITE
Contact: &lt;sip:bob@ua2.example.com&gt;
Content-Type: application/sdp
Content-Length: ...

(SDP Not Shown)


F10 Bob ----&gt; Appearance Agent

PUBLISH sip:HelpDesk@example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bK6d644638E7
From: &lt;sip:bob@example.com&gt;;tag=0CCf6-A7FdsB79D
To: &lt;sip:HelpDesk@example.com&gt;
CSeq: 437 PUBLISH
Call-ID: fwF14d4-F1FFF2F2893K38424
Contact: &lt;sip:bob@ua2.example.com&gt;
Event: dialog;shared
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="6"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
    &lt;dialog id="id3d4f9c83"
         call-id="f3b3cbd0-a2c5775e-5df9f8d5"
         local-tag="15A3DE7C-9283203B"
                                         direction="initiator"&gt;
        &lt;sa:appearance&gt;0&lt;/sa:appearance&gt;
        &lt;sa:exclusive&gt;false&lt;/sa:exclusive&gt;
        &lt;state&gt;trying&lt;/state&gt;
        &lt;local&gt;
            &lt;target uri="sip:bob@ua2.example.com"&gt;
            &lt;/target&gt;
        &lt;/local&gt;
        &lt;remote&gt;
            &lt;identity uri="sip:carol@example.com"&gt;
            &lt;/identity&gt;
        &lt;/remote&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;
</pre></div>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.5"></a><h3>10.5.&nbsp;
Outgoing Call without using an Appearance Number</h3>

<p>
In this scenario, Bob's UA sends out a dialog event PUBLISH with state (trying) indicating that he does not want to utilize an appearance number for this dialog.  The PUBLISH does not have an appearance element but does have the 'shared' dialog event parameter.  As a result, the Appearance Agent knows the UA does not wish to use an appearance number for this call.  If the Appearance Agent does not wish to allow this, it would reject the PUBLISH with a 409 Conflict response and the UA would know to re-PUBLISH selecting/seizing an appearance number.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|              |               |              |&lt;----- PUBLISH F1&lt;|
|              |               |              |                  |
|              |               |              |&gt;F2 200 OK ------&gt;|
|              |               |              |                  |
|              |               |&lt;-- NOTIFY F3&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F4 200 OK --&gt;|                  |
|              |               |              |------- NOTIFY F5&gt;|
|              |               |              |                  |
|              |               |              |&lt;F6 200 OK ------&lt;|
|              |               |              |                  |
|              |&lt;------------------------------------- INVITE F7&lt;|
|              |               |              |                  |
|              |&gt;F8 100 Trying ---------------------------------&gt;|
|&lt;-- INVITE F9&lt;|               |              |                  |
|              |               |              |&lt;---- PUBLISH F10&lt;|
|              |               |              |                  |
|              |               |              |&gt;F11 200 OK -----&gt;|
|              |               |              |                  |
|&gt;F12 180  ---&gt;|               |              |                  |
|              |&gt;F13 180 Ringing -------------------------------&gt;|
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F14&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F15 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F16&gt;|
|              |               |              |                  |
|              |               |              |&lt;F17 200 OK -----&lt;|
|&gt;F18 200 OK -&gt;|               |              |                  |
|              |&gt;F19 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;--------------------------------------- ACK F20&lt;|
|&lt;---- ACK F21&lt;|               |              |                  |
|              |               |              |                  |
|&lt;================= Both way RTP established ===================&gt;|
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F22&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F23 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F24&gt;|
|              |               |              |                  |
|              |               |              |&lt;F25 200 OK -----&lt;|
|              |               |              |                  |

Figure 5.


F1 Bob ----&gt; Appearance Agent

PUBLISH sip:appearanceagent.example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bK61314d6446383E79
From: &lt;sip:bob@example.com&gt;;tag=4415df82k39sf
To: &lt;sip:HelpDesk@example.com&gt;
CSeq: 7 PUBLISH
Call-ID: 44fwF144-F12893K38424
Contact: &lt;sip:bob@ua2.example.com&gt;
Event: dialog;shared
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="6"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
    &lt;dialog id="id3d4f9c83" direction="initiator"&gt;
        &lt;sa:exclusive&gt;false&lt;/sa:exclusive&gt;
        &lt;state&gt;trying&lt;/state&gt;
        &lt;local&gt;
            &lt;target uri="sip:bob@ua2.example.com"&gt;
            &lt;/target&gt;
        &lt;/local&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;
</pre></div>
<p>Note that F7 would be the same as the previous example.
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.6"></a><h3>10.6.&nbsp;
Appearance Release</h3>

<p>
Bob and Carol are in a dialog, created, for example as in Section 10.3.  Carol sends a BYE to Bob to terminate the dialog.  Bob publishes the termination of the dialog and the Appearance Agent de-allocates the appearance number used.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|              |               |              |                  |
|&lt;================= Both way RTP established ===================&gt;|
|              |               |              |                  |
|&gt;F22 BYE ----&gt;|               |              |                  |
|              |&gt;F23 BYE ---------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;------------------------------------ 200 OK F24&lt;|
|&lt;--200 OK F25&lt;|               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F26&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F27 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F28&gt;|
|              |               |              |                  |
|              |               |              |&lt;F29 200 OK -----&lt;|

Figure 6.

F28 Appearance Agent ----&gt; Bob

NOTIFY sip:bob@ua1.example.com SIP/2.0
From: &lt;sip:HelpDesk@example.com&gt;;tag=497585728578386
To: &lt;sip:bob@example.com&gt;
Call-ID: a7d559db-d6d7dcad-311c9e3a
CSeq: 7 NOTIFY
Via: SIP/2.0/UDP appearanceagent.example.com
 ;branch=z9hG4bK759878512309
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Event: dialog;shared
Subscription-State: active
Contact: &lt;sip:appearanceagent.example.com&gt;
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="27"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
    &lt;dialog id="fa02538339df3ce597f9e3e3699e28fc"
         call-id="f3b3cbd0-a2c5775e-5df9f8d5"
         local-tag="15A3DE7C-9283203B"
         remote-tag="65a98f7c-1dd2-11b2-88c6-b0316298f7c"
                                         direction="initiator"&gt;
            &lt;sa:appearance&gt;0&lt;/sa:appearance&gt;
            &lt;sa:exclusive&gt;false&lt;/sa:exclusive&gt;
	       &lt;state&gt;terminated&lt;/state&gt;
	        &lt;local&gt;
		    &lt;target uri="sip:bob@ua2.example.com"&gt;
 		    &lt;/target&gt;
		   &lt;/local&gt;
	&lt;/dialog&gt;
&lt;/dialog-info&gt;

</pre></div>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.7"></a><h3>10.7.&nbsp;
Appearance Pickup</h3>

<p>
In this scenario, Bob has an established dialog with Carol created using the call flows of Figure 1 or Figure 2.  Bob then places Carol on hold. Alice receives a notification of this and renders this on Alice's UI.  Alice subsequently picks up the held call and has a established session with Carol. Finally, Carol hangs up.  Alice must PUBLISH F32 to indicate that the INVITE F38 will be an attempt to pickup the dialog between Carol and Bob, and hence may use the same appearance number.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|&lt;================= Both way RTP established ===================&gt;|
|              |               |              |                  |
|              |&lt;------------------------------(hold) INVITE F22&lt;|
|&lt;- INVITE F23&lt;|               |              |                  |
|              |               |              |                  |
|&gt;F24 200 OK -&gt;|               |              |                  |
|              |&gt;F25 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;--------------------------------------- ACK F26&lt;|
|&lt;---- ACK F27&lt;|               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F28&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F29 200 OK -&gt;|                  |
|              |               |              |&gt;F30 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F31&lt;|
|              |               |              |                  |
|              |  Alice decides to pick up the call              |
|              |               |              |                  |
|              |               |&gt;F32 PUBLISH-&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- 200 OK F33&lt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F34&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F35 200 OK -&gt;|                  |
|              |               |              |&gt;F36 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F37&lt;|
|              |&lt;-- INVITE F38&lt;|              |                  |
|&lt;- INVITE F39&lt;|(w/ Replaces)  |              |                  |
|( w/ Replaces)|               |              |                  |
|&gt;F40 200 OK -&gt;|               |              |                  |
|              |&gt;F41 200 OK --&gt;|              |                  |
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |              |&gt;F42 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F43&lt;|
|              |               |&lt;- NOTIFY F44&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F45 200 OK -&gt;|                  |
|              |               |              |                  |
|              |&lt;----- ACK F46&lt;|              |                  |
|&lt;---- ACK F47&lt;|               |              |                  |
|              |               |              |                  |
|&lt;= Both way RTP established =&gt;|              |                  |
|              |               |              |                  |
|&gt;F48 BYE ----&gt;|               |              |                  |
|              |&gt;F49 BYE ---------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;------------------------------------ OK 200 F50&lt;|
|&lt;- 200 OK F51&lt;|               |              |                  |
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F52&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F53 200 OK -&gt;|                  |
|              |               |              |                  |
|              |               |              |&gt;F54 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F55&lt;|

Figure 7.


F28 Appearance ----&gt; Alice

NOTIFY sip:alice@ua1.example.com SIP/2.0
From: &lt;sip:HelpDesk@example.com&gt;;tag=151702541050937
To: &lt;sip:alice@example.com&gt;;tag=18433323-C3D237CE
Call-ID: 1e361d2f-a9f51109-bafe31d4
CSeq: 12 NOTIFY
Via: SIP/2.0/UDP appearanceagent.example.com
 ;branch=z9hG4bK1403
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Event: dialog;shared
Subscription-State: active
Contact: &lt;sip:appearanceagent.example.com&gt;
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="10"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
   &lt;dialog id="id3d4f9c83"
         call-id="f3b3cbd0-a2c5775e-5df9f8d5"
         local-tag="15A3DE7C-9283203B"
         remote-tag="65a98f7c-1dd2-11b2-88c6-b0316298f7c"
         direction="initiator"&gt;
         &lt;sa:appearance&gt;0&lt;/sa:appearance&gt;
         &lt;sa:exclusive&gt;false&lt;/sa:exclusive&gt;
         &lt;state&gt;active&lt;/state&gt;
         &lt;local&gt;
           &lt;target uri="sip:bob@ua2.example.com"&gt;
             &lt;param pname="+sip.rendering" pval="no"/&gt;
           &lt;/target&gt;
         &lt;/local&gt;
         &lt;remote&gt;
           &lt;identity&gt;sip:carol@example.com&lt;/identity&gt;
           &lt;target uri="sip:carol@ua3.example.com" /&gt;
         &lt;/remote&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;


F32 Alice ----&gt; Appearance Agent

PUBLISH sip:HelpDesk@example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bKa5d6cf61F5FBC05A
From: &lt;sip:HelpDesk@example.com&gt;;tag=44150CC6-A7B7919D
To: &lt;sip:alice@example.com&gt;;tag=428765950880801
CSeq: 11 PUBLISH
Call-ID: 87837Fkw87asfds
Contact: &lt;sip:alice@ua2.example.com&gt;
Event: dialog;shared
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="10"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
   &lt;dialog id="id3d4f9c83"
       call-id="3d57cd17-47deb849-dca8b6c6"
                      local-tag="8C4183CB-BCEAB710" &gt;
         &lt;sa:appearance&gt;0&lt;/sa:appearance&gt;
         &lt;sa:exclusive&gt;false&lt;/sa:exclusive&gt;
         &lt;sa:replaced-dialog
           call-id="f3b3cbd0-a2c5775e-5df9f8d5"
           from-tag="15A3DE7C-9283203B"
           to-tag="65a98f7c-1dd2-11b2-88c6-b03162323164+65a98f7c" /&gt;
         &lt;state&gt;trying&lt;/state&gt;
         &lt;local&gt;
           &lt;target uri="sip:alice@ua1.example.com"&gt;
             &lt;param pname="+sip.rendering" pval="yes"/&gt;
           &lt;/target&gt;
         &lt;/local&gt;
         &lt;remote&gt;
             &lt;target uri="sip:carol@ua3.example.com" /&gt;
         &lt;/remote&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;


F38 Alice ----&gt; Proxy

INVITE sip:carol@example.com SIP/2.0
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bK4ea695b5B376A60C
From: &lt;sip:HelpDesk@example.com&gt;;tag=8C4183CB-BCEAB710
To: &lt;sip:carol@example.com:5075&gt;
CSeq: 1 INVITE
Call-ID: 3d57cd17-47deb849-dca8b6c6
Contact: &lt;sip:alice@ua1.example.com&gt;
&lt;all-one-line&gt;
Replaces: f3b3cbd0-a2c5775e-5df9f8d5;to-tag=65a98f7c
-1dd2-11b2-88c6-b03162323164+65a98f7c;from-tag=15A3DE7C-9283203B
&lt;/all-one-line&gt;
Max-Forwards: 70
Content-Type: application/sdp
Content-Length: 223

v=0
o=- 1102980497 1102980497 IN IP4 ua1.example.com
s=IP SIP UA
c=IN IP4 ua1.example.com
t=0 0
a=sendrecv
m=audio 2238 RTP/AVP 0 8 101
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:101 telephone-event/8000


</pre></div>
<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.8"></a><h3>10.8.&nbsp;
Calls between UAs within the Group</h3>

<p>
In this scenario, Bob calls Alice who is also in the Appearance group. 

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|              |&lt;--------------------  INVITE (to Alice's UA) F1&lt;|
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |              |                  |
|              |               |&lt;-- NOTIFY F2&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F3 200 OK --&gt;|                  |
|              |               |              |&gt;F4 NOTIFY ------&gt;|
|              |               |              |                  |
|              |               |              |&lt;------ 200 OK F5&lt;|
|              |&gt;F6 INVITE ---&gt;|              |                  |
|              | (appearance=1)|              |                  |
|              |               |              |                  |
|              |&lt;------ 180 F7&lt;|              |                  |
|              |               |              |                  |
|              |&gt;F8 180  ---------------------------------------&gt;|
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;-- NOTIFY F9&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F10 200 OK -&gt;|                  |
|              |               |              |&gt;F11 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F12&lt;|
|              |&lt;-- 200 OK F13&lt;|              |                  |
|              |               |              |                  |
|              |&gt;F14 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;--------------------------------------- ACK F15&lt;|
|              |               |              |                  |
|              |&gt;F16 ACK -----&gt;|              |                  |
|              |               |              |                  |
|              |               |&lt;======= RTP established =======&gt;|
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F17&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F18 200 OK -&gt;|                  |
|              |               |              |&gt;F19 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F24&lt;|
|              |               |              |                  |

Figure 8.


F16 Appearance Agent ----&gt; Bob

NOTIFY sip:bob@ua1.example.com SIP/2.0
From: &lt;sip:HelpDesk@example.com&gt;;tag=497585728578386
To: &lt;sip:bob@example.com&gt;;tag=633618CF-B9C2EDA4
Call-ID: a7d559db-d6d7dcad-311c9e3a
CSeq: 7 NOTIFY
Via: SIP/2.0/UDP appearanceagent.example.com
 ;branch=z9hG4bK1711759878512309
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Event: dialog;shared
Subscription-State: active
Contact: &lt;sip:appearanceagent.example.com&gt;
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="10"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
   &lt;dialog id="3xdsd4f9c83"
           call-id="b3cbd0-ad2c5775e-5df9f8d5"
	      local-tag="34322kdfr234f"
           remote-tag="3153DE7C-928203B"
           direction="initiator"&gt;
         &lt;sa:exclusive&gt;true&lt;/sa:exclusive&gt;
         &lt;sa:appearance&gt;1&lt;/sa:appearance&gt;
         &lt;state&gt;connected&lt;/state&gt;
         &lt;local&gt;
           &lt;target uri="sip:bob@ua2.example.com"&gt;
           &lt;/target&gt;
         &lt;/local&gt;
         &lt;remote&gt;
           &lt;identity&gt;sip:HelpDesk@example.com&lt;/identity&gt;
           &lt;target uri="sip:alice@ua1.example.com" /&gt;
         &lt;/remote&gt;
    &lt;/dialog&gt;

    &lt;dialog id="4839589"
           call-id="b3cbd0-ad2c5775e-5df9f8d5"
           local-tag="3153DE7C-928203B"
 	      remote-tag="34322kdfr234f"
           direction="responder"&gt;
         &lt;sa:exclusive&gt;true&lt;/sa:exclusive&gt;
         &lt;sa:appearance&gt;1&lt;/sa:appearance&gt;
         &lt;state&gt;connected&lt;/state&gt;
         &lt;local&gt;
            &lt;target uri="sip:alice@ua1.example.com" /&gt;
         &lt;/local&gt;
         &lt;remote&gt;
           &lt;identity&gt;sip:HelpDesk@example.com&lt;/identity&gt;
           &lt;target uri="sip:bob@ua2.example.com" /&gt;
         &lt;/remote&gt;
    &lt;/dialog&gt;

&lt;/dialog-info&gt;
</pre></div>
<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.9"></a><h3>10.9.&nbsp;
Consultation Hold with Appearances</h3>

<p>
In this scenario, Bob has a call with Carol.  Bob makes a consultation call to Alice by putting Carol on hold and calling Alice.  Bob chooses not to have an appearance number for the call to Alice since he is treating it as part of the call to Carol.  He indicates this in his PUBLISH F32 which contains the 'shared' Event parameter but no &lt;appearance&gt; element.  The PUBLISH is sent before the INVITE to Alice to ensure no appearance number is assigned by the Appearance Agent.  Finally, Bob hangs up with Alice and resumes the call with Carol. Note that the Appearance Agent does not generate notifications on the dialog state of the consultation call.

</p>
<p>
Note that if Carol hangs up while Bob is consulting with Alice, Bob can decide if he wants to reuse the appearance number used with Carol for the call with Alice.  If not, Bob publishes the termination of the dialog with Carol and the Appearance Agent will re-allocate the appearance.  If he wants to keep the appearance, Bob will publish the termination of the dialog with Carol and also publish the appearance with the dialog with Alice.  This will result in Bob keeping the appearance number until he reports the dialog with Alice terminated.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|&lt;================= Both way RTP established ===================&gt;|
|              |               |              |                  |
|              |&lt;------------------------------(hold) INVITE F22&lt;|
|&lt;- INVITE F23&lt;|               |              |                  |
|              |               |              |                  |
|&gt;F24 200 OK -&gt;|               |              |                  |
|              |&gt;F25 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;--------------------------------------- ACK F26&lt;|
|&lt;---- ACK F27&lt;|               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F28&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F29 200 OK -&gt;|                  |
|              |               |              |&gt;F30 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F31&lt;|
|              |               |              |                  |
|              |  Bob makes a consultation call to Alice         |
|              |               |              |                  |
|              |               |              |&lt;---- PUBLISH F32&lt;|
|              |               |              |                  |
|              |               |              |&gt;F33 200 OK -----&gt;|
|              |               |              |                  |
|              |&lt;------------------------------------ INVITE F34&lt;|
|              |               |              |                  |
|              |&gt;F35 INVITE --&gt;|              |                  |
|              |               |              |                  |
|              |&lt;-- 200 OK F36&lt;|              |                  |
|              |               |              |                  |
|              |&gt;F37 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;--------------------------------------- ACK F38&lt;|
|              |               |              |                  |
|              |&gt;F39 ACK -----&gt;|              |                  |
|              |               |              |                  |
|              |               |&lt;======= RTP established =======&gt;|
|              |               |              |                  |
|              |            Bob hangs up with Alice              |
|              |               |              |                  |
|              |&lt;--------------------------------------- BYE F40&lt;|
|              |               |              |                  |
|              |&gt;F41 BYE -----&gt;|              |                  |
|              |               |              |                  |
|              |&lt;-- 200 OK F42&lt;|              |                  |
|              |               |              |                  |
|              |&gt;F43 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;----------------------------(unhold) INVITE F44&lt;|
|&lt;- INVITE F45&lt;|               |              |                  |
|              |               |              |                  |
|&gt;F46 200 OK -&gt;|               |              |                  |
|              |&gt;F47 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;--------------------------------------- ACK F48&lt;|
|&lt;---- ACK F49&lt;|               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F50&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F51 200 OK -&gt;|                  |
|              |               |              |&gt;F52 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F53&lt;|
|              |               |              |                  |
|&lt;================= Both way RTP established ===================&gt;|
|              |               |              |                  |

Figure 9.

F32 Bob ----&gt; Appearance Agent

PUBLISH sip:HelpDesk@example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bKa5d6cf61F5FBC05A
From: &lt;sip:bob@example.com&gt;;tag=44150CC6-A7B7919D
To: &lt;sip:HelpDesk@example.com&gt;;tag=428765950880801
CSeq: 11 PUBLISH
Call-ID: 44fwF144-F12893K38424
Contact: &lt;sip:bob@ua2.example.com&gt;
Event: dialog;shared
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="10"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
   &lt;dialog id="id3d4f9c83"
           call-id="b3cbd0-ad2c5775e-5df9f8d5"
           local-tag="3153DE7C-928203B"
           direction="initiator"&gt;
         &lt;sa:exclusive&gt;true&lt;/sa:exclusive&gt;
         &lt;state&gt;trying&lt;/state&gt;
         &lt;local&gt;
           &lt;target uri="sip:bob@ua2.example.com"&gt;
           &lt;/target&gt;
         &lt;/local&gt;
         &lt;remote&gt;
           &lt;identity&gt;sip:HelpDesk@example.com&lt;/identity&gt;
           &lt;target uri="sip:alice@ua1.example.com" /&gt;
         &lt;/remote&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;
</pre></div>
<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.10"></a><h3>10.10.&nbsp;
Joining or Bridging an Appearance</h3>

<p>
In this call flow, a call answered by Bob is joined by Alice or "bridged".  The Join header field is used by Alice to request this bridging.  If Bob did not support media mixing, Bob could obtain conferencing resources as described in <a class='info' href='#RFC4579'>[RFC4579]<span> (</span><span class='info'>Johnston, A. and O. Levin, &ldquo;Session Initiation Protocol (SIP) Call Control - Conferencing for User Agents,&rdquo; August&nbsp;2006.</span><span>)</span></a>.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol    Forking Proxy Appearance Agent  Alice      Bob
  |            |             |             |         |
  |&lt;=============Both way RTP established===========&gt;|
  |            |             |             |         |
  |            |             |&lt; PUBLISH F22|         |
  |            |             |             |         |
  |            |             |&gt;F23 200 OK &gt;|         |
  |            |             |             |         |
  |            |&lt;---- INVITE (w/ Join) F24&lt;|         |
  |            |             |             |         |
  |            |&gt;F25 INVITE (w/Join)----------------&gt;|
  |            |             |             |         |
  |            |&lt;---- OK 200 Contact:Bob;isfocus F26&lt;|
  |            |             |             |        |
  |            |&lt; - - - - - &gt;|             |        |
  |            |             |             |         |
  |            |             |&gt;F27 NOTIFY &gt;|         |
  |            |             |             |         |
  |            |             |&lt; 200 OK F28&lt;|         |
  |            |             |             |         |
  |            |             |&gt;F29 NOTIFY ----------&gt;|
  |            |             |             |         |
  |            |             |&lt;F30 200 OK ----------&lt;|
  |            |             |             |         |
  |            |&gt;F31 200 OK Contact:B-----&gt;|         |
  |            |             |             |         |
  |            |&lt;----------------- ACK F32&lt;|         |
  |            |             |             |         |
  |            |&gt;ACK F33----------------------------&gt;|
  |            |             |             |         |
  |            |&lt;-----INVITE Contact:Bob;isfocus F34&lt;|
  |&lt;-INVITE F35|             |             |         |
  |            |             |             |         |
  |&gt;F26 200 --&gt;|             |             |         |
  |            |&gt;F37 200 OK ------------------------&gt;|
  |            |             |             |         |
  |            |&lt;--------------------------- ACK F38&lt;|
  |&lt;--- ACK F39|             |             |         |
  |            |             |             |&lt;==RTP==&gt;|
  |&lt;=============Both way RTP established===========&gt;|
  |            |             |             |        |
  |            |&lt; - - - - - &gt;|             |        |
  |            |             |             |         |
  |            |             |&gt;F40 NOTIFY &gt;|         |
  |            |             |             |         |
  |            |             |&lt; 200 OK F41&lt;|         |
  |            |             |             |         |
  |            |             |&gt;F42 NOTIFY ----------&gt;|
  |            |             |             |         |
  |            |             |&lt;F43 200 OK ----------&lt;|
  |            |             |             |         |

Figure 10.

F22 Alice ----&gt; Appearance Agent

PUBLISH sip:HelpDesk@example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bKa5d6cf61F5FBC05A
From: &lt;sip:alice@example.com&gt;;tag=44150CC6-A7B7919D
To: &lt;sip:HelpDesk@example.com&gt;;tag=428765950880801
CSeq: 11 PUBLISH
Call-ID: 87837Fkw87asfds
Contact: &lt;sip:alice@ua2.example.com&gt;
Event: dialog;shared
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="10"
             state="partial"
             entity="sip:HelpDesk@example.com:5060"&gt;
   &lt;dialog id="id3d4f9c83"
       call-id="dc95da63-60db1abd-d5a74b48"
       local-tag="605AD957-1F6305C2" &gt;
         &lt;sa:appearance&gt;0&lt;/sa:appearance&gt;
         &lt;sa:exclusive&gt;false&lt;/sa:exclusive&gt;
         &lt;sa:joined-dialog
           call-id="14-1541707345"
           from-tag="44BAD75D-E3128D42"
           to-tag="d3b06488-1dd1-11b2-88c5-b03162323164+d3e48f4c" /&gt;
         &lt;state&gt;trying&lt;/state&gt;
         &lt;local&gt;
           &lt;target uri="sip:alice@ua1.example.com"&gt;
           &lt;/target&gt;
         &lt;/local&gt;
         &lt;remote&gt;
             &lt;target uri="sip:bob@example.com" /&gt;
         &lt;/remote&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;


F24 Alice ----&gt; Proxy

INVITE sip:bob@ua.example.com SIP/2.0
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bKcc9d727c2C29BE31
From: &lt;sip:HelpDesk@example.com&gt;;tag=605AD957-1F6305C2
To: &lt;sip:bob@ua.example.com&gt;
CSeq: 2 INVITE
Call-ID: dc95da63-60db1abd-d5a74b48
Contact: &lt;sip:alice@ua1.example.com&gt;
&lt;all-one-line&gt;
Join: 14-1541707345;to-tag=d3b06488-1dd1-11b2-88c5
-b03162323164+d3e48f4c;from-tag=44BAD75D-E3128D42
&lt;/all-one-line&gt;
Max-Forwards: 70
Content-Type: application/sdp
Content-Length: 223

v=0
o=- 1103061265 1103061265 IN IP4 ua1.example.com
s=IP SIP UA
c=IN IP4 ua1.example.com
t=0 0
a=sendrecv
m=audio 2236 RTP/AVP 0 8 101
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:101 telephone-event/8000
</pre></div>
<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.11"></a><h3>10.11.&nbsp;
Appearance Allocation - Loss of Appearance</h3>

<p>
Bob reserves an appearance with a PUBLISH, sends an INVITE to Carol, then becomes unreachable.  When he fails to refresh his publication to the appearance agent, the Appearance Agent declares the dialog terminated and frees up the appearance using NOTIFYs R24 and F26.  After retransmitting the NOTIFY F26 to Bob, the subscription is terminated.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|              |               |              |&lt;----- PUBLISH F1&lt;|
|              |               |              |                  |
|              |               |              |&gt;F2 200 OK ------&gt;|
|              |               |              |                  |
|              |               |&lt;-- NOTIFY F3&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F4 200 OK --&gt;|                  |
|              |               |              |------- NOTIFY F5&gt;|
|              |               |              |                  |
|              |               |              |&lt;F6 200 OK ------&lt;|
|              |               |              |                  |
|              |&lt;------------------------------------- INVITE F7&lt;|
|              |               |              |                  |
|              |&gt;F8 100 Trying ---------------------------------&gt;|
|&lt;-- INVITE F9&lt;|               |              |                  |
|              |               |              |&lt;---- PUBLISH F10&lt;|
|              |               |              |                  |
|              |               |              |&gt;F11 200 OK -----&gt;|
|              |               |              |                  |
|&gt;F12 180  ---&gt;|               |              |                  |
|              |&gt;F13 180 Ringing -------------------------------&gt;|
|              |               |              |                  |
|              |               |              | Bob goes offline |
|              |               |              |                  |
|              |               | Appearance selection times out  |
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F14&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F15 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F16&gt;|
|              |               |              |                  |
|              |               |   NOTIFY is retransmitted       |

Figure 11.

</pre></div>
<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.12"></a><h3>10.12.&nbsp;
Appearance Seizure Contention Race Condition</h3>

<p>
Bob and Alice both try to reserve appearance 2  by publishing at the same time.  The Appearance Agent allocates the appearance to Bob by sending a 200 OK and denies it to Alice by sending a 409 Conflict.  After the NOTIFY F5, Alice learns that Bob is using appearance 2.  Alice republishes for appearance 3 which is accepted.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|              |               |              |&lt;----- PUBLISH F1&lt;|
|              |               |              |        (appearance=2)
|              |               |&gt;F2 PUBLISH -&gt;|                  |
|              |               |     (appearance=2)              |
|              |               |              |                  |
|              |               |              |&gt;F3 200 OK ------&gt;|
|              |               |&lt;---- F4 409 &lt;|                  |
|              |               |              |                  |
|              |               |&lt;-- NOTIFY F5&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F6 200 OK --&gt;|                  |
|              |               |              |------- NOTIFY F7&gt;|
|              |               |              |                  |
|              |               |              |&lt;F8 200 OK ------&lt;|
|              |               |              |                  |
|              |&lt;------------------------------------- INVITE F9&lt;|
|              |               |              |                  |
|              |&gt;F10 100 Trying --------------------------------&gt;|
|&lt;- INVITE F11&lt;|               |              |                  |
|              |               |              |&lt;---- PUBLISH F12&lt;|
|              |               |              |        (appearance=2)
|              |               |              |&gt;F13 200 OK -----&gt;|
|              |               |&gt;F14 PUBLISH-&gt;|                  |
|              |               |     (appearance=3)              |
|              |               |              |                  |
|              |               |&lt;--- F15 200 &lt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F16&lt;|                  |
|              |               |              |                  |
               |               |&gt;F17 200 OK -&gt;|                  |
Dave           |               |              |------ NOTIFY F18&gt;|
|              |               |              |                  |
|              |               |              |&lt;F19 200 OK -----&lt;|
|              |&lt;-- INVITE F20&lt;|              |                  |
|              |               |              |                  |
|              |&gt;F21 100 -----&gt;|              |                  |
|&lt;- INVITE F22&lt;|               |              |                  |

Figure 12.

</pre></div>
<a name="anchor43"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.13"></a><h3>10.13.&nbsp;
Appearance Agent Subscription to UAs</h3>

<p>
In this scenario, the Appearance Agent does not have any way of knowing Bob's dialog state information, except through Bob.  This could be because the Appearance Agent is not part of a B2BUA, or perhaps Bob is remotely registering.  When Bob registers, the Appearance Agent receives a registration event package notification from the registrar.  The Appearance Agent then SUBSCRIBEs to Bob's dialog event state.  Whenever Bob's dialog state changes, a NOTIFY is sent to the Appearance Agent who then notifies the other other UAs in the group.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|              |&lt;----------------------------------- REGISTER F1&lt;|
|              |               |              |                  |
|              |&gt;F2 200 OK -------------------------------------&gt;|
|              |               |              |                  |
|              |&gt;F3 NOTIFY ------------------&gt;|                  |
|              |               |              |                  |
|              |&lt;------------------ 200 OK F4&lt;|                  |
|              |               |              |---- SUBSCRIBE F5&gt;|
|              |               |              |                  |
|              |               |              |&lt;F6 200 OK ------&lt;|
|              |               |              |                  |
|              |               |              |&lt;------ NOTIFY F7&lt;|
|              |               |              |                  |
|              |               |              |&gt;F8 200 OK ------&gt;|
|              |               |              |                  |
|              |               |              |&lt;--- SUBSCRIBE F9&lt;|
|              |               |              |                  |
|              |               |              |&gt;F10 200 OK -----&gt;|
|              |               |              |                  |
|              |               |              |------ NOTIFY F11&gt;|
|              |               |              |                  |
|              |               |              |&lt;F12 200 OK -----&lt;|
|              |               |              |                  |
|              |&lt;------------------------------------ INVITE F13&lt;|
|              |               |              |                  |
|              |&gt;F14 100 Trying --------------------------------&gt;|
|&lt;- INVITE F15&lt;|               |              |                  |
|              |               |              |&lt;----- NOTIFY F16&lt;|
|              |               |              |                  |
|              |               |              |&gt;F17 200 OK -----&gt;|
|              |               |&lt;- NOTIFY F18&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F19 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F20&gt;|
|              |               |              |                  |
|              |               |              |&lt;F21 200 OK -----&lt;|
|&gt;F22 180  ---&gt;|               |              |                  |
|              |&gt;F23 180 Ringing -------------------------------&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- NOTIFY F24&lt;|
|              |               |              |                  |
|              |               |              |&gt;F25 200 OK -----&gt;|
|              |               |&lt;- NOTIFY F26&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F27 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F28&gt;|
|              |               |              |                  |
|              |               |              |&lt;F29 200 OK -----&lt;|
|&gt;F30 200 OK -&gt;|               |              |                  |
|              |&gt;F31 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- NOTIFY F32&lt;|
|              |               |              |                  |
|              |               |              |&gt;F33 200 OK -----&gt;|
|              |               |              |                  |
|              |&lt;--------------------------------------- ACK F34&lt;|
|&lt;---- ACK F35&lt;|               |              |                  |
|              |               |              |                  |
|&lt;================= Both way RTP established ===================&gt;|
|              |               |              |                  |
|              |               |&lt;- NOTIFY F36&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F37 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F38&gt;|
|              |               |              |                  |
|              |               |              |&lt;F39 200 OK -----&lt;|
|              |               |              |                  |

Figure 13.

</pre></div>
<a name="anchor44"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.14"></a><h3>10.14.&nbsp;
Appearance Pickup Race Condition Failure</h3>

<p>
In this scenario, Bob has an established dialog with Carol created using the call flows of Figure 1 or Figure 2.  Bob then places Carol on hold. Alice receives a notification of this and renders this on Alice's UI.  Alice attempts to pick up the call but Bob hangs up before the pickup can complete.   Alice cancels the pickup attempt with the PUBLISH F48.  Note that the call flow for a failed Join would be almost identical.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|&lt;================= Both way RTP established ===================&gt;|
|              |               |              |                  |
|              |&lt;------------------------------(hold) INVITE F22&lt;|
|&lt;- INVITE F23&lt;|               |              |                  |
|              |               |              |                  |
|&gt;F24 200 OK -&gt;|               |              |                  |
|              |&gt;F25 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;--------------------------------------- ACK F26&lt;|
|&lt;---- ACK F27&lt;|               |              |                  |
|              |               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F28&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F29 200 OK -&gt;|                  |
|              |               |              |&gt;F30 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F31&lt;|
|              |               |              |                  |
|              |  Alice decides to pick up the call              |
|              |               |              |                  |
|              |               |&gt;F32 PUBLISH-&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- 200 OK F33&lt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F34&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F35 200 OK -&gt;|                  |
|              |               |              |&gt;F36 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F37&lt;|
|&gt;F38 BYE ----&gt;|               |              |                  |
|              |&gt;F39 BYE ---------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;------------------------------------ OK 200 F40&lt;|
|&lt;- 200 OK F41&lt;|               |              |                  |
|              |&lt;-- INVITE F42&lt;|              |                  |
|&lt;- INVITE F43&lt;|(w/ Replaces)  |              |                  |
|( w/ Replaces)|               |              |                  |
|              |               |              |                  |
|&gt;F44 481 ----&gt;|               |              |                  |
|              |&gt;F45 481 -----&gt;|              |                  |
|&lt;---- ACK F46&lt;|               |              |                  |
|              |&lt;----- ACK F47&lt;|              |                  |
|              |               |&gt;F48 PUBLISH-&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- 200 OK F49&lt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F50&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F51 200 OK -&gt;|                  |
|              |               |              |&gt;F52 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F53&lt;|

Figure 14.

F48 Alice ----&gt; Appearance Agent

PUBLISH sip:HelpDesk@example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bKa5d6cf61F5FBC05A
From: &lt;sip:alice@example.com&gt;;tag=44150CC6-A7B7919D
To: &lt;sip:HelpDesk@example.com&gt;;tag=428765950880801
CSeq: 11 PUBLISH
Call-ID: 87837Fkw87asfds
Contact: &lt;sip:alice@ua2.example.com&gt;
Event: dialog;shared
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="10"
             state="partial"
             entity="sip:HelpDesk@example.com"&gt;
   &lt;dialog id="id3d4f9c83"
       call-id="dc95da63-60db1abd-d5a74b48"
       local-tag="605AD957-1F6305C2" &gt;
         &lt;sa:appearance&gt;0&lt;/sa:appearance&gt;
         &lt;sa:exclusive&gt;false&lt;/sa:exclusive&gt;
         &lt;sa:replaced-dialog
           call-id="14-1541707345"
           from-tag="44BAD75D-E3128D42"
           to-tag="d3b06488-1dd1-11b2-88c5-b03162323164+d3e48f4c" /&gt;
         &lt;state&gt;terminated&lt;/state&gt;
         &lt;local&gt;
           &lt;target uri="sip:alice@ua1.example.com"&gt;
           &lt;/target&gt;
         &lt;/local&gt;
         &lt;remote&gt;
             &lt;target uri="sip:carol@ua3.example.com" /&gt;
         &lt;/remote&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;



</pre></div>
<a name="anchor45"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.15"></a><h3>10.15.&nbsp;
Appearance Seizure Incoming/Outgoing Contention Race Condition</h3>

<p>
Alice tries to seize appearance 2 at the same time appearance 2 is allocated to an incoming call.  The Appearance Agent resolves the conflict by sending a 409 Conflict to Alice.  After the NOTIFY F6, Alice learns that the incoming call is using appearance 2.  Alice republishes for appearance 3, which is accepted.  Note that this example shows the INVITE being received before the NOTIFY from the Appearance Agent.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|&gt;-- INVITE F1&gt;|               |              |                  |
|              |&lt; - - - - - - - - - - - - - -&gt;|                  |
|              |               |              |                  |
|              |               |&gt;F2 PUBLISH -&gt;|                  |
|              |               |     (appearance=2)              |
|              |               |              |                  |
|              |&gt;F3 INVITE (appearance=2) ----------------------&gt;|
|              |               |              |                  |
|              |&gt;F4 INVITE     |              |                  |
|              |(appearance=2)&gt;|              |                  |
|              |               |&lt;---- F5 409 &lt;|                  |
|              |               |              |                  |
|              |               |&lt;-- NOTIFY F6&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F7 200 OK --&gt;|                  |
|              |               |              |------- NOTIFY F8&gt;|
|              |               |              |                  |
|              |               |              |&lt;F9 200 OK ------&lt;|
|              |               |              |                  |
|              |               |&gt;F10 PUBLISH-&gt;|                  |
|              |               |     (appearance=3)              |
|              |               |              |                  |
|              |               |&lt; F11 200 OK &lt;|                  |
|              |               |              |                  |
|              |               |&lt;- NOTIFY F12&lt;|                  |
|              |               |              |                  |
               |               |&gt;F13 200 OK -&gt;|                  |
Dave           |               |              |------ NOTIFY F14&gt;|
|              |               |              |                  |
|              |               |              |&lt;F15 200 OK -----&lt;|
|              |&lt;-- INVITE F16&lt;|              |                  |
|              |               |              |                  |
|              |&gt;F17 100 -----&gt;|              |                  |
|&lt;- INVITE F18&lt;|               |              |                  |

Figure 15.

</pre></div>
<a name="anchor46"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
 Incoming Appearance Assignment</h3>

<p>
To best meet REQ-9, the appearance number for an incoming INVITE should be contained in the INVITE itself. 

</p>
<p> 
For the dialog package parameter approach, REQ-9 could be met in two ways.  When an incoming request is received, the Appearance Agent could send out a NOTIFY with state trying and include the appearance number to be used for this request.  Upon receipt of this NOTIFY, the UAs could begin alerting using the appearance number seized.  This approach is sub-optimal since the UAs could receive the INVITE but be unable to begin alerting if the NOTIFY from the Appearance Agent is delayed or lost

</p>
<p>
An alternative approach is to define an extension parameter for the Alert-Info header field in RFC 3261 such as:

</p>
<p>
Alert-Info: &lt;urn:alert:tone:normal>;appearance=0

</p>
<p>
This Alert-Info header would indicate to place the call on the first line appearance instance.

</p>
<p>
A proxy inserting an 'appearance' Alert-Info parameter follows normal policies Alert-Info policies.  If an Alert-Info is already present, the proxy either removes the Alert-Info if it is not trusted, or adds the 'appearance' parameter to the Alert-Info header field.  If no special ringtone is desired, a normal ringtone should be indicated using the urn:alert:tone:normal in the Alert-Info, as per <a class='info' href='#I-D.alexeitsev-bliss-alert-info-urns'>[I&#8209;D.alexeitsev&#8209;bliss&#8209;alert&#8209;info&#8209;urns]<span> (</span><span class='info'>Alexeitsev, D., Liess, L., Jesske, R., Huelsemann, M., and A. Johnston, &ldquo;Alert-Info URNs for the Session Initiation Protocol (SIP),&rdquo; July&nbsp;2009.</span><span>)</span></a>.

</p>
<p>
The determination as to what value to use in the appearance parameter can be done at the proxy that forks the incoming request to all the registered UAs.

</p>
<p>
</p>
<blockquote class="text">
<p> There are a variety of ways the proxy can use to determine what value it should use to populate this parameter. For example, the proxy could fetch this information by initiating a SUBSCRIBE request with Expires: 0 to the Appearance Agent for the AOR to fetch the list of lines that are in use. Alternatively, it could act like a UA that is a part of the appearance group and SUBSCRIBE to the State-Agent like any other UA. This would ensure that the active dialog information is available without having to poll on a need basis. It could keep track of the list of active calls for the appearance AOR based on how many unique INVITE requests it has forked to or received from the appearance AOR. Another approach would be for the Proxy to first send the incoming INVITE to the Appearance Agent which would redirect to the appearance group URI and escape the proper Alert-Info header field for the Proxy to recurse and distribute to the other UAs in the group.

</p>
<p>
The Appearance Agent needs to know about all incoming requests to the AOR in order to seize the appearance number.  One way in which this could be done is for the Appearance Agent to register against the AOR with a higher q value.  This will result in the INVITE being sent to the Appearance Agent first, then being offered to the UAs in the group. 

</p>
</blockquote><p>

</p>
<p>
The changes to RFC 3261 ABNF are:

</p>
<p>
alert-param  =  LAQUOT absoluteURI RAQUOT *( SEMI (generic-param / appearance-param) )

</p>
<p>
appearance-param = "appearance" EQUAL *DIGIT

</p>
<a name="anchor47"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
IANA Considerations</h3>

<p> 
This section registers the SIP event package parameter 'shared', the SIP Alert-Info header field parameter "appearance" and the XML namespace extensions to the SIP Dialog Package.

</p>
<a name="anchor48"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
SIP Event Package Parameter: shared</h3>

<p>
This specification defines a new event parameter 'shared' for the Dialog Package.  When used in a NOTIFY, it indicates that the notifier supports the shared appearance feature.  When used in a PUBLISH, it indicates that the publisher has explicit appearance information contained in the message body.  If not present in a PUBLISH, the Appearance Agent MAY assign an appearance number to any new dialogs in the message body.

</p>
<a name="anchor49"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
URN Sub-Namespace Registration: sa-dialog-info</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   This section registers a new XML namespace per the procedures
in [RFC3688].

   URI: urn:ietf:params:xml:ns:sa-dialog-info.

   Registrant Contact: IETF BLISS working group, &lt;bliss@ietf.org&gt;,
   Alan Johnston &lt;alan@sipstation.com&gt;

   XML:

   BEGIN
    &lt;?xml version="1.0"?&gt;
    &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.0//EN"
              "http://www.w3.org/TR/xhtml-basic/xhtml-basic10.dtd"&gt;
    &lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
    &lt;head&gt;
      &lt;meta http-equiv="content-type"
         content="text/html;charset=iso-8859-1"/&gt;
      &lt;title&gt;Shared Appearance Dialog Information Namespace&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
     &lt;h1&gt;Namespace for Shared Appearance Dialog Information&lt;/h1&gt;
     &lt;h2&gt;urn:ietf:params:xml:ns:dialog-info&lt;/h2&gt;
     &lt;p&gt;See &lt;a href="ftp://ftp.rfc-editor.org/in-notes/rfcXXXX.txt"&gt;
        RFCXXXX&lt;/a&gt;.&lt;/p&gt;
    &lt;/body&gt;
    &lt;/html&gt;
   END
</pre></div>
<a name="anchor50"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3"></a><h3>12.3.&nbsp;
XML Schema Registration</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   This section registers an XML schema per the procedures in
 [RFC3688].

   URI: urn:ietf:params:xml:schesa:sa-dialog-info.

   Registrant Contact: IETF BLISS working group, &lt;bliss@ietf.org&gt;,
    Alan Johnston &lt;alan@sipstation.com&gt;

   The XML for this schema can be found in Section 6.

</pre></div>
<a name="anchor51"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Acknowledgements</h3>

<p>
The following individuals were part of the shared appearance Design team and have
   provided input and text to the document (in alphabetical order):

</p>
<p>
   Martin Dolly, Andrew Hutton, Raj Jain, Fernando Lombardo, Derek MacDonald,
   Bill Mitchell, Michael Procter, Theo Zowzouvillys.

</p>
<p>
   Thanks to Chris Boulton for helping with the XML schema.  

</p>
<p>
   Much of the material has been drawn from previous work by Mohsen 
   Soroushnejad, Venkatesh Venkataramanan, Paul Pepper and Anil Kumar,
   who in turn received assistance from:

</p>
<p>
   Kent Fritz, John Weald, and Sunil Veluvali of Sylantro Systems, 
   Steve Towlson, and Michael Procter of Citel Technologies, 
   Rob Harder and Hong Chen of Polycom Inc, 
   John Elwell, J D Smith of Siemens Communications, 
   Dale R. Worley of Pingtel, 
   Graeme Dollar of Yahoo Inc.

</p>
<p>
   Also thanks to Geoff Devine, Paul Kyzivat, Jerry Yin, John Elwell,
   Dan York, Spenser Dawkins, Martin Dolly, and Brett Tate for their comments.

</p>
<p>
Thanks to Francois Audet, Andy Hutton, Tim Ross, Raji Chinnappa, and Harsh Mendiratta for their detailed review of the document.

</p>
<a name="anchor52"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
Security Considerations</h3>

<p>
Since multiple line appearance features are implemented using semantics provided by <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, Event Package for Dialog State as define in , and Event Notification <a class='info' href='#I-D.ietf-sipcore-rfc3265bis'>[I&#8209;D.ietf&#8209;sipcore&#8209;rfc3265bis]<span> (</span><span class='info'>Roach, A., &ldquo;SIP-Specific Event Notification,&rdquo; February&nbsp;2010.</span><span>)</span></a>, <a class='info' href='#RFC3903'>[RFC3903]<span> (</span><span class='info'>Niemi, A., &ldquo;Session Initiation Protocol (SIP) Extension for Event State Publication,&rdquo; October&nbsp;2004.</span><span>)</span></a>, security considerations in these documents apply to this draft as well.

</p>
<p>
Specifically, since dialog state information and the dialog identifiers are supplied by UA's in an appearance group to other members, the same is prone to "call hijacks". For example, a rogue UA could snoop for these identifiers and send an INVITE with Replaces header containing these call details to take over the call. As such INVITES with Replaces header MUST be authenticated using the standard mechanism (like Digest or S/MIME) described in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>. before it is accepted. NOTIFY or PUBLISH message bodies that provide the dialog state information and the dialog identifiers MAY be encrypted end-to-end using the standard mechanics.
All SUBSCRIBES between the UA's and the Appearance Agent MUST be authenticated. 

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>15.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3515">[RFC3515]</a></td>
<td class="author-text">Sparks, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3515">The Session Initiation Protocol (SIP) Refer Method</a>,&rdquo; RFC&nbsp;3515, April&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3515.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sipcore-rfc3265bis">[I-D.ietf-sipcore-rfc3265bis]</a></td>
<td class="author-text">Roach, A., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sipcore-rfc3265bis-01.txt">SIP-Specific Event Notification</a>,&rdquo; draft-ietf-sipcore-rfc3265bis-01 (work in progress), February&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sipcore-rfc3265bis-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3903">[RFC3903]</a></td>
<td class="author-text">Niemi, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3903">Session Initiation Protocol (SIP) Extension for Event State Publication</a>,&rdquo; RFC&nbsp;3903, October&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3903.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3891">[RFC3891]</a></td>
<td class="author-text">Mahy, R., Biggs, B., and R. Dean, &ldquo;<a href="http://tools.ietf.org/html/rfc3891">The Session Initiation Protocol (SIP) "Replaces" Header</a>,&rdquo; RFC&nbsp;3891, September&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3891.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5359">[RFC5359]</a></td>
<td class="author-text">Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;<a href="http://tools.ietf.org/html/rfc5359">Session Initiation Protocol Service Examples</a>,&rdquo; BCP&nbsp;144, RFC&nbsp;5359, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5359.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4235">[RFC4235]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;<a href="http://tools.ietf.org/html/rfc4235">An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4235, November&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4235.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3911">[RFC3911]</a></td>
<td class="author-text">Mahy, R. and D. Petrie, &ldquo;<a href="http://tools.ietf.org/html/rfc3911">The Session Initiation Protocol (SIP) "Join" Header</a>,&rdquo; RFC&nbsp;3911, October&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3911.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4579">[RFC4579]</a></td>
<td class="author-text">Johnston, A. and O. Levin, &ldquo;<a href="http://tools.ietf.org/html/rfc4579">Session Initiation Protocol (SIP) Call Control - Conferencing for User Agents</a>,&rdquo; BCP&nbsp;119, RFC&nbsp;4579, August&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4579.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3840">[RFC3840]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., and P. Kyzivat, &ldquo;<a href="http://tools.ietf.org/html/rfc3840">Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3840, August&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3840.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3688">[RFC3688]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>,&rdquo; BCP&nbsp;81, RFC&nbsp;3688, January&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3688.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3680">[RFC3680]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3680">A Session Initiation Protocol (SIP) Event Package for Registrations</a>,&rdquo; RFC&nbsp;3680, March&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3680.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.alexeitsev-bliss-alert-info-urns">[I-D.alexeitsev-bliss-alert-info-urns]</a></td>
<td class="author-text">Alexeitsev, D., Liess, L., Jesske, R., Huelsemann, M., and A. Johnston, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-alexeitsev-bliss-alert-info-urns-02.txt">Alert-Info URNs for the Session Initiation Protocol (SIP)</a>,&rdquo; draft-alexeitsev-bliss-alert-info-urns-02 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-alexeitsev-bliss-alert-info-urns-02.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Alan Johnston (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Avaya</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">St. Louis, MO  63124</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:alan@sipstation.com">alan@sipstation.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mohsen Soroushnejad</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sylantro Systems Corp</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mohsen.soroush@sylantro.com">mohsen.soroush@sylantro.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Venkatesh Venkataramanan</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sylantro Systems Corp</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:vvenkatar@gmail.com">vvenkatar@gmail.com</a></td></tr>
</table>
</body></html>
