<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>LISP Map-Versioning</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="LISP Map-Versioning">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">L. Iannone</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">TU Berlin - Deutsche Telekom</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">Laboratories AG</td></tr>
<tr><td class="header">Expires: April 2, 2011</td><td class="header">D. Saucez</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">O. Bonaventure</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Universite catholique de Louvain</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">September 29, 2010</td></tr>
</table></td></tr></table>
<h1><br />LISP Map-Versioning<br />draft-ietf-lisp-map-versioning-00.txt</h1>

<h3>Abstract</h3>

<p> This document describes the LISP Map-Versioning mechanism,
    which provides in-packet information about EID-to-RLOC mappings
    used to encapsulate LISP data packets.  
    The proposed approach is based on associating a version number to
    EID-to-RLOC mappings and transport such a version number in the
    LISP specific header of LISP-encapsulated packets.
    LISP Map-Versioning is particularly useful to inform communicating
    xTRs about modifications of the mappings used to encapsulate
    packets. The mechanism is transparent to legacy implementations,
    since in the LISP-specific header and in the Map Records, bits
    used for Map-Versioning can be safely ignored by xTRs that do not
    support the mechanism.    
    
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on April 2, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Requirements Notation<br />
<a href="#anchor3">3.</a>&nbsp;
Definitions of Terms<br />
<a href="#anchor4">4.</a>&nbsp;
EID-to-RLOC Map-Version number<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec_zero">4.1.</a>&nbsp;
The special Map-Version 0<br />
<a href="#dealing">5.</a>&nbsp;
Dealing with Map-Version numbers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dmvn">5.1.</a>&nbsp;
Handling Destination Map-Version number<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smvn">5.2.</a>&nbsp;
Handling Source Map-Version number<br />
<a href="#lisphdr">6.</a>&nbsp;
LISP header and Map-Version numbers<br />
<a href="#vnumpkt">7.</a>&nbsp;
Map Record and Map-Version<br />
<a href="#anchor5">8.</a>&nbsp;
Benefits and case studies for Map-Versioning<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">8.1.</a>&nbsp;
Synchronization of different xTRs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">8.2.</a>&nbsp;
Map-Versioning and unidirectional traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">8.3.</a>&nbsp;
Map-Versioning and interworking<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">8.4.</a>&nbsp;
Graceful RLOC shutdown/withdraw<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">8.5.</a>&nbsp;
Map-Version for lightweight LISP implementation<br />
<a href="#truelisp">9.</a>&nbsp;
Incremental deployment and implementation status<br />
<a href="#security">10.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">10.1.</a>&nbsp;
Map-Versioning against traffic disruption<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dos">10.2.</a>&nbsp;
Map-Versioning against reachability
		    information DoS<br />
<a href="#anchor12">11.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor13">12.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">13.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">13.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">13.2.</a>&nbsp;
Informative References<br />
<a href="#a_wraparound">Appendix&nbsp;A.</a>&nbsp;
Estimation of time before Map-Version wrap-around<br />
<a href="#log">Appendix&nbsp;B.</a>&nbsp;
Document Change Log<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
      This document describes the Map-Versioning mechanism
      used to provide information on changes in the EID-to-RLOC
      mappings used in the LISP  (<a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>)
      context to perform packet encapsulation.  
      The mechanism is totally transparent to xTRs not
      supporting such a functionality. It is not meant to replace any
      existing LISP mechanism, but rather to complete them providing
      new functionalities.
      The basic mechanism is to associate Map-Version numbers to each
      LISP EID-to-RLOC mapping and transport such a version number in
      the LISP-specific header.        
      When a mapping changes, a new version number is assigned to
      the updated mapping. 
      A change in an EID-to-RLOC mapping can be a change in the RLOCs
      set, by adding or removing one or more RLOCs, but it can also be
      a change in the priority or weight of one or more RLOCs.
    
</p>
<p>
      When Map-Versioning is used, LISP-encapsulated data packets
      contain the version number of the two mappings used to select
      the RLOCs in the outer header (i.e., both source and destination). 
      These version numbers are encoded in the 24 low-order bits of
      the first longword of the LISP header and indicated by a
      specific bit in the flags (first 8 high-order bits of the first
      longword of the LISP header).
      Note that not all packets need to carry version numbers. 
    
</p>
<p> 
      When an ITR encapsulates a data packet, with a LISP header
      containing the Map-Version numbers, it puts in the LISP-specific
      header two version numbers:  
    
</p>
<p>
      </p>
<ol class="text">
<li> 
	  The version number assigned to the mapping (contained in
	  the EID-to-RLOC Database) used to select the source RLOC.
	
</li>
<li> 
	  The version number assigned to the mapping (contained in
	  the EID-to-RLOC Cache) used to select the destination RLOC.   
	
</li>
</ol><p>
    
</p>
<p>
      This operation is two-fold. On the one hand it enables the ETR
      receiving the packet to know if the ITR that sent it is using
      the latest mapping for the destination EID. If it is not the
      case the ETR can send to the ITR a Map-Request containing the
      updated mapping or invoking a Map-Request from the ITR
      (both cases are already defined in 
      <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>).  
      In this way the ITR can update its cache. 
      On the other hand, it enables an xTR receiving such a packet to 
      know if it has in its cache the latest mapping for the source
      EID (in case of bidirectional traffic). 
      If it is not the case a Map-Request can be send.
    
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Requirements Notation</h3>

<p>
      The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
      "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
      and "OPTIONAL" in this document are to be interpreted as
      described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
    
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Definitions of Terms</h3>

<p>
      </p>
<blockquote class="text"><dl>
<dt>Map-Version number:</dt>
<dd> An unsigned 12-bits
	assigned to an EID-to-RLOC mapping, not including the value 0
	(0x000).  
	
</dd>
<dt>Map-Version 0:</dt>
<dd> The 12-bits value 0 (0x000) is
	not used as Map-Version number. It is used to signal
	that no Map-Version number is assigned to the EID-to-RLOC
	mapping.
	
</dd>
<dt>Source Map-Version number:</dt>
<dd> Map-Version number
	of the EID-to-RLOC mapping used to select the source address
	(RLOC) of the outer IP header.  
	
</dd>
<dt>Destination Map-Version number:</dt>
<dd> Map-Version
	number of the EID-to-RLOC mapping used to select the
	destination address (RLOC) of the outer IP header. 
	
</dd>
</dl></blockquote><p>
    
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
EID-to-RLOC Map-Version number</h3>

<p> 
      The EID-to-RLOC Map-Version number consists in an unsigned
      12-bits integer. 
      The version number is assigned in a per-mapping fashion, meaning
      that different mappings will have assigned a different version
      number, which is also updated independently. An update in the
      version number (i.e., a newer version) consist in incrementing
      by one the older version number. <a class='info' href='#a_wraparound'>Appendix&nbsp;A<span> (</span><span class='info'>Estimation of time before Map-Version wrap-around</span><span>)</span></a>
      contains a rough estimation of the wrap-around time for the 
      Map-Version number.     
    
</p>
<p>
      The space of version numbers has a circular order where half of
      the version numbers is greater than the current Map-Version
      number and the other half is smaller than current Map-Version
      number.  
      In a more formal way, assuming we have two version numbers V1
      and V2 and that the numbers are expressed on N bits,
      the following three cases may happen:
    
</p>
<p>
      </p>
<blockquote class="text"><dl>
<dt>V1 = V2 :</dt>
<dd> This is the exact match case.
	
</dd>
<dt>V1 < V2 :</dt>
<dd>
	  True if and only if V1 < V2 < (V1 + 2**(N-1)).
        
</dd>
<dt>V1 > V2 :</dt>
<dd>
	  True if and only if V1 > V2 > (V1 - 2**(N-1)).
	
</dd>
</dl></blockquote><p>
    
</p>
<p> Using 12 bits, as defined in this document, and assuming a
    Map-Version value of 69,  Map-Version numbers in the range
    [70; 69 + 2047] are greater than 69, while Map-Version numbers in
    the range [69 + 2048; (69 + 4095) mod 4096] are smaller than 69. 
    
</p>
<p>
      The initial Map-Version number of a new EID-to-RLOC mapping can
      be randomly generated. However, it MUST NOT be zero (0x000)
      because it has a special meaning (see 
      <a class='info' href='#sec_zero'>Section&nbsp;4.1<span> (</span><span class='info'>The special Map-Version 0</span><span>)</span></a>). 
    
</p>
<a name="sec_zero"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
The special Map-Version 0</h3>

<p>
	The value 0x000 (zero) is not a valid Map-Version number
	indicating the version of the EID-to-RLOC mapping. The only
	valid use of Map-Version number equal to 0 is in the Map
	Records, which are part of the Map-Request and Map-Reply
	messages (defined in <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>).  
	Map Records that have Map-Version number equal 0 indicate that 
	there is no Map-Version number associated with the
	mapping. This means that LISP encapsulated packets, destined
	to the EID-Prefix the Map Record refers to, MUST never contain
	Map-Version number (i.e., V bit MUST always be 0). In other
	words, Map-Version number equal to 0 signals to the ITR using
	the mapping that the Map-Versioning is not supported, or even
	if supported it MUST NOT be used for that specific
	EID-Prefix. 
	Any value different from zero means that Map-Versioning is
	supported and MAY be used.
      
</p>
<p>
	The fact that the 0 value has a special meaning for the 
	Map-Version number implies that, when updating a Map-Version
	number because of a change in the mapping, if the next value
	is 0 then Map-Version number MUST be incremented by 2 (i.e.,
	set to 1, which is the next valid value). 
      
</p>
<a name="dealing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Dealing with Map-Version numbers</h3>

<p> 
      The main idea of using Map-Version numbers is that whenever
      there is a change in the mapping (e.g., adding/removing 
      RLOCs, a change in the weights due to TE policies, or
      a change in the priorities) or an ISP realizes that one or more
      of its own RLOCs are not reachable anymore from a local
      perspective (e.g., through IGP, or policy changes) the ISP
      updates the mapping also assigning a new Map-Version number. 
    
</p>
<p>
      In order to announce in a data-driven fashion that the mapping
      has been updated, Map-Version numbers used to create the
      outer IP header of the LISP-encapsulated packet are embedded in
      the LISP-specific header. 
      This means that the header needs to contain two Map-Version
      numbers:
    
</p>
<p>
      </p>
<ul class="text">
<li>
	  A first one from the EID-to-RLOC mapping in the EID-to-RLOC 
	  Database used to select the source RLOC, and called Source
	  Map-Version number.
	
</li>
<li>
	  A second one from the EID-to-RLOC mapping in the EID-to-RLOC
	  Cache used to select the destination RLOC, and called
	  Destination Map-Version number.
	
</li>
</ul><p>
    
</p>
<p>
      By embedding both Source Map-Version number and Destination
      Map-Version number an xTR receiving a LISP packet with
      Map-Version number, can perform the following checks: 
      </p>
<ol class="text">
<li>
	  The ITR that has sent the packet has an up-to-date
	  mapping in its cache for the destination EID and is
	  performing encapsulation correctly. 
	
</li>
<li> 
	  In case of bidirectional traffic, the mapping in the local
	  xTR cache for the source EID is up-to-date.
	
</li>
</ol><p>
      If one or both of the above conditions do not hold, the xTR can
      send a Map-Request either to make the ITR aware that a new
      mapping is available (see <a class='info' href='#dmvn'>Section&nbsp;5.1<span> (</span><span class='info'>Handling Destination Map-Version number</span><span>)</span></a>) or to
      update the mapping in the local cache (see <a class='info' href='#smvn'>Section&nbsp;5.2<span> (</span><span class='info'>Handling Source Map-Version number</span><span>)</span></a>). 
    
</p>
<a name="dmvn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Handling Destination Map-Version number</h3>

<p>
	When an ETR receives a packet, the Destination Map-Version
	number relates to the mapping for the destination EID for
	which the ETR is a RLOC. This mapping is part of the ETR LISP
	Database. Since the ETR is authoritative for the mapping, it
	has the correct and up-to-date Destination Map-Version number.
	A check on this version number is done, where the following
	cases can arise: 
	
	</p>
<ol class="text">
<li> 
	    The packets arrive with the same Destination Map-Version
	    number stored in the EID-to-RLOC Database. This is the
	    regular case.  
	    The ITR sending the packet has in its EID-to-RLOC Cache an
	    up-to-date mapping. No further actions are needed. 
	  
</li>
<li> 
	    The packet arrives with a Destination Map-Version
	    number greater (i.e., newer) than the one stored in the
	    EID-to-RLOC Database. Further actions are needed.
	    Since the ETR is authoritative on the mapping, this means
	    that someone is not behaving correctly w.r.t. the
	    specifications, thus the packet carries a not valid
	    version number and SHOULD be silently dropped.  
	  
</li>
<li> 
	    The packets arrive with a Destination Map-Version
	    number smaller (i.e., older) than the one stored in the
	    EID-to-RLOC Database. 
	    This means that the ITR sending the packet has an old
	    mapping in its EID-to-RLOC Cache containing stale
	    information. 
	    Further actions are needed. The ITR sending the packet
	    must be informed that a newer mapping is available. 
	    This is done with a Map-Request message sent back to the
	    ITR. The Map-Request will either trigger a Map-Request
	    back using the SMR bit or it will piggyback the newer
	    mapping. 
	    These are not new mechanisms; how to SMR or piggyback
	    mappings in Map-Request messages is already described in 
	    <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>, while their security is
	    discussed in <a class='info' href='#I-D.saucez-lisp-security'>[I&#8209;D.saucez&#8209;lisp&#8209;security]<span> (</span><span class='info'>Saucez, D., Iannone, L., and O. Bonaventure, &ldquo;LISP Security Threats,&rdquo; July&nbsp;2010.</span><span>)</span></a>.   
	    These Map-Request messages should be rate limited (rate
	    limitation policies are also described in 
	    <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>).
	    The gain introduced by Map-Version Numbers is that
	    after a certain number of retries, if the Destination
	    Map-Version number in the packets is not updated,
	    packet MAY be silently dropped because either the ITR is
	    refusing to use the mapping for which the ETR is
	    authoritative or it might be some form of attack.
	  
</li>
</ol><p>

	Note that the rule in case 3 can be even more restrictive. 
	If the mapping has been the same for a period of time as long
	as the TTL (defined in LISP <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>)
	of the previous version of the mapping, all packets arriving
	with an old Map-Version SHOULD be silently dropped right away 
	without issuing any Map-Request. 
	Indeed, if the new mapping with the updated version number has
	been stable for at least the same time as the TTL of the older
	mapping, all the entries in the caches of ITRs must have
	expired. If packets with old Map-Version number are still
	received, the reason is that either someone has not respected
	the TTL, or it is a form of spoof/attack. In both cases this
	is not valid behavior w.r.t. the specifications and the packet
	MAY be silently dropped.    
      
</p>
<p>	    
	For LISP-encapsulated packets with the V-bit set, the
	Destination Map-Version can never contain the special value 0.
	Indeed, as explained in <a class='info' href='#sec_zero'>Section&nbsp;4.1<span> (</span><span class='info'>The special Map-Version 0</span><span>)</span></a>, if an
	EID-to-RLOC mapping has Map-Version 0, it means that ITRs,
	using the mapping for encapsulation, MUST NOT put Map-Version
	number in the LISP-specific header. An ETR receiving a packet
	with the V-bit set but Destination Map-Version 0 SHOULD
	silently drop the packet.
      
</p>
<a name="smvn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Handling Source Map-Version number</h3>

<p>
	When an xTR receives a packet, the Source Map-Version
	number relates to the mapping for the source EID for which
	the ITR that sent the packet is authoritative. If the xTR does
	not have an entry in the LISP Cache for the source EID, then
	the Source Map-Version number can be safely ignored. 
	If the xTR has an entry in its LISP Cache for the source EID,
	then a check is performed and the following cases can arise:  
	
	</p>
<ol class="text">
<li> 
	    The packet arrives with the same Source Map-Version
	    number stored in the LISP Cache. This is the correct
	    regular case. The xTR has in its cache an up-to-date copy
	    of the mapping. No further actions are needed.
	  
</li>
<li> 
	    The packet arrives with a Source Map-Version number
	    greater (i.e., newer) than the one stored in the local 
	    LISP Cache. This means that xTR has in its cache a
	    mapping that is stale and needs to be updated.
	    The packet is considered valid but further actions are
	    needed. In particular a Map-Request must be sent to
	    get the new mapping for the source EID.
	    This is a normal Map-Request message sent through the
	    mapping system and MUST respect the
	    specifications in <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>,
	    including rate limitation policies.
	  
</li>
<li> 
	    The packet arrives with a Source Map-Version number
	    smaller (i.e., older) than the one stored in the local 
	    LISP Cache. Such a case is not valid w.r.t. the
	    specifications. Indeed, if the mapping is already present
	    in the LISP Cache, this means that an explicit Map-Request
	    has been sent and a Map-Reply has been received from an
	    authoritative source. Assuming that the mapping system is
	    not corrupted anyhow, the Map-Version in the LISP Cache is
	    the correct one; hence the packet is not valid and SHOULD
	    be silently dropped. 
	  
</li>
</ol><p>

      
</p>
<p> Otherwise, if the xTR does not have an entry in its cache
      (e.g. unidirectional traffic) the Source Map-Version can be
      safely ignored.
      
</p>
<p>	    
	For LISP-encapsulated packets with the V-bit set, if the
	Source Map-Version number is the special value 0, it means
	that the Source Map-Version number MUST be ignored. 
      
</p>
<a name="lisphdr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
LISP header and Map-Version numbers</h3>

<p> 
      In order for the versioning approach to work, the LISP
      specific header has to carry both Source Map-Version number
      and Destination Map-Version number.
      This is done by setting the V-bit in the LISP specific header.
      When the V-bit is set the low-order 24-bits of the first
      longword (which usually contains the nonce) are used to
      transport both source and destination Map-Version numbers. In 
      particular the first 12 bits are used for Source Map-Version
      number and the second 12 bits for the Destination Map-Version
      number. 
    
</p>
<p> 
      Hereafter is the example of LISP header carrying version
      numbers in the case of IPv4-in-IPv4 encapsulation. The same
      setting can be used for any other case (IPv4-in-IPv6,
      IPv6-in-IPv4, and IPv6-in-IPv6). 
      The present document just specifies how to use the
      low-order 24-bits of the first longword of the LISP-specific
      header when the V-bit is set to 1. All other cases,
      including the bit fields of the rest of the LISP-specific header
      and the whole LISP packet format are specified in 
      <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>. 
      In the following example we include all the headers of a LISP
      encapsulated packet just for the sake of clarity.   
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /|Version|  IHL  |Type of Service|          Total Length         |
  / +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 /  |         Identification        |Flags|      Fragment Offset    |
/   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
OH  |  Time to Live | Protocol = 17 |         Header Checksum       |
\   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 \  |                    Source Routing Locator                     |
  \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   \|                 Destination Routing Locator                   |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  / |       Source Port = xxxx      |       Dest Port = 4341        |
UDP +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  \ |           UDP Length          |        UDP Checksum           |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  / |N|L|E|V|I|flags|  Source Map-Version   |Destination Map-Version|
LISP+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  \ |                 Instance ID/Locator Status Bits               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /|Version|  IHL  |Type of Service|          Total Length         |
  / +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 /  |         Identification        |Flags|      Fragment Offset    |
/   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
IH  |  Time to Live |    Protocol   |         Header Checksum       |
\   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 \  |                           Source EID                          |
  \ +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   \|                         Destination EID                       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>
      </p>
<blockquote class="text"><dl>
<dt>V (1 bit):</dt>
<dd>
	  this is the Map-Version bit as defined in 
	  <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>. When this bit is set to 1 the 
	  low-order 24-bits of the first longword of the LISP header
	  contain Map-Version numbers. 
	
</dd>
<dt>Source Map-Version number (12 bits):</dt>
<dd>
	  Map-Version of the mapping used by the ITR to select the RLOC
	  present in the "Source Routing Locator" field. Note that the
	  mapping used for such a selection is determined by the
	  Source EID through a search in the LISP Database of the ITR. 
	
</dd>
<dt>Destination Map-Version number (12 bits):</dt>
<dd>
	  Map-Version of the mapping used by the ITR to select the RLOC
	  present in the "Destination Routing Locator" field. Note
	  that the mapping used for such a selection is determined by
	  the Destination EID, used as lookup key in the LISP
	  Cache of the ITR. 
	
</dd>
</dl></blockquote><p>
    
</p>
<p> Not all of the LISP encapsulated packets need to carry version
    numbers. When Map-Version numbers are carried the V-bit MUST be
    set to 1. All legal combination of the flags, when the V-bit
    is set to 1, are described in <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>.
    As a recall and in summary, Map-Version cannot be used with the
    Echo-Nonce feature (E = 1) and the Nonce feature (N = 1), since
    they use the same bitfield.
    
</p>
<a name="vnumpkt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Map Record and Map-Version</h3>

<p> 
      To accommodate the proposed mechanism, the Map Records that are
      transported on Map-Request/Map-Reply messages need to carry the
      Map-Version number as well.
      For this purpose the 12-bits before the EID-AFI field in the
      Record that describe a mapping is used. This is defined in 
      <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a> and reported here as example.
    
</p>
<p>
      </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   |                          Record  TTL                          |
|   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
R   | Locator Count | EID mask-len  | ACT |A|      Reserved         |
e   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
c   | Rsvd  |  Map-Version Number   |            EID-AFI            |
o   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
r   |                          EID-prefix                           |
d   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  /|    Priority   |    Weight     |  M Priority   |   M Weight    |
| L +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| o |        Unused Flags     |L|p|R|           Loc-AFI             |
| c +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  \|                             Locator                           |
+-&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>


      </p>
<blockquote class="text"><dl>
<dt>Map-Version Number:</dt>
<dd>
	  Map-Version of the mapping contained in the Record.       
	  As explained in <a class='info' href='#sec_zero'>Section&nbsp;4.1<span> (</span><span class='info'>The special Map-Version 0</span><span>)</span></a> this field can be
	  zero (0), meaning that no Map-Version is associated to the
	  mapping, hence packets that are LISP-encapsulated using this
	  mapping  MUST NOT contain Map-Version numbers in the LISP
	  specific header and the V-bit MUST be set to 0. 
	
</dd>
</dl></blockquote><p>
    
</p>
<p>
      This packet format works perfectly with xTRs that do not support
      Map-Versioning, since they can simply ignore those bits. 
      Furthermore, existing and future mapping distribution
      protocol (e.g., ALT <a class='info' href='#I-D.ietf-lisp-alt'>[I&#8209;D.ietf&#8209;lisp&#8209;alt]<span> (</span><span class='info'>Fuller, V., Farinacci, D., Meyer, D., and D. Lewis, &ldquo;LISP Alternative Topology (LISP+ALT),&rdquo; April&nbsp;2010.</span><span>)</span></a>) are able
      to carry version numbers without needing any modification.
      The same applies to the LISP Map Server 
      (<a class='info' href='#I-D.ietf-lisp-ms'>[I&#8209;D.ietf&#8209;lisp&#8209;ms]<span> (</span><span class='info'>Fuller, V. and D. Farinacci, &ldquo;LISP Map Server,&rdquo; April&nbsp;2010.</span><span>)</span></a>), which will still work
      without any change since reserved bits are simply ignored.
    
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Benefits and case studies for Map-Versioning</h3>

<p>In the following sections we provide more discussion on various
  aspects and use of the Map-Versioning. Security observations are
  instead grouped in <a class='info' href='#security'>Section&nbsp;10<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>. 
  
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Synchronization of different xTRs</h3>

<p>
      Map-Versioning does not require additional synchronization
      mechanism compared to the normal functioning of LISP without
      Map-Versioning. Clearly all the ETRs have to reply with the
      same Map-Version number, otherwise there can be an inconsistency
      that creates additional control traffic, instabilities, traffic
      disruptions. It is the same without Map-Versioning, with ETRs
      that have to reply with the same mapping, otherwise the same
      problems can arise.
    
</p>
<p>
      As an example, let's consider the topology of  
      <a class='info' href='#vtraffic'>Figure&nbsp;1</a> where ITR A.1 of domain A is sending
      unidirectional traffic to the xTR B of domain B, while xTR A.2 of
      domain A and xTR B of domain B exchange bidirectional traffic. 
    
</p>
<p>
      <br /><hr class="insert" />
<a name="vtraffic"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 +-----------------+              +-----------------+
 | Domain A        |              | Domain B        |
 |       +---------+              |                 |
 |       | xTR A.1 |---           |                 |
 |       +---------+    \         +---------+       |
 |                 |     --------&gt;| xTR B   |       |
 |                 |     --------&gt;|         |       |
 |       +---------+    /         +---------+       |
 |       | xTR A.2 |&lt;--           |                 |
 |       +---------+              |                 |
 |                 |              |                 |
 +-----------------+              +-----------------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

    
</p>
<p> 
      Obviously in the case of Map-Versioning both xTRs of domain
      A must use the same value otherwise the xTR of domain B will
      start to send Map-Requests.
    
</p>
<p>
      The same problem can, however, arise without Map-Versioning. 
      For instance if the two xTRs of domain A send different Loc
      Status Bits. In this case either the traffic is disrupted, if
      the xTR B trusts the Locator Status Bits, or if xTR B does not
      trusts the Locator Status Bits it will start sending
      Map-Requests to confirm the each change in the reachability.
    
</p>
<p> 
      So far, LISP does not provide any specific synchronization
      mechanism, but assumes that synchronization is provided by
      configuring the different xTRs consistently.
      The same applies for Map-Versioning. If in the future any
      synchronization mechanism is provided, Map-Versioning will
      take advantage of it automatically since it is included in 
      the Record format, as described in <a class='info' href='#vnumpkt'>Section&nbsp;7<span> (</span><span class='info'>Map Record and Map-Version</span><span>)</span></a>.
    
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Map-Versioning and unidirectional traffic</h3>

<p> 
      When using Map-Versioning the LISP specific header carries two
      Map-Version numbers, for both source and destination mappings. 
      This can raise the question on what will happen in the case of
      unidirectional flows, like for instance in the case presented in 
      <a class='info' href='#utraffic'>Figure&nbsp;2</a>, since LISP specification do
      not mandate for ETR to have a mapping for the source EID. 
     
      <br /><hr class="insert" />
<a name="utraffic"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 +-----------------+            +-----------------+
 | Domain A        |            | Domain B        |
 |       +---------+            +---------+       |
 |       | ITR A   |-----------&gt;| ETR B   |       |
 |       +---------+            +---------+       |
 |                 |            |                 |
 +-----------------+            +-----------------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

    
</p>
<p>
      For what concerns the ITR, it is able to put both source and
      destination version number in the LISP header since the Source
      Map-Version number is in ITR's database, while the
      Destination Map-Version number is in ITR's cache.
    
</p>
<p> 
      For what concerns the ETR, it simply checks only the Destination
      Map-Version number in the same way as described in 
      <a class='info' href='#dealing'>Section&nbsp;5<span> (</span><span class='info'>Dealing with Map-Version numbers</span><span>)</span></a>, ignoring the Source Map-Version
      number. 
    
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Map-Versioning and interworking</h3>

<p>
      Map-Versioning works in the context of interworking
      between LISP and IPv4 and IPv6
      (<a class='info' href='#I-D.ietf-lisp-interworking'>[I&#8209;D.ietf&#8209;lisp&#8209;interworking]<span> (</span><span class='info'>Lewis, D., Meyer, D., Farinacci, D., and V. Fuller, &ldquo;Interworking LISP with IPv4 and IPv6,&rdquo; August&nbsp;2010.</span><span>)</span></a>) in the following
      way. 
    
</p>
<p>
      The case of proxy-ITR encapsulating packet for LISP sites is
      basically the same as the unidirectional traffic case presented
      in the previous section. The same rules can be applied.
      The only difference that arises is the fact that a proxy-ITR does
      not have any mapping, since it just encapsulate packets arriving
      from non-LISP site, thus it has no Source Map-Version. 
      In this case, the proxy-ITR will just put the special value 0
      (zero) as Source Map-Version number, while the receiving ETR
      will ignore the field. 
    
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
Graceful RLOC shutdown/withdraw</h3>

<p>
      Map-Versioning can be even used to perform a graceful shutdown
      or withdraw of a specific RLOC. 
      This is achieved by simply issuing a new mapping, with an
      updated Map-Version number, where the specific RLOC to be shut
      down is withdrawn or announced as unreachable (R bit in the Map
      Record, see <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>), but without
      actually turning it off.   
    
</p>
<p> 
      Once no more traffic is received by the RLOC, because all sites 
      have updated the mapping, it can be shut down safely. 
    
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5"></a><h3>8.5.&nbsp;
Map-Version for lightweight LISP implementation</h3>

<p> 
      The use of Map-Versioning can help in developing a lightweight
      implementation of LISP. This comes with the price of not
      supporting Loc-Status-Bit, which are useful in some contexts.
    
</p>
<p>
      In the current LISP specifications the set of RLOCs must always
      be maintained ordered and consistent with the content of the Loc
      Status Bits (see section 6.5 of <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>). 
      With Map-Versioning such type of mechanisms can be avoided.
      When a new RLOC is added to a mapping, it is not necessary to
      "append" new locators to the existing ones as explained in
      Section 6.5 of <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>.  
      A new mapping with a new Map-Version number will be issued, and
      since the old locators are still valid the transition will be
      with no disruptions. 
      The same applies for the case a RLOC is withdrawn. 
      There is no need to maintain holes in the list of
      locators, as is the case when using Locator Status Bits, for
      sites that are not using the RLOC that has been withdrawn the
      transition will be with no disruptions. 
    
</p>
<p> 
      All of these operations, as already stated, do not need to
      maintain any consistency among Locator Status Bits, and the way
      RLOC are stored in the cache.     
    
</p>
<p> 
      Further, Map-Version can be used to substitute the "clock sweep"
      operation described in Section 6.5.1 of 
      <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>. Indeed, every LISP site
      communicating to a specific LISP site that has updated the
      mapping will be informed of the available new mapping in a
      data-driven manner.  
    
</p>
<p> Note that what proposed in the present section is just a case
    study and MUST NOT be considered as specification for a
    lightweight LISP implementation.
    
</p>
<a name="truelisp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Incremental deployment and implementation status</h3>

<p> 
      Map-Versioning can be incrementally deployed without any
      negative impact on existing LISP elements (e.g., xTRs,
      Map-Servers, Proxy-ITRs, etc).
      Any LISP element that does not support Map-Versioning can
      safely ignore them. 
      Further, there is no need of any specific mechanism to discover
      if an xTR supports or not Map-Versioning. This information
      is already included in the Map Record.
    
</p>
<p>
      Map-Versioning is currently implemented in OpenLISP
      <a class='info' href='#I-D.iannone-openlisp-implementation'>[I&#8209;D.iannone&#8209;openlisp&#8209;implementation]<span> (</span><span class='info'>Iannone, L., Saucez, D., and O. Bonaventure, &ldquo;OpenLISP Implementation Report,&rdquo; July&nbsp;2008.</span><span>)</span></a>.
    
</p>
<p>Note that the reference document for LISP implementation
    and interoperability tests remains <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>.
    
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>
      Map-Versioning does not introduce any new security issue
      concerning both the data-plane and the control-plane. 
      On the contrary, as described in the following, if 
      Map-Versioning may be used also to update mappings in case of
      change in the reachability information (i.e., instead of the
      Locator Status Bits) it is possible to reduce the effects of
      some DoS or spoofing attacks that can happen in an untrusted
      environment. 
    
</p>
<p> A thorough security analysis of LISP is documented in 
    <a class='info' href='#I-D.saucez-lisp-security'>[I&#8209;D.saucez&#8209;lisp&#8209;security]<span> (</span><span class='info'>Saucez, D., Iannone, L., and O. Bonaventure, &ldquo;LISP Security Threats,&rdquo; July&nbsp;2010.</span><span>)</span></a>.
    
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1"></a><h3>10.1.&nbsp;
Map-Versioning against traffic disruption</h3>

<p>
	An attacker can try to disrupt ongoing communications by
	creating LISP encapsulated packets with wrong Locator Status
	Bits. If the xTR blindly trusts the Locator Status Bits it
	will change the encapsulation accordingly, which can result in 
	traffic disruption. 
      
</p>
<p> 
	This does not happen in the case of Map-Versioning. As
	described in <a class='info' href='#dealing'>Section&nbsp;5<span> (</span><span class='info'>Dealing with Map-Version numbers</span><span>)</span></a>, upon a version
	number change the xTR first issues a Map-Request. The
	assumption is that the mapping distribution system is
	sufficiently secure that Map-Request and Map-Reply messages
	and their content can be trusted. 
	Security issues concerning specific mapping distribution
	system are out of the scope of this document. 
	Note also that in the case of Map-Versioning the attacker
	should "guess" a valid version number that triggers a
	Map-Request, as described in <a class='info' href='#dealing'>Section&nbsp;5<span> (</span><span class='info'>Dealing with Map-Version numbers</span><span>)</span></a>,
	otherwise the packet is simply dropped.
      
</p>
<p>
	Note that a similar level of security can be obtained with Loc
	Status Bits, by simply making mandatory to verify any change
	through a Map-Request. However, in this case Locator Status
	Bits loose their meaning, because, it does not matter anymore
	which specific bits has changed, the xTR will query the
	mapping system and trust the content of the received
	Map-Reply. Furthermore there is no way to perform filtering as
	in the Map-Versioning in order to drop packets that do not
	carry a valid Map-Version number.
	In the case of Locator Status Bits, any random change can
	trigger a Map-Request (unless rate limitation is enabled which
	raise another type of attack discussed in 
	<a class='info' href='#dos'>Section&nbsp;10.2<span> (</span><span class='info'>Map-Versioning against reachability 		    information DoS</span><span>)</span></a>). 
      
</p>
<a name="dos"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2"></a><h3>10.2.&nbsp;
Map-Versioning against reachability
		    information DoS</h3>

<p>
	Attackers can try to trigger a large amount of Map-Request by
	simply forging packets with random Map-Version or
	random Locator Status Bits. 
	In both cases the Map-Requests are rate limited as described
	in <a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>. 
	However, differently from Locator Status Bit where there is no
	filtering possible,  in the case of Map-Versioning is
	possible to filter not valid version numbers before triggering
	a Map-Request, thus helping in reducing the effects of DoS
	attacks.
	In other words the use of Map-Versioning enables a fine
	control on when to update a mapping or when to notify that a
	mapping has been updated.    
      
</p>
<p> It is clear, that Map-Versioning does not protect against
	DoS  and DDoS attacks, where an xTR looses processing power
	doing checks on the LISP header of packets sent by
	attackers. This is independent from Map-Versioning and is the
	same for Loc Status Bits.
      
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
IANA Considerations</h3>

<p> This document has no actions for IANA.
    
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Acknowledgements</h3>

<p> The authors would like to thank Pierre Francois, Noel Chiappa,
    Dino Farinacci for their comments and review.
    
</p>
<p> This work has been partially supported by the
    INFSO-ICT-216372 TRILOGY Project (www.trilogy-project.org).  
    
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-lisp">[I-D.ietf-lisp]</a></td>
<td class="author-text">Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-08.txt">Locator/ID Separation Protocol (LISP)</a>,&rdquo; draft-ietf-lisp-08 (work in progress), August&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-08.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.iannone-openlisp-implementation">[I-D.iannone-openlisp-implementation]</a></td>
<td class="author-text">Iannone, L., Saucez, D., and O. Bonaventure, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-iannone-openlisp-implementation-01.txt">OpenLISP Implementation Report</a>,&rdquo; draft-iannone-openlisp-implementation-01 (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-iannone-openlisp-implementation-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-lisp-alt">[I-D.ietf-lisp-alt]</a></td>
<td class="author-text">Fuller, V., Farinacci, D., Meyer, D., and D. Lewis, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-alt-04.txt">LISP Alternative Topology (LISP+ALT)</a>,&rdquo; draft-ietf-lisp-alt-04 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-alt-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-lisp-interworking">[I-D.ietf-lisp-interworking]</a></td>
<td class="author-text">Lewis, D., Meyer, D., Farinacci, D., and V. Fuller, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-interworking-01.txt">Interworking LISP with IPv4 and IPv6</a>,&rdquo; draft-ietf-lisp-interworking-01 (work in progress), August&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-interworking-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-lisp-ms">[I-D.ietf-lisp-ms]</a></td>
<td class="author-text">Fuller, V. and D. Farinacci, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-ms-05.txt">LISP Map Server</a>,&rdquo; draft-ietf-lisp-ms-05 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-lisp-ms-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.saucez-lisp-security">[I-D.saucez-lisp-security]</a></td>
<td class="author-text">Saucez, D., Iannone, L., and O. Bonaventure, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-saucez-lisp-security-01.txt">LISP Security Threats</a>,&rdquo; draft-saucez-lisp-security-01 (work in progress), July&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-saucez-lisp-security-01.txt">TXT</a>).</td></tr>
</table>

<a name="a_wraparound"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Estimation of time before Map-Version wrap-around</h3>

<p> 
      The present section proposes an estimation of the wrap-around
      time for the proposed 12 bits size for the Map-Version number.
      Using a granularity of seconds and assuming as worst-case that a 
      new version is issued each second, it takes slightly more than 1 
      hour before the version wraps around. Note that the granularity
      of seconds is in line with the rate limitation policy for
      Map-Request messages, as proposed in the LISP main
      specifications (<a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>).
      Alternatively a granularity of minutes can also be used, as
      for the TTL of the Map-Reply (<a class='info' href='#I-D.ietf-lisp'>[I&#8209;D.ietf&#8209;lisp]<span> (</span><span class='info'>Farinacci, D., Fuller, V., Meyer, D., and D. Lewis, &ldquo;Locator/ID Separation Protocol (LISP),&rdquo; August&nbsp;2010.</span><span>)</span></a>). 
      In this case the worst scenario is when a new version is issued
      every minute, leading to a much longer time before
      wrap-around. In particular, when using 12 bits, the wrap-around
      time is almost 3 days. 
    
</p>
<p>
      For general information, hereafter there is a table with a rough 
      estimation of the time before wrap-around in the worst-case
      scenario, considering different sizes (bits length) of the
      Map-Version number and different time granularity.  
    
</p><br /><hr class="insert" />
<a name="wraparound"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+---------------+--------------------------------------------+
|Version Number |           Time before wrap around          |
|  Size (bits)  +---------------------+----------------------+
|               |Granularity: Minutes | Granularity: Seconds |
|               | (mapping changes    | (mapping changes     |
|               |  every 1 minute)    |  every 1 second)     |
+-------------------------------------+----------------------+
|          32   |   8171   Years      |  136   Years         |
|          30   |   2042   Years      |   34   Years         |
|          24   |     31   Years      |  194   Days          |
|          16   |     45   Days       |   18   Hours         |
|          15   |     22   Days       |    9   Hours         |
|          14   |     11   Days       |    4   Hours         |
|          13   |      5.6 Days       |    2.2 Hours         |
|          12   |      2.8 Days       |    1.1 Hours         |
+---------------+---------------------+----------------------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Estimation of time before wrap-around&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="log"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Document Change Log</h3>

<p>
      </p>
<ul class="text">
<li>Posted September 2010.
	
</li>
<li>Added Section "Definitions of Terms".
	
</li>
<li>Editorial polishing of all sections.
	
</li>
<li>Added clarifications in section "Dealing with Map-Version
	numbers" for the case of the special Map-Version number 0.
	
</li>
<li>Rename of draft-iannone-mapping-versioning-02.txt.
	
</li>
</ul><p>
    
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Luigi Iannone</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">TU Berlin - Deutsche Telekom Laboratories AG</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ernst-Reuter Platz 7</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Berlin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:luigi@net.t-labs.tu-berlin.de">luigi@net.t-labs.tu-berlin.de</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Damien Saucez</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Universite catholique de Louvain</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Place St. Barbe 2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Louvain la Neuve</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Belgium</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:damien.saucez@uclouvain.be">damien.saucez@uclouvain.be</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Olivier Bonaventure</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Universite catholique de Louvain</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Place St. Barbe 2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Louvain la Neuve</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Belgium</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:olivier.bonaventure@uclouvain.be">olivier.bonaventure@uclouvain.be</a></td></tr>
</table>
</body></html>
