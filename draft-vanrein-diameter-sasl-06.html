<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Realm Crossover for SASL and GSS-API via Diameter</title>
<meta content="Rick van Rein" name="author">
<meta content="Henri Manson" name="author">
<meta content="
       SASL and GSS-API are used for authentication in many application
 protocols.  This specification extends them to allow credentials of
 an identity domain to be used against external services.  To this end,
 it introduces end-to-end encryption for SASL that is safe to relay
 through a foreign server. 
    " name="description">
<meta content="xml2rfc 3.12.0" name="generator">
<meta content="draft-vanrein-diameter-sasl-06" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.7.1
    pycountry 22.1.10
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-vanrein-diameter-sasl-06-1_gxhvjs.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Diameter SASL</td>
<td class="right">January 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Van Rein &amp; Manson</td>
<td class="center">Expires 1 August 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-vanrein-diameter-sasl-06</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-01-28" class="published">28 January 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-08-01">1 August 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. Van Rein</div>
<div class="org">OpenFortress BV</div>
</div>
<div class="author">
      <div class="author-name">H. Manson</div>
<div class="org">Mansoft</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Realm Crossover for SASL and GSS-API via Diameter</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">SASL and GSS-API are used for authentication in many application
 protocols.  This specification extends them to allow credentials of
 an identity domain to be used against external services.  To this end,
 it introduces end-to-end encryption for SASL that is safe to relay
 through a foreign server.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 1 August 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-messages-of-sxover-plus" class="xref">Messages of SXOVER-PLUS</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-preparation-for-messaging" class="xref">Preparation for Messaging</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1" class="keepWithNext"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-initial-client-to-server-me" class="xref">Initial Client-to-Server Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-initial-server-to-client-me" class="xref">Initial Server-to-Client Message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="xref">2.4</a>.  <a href="#name-continued-client-to-server-" class="xref">Continued Client-to-Server Messages</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="xref">2.5</a>.  <a href="#name-continued-server-to-client-" class="xref">Continued Server-to-Client Messages</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="xref">2.6</a>.  <a href="#name-using-sxover-plus-with-gss-" class="xref">Using SXOVER-PLUS with GSS-API</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.7">
                <p id="section-toc.1-1.2.2.7.1"><a href="#section-2.7" class="xref">2.7</a>.  <a href="#name-application-key-derivation" class="xref">Application Key Derivation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-avp-definitions-for-sasl-in" class="xref">AVP Definitions for SASL in Diameter</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-sasl-mechanism" class="xref">SASL-Mechanism</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-sasl-token" class="xref">SASL-Token</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-sasl-channel-binding" class="xref">SASL-Channel-Binding</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-diameter-session-requiremen" class="xref">Diameter Session Requirements for SASL</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-diameter-message-requiremen" class="xref">Diameter Message Requirements for SXOVER-PLUS</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-c2s-init-requests-over-diam" class="xref">C2S-Init Requests over Diameter</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-s2c-init-responses-over-dia" class="xref">S2C-Init Responses over Diameter</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-c2s-cont-requests-over-diam" class="xref">C2S-Cont Requests over Diameter</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-s2c-cont-responses-over-dia" class="xref">S2C-Cont Responses over Diameter</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-running-diameter-as-a-sasl-" class="xref">Running Diameter as a SASL Backend</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-diameter-is-an-sctp-service" class="xref">Diameter is an SCTP service</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-reliance-on-dane-and-dnssec" class="xref">Reliance on DANE and DNSSEC</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-centralised-handing-of-sasl" class="xref">Centralised handing of SASL over Diameter</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-support-levels-for-realm-cr" class="xref">Support Levels for Realm Crossover</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-C" class="xref">Appendix C</a>.  <a href="#name-acknowledgements" class="xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-D" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">It is common for Internet users to work with services from a varierity of
providers.  An ad hoc practice has arisen of using local identity
schemes for each of these providers.  There is no integration of
identity systems, and the practice reduces the control of
users over their online identity.  A solution to this is support
for Realm Crossover TODO.xref.target=draft-vanrein-internetwide-realm-crossover,
where an externally acquired service can make a
callback to a home realm to authenticate a user's identity and use that
for service-specific authorisation.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">SASL <span>[<a href="#RFC4422" class="xref">RFC4422</a>]</span> and GSS-API <span>[<a href="#RFC2743" class="xref">RFC2743</a>]</span> together
is instrumental in authentication across a wide range of application
protocols; it allows these protocols to abstract from the actual authentication
mechanisms, and at the same time it allows authentication mechanisms to not
be concerned with the application protocol.  SASL can easily be funneled
from one protocol into another, modulo a number of security concerns.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">Diameter and its Network Access Server application are instrumental in
authenticating a user under a realm, while not handing over any resources
like an application protocol would.  Furthermore, Diameter integrates
with realm-crossing security; service can be declared under a domain name
in a manner that is standardised, scalable and secure.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This can be used by a foreign server to authenticate a client by
call the client's own domain as an authentication backend:<a href="#section-1-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-1-5">
<pre>
   +--------+    SASL     +--------+    SASL    +---------+
   | Proto  |-----------&gt; | Foreign| ---------&gt; | Identity|
   | Client |-----------&gt; | Server | ---------&gt; |  Domain |
   +--------+  AppProto   +--------+  Diameter  +---------+
       ||                     ||                    ||
john@example.com        find SRV, TLSA          example.com
  &amp; credential           &amp; relay SASL          authentication


               Realm Crossover authentication:

         Client John authenticates to his own Domain
                while using a foreign Server.
</pre><a href="#section-1-5" class="pilcrow">¶</a>
</div>
<p id="section-1-6">The Diameter server in the domain needs to respond success or failure
on the SASL exchange forwarded to it.  It delivers a User-Name on success,
but not its domain.  The client domain is validated by the foreign server,
using DANE <span>[<a href="#RFC6698" class="xref">RFC6698</a>]</span>.  The User-Name combines with the
validated domain to form the client identity for use in the foreign server.
The domain server also validates the foreign server, and MAY use this for
access control, and perhaps to decide on the release of additional AVPs.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">The client needs to assure that the authentication exchange cannot be
relayed anywhere but to the Diameter service in his realm.  This can be
assured with
channel binding <span>[<a href="#RFC5056" class="xref">RFC5056</a>]</span> <span>[<a href="#RFC5801" class="xref">RFC5801</a>]</span>;
the foreign server detects this information
and relays it to the Diameter service.  Normally, protocol servers
should not accept externally dictated channel binding information;
the reason why it is safe to make an exception for Diameter is that it
provides no resources, making it an unattractive attack target.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">SASL tokens are not generally safe to pass over plaintext channels.
This is usually addressed
by wrapping the application protocol in TLS, but since that would only
protect one leg of the intended realm-crossing authentication exchange,
there is a need for end-to-end encryption.<a href="#section-1-8" class="pilcrow">¶</a></p>
<p id="section-1-9">This specification describes a SASL mechanism named SXOVER-PLUS as an
end-to-end encrypted tunnel around another SASL exchange.  It also defines
how SASL can be embedded in a Diameter authentication exchange, which
may be useful with SXOVER-PLUS or with any other SASL mechanism.<a href="#section-1-9" class="pilcrow">¶</a></p>
<p id="section-1-10">Realm Crossover for SASL is part of a series of protocol enhancements,
as overviewed in
TODO:xref target="draft-vanrein-internetwide-realm-crossover".
Among the potential use cases are a global identity scheme for general
communication and group participation, establishment of encryption
keys, all with identity control under individually owned domains.<a href="#section-1-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sxover-raw">
<section id="section-2">
      <h2 id="name-messages-of-sxover-plus">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-messages-of-sxover-plus" class="section-name selfRef">Messages of SXOVER-PLUS</a>
      </h2>
<p id="section-2-1">SXOVER-PLUS consists of a few messages that derive an encryption
secret and then continue using it as an end-to-end encrypted tunnel
around a standard SASL authentication exchange.  SXOVER continues
to be active as long as the tunneled exchange does.<a href="#section-2-1" class="pilcrow">¶</a></p>
<div id="sxover-prepare">
<section id="section-2.1">
        <h3 id="name-preparation-for-messaging">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-preparation-for-messaging" class="section-name selfRef">Preparation for Messaging</a>
        </h3>
<p id="section-2.1-1">Before SXOVER-PLUS starts, the user uses an out-of-band protocol
to submit a long-term key to his domain and receives back a suitable
keyno and encalg in the style of Kerberos <span>[<a href="#RFC4120" class="xref">RFC4120</a>]</span>
along with a "keymap" blob that contains the originally submitted
long-term key in encrypted form.  This process may be run at any
time desired by the client, like when a program first uses the
SXOVER-PLUS mechanism; keys may be kept for the remainder of the
program run, even if this lasts for weeks and crosses between security
realms, as a pre-validated key for protected contact with their realm;
but at any time desired, the client may drop the long-term key, for
example when a user desktop session is suspended or terminated.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">By offering the SXOVER-PLUS mechanism for SASL, a foreign server
announces its willingness to validate the client's domain.
relay SASL messages to it, trust its authentication conclusion and
User-Name and treat that as a user identity of the client's domain.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">Offering SXOVER-PLUS does not preclude the offering of other
SASL mechanisms; for instance, ANONYMOUS may be a useful option
to also offer guest access to clients.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sxover-c2s-init">
<section id="section-2.2">
        <h3 id="name-initial-client-to-server-me">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-initial-client-to-server-me" class="section-name selfRef">Initial Client-to-Server Message</a>
        </h3>
<p id="section-2.2-1">SXOVER-PLUS is a client-first mechanism.  The first SASL Token
starts with "p=CHANBIND,,DOMAIN," where CHANBIND is the channel binding
name and DOMAIN is the domain name of the client.  This notation is
compatible with the GS2 bridge <span>[<a href="#RFC5056" class="xref">RFC5056</a>]</span>.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">When the client connects to the foreign service over
TLS, the tls-unique form <span>[<a href="#RFC5929" class="xref">RFC5929</a>]</span>
of channel binding is RECOMMENDED for protocols or their
implementation that encapsulate an entire SASL exchange
in one TLS connection.  For protocols that spread the SASL
exchange over multiple connections it is RECOMMENDED to support
both tls-unique and tls-server-end-point.  Special considerations
may apply as a result of software configuration per home realm.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">Following this is DER-encoded information for the following
ASN.1 structure:<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2-4">
<pre>
C2S-Init ::= [APPLICATION 1] IMPLICIT SEQUENCE {
   clirnd   OCTET STRING,   -- Entropy to allow client variety
   keyno    KeyNumber,      -- Given realm and encalg, identify...
   encalg   EncryptAlg,     -- ...the key for keymap decryption...
   keymap   OCTET STRING    -- ...yielding server-acceptable data
}

EncryptAlg ::= Int32
KeyNumber  ::= UInt32
</pre><a href="#section-2.2-4" class="pilcrow">¶</a>
</div>
<p id="section-2.2-5">The clirnd is a salt that should hold enough entropy to satisfy 
the client's cryptographic requirements.  The other fields result
from the setup of the long-term key preceding SXOVER-PLUS.<a href="#section-2.2-5" class="pilcrow">¶</a></p>
<p id="section-2.2-6">Upon reception, the server locates a key for the keyno and encalg
in the key store for DOMAIN and uses it to decrypt keymap into
entropy that serves as input to the random-to-key function
<span>[<a href="#RFC3961" class="xref">RFC3961</a>]</span>,
where the length of the decrypted keymap must match the
key-generation seed-length.<a href="#section-2.2-6" class="pilcrow">¶</a></p>
<p id="section-2.2-7">The same key is constructed with random-to-key on both ends;
the client uses the key that it originally submitted to the
server.  The result is now on both ends, and known as key K0.<a href="#section-2.2-7" class="pilcrow">¶</a></p>
<p id="section-2.2-8">Both ends pass K0 into the PRF+() function [Section 5.1 of <span>[<a href="#RFC6113" class="xref">RFC6113</a>]</span>]
with the entire message (the GS2 header followed by C2S-Init, which
includes the clirnd entropy field) to produce properly sized input to
the random-to-key function.  The result is known as key K1.  Note
how this is similar to the KRB-FX-C2 procedure [Section 5.1 of <span>[<a href="#RFC6113" class="xref">RFC6113</a>]</span>]
except that it is applied to a single key.  (Considering slight
generalisation of the procedure to a list of key/pepper pairs
that are composed with associative/commutative XOR operators.)<a href="#section-2.2-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sxover-s2c-init">
<section id="section-2.3">
        <h3 id="name-initial-server-to-client-me">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-initial-server-to-client-me" class="section-name selfRef">Initial Server-to-Client Message</a>
        </h3>
<p id="section-2.3-1">After the client-first SASL Token, the server sends its
first challenge.  It is encoded with DER and encrypted by K1,
and contains the following ASN.1 structure:<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.3-2">
<pre>
S2C-Init ::= [APPLICATION 2] IMPLICIT SEQUENCE {
   srvrnd     OCTET STRING,   -- Entropy to allow server variety
   mechlist   IA5String       -- Available SASL mechanisms
}
</pre><a href="#section-2.3-2" class="pilcrow">¶</a>
</div>
<p id="section-2.3-3">The srvrnd is a salt that should hold enough entropy to satisfy 
the server's cryptographic requirements.  Note that the mechlist
and DER tagging add no entropy.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.3-4">The mechlist starts the SASL exchange inside the end-to-end
encrypted tunnel.  If this inner list uses channel binding at all,
it should replicate the channel binding choices from the outer
layer.<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<p id="section-2.3-5">The key K1 is passed into the PRF+() function [Section 5.1 of <span>[<a href="#RFC6113" class="xref">RFC6113</a>]</span>]
with the pepper set to the concatenation of the
entire S2C-Init message and the channel binding value.
This is used to produce a last input to the random-to-key function.
The result is known as key K2.<a href="#section-2.3-5" class="pilcrow">¶</a></p>
<p id="section-2.3-6">The direct concatenation of S2C-Init with channel binding
information is secure because of the self-descriptive size
of the DER encoding of the former.  Also note that there is
no risk of cross-polination between types of channel binding
because the name for the type has been hashed into key K1 and is
therefore already securely encompassed in the key derivation.<a href="#section-2.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sxover-c2s-cont">
<section id="section-2.4">
        <h3 id="name-continued-client-to-server-">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-continued-client-to-server-" class="section-name selfRef">Continued Client-to-Server Messages</a>
        </h3>
<p id="section-2.4-1">Further messages from the client to the server hold DER content
encrypted with key K2, following this ASN.1 format:<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.4-2">
<pre>
C2S-Cont ::= [APPLICATION 3] IMPLICIT SEQUENCE {
   mechsel   IA5String OPTIONAL,   -- SASL mechanism name selection
   c2s       SaslToken             -- NULL or SASL token passed
                                   -- from client to server
}

SaslToken ::= CHOICE {
   token     OCTET STRING,
   no-token  NULL
}
</pre><a href="#section-2.4-2" class="pilcrow">¶</a>
</div>
<p id="section-2.4-3">The mechsel indicates the client's choice of a SASL mechanism,
and MUST be in the first inner SASL message.  It initiates a new
authentication exchange.  The c2s holds the SASL Token and is sent
as NULL whenever the mechanism yields no token, which is distinct
from yielding an empty token.<a href="#section-2.4-3" class="pilcrow">¶</a></p>
<p id="section-2.4-4">The inner SASL exchange may be used to select an authorisation
name that differs from the authentication name.  This would be
subject to normal approval by the SASL server, but upon success
the authorisation name would be revealed in the User-Name over
Diameter, and the foreign server would not be told about the
authentication name.  This can facilitate pseudonymity.<a href="#section-2.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="s2c-cont">
<section id="section-2.5">
        <h3 id="name-continued-server-to-client-">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-continued-server-to-client-" class="section-name selfRef">Continued Server-to-Client Messages</a>
        </h3>
<p id="section-2.5-1">Further messages from the server to the client hold DER content
encrypted with key K2, following this ASN.1 format:<a href="#section-2.5-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.5-2">
<pre>
S2C-Cont ::= [APPLICATION 4] IMPLICIT SEQUENCE {
   success  BOOLEAN DEFAULT FALSE,  -- When TRUE, s2c is an
                                    -- additional token
   s2c      SaslToken               -- NULL or SASL token from
                                    -- server to client
}
</pre><a href="#section-2.5-2" class="pilcrow">¶</a>
</div>
<p id="section-2.5-3">The s2c field carries the SASL token if it is provided, even
when it is empty.  If the token is absent, it carries NULL.<a href="#section-2.5-3" class="pilcrow">¶</a></p>
<p id="section-2.5-4">General reporting of success or failure is done for SXOVER-PLUS.
But not all encapsulating protocols support additional data, but
the success field makes this possible in any case.  Note that this
is trivially supported in Diameter, by sending a SASL token as part
of a success message.  Inside the SXOVER-PLUS tunnel it is also
possible by setting the success flag and supplying the additional
data in s2c.<a href="#section-2.5-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mech2gssapi">
<section id="section-2.6">
        <h3 id="name-using-sxover-plus-with-gss-">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-using-sxover-plus-with-gss-" class="section-name selfRef">Using SXOVER-PLUS with GSS-API</a>
        </h3>
<p id="section-2.6-1">SXOVER-PLUS can be used with GSS-API <span>[<a href="#RFC2743" class="xref">RFC2743</a>]</span>
instead of SASL with minor changes, because it is mostly similar
to GS2.  This results in a GSS-API tunnel wrapped around SASL
authentication.<a href="#section-2.6-1" class="pilcrow">¶</a></p>
<p id="section-2.6-2">GSS-API calls <span>[<a href="#RFC2744" class="xref">RFC2744</a>]</span> to gss_init_sec_context()
and gss_accept_sec_context() MUST follow the GS2 data structure for
channel binding information [Section 5.1 of <span>[<a href="#RFC5801" class="xref">RFC5801</a>]</span>].
This means that only the application_data field is filled, namely
with the "p=CHANBIND,," part of the first SASL token from client
to server, concatenated with the application's channel binding data.
Since such data starts with "CHANBIND:" <span>[<a href="#RFC5056" class="xref">RFC5056</a>]</span>
there is some duplication of data, which should be validated.
This outer layer of SXOVER-PLUS does not support an authorization
identifier; any desire to select an identity is to be encapsulated
inside the end-to-end encrypted tunnel of SXOVER-PLUS.<a href="#section-2.6-2" class="pilcrow">¶</a></p>
<p id="section-2.6-3">The first message transmitted as GSS-API token does not repeat
the "p=CHANBIND,," prefix, but the "DOMAIN," and subsequent
DER-encoded C2S-Init data is retained.  Instead, the standard
GSS-API header is inserted, adhering to the
Mechanism-Independent Token Format [Section 3.1 of <span>[<a href="#RFC2743" class="xref">RFC2743</a>]</span>]
with object identifier 1.3.6.1.4.1.44469.5081.1 to identify
SXOVER-PLUS.  When this object identifier is supplied to the call
GSS_Inquire_SASLname_for_mech [Section 10 of <span>[<a href="#RFC5801" class="xref">RFC5801</a>]</span>],
the output reads "SXOVER-PLUS" (without the quotes).<a href="#section-2.6-3" class="pilcrow">¶</a></p>
<p id="section-2.6-4">When the GSS-API data must be relayed to a SASL backend, then
the "p=CHANBIND,," prefix must be reinserted after removal of the
GSS-API header.  Realm Crossover for GSS-API works like this; it
is rewritten to SASL and passed over Diameter in that form.<a href="#section-2.6-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="appkeys">
<section id="section-2.7">
        <h3 id="name-application-key-derivation">
<a href="#section-2.7" class="section-number selfRef">2.7. </a><a href="#name-application-key-derivation" class="section-name selfRef">Application Key Derivation</a>
        </h3>
<p id="section-2.7-1">SXOVER-PLUS adheres to most of the GS2 bridge, but deviates in two points.
First, security layers are not considered useful in GS2
[Section 12 of <span>[<a href="#RFC5801" class="xref">RFC5801</a>]</span>] because it assumes a pre-existing
secure layer to provide this benefit.  With SXOVER-PLUS however, the
end-to-end connection between a client and their authentication server
differs from the single-hop connection to the foreign service,
and it can be beneficial to extract secret key information between the
former and latter.  The second deviation from GS2 is that SXOVER-PLUS is
defined but SXOVER is not.  For these reasons, GS2- was not prefixed
to the mechanism name.<a href="#section-2.7-1" class="pilcrow">¶</a></p>
<p id="section-2.7-2">In general, security layers may be derived from the key K2 by yet
another pass through the PRF+() function [Section 5.1 of <span>[<a href="#RFC6113" class="xref">RFC6113</a>]</span>].  The pepper for
this is application-specific, and the requested length of octet-string
can also be requested by the application.  Multiple keys can be defined,
each constructed from K2 and pepper.<a href="#section-2.7-2" class="pilcrow">¶</a></p>
<p id="section-2.7-3">Specifically, when SXOVER-PLUS is used under GSS-API, the following
32-byte ASCII strings may be used as pepper to derive keys for each of
the four secure streams supported by GSS-API:<a href="#section-2.7-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.7-4">
<pre>
Pepper as 32 ASCII bytes         | Purpose  | Direction
---------------------------------+----------+------------------
SXOVER-PLUS/GSS-API/SIGN-C2S-KEY | signing  | client --&gt; server
SXOVER-PLUS/GSS-API/SIGN-S2C-KEY | signing  | client &lt;-- server
SXOVER-PLUS/GSS-API/WRAP-C2S-KEY | wrapping | client --&gt; server
SXOVER-PLUS/GSS-API/WRAP-S2C-KEY | wrapping | client &lt;-- server
</pre><a href="#section-2.7-4" class="pilcrow">¶</a>
</div>
<p id="section-2.7-5">Definitions for one application do not preclude the generation of keys
for other applications.  It is however vital to security that they all use
different pepper that share a SASL-authenticated session but distribute
keys to different trusted regions within an endpoint.<a href="#section-2.7-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="spec.avps">
<section id="section-3">
      <h2 id="name-avp-definitions-for-sasl-in">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-avp-definitions-for-sasl-in" class="section-name selfRef">AVP Definitions for SASL in Diameter</a>
      </h2>
<p id="section-3-1">SASL messages in Diameter use a number of
AVPs [Section 4 of <span>[<a href="#RFC6733" class="xref">RFC6733</a>]</span>] that are
combined to relay SASL to a Destination-Realm that
is set to the client's domain name.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">These AVPs are added to the set that is used with the
Network Access Server application <span>[<a href="#RFC7155" class="xref">RFC7155</a>]</span>,
and can therefore be used in
AA-Request and AA-Answer messages.  They are always sent
with the Mandatory Flag set to 0.  When they are not
recognised upon reception, they will be silently igored.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">Normally, a successful AA-Answer would provide a
User-Name AVP to inform the server about a utf8-username NAI
without a utf8-realm [Section 2.2 of <span>[<a href="#RFC7542" class="xref">RFC7542</a>]</span>]
under which the client is identified; without the User-Name
an anonymous session is the only available option,
possibly leading to reduced service and/or limited
data retention.  Sending a pseudonym in the User-Name
may be an intermediate option.  In all cases, the domain
under which an authenticated user name is defined
can be taken from the Destination-Realm handling the
Network Access Server session; with the domain also written
in UTF-8, the parts may be combined in the nai grammar
[Section 2.2 of <span>[<a href="#RFC7542" class="xref">RFC7542</a>]</span>.<a href="#section-3-3" class="pilcrow">¶</a></p>
<div id="spec.avps.mech">
<section id="section-3.1">
        <h3 id="name-sasl-mechanism">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-sasl-mechanism" class="section-name selfRef">SASL-Mechanism</a>
        </h3>
<p id="section-3.1-1">The SASL-Mechanism AVP has AVP Code TBD0 and is of type
UTF8String, further restricted to a list of zero or more
SASL mechanism names in their standardised notation
[Section 3.1 of <span>[<a href="#RFC4422" class="xref">RFC4422</a>]</span>]
separated by a space character U+0020.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">To retrieve a server's list of supported SASL mechanisms,
this AVP is included in an AA-Request message, containing an
empty list of SASL mechanism names, so an empty string.
When SASL is supported by the server, it responds with the
list of currently available SASL mechanisms.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">Clients MAY retrieve the server's supported mechanism
list without actually attempting authentication in the
same session; this can be a caching mechanism for a
given combination of Destination-Realm, Origin-Realm and
Origin-Host.  An abort of such a session by the
server indicates that the cache entry has expired, and
should be retrieved anew for a following attempt.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4">To relay a client's choice of SASL mechanism, this AVP
is included in an AA-Request message, containing a single
SASL mechanism name.  This MAY be done in another session
than the one that retrieved the supported SASL mechanisms
from the server, as long as origin and use have a matching
Destination-Realm, Origin-Realm and Origin-Host.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1-5">When the supported SASL mechanism list on a server is
changed, any open sessions that depend on one or more of
the modified mechanisms SHOULD be aborted by the server.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">Diameter peers MUST NOT send the SASL-Mechanism AVP
unless they also process SASL-Token and SASL-Channel-Binding
AVPs for any sessions with the same Destination-Realm.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="spec.avps.token">
<section id="section-3.2">
        <h3 id="name-sasl-token">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-sasl-token" class="section-name selfRef">SASL-Token</a>
        </h3>
<p id="section-3.2-1">The SASL-Token AVP has AVP Code TBD1 and is of type
OctetString.  It may be passed in AA-Request and AA-Answer
messages.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">SASL
requires distinction between empty and absent tokens;
absent SASL tokens are represented by absence of the
SASL-Token AVP and empty SASL tokens are represented
as a present SASL-Token AVP with zero content bytes.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">The interpretation of a SASL-Token is subject to the
SASL mechanism selection by the client.  This is relayed
with a SASL-Mechanism AVP, which MUST be part of each
Network Access Server session, no later than the first
SASL-Token exchange in that session.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="spec.avps.chanbind">
<section id="section-3.3">
        <h3 id="name-sasl-channel-binding">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-sasl-channel-binding" class="section-name selfRef">SASL-Channel-Binding</a>
        </h3>
<p id="section-3.3-1">The SASL-Channel-Binding AVP has AVP Code TBD2 and is
of type OctetString.  The AVP contains the literal channel
binding information for a SASL mechanism, and may be sent
in an AA-Request that also holds a SASL-Mechanism AVP
that lists a single SASL mechanism.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">Without Realm Crossover, a SASL identity provider can source
channel binding information from the underlying communications
channel.  This information is not available to a SASL backend
running Diameter.  To enable channel binding between the end points,
and thereby authentication between the SASL end points, the foreign
server incorporates the channel binding information that the
client can use in its connection to the foreign server.  This
is useful to mitigate replay attacks, which is why its use
is RECOMMENDED.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">Note that SASL requires channel binding information
when the client-selected SASL-Mechanism AVP ends
in -PLUS.  Different kinds of channel binding exist,
and their representations are distinguished with
an IANA-registered prefix.  As a result, more than
one SASL-Channel-Binding AVP can be safely included in one
AA-Request.  Servers MAY refrain from learning the
client-chosen kind of channel binding from the SASL
exchange, but SHOULD then transmit all the kinds that
they support to avoid authentication failure.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="spec.diameter.sasl">
<section id="section-4">
      <h2 id="name-diameter-session-requiremen">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-diameter-session-requiremen" class="section-name selfRef">Diameter Session Requirements for SASL</a>
      </h2>
<p id="section-4-1">Any exchange under the Network Access Server application
must include a Session-ID.  There MAY be two kinds of session,
and whether they are combined is an implementation requirement.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">A session can probe a SASL mechanism list as supported by a
Destination-Realm for a given Origin-Realm and Origin-Host.
This mechanism MAY be assumed valid for any other sessions with
these same three AVPs, for as long as this session is open.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">A session can make at most one SASL authentication attempt.
This is initiated with a SASL-Mechanism AVP that conveys
precisely one SASL mechanism name in the first token.  The
same Diameter message MAY convey a SASL-Token AVP in support of
client-first mechanisms.  The same Diameter message MUST convey
one or more SASL-Channel-Binding AVPs if the SASL-Mechanism
ends in -PLUS.  Further messages in the session MUST NOT have
the SASL-Mechanism AVP, MUST NOT have the SASL-Channel-Binding
AVP and MAY have zero or one SASL-Token AVP.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">It is possible for a session that probed a SASL mechanism list
to continue as an authentication attempt.  In this case, the
SASL mechanism list collapses to the one choice made by the
client, and other sessions cannot rely on the entire mechanism
list.  The server MAY close the session if it drops support for
the client-selected SASL mechanism.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">Alternatively, a session that probed a SASL mechanism list
can be kept open, and the obtained SASL mechanism list is then
considered stable for sessions that use the same combination of
Destination-Realm, Origin-Realm and Origin-Host.  This may be
used to cache mechanism lists.  The server SHOULD close this
session if it changes the mechanism list, thus invalidating
the previously submitted mechanism list.  As long as the client
has the mechanism list open, it MAY use that list for sessions
that directly enter into an authentication attempt.<a href="#section-4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="spec.diameter">
<section id="section-5">
      <h2 id="name-diameter-message-requiremen">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-diameter-message-requiremen" class="section-name selfRef">Diameter Message Requirements for SXOVER-PLUS</a>
      </h2>
<p id="section-5-1">This section explains how the various SXOVER-PLUS messages
are forwarded over Diameter by the foreign server.  The foreign
server is connected to the SASL client, possibly over a TLS connection
or a protocol under GSS-API protection,
and relays requests over Diameter, usually over SCTP with DTLS.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Diameter servers eventually provide success and failure responses, based on
the corresponding final results from a SASL implementation that they in turn use.  
Before the final result is reached, the SASL implementation may impose a
challenge that will be reproduced over Diameter, passing challenge and
response tokens over Diameter on behalf of SASL.<a href="#section-5-2" class="pilcrow">¶</a></p>
<div id="c2s-init-diam">
<section id="section-5.1">
        <h3 id="name-c2s-init-requests-over-diam">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-c2s-init-requests-over-diam" class="section-name selfRef">C2S-Init Requests over Diameter</a>
        </h3>
<p id="section-5.1-1">To send C2S-Init the Diameter client MUST include at least the following
AVPs in an AA-Request [Section 3.1 of <span>[<a href="#RFC7155" class="xref">RFC7155</a>]</span>]:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.1-2">
          <dt id="section-5.1-2.1">Destination-Realm</dt>
          <dd style="margin-left: 3.0em" id="section-5.1-2.2">is the client's identity domain,
 replicated here for Diameter routing purposes;
 SXOVER-PLUS conveys this value in plaintext;<a href="#section-5.1-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.3">SASL-Mechanism</dt>
          <dd style="margin-left: 3.0em" id="section-5.1-2.4">MUST be set to the fixed string SXOVER-PLUS for this SASL mechanism's name;<a href="#section-5.1-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.5">SASL-Token</dt>
          <dd style="margin-left: 3.0em" id="section-5.1-2.6">MUST be set to the GS2 header and C2S-Init;<a href="#section-5.1-2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.1-2.7">SASL-Channel-Binding</dt>
          <dd style="margin-left: 3.0em" id="section-5.1-2.8">MUST be set to the channel binding bytes for the connection in which the SASL client attempts authentication, adhering to the channel binding mechanism named in the gs2-header in the SASL-Token.<a href="#section-5.1-2.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.1-3">It is possible to extend the message with more AVPs.
Unless described herein, the SASL implementation ignores them.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="s2c-init-diam">
<section id="section-5.2">
        <h3 id="name-s2c-init-responses-over-dia">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-s2c-init-responses-over-dia" class="section-name selfRef">S2C-Init Responses over Diameter</a>
        </h3>
<p id="section-5.2-1">When SASL fails to initialise in response to the C2S-Init passed in
an AA-Request, then the AA-Answer MUST represent that in the following
AVP:<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.2-2">
          <dt id="section-5.2-2.1">Result-Code</dt>
          <dd style="margin-left: 3.0em" id="section-5.2-2.2">MUST be set to an error or failure code
 [Section 7.1 of <span>[<a href="#RFC6733" class="xref">RFC6733</a>]</span>].<a href="#section-5.2-2.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.2-3">The initialisation of SASL forms a S2C-Init response, and an AA-Answer
MUST be sent with the following AVPs:<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.2-4">
          <dt id="section-5.2-4.1">Result-Code</dt>
          <dd style="margin-left: 3.0em" id="section-5.2-4.2">MUST be set to the value DIAMETER_MULTI_ROUND_AUTH
 [Section 7.1.1 of <span>[<a href="#RFC6733" class="xref">RFC6733</a>]</span>];<a href="#section-5.2-4.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.2-4.3">SASL-Token</dt>
          <dd style="margin-left: 3.0em" id="section-5.2-4.4">MUST be set to the S2C-Init value.<a href="#section-5.2-4.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="c2s-cont-diam">
<section id="section-5.3">
        <h3 id="name-c2s-cont-requests-over-diam">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-c2s-cont-requests-over-diam" class="section-name selfRef">C2S-Cont Requests over Diameter</a>
        </h3>
<p id="section-5.3-1">The C2S-Cont message is any further message that the SASL client passes
to the foreign server.  It MUST be forwarded as a Diameter AA-Request with
the following AVPs:<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.3-2">
          <dt id="section-5.3-2.1">SASL-Token</dt>
          <dd style="margin-left: 3.0em" id="section-5.3-2.2">MUST be set to the C2S-Cont value from the SASL
 client;<a href="#section-5.3-2.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.3-2.3">SASL-Mechanism</dt>
          <dd style="margin-left: 3.0em" id="section-5.3-2.4">MUST NOT be sent;<a href="#section-5.3-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.3-2.5">SASL-Channel-Binding</dt>
          <dd style="margin-left: 3.0em" id="section-5.3-2.6">MUST NOT be sent;<a href="#section-5.3-2.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.3-2.7">User-Name</dt>
          <dd style="margin-left: 3.0em" id="section-5.3-2.8">MAY be sent but MUST NOT be processed when
 received by implementations of this specification;<a href="#section-5.3-2.8" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.3-2.9">User-Password</dt>
          <dd style="margin-left: 3.0em" id="section-5.3-2.10">MOST NOT be sent.<a href="#section-5.3-2.10" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="s2c-cont-diam">
<section id="section-5.4">
        <h3 id="name-s2c-cont-responses-over-dia">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-s2c-cont-responses-over-dia" class="section-name selfRef">S2C-Cont Responses over Diameter</a>
        </h3>
<p id="section-5.4-1">S2C-Cont tokens are produced as output from continued SASL processing
based on C2S-Cont tokens found in AA-Request messages.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">If the SASL exchange is not final, then the AA-Answer MUST represent that
in the following AVPs:<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.4-3">
          <dt id="section-5.4-3.1">Result-Code</dt>
          <dd style="margin-left: 3.0em" id="section-5.4-3.2">is set to the value DIAMETER_MULTI_ROUND_AUTH
 [Section 7.1.1 of <span>[<a href="#RFC6733" class="xref">RFC6733</a>]</span>];<a href="#section-5.4-3.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.4-3.3">SASL-Token</dt>
          <dd style="margin-left: 3.0em" id="section-5.4-3.4">MUST be included, and set to the S2C-Cont value.<a href="#section-5.4-3.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.4-4">If the SASL exchange fails, then the AA-Answer MUST represent that in
the following AVP:<a href="#section-5.4-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.4-5">
          <dt id="section-5.4-5.1">Result-Code</dt>
          <dd style="margin-left: 3.0em" id="section-5.4-5.2">is set to an error or failure code
 [Section 7.1 of <span>[<a href="#RFC6733" class="xref">RFC6733</a>]</span>].<a href="#section-5.4-5.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.4-6">If the SASL exchange succeeds, then the AA-Answer MUST represent that
in the following AVPs:<a href="#section-5.4-6" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-5.4-7">
          <dt id="section-5.4-7.1">Result-Code</dt>
          <dd style="margin-left: 3.0em" id="section-5.4-7.2">is set to a success code
 [Section 7.1.2 of <span>[<a href="#RFC6733" class="xref">RFC6733</a>]</span>];<a href="#section-5.4-7.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.4-7.3">SASL-Token</dt>
          <dd style="margin-left: 3.0em" id="section-5.4-7.4">is included when the SASL exchange produced an
 additional token upon success [Section 4 of <span>[<a href="#RFC4422" class="xref">RFC4422</a>]</span>];<a href="#section-5.4-7.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-5.4-7.5">User-Name</dt>
          <dd style="margin-left: 3.0em" id="section-5.4-7.6">may be provided, and then contains the utf8-username
 part of a NAI <span>[<a href="#RFC7542" class="xref">RFC7542</a>]</span>, but not a utf8-realm;
 normally, this is the authentication identity for which the inner
 SASL mechanism succeeded, but if an authorization identity string
 was supplied and approved, then that is used instead; finally,
 there may be circumstances that call for sending no User-Name,
 such as when the inner SASL mechanism was ANONYMOUS (as that
 does not yield an authenticated user identity).<a href="#section-5.4-7.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-5.4-8">
Further AVPs may be included in a successful AA-Answer.
Examples are access control list information and backend tunnel creation.
No meaning is assigned herein to such additional AVPs.<a href="#section-5.4-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="run">
<section id="section-6">
      <h2 id="name-running-diameter-as-a-sasl-">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-running-diameter-as-a-sasl-" class="section-name selfRef">Running Diameter as a SASL Backend</a>
      </h2>
<p id="section-6-1">Following are a few practical considerations in relation
to the Diameter connectivity for SASL.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="run.sctp">
<section id="section-6.1">
        <h3 id="name-diameter-is-an-sctp-service">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-diameter-is-an-sctp-service" class="section-name selfRef">Diameter is an SCTP service</a>
        </h3>
<p id="section-6.1-1">Diameter is primarily an SCTP-based protocol
<span>[<a href="#RFC6733" class="xref">RFC6733</a>]</span>,
for reasons of scalabaility and efficiency.  SASL Diameter
benefits from these properties and embraces the SCTP transport.
Operating system support for SCTP is wide-spread, but
parts of network infrastructure may not support it, and that
may cause implementations to add a fallback to more traditional
protocols.  Standards offer two options for doing this.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">Diameter can fallback to run over TCP, which is mostly
of use to poorly connected client machines, but this sacrifices several
benefits of the SCTP carrier.
SASL Diameter embeddings typically involve
no client systems, so this option is NOT RECOMMENDED.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">SCTP may be run over a UDP transport using port 9899
<span>[<a href="#RFC6951" class="xref">RFC6951</a>]</span>, which does not
sacrifice much; it only inserts a UDP header
before each message.  This is a reasonable expectation
of foreign servers as well as identity domain, so this additional
option is RECOMMENDED for situations where an alternative for
native SCTP is desired.  It is standardised as a socket
option SCTP_REMOTE_UDP_ENCAPS_PORT, and only involves a small
repetition in code, with a minor change between the
attempts.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="run.dnssec">
<section id="section-6.2">
        <h3 id="name-reliance-on-dane-and-dnssec">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-reliance-on-dane-and-dnssec" class="section-name selfRef">Reliance on DANE and DNSSEC</a>
        </h3>
<p id="section-6.2-1">Diameter always involves the use of DTLS or TLS, but there is a number
of choices concerning the validation of connections through DNSSEC
and DANE.  It is the identity domain's prerogative what level of protection
it upholds for its client identities, but any foreign server MAY
choose to raise the bar by setting a minimum accepable level.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">DNSSEC offers a protection mechanism for the _diameters._sctp
SRV records that lead to the Diameter host and its port for the
identity domain.  DNSSEC can also protect any following AAAA and
A records.  DNSSEC does not protect
against forged IP routes or hijacked port mappings or routing.
To protect against this as well, a TLSA record
for the service host and port, along with the _sctp protocol label,
can be used as specified for DANE <span>[<a href="#RFC6698" class="xref">RFC6698</a>]</span>.
This use of DNSSEC and DANE is RECOMMENDED.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">When identity domains choose to be light on these measures they risk
that their user identities are hijacked, in spite of the use of DTLS or TLS.
Foreign servers MAY choose to reject such identity domains, or alternatively
be more restrictive about the certificates that are accepted.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">The SASL mechanism SXOVER-PLUS separates the authentication of
a client identity into a domain and a user name underneath it.  The
user name is validated by an identity server whose authority to
identify users for the domain is authenticated by the relying foreign
server.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">From the perspective of the foreign server, assurance of an identity
is the vital aspect of the SXOVER-PLUS flow that it forwards over Diameter.
Through DTLS or TLS, with DNSSEC and DANE to validate the certificate it
uses, the link from an identity domain to the Diameter
connection can be verified, so the relying server can be certain about the
domain under which its backend connection resides.  By receiving a response
over that connection to a known-authoritative server for the domain, the
user name can also be trusted.  The relying server continues to treat the
user name and domain as a pair the for identification of the user.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">Channel binding is normally limited to two parties only, and forwarding
such information is not a trivial idea.  The fact that the forwarding
connection is encrypted, and known to lead to an authoritative server for
an identity domain does help.  The foreign server relies on proper
authentication, and has no interest in bypassing authentication, and it
would be doing that by adopting channel binding information from
anywhere else.<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">From the perspective of the client and the identity domain, the
safety of the SASL credentials is paramount.  When addressing a
foreign server that is not part of the identity domain, clients
therefore MUST NOT rely on mechanisms that might leak credentials.
Two mechanisms that are safe to use are ANONYMOUS, which passes no
credentials and yields no privileges, and SXOVER-PLUS, which
applies end-to-end encryption to another SASL mechanism that may or
may not be secure.<a href="#section-7-4" class="pilcrow">¶</a></p>
<p id="section-7-5">The SXOVER-PLUS mechanism uses channel binding to ensure that
the authentication is specific to a stream.  The level to which this is
secure depends on the channel binding mechanism.  Therefore, in spite
of end-to-end encryption, most use cases will want a secure carrier
such as TLS between the client and foreign server.<a href="#section-7-5" class="pilcrow">¶</a></p>
</section>
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">This specification defines three AVP Codes for use with Diameter.
IANA is requested to register the following AVP Codes for them in the
"Authentication, Authorization, and Accounting (AAA) Parameters" registry:<a href="#section-8-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8-2">
<pre>
AVP Code | Attribute Name       | Reference
---------+----------------------+------------
TBD0     | SASL-Mechanism       | (this spec)
TBD1     | SASL-Token           | (this spec)
TBD2     | SASL-Channel-Binding | (this spec)
</pre><a href="#section-8-2" class="pilcrow">¶</a>
</div>
<p id="section-8-3">This specification defines a SASL mechanism named SXOVER-PLUS.
IANA is requested to register the following in the Simple Authentication
and Security Layer (SASL) Mechanisms registry under SASL Mechanisms:<a href="#section-8-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8-4">
<pre>
Mechanism   | Usage  | Reference  | Owner
------------+--------+------------+-------------------------------------
SXOVER-PLUS | COMMON | (this doc) | Rick van Rein &lt;rick@openfortress.nl&gt;
</pre><a href="#section-8-4" class="pilcrow">¶</a>
</div>
</section>
<section id="section-9">
      <h2 id="name-normative-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="I-D.vanrein-internetwide-realm-crossover">[I-D.vanrein-internetwide-realm-crossover]</dt>
      <dd>
<span class="refAuthor">Rein, R. V.</span>, <span class="refTitle">"InternetWide Identities with Realm Crossover"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-vanrein-internetwide-realm-crossover-00</span>, <time datetime="2020-09-28" class="refDate">28 September 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-vanrein-internetwide-realm-crossover-00.txt">https://www.ietf.org/archive/id/draft-vanrein-internetwide-realm-crossover-00.txt</a>&gt;</span>. </dd>
<dd class="break"></dd><dt id="RFC2743">[RFC2743]</dt>
      <dd>
<span class="refAuthor">Linn, J.</span>, <span class="refTitle">"Generic Security Service Application Program Interface Version 2, Update 1"</span>, <span class="seriesInfo">RFC 2743</span>, <span class="seriesInfo">DOI 10.17487/RFC2743</span>, <time datetime="2000-01" class="refDate">January 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2743">https://www.rfc-editor.org/info/rfc2743</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2744">[RFC2744]</dt>
      <dd>
<span class="refAuthor">Wray, J.</span>, <span class="refTitle">"Generic Security Service API Version 2 : C-bindings"</span>, <span class="seriesInfo">RFC 2744</span>, <span class="seriesInfo">DOI 10.17487/RFC2744</span>, <time datetime="2000-01" class="refDate">January 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2744">https://www.rfc-editor.org/info/rfc2744</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3961">[RFC3961]</dt>
      <dd>
<span class="refAuthor">Raeburn, K.</span>, <span class="refTitle">"Encryption and Checksum Specifications for Kerberos 5"</span>, <span class="seriesInfo">RFC 3961</span>, <span class="seriesInfo">DOI 10.17487/RFC3961</span>, <time datetime="2005-02" class="refDate">February 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3961">https://www.rfc-editor.org/info/rfc3961</a>&gt;</span>. </dd>
<dd class="break"></dd><dt id="RFC4120">[RFC4120]</dt>
      <dd>
<span class="refAuthor">Neuman, C.</span>, <span class="refAuthor">Yu, T.</span>, <span class="refAuthor">Hartman, S.</span>, and <span class="refAuthor">K. Raeburn</span>, <span class="refTitle">"The Kerberos Network Authentication Service (V5)"</span>, <span class="seriesInfo">RFC 4120</span>, <span class="seriesInfo">DOI 10.17487/RFC4120</span>, <time datetime="2005-07" class="refDate">July 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4120">https://www.rfc-editor.org/info/rfc4120</a>&gt;</span>. </dd>
<dd class="break"></dd><dt id="RFC4422">[RFC4422]</dt>
      <dd>
<span class="refAuthor">Melnikov, A., Ed.</span> and <span class="refAuthor">K. Zeilenga, Ed.</span>, <span class="refTitle">"Simple Authentication and Security Layer (SASL)"</span>, <span class="seriesInfo">RFC 4422</span>, <span class="seriesInfo">DOI 10.17487/RFC4422</span>, <time datetime="2006-06" class="refDate">June 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4422">https://www.rfc-editor.org/info/rfc4422</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5056">[RFC5056]</dt>
      <dd>
<span class="refAuthor">Williams, N.</span>, <span class="refTitle">"On the Use of Channel Bindings to Secure Channels"</span>, <span class="seriesInfo">RFC 5056</span>, <span class="seriesInfo">DOI 10.17487/RFC5056</span>, <time datetime="2007-11" class="refDate">November 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5056">https://www.rfc-editor.org/info/rfc5056</a>&gt;</span>. </dd>
<dd class="break"></dd><dt id="RFC5801">[RFC5801]</dt>
      <dd>
<span class="refAuthor">Josefsson, S.</span> and <span class="refAuthor">N. Williams</span>, <span class="refTitle">"Using Generic Security Service Application Program Interface (GSS-API) Mechanisms in Simple Authentication and Security Layer (SASL): The GS2 Mechanism Family"</span>, <span class="seriesInfo">RFC 5801</span>, <span class="seriesInfo">DOI 10.17487/RFC5801</span>, <time datetime="2010-07" class="refDate">July 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5801">https://www.rfc-editor.org/info/rfc5801</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5929">[RFC5929]</dt>
      <dd>
<span class="refAuthor">Altman, J.</span>, <span class="refAuthor">Williams, N.</span>, and <span class="refAuthor">L. Zhu</span>, <span class="refTitle">"Channel Bindings for TLS"</span>, <span class="seriesInfo">RFC 5929</span>, <span class="seriesInfo">DOI 10.17487/RFC5929</span>, <time datetime="2010-07" class="refDate">July 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5929">https://www.rfc-editor.org/info/rfc5929</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6113">[RFC6113]</dt>
      <dd>
<span class="refAuthor">Hartman, S.</span> and <span class="refAuthor">L. Zhu</span>, <span class="refTitle">"A Generalized Framework for Kerberos Pre-Authentication"</span>, <span class="seriesInfo">RFC 6113</span>, <span class="seriesInfo">DOI 10.17487/RFC6113</span>, <time datetime="2011-04" class="refDate">April 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6113">https://www.rfc-editor.org/info/rfc6113</a>&gt;</span>. </dd>
<dd class="break"></dd><dt id="RFC6698">[RFC6698]</dt>
      <dd>
<span class="refAuthor">Hoffman, P.</span> and <span class="refAuthor">J. Schlyter</span>, <span class="refTitle">"The DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS) Protocol: TLSA"</span>, <span class="seriesInfo">RFC 6698</span>, <span class="seriesInfo">DOI 10.17487/RFC6698</span>, <time datetime="2012-08" class="refDate">August 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6698">https://www.rfc-editor.org/info/rfc6698</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6733">[RFC6733]</dt>
      <dd>
<span class="refAuthor">Fajardo, V., Ed.</span>, <span class="refAuthor">Arkko, J.</span>, <span class="refAuthor">Loughney, J.</span>, and <span class="refAuthor">G. Zorn, Ed.</span>, <span class="refTitle">"Diameter Base Protocol"</span>, <span class="seriesInfo">RFC 6733</span>, <span class="seriesInfo">DOI 10.17487/RFC6733</span>, <time datetime="2012-10" class="refDate">October 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6733">https://www.rfc-editor.org/info/rfc6733</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6951">[RFC6951]</dt>
      <dd>
<span class="refAuthor">Tuexen, M.</span> and <span class="refAuthor">R. Stewart</span>, <span class="refTitle">"UDP Encapsulation of Stream Control Transmission Protocol (SCTP) Packets for End-Host to End-Host Communication"</span>, <span class="seriesInfo">RFC 6951</span>, <span class="seriesInfo">DOI 10.17487/RFC6951</span>, <time datetime="2013-05" class="refDate">May 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6951">https://www.rfc-editor.org/info/rfc6951</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7155">[RFC7155]</dt>
      <dd>
<span class="refAuthor">Zorn, G., Ed.</span>, <span class="refTitle">"Diameter Network Access Server Application"</span>, <span class="seriesInfo">RFC 7155</span>, <span class="seriesInfo">DOI 10.17487/RFC7155</span>, <time datetime="2014-04" class="refDate">April 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7155">https://www.rfc-editor.org/info/rfc7155</a>&gt;</span>. </dd>
<dd class="break"></dd><dt id="RFC7542">[RFC7542]</dt>
      <dd>
<span class="refAuthor">DeKok, A.</span>, <span class="refTitle">"The Network Access Identifier"</span>, <span class="seriesInfo">RFC 7542</span>, <span class="seriesInfo">DOI 10.17487/RFC7542</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7542">https://www.rfc-editor.org/info/rfc7542</a>&gt;</span>. </dd>
<dd class="break"></dd></dl>
</section>
<div id="app.diasasl">
<section id="appendix-A">
      <h2 id="name-centralised-handing-of-sasl">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-centralised-handing-of-sasl" class="section-name selfRef">Centralised handing of SASL over Diameter</a>
      </h2>
<p id="appendix-A-1">This section is non-normative.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">Within foreign server networks, it can be useful to centralise Diameter
handling in one host, where service-neutral pooling of connections to remote peers
can improve efficiency and security.  Diameter could facilitate this directly, but that would add quite a bit
of handling logic to various foreign servers.  The following ASN.1 module was therefore designed as
the simplest possible request/answer protocol that could run over a TCP connection
between a foreign service host and a nearby/trusted centralised host running its
side of Diameter.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">The protocol can also be used over SCTP.  In this case, a user message can
be defined to contain precisely one DiaSASL-Request in downstream direction, or
one DiaSASL-Answer in upstream direction, and sent with the SCTP_UNORDERED flag.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="appendix-A-4">
<pre>
Quick-DiaSASL DEFINITIONS EXPLICIT TAGS ::= BEGIN

-- ## SASL ready for Diameter
--
-- This is targeted at Diameter backends and avoids loading all of
-- Diameter into applications.
--

-- Open a connection; return is DiaSASL-Open-Answer.
-- The service-realm defines the context of the
-- identity provider; this is where Diameter requests
-- should be send, and it helps to determine what
-- sasl-mechanisms may be used.
--
-- The front-end is identified by a service-trunk code
-- (for the long-term relation between a front-end and
-- back-end) and/or a service-proto protocol that can
-- be used while driving SASL (it could be the "imap"
-- part before the "imap/imap.example.com"PrincipalName
-- for a service in a Kerberos Ticket).
--
DiaSASL-Open-Request ::= [APPLICATION 10] IMPLICIT SEQUENCE {
   service-realm   [1] UTF8String,
   service-trunk   [8] INTEGER   OPTIONAL,
   service-proto   [9] IA5String OPTIONAL
}

-- Close a connection; session-id identifies which
-- and there is no response.  This is ignored when the
-- session-id is unknown; the call is not required
-- after a DiaSASL-Authn-Answer that sets a value for
-- final-comerr, but it is harmless when sent anyway.
--
DiaSASL-Close-Request ::= [APPLICATION 11] IMPLICIT SEQUENCE {
   session-id   [2] OCTET STRING
}

-- Relay an authentication request message; response is
-- DiaSASL-Authn-Answer with a copied session-id.
--
DiaSASL-Authn-Request ::= [APPLICATION 12] IMPLICIT SEQUENCE {
   session-id             [2] OCTET STRING,
   sasl-mechanism         [3] IA5String OPTIONAL,
   sasl-channel-binding   [4] OCTET STRING OPTIONAL,
   sasl-token             [5] OCTET STRING OPTIONAL
}

-- This is the response to a DiaSASL-Open-Request.
--
-- The final-comerr is set when Diameter was conclusive.
-- It is an error code from com_err to allow for errors,
-- but it may be sufficient to know that 0 indicates success
-- and everything else is a failure.
--
-- The service-realm is copied from the Diasasl-Open-Request
-- so it can be used to match; the session-id will continue
-- to identify this session in requests and responses.
--
-- The sasl-mechanisms holds a space-separated string of
-- SASL mechanism names.
--
DiaSASL-Open-Answer ::= [APPLICATION 13] IMPLICIT SEQUENCE {
   final-comerr      [0] INTEGER (-2147483648..2147483647) OPTIONAL,
                         -- Only set when Diameter was conclusive.
                         -- 0 for success, different for failure.
                         -- The code is a com_err code, so int32_t.
   service-realm     [1] UTF8String,
   session-id        [2] OCTET STRING,
   sasl-mechanisms   [3] IA5String
}

-- This is the response to a DiaSASL-Authn-Request.
--
-- The final-result is only set if Diameter was conclusive.
-- It is an error code from com_err to allow for errors,
-- but it may be sufficient to know that 0 indicates success
-- and everything else is a failure.
--
-- Only a successful authentication response can hold values
-- for client-userid and client-domain.  The latter overrides
-- the initial realm, which was provided in the open call,
-- but may be substituted as a result of Realm Crossover.
-- The client-userid is the local part and may be absent on
-- anonymous sessions; the client-userid value is approved
-- by the local Diameter peer as having come from a Diameter
-- Diameter peer that tends to client-domain.
--
DiaSASL-Authn-Answer ::= [APPLICATION 14] IMPLICIT SEQUENCE {
   final-comerr   [0] INTEGER (-2147483648..2147483647) OPTIONAL,
                      -- Only set when Diameter was conclusive.
                      -- 0 for success, different for failure.
                      -- The code is a com_err code, so int32_t.
   session-id     [2] OCTET STRING,
   sasl-token     [5] OCTET STRING OPTIONAL,
   client-userid  [6] UTF8String OPTIONAL,
   client-domain  [7] UTF8String OPTIONAL
}

-- Requests are Open, Close and Authn requests.  This simple
-- CHOICE differentiates between the variants.
-- Note that no extra tags are needed; the [APPLICATION n]
-- tag can be used, or the presence of fields in variants.
--
DiaSASL-Request ::= CHOICE {
    open-request   DiaSASL-Open-Request,
    close-request  DiaSASL-Close-Request,
    authn-request  DiaSASL-Authn-Request
}

-- Answers are sent in response to Open and Authn requests.
-- This simple CHOICE differentiates between the variants.
-- Note that no extra tags are needed; the [APPLICATION n]
-- tag can be used, or the presence of fields in variants.
--
DiaSASL-Answer ::= CHOICE {
    open-answer    DiaSASL-Open-Answer,
    authn-answer   DiaSASL-Authn-Answer
}


-- ## A simple API for DiaSASL

-- A `diasasl` API only needs a small number of calls:
-- http://quick-sasl.arpa2.net/group__quickdiasasl.html
-- This presents only a modest extension to existing software,
-- and easily merges into a variety of concurrency models.

END
</pre><a href="#appendix-A-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="app.levels">
<section id="appendix-B">
      <h2 id="name-support-levels-for-realm-cr">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-support-levels-for-realm-cr" class="section-name selfRef">Support Levels for Realm Crossover</a>
      </h2>
<p id="appendix-B-1">This section is non-normative.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<p id="appendix-B-2">There are a few levels of support at which Realm Crossover for SASL
can be used.  An informal description of these levels can be useful for
communication purposes.<a href="#appendix-B-2" class="pilcrow">¶</a></p>
<p id="appendix-B-3">Level 0 constitutes the normal mode with local SASL authentication.
This works well when clients are treated as local users of the foreign
server.  Authentication is therefore carried out on the foreign server.<a href="#appendix-B-3" class="pilcrow">¶</a></p>
<p id="appendix-B-4">Level 1/2 relays SASL authentication tokens to a statically configured
backend, perhaps specific for a host name or resource path.  The client 
is treated as a user of the statically configured backend, which may
serve their own domain.  This setup can be used for virtual hosting of
a service without the need to hold authentication data.<a href="#appendix-B-4" class="pilcrow">¶</a></p>
<p id="appendix-B-5">Level 1 supports SASL mechanisms for Realm Crossover like SXOVER-PLUS
and relays the SASL information to the DOMAIN embedded in the first SASL
token.  In this case, clients can present their own identity regardless
of configuration on the foreign server; the foreign server welcomes a
user to Bring Your Own IDentity.<a href="#appendix-B-5" class="pilcrow">¶</a></p>
<p id="appendix-B-6">The Diameter formalisms are required for level 1/2 and level 1, but
are an internal choice at level 0.  In all cases, the Quick-DiaSASL
definition in <a href="#app.diasasl" class="xref">Appendix A</a> may be used to locally
concentrate SASL authentication; the receiving end may be a local
SASL identity provider for level 0 and would be a local Diameter node
in level 1/2 and level 1.<a href="#appendix-B-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ack">
<section id="appendix-C">
      <h2 id="name-acknowledgements">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-C-1">Thanks to Nico Williams for input on the GS2 bridge and Channel Binding.<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">Thanks to NLNet and the NGI Pointer project of the European Union for
each funding parts of this work.<a href="#appendix-C-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-D">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rick van Rein</span></div>
<div dir="auto" class="left"><span class="org">OpenFortress BV</span></div>
<div dir="auto" class="left"><span class="street-address">Haarlebrink 5</span></div>
<div dir="auto" class="left"><span class="locality">Enschede</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rick@openfortress.nl" class="email">rick@openfortress.nl</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Henri Manson</span></div>
<div dir="auto" class="left"><span class="org">Mansoft</span></div>
<div dir="auto" class="left"><span class="street-address">Castorstraat 30</span></div>
<div dir="auto" class="left"><span class="locality">Enschede</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:info@mansoft.nl" class="email">info@mansoft.nl</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
