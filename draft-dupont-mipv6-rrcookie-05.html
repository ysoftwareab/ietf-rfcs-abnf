<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Care-of Address Test for MIPv6 using a State Cookie</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Care-of Address Test for MIPv6 using a State Cookie">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">F. Dupont</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">ISC</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">J-M. Combes</td></tr>
<tr><td class="header">Expires: May 16, 2008</td><td class="header">Orange Labs/France Telecom R&amp;D</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">November 13, 2007</td></tr>
</table></td></tr></table>
<h1><br />Care-of Address Test for MIPv6 using a State Cookie<br />draft-dupont-mipv6-rrcookie-05.txt</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 16, 2008.</p>

<h3>Abstract</h3>

<p>
            This document defines a procedure which performs a
            "care-of address test" using a state cookie for
            routing optimization in Mobile IPv6 not protected
            by the routing routability procedure, i.e., protected
            by some alternative mechanisms like pre-shared secret or
            pre-established IPsec security associations.
            
</p>
<a name="intro"></a><br /><hr />
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> 
    The Mobile IPv6 specifications <a class='info' href='#RFC3775'>[RFC3775]<span> (</span><span class='info'>Johnson, D., Perkins, C., and J. Arkko, &ldquo;Mobility Support in IPv6,&rdquo; June&nbsp;2004.</span><span>)</span></a> defines
    a default protection for routing optimization, the routing
    routability procedure, which includes an explicit "care-of
    address test". Alternative protection mechanisms like pre-shared
    secret <a class='info' href='#RFC4449'>[RFC4449]<span> (</span><span class='info'>Perkins, C., &ldquo;Securing Mobile IPv6 Route Optimization Using a 		    Static Shared Key,&rdquo; June&nbsp;2006.</span><span>)</span></a> or pre-established IPsec
    security associations <a class='info' href='#CNIPsec'>[CNIPsec]<span> (</span><span class='info'>Dupont, F. and J-M. Combes, &ldquo;Using IPsec between Mobile and Correspondent IPv6 Nodes,&rdquo; November&nbsp;2007.</span><span>)</span></a> are more
    efficient and secure but require in some cases a care-of
    address test to avoid a "3rd party bombing" vulnerability.
    
</p>
<p>
    This document proposes a care-of address test procedure at
    the initiative of the correspondent node using a state
    cookie as in SCTP <a class='info' href='#RFC4960'>[RFC4960]<span> (</span><span class='info'>Stewart, R., Ed., &ldquo;Stream Control Transmission Protocol,&rdquo; September&nbsp;2007.</span><span>)</span></a> or IKEv2 <a class='info' href='#RFC4306'>[RFC4306]<span> (</span><span class='info'>Kaufman, C., Ed., &ldquo;Internet Key Exchange (IKEv2) Protocol,&rdquo; December&nbsp;2005.</span><span>)</span></a>.
    
</p>
<a name="term"></a><br /><hr />
<a name="rfc.section.2"></a><h3>2.&nbsp;
Keywords</h3>

<p>
    The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
    "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
    document are to be interpreted as described in
    <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
    
</p>
<a name="main"></a><br /><hr />
<a name="rfc.section.3"></a><h3>3.&nbsp;
A signaling extension for a care-of
    address test using a state cookie</h3>

<a name="app"></a><br /><hr />
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Applicability</h3>

<p>     
     The care-of address test procedure defined by this document
     MAY be used in order to check whether the
     mobile node can really receive packets sent to the care-of address
     of a new binding update. It SHOULD NOT be used for entry deletion,
     i.e., when the care-of address is the home address. It MUST be used
     for real alternate care-of address, i.e., when the address carried
     by an alternate care-of address option is not the source address
     of the IP header nor the home address of the mobile node (following
     the recommendation of <a class='info' href='#bombing'>[bombing]<span> (</span><span class='info'>Dupont, F., &ldquo;A note about 3rd party bombing in Mobile IPv6,&rdquo; January&nbsp;2007.</span><span>)</span></a>).
     
</p>
<a name="proto"></a><br /><hr />
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Protocol</h3>

<p>
     The procedure is based on the state cookie idea of SCTP 
     <a class='info' href='#RFC4960'>[RFC4960]<span> (</span><span class='info'>Stewart, R., Ed., &ldquo;Stream Control Transmission Protocol,&rdquo; September&nbsp;2007.</span><span>)</span></a> which can be found again in IKEv2
     <a class='info' href='#RFC4306'>[RFC4306]<span> (</span><span class='info'>Kaufman, C., Ed., &ldquo;Internet Key Exchange (IKEv2) Protocol,&rdquo; December&nbsp;2005.</span><span>)</span></a>. The binding update is
     in a first time (1) rejected by a binding acknowledgment with a
     transient error or a
     new dedicated status, and a cookie option sent to the tested care-of
     address. Upon the reception (2) of this binding acknowledgment,
     the mobile node retransmits (3) the binding update with the exact
     received cookie placed in a cookie option. When the correspondent
     node receives (4) the augmented binding update, it can check by
     recomputing the cookie and comparing it to the cookie option data that
     the binding update is from the same mobile node and for the same
     care-of address (so it can infer the mobile node is reachable at
     this care-of address, i.e., a "care-of address test" has been
     successfully performed).
     
</p>
<p>
     The cookie MUST reflect the mobile node identity or the binding
     cache entry or an equivalent, and MUST reflect the tested care-of
     address. It MUST NOT be easy to infer by the mobile node, including
     with the knowledge of previous cookies from the same node.
     
</p>
<p>
     The last point is what to do waiting the retransmitted and augmented
     binding update. Possibilities are:
     </p>
<ul class="text">
<li>apply the binding update with the new care-of address. It
       defeats the purpose of the care-of address test so it SHOULD NOT
       be done, and it MUST NOT be done for a real alternate care-of
       address.
</li>
<li>keep the previous care-of address. As it is not possible to know
       whether the previous care-of address is still usable, i.e., whether
       the mobile node is still reachable at this previous care-of
       address, the default policy SHOULD NOT be to keep the previous
       care-of address. The correspondent node MAY keep the previous
       care-of address in special cases where this is known to be
       the best solution.
</li>
<li>temporarily disable the binding cache entry, i.e., by using
       the home address for communication to the mobile node until
       another binding update is received. This SHOULD be the default
       policy.
</li>
</ul><p>
     
</p>
<a name="mn"></a><br /><hr />
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Mobile Node Requirement</h3>

<p>
     There is only one requirement for mobile nodes: a mobile node
     MUST include in retries a copy of the cookie option carried by
     a binding acknowledgment signaling a transient error (examples
     of such a transient error is of course the new status or a
     sequence number out of window).
     
</p>
<a name="cookie"></a><br /><hr />
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Cookie Generation Example</h3>

<p>
     This method assumes a global secret key is available and
     uses in sequence:
     </p>
<ul class="text">
<li>a 16 bit timestamp of when the cookie is created
</li>
<li>the tested care-of address
</li>
<li>the truncated HMAC <a class='info' href='#RFC2104'>[RFC2104]<span> (</span><span class='info'>Krawczyk, H., Bellare, M., and R. Canetti, &ldquo;HMAC: Keyed-Hashing for Message Authentication,&rdquo; March&nbsp;1997.</span><span>)</span></a>,
       keyed by a secret key, of the preceding two fields,
       the home address and the correspondent address.
</li>
</ul><p>   
     The secret key SHOULD be random or pseudo-random and SHOULD be
     changed reasonably frequently. The timestamp MAY be used to
     determine which key was used. The HMAC has to be truncated in
     order to keep the cookie option length less than the maximum,
     the higher 96 bits of the HMAC should be enough.
     
</p>
<a name="acks"></a><br /><hr />
<a name="rfc.section.4"></a><h3>4.&nbsp;
Acknowledgments</h3>

<p>
    This document was extracted from <a class='info' href='#CNIPsec'>[CNIPsec]<span> (</span><span class='info'>Dupont, F. and J-M. Combes, &ldquo;Using IPsec between Mobile and Correspondent IPv6 Nodes,&rdquo; November&nbsp;2007.</span><span>)</span></a> because
    what it provides is needed by any alternative to the return
    routability procedure which has no built-in care-of address test.
    
</p>
<a name="seccons"></a><br /><hr />
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>
    Without a test of the care-of address or an other way to trust it,
    the care-of address presented by the mobile
    node can be a fake one and offers a 3rd party bombing attack.
    
</p>
<p>
    Binding updates and acknowledgments are validated using an
    alternative protection mechanisms so they can't be injected
    by third parties. The cookie sub-option is small enough to make
    this procedure a poor candidate for a third party bombing mechanism.
    
</p>
<a name="iana"></a><br /><hr />
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
    This document requires:
    </p>
<ul class="text">
<li>a new status for binding acknowledgment.
</li>
<li>a new option for mobility messages used in binding update
     and acknowledgment messages.
</li>
</ul><p>
    
</p>
<a name="rfc.references"></a><br /><hr />
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<h3>7.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2104">[RFC2104]</a></td>
<td class="author-text">Krawczyk, H., Bellare, M., and R. Canetti, &ldquo;<a href="http://tools.ietf.org/html/rfc2104">HMAC: Keyed-Hashing for Message Authentication</a>,&rdquo; RFC&nbsp;2104, March&nbsp;1997 (<a href="http://www.ietf.org/rfc/rfc2104.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; RFC&nbsp;2119, BCP&nbsp;14, March&nbsp;1997 (<a href="http://www.ietf.org/rfc/rfc2119.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3775">[RFC3775]</a></td>
<td class="author-text">Johnson, D., Perkins, C., and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc3775">Mobility Support in IPv6</a>,&rdquo; RFC&nbsp;3775, June&nbsp;2004 (<a href="http://www.ietf.org/rfc/rfc3775.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<h3>7.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CNIPsec">[CNIPsec]</a></td>
<td class="author-text">Dupont, F. and J-M. Combes, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mip6-cn-ipsec-06.txt.txt">Using IPsec between Mobile and Correspondent IPv6 Nodes</a>,&rdquo; draft-ietf-mip6-cn-ipsec-06.txt (work in progress), November&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mip6-cn-ipsec-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4306">[RFC4306]</a></td>
<td class="author-text">Kaufman, C., Ed., &ldquo;<a href="http://tools.ietf.org/html/rfc4306">Internet Key Exchange (IKEv2) Protocol</a>,&rdquo; RFC&nbsp;4306, December&nbsp;2005 (<a href="http://www.ietf.org/ref/rfc4306.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4449">[RFC4449]</a></td>
<td class="author-text">Perkins, C., &ldquo;<a href="http://tools.ietf.org/html/rfc4449">Securing Mobile IPv6 Route Optimization Using a
		    Static Shared Key</a>,&rdquo; RFC&nbsp;4449, June&nbsp;2006 (<a href="http://www.ietf.org/rfc/rfc4449.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4960">[RFC4960]</a></td>
<td class="author-text">Stewart, R., Ed., &ldquo;<a href="http://tools.ietf.org/html/rfc4960">Stream Control Transmission Protocol</a>,&rdquo; RFC&nbsp;4960, September&nbsp;2007 (<a href="http://www.ietf.org/rfc/rfc4960.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="bombing">[bombing]</a></td>
<td class="author-text">Dupont, F., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-dupont-mipv6-3bombing-05.txt.txt">A note about 3rd party bombing in Mobile IPv6</a>,&rdquo; draft-dupont-mipv6-3bombing-05.txt (work in progress), January&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-dupont-mipv6-3bombing-05.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Francis Dupont</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">ISC</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Francis.Dupont@fdupont.fr">Francis.Dupont@fdupont.fr</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jean-Michel Combes</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Orange Labs/France Telecom R&amp;D</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">38 rue du General Leclerc</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">92794 Issy-les-Moulineaux Cedex 9</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jeanmichel.combes@gmail.com">jeanmichel.combes@gmail.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2007).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
