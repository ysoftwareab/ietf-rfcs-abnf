<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Using TLS to Secure QUIC</title>
<meta content="Martin Thomson" name="author">
<meta content="Sean Turner" name="author">
<meta content="
       This document describes how Transport Layer Security (TLS) is used to secure
QUIC. 
    " name="description">
<meta content="xml2rfc 2.40.0" name="generator">
<meta content="draft-ietf-quic-tls-27" name="ietf.draft">
<link href="/tmp/draft-ietf-quic-tls-27-gVL3yv.xml" type="application/rfc+xml" rel="alternate">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Avoid wrapping of URLs in references */
@media screen {
  .references a {
    white-space: nowrap;
  }
}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin: 0 0 0.25em 0;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/*
  The margin-left: 0 on <dd> removes all distinction
  between levels from nested <dl>s.  Undo that.
*/
dl.olPercent > dd,
dd {
  margin-left: revert;
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
</style>
<link href="rfc-local.css" type="text/css" rel="stylesheet">
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Using TLS to Secure QUIC</td>
<td class="right">February 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Thomson &amp; Turner</td>
<td class="center">Expires 24 August 2020</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">QUIC</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-quic-tls-27</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-02-21" class="published">21 February 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2020-08-24">24 August 2020</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Thomson, <span class="editor">Ed.</span>
</div>
<div class="org">Mozilla</div>
</div>
<div class="author">
      <div class="author-name">S. Turner, <span class="editor">Ed.</span>
</div>
<div class="org">sn3rd</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Using TLS to Secure QUIC</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes how Transport Layer Security (TLS) is used to secure
QUIC.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note" id="section-note.1">
      <h2 id="name-note-to-readers">
<a href="#name-note-to-readers" class="section-name selfRef">Note to Readers</a>
      </h2>
<p id="section-note.1-1">Discussion of this draft takes place on the QUIC working group mailing list
(quic@ietf.org), which is archived at
<a href="https://mailarchive.ietf.org/arch/search/?email_list=quic">https://mailarchive.ietf.org/arch/search/?email_list=quic</a>.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Working Group information can be found at <a href="https://github.com/quicwg">https://github.com/quicwg</a>; source
code and issues list for this draft can be found at
<a href="https://github.com/quicwg/base-drafts/labels/-tls">https://github.com/quicwg/base-drafts/labels/-tls</a>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 24 August 2020.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-notational-conventions" class="xref">Notational Conventions</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-tls-overview" class="xref">TLS Overview</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-protocol-overview" class="xref">Protocol Overview</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-carrying-tls-messages" class="xref">Carrying TLS Messages</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-interface-to-tls" class="xref">Interface to TLS</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-handshake-complete" class="xref">Handshake Complete</a><a href="#section-toc.1-1.4.2.1.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-handshake-confirmed" class="xref">Handshake Confirmed</a><a href="#section-toc.1-1.4.2.1.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1.2.3">
                    <p id="section-toc.1-1.4.2.1.2.3.1"><a href="#section-4.1.3" class="xref">4.1.3</a>.  <a href="#name-sending-and-receiving-hands" class="xref">Sending and Receiving Handshake Messages</a><a href="#section-toc.1-1.4.2.1.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1.2.4">
                    <p id="section-toc.1-1.4.2.1.2.4.1"><a href="#section-4.1.4" class="xref">4.1.4</a>.  <a href="#name-encryption-level-changes" class="xref">Encryption Level Changes</a><a href="#section-toc.1-1.4.2.1.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1.2.5">
                    <p id="section-toc.1-1.4.2.1.2.5.1"><a href="#section-4.1.5" class="xref">4.1.5</a>.  <a href="#name-tls-interface-summary" class="xref">TLS Interface Summary</a><a href="#section-toc.1-1.4.2.1.2.5.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-tls-version" class="xref">TLS Version</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-clienthello-size" class="xref">ClientHello Size</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-peer-authentication" class="xref">Peer Authentication</a><a href="#section-toc.1-1.4.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-enabling-0-rtt" class="xref">Enabling 0-RTT</a><a href="#section-toc.1-1.4.2.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="xref">4.6</a>.  <a href="#name-accepting-and-rejecting-0-r" class="xref">Accepting and Rejecting 0-RTT</a><a href="#section-toc.1-1.4.2.6.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="xref">4.7</a>.  <a href="#name-validating-0-rtt-configurat" class="xref">Validating 0-RTT Configuration</a><a href="#section-toc.1-1.4.2.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="xref">4.8</a>.  <a href="#name-helloretryrequest" class="xref">HelloRetryRequest</a><a href="#section-toc.1-1.4.2.8.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.9">
                <p id="section-toc.1-1.4.2.9.1"><a href="#section-4.9" class="xref">4.9</a>.  <a href="#name-tls-errors" class="xref">TLS Errors</a><a href="#section-toc.1-1.4.2.9.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.10">
                <p id="section-toc.1-1.4.2.10.1"><a href="#section-4.10" class="xref">4.10</a>. <a href="#name-discarding-unused-keys" class="xref">Discarding Unused Keys</a><a href="#section-toc.1-1.4.2.10.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.10.2.1">
                    <p id="section-toc.1-1.4.2.10.2.1.1"><a href="#section-4.10.1" class="xref">4.10.1</a>.  <a href="#name-discarding-initial-keys" class="xref">Discarding Initial Keys</a><a href="#section-toc.1-1.4.2.10.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.10.2.2">
                    <p id="section-toc.1-1.4.2.10.2.2.1"><a href="#section-4.10.2" class="xref">4.10.2</a>.  <a href="#name-discarding-handshake-keys" class="xref">Discarding Handshake Keys</a><a href="#section-toc.1-1.4.2.10.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.10.2.3">
                    <p id="section-toc.1-1.4.2.10.2.3.1"><a href="#section-4.10.3" class="xref">4.10.3</a>.  <a href="#name-discarding-0-rtt-keys" class="xref">Discarding 0-RTT Keys</a><a href="#section-toc.1-1.4.2.10.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-packet-protection" class="xref">Packet Protection</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-packet-protection-keys" class="xref">Packet Protection Keys</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-initial-secrets" class="xref">Initial Secrets</a><a href="#section-toc.1-1.5.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-aead-usage" class="xref">AEAD Usage</a><a href="#section-toc.1-1.5.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-header-protection" class="xref">Header Protection</a><a href="#section-toc.1-1.5.2.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.5.2.4.2.1">
                    <p id="section-toc.1-1.5.2.4.2.1.1"><a href="#section-5.4.1" class="xref">5.4.1</a>.  <a href="#name-header-protection-applicati" class="xref">Header Protection Application</a><a href="#section-toc.1-1.5.2.4.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.4.2.2">
                    <p id="section-toc.1-1.5.2.4.2.2.1"><a href="#section-5.4.2" class="xref">5.4.2</a>.  <a href="#name-header-protection-sample" class="xref">Header Protection Sample</a><a href="#section-toc.1-1.5.2.4.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.4.2.3">
                    <p id="section-toc.1-1.5.2.4.2.3.1"><a href="#section-5.4.3" class="xref">5.4.3</a>.  <a href="#name-aes-based-header-protection" class="xref">AES-Based Header Protection</a><a href="#section-toc.1-1.5.2.4.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.4.2.4">
                    <p id="section-toc.1-1.5.2.4.2.4.1"><a href="#section-5.4.4" class="xref">5.4.4</a>.  <a href="#name-chacha20-based-header-prote" class="xref">ChaCha20-Based Header Protection</a><a href="#section-toc.1-1.5.2.4.2.4.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="xref">5.5</a>.  <a href="#name-receiving-protected-packets" class="xref">Receiving Protected Packets</a><a href="#section-toc.1-1.5.2.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="xref">5.6</a>.  <a href="#name-use-of-0-rtt-keys" class="xref">Use of 0-RTT Keys</a><a href="#section-toc.1-1.5.2.6.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.7">
                <p id="section-toc.1-1.5.2.7.1"><a href="#section-5.7" class="xref">5.7</a>.  <a href="#name-receiving-out-of-order-prot" class="xref">Receiving Out-of-Order Protected Frames</a><a href="#section-toc.1-1.5.2.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5.2.8">
                <p id="section-toc.1-1.5.2.8.1"><a href="#section-5.8" class="xref">5.8</a>.  <a href="#name-retry-packet-integrity" class="xref">Retry Packet Integrity</a><a href="#section-toc.1-1.5.2.8.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-key-update" class="xref">Key Update</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-initiating-a-key-update" class="xref">Initiating a Key Update</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-responding-to-a-key-update" class="xref">Responding to a Key Update</a><a href="#section-toc.1-1.6.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-timing-of-receive-key-gener" class="xref">Timing of Receive Key Generation</a><a href="#section-toc.1-1.6.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-sending-with-updated-keys" class="xref">Sending with Updated Keys</a><a href="#section-toc.1-1.6.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="xref">6.5</a>.  <a href="#name-receiving-with-different-ke" class="xref">Receiving with Different Keys</a><a href="#section-toc.1-1.6.2.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="xref">6.6</a>.  <a href="#name-key-update-frequency" class="xref">Key Update Frequency</a><a href="#section-toc.1-1.6.2.6.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6.2.7">
                <p id="section-toc.1-1.6.2.7.1"><a href="#section-6.7" class="xref">6.7</a>.  <a href="#name-key-update-error-code" class="xref">Key Update Error Code</a><a href="#section-toc.1-1.6.2.7.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-of-initial-message" class="xref">Security of Initial Messages</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-quic-specific-additions-to-" class="xref">QUIC-Specific Additions to the TLS Handshake</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-protocol-negotiation" class="xref">Protocol Negotiation</a><a href="#section-toc.1-1.8.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-quic-transport-parameters-e" class="xref">QUIC Transport Parameters Extension</a><a href="#section-toc.1-1.8.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-removing-the-endofearlydata" class="xref">Removing the EndOfEarlyData Message</a><a href="#section-toc.1-1.8.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-replay-attacks-with-0-rtt" class="xref">Replay Attacks with 0-RTT</a><a href="#section-toc.1-1.9.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-packet-reflection-attack-mi" class="xref">Packet Reflection Attack Mitigation</a><a href="#section-toc.1-1.9.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="xref">9.3</a>.  <a href="#name-header-protection-analysis" class="xref">Header Protection Analysis</a><a href="#section-toc.1-1.9.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="xref">9.4</a>.  <a href="#name-header-protection-timing-si" class="xref">Header Protection Timing Side-Channels</a><a href="#section-toc.1-1.9.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="xref">9.5</a>.  <a href="#name-key-diversity" class="xref">Key Diversity</a><a href="#section-toc.1-1.9.2.5.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.11.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.11.2.2.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-sample-packet-protection" class="xref">Sample Packet Protection</a><a href="#section-toc.1-1.12.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-a.1" class="xref">A.1</a>.  <a href="#name-keys" class="xref">Keys</a><a href="#section-toc.1-1.12.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-a.2" class="xref">A.2</a>.  <a href="#name-client-initial" class="xref">Client Initial</a><a href="#section-toc.1-1.12.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#section-a.3" class="xref">A.3</a>.  <a href="#name-server-initial" class="xref">Server Initial</a><a href="#section-toc.1-1.12.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.12.2.4">
                <p id="section-toc.1-1.12.2.4.1"><a href="#section-a.4" class="xref">A.4</a>.  <a href="#name-retry" class="xref">Retry</a><a href="#section-toc.1-1.12.2.4.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-appendix.b" class="xref">Appendix B</a>.  <a href="#name-change-log" class="xref">Change Log</a><a href="#section-toc.1-1.13.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-b.1" class="xref">B.1</a>.  <a href="#name-since-draft-ietf-quic-tls-2" class="xref">Since draft-ietf-quic-tls-26</a><a href="#section-toc.1-1.13.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-b.2" class="xref">B.2</a>.  <a href="#name-since-draft-ietf-quic-tls-25" class="xref">Since draft-ietf-quic-tls-25</a><a href="#section-toc.1-1.13.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.3">
                <p id="section-toc.1-1.13.2.3.1"><a href="#section-b.3" class="xref">B.3</a>.  <a href="#name-since-draft-ietf-quic-tls-24" class="xref">Since draft-ietf-quic-tls-24</a><a href="#section-toc.1-1.13.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.4">
                <p id="section-toc.1-1.13.2.4.1"><a href="#section-b.4" class="xref">B.4</a>.  <a href="#name-since-draft-ietf-quic-tls-23" class="xref">Since draft-ietf-quic-tls-23</a><a href="#section-toc.1-1.13.2.4.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.5">
                <p id="section-toc.1-1.13.2.5.1"><a href="#section-b.5" class="xref">B.5</a>.  <a href="#name-since-draft-ietf-quic-tls-22" class="xref">Since draft-ietf-quic-tls-22</a><a href="#section-toc.1-1.13.2.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.6">
                <p id="section-toc.1-1.13.2.6.1"><a href="#section-b.6" class="xref">B.6</a>.  <a href="#name-since-draft-ietf-quic-tls-21" class="xref">Since draft-ietf-quic-tls-21</a><a href="#section-toc.1-1.13.2.6.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.7">
                <p id="section-toc.1-1.13.2.7.1"><a href="#section-b.7" class="xref">B.7</a>.  <a href="#name-since-draft-ietf-quic-tls-20" class="xref">Since draft-ietf-quic-tls-20</a><a href="#section-toc.1-1.13.2.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.8">
                <p id="section-toc.1-1.13.2.8.1"><a href="#section-b.8" class="xref">B.8</a>.  <a href="#name-since-draft-ietf-quic-tls-1" class="xref">Since draft-ietf-quic-tls-18</a><a href="#section-toc.1-1.13.2.8.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.9">
                <p id="section-toc.1-1.13.2.9.1"><a href="#section-b.9" class="xref">B.9</a>.  <a href="#name-since-draft-ietf-quic-tls-17" class="xref">Since draft-ietf-quic-tls-17</a><a href="#section-toc.1-1.13.2.9.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.10">
                <p id="section-toc.1-1.13.2.10.1"><a href="#section-b.10" class="xref">B.10</a>. <a href="#name-since-draft-ietf-quic-tls-14" class="xref">Since draft-ietf-quic-tls-14</a><a href="#section-toc.1-1.13.2.10.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.11">
                <p id="section-toc.1-1.13.2.11.1"><a href="#section-b.11" class="xref">B.11</a>. <a href="#name-since-draft-ietf-quic-tls-13" class="xref">Since draft-ietf-quic-tls-13</a><a href="#section-toc.1-1.13.2.11.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.12">
                <p id="section-toc.1-1.13.2.12.1"><a href="#section-b.12" class="xref">B.12</a>. <a href="#name-since-draft-ietf-quic-tls-12" class="xref">Since draft-ietf-quic-tls-12</a><a href="#section-toc.1-1.13.2.12.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.13">
                <p id="section-toc.1-1.13.2.13.1"><a href="#section-b.13" class="xref">B.13</a>. <a href="#name-since-draft-ietf-quic-tls-11" class="xref">Since draft-ietf-quic-tls-11</a><a href="#section-toc.1-1.13.2.13.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.14">
                <p id="section-toc.1-1.13.2.14.1"><a href="#section-b.14" class="xref">B.14</a>. <a href="#name-since-draft-ietf-quic-tls-10" class="xref">Since draft-ietf-quic-tls-10</a><a href="#section-toc.1-1.13.2.14.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.15">
                <p id="section-toc.1-1.13.2.15.1"><a href="#section-b.15" class="xref">B.15</a>. <a href="#name-since-draft-ietf-quic-tls-0" class="xref">Since draft-ietf-quic-tls-09</a><a href="#section-toc.1-1.13.2.15.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.16">
                <p id="section-toc.1-1.13.2.16.1"><a href="#section-b.16" class="xref">B.16</a>. <a href="#name-since-draft-ietf-quic-tls-08" class="xref">Since draft-ietf-quic-tls-08</a><a href="#section-toc.1-1.13.2.16.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.17">
                <p id="section-toc.1-1.13.2.17.1"><a href="#section-b.17" class="xref">B.17</a>. <a href="#name-since-draft-ietf-quic-tls-07" class="xref">Since draft-ietf-quic-tls-07</a><a href="#section-toc.1-1.13.2.17.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.18">
                <p id="section-toc.1-1.13.2.18.1"><a href="#section-b.18" class="xref">B.18</a>. <a href="#name-since-draft-ietf-quic-tls-05" class="xref">Since draft-ietf-quic-tls-05</a><a href="#section-toc.1-1.13.2.18.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.19">
                <p id="section-toc.1-1.13.2.19.1"><a href="#section-b.19" class="xref">B.19</a>. <a href="#name-since-draft-ietf-quic-tls-04" class="xref">Since draft-ietf-quic-tls-04</a><a href="#section-toc.1-1.13.2.19.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.20">
                <p id="section-toc.1-1.13.2.20.1"><a href="#section-b.20" class="xref">B.20</a>. <a href="#name-since-draft-ietf-quic-tls-03" class="xref">Since draft-ietf-quic-tls-03</a><a href="#section-toc.1-1.13.2.20.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.21">
                <p id="section-toc.1-1.13.2.21.1"><a href="#section-b.21" class="xref">B.21</a>. <a href="#name-since-draft-ietf-quic-tls-02" class="xref">Since draft-ietf-quic-tls-02</a><a href="#section-toc.1-1.13.2.21.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.22">
                <p id="section-toc.1-1.13.2.22.1"><a href="#section-b.22" class="xref">B.22</a>. <a href="#name-since-draft-ietf-quic-tls-01" class="xref">Since draft-ietf-quic-tls-01</a><a href="#section-toc.1-1.13.2.22.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.23">
                <p id="section-toc.1-1.13.2.23.1"><a href="#section-b.23" class="xref">B.23</a>. <a href="#name-since-draft-ietf-quic-tls-00" class="xref">Since draft-ietf-quic-tls-00</a><a href="#section-toc.1-1.13.2.23.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.13.2.24">
                <p id="section-toc.1-1.13.2.24.1"><a href="#section-b.24" class="xref">B.24</a>. <a href="#name-since-draft-thomson-quic-tl" class="xref">Since draft-thomson-quic-tls-01</a><a href="#section-toc.1-1.13.2.24.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-appendix.c" class="xref"></a><a href="#name-contributors" class="xref">Contributors</a><a href="#section-toc.1-1.14.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-appendix.d" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.15.1" class="pilcrow">¶</a></p>
</li>
</ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document describes how QUIC <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> is secured using TLS
<span>[<a href="#TLS13" class="xref">TLS13</a>]</span>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">TLS 1.3 provides critical latency improvements for connection establishment over
previous versions.  Absent packet loss, most new connections can be established
and secured within a single round trip; on subsequent connections between the
same client and server, the client can often send application data immediately,
that is, using a zero round trip setup.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document describes how TLS acts as a security component of QUIC.<a href="#section-1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="notational-conventions">
<section id="section-2">
      <h2 id="name-notational-conventions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-notational-conventions" class="section-name selfRef">Notational Conventions</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span>
when, and only when, they appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">This document uses the terminology established in <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">For brevity, the acronym TLS is used to refer to TLS 1.3, though a newer version
could be used (see <a href="#tls-version" class="xref">Section 4.2</a>).<a href="#section-2-3" class="pilcrow">¶</a></p>
<div id="tls-overview">
<section id="section-2.1">
        <h3 id="name-tls-overview">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-tls-overview" class="section-name selfRef">TLS Overview</a>
        </h3>
<p id="section-2.1-1">TLS provides two endpoints with a way to establish a means of communication over
an untrusted medium (that is, the Internet) that ensures that messages they
exchange cannot be observed, modified, or forged.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Internally, TLS is a layered protocol, with the structure shown in
<a href="#tls-layers" class="xref">Figure 1</a>.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<span id="name-tls-layers"></span><div id="tls-layers">
<figure id="figure-1">
          <div class="artwork art-text alignLeft" id="section-2.1-3.1">
<pre>
          +-------------+------------+--------------+---------+
Handshake |             |            |  Application |         |
Layer     |  Handshake  |   Alerts   |     Data     |   ...   |
          |             |            |              |         |
          +-------------+------------+--------------+---------+
Record    |                                                   |
Layer     |                      Records                      |
          |                                                   |
          +---------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-tls-layers" class="selfRef">TLS Layers</a>
          </figcaption></figure>
</div>
<p id="section-2.1-4">Each Handshake layer message (e.g., Handshake, Alerts, and Application Data) is
carried as a series of typed TLS records by the Record layer.  Records are
individually cryptographically protected and then transmitted over a reliable
transport (typically TCP) which provides sequencing and guaranteed delivery.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5">The TLS authenticated key exchange occurs between two endpoints: client and
server.  The client initiates the exchange and the server responds.  If the key
exchange completes successfully, both client and server will agree on a secret.
TLS supports both pre-shared key (PSK) and Diffie-Hellman over either finite
fields or elliptic curves ((EC)DHE) key exchanges.  PSK is the basis for 0-RTT;
the latter provides perfect forward secrecy (PFS) when the (EC)DHE keys are
destroyed.<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1-6">After completing the TLS handshake, the client will have learned and
authenticated an identity for the server and the server is optionally able to
learn and authenticate an identity for the client.  TLS supports X.509
<span>[<a href="#RFC5280" class="xref">RFC5280</a>]</span> certificate-based authentication for both server and client.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<p id="section-2.1-7">The TLS key exchange is resistant to tampering by attackers and it produces
shared secrets that cannot be controlled by either participating peer.<a href="#section-2.1-7" class="pilcrow">¶</a></p>
<p id="section-2.1-8">TLS provides two basic handshake modes of interest to QUIC:<a href="#section-2.1-8" class="pilcrow">¶</a></p>
<ul>
<li id="section-2.1-9.1">A full 1-RTT handshake in which the client is able to send Application Data
after one round trip and the server immediately responds after receiving the
first handshake message from the client.<a href="#section-2.1-9.1" class="pilcrow">¶</a>
</li>
<li id="section-2.1-9.2">A 0-RTT handshake in which the client uses information it has previously
learned about the server to send Application Data immediately.  This
Application Data can be replayed by an attacker so it MUST NOT carry a
self-contained trigger for any non-idempotent action.<a href="#section-2.1-9.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-2.1-10">A simplified TLS handshake with 0-RTT application data is shown in <a href="#tls-full" class="xref">Figure 2</a>.
Note that this omits the EndOfEarlyData message, which is not used in QUIC (see
<a href="#remove-eoed" class="xref">Section 8.3</a>).  Likewise, neither ChangeCipherSpec nor KeyUpdate messages are
used by QUIC; ChangeCipherSpec is redundant in TLS 1.3 and QUIC has defined its
own key update mechanism <a href="#key-update" class="xref">Section 6</a>.<a href="#section-2.1-10" class="pilcrow">¶</a></p>
<span id="name-tls-handshake-with-0-rtt"></span><div id="tls-full">
<figure id="figure-2">
          <div class="artwork art-text alignLeft" id="section-2.1-11.1">
<pre>
    Client                                             Server

    ClientHello
   (0-RTT Application Data)  --------&gt;
                                                  ServerHello
                                         {EncryptedExtensions}
                                                    {Finished}
                             &lt;--------      [Application Data]
   {Finished}                --------&gt;

   [Application Data]        &lt;-------&gt;      [Application Data]

    () Indicates messages protected by Early Data (0-RTT) Keys
    {} Indicates messages protected using Handshake Keys
    [] Indicates messages protected using Application Data
       (1-RTT) Keys
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-tls-handshake-with-0-rtt" class="selfRef">TLS Handshake with 0-RTT</a>
          </figcaption></figure>
</div>
<p id="section-2.1-12">Data is protected using a number of encryption levels:<a href="#section-2.1-12" class="pilcrow">¶</a></p>
<ul>
<li id="section-2.1-13.1">Initial Keys<a href="#section-2.1-13.1" class="pilcrow">¶</a>
</li>
<li id="section-2.1-13.2">Early Data (0-RTT) Keys<a href="#section-2.1-13.2" class="pilcrow">¶</a>
</li>
<li id="section-2.1-13.3">Handshake Keys<a href="#section-2.1-13.3" class="pilcrow">¶</a>
</li>
<li id="section-2.1-13.4">Application Data (1-RTT) Keys<a href="#section-2.1-13.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-2.1-14">Application Data may appear only in the Early Data and Application Data
levels. Handshake and Alert messages may appear in any level.<a href="#section-2.1-14" class="pilcrow">¶</a></p>
<p id="section-2.1-15">The 0-RTT handshake is only possible if the client and server have previously
communicated.  In the 1-RTT handshake, the client is unable to send protected
Application Data until it has received all of the Handshake messages sent by the
server.<a href="#section-2.1-15" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="protocol-overview">
<section id="section-3">
      <h2 id="name-protocol-overview">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<p id="section-3-1">QUIC <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> assumes responsibility for the confidentiality and
integrity protection of packets.  For this it uses keys derived from a TLS
handshake <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>, but instead of carrying TLS records over QUIC (as with
TCP), TLS Handshake and Alert messages are carried directly over the QUIC
transport, which takes over the responsibilities of the TLS record layer, as
shown in <a href="#quic-layers" class="xref">Figure 3</a>.<a href="#section-3-1" class="pilcrow">¶</a></p>
<span id="name-quic-layers"></span><div id="quic-layers">
<figure id="figure-3">
        <div class="artwork art-text alignLeft" id="section-3-2.1">
<pre>
+--------------+--------------+ +-------------+
|     TLS      |     TLS      | |    QUIC     |
|  Handshake   |    Alerts    | | Applications|
|              |              | |  (h3, etc.) |
+--------------+--------------+-+-------------+
|                                             |
|                QUIC Transport               |
|   (streams, reliability, congestion, etc.)  |
|                                             |
+---------------------------------------------+
|                                             |
|            QUIC Packet Protection           |
|                                             |
+---------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-quic-layers" class="selfRef">QUIC Layers</a>
        </figcaption></figure>
</div>
<p id="section-3-3">QUIC also relies on TLS for authentication and negotiation of parameters that
are critical to security and performance.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">Rather than a strict layering, these two protocols cooperate: QUIC uses the TLS
handshake; TLS uses the reliability, ordered delivery, and record layer provided
by QUIC.<a href="#section-3-4" class="pilcrow">¶</a></p>
<p id="section-3-5">At a high level, there are two main interactions between the TLS and QUIC
components:<a href="#section-3-5" class="pilcrow">¶</a></p>
<ul>
<li id="section-3-6.1">The TLS component sends and receives messages via the QUIC component, with
QUIC providing a reliable stream abstraction to TLS.<a href="#section-3-6.1" class="pilcrow">¶</a>
</li>
<li id="section-3-6.2">The TLS component provides a series of updates to the QUIC component,
including (a) new packet protection keys to install (b) state changes such as
handshake completion, the server certificate, etc.<a href="#section-3-6.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-3-7"><a href="#schematic" class="xref">Figure 4</a> shows these interactions in more detail, with the QUIC packet
protection being called out specially.<a href="#section-3-7" class="pilcrow">¶</a></p>
<span id="name-quic-and-tls-interactions"></span><div id="schematic">
<figure id="figure-4">
        <div class="artwork art-text alignLeft" id="section-3-8.1">
<pre>
+------------+                               +------------+
|            |&lt;---- Handshake Messages -----&gt;|            |
|            |&lt;- Validate 0-RTT parameters -&gt;|            |
|            |&lt;--------- 0-RTT Keys ---------|            |
|    QUIC    |&lt;------- Handshake Keys -------|    TLS     |
|            |&lt;--------- 1-RTT Keys ---------|            |
|            |&lt;------- Handshake Done -------|            |
+------------+                               +------------+
 |         ^
 | Protect | Protected
 v         | Packet
+------------+
|   QUIC     |
|  Packet    |
| Protection |
+------------+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-quic-and-tls-interactions" class="selfRef">QUIC and TLS Interactions</a>
        </figcaption></figure>
</div>
<p id="section-3-9">Unlike TLS over TCP, QUIC applications which want to send data do not send it
through TLS "application_data" records. Rather, they send it as QUIC STREAM
frames or other frame types which are then carried in QUIC packets.<a href="#section-3-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="carrying-tls">
<section id="section-4">
      <h2 id="name-carrying-tls-messages">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-carrying-tls-messages" class="section-name selfRef">Carrying TLS Messages</a>
      </h2>
<p id="section-4-1">QUIC carries TLS handshake data in CRYPTO frames, each of which consists of a
contiguous block of handshake data identified by an offset and length. Those
frames are packaged into QUIC packets and encrypted under the current TLS
encryption level.  As with TLS over TCP, once TLS handshake data has been
delivered to QUIC, it is QUIC's responsibility to deliver it reliably. Each
chunk of data that is produced by TLS is associated with the set of keys that
TLS is currently using.  If QUIC needs to retransmit that data, it MUST use the
same keys even if TLS has already updated to newer keys.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">One important difference between TLS records (used with TCP) and QUIC CRYPTO
frames is that in QUIC multiple frames may appear in the same QUIC packet as
long as they are associated with the same encryption level. For instance, an
implementation might bundle a Handshake message and an ACK for some Handshake
data into the same packet.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">Some frames are prohibited in different encryption levels, others cannot be
sent. The rules here generalize those of TLS, in that frames associated with
establishing the connection can usually appear at any encryption level, whereas
those associated with transferring data can only appear in the 0-RTT and 1-RTT
encryption levels:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-4-4.1">PADDING and PING frames MAY appear in packets of any encryption level.<a href="#section-4-4.1" class="pilcrow">¶</a>
</li>
<li id="section-4-4.2">CRYPTO frames and CONNECTION_CLOSE frames signaling errors at the QUIC layer
(type 0x1c) MAY appear in packets of any encryption level except 0-RTT.<a href="#section-4-4.2" class="pilcrow">¶</a>
</li>
<li id="section-4-4.3">CONNECTION_CLOSE frames signaling application errors (type 0x1d) MUST only be
sent in packets at the 1-RTT encryption level.<a href="#section-4-4.3" class="pilcrow">¶</a>
</li>
<li id="section-4-4.4">ACK frames MAY appear in packets of any encryption level other than 0-RTT, but
can only acknowledge packets which appeared in that packet number space.<a href="#section-4-4.4" class="pilcrow">¶</a>
</li>
<li id="section-4-4.5">All other frame types MUST only be sent in the 0-RTT and 1-RTT levels.<a href="#section-4-4.5" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-4-5">Note that it is not possible to send the following frames in 0-RTT for various
reasons: ACK, CRYPTO, HANDSHAKE_DONE, NEW_TOKEN, PATH_RESPONSE, and
RETIRE_CONNECTION_ID.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">Because packets could be reordered on the wire, QUIC uses the packet type to
indicate which level a given packet was encrypted under, as shown in
<a href="#packet-types-levels" class="xref">Table 1</a>. When multiple packets of different encryption levels
need to be sent, endpoints SHOULD use coalesced packets to send them in the same
UDP datagram.<a href="#section-4-6" class="pilcrow">¶</a></p>
<span id="name-encryption-levels-by-packet"></span><div id="packet-types-levels">
<table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-encryption-levels-by-packet" class="selfRef">Encryption Levels by Packet Type</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Packet Type</th>
            <th class="text-left" rowspan="1" colspan="1">Encryption Level</th>
            <th class="text-left" rowspan="1" colspan="1">PN Space</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Initial</td>
            <td class="text-left" rowspan="1" colspan="1">Initial secrets</td>
            <td class="text-left" rowspan="1" colspan="1">Initial</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">0-RTT Protected</td>
            <td class="text-left" rowspan="1" colspan="1">0-RTT</td>
            <td class="text-left" rowspan="1" colspan="1">0/1-RTT</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Handshake</td>
            <td class="text-left" rowspan="1" colspan="1">Handshake</td>
            <td class="text-left" rowspan="1" colspan="1">Handshake</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Retry</td>
            <td class="text-left" rowspan="1" colspan="1">N/A</td>
            <td class="text-left" rowspan="1" colspan="1">N/A</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Version Negotiation</td>
            <td class="text-left" rowspan="1" colspan="1">N/A</td>
            <td class="text-left" rowspan="1" colspan="1">N/A</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Short Header</td>
            <td class="text-left" rowspan="1" colspan="1">1-RTT</td>
            <td class="text-left" rowspan="1" colspan="1">0/1-RTT</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-4-8">Section 17 of <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> shows how packets at the various encryption
levels fit into the handshake process.<a href="#section-4-8" class="pilcrow">¶</a></p>
<div id="interface-to-tls">
<section id="section-4.1">
        <h3 id="name-interface-to-tls">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-interface-to-tls" class="section-name selfRef">Interface to TLS</a>
        </h3>
<p id="section-4.1-1">As shown in <a href="#schematic" class="xref">Figure 4</a>, the interface from QUIC to TLS consists of four
primary functions:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1-2.1">Sending and receiving handshake messages<a href="#section-4.1-2.1" class="pilcrow">¶</a>
</li>
<li id="section-4.1-2.2">Processing stored transport and application state from a resumed session
and determining if it is valid to accept early data<a href="#section-4.1-2.2" class="pilcrow">¶</a>
</li>
<li id="section-4.1-2.3">Rekeying (both transmit and receive)<a href="#section-4.1-2.3" class="pilcrow">¶</a>
</li>
<li id="section-4.1-2.4">Handshake state updates<a href="#section-4.1-2.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-4.1-3">Additional functions might be needed to configure TLS.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<div id="handshake-complete">
<section id="section-4.1.1">
          <h4 id="name-handshake-complete">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-handshake-complete" class="section-name selfRef">Handshake Complete</a>
          </h4>
<p id="section-4.1.1-1">In this document, the TLS handshake is considered complete when the TLS stack
has reported that the handshake is complete.  This happens when the TLS stack
has both sent a Finished message and verified the peer's Finished message.
Verifying the peer's Finished provides the endpoints with an assurance that
previous handshake messages have not been modified.  Note that the handshake
does not complete at both endpoints simultaneously.  Consequently, any
requirement that is based on the completion of the handshake depends on the
perspective of the endpoint in question.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="handshake-confirmed">
<section id="section-4.1.2">
          <h4 id="name-handshake-confirmed">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-handshake-confirmed" class="section-name selfRef">Handshake Confirmed</a>
          </h4>
<p id="section-4.1.2-1">In this document, the TLS handshake is considered confirmed at the server when
the handshake completes.  At the client, the handshake is considered confirmed
when a HANDSHAKE_DONE frame is received.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
<p id="section-4.1.2-2">A client MAY consider the handshake to be confirmed when it receives an
acknowledgement for a 1-RTT packet.  This can be implemented by recording the
lowest packet number sent with 1-RTT keys, and comparing it to the Largest
Acknowledged field in any received 1-RTT ACK frame: once the latter is greater
than or equal to the former, the handshake is confirmed.<a href="#section-4.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sending-and-receiving-handshake-messages">
<section id="section-4.1.3">
          <h4 id="name-sending-and-receiving-hands">
<a href="#section-4.1.3" class="section-number selfRef">4.1.3. </a><a href="#name-sending-and-receiving-hands" class="section-name selfRef">Sending and Receiving Handshake Messages</a>
          </h4>
<p id="section-4.1.3-1">In order to drive the handshake, TLS depends on being able to send and receive
handshake messages. There are two basic functions on this interface: one where
QUIC requests handshake messages and one where QUIC provides handshake packets.<a href="#section-4.1.3-1" class="pilcrow">¶</a></p>
<p id="section-4.1.3-2">Before starting the handshake QUIC provides TLS with the transport parameters
(see <a href="#quic_parameters" class="xref">Section 8.2</a>) that it wishes to carry.<a href="#section-4.1.3-2" class="pilcrow">¶</a></p>
<p id="section-4.1.3-3">A QUIC client starts TLS by requesting TLS handshake bytes from TLS.  The client
acquires handshake bytes before sending its first packet.  A QUIC server starts
the process by providing TLS with the client's handshake bytes.<a href="#section-4.1.3-3" class="pilcrow">¶</a></p>
<p id="section-4.1.3-4">At any time, the TLS stack at an endpoint will have a current sending encryption
level and receiving encryption level. Each encryption level is associated with a
different flow of bytes, which is reliably transmitted to the peer in CRYPTO
frames. When TLS provides handshake bytes to be sent, they are appended to the
current flow and any packet that includes the CRYPTO frame is protected using
keys from the corresponding encryption level.<a href="#section-4.1.3-4" class="pilcrow">¶</a></p>
<p id="section-4.1.3-5">QUIC takes the unprotected content of TLS handshake records as the content of
CRYPTO frames. TLS record protection is not used by QUIC. QUIC assembles
CRYPTO frames into QUIC packets, which are protected using QUIC packet
protection.<a href="#section-4.1.3-5" class="pilcrow">¶</a></p>
<p id="section-4.1.3-6">QUIC is only capable of conveying TLS handshake records in CRYPTO frames.  TLS
alerts are turned into QUIC CONNECTION_CLOSE error codes; see <a href="#tls-errors" class="xref">Section 4.9</a>.
TLS application data and other message types cannot be carried by QUIC at any
encryption level and is an error if they are received from the TLS stack.<a href="#section-4.1.3-6" class="pilcrow">¶</a></p>
<p id="section-4.1.3-7">When an endpoint receives a QUIC packet containing a CRYPTO frame from the
network, it proceeds as follows:<a href="#section-4.1.3-7" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1.3-8.1">If the packet was in the TLS receiving encryption level, sequence the data
into the input flow as usual. As with STREAM frames, the offset is used to
find the proper location in the data sequence.  If the result of this process
is that new data is available, then it is delivered to TLS in order.<a href="#section-4.1.3-8.1" class="pilcrow">¶</a>
</li>
<li id="section-4.1.3-8.2">If the packet is from a previously installed encryption level, it MUST not
contain data which extends past the end of previously received data in that
flow. Implementations MUST treat any violations of this requirement as a
connection error of type PROTOCOL_VIOLATION.<a href="#section-4.1.3-8.2" class="pilcrow">¶</a>
</li>
<li id="section-4.1.3-8.3">If the packet is from a new encryption level, it is saved for later processing
by TLS.  Once TLS moves to receiving from this encryption level, saved data
can be provided.  When providing data from any new encryption level to TLS, if
there is data from a previous encryption level that TLS has not consumed, this
MUST be treated as a connection error of type PROTOCOL_VIOLATION.<a href="#section-4.1.3-8.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-4.1.3-9">Each time that TLS is provided with new data, new handshake bytes are requested
from TLS.  TLS might not provide any bytes if the handshake messages it has
received are incomplete or it has no data to send.<a href="#section-4.1.3-9" class="pilcrow">¶</a></p>
<p id="section-4.1.3-10">Once the TLS handshake is complete, this is indicated to QUIC along with any
final handshake bytes that TLS needs to send.  TLS also provides QUIC with the
transport parameters that the peer advertised during the handshake.<a href="#section-4.1.3-10" class="pilcrow">¶</a></p>
<p id="section-4.1.3-11">Once the handshake is complete, TLS becomes passive.  TLS can still receive data
from its peer and respond in kind, but it will not need to send more data unless
specifically requested - either by an application or QUIC.  One reason to send
data is that the server might wish to provide additional or updated session
tickets to a client.<a href="#section-4.1.3-11" class="pilcrow">¶</a></p>
<p id="section-4.1.3-12">When the handshake is complete, QUIC only needs to provide TLS with any data
that arrives in CRYPTO streams.  In the same way that is done during the
handshake, new data is requested from TLS after providing received data.<a href="#section-4.1.3-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encryption-level-changes">
<section id="section-4.1.4">
          <h4 id="name-encryption-level-changes">
<a href="#section-4.1.4" class="section-number selfRef">4.1.4. </a><a href="#name-encryption-level-changes" class="section-name selfRef">Encryption Level Changes</a>
          </h4>
<p id="section-4.1.4-1">As keys for new encryption levels become available, TLS provides QUIC with those
keys.  Separately, as keys at a given encryption level become available to TLS,
TLS indicates to QUIC that reading or writing keys at that encryption level are
available.  These events are not asynchronous; they always occur immediately
after TLS is provided with new handshake bytes, or after TLS produces handshake
bytes.<a href="#section-4.1.4-1" class="pilcrow">¶</a></p>
<p id="section-4.1.4-2">TLS provides QUIC with three items as a new encryption level becomes available:<a href="#section-4.1.4-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1.4-3.1">A secret<a href="#section-4.1.4-3.1" class="pilcrow">¶</a>
</li>
<li id="section-4.1.4-3.2">An Authenticated Encryption with Associated Data (AEAD) function<a href="#section-4.1.4-3.2" class="pilcrow">¶</a>
</li>
<li id="section-4.1.4-3.3">A Key Derivation Function (KDF)<a href="#section-4.1.4-3.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-4.1.4-4">These values are based on the values that TLS negotiates and are used by QUIC to
generate packet and header protection keys (see <a href="#packet-protection" class="xref">Section 5</a> and
<a href="#header-protect" class="xref">Section 5.4</a>).<a href="#section-4.1.4-4" class="pilcrow">¶</a></p>
<p id="section-4.1.4-5">If 0-RTT is possible, it is ready after the client sends a TLS ClientHello
message or the server receives that message.  After providing a QUIC client with
the first handshake bytes, the TLS stack might signal the change to 0-RTT
keys. On the server, after receiving handshake bytes that contain a ClientHello
message, a TLS server might signal that 0-RTT keys are available.<a href="#section-4.1.4-5" class="pilcrow">¶</a></p>
<p id="section-4.1.4-6">Although TLS only uses one encryption level at a time, QUIC may use more than
one level. For instance, after sending its Finished message (using a CRYPTO
frame at the Handshake encryption level) an endpoint can send STREAM data (in
1-RTT encryption). If the Finished message is lost, the endpoint uses the
Handshake encryption level to retransmit the lost message.  Reordering or loss
of packets can mean that QUIC will need to handle packets at multiple encryption
levels.  During the handshake, this means potentially handling packets at higher
and lower encryption levels than the current encryption level used by TLS.<a href="#section-4.1.4-6" class="pilcrow">¶</a></p>
<p id="section-4.1.4-7">In particular, server implementations need to be able to read packets at the
Handshake encryption level at the same time as the 0-RTT encryption level.  A
client could interleave ACK frames that are protected with Handshake keys with
0-RTT data and the server needs to process those acknowledgments in order to
detect lost Handshake packets.<a href="#section-4.1.4-7" class="pilcrow">¶</a></p>
<p id="section-4.1.4-8">QUIC also needs access to keys that might not ordinarily be available to a TLS
implementation.  For instance, a client might need to acknowledge Handshake
packets before it is ready to send CRYPTO frames at that encryption level.  TLS
therefore needs to provide keys to QUIC before it might produce them for its own
use.<a href="#section-4.1.4-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tls-interface-summary">
<section id="section-4.1.5">
          <h4 id="name-tls-interface-summary">
<a href="#section-4.1.5" class="section-number selfRef">4.1.5. </a><a href="#name-tls-interface-summary" class="section-name selfRef">TLS Interface Summary</a>
          </h4>
<p id="section-4.1.5-1"><a href="#exchange-summary" class="xref">Figure 5</a> summarizes the exchange between QUIC and TLS for both
client and server. Each arrow is tagged with the encryption level used for that
transmission.<a href="#section-4.1.5-1" class="pilcrow">¶</a></p>
<span id="name-interaction-summary-between"></span><div id="exchange-summary">
<figure id="figure-5">
            <div class="artwork art-text alignLeft" id="section-4.1.5-2.1">
<pre>
Client                                                    Server

Get Handshake
                     Initial -------------&gt;
                                              Handshake Received
Install tx 0-RTT Keys
                     0-RTT ---------------&gt;
                                                   Get Handshake
                     &lt;------------- Initial
Handshake Received
Install Handshake keys
                                           Install rx 0-RTT keys
                                          Install Handshake keys
                                                   Get Handshake
                     &lt;----------- Handshake
Handshake Received
                                           Install tx 1-RTT keys
                     &lt;--------------- 1-RTT
Get Handshake
Handshake Complete
                     Handshake -----------&gt;
                                              Handshake Received
                                           Install rx 1-RTT keys
                                              Handshake Complete
Install 1-RTT keys
                     1-RTT ---------------&gt;
                                                   Get Handshake
                     &lt;--------------- 1-RTT
Handshake Received
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-interaction-summary-between" class="selfRef">Interaction Summary between QUIC and TLS</a>
            </figcaption></figure>
</div>
<p id="section-4.1.5-3"><a href="#exchange-summary" class="xref">Figure 5</a> shows the multiple packets that form a single "flight" of
messages being processed individually, to show what incoming messages trigger
different actions.  New handshake messages are requested after all incoming
packets have been processed.  This process might vary depending on how QUIC
implementations and the packets they receive are structured.<a href="#section-4.1.5-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="tls-version">
<section id="section-4.2">
        <h3 id="name-tls-version">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-tls-version" class="section-name selfRef">TLS Version</a>
        </h3>
<p id="section-4.2-1">This document describes how TLS 1.3 <span>[<a href="#TLS13" class="xref">TLS13</a>]</span> is used with QUIC.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">In practice, the TLS handshake will negotiate a version of TLS to use.  This
could result in a newer version of TLS than 1.3 being negotiated if both
endpoints support that version.  This is acceptable provided that the features
of TLS 1.3 that are used by QUIC are supported by the newer version.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">A badly configured TLS implementation could negotiate TLS 1.2 or another older
version of TLS.  An endpoint MUST terminate the connection if a version of TLS
older than 1.3 is negotiated.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="clienthello-size">
<section id="section-4.3">
        <h3 id="name-clienthello-size">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-clienthello-size" class="section-name selfRef">ClientHello Size</a>
        </h3>
<p id="section-4.3-1">The first Initial packet from a client contains the start or all of its first
cryptographic handshake message, which for TLS is the ClientHello.  Servers
might need to parse the entire ClientHello (e.g., to access extensions such as
Server Name Identification (SNI) or Application Layer Protocol Negotiation
(ALPN)) in order to decide whether to accept the new incoming QUIC connection.
If the ClientHello spans multiple Initial packets, such servers would need to
buffer the first received fragments, which could consume excessive resources if
the client's address has not yet been validated.  To avoid this, servers MAY
use the Retry feature (see Section 8.1 of <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>) to only buffer
partial ClientHello messages from clients with a validated address.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">QUIC packet and framing add at least 36 bytes of overhead to the ClientHello
message.  That overhead increases if the client chooses a connection ID without
zero length.  Overheads also do not include the token or a connection ID longer
than 8 bytes, both of which might be required if a server sends a Retry packet.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">A typical TLS ClientHello can easily fit into a 1200 byte packet.  However, in
addition to the overheads added by QUIC, there are several variables that could
cause this limit to be exceeded.  Large session tickets, multiple or large key
shares, and long lists of supported ciphers, signature algorithms, versions,
QUIC transport parameters, and other negotiable parameters and extensions could
cause this message to grow.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">For servers, in addition to connection IDs and tokens, the size of TLS session
tickets can have an effect on a client's ability to connect efficiently.
Minimizing the size of these values increases the probability that clients can
use them and still fit their ClientHello message in their first Initial packet.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3-5">The TLS implementation does not need to ensure that the ClientHello is
sufficiently large.  QUIC PADDING frames are added to increase the size of the
packet as necessary.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="peer-authentication">
<section id="section-4.4">
        <h3 id="name-peer-authentication">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-peer-authentication" class="section-name selfRef">Peer Authentication</a>
        </h3>
<p id="section-4.4-1">The requirements for authentication depend on the application protocol that is
in use.  TLS provides server authentication and permits the server to request
client authentication.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">A client MUST authenticate the identity of the server.  This typically involves
verification that the identity of the server is included in a certificate and
that the certificate is issued by a trusted entity (see for example
<span>[<a href="#RFC2818" class="xref">RFC2818</a>]</span>).<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">A server MAY request that the client authenticate during the handshake. A server
MAY refuse a connection if the client is unable to authenticate when requested.
The requirements for client authentication vary based on application protocol
and deployment.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">A server MUST NOT use post-handshake client authentication (as defined in
Section 4.6.2 of <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>), because the multiplexing offered by QUIC prevents
clients from correlating the certificate request with the application-level
event that triggered it (see <span>[<a href="#HTTP2-TLS13" class="xref">HTTP2-TLS13</a>]</span>).
More specifically, servers MUST NOT send post-handshake TLS CertificateRequest
messages and clients MUST treat receipt of such messages as a connection error
of type PROTOCOL_VIOLATION.<a href="#section-4.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="enable-0rtt">
<section id="section-4.5">
        <h3 id="name-enabling-0-rtt">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-enabling-0-rtt" class="section-name selfRef">Enabling 0-RTT</a>
        </h3>
<p id="section-4.5-1">To communicate their willingness to process 0-RTT data, servers send a
NewSessionTicket message that contains the "early_data" extension with a
max_early_data_size of 0xffffffff; the amount of data which the client can send
in 0-RTT is controlled by the "initial_max_data" transport parameter supplied
by the server.  Servers MUST NOT send the "early_data" extension with a
max_early_data_size set to any value other than 0xffffffff.  A client MUST
treat receipt of a NewSessionTicket that contains an "early_data" extension
with any other value as a connection error of type PROTOCOL_VIOLATION.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">A client that wishes to send 0-RTT packets uses the "early_data" extension in
the ClientHello message of a subsequent handshake (see Section 4.2.10 of
<span>[<a href="#TLS13" class="xref">TLS13</a>]</span>). It then sends the application data in 0-RTT packets.<a href="#section-4.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="accepting-and-rejecting-0-rtt">
<section id="section-4.6">
        <h3 id="name-accepting-and-rejecting-0-r">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-accepting-and-rejecting-0-r" class="section-name selfRef">Accepting and Rejecting 0-RTT</a>
        </h3>
<p id="section-4.6-1">A server accepts 0-RTT by sending an early_data extension in the
EncryptedExtensions (see Section 4.2.10 of <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>).  The server then
processes and acknowledges the 0-RTT packets that it receives.<a href="#section-4.6-1" class="pilcrow">¶</a></p>
<p id="section-4.6-2">A server rejects 0-RTT by sending the EncryptedExtensions without an early_data
extension.  A server will always reject 0-RTT if it sends a TLS
HelloRetryRequest.  When rejecting 0-RTT, a server MUST NOT process any 0-RTT
packets, even if it could.  When 0-RTT was rejected, a client SHOULD treat
receipt of an acknowledgement for a 0-RTT packet as a connection error of type
PROTOCOL_VIOLATION, if it is able to detect the condition.<a href="#section-4.6-2" class="pilcrow">¶</a></p>
<p id="section-4.6-3">When 0-RTT is rejected, all connection characteristics that the client assumed
might be incorrect.  This includes the choice of application protocol, transport
parameters, and any application configuration.  The client therefore MUST reset
the state of all streams, including application state bound to those streams.<a href="#section-4.6-3" class="pilcrow">¶</a></p>
<p id="section-4.6-4">A client MAY attempt to send 0-RTT again if it receives a Retry or Version
Negotiation packet.  These packets do not signify rejection of 0-RTT.<a href="#section-4.6-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="validating-0-rtt-configuration">
<section id="section-4.7">
        <h3 id="name-validating-0-rtt-configurat">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-validating-0-rtt-configurat" class="section-name selfRef">Validating 0-RTT Configuration</a>
        </h3>
<p id="section-4.7-1">When a server receives a ClientHello with the "early_data" extension, it has to
decide whether to accept or reject early data from the client. Some of this
decision is made by the TLS stack (e.g., checking that the cipher suite being
resumed was included in the ClientHello; see Section 4.2.10 of <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>). Even
when the TLS stack has no reason to reject early data, the QUIC stack or the
application protocol using QUIC might reject early data because the
configuration of the transport or application associated with the resumed
session is not compatible with the server's current configuration.<a href="#section-4.7-1" class="pilcrow">¶</a></p>
<p id="section-4.7-2">QUIC requires additional transport state to be associated with a 0-RTT session
ticket. One common way to implement this is using stateless session tickets and
storing this state in the session ticket. Application protocols that use QUIC
might have similar requirements regarding associating or storing state. This
associated state is used for deciding whether early data must be rejected. For
example, HTTP/3 (<span>[<a href="#QUIC-HTTP" class="xref">QUIC-HTTP</a>]</span>) settings determine how early data from the
client is interpreted. Other applications using QUIC could have different
requirements for determining whether to accept or reject early data.<a href="#section-4.7-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="helloretryrequest">
<section id="section-4.8">
        <h3 id="name-helloretryrequest">
<a href="#section-4.8" class="section-number selfRef">4.8. </a><a href="#name-helloretryrequest" class="section-name selfRef">HelloRetryRequest</a>
        </h3>
<p id="section-4.8-1">In TLS over TCP, the HelloRetryRequest feature (see Section 4.1.4 of <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>)
can be used to correct a client's incorrect KeyShare extension as well as for a
stateless round-trip check. From the perspective of QUIC, this just looks like
additional messages carried in the Initial encryption level. Although it is in
principle possible to use this feature for address verification in QUIC, QUIC
implementations SHOULD instead use the Retry feature (see Section 8.1 of
<span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>).  HelloRetryRequest is still used to request key shares.<a href="#section-4.8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tls-errors">
<section id="section-4.9">
        <h3 id="name-tls-errors">
<a href="#section-4.9" class="section-number selfRef">4.9. </a><a href="#name-tls-errors" class="section-name selfRef">TLS Errors</a>
        </h3>
<p id="section-4.9-1">If TLS experiences an error, it generates an appropriate alert as defined in
Section 6 of <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>.<a href="#section-4.9-1" class="pilcrow">¶</a></p>
<p id="section-4.9-2">A TLS alert is turned into a QUIC connection error by converting the one-byte
alert description into a QUIC error code.  The alert description is added to
0x100 to produce a QUIC error code from the range reserved for CRYPTO_ERROR.
The resulting value is sent in a QUIC CONNECTION_CLOSE frame.<a href="#section-4.9-2" class="pilcrow">¶</a></p>
<p id="section-4.9-3">The alert level of all TLS alerts is "fatal"; a TLS stack MUST NOT generate
alerts at the "warning" level.<a href="#section-4.9-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="discarding-unused-keys">
<section id="section-4.10">
        <h3 id="name-discarding-unused-keys">
<a href="#section-4.10" class="section-number selfRef">4.10. </a><a href="#name-discarding-unused-keys" class="section-name selfRef">Discarding Unused Keys</a>
        </h3>
<p id="section-4.10-1">After QUIC moves to a new encryption level, packet protection keys for previous
encryption levels can be discarded.  This occurs several times during the
handshake, as well as when keys are updated; see <a href="#key-update" class="xref">Section 6</a>.<a href="#section-4.10-1" class="pilcrow">¶</a></p>
<p id="section-4.10-2">Packet protection keys are not discarded immediately when new keys are
available.  If packets from a lower encryption level contain CRYPTO frames,
frames that retransmit that data MUST be sent at the same encryption level.
Similarly, an endpoint generates acknowledgements for packets at the same
encryption level as the packet being acknowledged.  Thus, it is possible that
keys for a lower encryption level are needed for a short time after keys for a
newer encryption level are available.<a href="#section-4.10-2" class="pilcrow">¶</a></p>
<p id="section-4.10-3">An endpoint cannot discard keys for a given encryption level unless it has both
received and acknowledged all CRYPTO frames for that encryption level and when
all CRYPTO frames for that encryption level have been acknowledged by its peer.
However, this does not guarantee that no further packets will need to be
received or sent at that encryption level because a peer might not have received
all the acknowledgements necessary to reach the same state.<a href="#section-4.10-3" class="pilcrow">¶</a></p>
<p id="section-4.10-4">Though an endpoint might retain older keys, new data MUST be sent at the highest
currently-available encryption level.  Only ACK frames and retransmissions of
data in CRYPTO frames are sent at a previous encryption level.  These packets
MAY also include PADDING frames.<a href="#section-4.10-4" class="pilcrow">¶</a></p>
<div id="discarding-initial-keys">
<section id="section-4.10.1">
          <h4 id="name-discarding-initial-keys">
<a href="#section-4.10.1" class="section-number selfRef">4.10.1. </a><a href="#name-discarding-initial-keys" class="section-name selfRef">Discarding Initial Keys</a>
          </h4>
<p id="section-4.10.1-1">Packets protected with Initial secrets (<a href="#initial-secrets" class="xref">Section 5.2</a>) are not
authenticated, meaning that an attacker could spoof packets with the intent to
disrupt a connection.  To limit these attacks, Initial packet protection keys
can be discarded more aggressively than other keys.<a href="#section-4.10.1-1" class="pilcrow">¶</a></p>
<p id="section-4.10.1-2">The successful use of Handshake packets indicates that no more Initial packets
need to be exchanged, as these keys can only be produced after receiving all
CRYPTO frames from Initial packets.  Thus, a client MUST discard Initial keys
when it first sends a Handshake packet and a server MUST discard Initial keys
when it first successfully processes a Handshake packet.  Endpoints MUST NOT
send Initial packets after this point.<a href="#section-4.10.1-2" class="pilcrow">¶</a></p>
<p id="section-4.10.1-3">This results in abandoning loss recovery state for the Initial encryption level
and ignoring any outstanding Initial packets.<a href="#section-4.10.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="discarding-handshake-keys">
<section id="section-4.10.2">
          <h4 id="name-discarding-handshake-keys">
<a href="#section-4.10.2" class="section-number selfRef">4.10.2. </a><a href="#name-discarding-handshake-keys" class="section-name selfRef">Discarding Handshake Keys</a>
          </h4>
<p id="section-4.10.2-1">An endpoint MUST discard its handshake keys when the TLS handshake is confirmed
(<a href="#handshake-confirmed" class="xref">Section 4.1.2</a>).  The server MUST send a HANDSHAKE_DONE frame as soon
as it completes the handshake.<a href="#section-4.10.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="discarding-0-rtt-keys">
<section id="section-4.10.3">
          <h4 id="name-discarding-0-rtt-keys">
<a href="#section-4.10.3" class="section-number selfRef">4.10.3. </a><a href="#name-discarding-0-rtt-keys" class="section-name selfRef">Discarding 0-RTT Keys</a>
          </h4>
<p id="section-4.10.3-1">0-RTT and 1-RTT packets share the same packet number space, and clients do not
send 0-RTT packets after sending a 1-RTT packet (<a href="#using-early-data" class="xref">Section 5.6</a>).<a href="#section-4.10.3-1" class="pilcrow">¶</a></p>
<p id="section-4.10.3-2">Therefore, a client SHOULD discard 0-RTT keys as soon as it installs 1-RTT
keys, since they have no use after that moment.<a href="#section-4.10.3-2" class="pilcrow">¶</a></p>
<p id="section-4.10.3-3">Additionally, a server MAY discard 0-RTT keys as soon as it receives a 1-RTT
packet.  However, due to packet reordering, a 0-RTT packet could arrive after
a 1-RTT packet.  Servers MAY temporarily retain 0-RTT keys to allow decrypting
reordered packets without requiring their contents to be retransmitted with
1-RTT keys.  After receiving a 1-RTT packet, servers MUST discard 0-RTT keys
within a short time; the RECOMMENDED time period is three times the Probe
Timeout (PTO, see <span>[<a href="#QUIC-RECOVERY" class="xref">QUIC-RECOVERY</a>]</span>).  A server MAY discard 0-RTT keys earlier
if it determines that it has received all 0-RTT packets, which can be done by
keeping track of missing packet numbers.<a href="#section-4.10.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="packet-protection">
<section id="section-5">
      <h2 id="name-packet-protection">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-packet-protection" class="section-name selfRef">Packet Protection</a>
      </h2>
<p id="section-5-1">As with TLS over TCP, QUIC protects packets with keys derived from the TLS
handshake, using the AEAD algorithm negotiated by TLS.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="protection-keys">
<section id="section-5.1">
        <h3 id="name-packet-protection-keys">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-packet-protection-keys" class="section-name selfRef">Packet Protection Keys</a>
        </h3>
<p id="section-5.1-1">QUIC derives packet protection keys in the same way that TLS derives record
protection keys.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">Each encryption level has separate secret values for protection of packets sent
in each direction.  These traffic secrets are derived by TLS (see Section 7.1 of
<span>[<a href="#TLS13" class="xref">TLS13</a>]</span>) and are used by QUIC for all encryption levels except the Initial
encryption level.  The secrets for the Initial encryption level are computed
based on the client's initial Destination Connection ID, as described in
<a href="#initial-secrets" class="xref">Section 5.2</a>.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">The keys used for packet protection are computed from the TLS secrets using the
KDF provided by TLS.  In TLS 1.3, the HKDF-Expand-Label function described in
Section 7.1 of <span>[<a href="#TLS13" class="xref">TLS13</a>]</span> is used, using the hash function from the negotiated
cipher suite.  Other versions of TLS MUST provide a similar function in order to
be used with QUIC.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">The current encryption level secret and the label "quic key" are input to the
KDF to produce the AEAD key; the label "quic iv" is used to derive the IV; see
<a href="#aead" class="xref">Section 5.3</a>.  The header protection key uses the "quic hp" label; see
<a href="#header-protect" class="xref">Section 5.4</a>.  Using these labels provides key separation between QUIC
and TLS; see <a href="#key-diversity" class="xref">Section 9.5</a>.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">The KDF used for initial secrets is always the HKDF-Expand-Label function from
TLS 1.3 (see <a href="#initial-secrets" class="xref">Section 5.2</a>).<a href="#section-5.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="initial-secrets">
<section id="section-5.2">
        <h3 id="name-initial-secrets">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-initial-secrets" class="section-name selfRef">Initial Secrets</a>
        </h3>
<p id="section-5.2-1">Initial packets are protected with a secret derived from the Destination
Connection ID field from the client's Initial packet. Specifically:<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.2-2">
<pre>
initial_salt = 0xc3eef712c72ebb5a11a7d2432bb46365bef9f502
initial_secret = HKDF-Extract(initial_salt,
                              client_dst_connection_id)

client_initial_secret = HKDF-Expand-Label(initial_secret,
                                          "client in", "",
                                          Hash.length)
server_initial_secret = HKDF-Expand-Label(initial_secret,
                                          "server in", "",
                                          Hash.length)
</pre><a href="#section-5.2-2" class="pilcrow">¶</a>
</div>
<p id="section-5.2-3">The hash function for HKDF when deriving initial secrets and keys is SHA-256
<span>[<a href="#SHA" class="xref">SHA</a>]</span>.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2-4">The connection ID used with HKDF-Expand-Label is the Destination Connection ID
in the Initial packet sent by the client.  This will be a randomly-selected
value unless the client creates the Initial packet after receiving a Retry
packet, where the Destination Connection ID is selected by the server.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.2-5">The value of initial_salt is a 20 byte sequence shown in the figure in
hexadecimal notation. Future versions of QUIC SHOULD generate a new salt value,
thus ensuring that the keys are different for each version of QUIC. This
prevents a middlebox that only recognizes one version of QUIC from seeing or
modifying the contents of packets from future versions.<a href="#section-5.2-5" class="pilcrow">¶</a></p>
<p id="section-5.2-6">The HKDF-Expand-Label function defined in TLS 1.3 MUST be used for Initial
packets even where the TLS versions offered do not include TLS 1.3.<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<p id="section-5.2-7">The secrets used for protecting Initial packets change when a server sends a
Retry packet to use the connection ID value selected by the server.  The secrets
do not change when a client changes the Destination Connection ID it uses in
response to an Initial packet from the server.<a href="#section-5.2-7" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-5.2-8">
          <dt id="section-5.2-8.1">Note:</dt>
<dd id="section-5.2-8.2">
  The Destination Connection ID is of arbitrary length, and it could be zero
length if the server sends a Retry packet with a zero-length Source Connection
ID field.  In this case, the Initial keys provide no assurance to the client
that the server received its packet; the client has to rely on the exchange
that included the Retry packet for that property.<a href="#section-5.2-8.2" class="pilcrow">¶</a>
</dd>
</dl>
<p id="section-5.2-9"><a href="#test-vectors" class="xref">Appendix A</a> contains test vectors for packet encryption.<a href="#section-5.2-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="aead">
<section id="section-5.3">
        <h3 id="name-aead-usage">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-aead-usage" class="section-name selfRef">AEAD Usage</a>
        </h3>
<p id="section-5.3-1">The Authentication Encryption with Associated Data (AEAD) <span>[<a href="#AEAD" class="xref">AEAD</a>]</span> function
used for QUIC packet protection is the AEAD that is negotiated for use with the
TLS connection.  For example, if TLS is using the TLS_AES_128_GCM_SHA256, the
AEAD_AES_128_GCM function is used.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">Packets are protected prior to applying header protection (<a href="#header-protect" class="xref">Section 5.4</a>).
The unprotected packet header is part of the associated data (A).  When removing
packet protection, an endpoint first removes the header protection.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">All QUIC packets other than Version Negotiation and Retry packets are protected
with an AEAD algorithm <span>[<a href="#AEAD" class="xref">AEAD</a>]</span>. Prior to establishing a shared secret, packets
are protected with AEAD_AES_128_GCM and a key derived from the Destination
Connection ID in the client's first Initial packet (see <a href="#initial-secrets" class="xref">Section 5.2</a>).
This provides protection against off-path attackers and robustness against QUIC
version unaware middleboxes, but not against on-path attackers.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<p id="section-5.3-4">QUIC can use any of the ciphersuites defined in <span>[<a href="#TLS13" class="xref">TLS13</a>]</span> with the exception of
TLS_AES_128_CCM_8_SHA256.  A ciphersuite MUST NOT be negotiated unless a header
protection scheme is defined for the ciphersuite.  This document defines a
header protection scheme for all ciphersuites defined in <span>[<a href="#TLS13" class="xref">TLS13</a>]</span> aside from
TLS_AES_128_CCM_8_SHA256.  These ciphersuites have a 16-byte authentication tag
and produce an output 16 bytes larger than their input.<a href="#section-5.3-4" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-5.3-5">
          <dt id="section-5.3-5.1">Note:</dt>
<dd id="section-5.3-5.2">
  An endpoint MUST NOT reject a ClientHello that offers a ciphersuite that it
does not support, or it would be impossible to deploy a new ciphersuite.  This
also applies to TLS_AES_128_CCM_8_SHA256.<a href="#section-5.3-5.2" class="pilcrow">¶</a>
</dd>
</dl>
<p id="section-5.3-6">The key and IV for the packet are computed as described in <a href="#protection-keys" class="xref">Section 5.1</a>.
The nonce, N, is formed by combining the packet protection IV with the packet
number.  The 62 bits of the reconstructed QUIC packet number in network byte
order are left-padded with zeros to the size of the IV.  The exclusive OR of the
padded packet number and the IV forms the AEAD nonce.<a href="#section-5.3-6" class="pilcrow">¶</a></p>
<p id="section-5.3-7">The associated data, A, for the AEAD is the contents of the QUIC header,
starting from the flags byte in either the short or long header, up to and
including the unprotected packet number.<a href="#section-5.3-7" class="pilcrow">¶</a></p>
<p id="section-5.3-8">The input plaintext, P, for the AEAD is the payload of the QUIC packet, as
described in <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>.<a href="#section-5.3-8" class="pilcrow">¶</a></p>
<p id="section-5.3-9">The output ciphertext, C, of the AEAD is transmitted in place of P.<a href="#section-5.3-9" class="pilcrow">¶</a></p>
<p id="section-5.3-10">Some AEAD functions have limits for how many packets can be encrypted under the
same key and IV (see for example <span>[<a href="#AEBounds" class="xref">AEBounds</a>]</span>).  This might be lower than the
packet number limit.  An endpoint MUST initiate a key update (<a href="#key-update" class="xref">Section 6</a>)
prior to exceeding any limit set for the AEAD that is in use.<a href="#section-5.3-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="header-protect">
<section id="section-5.4">
        <h3 id="name-header-protection">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-header-protection" class="section-name selfRef">Header Protection</a>
        </h3>
<p id="section-5.4-1">Parts of QUIC packet headers, in particular the Packet Number field, are
protected using a key that is derived separate to the packet protection key and
IV.  The key derived using the "quic hp" label is used to provide
confidentiality protection for those fields that are not exposed to on-path
elements.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">This protection applies to the least-significant bits of the first byte, plus
the Packet Number field.  The four least-significant bits of the first byte are
protected for packets with long headers; the five least significant bits of the
first byte are protected for packets with short headers.  For both header forms,
this covers the reserved bits and the Packet Number Length field; the Key Phase
bit is also protected for packets with a short header.<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<p id="section-5.4-3">The same header protection key is used for the duration of the connection, with
the value not changing after a key update (see <a href="#key-update" class="xref">Section 6</a>).  This allows
header protection to be used to protect the key phase.<a href="#section-5.4-3" class="pilcrow">¶</a></p>
<p id="section-5.4-4">This process does not apply to Retry or Version Negotiation packets, which do
not contain a protected payload or any of the fields that are protected by this
process.<a href="#section-5.4-4" class="pilcrow">¶</a></p>
<div id="header-protection-application">
<section id="section-5.4.1">
          <h4 id="name-header-protection-applicati">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-header-protection-applicati" class="section-name selfRef">Header Protection Application</a>
          </h4>
<p id="section-5.4.1-1">Header protection is applied after packet protection is applied (see <a href="#aead" class="xref">Section 5.3</a>).
The ciphertext of the packet is sampled and used as input to an encryption
algorithm.  The algorithm used depends on the negotiated AEAD.<a href="#section-5.4.1-1" class="pilcrow">¶</a></p>
<p id="section-5.4.1-2">The output of this algorithm is a 5 byte mask which is applied to the protected
header fields using exclusive OR.  The least significant bits of the first byte
of the packet are masked by the least significant bits of the first mask byte,
and the packet number is masked with the remaining bytes.  Any unused bytes of
mask that might result from a shorter packet number encoding are unused.<a href="#section-5.4.1-2" class="pilcrow">¶</a></p>
<p id="section-5.4.1-3"><a href="#pseudo-hp" class="xref">Figure 6</a> shows a sample algorithm for applying header protection. Removing
header protection only differs in the order in which the packet number length
(pn_length) is determined.<a href="#section-5.4.1-3" class="pilcrow">¶</a></p>
<span id="name-header-protection-pseudocod"></span><div id="pseudo-hp">
<figure id="figure-6">
            <div class="artwork art-text alignLeft" id="section-5.4.1-4.1">
<pre>
mask = header_protection(hp_key, sample)

pn_length = (packet[0] &amp; 0x03) + 1
if (packet[0] &amp; 0x80) == 0x80:
   # Long header: 4 bits masked
   packet[0] ^= mask[0] &amp; 0x0f
else:
   # Short header: 5 bits masked
   packet[0] ^= mask[0] &amp; 0x1f

# pn_offset is the start of the Packet Number field.
packet[pn_offset:pn_offset+pn_length] ^= mask[1:1+pn_length]
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-header-protection-pseudocod" class="selfRef">Header Protection Pseudocode</a>
            </figcaption></figure>
</div>
<p id="section-5.4.1-5"><a href="#fig-sample" class="xref">Figure 7</a> shows the protected fields of long and short headers marked with
an E.  <a href="#fig-sample" class="xref">Figure 7</a> also shows the sampled fields.<a href="#section-5.4.1-5" class="pilcrow">¶</a></p>
<span id="name-header-protection-and-ciphe"></span><div id="fig-sample">
<figure id="figure-7">
            <div class="artwork art-text alignLeft" id="section-5.4.1-6.1">
<pre>
Long Header:
+-+-+-+-+-+-+-+-+
|1|1|T T|E E E E|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Version -&gt; Length Fields                 ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Short Header:
+-+-+-+-+-+-+-+-+
|0|1|S|E E E E E|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Destination Connection ID (0/32..144)         ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Common Fields:
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|E E E E E E E E E  Packet Number (8/16/24/32) E E E E E E E E...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   [Protected Payload (8/16/24)]             ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|             Sampled part of Protected Payload (128)         ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 Protected Payload Remainder (*)             ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-header-protection-and-ciphe" class="selfRef">Header Protection and Ciphertext Sample</a>
            </figcaption></figure>
</div>
<p id="section-5.4.1-7">Before a TLS ciphersuite can be used with QUIC, a header protection algorithm
MUST be specified for the AEAD used with that ciphersuite.  This document
defines algorithms for AEAD_AES_128_GCM, AEAD_AES_128_CCM, AEAD_AES_256_GCM
(all AES AEADs are defined in <span>[<a href="#AEAD" class="xref">AEAD</a>]</span>), and
AEAD_CHACHA20_POLY1305 <span>[<a href="#CHACHA" class="xref">CHACHA</a>]</span>.  Prior to TLS selecting a
ciphersuite, AES header protection is used (<a href="#hp-aes" class="xref">Section 5.4.3</a>), matching the
AEAD_AES_128_GCM packet protection.<a href="#section-5.4.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hp-sample">
<section id="section-5.4.2">
          <h4 id="name-header-protection-sample">
<a href="#section-5.4.2" class="section-number selfRef">5.4.2. </a><a href="#name-header-protection-sample" class="section-name selfRef">Header Protection Sample</a>
          </h4>
<p id="section-5.4.2-1">The header protection algorithm uses both the header protection key and a sample
of the ciphertext from the packet Payload field.<a href="#section-5.4.2-1" class="pilcrow">¶</a></p>
<p id="section-5.4.2-2">The same number of bytes are always sampled, but an allowance needs to be made
for the endpoint removing protection, which will not know the length of the
Packet Number field.  In sampling the packet ciphertext, the Packet Number field
is assumed to be 4 bytes long (its maximum possible encoded length).<a href="#section-5.4.2-2" class="pilcrow">¶</a></p>
<p id="section-5.4.2-3">An endpoint MUST discard packets that are not long enough to contain a complete
sample.<a href="#section-5.4.2-3" class="pilcrow">¶</a></p>
<p id="section-5.4.2-4">To ensure that sufficient data is available for sampling, packets are padded so
that the combined lengths of the encoded packet number and protected payload is
at least 4 bytes longer than the sample required for header protection.  The
ciphersuites defined in <span>[<a href="#TLS13" class="xref">TLS13</a>]</span> - other than TLS_AES_128_CCM_8_SHA256, for
which a header protection scheme is not defined in this document - have 16-byte
expansions and 16-byte header protection samples.  This results in needing at
least 3 bytes of frames in the unprotected payload if the packet number is
encoded on a single byte, or 2 bytes of frames for a 2-byte packet number
encoding.<a href="#section-5.4.2-4" class="pilcrow">¶</a></p>
<p id="section-5.4.2-5">The sampled ciphertext for a packet with a short header can be determined by the
following pseudocode:<a href="#section-5.4.2-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.4.2-6">
<pre>
sample_offset = 1 + len(connection_id) + 4

sample = packet[sample_offset..sample_offset+sample_length]
</pre><a href="#section-5.4.2-6" class="pilcrow">¶</a>
</div>
<p id="section-5.4.2-7">For example, for a packet with a short header, an 8 byte connection ID, and
protected with AEAD_AES_128_GCM, the sample takes bytes 13 to 28 inclusive
(using zero-based indexing).<a href="#section-5.4.2-7" class="pilcrow">¶</a></p>
<p id="section-5.4.2-8">A packet with a long header is sampled in the same way, noting that multiple
QUIC packets might be included in the same UDP datagram and that each one is
handled separately.<a href="#section-5.4.2-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.4.2-9">
<pre>
sample_offset = 7 + len(destination_connection_id) +
                    len(source_connection_id) +
                    len(payload_length) + 4
if packet_type == Initial:
    sample_offset += len(token_length) +
                     len(token)

sample = packet[sample_offset..sample_offset+sample_length]
</pre><a href="#section-5.4.2-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="hp-aes">
<section id="section-5.4.3">
          <h4 id="name-aes-based-header-protection">
<a href="#section-5.4.3" class="section-number selfRef">5.4.3. </a><a href="#name-aes-based-header-protection" class="section-name selfRef">AES-Based Header Protection</a>
          </h4>
<p id="section-5.4.3-1">This section defines the packet protection algorithm for AEAD_AES_128_GCM,
AEAD_AES_128_CCM, and AEAD_AES_256_GCM. AEAD_AES_128_GCM and
AEAD_AES_128_CCM use 128-bit AES <span>[<a href="#AES" class="xref">AES</a>]</span> in
electronic code-book (ECB) mode. AEAD_AES_256_GCM uses
256-bit AES in ECB mode.<a href="#section-5.4.3-1" class="pilcrow">¶</a></p>
<p id="section-5.4.3-2">This algorithm samples 16 bytes from the packet ciphertext. This value is used
as the input to AES-ECB.  In pseudocode:<a href="#section-5.4.3-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.4.3-3">
<pre>
mask = AES-ECB(hp_key, sample)
</pre><a href="#section-5.4.3-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="hp-chacha">
<section id="section-5.4.4">
          <h4 id="name-chacha20-based-header-prote">
<a href="#section-5.4.4" class="section-number selfRef">5.4.4. </a><a href="#name-chacha20-based-header-prote" class="section-name selfRef">ChaCha20-Based Header Protection</a>
          </h4>
<p id="section-5.4.4-1">When AEAD_CHACHA20_POLY1305 is in use, header protection uses the raw ChaCha20
function as defined in Section 2.4 of <span>[<a href="#CHACHA" class="xref">CHACHA</a>]</span>.  This uses a 256-bit key and
16 bytes sampled from the packet protection output.<a href="#section-5.4.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4.4-2">The first 4 bytes of the sampled ciphertext are the block counter.  A ChaCha20
implementation could take a 32-bit integer in place of a byte sequence, in
which case the byte sequence is interpreted as a little-endian value.<a href="#section-5.4.4-2" class="pilcrow">¶</a></p>
<p id="section-5.4.4-3">The remaining 12 bytes are used as the nonce. A ChaCha20 implementation might
take an array of three 32-bit integers in place of a byte sequence, in which
case the nonce bytes are interpreted as a sequence of 32-bit little-endian
integers.<a href="#section-5.4.4-3" class="pilcrow">¶</a></p>
<p id="section-5.4.4-4">The encryption mask is produced by invoking ChaCha20 to protect 5 zero bytes. In
pseudocode:<a href="#section-5.4.4-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-5.4.4-5">
<pre>
counter = sample[0..3]
nonce = sample[4..15]
mask = ChaCha20(hp_key, counter, nonce, {0,0,0,0,0})
</pre><a href="#section-5.4.4-5" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="receiving-protected-packets">
<section id="section-5.5">
        <h3 id="name-receiving-protected-packets">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-receiving-protected-packets" class="section-name selfRef">Receiving Protected Packets</a>
        </h3>
<p id="section-5.5-1">Once an endpoint successfully receives a packet with a given packet number, it
MUST discard all packets in the same packet number space with higher packet
numbers if they cannot be successfully unprotected with either the same key, or
- if there is a key update - the next packet protection key (see
<a href="#key-update" class="xref">Section 6</a>).  Similarly, a packet that appears to trigger a key update, but
cannot be unprotected successfully MUST be discarded.<a href="#section-5.5-1" class="pilcrow">¶</a></p>
<p id="section-5.5-2">Failure to unprotect a packet does not necessarily indicate the existence of a
protocol error in a peer or an attack.  The truncated packet number encoding
used in QUIC can cause packet numbers to be decoded incorrectly if they are
delayed significantly.<a href="#section-5.5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="using-early-data">
<section id="section-5.6">
        <h3 id="name-use-of-0-rtt-keys">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-use-of-0-rtt-keys" class="section-name selfRef">Use of 0-RTT Keys</a>
        </h3>
<p id="section-5.6-1">If 0-RTT keys are available (see <a href="#enable-0rtt" class="xref">Section 4.5</a>), the lack of replay protection
means that restrictions on their use are necessary to avoid replay attacks on
the protocol.<a href="#section-5.6-1" class="pilcrow">¶</a></p>
<p id="section-5.6-2">A client MUST only use 0-RTT keys to protect data that is idempotent.  A client
MAY wish to apply additional restrictions on what data it sends prior to the
completion of the TLS handshake.  A client otherwise treats 0-RTT keys as
equivalent to 1-RTT keys, except that it MUST NOT send ACKs with 0-RTT keys.<a href="#section-5.6-2" class="pilcrow">¶</a></p>
<p id="section-5.6-3">A client that receives an indication that its 0-RTT data has been accepted by a
server can send 0-RTT data until it receives all of the server's handshake
messages.  A client SHOULD stop sending 0-RTT data if it receives an indication
that 0-RTT data has been rejected.<a href="#section-5.6-3" class="pilcrow">¶</a></p>
<p id="section-5.6-4">A server MUST NOT use 0-RTT keys to protect packets; it uses 1-RTT keys to
protect acknowledgements of 0-RTT packets.  A client MUST NOT attempt to
decrypt 0-RTT packets it receives and instead MUST discard them.<a href="#section-5.6-4" class="pilcrow">¶</a></p>
<p id="section-5.6-5">Once a client has installed 1-RTT keys, it MUST NOT send any more 0-RTT
packets.<a href="#section-5.6-5" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-5.6-6">
          <dt id="section-5.6-6.1">Note:</dt>
<dd id="section-5.6-6.2">
  0-RTT data can be acknowledged by the server as it receives it, but any
packets containing acknowledgments of 0-RTT data cannot have packet protection
removed by the client until the TLS handshake is complete.  The 1-RTT keys
necessary to remove packet protection cannot be derived until the client
receives all server handshake messages.<a href="#section-5.6-6.2" class="pilcrow">¶</a>
</dd>
</dl>
</section>
</div>
<div id="pre-hs-protected">
<section id="section-5.7">
        <h3 id="name-receiving-out-of-order-prot">
<a href="#section-5.7" class="section-number selfRef">5.7. </a><a href="#name-receiving-out-of-order-prot" class="section-name selfRef">Receiving Out-of-Order Protected Frames</a>
        </h3>
<p id="section-5.7-1">Due to reordering and loss, protected packets might be received by an endpoint
before the final TLS handshake messages are received.  A client will be unable
to decrypt 1-RTT packets from the server, whereas a server will be able to
decrypt 1-RTT packets from the client.  Endpoints in either role MUST NOT
decrypt 1-RTT packets from their peer prior to completing the handshake.<a href="#section-5.7-1" class="pilcrow">¶</a></p>
<p id="section-5.7-2">Even though 1-RTT keys are available to a server after receiving the first
handshake messages from a client, it is missing assurances on the client state:<a href="#section-5.7-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-5.7-3.1">The client is not authenticated, unless the server has chosen to use a
pre-shared key and validated the client's pre-shared key binder; see Section
4.2.11 of <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>.<a href="#section-5.7-3.1" class="pilcrow">¶</a>
</li>
<li id="section-5.7-3.2">The client has not demonstrated liveness, unless a RETRY packet was used.<a href="#section-5.7-3.2" class="pilcrow">¶</a>
</li>
<li id="section-5.7-3.3">Any received 0-RTT data that the server responds to might be due to a replay
attack.<a href="#section-5.7-3.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-5.7-4">Therefore, the server's use of 1-RTT keys MUST be limited to sending data before
the handshake is complete.  A server MUST NOT process incoming 1-RTT protected
packets before the TLS handshake is complete.  Because sending acknowledgments
indicates that all frames in a packet have been processed, a server cannot send
acknowledgments for 1-RTT packets until the TLS handshake is complete.  Received
packets protected with 1-RTT keys MAY be stored and later decrypted and used
once the handshake is complete.<a href="#section-5.7-4" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-5.7-5">
          <dt id="section-5.7-5.1">Note:</dt>
<dd id="section-5.7-5.2">
  TLS implementations might provide all 1-RTT secrets prior to handshake
completion.  Even where QUIC implementations have 1-RTT read keys, those keys
cannot be used prior to completing the handshake.<a href="#section-5.7-5.2" class="pilcrow">¶</a>
</dd>
</dl>
<p id="section-5.7-6">The requirement for the server to wait for the client Finished message creates
a dependency on that message being delivered.  A client can avoid the
potential for head-of-line blocking that this implies by sending its 1-RTT
packets coalesced with a handshake packet containing a copy of the CRYPTO frame
that carries the Finished message, until one of the handshake packets is
acknowledged.  This enables immediate server processing for those packets.<a href="#section-5.7-6" class="pilcrow">¶</a></p>
<p id="section-5.7-7">A server could receive packets protected with 0-RTT keys prior to receiving a
TLS ClientHello.  The server MAY retain these packets for later decryption in
anticipation of receiving a ClientHello.<a href="#section-5.7-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="retry-integrity">
<section id="section-5.8">
        <h3 id="name-retry-packet-integrity">
<a href="#section-5.8" class="section-number selfRef">5.8. </a><a href="#name-retry-packet-integrity" class="section-name selfRef">Retry Packet Integrity</a>
        </h3>
<p id="section-5.8-1">Retry packets (see the Retry Packet section of <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>) carry a
Retry Integrity Tag that provides two properties: it allows discarding
packets that have accidentally been corrupted by the network, and it diminishes
off-path attackers' ability to send valid Retry packets.<a href="#section-5.8-1" class="pilcrow">¶</a></p>
<p id="section-5.8-2">The Retry Integrity Tag is a 128-bit field that is computed as the output of
AEAD_AES_128_GCM <span>[<a href="#AEAD" class="xref">AEAD</a>]</span> used with the following inputs:<a href="#section-5.8-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-5.8-3.1">The secret key, K, is 128 bits equal to 0x4d32ecdb2a2133c841e4043df27d4430.<a href="#section-5.8-3.1" class="pilcrow">¶</a>
</li>
<li id="section-5.8-3.2">The nonce, N, is 96 bits equal to 0x4d1611d05513a552c587d575.<a href="#section-5.8-3.2" class="pilcrow">¶</a>
</li>
<li id="section-5.8-3.3">The plaintext, P, is empty.<a href="#section-5.8-3.3" class="pilcrow">¶</a>
</li>
<li id="section-5.8-3.4">The associated data, A, is the contents of the Retry Pseudo-Packet, as
illustrated in <a href="#retry-pseudo" class="xref">Figure 8</a>:<a href="#section-5.8-3.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-5.8-4">The secret key and the nonce are values derived by calling HKDF-Expand-Label
using 0x656e61e336ae9417f7f0edd8d78d461e2aa7084aba7a14c1e9f726d55709169a as the
secret, with labels being "quic key" and "quic iv" (<a href="#protection-keys" class="xref">Section 5.1</a>).<a href="#section-5.8-4" class="pilcrow">¶</a></p>
<span id="name-retry-pseudo-packet"></span><div id="retry-pseudo">
<figure id="figure-8">
          <div class="artwork art-text alignLeft" id="section-5.8-5.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| ODCID Len (8) |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Original Destination Connection ID (0..160)        ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|1|1| 3 | Unused|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Version (32)                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| DCID Len (8)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Destination Connection ID (0..160)            ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| SCID Len (8)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 Source Connection ID (0..160)               ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Retry Token (*)                      ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-retry-pseudo-packet" class="selfRef">Retry Pseudo-Packet</a>
          </figcaption></figure>
</div>
<p id="section-5.8-6">The Retry Pseudo-Packet is not sent over the wire. It is computed by taking
the transmitted Retry packet, removing the Retry Integrity Tag and prepending
the two following fields:<a href="#section-5.8-6" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-5.8-7">
          <dt id="section-5.8-7.1">ODCID Len:</dt>
<dd id="section-5.8-7.2">
  The ODCID Len contains the length in bytes of the Original Destination
Connection ID field that follows it, encoded as an 8-bit unsigned integer.<a href="#section-5.8-7.2" class="pilcrow">¶</a>
</dd>
<dt id="section-5.8-7.3">Original Destination Connection ID:</dt>
<dd id="section-5.8-7.4">
  The Original Destination Connection ID contains the value of the Destination
Connection ID from the Initial packet that this Retry is in response to. The
length of this field is given in ODCID Len. The presence of this field
mitigates an off-path attacker's ability to inject a Retry packet.<a href="#section-5.8-7.4" class="pilcrow">¶</a>
</dd>
</dl>
</section>
</div>
</section>
</div>
<div id="key-update">
<section id="section-6">
      <h2 id="name-key-update">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-key-update" class="section-name selfRef">Key Update</a>
      </h2>
<p id="section-6-1">Once the handshake is confirmed (see <a href="#handshake-confirmed" class="xref">Section 4.1.2</a>), an endpoint MAY
initiate a key update.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">The Key Phase bit indicates which packet protection keys are used to protect the
packet.  The Key Phase bit is initially set to 0 for the first set of 1-RTT
packets and toggled to signal each subsequent key update.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">The Key Phase bit allows a recipient to detect a change in keying material
without needing to receive the first packet that triggered the change.  An
endpoint that notices a changed Key Phase bit updates keys and decrypts the
packet that contains the changed value.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">This mechanism replaces the TLS KeyUpdate message.  Endpoints MUST NOT send a
TLS KeyUpdate message.  Endpoints MUST treat the receipt of a TLS KeyUpdate
message as a connection error of type 0x10a, equivalent to a fatal TLS alert of
unexpected_message (see <a href="#tls-errors" class="xref">Section 4.9</a>).<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5"><a href="#ex-key-update" class="xref">Figure 9</a> shows a key update process, where the initial set of keys used
(identified with @M) are replaced by updated keys (identified with @N).  The
value of the Key Phase bit is indicated in brackets [].<a href="#section-6-5" class="pilcrow">¶</a></p>
<span id="name-key-update-2"></span><div id="ex-key-update">
<figure id="figure-9">
        <div class="artwork art-text alignLeft" id="section-6-6.1">
<pre>
   Initiating Peer                    Responding Peer

@M [0] QUIC Packets

... Update to @N
@N [1] QUIC Packets
                      --------&gt;
                                         Update to @N ...
                                      QUIC Packets [1] @N
                      &lt;--------
                                      QUIC Packets [1] @N
                                    containing ACK
                      &lt;--------
... Key Update Permitted

@N [1] QUIC Packets
         containing ACK for @N packets
                      --------&gt;
                                 Key Update Permitted ...
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-key-update-2" class="selfRef">Key Update</a>
        </figcaption></figure>
</div>
<div id="key-update-initiate">
<section id="section-6.1">
        <h3 id="name-initiating-a-key-update">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-initiating-a-key-update" class="section-name selfRef">Initiating a Key Update</a>
        </h3>
<p id="section-6.1-1">Endpoints maintain separate read and write secrets for packet protection.  An
endpoint initiates a key update by updating its packet protection write secret
and using that to protect new packets.  The endpoint creates a new write secret
from the existing write secret as performed in Section 7.2 of <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>.  This
uses the KDF function provided by TLS with a label of "quic ku".  The
corresponding key and IV are created from that secret as defined in
<a href="#protection-keys" class="xref">Section 5.1</a>.  The header protection key is not updated.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">For example, to update write keys with TLS 1.3, HKDF-Expand-Label is used as:<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.1-3">
<pre>
secret_&lt;n+1&gt; = HKDF-Expand-Label(secret_&lt;n&gt;, "quic ku",
                                 "", Hash.length)
</pre><a href="#section-6.1-3" class="pilcrow">¶</a>
</div>
<p id="section-6.1-4">The endpoint toggles the value of the Key Phase bit and uses the updated key and
IV to protect all subsequent packets.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5">An endpoint MUST NOT initiate a key update prior to having confirmed the
handshake (<a href="#handshake-confirmed" class="xref">Section 4.1.2</a>).  An endpoint MUST NOT initiate a subsequent
key update prior unless it has received an acknowledgment for a packet that was
sent protected with keys from the current key phase.  This ensures that keys are
available to both peers before another key update can be initiated.  This can be
implemented by tracking the lowest packet number sent with each key phase, and
the highest acknowledged packet number in the 1-RTT space: once the latter is
higher than or equal to the former, another key update can be initiated.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-6.1-6">
          <dt id="section-6.1-6.1">Note:</dt>
<dd id="section-6.1-6.2">
  Keys of packets other than the 1-RTT packets are never updated; their keys are
derived solely from the TLS handshake state.<a href="#section-6.1-6.2" class="pilcrow">¶</a>
</dd>
</dl>
<p id="section-6.1-7">The endpoint that initiates a key update also updates the keys that it uses for
receiving packets.  These keys will be needed to process packets the peer sends
after updating.<a href="#section-6.1-7" class="pilcrow">¶</a></p>
<p id="section-6.1-8">An endpoint SHOULD retain old keys so that packets sent by its peer prior to
receiving the key update can be processed.  Discarding old keys too early can
cause delayed packets to be discarded.  Discarding packets will be interpreted
as packet loss by the peer and could adversely affect performance.<a href="#section-6.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="responding-to-a-key-update">
<section id="section-6.2">
        <h3 id="name-responding-to-a-key-update">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-responding-to-a-key-update" class="section-name selfRef">Responding to a Key Update</a>
        </h3>
<p id="section-6.2-1">A peer is permitted to initiate a key update after receiving an acknowledgement
of a packet in the current key phase.  An endpoint detects a key update when
processing a packet with a key phase that differs from the value last used to
protect the last packet it sent.  To process this packet, the endpoint uses the
next packet protection key and IV.  See <a href="#receive-key-generation" class="xref">Section 6.3</a> for
considerations about generating these keys.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">If a packet is successfully processed using the next key and IV, then the peer
has initiated a key update.  The endpoint MUST update its send keys to the
corresponding key phase in response, as described in <a href="#key-update-initiate" class="xref">Section 6.1</a>.
Sending keys MUST be updated before sending an acknowledgement for the packet
that was received with updated keys.  By acknowledging the packet that triggered
the key update in a packet protected with the updated keys, the endpoint signals
that the key update is complete.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">An endpoint can defer sending the packet or acknowledgement according to its
normal packet sending behaviour; it is not necessary to immediately generate a
packet in response to a key update.  The next packet sent by the endpoint will
use the updated keys.  The next packet that contains an acknowledgement will
cause the key update to be completed.  If an endpoint detects a second update
before it has sent any packets with updated keys containing an
acknowledgement for the packet that initiated the key update, it indicates that
its peer has updated keys twice without awaiting confirmation.  An endpoint MAY
treat consecutive key updates as a connection error of type KEY_UPDATE_ERROR.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">An endpoint that receives an acknowledgement that is carried in a packet
protected with old keys where any acknowledged packet was protected with newer
keys MAY treat that as a connection error of type KEY_UPDATE_ERROR.  This
indicates that a peer has received and acknowledged a packet that initiates a
key update, but has not updated keys in response.<a href="#section-6.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="receive-key-generation">
<section id="section-6.3">
        <h3 id="name-timing-of-receive-key-gener">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-timing-of-receive-key-gener" class="section-name selfRef">Timing of Receive Key Generation</a>
        </h3>
<p id="section-6.3-1">Endpoints responding to an apparent key update MUST NOT generate a timing
side-channel signal that might indicate that the Key Phase bit was invalid (see
<a href="#header-protect-analysis" class="xref">Section 9.3</a>).  Endpoints can use dummy packet protection keys in
place of discarded keys when key updates are not yet permitted.  Using dummy
keys will generate no variation in the timing signal produced by attempting to
remove packet protection, and results in all packets with an invalid Key Phase
bit being rejected.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">The process of creating new packet protection keys for receiving packets could
reveal that a key update has occurred.  An endpoint MAY perform this process as
part of packet processing, but this creates a timing signal that can be used by
an attacker to learn when key updates happen and thus the value of the Key Phase
bit in certain packets.  Endpoints MAY instead defer the creation of the next
set of receive packet protection keys until some time after a key update
completes, up to three times the PTO; see <a href="#old-keys-recv" class="xref">Section 6.5</a>.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">Once generated, the next set of packet protection keys SHOULD be retained, even
if the packet that was received was subsequently discarded.  Packets containing
apparent key updates are easy to forge and - while the process of key update
does not require significant effort - triggering this process could be used by
an attacker for DoS.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<p id="section-6.3-4">For this reason, endpoints MUST be able to retain two sets of packet protection
keys for receiving packets: the current and the next.  Retaining the previous
keys in addition to these might improve performance, but this is not essential.<a href="#section-6.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="old-keys-send">
<section id="section-6.4">
        <h3 id="name-sending-with-updated-keys">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-sending-with-updated-keys" class="section-name selfRef">Sending with Updated Keys</a>
        </h3>
<p id="section-6.4-1">An endpoint always sends packets that are protected with the newest keys.  Keys
used for packet protection can be discarded immediately after switching to newer
keys.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">Packets with higher packet numbers MUST be protected with either the same or
newer packet protection keys than packets with lower packet numbers.  An
endpoint that successfully removes protection with old keys when newer keys were
used for packets with lower packet numbers MUST treat this as a connection error
of type KEY_UPDATE_ERROR.<a href="#section-6.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="old-keys-recv">
<section id="section-6.5">
        <h3 id="name-receiving-with-different-ke">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-receiving-with-different-ke" class="section-name selfRef">Receiving with Different Keys</a>
        </h3>
<p id="section-6.5-1">For receiving packets during a key update, packets protected with older keys
might arrive if they were delayed by the network.  Retaining old packet
protection keys allows these packets to be successfully processed.<a href="#section-6.5-1" class="pilcrow">¶</a></p>
<p id="section-6.5-2">As packets protected with keys from the next key phase use the same Key Phase
value as those protected with keys from the previous key phase, it can be
necessary to distinguish between the two.  This can be done using packet
numbers.  A recovered packet number that is lower than any packet number from
the current key phase uses the previous packet protection keys; a recovered
packet number that is higher than any packet number from the current key phase
requires the use of the next packet protection keys.<a href="#section-6.5-2" class="pilcrow">¶</a></p>
<p id="section-6.5-3">Some care is necessary to ensure that any process for selecting between
previous, current, and next packet protection keys does not expose a timing side
channel that might reveal which keys were used to remove packet protection.  See
<a href="#hp-side-channel" class="xref">Section 9.4</a> for more information.<a href="#section-6.5-3" class="pilcrow">¶</a></p>
<p id="section-6.5-4">Alternatively, endpoints can retain only two sets of packet protection keys,
swapping previous for next after enough time has passed to allow for reordering
in the network.  In this case, the Key Phase bit alone can be used to select
keys.<a href="#section-6.5-4" class="pilcrow">¶</a></p>
<p id="section-6.5-5">An endpoint MAY allow a period of approximately the Probe Timeout (PTO; see
<span>[<a href="#QUIC-RECOVERY" class="xref">QUIC-RECOVERY</a>]</span>) after a key update before it creates the next set of packet
protection keys.  These updated keys MAY replace the previous keys at that time.
With the caveat that PTO is a subjective measure - that is, a peer could have a
different view of the RTT - this time is expected to be long enough that any
reordered packets would be declared lost by a peer even if they were
acknowledged and short enough to allow for subsequent key updates.<a href="#section-6.5-5" class="pilcrow">¶</a></p>
<p id="section-6.5-6">Endpoints need to allow for the possibility that a peer might not be able to
decrypt packets that initiate a key update during the period when it retains old
keys.  Endpoints SHOULD wait three times the PTO before initiating a key update
after receiving an acknowledgment that confirms that the previous key update was
received.  Failing to allow sufficient time could lead to packets being
discarded.<a href="#section-6.5-6" class="pilcrow">¶</a></p>
<p id="section-6.5-7">An endpoint SHOULD retain old read keys for no more than three times the PTO.
After this period, old read keys and their corresponding secrets SHOULD be
discarded.<a href="#section-6.5-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-update-frequency">
<section id="section-6.6">
        <h3 id="name-key-update-frequency">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-key-update-frequency" class="section-name selfRef">Key Update Frequency</a>
        </h3>
<p id="section-6.6-1">Key updates MUST be initiated before usage limits on packet protection keys are
exceeded.  For the cipher suites mentioned in this document, the limits in
Section 5.5 of <span>[<a href="#TLS13" class="xref">TLS13</a>]</span> apply.  Other cipher suites MUST define usage limits
in order to be used with QUIC.<a href="#section-6.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-update-error">
<section id="section-6.7">
        <h3 id="name-key-update-error-code">
<a href="#section-6.7" class="section-number selfRef">6.7. </a><a href="#name-key-update-error-code" class="section-name selfRef">Key Update Error Code</a>
        </h3>
<p id="section-6.7-1">The KEY_UPDATE_ERROR error code (0xE) is used to signal errors related to key
updates.<a href="#section-6.7-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-of-initial-messages">
<section id="section-7">
      <h2 id="name-security-of-initial-message">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-of-initial-message" class="section-name selfRef">Security of Initial Messages</a>
      </h2>
<p id="section-7-1">Initial packets are not protected with a secret key, so they are subject to
potential tampering by an attacker.  QUIC provides protection against attackers
that cannot read packets, but does not attempt to provide additional protection
against attacks where the attacker can observe and inject packets.  Some forms
of tampering - such as modifying the TLS messages themselves - are detectable,
but some - such as modifying ACKs - are not.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">For example, an attacker could inject a packet containing an ACK frame that
makes it appear that a packet had not been received or to create a false
impression of the state of the connection (e.g., by modifying the ACK Delay).
Note that such a packet could cause a legitimate packet to be dropped as a
duplicate.  Implementations SHOULD use caution in relying on any data which is
contained in Initial packets that is not otherwise authenticated.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">It is also possible for the attacker to tamper with data that is carried in
Handshake packets, but because that tampering requires modifying TLS handshake
messages, that tampering will cause the TLS handshake to fail.<a href="#section-7-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="quic-specific-additions-to-the-tls-handshake">
<section id="section-8">
      <h2 id="name-quic-specific-additions-to-">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-quic-specific-additions-to-" class="section-name selfRef">QUIC-Specific Additions to the TLS Handshake</a>
      </h2>
<p id="section-8-1">QUIC uses the TLS handshake for more than just negotiation of cryptographic
parameters.  The TLS handshake provides preliminary values for QUIC transport
parameters and allows a server to perform return routability checks on clients.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="protocol-negotiation">
<section id="section-8.1">
        <h3 id="name-protocol-negotiation">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-protocol-negotiation" class="section-name selfRef">Protocol Negotiation</a>
        </h3>
<p id="section-8.1-1">QUIC requires that the cryptographic handshake provide authenticated protocol
negotiation.  TLS uses Application Layer Protocol Negotiation (ALPN)
<span>[<a href="#ALPN" class="xref">ALPN</a>]</span> to select an application protocol.  Unless another mechanism
is used for agreeing on an application protocol, endpoints MUST use ALPN for
this purpose.  When using ALPN, endpoints MUST immediately close a connection
(see Section 10.3 in <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>) if an application protocol is not
negotiated with a no_application_protocol TLS alert (QUIC error code 0x178, see
<a href="#tls-errors" class="xref">Section 4.9</a>).  While <span>[<a href="#ALPN" class="xref">ALPN</a>]</span> only specifies that servers use this alert,
QUIC clients MUST also use it to terminate a connection when ALPN negotiation
fails.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">An application protocol MAY restrict the QUIC versions that it can operate over.
Servers MUST select an application protocol compatible with the QUIC version
that the client has selected.  The server MUST treat the inability to select a
compatible application protocol as a connection error of type 0x178
(no_application_protocol).  Similarly, a client MUST treat the selection of an
incompatible application protocol by a server as a connection error of type
0x178.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="quic_parameters">
<section id="section-8.2">
        <h3 id="name-quic-transport-parameters-e">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-quic-transport-parameters-e" class="section-name selfRef">QUIC Transport Parameters Extension</a>
        </h3>
<p id="section-8.2-1">QUIC transport parameters are carried in a TLS extension. Different versions of
QUIC might define a different method for negotiating transport configuration.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">Including transport parameters in the TLS handshake provides integrity
protection for these values.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.2-3">
<pre>
   enum {
      quic_transport_parameters(0xffa5), (65535)
   } ExtensionType;
</pre><a href="#section-8.2-3" class="pilcrow">¶</a>
</div>
<p id="section-8.2-4">The <code>extension_data</code> field of the quic_transport_parameters extension contains a
value that is defined by the version of QUIC that is in use.<a href="#section-8.2-4" class="pilcrow">¶</a></p>
<p id="section-8.2-5">The quic_transport_parameters extension is carried in the ClientHello and the
EncryptedExtensions messages during the handshake. Endpoints MUST send the
quic_transport_parameters extension; endpoints that receive ClientHello or
EncryptedExtensions messages without the quic_transport_parameters extension
MUST close the connection with an error of type 0x16d (equivalent to a fatal TLS
missing_extension alert, see <a href="#tls-errors" class="xref">Section 4.9</a>).<a href="#section-8.2-5" class="pilcrow">¶</a></p>
<p id="section-8.2-6">While the transport parameters are technically available prior to the completion
of the handshake, they cannot be fully trusted until the handshake completes,
and reliance on them should be minimized.  However, any tampering with the
parameters will cause the handshake to fail.<a href="#section-8.2-6" class="pilcrow">¶</a></p>
<p id="section-8.2-7">Endpoints MUST NOT send this extension in a TLS connection that does not use
QUIC (such as the use of TLS with TCP defined in <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>).  A fatal
unsupported_extension alert MUST be sent by an implementation that supports this
extension if the extension is received when the transport is not QUIC.<a href="#section-8.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="remove-eoed">
<section id="section-8.3">
        <h3 id="name-removing-the-endofearlydata">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-removing-the-endofearlydata" class="section-name selfRef">Removing the EndOfEarlyData Message</a>
        </h3>
<p id="section-8.3-1">The TLS EndOfEarlyData message is not used with QUIC.  QUIC does not rely on
this message to mark the end of 0-RTT data or to signal the change to Handshake
keys.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">Clients MUST NOT send the EndOfEarlyData message.  A server MUST treat receipt
of a CRYPTO frame in a 0-RTT packet as a connection error of type
PROTOCOL_VIOLATION.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">As a result, EndOfEarlyData does not appear in the TLS handshake transcript.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-9">
      <h2 id="name-security-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-9-1">There are likely to be some real clangers here eventually, but the current set
of issues is well captured in the relevant sections of the main text.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">Never assume that because it isn't in the security considerations section it
doesn't affect security.  Most of this document does.<a href="#section-9-2" class="pilcrow">¶</a></p>
<div id="replay-attacks-with-0-rtt">
<section id="section-9.1">
        <h3 id="name-replay-attacks-with-0-rtt">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-replay-attacks-with-0-rtt" class="section-name selfRef">Replay Attacks with 0-RTT</a>
        </h3>
<p id="section-9.1-1">As described in Section 8 of <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>, use of TLS early data comes with an
exposure to replay attack.  The use of 0-RTT in QUIC is similarly vulnerable to
replay attack.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">Endpoints MUST implement and use the replay protections described in <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>,
however it is recognized that these protections are imperfect.  Therefore,
additional consideration of the risk of replay is needed.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1-3">QUIC is not vulnerable to replay attack, except via the application protocol
information it might carry.  The management of QUIC protocol state based on the
frame types defined in <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> is not vulnerable to replay.
Processing of QUIC frames is idempotent and cannot result in invalid connection
states if frames are replayed, reordered or lost.  QUIC connections do not
produce effects that last beyond the lifetime of the connection, except for
those produced by the application protocol that QUIC serves.<a href="#section-9.1-3" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-9.1-4">
          <dt id="section-9.1-4.1">Note:</dt>
<dd id="section-9.1-4.2">
  TLS session tickets and address validation tokens are used to carry QUIC
configuration information between connections.  These MUST NOT be used to
carry application semantics.  The potential for reuse of these tokens means
that they require stronger protections against replay.<a href="#section-9.1-4.2" class="pilcrow">¶</a>
</dd>
</dl>
<p id="section-9.1-5">A server that accepts 0-RTT on a connection incurs a higher cost than accepting
a connection without 0-RTT.  This includes higher processing and computation
costs.  Servers need to consider the probability of replay and all associated
costs when accepting 0-RTT.<a href="#section-9.1-5" class="pilcrow">¶</a></p>
<p id="section-9.1-6">Ultimately, the responsibility for managing the risks of replay attacks with
0-RTT lies with an application protocol.  An application protocol that uses QUIC
MUST describe how the protocol uses 0-RTT and the measures that are employed to
protect against replay attack.  An analysis of replay risk needs to consider
all QUIC protocol features that carry application semantics.<a href="#section-9.1-6" class="pilcrow">¶</a></p>
<p id="section-9.1-7">Disabling 0-RTT entirely is the most effective defense against replay attack.<a href="#section-9.1-7" class="pilcrow">¶</a></p>
<p id="section-9.1-8">QUIC extensions MUST describe how replay attacks affect their operation, or
prohibit their use in 0-RTT.  Application protocols MUST either prohibit the use
of extensions that carry application semantics in 0-RTT or provide replay
mitigation strategies.<a href="#section-9.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="reflection">
<section id="section-9.2">
        <h3 id="name-packet-reflection-attack-mi">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-packet-reflection-attack-mi" class="section-name selfRef">Packet Reflection Attack Mitigation</a>
        </h3>
<p id="section-9.2-1">A small ClientHello that results in a large block of handshake messages from a
server can be used in packet reflection attacks to amplify the traffic generated
by an attacker.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<p id="section-9.2-2">QUIC includes three defenses against this attack. First, the packet containing a
ClientHello MUST be padded to a minimum size. Second, if responding to an
unverified source address, the server is forbidden to send more than three UDP
datagrams in its first flight (see Section 8.1 of <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>). Finally,
because acknowledgements of Handshake packets are authenticated, a blind
attacker cannot forge them.  Put together, these defenses limit the level of
amplification.<a href="#section-9.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="header-protect-analysis">
<section id="section-9.3">
        <h3 id="name-header-protection-analysis">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-header-protection-analysis" class="section-name selfRef">Header Protection Analysis</a>
        </h3>
<p id="section-9.3-1"><span>[<a href="#NAN" class="xref">NAN</a>]</span> analyzes authenticated encryption
algorithms which provide nonce privacy, referred to as "Hide Nonce" (HN)
transforms. The general header protection construction in this document is
one of those algorithms (HN1). Header protection uses the output of the packet
protection AEAD to derive <code>sample</code>, and then encrypts the header field using
a pseudorandom function (PRF) as follows:<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-9.3-2">
<pre>
protected_field = field XOR PRF(hp_key, sample)
</pre><a href="#section-9.3-2" class="pilcrow">¶</a>
</div>
<p id="section-9.3-3">The header protection variants in this document use a pseudorandom permutation
(PRP) in place of a generic PRF. However, since all PRPs are also PRFs <span>[<a href="#IMC" class="xref">IMC</a>]</span>,
these variants do not deviate from the HN1 construction.<a href="#section-9.3-3" class="pilcrow">¶</a></p>
<p id="section-9.3-4">As <code>hp_key</code> is distinct from the packet protection key, it follows that header
protection achieves AE2 security as defined in <span>[<a href="#NAN" class="xref">NAN</a>]</span> and therefore guarantees
privacy of <code>field</code>, the protected packet header. Future header protection
variants based on this construction MUST use a PRF to ensure equivalent
security guarantees.<a href="#section-9.3-4" class="pilcrow">¶</a></p>
<p id="section-9.3-5">Use of the same key and ciphertext sample more than once risks compromising
header protection. Protecting two different headers with the same key and
ciphertext sample reveals the exclusive OR of the protected fields.  Assuming
that the AEAD acts as a PRF, if L bits are sampled, the odds of two ciphertext
samples being identical approach 2^(-L/2), that is, the birthday bound. For the
algorithms described in this document, that probability is one in 2^64.<a href="#section-9.3-5" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-9.3-6">
          <dt id="section-9.3-6.1">Note:</dt>
<dd id="section-9.3-6.2">
  In some cases, inputs shorter than the full size required by the packet
protection algorithm might be used.<a href="#section-9.3-6.2" class="pilcrow">¶</a>
</dd>
</dl>
<p id="section-9.3-7">To prevent an attacker from modifying packet headers, the header is transitively
authenticated using packet protection; the entire packet header is part of the
authenticated additional data.  Protected fields that are falsified or modified
can only be detected once the packet protection is removed.<a href="#section-9.3-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hp-side-channel">
<section id="section-9.4">
        <h3 id="name-header-protection-timing-si">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-header-protection-timing-si" class="section-name selfRef">Header Protection Timing Side-Channels</a>
        </h3>
<p id="section-9.4-1">An attacker could guess values for packet numbers or Key Phase and have an
endpoint confirm guesses through timing side channels.  Similarly, guesses for
the packet number length can be trialed and exposed.  If the recipient of a
packet discards packets with duplicate packet numbers without attempting to
remove packet protection they could reveal through timing side-channels that the
packet number matches a received packet.  For authentication to be free from
side-channels, the entire process of header protection removal, packet number
recovery, and packet protection removal MUST be applied together without timing
and other side-channels.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<p id="section-9.4-2">For the sending of packets, construction and protection of packet payloads and
packet numbers MUST be free from side-channels that would reveal the packet
number or its encoded size.<a href="#section-9.4-2" class="pilcrow">¶</a></p>
<p id="section-9.4-3">During a key update, the time taken to generate new keys could reveal through
timing side-channels that a key update has occurred.  Alternatively, where an
attacker injects packets this side-channel could reveal the value of the Key
Phase on injected packets.  After receiving a key update, an endpoint SHOULD
generate and save the next set of receive packet protection keys, as described
in <a href="#receive-key-generation" class="xref">Section 6.3</a>.  By generating new keys before a key update is
received, receipt of packets will not create timing signals that leak the value
of the Key Phase.<a href="#section-9.4-3" class="pilcrow">¶</a></p>
<p id="section-9.4-4">This depends on not doing this key generation during packet processing and it
can require that endpoints maintain three sets of packet protection keys for
receiving: for the previous key phase, for the current key phase, and for the
next key phase.  Endpoints can instead choose to defer generation of the next
receive packet protection keys until they discard old keys so that only two sets
of receive keys need to be retained at any point in time.<a href="#section-9.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="key-diversity">
<section id="section-9.5">
        <h3 id="name-key-diversity">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-key-diversity" class="section-name selfRef">Key Diversity</a>
        </h3>
<p id="section-9.5-1">In using TLS, the central key schedule of TLS is used.  As a result of the TLS
handshake messages being integrated into the calculation of secrets, the
inclusion of the QUIC transport parameters extension ensures that handshake and
1-RTT keys are not the same as those that might be produced by a server running
TLS over TCP.  To avoid the possibility of cross-protocol key synchronization,
additional measures are provided to improve key separation.<a href="#section-9.5-1" class="pilcrow">¶</a></p>
<p id="section-9.5-2">The QUIC packet protection keys and IVs are derived using a different label than
the equivalent keys in TLS.<a href="#section-9.5-2" class="pilcrow">¶</a></p>
<p id="section-9.5-3">To preserve this separation, a new version of QUIC SHOULD define new labels for
key derivation for packet protection key and IV, plus the header protection
keys.  This version of QUIC uses the string "quic".  Other versions can use a
version-specific label in place of that string.<a href="#section-9.5-3" class="pilcrow">¶</a></p>
<p id="section-9.5-4">The initial secrets use a key that is specific to the negotiated QUIC version.
New QUIC versions SHOULD define a new salt value used in calculating initial
secrets.<a href="#section-9.5-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">This document does not create any new IANA registries, but it registers the
values in the following registries:<a href="#section-10-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-10-2.1">TLS ExtensionType Values Registry <span>[<a href="#TLS-REGISTRIES" class="xref">TLS-REGISTRIES</a>]</span> - IANA is to
register the quic_transport_parameters extension found in <a href="#quic_parameters" class="xref">Section 8.2</a>.
The Recommended column is to be marked Yes.  The TLS 1.3 Column is to include
CH and EE.<a href="#section-10-2.1" class="pilcrow">¶</a>
</li>
<li id="section-10-2.2">QUIC Transport Error Codes Registry <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> - IANA is to register
the KEY_UPDATE_ERROR (0xE), as described in <a href="#key-update-error" class="xref">Section 6.7</a>.<a href="#section-10-2.2" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="AEAD">[AEAD]</dt>
<dd>
<span class="refAuthor">McGrew, D.</span>, <span class="refTitle">"An Interface and Algorithms for Authenticated Encryption"</span>, <span class="seriesInfo">RFC 5116</span>, <span class="seriesInfo">DOI 10.17487/RFC5116</span>, <time datetime="2008-01">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5116">https://www.rfc-editor.org/info/rfc5116</a>&gt;</span>. </dd>
<dt id="AES">[AES]</dt>
<dd>
<span class="refTitle">"Advanced encryption standard (AES)"</span>, <span class="seriesInfo">DOI 10.6028/nist.fips.197</span>, <span class="seriesInfo">National Institute of Standards and Technology report</span>, <time datetime="2001-11">November 2001</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.fips.197">https://doi.org/10.6028/nist.fips.197</a>&gt;</span>. </dd>
<dt id="ALPN">[ALPN]</dt>
<dd>
<span class="refAuthor">Friedl, S.</span><span class="refAuthor">, Popov, A.</span><span class="refAuthor">, Langley, A.</span><span class="refAuthor">, and E. Stephan</span>, <span class="refTitle">"Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension"</span>, <span class="seriesInfo">RFC 7301</span>, <span class="seriesInfo">DOI 10.17487/RFC7301</span>, <time datetime="2014-07">July 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7301">https://www.rfc-editor.org/info/rfc7301</a>&gt;</span>. </dd>
<dt id="CHACHA">[CHACHA]</dt>
<dd>
<span class="refAuthor">Nir, Y.</span><span class="refAuthor"> and A. Langley</span>, <span class="refTitle">"ChaCha20 and Poly1305 for IETF Protocols"</span>, <span class="seriesInfo">RFC 8439</span>, <span class="seriesInfo">DOI 10.17487/RFC8439</span>, <time datetime="2018-06">June 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8439">https://www.rfc-editor.org/info/rfc8439</a>&gt;</span>. </dd>
<dt id="QUIC-RECOVERY">[QUIC-RECOVERY]</dt>
<dd>
<span class="refAuthor">Iyengar, J., Ed.</span><span class="refAuthor"> and I. Swett, Ed.</span>, <span class="refTitle">"QUIC Loss Detection and Congestion Control"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-recovery-27</span>, <time datetime="2020-02-21">21 February 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-recovery-27">https://tools.ietf.org/html/draft-ietf-quic-recovery-27</a>&gt;</span>. </dd>
<dt id="QUIC-TRANSPORT">[QUIC-TRANSPORT]</dt>
<dd>
<span class="refAuthor">Iyengar, J., Ed.</span><span class="refAuthor"> and M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-transport-27</span>, <time datetime="2020-02-21">21 February 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-transport-27">https://tools.ietf.org/html/draft-ietf-quic-transport-27</a>&gt;</span>. </dd>
<dt id="RFC2119">[RFC2119]</dt>
<dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dt id="RFC8174">[RFC8174]</dt>
<dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dt id="SHA">[SHA]</dt>
<dd>
<span class="refAuthor">Dang, Q.</span>, <span class="refTitle">"Secure Hash Standard"</span>, <span class="seriesInfo">DOI 10.6028/nist.fips.180-4</span>, <span class="seriesInfo">National Institute of Standards and Technology report</span>, <time datetime="2015-07">July 2015</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.fips.180-4">https://doi.org/10.6028/nist.fips.180-4</a>&gt;</span>. </dd>
<dt id="TLS-REGISTRIES">[TLS-REGISTRIES]</dt>
<dd>
<span class="refAuthor">Salowey, J.</span><span class="refAuthor"> and S. Turner</span>, <span class="refTitle">"IANA Registry Updates for TLS and DTLS"</span>, <span class="seriesInfo">RFC 8447</span>, <span class="seriesInfo">DOI 10.17487/RFC8447</span>, <time datetime="2018-08">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8447">https://www.rfc-editor.org/info/rfc8447</a>&gt;</span>. </dd>
<dt id="TLS13">[TLS13]</dt>
<dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
</dl>
</section>
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="AEBounds">[AEBounds]</dt>
<dd>
<span class="refAuthor">Luykx, A.</span><span class="refAuthor"> and K. Paterson</span>, <span class="refTitle">"Limits on Authenticated Encryption Use in TLS"</span>, <time datetime="2016-03-08">8 March 2016</time>, <span>&lt;<a href="http://www.isg.rhul.ac.uk/~kp/TLS-AEbounds.pdf">http://www.isg.rhul.ac.uk/~kp/TLS-AEbounds.pdf</a>&gt;</span>. </dd>
<dt id="HTTP2-TLS13">[HTTP2-TLS13]</dt>
<dd>
<span class="refAuthor">Benjamin, D.</span>, <span class="refTitle">"Using TLS 1.3 with HTTP/2"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-httpbis-http2-tls13-03</span>, <time datetime="2019-10-17">17 October 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-httpbis-http2-tls13-03.txt">http://www.ietf.org/internet-drafts/draft-ietf-httpbis-http2-tls13-03.txt</a>&gt;</span>. </dd>
<dt id="IMC">[IMC]</dt>
<dd>
<span class="refAuthor">Katz, J.</span><span class="refAuthor"> and Y. Lindell</span>, <span class="refTitle">"Introduction to Modern Cryptography, Second Edition"</span>, <span class="seriesInfo">ISBN 978-1466570269</span>, <time datetime="2014-11-06">6 November 2014</time>. </dd>
<dt id="NAN">[NAN]</dt>
<dd>
<span class="refAuthor">Bellare, M.</span><span class="refAuthor">, Ng, R.</span><span class="refAuthor">, and B. Tackmann</span>, <span class="refTitle">"Nonces Are Noticed: AEAD Revisited"</span>, <span class="seriesInfo">DOI 10.1007/978-3-030-26948-7_9</span>, <span class="seriesInfo">Advances in Cryptology - CRYPTO 2019 pp. 235-265</span>, <time datetime="2019">2019</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-030-26948-7_9">https://doi.org/10.1007/978-3-030-26948-7_9</a>&gt;</span>. </dd>
<dt id="QUIC-HTTP">[QUIC-HTTP]</dt>
<dd>
<span class="refAuthor">Bishop, M., Ed.</span>, <span class="refTitle">"Hypertext Transfer Protocol Version 3 (HTTP/3)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-http-27</span>, <time datetime="2020-02-21">21 February 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-http-27">https://tools.ietf.org/html/draft-ietf-quic-http-27</a>&gt;</span>. </dd>
<dt id="RFC2818">[RFC2818]</dt>
<dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"HTTP Over TLS"</span>, <span class="seriesInfo">RFC 2818</span>, <span class="seriesInfo">DOI 10.17487/RFC2818</span>, <time datetime="2000-05">May 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2818">https://www.rfc-editor.org/info/rfc2818</a>&gt;</span>. </dd>
<dt id="RFC5280">[RFC5280]</dt>
<dd>
<span class="refAuthor">Cooper, D.</span><span class="refAuthor">, Santesson, S.</span><span class="refAuthor">, Farrell, S.</span><span class="refAuthor">, Boeyen, S.</span><span class="refAuthor">, Housley, R.</span><span class="refAuthor">, and W. Polk</span>, <span class="refTitle">"Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile"</span>, <span class="seriesInfo">RFC 5280</span>, <span class="seriesInfo">DOI 10.17487/RFC5280</span>, <time datetime="2008-05">May 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5280">https://www.rfc-editor.org/info/rfc5280</a>&gt;</span>. </dd>
</dl>
</section>
</section>
<div id="test-vectors">
<section id="section-appendix.a">
      <h2 id="name-sample-packet-protection">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-sample-packet-protection" class="section-name selfRef">Sample Packet Protection</a>
      </h2>
<p id="section-appendix.a-1">This section shows examples of packet protection so that implementations can be
verified incrementally. Samples of Initial packets from both client and server,
plus a Retry packet are defined. These packets use an 8-byte client-chosen
Destination Connection ID of 0x8394c8f03e515708. Some intermediate values are
included. All values are shown in hexadecimal.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<div id="keys">
<section id="section-a.1">
        <h2 id="name-keys">
<a href="#section-a.1" class="section-number selfRef">A.1. </a><a href="#name-keys" class="section-name selfRef">Keys</a>
        </h2>
<p id="section-a.1-1">The labels generated by the HKDF-Expand-Label function are:<a href="#section-a.1-1" class="pilcrow">¶</a></p>
<dl class="dlParallel" id="section-a.1-2">
          <dt id="section-a.1-2.1">client in:</dt>
<dd id="section-a.1-2.2">
  00200f746c73313320636c69656e7420696e00<a href="#section-a.1-2.2" class="pilcrow">¶</a>
</dd>
<dt id="section-a.1-2.3">server in:</dt>
<dd id="section-a.1-2.4">
  00200f746c7331332073657276657220696e00<a href="#section-a.1-2.4" class="pilcrow">¶</a>
</dd>
<dt id="section-a.1-2.5">quic key:</dt>
<dd id="section-a.1-2.6">
  00100e746c7331332071756963206b657900<a href="#section-a.1-2.6" class="pilcrow">¶</a>
</dd>
<dt id="section-a.1-2.7">quic iv:</dt>
<dd id="section-a.1-2.8">
  000c0d746c733133207175696320697600<a href="#section-a.1-2.8" class="pilcrow">¶</a>
</dd>
<dt id="section-a.1-2.9">quic hp:</dt>
<dd id="section-a.1-2.10">
  00100d746c733133207175696320687000<a href="#section-a.1-2.10" class="pilcrow">¶</a>
</dd>
</dl>
<p id="section-a.1-3">The initial secret is common:<a href="#section-a.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.1-4">
<pre>
initial_secret = HKDF-Extract(initial_salt, cid)
    = 524e374c6da8cf8b496f4bcb69678350
      7aafee6198b202b4bc823ebf7514a423
</pre><a href="#section-a.1-4" class="pilcrow">¶</a>
</div>
<p id="section-a.1-5">The secrets for protecting client packets are:<a href="#section-a.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.1-6">
<pre>
client_initial_secret
    = HKDF-Expand-Label(initial_secret, "client in", _, 32)
    = fda3953aecc040e48b34e27ef87de3a6
      098ecf0e38b7e032c5c57bcbd5975b84

key = HKDF-Expand-Label(client_initial_secret, "quic key", _, 16)
    = af7fd7efebd21878ff66811248983694

iv  = HKDF-Expand-Label(client_initial_secret, "quic iv", _, 12)
    = 8681359410a70bb9c92f0420

hp  = HKDF-Expand-Label(client_initial_secret, "quic hp", _, 16)
    = a980b8b4fb7d9fbc13e814c23164253d
</pre><a href="#section-a.1-6" class="pilcrow">¶</a>
</div>
<p id="section-a.1-7">The secrets for protecting server packets are:<a href="#section-a.1-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.1-8">
<pre>
server_initial_secret
    = HKDF-Expand-Label(initial_secret, "server in", _, 32)
    = 554366b81912ff90be41f17e80222130
      90ab17d8149179bcadf222f29ff2ddd5

key = HKDF-Expand-Label(server_initial_secret, "quic key", _, 16)
    = 5d51da9ee897a21b2659ccc7e5bfa577

iv  = HKDF-Expand-Label(server_initial_secret, "quic iv", _, 12)
    = 5e5ae651fd1e8495af13508b

hp  = HKDF-Expand-Label(server_initial_secret, "quic hp", _, 16)
    = a8ed82e6664f865aedf6106943f95fb8
</pre><a href="#section-a.1-8" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sample-client-initial">
<section id="section-a.2">
        <h2 id="name-client-initial">
<a href="#section-a.2" class="section-number selfRef">A.2. </a><a href="#name-client-initial" class="section-name selfRef">Client Initial</a>
        </h2>
<p id="section-a.2-1">The client sends an Initial packet.  The unprotected payload of this packet
contains the following CRYPTO frame, plus enough PADDING frames to make a 1162
byte payload:<a href="#section-a.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.2-2">
<pre>
060040c4010000c003036660261ff947 cea49cce6cfad687f457cf1b14531ba1
4131a0e8f309a1d0b9c4000006130113 031302010000910000000b0009000006
736572766572ff01000100000a001400 12001d00170018001901000101010201
03010400230000003300260024001d00 204cfdfcd178b784bf328cae793b136f
2aedce005ff183d7bb14952072366470 37002b0003020304000d0020001e0403
05030603020308040805080604010501 060102010402050206020202002d0002
0101001c00024001
</pre><a href="#section-a.2-2" class="pilcrow">¶</a>
</div>
<p id="section-a.2-3">The unprotected header includes the connection ID and a 4 byte packet number
encoding for a packet number of 2:<a href="#section-a.2-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.2-4">
<pre>
c3ff00001b088394c8f03e5157080000449e00000002
</pre><a href="#section-a.2-4" class="pilcrow">¶</a>
</div>
<p id="section-a.2-5">Protecting the payload produces output that is sampled for header protection.
Because the header uses a 4 byte packet number encoding, the first 16 bytes of
the protected payload is sampled, then applied to the header:<a href="#section-a.2-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.2-6">
<pre>
sample = 535064a4268a0d9d7b1c9d250ae35516

mask = AES-ECB(hp, sample)[0..4]
     = 833b343aaa

header[0] ^= mask[0] &amp; 0x0f
     = c0
header[18..21] ^= mask[1..4]
     = 3b343aa8
header = c0ff00001b088394c8f03e5157080000449e3b343aa8
</pre><a href="#section-a.2-6" class="pilcrow">¶</a>
</div>
<p id="section-a.2-7">The resulting protected packet is:<a href="#section-a.2-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.2-8">
<pre>
c0ff00001b088394c8f03e5157080000 449e3b343aa8535064a4268a0d9d7b1c
9d250ae355162276e9b1e3011ef6bbc0 ab48ad5bcc2681e953857ca62becd752
4daac473e68d7405fbba4e9ee616c870 38bdbe908c06d9605d9ac49030359eec
b1d05a14e117db8cede2bb09d0dbbfee 271cb374d8f10abec82d0f59a1dee29f
e95638ed8dd41da07487468791b719c5 5c46968eb3b54680037102a28e53dc1d
12903db0af5821794b41c4a93357fa59 ce69cfe7f6bdfa629eef78616447e1d6
11c4baf71bf33febcb03137c2c75d253 17d3e13b684370f668411c0f00304b50
1c8fd422bd9b9ad81d643b20da89ca05 25d24d2b142041cae0af205092e43008
0cd8559ea4c5c6e4fa3f66082b7d303e 52ce0162baa958532b0bbc2bc785681f
cf37485dff6595e01e739c8ac9efba31 b985d5f656cc092432d781db95221724
87641c4d3ab8ece01e39bc85b1543661 4775a98ba8fa12d46f9b35e2a55eb72d
7f85181a366663387ddc20551807e007 673bd7e26bf9b29b5ab10a1ca87cbb7a
d97e99eb66959c2a9bc3cbde4707ff77 20b110fa95354674e395812e47a0ae53
b464dcb2d1f345df360dc227270c7506 76f6724eb479f0d2fbb6124429990457
ac6c9167f40aab739998f38b9eccb24f d47c8410131bf65a52af841275d5b3d1
880b197df2b5dea3e6de56ebce3ffb6e 9277a82082f8d9677a6767089b671ebd
244c214f0bde95c2beb02cd1172d58bd f39dce56ff68eb35ab39b49b4eac7c81
5ea60451d6e6ab82119118df02a58684 4a9ffe162ba006d0669ef57668cab38b
62f71a2523a084852cd1d079b3658dc2 f3e87949b550bab3e177cfc49ed190df
f0630e43077c30de8f6ae081537f1e83 da537da980afa668e7b7fb25301cf741
524be3c49884b42821f17552fbd1931a 813017b6b6590a41ea18b6ba49cd48a4
40bd9a3346a7623fb4ba34a3ee571e3c 731f35a7a3cf25b551a680fa68763507
b7fde3aaf023c50b9d22da6876ba337e b5e9dd9ec3daf970242b6c5aab3aa4b2
96ad8b9f6832f686ef70fa938b31b4e5 ddd7364442d3ea72e73d668fb0937796
f462923a81a47e1cee7426ff6d922126 9b5a62ec03d6ec94d12606cb485560ba
b574816009e96504249385bb61a819be 04f62c2066214d8360a2022beb316240
b6c7d78bbe56c13082e0ca272661210a bf020bf3b5783f1426436cf9ff418405
93a5d0638d32fc51c5c65ff291a3a7a5 2fd6775e623a4439cc08dd25582febc9
44ef92d8dbd329c91de3e9c9582e41f1 7f3d186f104ad3f90995116c682a2a14
a3b4b1f547c335f0be710fc9fc03e0e5 87b8cda31ce65b969878a4ad4283e6d5
b0373f43da86e9e0ffe1ae0fddd35162 55bd74566f36a38703d5f34249ded1f6
6b3d9b45b9af2ccfefe984e13376b1b2 c6404aa48c8026132343da3f3a33659e
c1b3e95080540b28b7f3fcd35fa5d843 b579a84c089121a60d8c1754915c344e
eaf45a9bf27dc0c1e784161691220913 13eb0e87555abd706626e557fc36a04f
cd191a58829104d6075c5594f627ca50 6bf181daec940f4a4f3af0074eee89da
acde6758312622d4fa675b39f728e062 d2bee680d8f41a597c262648bb18bcfc
13c8b3d97b1a77b2ac3af745d61a34cc 4709865bac824a94bb19058015e4e42d
38d3b779d72edc00c5cd088eff802b05
</pre><a href="#section-a.2-8" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="server-initial">
<section id="section-a.3">
        <h2 id="name-server-initial">
<a href="#section-a.3" class="section-number selfRef">A.3. </a><a href="#name-server-initial" class="section-name selfRef">Server Initial</a>
        </h2>
<p id="section-a.3-1">The server sends the following payload in response, including an ACK frame, a
CRYPTO frame, and no PADDING frames:<a href="#section-a.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.3-2">
<pre>
0d0000000018410a020000560303eefc e7f7b37ba1d1632e96677825ddf73988
cfc79825df566dc5430b9a045a120013 0100002e00330024001d00209d3c940d
89690b84d08a60993c144eca684d1081 287c834d5311bcf32bb9da1a002b0002
0304
</pre><a href="#section-a.3-2" class="pilcrow">¶</a>
</div>
<p id="section-a.3-3">The header from the server includes a new connection ID and a 2-byte packet
number encoding for a packet number of 1:<a href="#section-a.3-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.3-4">
<pre>
c1ff00001b0008f067a5502a4262b50040740001
</pre><a href="#section-a.3-4" class="pilcrow">¶</a>
</div>
<p id="section-a.3-5">As a result, after protection, the header protection sample is taken starting
from the third protected octet:<a href="#section-a.3-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.3-6">
<pre>
sample = 7002596f99ae67abf65a5852f54f58c3
mask   = 38168a0c25
header = c9ff00001b0008f067a5502a4262b5004074168b
</pre><a href="#section-a.3-6" class="pilcrow">¶</a>
</div>
<p id="section-a.3-7">The final protected packet is then:<a href="#section-a.3-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.3-8">
<pre>
c9ff00001b0008f067a5502a4262b500 4074168bf22b7002596f99ae67abf65a
5852f54f58c37c808682e2e40492d8a3 899fb04fc0afe9aabc8767b18a0aa493
537426373b48d502214dd856d63b78ce e37bc664b3fe86d487ac7a77c53038a3
cd32f0b5004d9f5754c4f7f2d1f35cf3 f7116351c92bd8c3a9528d2b6aca20f0
8047d9f017f0
</pre><a href="#section-a.3-8" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="retry">
<section id="section-a.4">
        <h2 id="name-retry">
<a href="#section-a.4" class="section-number selfRef">A.4. </a><a href="#name-retry" class="section-name selfRef">Retry</a>
        </h2>
<p id="section-a.4-1">This shows a Retry packet that might be sent in response to the Initial packet
in <a href="#sample-client-initial" class="xref">Appendix A.2</a>. The integrity check includes the client-chosen
connection ID value of 0x8394c8f03e515708, but that value is not
included in the final Retry packet:<a href="#section-a.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-a.4-2">
<pre>
ffff00001b0008f067a5502a4262b574 6f6b656ea523cb5ba524695f6569f293
a1359d8e
</pre><a href="#section-a.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="change-log">
<section id="section-appendix.b">
      <h2 id="name-change-log">
<a href="#section-appendix.b" class="section-number selfRef">Appendix B. </a><a href="#name-change-log" class="section-name selfRef">Change Log</a>
      </h2>
<ul class="ulEmpty">
<li class="ulEmpty" id="section-appendix.b-1.1">
          <strong>RFC Editor's Note:</strong> Please remove this section prior to publication of a
final version of this document.<a href="#section-appendix.b-1.1" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-appendix.b-2">Issue and pull request numbers are listed with a leading octothorp.<a href="#section-appendix.b-2" class="pilcrow">¶</a></p>
<div id="since-draft-ietf-quic-tls-26">
<section id="section-b.1">
        <h2 id="name-since-draft-ietf-quic-tls-2">
<a href="#section-b.1" class="section-number selfRef">B.1. </a><a href="#name-since-draft-ietf-quic-tls-2" class="section-name selfRef">Since draft-ietf-quic-tls-26</a>
        </h2>
<ul>
<li id="section-b.1-1.1">Updated examples<a href="#section-b.1-1.1" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-25">
<section id="section-b.2">
        <h2 id="name-since-draft-ietf-quic-tls-25">
<a href="#section-b.2" class="section-number selfRef">B.2. </a><a href="#name-since-draft-ietf-quic-tls-25" class="section-name selfRef">Since draft-ietf-quic-tls-25</a>
        </h2>
<ul>
<li id="section-b.2-1.1">No changes<a href="#section-b.2-1.1" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-24">
<section id="section-b.3">
        <h2 id="name-since-draft-ietf-quic-tls-24">
<a href="#section-b.3" class="section-number selfRef">B.3. </a><a href="#name-since-draft-ietf-quic-tls-24" class="section-name selfRef">Since draft-ietf-quic-tls-24</a>
        </h2>
<ul>
<li id="section-b.3-1.1">
            <p id="section-b.3-1.1.1">Rewrite key updates (#3050)<a href="#section-b.3-1.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.3-1.1.2.1">Allow but don't recommend deferring key updates (#2792, #3263)<a href="#section-b.3-1.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-b.3-1.1.2.2">More completely define received behavior (#2791)<a href="#section-b.3-1.1.2.2" class="pilcrow">¶</a>
</li>
<li id="section-b.3-1.1.2.3">Define the label used with HKDF-Expand-Label (#3054)<a href="#section-b.3-1.1.2.3" class="pilcrow">¶</a>
</li>
</ul>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-23">
<section id="section-b.4">
        <h2 id="name-since-draft-ietf-quic-tls-23">
<a href="#section-b.4" class="section-number selfRef">B.4. </a><a href="#name-since-draft-ietf-quic-tls-23" class="section-name selfRef">Since draft-ietf-quic-tls-23</a>
        </h2>
<ul>
<li id="section-b.4-1.1">
            <p id="section-b.4-1.1.1">Key update text update (#3050):<a href="#section-b.4-1.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.4-1.1.2.1">Recommend constant-time key replacement (#2792)<a href="#section-b.4-1.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-b.4-1.1.2.2">Provide explicit labels for key update key derivation (#3054)<a href="#section-b.4-1.1.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-b.4-1.2">Allow first Initial from a client to span multiple packets (#2928, #3045)<a href="#section-b.4-1.2" class="pilcrow">¶</a>
</li>
<li id="section-b.4-1.3">PING can be sent at any encryption level (#3034, #3035)<a href="#section-b.4-1.3" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-22">
<section id="section-b.5">
        <h2 id="name-since-draft-ietf-quic-tls-22">
<a href="#section-b.5" class="section-number selfRef">B.5. </a><a href="#name-since-draft-ietf-quic-tls-22" class="section-name selfRef">Since draft-ietf-quic-tls-22</a>
        </h2>
<ul>
<li id="section-b.5-1.1">Update the salt used for Initial secrets (#2887, #2980)<a href="#section-b.5-1.1" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-21">
<section id="section-b.6">
        <h2 id="name-since-draft-ietf-quic-tls-21">
<a href="#section-b.6" class="section-number selfRef">B.6. </a><a href="#name-since-draft-ietf-quic-tls-21" class="section-name selfRef">Since draft-ietf-quic-tls-21</a>
        </h2>
<ul>
<li id="section-b.6-1.1">No changes<a href="#section-b.6-1.1" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-20">
<section id="section-b.7">
        <h2 id="name-since-draft-ietf-quic-tls-20">
<a href="#section-b.7" class="section-number selfRef">B.7. </a><a href="#name-since-draft-ietf-quic-tls-20" class="section-name selfRef">Since draft-ietf-quic-tls-20</a>
        </h2>
<ul>
<li id="section-b.7-1.1">Mandate the use of the QUIC transport parameters extension (#2528, #2560)<a href="#section-b.7-1.1" class="pilcrow">¶</a>
</li>
<li id="section-b.7-1.2">Define handshake completion and confirmation; define clearer rules when it
encryption keys should be discarded (#2214, #2267, #2673)<a href="#section-b.7-1.2" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-18">
<section id="section-b.8">
        <h2 id="name-since-draft-ietf-quic-tls-1">
<a href="#section-b.8" class="section-number selfRef">B.8. </a><a href="#name-since-draft-ietf-quic-tls-1" class="section-name selfRef">Since draft-ietf-quic-tls-18</a>
        </h2>
<ul>
<li id="section-b.8-1.1">Increased the set of permissible frames in 0-RTT (#2344, #2355)<a href="#section-b.8-1.1" class="pilcrow">¶</a>
</li>
<li id="section-b.8-1.2">Transport parameter extension is mandatory (#2528, #2560)<a href="#section-b.8-1.2" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-17">
<section id="section-b.9">
        <h2 id="name-since-draft-ietf-quic-tls-17">
<a href="#section-b.9" class="section-number selfRef">B.9. </a><a href="#name-since-draft-ietf-quic-tls-17" class="section-name selfRef">Since draft-ietf-quic-tls-17</a>
        </h2>
<ul>
<li id="section-b.9-1.1">Endpoints discard initial keys as soon as handshake keys are available (#1951,
#2045)<a href="#section-b.9-1.1" class="pilcrow">¶</a>
</li>
<li id="section-b.9-1.2">Use of ALPN or equivalent is mandatory (#2263, #2284)<a href="#section-b.9-1.2" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-14">
<section id="section-b.10">
        <h2 id="name-since-draft-ietf-quic-tls-14">
<a href="#section-b.10" class="section-number selfRef">B.10. </a><a href="#name-since-draft-ietf-quic-tls-14" class="section-name selfRef">Since draft-ietf-quic-tls-14</a>
        </h2>
<ul>
<li id="section-b.10-1.1">Update the salt used for Initial secrets (#1970)<a href="#section-b.10-1.1" class="pilcrow">¶</a>
</li>
<li id="section-b.10-1.2">Clarify that TLS_AES_128_CCM_8_SHA256 isn't supported (#2019)<a href="#section-b.10-1.2" class="pilcrow">¶</a>
</li>
<li id="section-b.10-1.3">
            <p id="section-b.10-1.3.1">Change header protection<a href="#section-b.10-1.3.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.10-1.3.2.1">Sample from a fixed offset (#1575, #2030)<a href="#section-b.10-1.3.2.1" class="pilcrow">¶</a>
</li>
<li id="section-b.10-1.3.2.2">Cover part of the first byte, including the key phase (#1322, #2006)<a href="#section-b.10-1.3.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-b.10-1.4">
            <p id="section-b.10-1.4.1">TLS provides an AEAD and KDF function (#2046)<a href="#section-b.10-1.4.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.10-1.4.2.1">Clarify that the TLS KDF is used with TLS (#1997)<a href="#section-b.10-1.4.2.1" class="pilcrow">¶</a>
</li>
<li id="section-b.10-1.4.2.2">Change the labels for calculation of QUIC keys (#1845, #1971, #1991)<a href="#section-b.10-1.4.2.2" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-b.10-1.5">Initial keys are discarded once Handshake keys are available (#1951, #2045)<a href="#section-b.10-1.5" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-13">
<section id="section-b.11">
        <h2 id="name-since-draft-ietf-quic-tls-13">
<a href="#section-b.11" class="section-number selfRef">B.11. </a><a href="#name-since-draft-ietf-quic-tls-13" class="section-name selfRef">Since draft-ietf-quic-tls-13</a>
        </h2>
<ul>
<li id="section-b.11-1.1">Updated to TLS 1.3 final (#1660)<a href="#section-b.11-1.1" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-12">
<section id="section-b.12">
        <h2 id="name-since-draft-ietf-quic-tls-12">
<a href="#section-b.12" class="section-number selfRef">B.12. </a><a href="#name-since-draft-ietf-quic-tls-12" class="section-name selfRef">Since draft-ietf-quic-tls-12</a>
        </h2>
<ul>
<li id="section-b.12-1.1">
            <p id="section-b.12-1.1.1">Changes to integration of the TLS handshake (#829, #1018, #1094, #1165, #1190,
#1233, #1242, #1252, #1450)<a href="#section-b.12-1.1.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-b.12-1.1.2.1">The cryptographic handshake uses CRYPTO frames, not stream 0<a href="#section-b.12-1.1.2.1" class="pilcrow">¶</a>
</li>
<li id="section-b.12-1.1.2.2">QUIC packet protection is used in place of TLS record protection<a href="#section-b.12-1.1.2.2" class="pilcrow">¶</a>
</li>
<li id="section-b.12-1.1.2.3">Separate QUIC packet number spaces are used for the handshake<a href="#section-b.12-1.1.2.3" class="pilcrow">¶</a>
</li>
<li id="section-b.12-1.1.2.4">Changed Retry to be independent of the cryptographic handshake<a href="#section-b.12-1.1.2.4" class="pilcrow">¶</a>
</li>
<li id="section-b.12-1.1.2.5">Limit the use of HelloRetryRequest to address TLS needs (like key shares)<a href="#section-b.12-1.1.2.5" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-b.12-1.2">Changed codepoint of TLS extension (#1395, #1402)<a href="#section-b.12-1.2" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-11">
<section id="section-b.13">
        <h2 id="name-since-draft-ietf-quic-tls-11">
<a href="#section-b.13" class="section-number selfRef">B.13. </a><a href="#name-since-draft-ietf-quic-tls-11" class="section-name selfRef">Since draft-ietf-quic-tls-11</a>
        </h2>
<ul>
<li id="section-b.13-1.1">Encrypted packet numbers.<a href="#section-b.13-1.1" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-10">
<section id="section-b.14">
        <h2 id="name-since-draft-ietf-quic-tls-10">
<a href="#section-b.14" class="section-number selfRef">B.14. </a><a href="#name-since-draft-ietf-quic-tls-10" class="section-name selfRef">Since draft-ietf-quic-tls-10</a>
        </h2>
<ul>
<li id="section-b.14-1.1">No significant changes.<a href="#section-b.14-1.1" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-09">
<section id="section-b.15">
        <h2 id="name-since-draft-ietf-quic-tls-0">
<a href="#section-b.15" class="section-number selfRef">B.15. </a><a href="#name-since-draft-ietf-quic-tls-0" class="section-name selfRef">Since draft-ietf-quic-tls-09</a>
        </h2>
<ul>
<li id="section-b.15-1.1">Cleaned up key schedule and updated the salt used for handshake packet
protection (#1077)<a href="#section-b.15-1.1" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-08">
<section id="section-b.16">
        <h2 id="name-since-draft-ietf-quic-tls-08">
<a href="#section-b.16" class="section-number selfRef">B.16. </a><a href="#name-since-draft-ietf-quic-tls-08" class="section-name selfRef">Since draft-ietf-quic-tls-08</a>
        </h2>
<ul>
<li id="section-b.16-1.1">Specify value for max_early_data_size to enable 0-RTT (#942)<a href="#section-b.16-1.1" class="pilcrow">¶</a>
</li>
<li id="section-b.16-1.2">Update key derivation function (#1003, #1004)<a href="#section-b.16-1.2" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-07">
<section id="section-b.17">
        <h2 id="name-since-draft-ietf-quic-tls-07">
<a href="#section-b.17" class="section-number selfRef">B.17. </a><a href="#name-since-draft-ietf-quic-tls-07" class="section-name selfRef">Since draft-ietf-quic-tls-07</a>
        </h2>
<ul>
<li id="section-b.17-1.1">Handshake errors can be reported with CONNECTION_CLOSE (#608, #891)<a href="#section-b.17-1.1" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-05">
<section id="section-b.18">
        <h2 id="name-since-draft-ietf-quic-tls-05">
<a href="#section-b.18" class="section-number selfRef">B.18. </a><a href="#name-since-draft-ietf-quic-tls-05" class="section-name selfRef">Since draft-ietf-quic-tls-05</a>
        </h2>
<p id="section-b.18-1">No significant changes.<a href="#section-b.18-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="since-draft-ietf-quic-tls-04">
<section id="section-b.19">
        <h2 id="name-since-draft-ietf-quic-tls-04">
<a href="#section-b.19" class="section-number selfRef">B.19. </a><a href="#name-since-draft-ietf-quic-tls-04" class="section-name selfRef">Since draft-ietf-quic-tls-04</a>
        </h2>
<ul>
<li id="section-b.19-1.1">Update labels used in HKDF-Expand-Label to match TLS 1.3 (#642)<a href="#section-b.19-1.1" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-03">
<section id="section-b.20">
        <h2 id="name-since-draft-ietf-quic-tls-03">
<a href="#section-b.20" class="section-number selfRef">B.20. </a><a href="#name-since-draft-ietf-quic-tls-03" class="section-name selfRef">Since draft-ietf-quic-tls-03</a>
        </h2>
<p id="section-b.20-1">No significant changes.<a href="#section-b.20-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="since-draft-ietf-quic-tls-02">
<section id="section-b.21">
        <h2 id="name-since-draft-ietf-quic-tls-02">
<a href="#section-b.21" class="section-number selfRef">B.21. </a><a href="#name-since-draft-ietf-quic-tls-02" class="section-name selfRef">Since draft-ietf-quic-tls-02</a>
        </h2>
<ul>
<li id="section-b.21-1.1">Updates to match changes in transport draft<a href="#section-b.21-1.1" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-01">
<section id="section-b.22">
        <h2 id="name-since-draft-ietf-quic-tls-01">
<a href="#section-b.22" class="section-number selfRef">B.22. </a><a href="#name-since-draft-ietf-quic-tls-01" class="section-name selfRef">Since draft-ietf-quic-tls-01</a>
        </h2>
<ul>
<li id="section-b.22-1.1">Use TLS alerts to signal TLS errors (#272, #374)<a href="#section-b.22-1.1" class="pilcrow">¶</a>
</li>
<li id="section-b.22-1.2">Require ClientHello to fit in a single packet (#338)<a href="#section-b.22-1.2" class="pilcrow">¶</a>
</li>
<li id="section-b.22-1.3">The second client handshake flight is now sent in the clear (#262, #337)<a href="#section-b.22-1.3" class="pilcrow">¶</a>
</li>
<li id="section-b.22-1.4">The QUIC header is included as AEAD Associated Data (#226, #243, #302)<a href="#section-b.22-1.4" class="pilcrow">¶</a>
</li>
<li id="section-b.22-1.5">Add interface necessary for client address validation (#275)<a href="#section-b.22-1.5" class="pilcrow">¶</a>
</li>
<li id="section-b.22-1.6">Define peer authentication (#140)<a href="#section-b.22-1.6" class="pilcrow">¶</a>
</li>
<li id="section-b.22-1.7">Require at least TLS 1.3 (#138)<a href="#section-b.22-1.7" class="pilcrow">¶</a>
</li>
<li id="section-b.22-1.8">Define transport parameters as a TLS extension (#122)<a href="#section-b.22-1.8" class="pilcrow">¶</a>
</li>
<li id="section-b.22-1.9">Define handling for protected packets before the handshake completes (#39)<a href="#section-b.22-1.9" class="pilcrow">¶</a>
</li>
<li id="section-b.22-1.10">Decouple QUIC version and ALPN (#12)<a href="#section-b.22-1.10" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-ietf-quic-tls-00">
<section id="section-b.23">
        <h2 id="name-since-draft-ietf-quic-tls-00">
<a href="#section-b.23" class="section-number selfRef">B.23. </a><a href="#name-since-draft-ietf-quic-tls-00" class="section-name selfRef">Since draft-ietf-quic-tls-00</a>
        </h2>
<ul>
<li id="section-b.23-1.1">Changed bit used to signal key phase<a href="#section-b.23-1.1" class="pilcrow">¶</a>
</li>
<li id="section-b.23-1.2">Updated key phase markings during the handshake<a href="#section-b.23-1.2" class="pilcrow">¶</a>
</li>
<li id="section-b.23-1.3">Added TLS interface requirements section<a href="#section-b.23-1.3" class="pilcrow">¶</a>
</li>
<li id="section-b.23-1.4">Moved to use of TLS exporters for key derivation<a href="#section-b.23-1.4" class="pilcrow">¶</a>
</li>
<li id="section-b.23-1.5">Moved TLS error code definitions into this document<a href="#section-b.23-1.5" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="since-draft-thomson-quic-tls-01">
<section id="section-b.24">
        <h2 id="name-since-draft-thomson-quic-tl">
<a href="#section-b.24" class="section-number selfRef">B.24. </a><a href="#name-since-draft-thomson-quic-tl" class="section-name selfRef">Since draft-thomson-quic-tls-01</a>
        </h2>
<ul>
<li id="section-b.24-1.1">Adopted as base for draft-ietf-quic-tls<a href="#section-b.24-1.1" class="pilcrow">¶</a>
</li>
<li id="section-b.24-1.2">Updated authors/editors list<a href="#section-b.24-1.2" class="pilcrow">¶</a>
</li>
<li id="section-b.24-1.3">Added status note<a href="#section-b.24-1.3" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
</section>
</div>
<div id="contributors">
<section id="section-appendix.c">
      <h2 id="name-contributors">
<a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<p id="section-appendix.c-1">The IETF QUIC Working Group received an enormous amount of support from many
people. The following people provided substantive contributions to this
document:
Adam Langley,
Alessandro Ghedini,
Christian Huitema,
Christopher Wood,
David Schinazi,
Dragana Damjanovic,
Eric Rescorla,
Ian Swett,
Jana Iyengar, <span class="contact-name"><span class="non-ascii">奥 一穂</span> (<span class="ascii">Kazuho Oku</span>)</span>,
Marten Seemann,
Martin Duke,
Mike Bishop, <span class="contact-name">Mikkel Fahnøe Jørgensen</span>,
Nick Banks,
Nick Harper,
Roberto Peon,
Rui Paulo,
Ryan Hamilton,
and Victor Vasiliev.<a href="#section-appendix.c-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.d">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Martin Thomson (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Mozilla</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mt@lowentropy.net" class="email">mt@lowentropy.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Sean Turner (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">sn3rd</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:sean@sn3rd.com" class="email">sean@sn3rd.com</a>
</div>
</address>
</section>
</div>
<script>var toc = document.getElementById("toc");
var tocToggle = toc.querySelector("h2");
var tocNav = toc.querySelector("nav");

// mobile menu toggle
tocToggle.onclick = function(event) {
    if (window.innerWidth < 1024) {
 var tocNavDisplay = tocNav.currentStyle ? tocNav.currentStyle.display : getComputedStyle(tocNav, null).display;
 if (tocNavDisplay == "none") {
     tocNav.style.display = "block";
 } else {
     tocNav.style.display = "none";
 }
    }
}

// toc anchor scroll to anchor
tocNav.addEventListener("click", function (event) {
    event.preventDefault();
    if (event.target.nodeName == 'A') {
 if (window.innerWidth < 1024) {
     tocNav.style.display = "none";
 }
 var href = event.target.getAttribute("href");
 var anchorId = href.substr(1);
 var anchor =  document.getElementById(anchorId);
 anchor.scrollIntoView(true);
 window.history.pushState("","",href);
    }
});

// switch toc mode when window resized
window.onresize = function () {
    if (window.innerWidth < 1024) {
 tocNav.style.display = "none";
    } else {
 tocNav.style.display = "block";
    }
}
</script>
</body>
</html>
