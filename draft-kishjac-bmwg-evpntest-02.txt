



Internet Engineering Task Force                          SudhinJacob
Internet-Draft                                          Kishore Tiruveedhula
Intended status: Informational                           Juniper Networks
Expires: February 22,2017                                August 25, 2016


                   Benchmarking Methodology for EVPN
                      draft-kishjac-bmwg-evpntest-02

Abstract

   This document defines the methodologies for benchmarking performance
   of EVPN.EVPN is defined in RFC 7432. It is being deployed in provider
   network.This document provides the benchmarking methodologies for
   EVPN convergance,data plane,control plane learning of mac.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on February 22, 2017.

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.





Jacob & Tiruveedhula     Expires February 22,2017                [Page 1]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   3
     1.1.  Requirements Language . . . . . . . . . . . . . . . . . .   3
   2.  Test Topology . . . . . . . . . . . . . . . . . . . . . . . .   3
   3.  Network . . . . . . . . . . . . . . . . . . . . . . . . . . .   4
   4.  Test Procedure  . . . . . . . . . . . . . . . . . . . . . . .   5
   5.Tes cases
     5.1.  To check the time taken to learn the mac address in DUT .   5
     5.2.  To check the time taken to learn X  macs from remote peer
           by DUT . . . . . . . . . . . . . . . . . . . . . . . . . .  5
     5.3.  To check the time taken to flush the local entry due to
           CE link failure . . . . . . . . . . . . . . . . . . . . .   5
	 5.4.  To check the time taken by DUT to flush X routes
           learned from remote PE after R1 traffic generator link
           failure . . . . . . . . . . . . . . . . . . . . . . . . .   6
     5.5.  To measure the mac ageing time. . . .. . . . . . . . . . .  6
     5.6    To check the time taken by DUT to age X routes learned
        from remote PE after stopping the traffic at remote PE. . . .  6
     
   5.  High Availablity . . . . . . . . . . . . . . . . . . . . . .    8
     5.1.  To check the whether there is traffic loss due to routing
           engine failover for redundancy test.  . . . . . . . . . .   8
    
   6.  Scale . . . . . . . . . . . . . . . . . . . . . . . . . . . .   9
     6.1.  To Scale the DUT to N EVI and clear bgp in DUT with out
           traffic.  . . . . . . . . . . . . . . . . . . . . . . . .   9
     6.2.  To Scale the DUT to N EVI and clear bgp in DUT with
           traffic. Measure the convergence time . . . . . . . . . .   9
   7.  Soak Test . . . . . . . . . . . . . . . . . . . . . . . . . .  10
     7.1.  To Scale the DUT to N EVI in DUT with traffic and run
           the set up for 24hrs  . . . . . . . . . . . . . . . . . .  10
   8.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  11
   9.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  11
   10. Security Considerations . . . . . . . . . . . . . . . . . . .  11
   11. References  . . . . . . . . . . . . . . . . . . . . . . . . .  12
     11.1.  Normative References . . . . . . . . . . . . . . . . . .  12
     11.2.  Informative References . . . . . . . . . . . . . . . . .  12
   Appendix A.  Appendix . . . . . . . . . . . . . . . . . . . . . .  12
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  13





Jacob & Tiruveedhula     Expires February 22,2017               [Page 2]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


1.  Introduction

   EVPN which is defined in RFC7432 which describes procedures for BGP
   MPLS-based Ethernet VPNs(EVPN).  This document defines the
   methodologies for benchmarking performance of EVPN.EVPN has been
   implemented with many varying designs in order to achieve their
   intended network functionality.The scope of this document is to provide
   methodologies for benchmarking evpn data,control plane mac learning,
   mac flush,mac ageing,convergence,high availablity,scale.
   The methodologies defined for evpn can be used for benchmarking the 
   performance of PBB-EVPN.PBB-EVPN is defined in RFC 7623.It is being
   deployed in provider network.The difference between PBB-EVPN and 
   EVPN is the former learns the customer mac in data plane the later
   learns in control plane.
   
   
   
   
1.1.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [RFC2119].

   
2.  Test Topology


































Jacob & Tiruveedhula     Expires February 22,2017               [Page 3]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


                             Topology Diagram


            | Traffic Generator
   +----------+
   |          |
   |  R1      |
   |          |
   +----------+
       |
       |
   +----------+
   |          |
   |  RR      |
   |          |
   +----------+-------------|
      |                     |
      |                     |
   +----------+       +-----------+
   |          |       |    MHPE2  |
   |   DUT    |       |           |
   |  MHPE1   |       |           |
   +----------+       +-----------+
        |                  |
   +----------+------------
   |          |
   |  CE      |
   |          |
   +----------+------------ Traffic Generator



                             Topology Diagram

                                 Figure 1

3.  Network

   The network consists of 5 routers and 2 traffic generator ports.  DUT
   is acting as one of MH PE to CE.The RR is acting as route reflector
   and core router.R1 is a Single home router running evpn.  All four
   routers except CE are running mpls,bgp.  CE is a dual home connected
   to DUT and MH PE1.  The testing will be done on DUT to bench mark the
   service.  UT and MHPE2 is running EVPN with SA/AA with CE.The DUT and
   and other PE's will be running X EVI's(EVPN instances) on X sub
   interfaces.





Jacob & Tiruveedhula     Expires February 22,2017             [Page 4]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


4.  Test Procedure

   The test defined to bench mark the performance of EVPN mac
   learning in control pland and data plane. Mac flush,High Availablity,
   convergence time in link failures,scale scenarios.

4.1 MAC Learning in Control plane and Data Plane

The MAC will be learned in data plane and control plane, test is
to measure the time taken to learn the "X" number of mac's in time "T".
The data plane learning will from the locally connected interface. The
control plane learning is through BGP advertisements from the remote PE.
Let the local learning time be "T" and control plane learning time be "T'".
The data plane mac learning can be measured using the paramters defined in
RFC 2889 section 5.8.


4.2 MAC flush for locally learned and remote learned MAC

The time taken to flush the "X" locally learned mac, let it be "T1" once
the traffic is stopped. The time taken flush the remote mac which learned by
control plane that "X" macs when the traffic is stopped at remote side.Let the
measured time is "T2".


4.3 High Availablity

The traffic is flowing bi direction. The bgp is converged, let the "X" numbers
of macs learned locally and remotely. Then traffic is flowing at "P" packets per
sec. The traffic generator is measuring the Tx and Rx packets, while the routing
engine failover there should not any packet loss the router tester must show both
"P" packet per seconds.



4.4 Convergence Time

During any events like link failure, hard reset measure the time taken to learn "X"
mac's locally and remotely or time taken to learn "X" mac locally and remote.

4.5 Scale

This is to measure the performance of DUT in scaling to "X" EVPN instances. 
The measured parameters are CPU usage, memory leak,crashes.

4.6 SOAK

This is measuring the performance of DUT running with scaled configuration with
traffic over a peroid of time "T'". In each interval "t1" the parameters measured
are CPU usage, memory usage, crashes.

4.7 Measurement Statistics

The test is repeated for "N" times and the value is taken by averaging the values.



5 Test Cases

The following tests are conducted to measure mac learning of local as well as remote.

5.1.  To check the time taken to learn the mac address in DUT

   Objective:

   To check the time taken to learn the mac address locally and time
   taken to send the locally learned routes to peers.

   a.  Send X unicast frames from CE to MHPE1(DUT) working in SA
       mode with different source and destination address, where DUT is
       the DF so that it can forward the traffic.  Measure the time
       taken to learn these mac in forwarding table and control plane.
	   The data plane learning is measured using RFC 2889 section 5.8.
	   Sending frames to the limit of bridge domain of particular EVI.
	   Measure the time taken to learn all X mac in data plane/hardware.

   b.  Measure the time taken to send these X type 2 routes from
       DUT to its peers.

   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and
   DUT.Once the bgp comes up check the DUT evpn table.For MH PE ESI must
   be configured per IFD/Interface.  Using RT (traffic generator) to
   send the traffic to the routers.  Measurement The DUT mac table must
   learn the X mac address and measure the time taken to send
    X routes to its peers by DUT.
   
   Measurement
      
   The DUT mac table must learn the X macs in data plane in T time frame.
   The DUT must send type 2 routes to remote router in T' time frame.
   
   
   
   
 5.2. To check the time taken to learn X  macs from remote peer
      by DUT

   Objective:

   Send X frames with different SA and DA to DUT from R1 using
   traffic generator.  Measure the time taken to learn these X         
   macs from remote peer and program the mac address table.

   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.  All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and
   DUT.Once the bgp comes up check the DUT evpn table.  For MH PE ESI
   must be configured per IFD/Interface.  Using RT(traffic generator) to
   send the traffic to the routers.

   Measurement:

   The DUT mac table must learn the X mac address in T time frame.
   



Jacob & Tiruveedhula     Expires February 22,2017             [Page 5]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


The following test cases are executed to measure the time taken to
flush the mac table in case of an event

5.3.  To check the time taken to flush the local entry due to CE link
      failure

   Objective:

   Send  X frames with different SA and DA to DUT from CE using
   traffic generator.  Then wait to learn all X mac address.
   Then fail the DUT CE link and measure the time taken to flush these
   X routes from the mac table and from control plane.

   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.  All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and DUT.
   Once the bgp comes up check the DUT evpn table.  For MH PE ESI must
   be configured per IFD/Interface.  Using RT(traffic generator) to send
   the traffic to the routers.

   Measurement:

    Measure the time taken for flushing these X mac address.

 
5.4.  To check the time taken by DUT to flush X routes learned
      from remote PE after R1 traffic generator link failure

   Objective:

   Send X frames with different SA and DA to DUT from R1 using
   traffic generator.  Bring down the link between R1 and traffic
   generator.  Then measure the time taken to flush the DUT mac address
   table.

   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.  All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and
   DUT.Once the bgp comes up check the DUT evpn table.For MH PE ESI must
   be configured per IFD/Interface.  Using RT(traffic generator) to send
   the traffic to the routers.

   Measurement:

   Measure the time taken to flush X remote routes from mac table
   of DUT.




Jacob & Tiruveedhula     Expires February 22,2017               [Page 6]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


The following test cases are executed to measure the mac ageing in locally
learned and remote mac learned by control plane.


5.5.  To measure the mac ageing time.

   Objective:

   Send X frames with different SA and DA to DUT from CE using
   traffic generator.  Then wait to learn all X mac address.
   Then stop the traffic.Wait to see how long it takes to flush these
   mac entries due to ageing.

   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.  All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and
   DUT.Once the bgp comes up check the DUT evpn table.  For MH PE ESI
   must be configured per IFD/Interface.  Using RT(traffic generator) to
   send the traffic to the routers.

   Measurement:

   Measure the time taken to flush X mac address due to ageing.
   

5.6.  To check the time taken by DUT to age X routes learned
      from remote PE after stopping the traffic at remote PE.

   Objective:

   Send X frames with different SA and DA to DUT from R1 using
   traffic generator.  After stopping the traffic at remote PE R1
   traffic generator due to mac ageing it will withdraw its routes from
   remote PE's.  Measure the time taken to remove these macs from DUT
   mac table.

   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and
   DUT.Once the bgp comes up check the DUT evpn table.For MH PE ESI must
   be configured per IFD/Interface.  Using RT(traffic generator) to send
   the traffic to the routers.

   Measurement:

   Measure the time taken to flush X remote macs from mac table
   of DUT due to ageing.
   
   






Jacob & Tiruveedhula     Expires February 22,2017              [Page 7]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


The following tests are executed to measure the convergence time in
case of an event or by lerning the mac without any external trigger.


5.7.  To check the time taken by DUT to learn X routes from local
      and X from remote and measure the time of flood from DUT.

   Objective:

   Send X frames with different SA and DA to DUT from R1 using
   traffic generator.  Send X frames with different SA and DA
   from traffic generator connected to CE.  The SA and DA of flows must
   be complimentary to have unicast flows.  Measure the time taken by
   the DUT to learn 2X in mac table and in control plane.Measure
   the flood time period of DUT.

   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and
   DUT.Once the bgp comes up check the DUT evpn table.  For MH PE ESI
   must be configured per IFD/Interface.  Using RT(traffic generator) to
   send the traffic to the routers.

   Measurement:

   Measure the time taken to learn 2X routes in control and mac
   address table in DUT and measure the flood time of DUT.
   



Jacob & Tiruveedhula     Expires February 22,2017              [Page 8]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


5.8.  To measure the time taken to elect a new DF by adding a a MHPE.

   Objective:

   Send X frames from CE to DUT from traffic generator with
   different SA and DA.  Wait to learn all X mac address.  Then
   add R1 to the same Ethernet segment by configuring the same ESI value
   configured in DUT,MHPE2 in IFD.  Then the new DF election take place
   during that time there should not be any loop and measure the time
   taken to come up the new DF.Measure the time taken to elect the new DF.

   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and
   DUT.Once the bgp comes up check the DUT evpn table.  For MH PE ESI
   must be configured per IFD/Interface.  Using RT(traffic generator) to
   send the traffic to the routers.

   Measurement:

   Measure the time taken for new DF election in DUT and there should
   not be any loop or forwarding the BUM traffic back to the same
   segment.
   

   High Availablity
   
   These tests are conducted to check after an event there wont be any
   change in functionality.

5.9.  To check the whether there is traffic loss due to routing engine
      failover for redundancy test.

   Objective:

   Send X frames from CE to DUT from traffic generator with
   different SA and DA.  Send X frames from traffic generator to
   R1 with different SA and DA so that 2X mac address will be
   learned in DUT.  There is a bi directional traffic flow with X
   pps in each direction.  Then do a routing engine failover.
   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and
   DUT.Once the bgp comes up check the DUT evpn table.For MH PE ESI must
   be configured per IFD/Interface.  Using RT(traffic generator) to send
   the traffic to the routers.

   Measurement:





Jacob & Tiruveedhula     Expires February 22,2017             [Page 9]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


   There should not be any traffic loss,No change in the DF role.  No
   withdraw of any routes.


 6. Scale

6.1.  To Scale the DUT to N EVI and clear bgp in DUT with out traffic.

   Objective:

   The main purpose of the test the DUT performance to scale N EVI's.
   Then clear bgp neighbor.  There should not be any loss of routes or
   any crashes.

   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and
   DUT.Once the bgp comes up check the DUT evpn table.For MH PE ESI must
   be configured per IFD/Interface.  Using RT(traffic generator) to send
   the traffic to the routers.

   Measurement
   
 There should not be any loss of route types 1,2,3 and 4 in DUT.


Jacob & Tiruveedhula     Expires February 22,2017             [Page 10]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


  

   
6.2.  To Scale the DUT to N EVI and clear bgp in DUT with traffic.
      Measure the convergence time

   Objective:

   The main purpose of the test the DUT performance to scale N EVI's
   with traffic.  Then clear bgp neighbor.  There should not be any loss
   of routes or any crashes.  Send F frames from CE to DUT from
   traffic generator with different SA and DA for N EVI's.  Send
   F frames from traffic generator to R1 with different SA and DA
   for N EVI's.so that 2F number of mac address will be learned in DUT.
   There is a bi directional traffic flow with F pps in each
   direction.  Then clear the bgp nei in DUT after the bgp comes up and
   started learning the routes, measure the time taken to learn all
   2F mac routes.

   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and
   DUT.Once the bgp comes up check the DUT evpn table.For MH PE ESI must
   be configured per IFD/Interface.  Using RT(traffic generator) to send
   the traffic to the routers.

   Measurement:

   The DUT must learn all 2F mac address.Measure the time taken
   to learn 2F mac in DUT, measure the flood traffic time "t"
   of DUT

 7. Soak Test

7.1.  To Scale the DUT to N EVI in DUT with traffic and run the set up
      for 24hrs

   Objective:

   The main purpose of the test the DUT performance to scale N EVI's
   with traffic.  Then clear bgp neighbor.  There should not be any loss
   of routes or any crashes.  Send  F frames from CE to DUT from
   traffic generator with different SA and DA for N EVI's.  Send
   F frames from traffic generator to R1 with different SA and DA
   for N EVI's.so that 2F mac address will be learned in DUT.
   There is a bi directional traffic flow with F pps in each
   direction.Keep the setup up and running for 24 hrs,take hourly CPU
   utilization,memory usage.




Jacob & Tiruveedhula     Expires February 22,2017            [Page 11]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


   Procedure:

   Configure EVPN EVI in R1,MHPE2,DUT.All 4 routers except CE are
   running mpls,bgp,RR is acting as route reflector to R1,MHPE2 and
   DUT.Once the bgp comes up check the DUT evpn table.For MH PE ESI must
   be configured per IFD/Interface.  Using RT(traffic generator) to send
   the traffic to the routers.

   Measurement:

   Take the hourly reading of CPU,process memory.There should not be any
   leak,crashes,CPU spikes.

   
8.  Acknowledgements

   We would like to thank Bhuvaneswaran Vengainathan of Veryx
   Technologies and Al Morton of (ATT) for their support and
   encouragements.

9.  IANA Considerations

   This memo includes no request to IANA.

10.  Security Considerations

   There is no additional consideration from RFC 6192.

11.  References

11.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

   [RFC2544]  Bradner, S. and J. McQuaid, "Benchmarking Methodology for
              Network Interconnect Devices", RFC 2544,
              DOI 10.17487/RFC2544, March 1999,
              <http://www.rfc-editor.org/info/rfc2544>.
			  
    [RFC2889]  R. Mandeville and J. Perser "Benchmarking Methodology for 
	           LAN Switching Devices"

11.2.  Informative References

   [RFC7412]  Sajassi, A., Ed., Aggarwal, R., Bitar, N., Isaac, A.,
              Uttaro, J., Drake, J., and W. Henderickx, "BGP MPLS-Based
              Ethernet VPN", RFC 7412, DOI 10.17487/RFC7412, February
              2015, <http://www.rfc-editor.org/info/rfc7412>.




Jacob & Tiruveedhula     Expires February 22,2017            [Page 12]

Internet-Draft        EVPN Benchmarking Methodology         August 2016


Appendix A.  Appendix

Authors' Addresses


   Kishore Tiruveedhula
   Juniper Networks
   10 Technology Park Dr
   Westford, MA  01886
   USA

   Phone: +1 9785898861
   Email: kishoret@juniper.net



   Sudhin Jacob (editor)
   Juniper Networks
   Bangalore
   India

   Phone: +91 8061212543
   Email: sjacob@juniper.net
          sudhinjacob@rediffmail.com






























Jacob & Tiruveedhula     Expires February 22,2017             [Page 13]
