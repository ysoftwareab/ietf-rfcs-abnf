<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Extending the Space Available for TCP Options</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Extending the Space Available for TCP Options">
<meta name="keywords" content="TCP Options, TCP Long Options Option">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">W. Eddy</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">NASA GRC/Verizon FNS</td></tr>
<tr><td class="header">Expires: January 2, 2009</td><td class="header">A. Langley</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Google Inc</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 01, 2008</td></tr>
</table></td></tr></table>
<h1><br />Extending the Space Available for TCP Options<br />draft-eddy-tcp-loo-04</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 2, 2009.</p>

<h3>Abstract</h3>

<p>

This document describes a method for increasing the space available for TCP
options.  Two new TCP options (LO and SLO) are detailed which reduce the
limitations imposed by the TCP header's Data Offset field.  The LO option
provides this extension after connection establishment, and the SLO option aids
in transmission of lengthy connection initialization and configuration options.


</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Requirements Notation<br />
<a href="#intro">2.</a>&nbsp;
Introduction<br />
<a href="#lo">3.</a>&nbsp;
The Long Options (LO) Option<br />
<a href="#slo">4.</a>&nbsp;
The SYN Long Options (SLO) Option<br />
<a href="#anchor2">5.</a>&nbsp;
Middlebox Interactions<br />
<a href="#anchor3">6.</a>&nbsp;
Comparison to Extended Segments<br />
<a href="#anchor4">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor5">8.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor6">9.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#anchor9">Appendix&nbsp;A.</a>&nbsp;
Changes<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Requirements Notation</h3>

<p>
   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
   "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
   and "OPTIONAL" in this document are to be interpreted as
   described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].

</p>
<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p>

Every TCP segment's header contains a 4-bit Data Offset (DO) field that implies
the length of that segment's TCP header.  The DO field has been specified as:
"The number of 32-bit words in the TCP Header.  This indicates where the data
begins.  The TCP header (even one including options) is an integral number of
32 bits long" <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>. For a TCP implementation, this means
that the boundary separating TCP control data and application data is always
exactly DO * 4 bytes from the beginning of the TCP header.


</p>
<p>

As a 4-bit unsigned integer, DO's value is bounded between 0 and 15.  This
allows for a maximum TCP header length of 60 bytes (15 * 4 bytes).  The
required fields in a TCP header occupy a fixed 20 bytes, leaving 40 bytes
as the maximum amount of space for use by TCP options.


</p>
<p>

While 40 bytes is a reasonable amount of space, sufficient for the concurrent
use of several presently defined TCP options, there are cases where more space
might be useful.  For example, the Selective Acknowledgement (SACK) option
<a class='info' href='#RFC2018'>[RFC2018]<span> (</span><span class='info'>Mathis, M., Mahdavi, J., Floyd, S., and A. Romanow, &ldquo;TCP Selective Acknowledgment Options,&rdquo; October&nbsp;1996.</span><span>)</span></a> uses a fixed 2 bytes for its kind and length fields,
and requires an additional 8 bytes per SACK block.  Thus, the maximum number of
SACK blocks a TCP acknowledgement may carry is limited to 4 (with 6 bytes left
over).  Since SACK is commonly used with the Timestamp option <a class='info' href='#RFC1323'>[RFC1323]<span> (</span><span class='info'>Jacobson, V., Braden, B., and D. Borman, &ldquo;TCP Extensions for High Performance,&rdquo; May&nbsp;1992.</span><span>)</span></a>, which uses 10 bytes, this further limits the number of SACK
blocks that may be carried to 3.  For specific scenarios involving large
windows and combinations of data and acknowledgement loss, additional capacity
for SACK blocks is known to be useful <a class='info' href='#more-sack'>[more&#8209;sack]<span> (</span><span class='info'>Srijith, K., Jacob, L., and A. Ananda, &ldquo;Worst-case Performance Limitation of TCP SACK and a Feasible Solution,&rdquo; Proceedings of 8th IEEE International Conference on Communications Systems (ICCS), November&nbsp;2002.</span><span>)</span></a>.


</p>
<p>

Creation of new TCP options is also hindered by the lack of space left over
after currently-used options are accounted for.  For long options that must be
present at connection-startup time, this is a particular problem, as all
negotiable options need to share 40 bytes of space in a SYN segment.  One
method that has been used to get around this limitation is overloading the
Timestamp bytes in the SYN segments <a class='info' href='#migrate'>[migrate]<span> (</span><span class='info'>Snoeren, A. and H. Balakrishnan, &ldquo;An End-to-End Approach to Host Mobility,&rdquo; Proc. of the Sixth Annual ACM/IEEE International Conference on Mobile Computing and Networking, August&nbsp;2000.</span><span>)</span></a>.  There are other
header fields that might be similarly overloaded (e.g. the urgent pointer), but
this approach is of obviously limited utility, as it does not address the
fundamental limitation imposed by the DO field, and there are a finite number
of overloadable header bits.


</p>
<p>

This document specifies two new TCP options, LO and SLO.  The Long Options (LO)
option allows two hosts to negotiate for the ability to use TCP headers longer
than 60 bytes (and thus options space of greater than 40 bytes) on subsequent
segments.  This is accomplished by ignoring the DO field's value and adding a
16-bit field at a fixed location in the header's options to replace it.  The
format and usage of the LO option is detailed in <a class='info' href='#lo'>Section&nbsp;3<span> (</span><span class='info'>The Long Options (LO) Option</span><span>)</span></a>.


</p>
<p>

Attempting to process initial SYN segments with greater than 60 bytes of TCP
headers might cause errors if received by hosts that consider anything past the
DO-specified boundary to be application data.  For backwards compatibility
reasons, the maximum length of options on a connection-initiating SYN segment
remains 40.  The SYN Long Options (SLO) option is used in the case where these
40 bytes are not enough space to carry the desired startup configuration
options, and negotiates for later reliable delivery of the left-off options.
<a class='info' href='#slo'>Section&nbsp;4<span> (</span><span class='info'>The SYN Long Options (SLO) Option</span><span>)</span></a> describes the format and usage of the SLO option.


</p>
<a name="lo"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
The Long Options (LO) Option</h3>

<p>

A host might implement some set of TCP options allowing it to predict that
greater than 40 bytes of TCP options space may be useful (for example SACK,
Timestamps, alternate checksums, etc).  In this case, a host MAY implement the
LO option.  When initiating connections through an active open, hosts
implementing the LO option SHOULD place a LO option of the form shown in
<a class='info' href='#fig-lo'>Figure&nbsp;1</a> somewhere in the SYN segment's options.  The 16-bit
field labelled "Header Length" should be filled in with the same value as the
DO field in the required portion of the TCP header, left-padded with zeros.


</p><br /><hr class="insert" />
<a name="fig-lo"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+-------------------------------+
|     Kind =    |  Length = 4   |        Header Length          |
| TDB-IANA-KIND1|               |      (in 4 byte words)        |
+---------------+---------------+-------------------------------+
</pre></div>
<p>TCP Long Options (LO) Option
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>

Receipt of an acknowledgement covering the SYN and also containing an LO
option means that future segments MAY include an LO option which expands the
length of the TCP header beyond the limit of the DO field. The LO option MUST
be the first option and the DO field MUST be set to 6. The value 6 represents
the length of the required portions of the TCP header plus the LO option.


</p>
<p>

An LO option SHOULD NOT be used when not required by the options in a given
segment. A host MUST reject any non-SYN segment containing an LO option if the
DO field is not equal to 6.


</p>
<p>

Since a LO option's Header Length field has greater range than the IP header's
Total Length field <a class='info' href='#RFC0791'>[RFC0791]<span> (</span><span class='info'>Postel, J., &ldquo;Internet Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>, this allows TCP options to consume
an entire maximum-sized IP datagram's length (minus the IP header and required
TCP header fields).  No matter what size the options section of a TCP header
is, it must still be appended with zero-padding to make the total header a
multiple of 32 bits, per RFC 793 <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>.


</p>
<p>

Listening hosts that implement the LO option, after reception of a SYN segment
with the LO option present, SHOULD reply with a LO option in their SYN-ACK.
It can be seen that in both the normal case where one host passively opens and
another actively opens, and the more rare case where two hosts simultaneously
initiate active opens, the LO option's use can be successfully negotiated.


</p>
<a name="slo"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
The SYN Long Options (SLO) Option</h3>

<p>

If the LO option has been successfully negotiated, an active-opening host that
has more bytes of initialization options than would fit in the SYN, can use the
SYN Long Options (SLO) option.  If a host supports the LO option, then it MUST
support the SLO option.


</p>
<p>

Any option bytes transmitted using the SLO option will be treated as if they
were carried on the SYN segment.  Since there is no guarantee that the LO
option will be successfully negotiated, the additional 36 bytes left over aside
from the 4 byte LO option on a SYN segment should be filled with the most
important remaining options that will fit, as determined by the particular
implementation.  A host issuing a passive open, MUST NOT use the SLO option, as
it can use the LO option on SYN-ACK segments if it needs to send long
initialization options.  The SLO option only serves the needs of an
active-opening host that, for backwards compatibility reasons, could not send
more than 40 bytes of options on the SYN segment.


</p>
<p>

After successful LO negotiation, if a host has any options that did not fit on
the SYN, then additional data or acknowledgement segments MUST carry a SLO
option until the first data byte has been acknowledged.  The SLO option's
format is shown in figure <a class='info' href='#fig-slo'>Figure&nbsp;2</a>.  The trailing 2 bytes hold
a 16-bit unsigned count of the additional bytes that would have been in the SYN
segment's options, if they had been possible to include.  This represents an
offset from the end of the SLO option, to the last byte that should be
considered a SYN option.  The next "Additional Byte Count"-number of bytes
trailing the SLO option MUST be the ones that did not fit in the SYN segment.
The SLO option should always immediately follow the LO option, followed by the
additional SYN options, and then by normal options, and finally application
data.


</p><br /><hr class="insert" />
<a name="fig-slo"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+---------------+---------------+-------------------------------+
|     Kind =    |  Length = 4   |    Additional Byte Count      |
| TDB-IANA-KIND2|
+---------------+---------------+-------------------------------+
</pre></div>
<p>TCP SYN Long Options (SLO) Option
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>

Since TCP connection establishment is often concluded by a pure acknowledgement
(carrying no data), only placing the SLO option and additional SYN options in
such a single, unreliable segment would be risky.  This is why a host MUST
continue transmitting SLO options on all segments until its first byte of sent
data is acknowledged.  Acknowledgement of the first data-byte implicitly covers
the SLO and trailing options, as these must have been received end-to-end
with the first data byte.


</p>
<p>

If a host does not send any data bytes, but if by some means (perhaps through
the received options) it is possible to derive either an explicit or implicit
acknowledgement of even a single option transmitted in a SLO-carrying segment
(for example via a Timestamp echo), then a host MAY choose to stop transmitting
the SLO data.  This special case overrides the previously specified MUST
condition.


</p>
<p>

A host SHOULD NOT continue sending SLO options after it has received
acknowledgement of the first data byte, nor should a host process incoming SLO
options other than on the first valid segment it receives that carries them.


</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Middlebox Interactions</h3>

<p>

The large number of middleboxes (firewalls, proxies, protocol scrubbers, etc)
currently present in the Internet pose some difficulty for deploying new TCP
options.  Some firewalls may block segments that carry unknown options.  For
instance, if the LO option is not understood by a firewall, incoming SYNs
advertising LO support may be dropped, preventing connection establishment.
This is similar to the ECN blackhole problem, where certain faulty hosts and
routers throw away packets with ECN bits set <a class='info' href='#RFC3168'>[RFC3168]<span> (</span><span class='info'>Ramakrishnan, K., Floyd, S., and D. Black, &ldquo;The Addition of Explicit Congestion Notification (ECN) to IP,&rdquo; September&nbsp;2001.</span><span>)</span></a>.  Some
recent results indicate that for new TCP options, this may not be a significant
threat, with only 0.2% of web requests failing when carrying an unknown option
<a class='info' href='#transport-middlebox'>[transport&#8209;middlebox]<span> (</span><span class='info'>Medina, A., Allman, M., and S. Floyd, &ldquo;Measuring Interactions Between Transport Protocols and Middleboxes,&rdquo; ACM SIGCOMM/USENIX Internet Measurement Conference, October&nbsp;2004.</span><span>)</span></a>.


</p>
<p>

More problematic, are the implications of TCP connection-splitting middleboxes
and protocol scrubbers that do not understand the LO option.  Since such
middleboxes may operate on a packet's contents (aggregating application data
between multiple segments, rewriting sequence numbers, etc), if the LO option
is not understood, then there may be a mangling of the data passed to the
application, as control data could end up inter-mingled with the application
data.  Such errors could be difficult to detect at the transport layer, and
many applications might not perform their own integrity checks.  An encouraging
fact is that some of these devices reset connection attempts when they see TCP
options that they do not understand.  Hosts that implement the TCP options
described in this document MAY retry connection attempts without LO options on
the SYNs, if their first attempt with LO options fails.


</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Comparison to Extended Segments</h3>

<p>

Another proposal that solves the same problem as the LO and SLO options is that
of TCP "extended segments" <a class='info' href='#ex-segs'>[ex&#8209;segs]<span> (</span><span class='info'>Kohler, E., &ldquo;Extended Option Space for TCP,&rdquo; Internet Draft (work in progress), September&nbsp;2004.</span><span>)</span></a>.  The extended segments
technique was proposed following the initial introduction and discussion of the
LO and SLO options within the IETF's TCP Maintenance and Minor Extensions
working group.  The two methods solve the same problem in rather different
ways, and have several minor comparative advantages and disadvantages.


</p>
<p>

The LO and SLO options are designed using the philosophy of using the TCP
options space to compensate for insufficiency of the standard header.  This is
in keeping with the way that several currently-used options work.  For example,
the Window Scale option deals with the limited space in the advertised receive
window field, and the Selective Acknowledgement option solves the lack of
information in the cumulative acknowledgement field.  Extended segments
approach overloads the meaning of the standard Data Offset field, keeping its
original meaning for values of 5 and greater, but redefining it for values less
than 5.  This is seen as acceptable since values less than 5 are currently
impossible, illegal, and unusable.  Extended segments avoid the need for new
options by changing the way that the existing standard header is parsed.


</p>
<p>

A key advantage of the extended segments approach is that it does not increase
the TCP header size, whereas the LO option adds 4 bytes of space to TCP
headers.  The severity or triviality of this bloat in header overhead depends
entirely upon the network properties and application traffic for particular
use cases.


</p>
<p>

It is also not altogether clear that extended segments will always save space
in comparison to LO options.  The granularity of option lengths that extended
segments can support is limited to the number of unusable Data Offset values
(5, 0 through 4).  Currently, the extended segments proposal defines 4 fixed
lengths, and one "infinite" length that means the entire segment is options,
with no application data.  The fixed option lengths are 48, 64, 128, and 256
bytes.  If the required per-data-segment options space for some extension or
combination of extensions does not map to exactly these values, then padding
bytes are required.  If 129 bytes of options are required on a data segment,
then a length of 256 must be used, and 127 bytes of useless padding are added.
The LO option has a single-byte granularity and avoids the need for all
wasteful padding, aside from that mandated to make the header a perfect
multiple of 4-bytes.  It is possible that the overhead on a single extended
segment could be more than that of several segments using the LO option.


</p>
<p>

Some networkers have found the SLO mechanism that is required for processing of
long initialization options to be somewhat "ugly".  Extended segments avoid
this by sending long initialization options on the initial SYN and SYN-ACK
segments.  If the other side does not support extended segments, this adds
needless confusion and delay in connection setup.  The protocol dance to
negotiate use of extended segments is arguably much worse than using SLO.  If
an extended SYN is not understood, a non-reliably transmitted RST segment
signals the initiating host to retry without extended segments.  Such a retry
mechanism is not commonly found in existing TCP implementations.  If the LO
option is not understood, a SYN-ACK is still immediately generated and the
connection goes on uninterrupted, without any additional retry mechanisms.
Furthermore, extended SYN-ACKs may be sent in response to non-extended SYNs.
This complicates the recovery procedure even more, if not understood, and goes
against the way that all current negotiable TCP extensions operate (only
used on SYN-ACK if advertised on SYN).


</p>
<p>

Over-zealous middleboxes are immensely troublesome for the deployment of most
transport layer extensions.  It is unclear whether LO and extended segments
have any real difference in robustness in the presence of different types of
middleboxes.  Both types of segments may appear as invalid to some middleboxes,
and both may be mangled if rewritten by a middlebox.


</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>

The TCP options presented in this document open no additional vulnerabilities
that we are aware of.


</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>

This document does not create any new registries or modify the rules for any
existing registries managed by IANA.


</p>
<p>

This document requires IANA to update values in its registry of TCP options
numbers to assign two new entries, referred herein as
<tt>TBD-IANA-KIND1</tt> and
<tt>TBD-IANA-KIND2</tt>.


</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgements</h3>

<p>

This document benefitted specifically from discussions with Josh Blanton and
Shawn Ostermann.  Some comments from Eddie Kohler motivated the discussion of
middlebox interactions.  Valuable feedback was obtained from Mark Allman and
other participants in the TCP Maintenance and Minor Extensions (TCPM) Working
Group.


</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC0793">[RFC0793]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>,&rdquo; STD&nbsp;7, RFC&nbsp;793, September&nbsp;1981 (<a href="http://www.rfc-editor.org/rfc/rfc793.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC0791">[RFC0791]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc791">Internet Protocol</a>,&rdquo; STD&nbsp;5, RFC&nbsp;791, September&nbsp;1981 (<a href="http://www.rfc-editor.org/rfc/rfc791.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1323">[RFC1323]</a></td>
<td class="author-text"><a href="mailto:van@CSAM.LBL.GOV">Jacobson, V.</a>, <a href="mailto:Braden@ISI.EDU">Braden, B.</a>, and <a href="mailto:dab@cray.com">D. Borman</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1323">TCP Extensions for High Performance</a>,&rdquo; RFC&nbsp;1323, May&nbsp;1992 (<a href="http://www.rfc-editor.org/rfc/rfc1323.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2018">[RFC2018]</a></td>
<td class="author-text"><a href="mailto:mathis@psc.edu">Mathis, M.</a>, <a href="mailto:mahdavi@psc.edu">Mahdavi, J.</a>, <a href="mailto:floyd@ee.lbl.gov">Floyd, S.</a>, and <a href="mailto:allyn@eng.sun.com">A. Romanow</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2018">TCP Selective Acknowledgment Options</a>,&rdquo; RFC&nbsp;2018, October&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2018.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2018.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2018.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="more-sack">[more-sack]</a></td>
<td class="author-text">Srijith, K., Jacob, L., and A. Ananda, &ldquo;Worst-case Performance Limitation of TCP SACK and a Feasible Solution,&rdquo; Proceedings of 8th IEEE International Conference on Communications Systems (ICCS), November&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="migrate">[migrate]</a></td>
<td class="author-text">Snoeren, A. and H. Balakrishnan, &ldquo;An End-to-End Approach to Host Mobility,&rdquo; Proc. of the Sixth Annual ACM/IEEE International Conference on Mobile Computing and Networking, August&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3168">[RFC3168]</a></td>
<td class="author-text">Ramakrishnan, K., Floyd, S., and D. Black, &ldquo;<a href="http://tools.ietf.org/html/rfc3168">The Addition of Explicit Congestion Notification (ECN) to IP</a>,&rdquo; RFC&nbsp;3168, September&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3168.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="transport-middlebox">[transport-middlebox]</a></td>
<td class="author-text">Medina, A., Allman, M., and S. Floyd, &ldquo;Measuring Interactions Between Transport Protocols and Middleboxes,&rdquo; ACM SIGCOMM/USENIX Internet Measurement Conference, October&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="ex-segs">[ex-segs]</a></td>
<td class="author-text">Kohler, E., &ldquo;Extended Option Space for TCP,&rdquo; Internet Draft (work in progress), September&nbsp;2004.</td></tr>
</table>

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Changes</h3>

<p>To be removed by RFC Editor before publication
</p>
<p>Changes since 03
</p>
<p>
        </p>
<ol class="text">
<li>Change the option numbers specified to placeholders:
            <tt>TBD-IANA-KIND1</tt> and
            <tt>TBD-IANA-KIND2</tt>.
          
</li>
<li>Change the requirement that all segments include the LO option, if
            negotiated, to a SHOULD NOT unless the options require it.  The
            reasoning behind the initial requirement was for implementation ease but,
            having implemented it myself, the ability to use the fast path processing
            for LO connections outweighs that.
</li>
<li>Change the units of the LO option from bytes to words. This was
            ambiguous in the 03 draft and, since padding to four bytes was
            required anyway, it seemed best to remove one extra way that the
            option could be invalid.  
</li>
</ol><p>
      
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wesley M. Eddy</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NASA GRC/Verizon FNS</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">21000 Brookpark Rd, MS 54-5</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cleveland, OH  44135</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">216-433-6682</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:weddy@grc.nasa.gov">weddy@grc.nasa.gov</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adam Langley</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Google Inc</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:agl@imperialviolet.org">agl@imperialviolet.org</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
