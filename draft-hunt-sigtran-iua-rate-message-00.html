<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IUA Extension for Rate Control Message</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IUA Extension for Rate Control Message">
<meta name="keywords" content="RFC, Request for Comments, I-D, Internet-Draft, Real Time Control Protocol">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Sigtran Working Group</td><td class="header">N. Stewart</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">G. Hunt</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">BT</td></tr>
<tr><td class="header">Expires: September 3, 2009</td><td class="header">D. Chohan</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Ftel</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 02, 2009</td></tr>
</table></td></tr></table>
<h1><br />IUA Extension for Rate Control Message<br />draft-hunt-sigtran-iua-rate-message-00.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 3, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
   This document describes a new message, its associated acknowledgement message, and a new parameter 
to extend the 
ISDN Q.921-User Adaptation (IUA) protocol (RFC4233).  The protocol extension is to support the use of 
an Overload Control Agent in a Signaling Gateway (SG). The Overload Control Agent is able to restrict the
admission of new originating ISDN calls (sessions) messages from the ISDN End Point to each Application 
Server Process (ASP). Both 
messages defined here contain a single mandatory parameter, the Call (Session) Admission Rate. An ASP 
is able to use this protocol extension to control the rate of new calls admitted towards that ASP by the 
Overload Control Agent.

</p>
<p>
  The new message and its acknowledgement message are added to the 
   Application Server Process Traffic Maintenance (ASPTM) message 
   class.  

</p>
<p>
As the DPNSS1/DASS2 Extension to IUA (DUA, RFC4129) also uses the ASPTM message class, the IUA protocol extension 
described in this document also applies to DUA.

</p>
<p>
For backward compatibility, a Signaling Gateway which does not support the new message is expected to follow 
standard IUA behaviour 
by discarding the message, and returning an error code of "Unsupported Message Type" to the sender. 

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro1">1.1.</a>&nbsp;
Requirement for overload control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#introscope">1.2.</a>&nbsp;
Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro2">1.3.</a>&nbsp;
Analogy with etsi_nr overload control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#intro3">1.4.</a>&nbsp;
Applicability to DUA<br />
<a href="#rfc2119">2.</a>&nbsp;
Requirements Notation<br />
<a href="#definitions">3.</a>&nbsp;
Definitions<br />
<a href="#new">4.</a>&nbsp;
New Admission Rate and Acknowledgement Messages and New Parameter<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#messages">4.1.</a>&nbsp;
New Message Types<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#parameter">4.2.</a>&nbsp;
New Parameter<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#aspcar">4.3.</a>&nbsp;
ASP Call (Session) Admission Rate (ASPCAR) Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#aspcarack">4.4.</a>&nbsp;
ASP Call (Session) Admission Rate Ack (ASPCAR Ack) Message Format<br />
<a href="#procs">5.</a>&nbsp;
Procedures<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">5.1.</a>&nbsp;
Basic procedures<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">5.2.</a>&nbsp;
ASP States and the ASPCAR message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">5.3.</a>&nbsp;
Applicability to DUA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#procack">5.4.</a>&nbsp;
Procedures for use of the rate parameter acknowledgment<br />
<a href="#anchor4">6.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor5">7.</a>&nbsp;
Security Considerations<br />
<a href="#mscs">8.</a>&nbsp;
Informative Appendix: Message Sequence Diagrams for Acknowledgements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smscnorm">8.1.</a>&nbsp;
Message sequence for normal transmission<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smsclost">8.2.</a>&nbsp;
Message sequence for a lost message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smscdelayed">8.3.</a>&nbsp;
Message sequence for late acknowledgement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smscupdated">8.4.</a>&nbsp;
Message sequence for updated rate<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smsclostupdated">8.5.</a>&nbsp;
Message sequence for lost message and updated rate<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smsclostupdate">8.6.</a>&nbsp;
Message sequence for lost rate update<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smscseqerr">8.7.</a>&nbsp;
Message sequence for sequencing error<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smscseqerrloss">8.8.</a>&nbsp;
Message sequence for sequencing error and lost acknowledgement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#smscupdateackloss">8.9.</a>&nbsp;
Message sequence for updated rate and lost acknowledgement<br />
<a href="#anchor6">9.</a>&nbsp;
Contributors<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
   This document describes a new message type, its associated acknowledgement message type, a new parameter type,
and the associated procedures as an extension to the
   current IUA protocol <a class='info' href='#RFC4233'>[RFC4233]<span> (</span><span class='info'>Morneault, K., &ldquo;Integrated Services Digital Network (ISDN) Q.921-User Adaptation Layer,&rdquo; January&nbsp;2006.</span><span>)</span></a>. 
The protocol extension supports the use of an Overload Control Agent in the Signaling Gateway.

</p>
<a name="intro1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirement for overload control</h3>

<p>
   In IUA applications, many ISDN End Points (EPs) may be connected via a smaller 
   number of Signaling Gateways (SGs) and thence to a
   small number of Application Server Processes (ASPs), possibly distributed over hardware 
resources at one or more hosts. 
It is possible that   an increase in call
   attempt levels across many or all of the SGs will cause some or all of the ASPs' host hardware resources to
   become overloaded.  This can lead to congestion collapse of some or all of the
   ASPs, resulting in denial of service. Use of this protocol extension allows an ASP to request a 
reduction in traffic offered to that ASP by an SG. 

</p>
<p>
Ideally the resulting 
aggregated offered traffic results in a processing load on the ASP which is close to system capacity.

</p>
<p>
Overload control mechanisms are invoked when load is high and systems are consequently stressed. 
Although the protocol extension described here is intended for control of load offered to an ASP, 
the SG may also be overloaded at the same time. Whilst IUA runs over a reliable transport (SCTP), the 
SG's internal load controls may involve tail drop at internal queues during SG overload. Protocol messages,
including messages associated with overload control, may be lost. Hence it is 
desirable to build 
in to the protocol extension some robustness for the ASP to ensure that the SG's rate control is operating at the rate 
most recently commanded by the ASP, rather than at some other rate. For example, during overload, 
it is important for the ASP to ensure that a rate restriction has been received by the Overload Control Agent, 
and to be permitted 
to resend the rate until the state of the Overload Control Agent's rate restriction is known to be correct. Less obviously, it 
is important to be sure that a restrictive rate control has been removed from the SG following abatement of the 
overload. If a restrictive rate control is not removed, normal service may be adversely affected for an extended 
period.

</p>
<a name="introscope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Scope</h3>

<p>
The scope of this document is limited to describing:

</p>
<p>
</p>
<ul class="text">
<li>
a proposed protocol extension to IUA to support rate control by
      the ASP of:

<ul class="text">
<li>
new originating ISDN call admission requests from the SG to the ASP; and

</li>
<li>
new originating requests from the SG to the ASP to set up user packet sessions

</li>
</ul>

</li>
<li>
recommended behaviours at the SG and at the ASP to make use of the rate 
acknowledgement mechanism defined in the protocol extension.

</li>
</ul><p>

</p>
<p>
In descriptive text in the remainder of the document, references to 
the setting up of "new originating ISDN calls" should be taken to 
include the setting up of new originating user packet sessions.

</p>
<p>
It may be helpful to state explicitly that the following items are outside 
the scope of this document:

</p>
<p>
</p>
<ul class="text">
<li>
the design and operation of overload control algorithms at the ASP (or higher) 
application layer, which calculate the Call (Session) Admission Rate values 
to be transported by the protocol extension described here;

</li>
<li>
the design and operation of the Overload Control Agent in the SG, for example how it 
identifies new originating ISDN calls, the detailed mechanism for admitting new
originating ISDN calls at the required rate, how it satisfies 
the ISDN protocol requirements of the ISDN End Point whilst not involving the ASP 
in processing a call setup message, and how it might give priority to certain 
call types (such as emergency calls or calls from high priority lines) whilst restricting the overall rate of 
new originating ISDN calls offered to the ASP;

</li>
<li>
the application of the mechanism described here to more complex cases such as 
load-sharing between an SG and a number of ASPs. However it is believed that 
the protocol mechanism described, which allows independent control for each pairwise relationship between 
an SG and an ASP, provides the protocol support required for effective control in more complex cases.

</li>
</ul><p>

</p>
<p>
Other Standards Development Organisations could produce recommendations
covering these and other aspects of a system for overload control, referring to 
the current document for details of the IUA protocol extension and associated procedures. 

</p>
<a name="intro2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Analogy with etsi_nr overload control</h3>

<p>
The proposed mechanism is analogous to the 
etsi_nr  (Notification Rate) mechanism defined in <a class='info' href='#ETSI_NR'>[ETSI_NR]<span> (</span><span class='info'>ETSI Standard, &ldquo;NGN Overload Control Architecture; Part 4: Adaptative Control for the MGC,&rdquo; April&nbsp;2007.</span><span>)</span></a>. The protocol extension defined here allows an ASP to 
regulate originating ISDN calls that are offered to it using ISDN signaling. The mechanism of 
<a class='info' href='#ETSI_NR'>[ETSI_NR]<span> (</span><span class='info'>ETSI Standard, &ldquo;NGN Overload Control Architecture; Part 4: Adaptative Control for the MGC,&rdquo; April&nbsp;2007.</span><span>)</span></a> allows 
an MGC to regulate originating analogue calls that are offered to it using the Gateway Control Protocol 
<a class='info' href='#H.248'>[H.248]<span> (</span><span class='info'>ITU-T Recommendation, &ldquo;Gateway control protocol: Version 3,&rdquo; September&nbsp;2005.</span><span>)</span></a>. 
Discussion in
<a class='info' href='#ETSI_NR'>[ETSI_NR]<span> (</span><span class='info'>ETSI Standard, &ldquo;NGN Overload Control Architecture; Part 4: Adaptative Control for the MGC,&rdquo; April&nbsp;2007.</span><span>)</span></a> provides additional background to the requirements and implementation of this type of control.

</p>
<a name="intro3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Applicability to DUA</h3>

<p>
DUA <a class='info' href='#RFC4129'>[RFC4129]<span> (</span><span class='info'>Mukundan, R., &ldquo;Digital Private Network Signaling System (DPNSS)/                       Digital Access Signaling System 2 (DASS 2)                      Extensions to the IUA Protocol,&rdquo; August&nbsp;2005.</span><span>)</span></a> uses the IUA ASPTM message class and hence an ASP MAY use this extension to IUA 
to regulate the rate of originating DASS2/DPNSS calls offered to the ASP. 

</p>
<a name="rfc2119"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Requirements Notation</h3>

<p>
The requirements notation used in this document is defined in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.

</p>
<p>
This protocol extension is OPTIONAL, both at the SG and at the ASP. Requirements notation used below is to be interpreted in 
this context. For example, if text such as "The entity SHALL..." is used below, it is to be interpreted as meaning "If the entity 
(SG or ASP) implements this OPTIONAL protocol extension, then it SHALL...".

</p>
<a name="definitions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Definitions</h3>

<p>
AS

</p>
<p>
</p>
<blockquote class="text">
<p>
Application Server, as described in <a class='info' href='#RFC4233'>[RFC4233]<span> (</span><span class='info'>Morneault, K., &ldquo;Integrated Services Digital Network (ISDN) Q.921-User Adaptation Layer,&rdquo; January&nbsp;2006.</span><span>)</span></a>.

</p>
</blockquote><p>

</p>
<p>
ASP

</p>
<p>
</p>
<blockquote class="text">
<p>
Application Server Process, as described in <a class='info' href='#RFC4233'>[RFC4233]<span> (</span><span class='info'>Morneault, K., &ldquo;Integrated Services Digital Network (ISDN) Q.921-User Adaptation Layer,&rdquo; January&nbsp;2006.</span><span>)</span></a>.

</p>
</blockquote><p>

</p>
<p>
   MGC

</p>
<p>
</p>
<blockquote class="text">
<p>
Media Gateway Controller, as described in <a class='info' href='#RFC2719'>[RFC2719]<span> (</span><span class='info'>Ong, L., &ldquo;Framework Architecture for Signaling Transport,&rdquo; October&nbsp;1999.</span><span>)</span></a>. The use of MGCs in the context of IUA 
is further described in <a class='info' href='#RFC4233'>[RFC4233]<span> (</span><span class='info'>Morneault, K., &ldquo;Integrated Services Digital Network (ISDN) Q.921-User Adaptation Layer,&rdquo; January&nbsp;2006.</span><span>)</span></a>.

</p>
</blockquote><p>

</p>
<p>
   SG

</p>
<p>
</p>
<blockquote class="text">
<p>
Signaling Gateway as described in <a class='info' href='#RFC2719'>[RFC2719]<span> (</span><span class='info'>Ong, L., &ldquo;Framework Architecture for Signaling Transport,&rdquo; October&nbsp;1999.</span><span>)</span></a>. The use of SGs in the context of IUA 
is further described in <a class='info' href='#RFC4233'>[RFC4233]<span> (</span><span class='info'>Morneault, K., &ldquo;Integrated Services Digital Network (ISDN) Q.921-User Adaptation Layer,&rdquo; January&nbsp;2006.</span><span>)</span></a>.

</p>
</blockquote><p>

</p>
<p>
Overload Control Agent

</p>
<p>
</p>
<blockquote class="text">
<p>
      The functional entity residing in the SG that is responsible for 
      ensuring that new originating calls (sessions) admitted to the ASP
      conform to the rate signalled by the ASP.

</p>
</blockquote><p>

</p>
<p>
Originating ISDN Call

</p>
<p>
</p>
<blockquote class="text">
<p>
      An attempt to establish a transmission path used for transporting voice 
      or voice band data which is initiated by the ISDN user sending an ISDN call 
establishment message, such as a DSS1 SETUP message.

</p>
</blockquote><p>

</p>
<a name="new"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
New Admission Rate and Acknowledgement Messages and New Parameter</h3>

<p>
   <a class='info' href='#RFC4233'>[RFC4233]<span> (</span><span class='info'>Morneault, K., &ldquo;Integrated Services Digital Network (ISDN) Q.921-User Adaptation Layer,&rdquo; January&nbsp;2006.</span><span>)</span></a> defines an Application Server Process Traffic Maintenance
   (ASPTM) Message Class within IUA including the messages types ASP
   Active, ASP Active Ack, ASP Inactive, ASP Inactive Ack.

</p>
<p>
   This document defines two new messages as part of the ASPTM message class
   to support the operation of an Overload Control Agent in an SG.  The first 
new message is
   called "ASP Call (Session) Admission Rate". The second new message
is the corresponding
   acknowledgement, and is called "ASP Call (Session) Admission Rate
   Ack".

</p>
<p>
This document also defines a new parameter to convey the required originating ISDN Call (Session) Admission Rate value.

</p>
<p>
For backward compatibility, a Signaling Gateway which does not support the new ASP Call (Session) Admission Rate 
message MUST follow 
standard IUA behaviour by discarding the message, and returning an Error (ERR) message with Error Code 
Unsupported Message Type to the sender. 

</p>
<a name="messages"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
New Message Types</h3>

<p>
The following list contains the new message names for the messages defined
   in this document.

</p>
<p>
    Application Server Process Traffic Maintenance (ASPTM) messages

</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Value</th><th align="left">Message Name</th><th align="left">Short Name</th></tr>
<tr>
<td align="left">TBD1</td>
<td align="left">ASP Call (Session) Admission Rate</td>
<td align="left">ASPCAR</td>
</tr>
<tr>
<td align="left">TBD2</td>
<td align="left">ASP Call (Session) Admission Rate Ack</td>
<td align="left">ASPCAR Ack</td>
</tr>
</table>
<br clear="all" />

<p>
NOTE TO RFC EDITOR - please substitute IANA allocations for TBD1 and TBD2 above.

</p>
<p>
In common with all ASPTM messages, both new messages use only the Common Message Header 
defined in Section 3.1 of <a class='info' href='#RFC4233'>[RFC4233]<span> (</span><span class='info'>Morneault, K., &ldquo;Integrated Services Digital Network (ISDN) Q.921-User Adaptation Layer,&rdquo; January&nbsp;2006.</span><span>)</span></a>.

</p>
<a name="parameter"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
New Parameter</h3>

<p>
The following new TLV parameter is defined in this document

</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Parameter ID</th><th align="left">Parameter Name</th></tr>
<tr>
<td align="left">TBD3</td>
<td align="left">Call (Session) Admission Rate</td>
</tr>
</table>
<br clear="all" />

<p>
   NOTE TO RFC EDITOR - please substitute IANA allocation for TBD3 above.

</p>
<a name="aspcar"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
ASP Call (Session) Admission Rate (ASPCAR) Message Format</h3>

<p>
The ASP Call (Session) Admission Rate (ASPCAR) message is sent by an ASP to an SG. An SG which supports the
new message type
SHOULD limit the mean rate of new originating ISDN call setup messages from the SG to the ASP, to no more than the indicated value.
The SG MAY implement the rate restriction using a leaky bucket but further details of the means by which the SG 
achieves this rate-limitation are outside the scope of this document.

</p>
<p>
The ASPCAR message contains the following parameters:

</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Parameter</th><th align="left">Mandatory/Optional</th></tr>
<tr>
<td align="left">Call (Session) Admission Rate</td>
<td align="left">(Mandatory)</td>
</tr>
<tr>
<td align="left">INFO String</td>
<td align="left">(Optional)</td>
</tr>
</table>
<br clear="all" />

<p>
   The format for ASPCAR Message parameters is as follows:

</p><br /><hr class="insert" />
<a name="figure1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Tag = TBD3            |           Length = 8          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            setrat                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Tag = 0x0004          |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   \                                                               \
   /                         INFO String                           /
   \                                                               \
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: ASP Call (Session) Admission Rate&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
NOTE TO RFC EDITOR - please substitute IANA allocation for TBD3 above.

</p>
<p>
setrat: 32-bit 2's complement signed integer

</p>
<p>
The parameter setrat is the mandatory Call (Session) Admission Rate parameter. It represents a rate, 
in units of 
one-thousandth calls/s. For example, a value 5730 indicates that the SG
SHOULD limit new calls offered to the ASP to a rate of 5.730 calls/s.

</p>
<p>
A value of 0 means that the SG SHALL NOT admit 
any new originating ISDN calls to the particular ASP. 

</p>
<p>
A value >0 means that calls the SG SHALL admit new originating ISDN calls 
to the particular ASP at a mean rate not exceeding the specified rate. Methods for 
measurement of the mean rate are application-dependent and are outside the scope 
of this document.

</p>
<p>
A value of &lt;0 means 
that the SG SHALL admit all new originating ISDN calls to the particular ASP.

</p>
<p>
INFO String

</p>
<p>
   The optional INFO String parameter can carry any meaningful 8-bit
   ASCII <a class='info' href='#ascii'>[ascii]<span> (</span><span class='info'>ANSI, &ldquo;Coded Character Set 7-Bit American Standard Code for Information Interchange,&rdquo; 1986.</span><span>)</span></a> character string along with the message.  Length of the
   INFO String parameter is from 0 to 255 characters.  No procedures are
   presently identified for its use, but the INFO String MAY be used for
   debugging purposes.

</p>
<a name="aspcarack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
ASP Call (Session) Admission Rate Ack (ASPCAR Ack) Message Format</h3>

<p>
The ASP Call (Session) Admission Rate Ack (ASPCAR Ack) message is used by an SG to acknowledge an ASPCAR message from 
an ASP at a remote IUA peer.

</p>
<p>
The ASPCAR Ack message contains the following parameters:

</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Parameter</th><th align="left">Mandatory/Optional</th></tr>
<tr>
<td align="left">Call (Session) Admission Rate</td>
<td align="left">(Mandatory)</td>
</tr>
<tr>
<td align="left">INFO String</td>
<td align="left">(Optional)</td>
</tr>
</table>
<br clear="all" />

<p>
   The format for ASPCAR Ack Message parameters is as follows:

</p><br /><hr class="insert" />
<a name="figure2"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Tag = TBD3            |           Length = 8          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            setrat                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Tag = 0x0004          |             Length            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   \                                                               \
   /                         INFO String                           /
   \                                                               \
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: ASP Call (Session) Admission Rate Ack&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
NOTE TO RFC EDITOR - please substitute IANA allocation for TBD3 above.

</p>
<p>
setrat: 32-bit 2's complement signed integer

</p>
<p>
The parameter setrat is the mandatory Call (Session) Admission Rate parameter. For the units of this 
parameter, see the description in <a class='info' href='#aspcar'>Section&nbsp;4.3<span> (</span><span class='info'>ASP Call (Session) Admission Rate (ASPCAR) Message Format</span><span>)</span></a> above.

</p>
<p>
In the ASPCAR Ack message, the parameter setrat MUST be set by the SG to the setrat value 
from the ASPCAR message which is acknowledged by this ASPCAR Ack. 

</p>
<p>
The setrat parameter in the ASPCAR Ack provides positive confirmation to the
ASP of the successful reception of a specific rate value by the Overload Control Agent. See 
<a class='info' href='#intro1'>Section&nbsp;1.1<span> (</span><span class='info'>Requirement for overload control</span><span>)</span></a> for motivation for this acknowledgement. See <a class='info' href='#procack'>Section&nbsp;5.4<span> (</span><span class='info'>Procedures for use of the rate parameter acknowledgment</span><span>)</span></a> for 
recommended procedures associated with the use of this parameter.

</p>
<p>
INFO String

</p>
<p>
   The optional INFO String parameter can carry any meaningful 8-bit
   ASCII <a class='info' href='#ascii'>[ascii]<span> (</span><span class='info'>ANSI, &ldquo;Coded Character Set 7-Bit American Standard Code for Information Interchange,&rdquo; 1986.</span><span>)</span></a> character string along with the message.  Length of the
   INFO String parameter is from 0 to 255 characters.  No procedures are
   presently identified for its use, but the INFO String MAY be used for
   debugging purposes.

</p>
<a name="procs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Procedures</h3>

<p>
This section describes procedures associated with the use of the protocol extension described in this document. Support of these 
extension protocol procedures is OPTIONAL for both the ASP and the SG.

</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Basic procedures</h3>

<p>
To limit the SG's call admission rate towards itself, an ASP SHALL send an ASPCAR 
message containing a Call (Session) Admission Rate parameter with the required setrat value.

</p>
<p>
On receipt of a valid ASPCAR message the SG SHALL respond to the sender with an ASPCAR Ack
containing a Call (Session) Admission Rate parameter which echoes the received setrat value.  The SG SHOULD 
retain the received setrat value as the new current value for rate restriction to that ASP.

</p>
<p>
The ASP SHALL use the receipt of the ASPCAR Ack message in response to an ASPCAR message as a positive 
acknowledgement that the SG supports this optional protocol extension and that the new setrat value has 
been registered by the SG's Overload Control Agent.

</p>
<p>
   If the ASP receives an ERR message with an Error Code "Unsupported 
   Message Type" in response to an ASPCAR message whilst it is awaiting 
   an ASPCAR Ack message, then:

</p>
<p>
</p>
<ul class="text">
<li>
it SHOULD send no further ASPCAR
   messages to that SG 

</li>
<li>
it SHOULD stop
   timer T(ack), providing it can correlate the ERR message with the 
   offending ASPCAR message (e.g. via the optional diagnostic field contained
   in the ERR message).

</li>
<li>
it MAY follow an alternative strategy of overload control 
   which is outside the scope of this document

</li>
</ul><p>

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
ASP States and the ASPCAR message</h3>

<p>
   An SG SHALL accept an ASPCAR message
   from an ASP when its 
   ASP state is either ASP-ACTIVE or ASP-INACTIVE, see Figure 6 of <a class='info' href='#RFC4233'>[RFC4233]<span> (</span><span class='info'>Morneault, K., &ldquo;Integrated Services Digital Network (ISDN) Q.921-User Adaptation Layer,&rdquo; January&nbsp;2006.</span><span>)</span></a>. 
This provides the ASP with the flexibility to apply rate control prior
   to entry to the ASP-ACTIVE state. 

</p>
<p>
If the SG receives an ASPCAR 
   message whilst in the ASP-DOWN state, then it SHALL return an ERR message with an Error 
   Code "Protocol Error". The SG SHALL NOT take any further action on the 
   ASPCAR message.

</p>
<p>
When the SG's ASP state (Figure 6 of <a class='info' href='#RFC4233'>[RFC4233]<span> (</span><span class='info'>Morneault, K., &ldquo;Integrated Services Digital Network (ISDN) Q.921-User Adaptation Layer,&rdquo; January&nbsp;2006.</span><span>)</span></a>) enters state ASP-INACTIVE or ASP-DOWN from any other state, 
the SG SHALL cease restriction for that ASP and ensure that all offered originating ISDN calls are admitted to
   the ASP.

</p>
<p>
The ASP SHOULD send ASPCAR only when it is likely that the SG's ASP state is 
ASP-INACTIVE or ASP-ACTIVE.

</p>
<p>
The SG will admit all calls following an SG transition to state ASP-INACTIVE, as described above. 
Hence if it is necessary to maintain a rate control parameter >0 after the SG has moved to state ASP-INACTIVE, the ASP SHOULD send 
an ASPCAR message to set this rate.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Applicability to DUA</h3>

<p>
DUA <a class='info' href='#RFC4129'>[RFC4129]<span> (</span><span class='info'>Mukundan, R., &ldquo;Digital Private Network Signaling System (DPNSS)/                       Digital Access Signaling System 2 (DASS 2)                      Extensions to the IUA Protocol,&rdquo; August&nbsp;2005.</span><span>)</span></a> uses the IUA ASPTM message class and hence this proposed extension to IUA 
can be used to regulate DUA signaling as well as IUA signaling. 

</p>
<p>
In cases where an SG sends new originating ISDN calls to a single ASP using both IUA and DUA signaling, 
the rate conveyed in ASPCAR messages applies to the aggregate (IUA and DUA traffic 
combined) of new originating ISDN calls.

</p>
<a name="procack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Procedures for use of the rate parameter acknowledgment</h3>

<p>
This section describes the SG and ASP behaviour, including the use of the setrat field in the ASPCAR Ack message, 
so that the ASP may ensure that the SG is applying the correct rate restriction. It is assumed here that 
IUA provides reliable in-sequence bidirectional delivery of messages between an ASP and an SG. 

</p>
<p>
Sequencing of Call 
(Session) Admission Rate messages for a given ASP-SG association SHOULD be preserved within ASPs and SGs. This 
implies that Call 
(Session) Admission Rate messages and acknowledgements for a given ASP-SG association SHOULD NOT be routed via different queues, or 
handled by different processes or threads, in an SG or ASP implementation which uses such techniques internally.
However it is recognised that 
Call (Session) Admission Rate messages and 
message acknowledgements might sometimes be dropped in an overloaded SG or an overloaded ASP. Hence if an ASP 
sends a 
sequence of ASP Call (Session) Admission Rate messages to an SG (usually intermingled with other protocol 
traffic), the corresponding sequence of ASP Call (Session) Admission Ack messages will always reach the 
ASP in order, but might suffer from deletions. An ASP cannot determine whether a loss affected the ASP Call 
(Session) Admission Rate message in transit to the SG, or the ASP Call (Session) Admission Rate Ack message 
in transit to the ASP.

</p>
<p>
Provided that procedures given here are followed, and ordering of ASPCAR and ASPCAR Ack messages is
   preserved, either the SG Overload Control (OLC) rate will be set to the value
   requested in a message, or the ASP will not receive an
   acknowledgement for this value;
   it is not possible for the ASP to receive an acknowledgement stating
   a rate equal to the local copy of the current rate, whilst the SG
   operates a different rate. However, if ordering is not preserved, 
even if all other aspects of these procedures are followed, it is possible that the latest acknowledgement 
received and accepted by the ASP at the end of a sequence of rate updates will contain a rate parameter which is not equal 
to the rate in force at the SG after this sequence of updates.

</p>
<p>
An SG which supports the ASPCAR message type MUST send the ASPCAR Ack message to acknowledge its having successfully 
received the ASPCAR message, and MUST set the setrat parameter in the ASPCAR Ack message to the 
value of the setrat parameter which the Overload Control Agent has received from the ASPCAR message being acknowledged.

</p>
<p>
   It is OPTIONAL for the ASP to use the procedure described below to ensure that the rates
   in the SG and ASP are aligned. However if the ASP uses the rate value returned in ASPCAR Ack to 
improve robustness, it SHOULD use this procedure.

</p>
<p>
When the ASP sends an ASP Call (Session) Admission Rate message, it starts (or re-starts) timer T(ack) and stores the value 
of the Call (Session) Admission Rate parameter. The duration of timer T(ack) is provisionable, with a default 
of 2 seconds. Note that an ASP Call (Session) Admission Rate message MAY be sent before the ASP has seen an 
acknowledgement of an earlier ASP Call (Session) Admission Rate message. This second ASPCAR message MAY contain the same value 
of the Call (Session) Admission Rate parameter as that in the earlier (as yet unacknowledged) ASPCAR message, or MAY contain a different
value.

</p>
<p>
If the ASP receives an ASP Call (Session) Admission Rate Ack message whilst timer T(ack) is running, it 
compares the value of the Call 
(Session) Admission Rate parameter from the acknowledgement message with its local stored value:

</p>
<p>
</p>
<ul class="text">
<li>
if the values are 
different, the ASP Call (Session) Admission Rate Ack message is silently discarded, the local stored value (the most-recently 
transmitted rate) is retained, 
and timer T(ack) continues to run;

</li>
<li>
if the values are the same, the timer T(ack) is stopped, but the local stored value (the most-recently 
transmitted rate) is retained.

</li>
</ul><p>

</p>
<p>
If the ASP receives an ASP Call (Session) Admission Rate Ack message whilst timer T(ack) is not running (an "unexpected ack"), it 
compares the value of the Call 
(Session) Admission Rate parameter from the acknowledgement message with its local stored value:

</p>
<p>
</p>
<ul class="text">
<li>
if the values are 
the same, the ASP Call (Session) Admission Rate Ack message is silently discarded, and the local stored value (the most-recently 
transmitted rate) is retained;

</li>
<li>
if the values are different, the ASP sends an ASP Call (Session) Admission Rate message, starts timer T(ack) and sets the new local 
stored value equal to the Call (Session) Admission Rate parameter in the outgoing message. The value of the Call (Session) Admission 
Rate parameter for the outgoing message MAY be obtained from the old local stored 
value (the rate which the ASP sent to the SG in the preceding outgoing ASPCAR message) or MAY be an updated value obtained from the ASP's 
rate control algorithm.

</li>
</ul><p>

</p>
<p>
If the timer T(ack) expires before an acknowledgement is received with a rate parameter which matches the local stored value (see above), 
the ASP sends an ASP Call (Session) Admission Rate message, starts timer T(ack) and stores the value 
of the Call (Session) Admission Rate parameter. The value of the Call (Session) Admission Rate parameter in the outgoing ASP Call 
(Session) Admission Rate message 
MAY be set to the local stored value in existence when T(ack) expired (that is, the last rate which the ASP sent to the SG) or MAY be 
an updated value obtained from the ASP's rate control algorithm.

</p>
<p>
In SGs where the implementation of the IUA protocol is separated from the implementation of the 
overload control function, the IUA implementation SHALL NOT autonomously send the ASPCAR Ack message following 
receipt of an ASPCAR message. This recommendation is provided because autonomous sending could result in the ASP's receiving 
an ASPCAR Ack for a rate request which was not made effective at the SG.

</p>
<p>
In ASPs where the implementation of the IUA protocol is separated from the implementation of the 
overload control function, the IUA implementation MAY implement the functionality described above for 
processing acknowledgements, including maintaining the per-SG T(ack) timers and the local copy of the current 
requested rate for each SG, and re-sending ASPCAR messages when required by the mechanism. Alternatively this 
functionality MAY be implemented in the ASP's overload control function.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
This document requests IANA to allocate two new Message Types of the ASPTM Message Class 
within the registry of Signaling User Adaptation Layer Assignments, Message Types. The
new message types are:

</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left"><col align="left">
<tr><th align="left">Value</th><th align="left">Description</th><th align="left">Short Name</th><th align="left">Reference</th></tr>
<tr>
<td align="left">TBD1</td>
<td align="left">ASP Call (Session) Admission Rate</td>
<td align="left">ASPCAR</td>
<td align="left">&rfc.number</td>
</tr>
<tr>
<td align="left">TBD2</td>
<td align="left">ASP Call (Session) Admission Rate Ack</td>
<td align="left">ASPCAR Ack</td>
<td align="left">&rfc.number</td>
</tr>
</table>
<br clear="all" />

<p>
NOTE TO RFC EDITOR - please substitute IANA allocations for TBD1 and TBD2
above.

</p>
<p>
This document also requests IANA to allocate one new Message Parameter
within the registry of Signaling User Adaptation Layer Assignments, Message Parameters. The
new message parameter is:

</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Value</th><th align="left">Description</th><th align="left">Reference</th></tr>
<tr>
<td align="left">TBD3</td>
<td align="left">Call (Session) Admission Rate</td>
<td align="left">&rfc.number</td>
</tr>
</table>
<br clear="all" />

<p>
NOTE TO RFC EDITOR - please substitute IANA allocation for TBD3 above.

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>
<a class='info' href='#RFC4233'>[RFC4233]<span> (</span><span class='info'>Morneault, K., &ldquo;Integrated Services Digital Network (ISDN) Q.921-User Adaptation Layer,&rdquo; January&nbsp;2006.</span><span>)</span></a>, defining IUA, refers to <a class='info' href='#RFC3788'>[RFC3788]<span> (</span><span class='info'>Loughney, J., &ldquo;Security Considerations for Signaling Transport (SIGTRAN) Protocols,&rdquo; June&nbsp;2004.</span><span>)</span></a> for security considerations 
applying to IUA as an instance of a SIGTRAN protocol. The extension to add the ASP Call (Session) 
Admission Rate parameter, described here, adds a rate control mechanism within the IUA protocol. This 
mechanism might 
be used by an attacker, who had obtained control of the protocol traffic, to cut off signalling traffic 
between an SG and an ASP. However there are already mechanisms within the protocol, including the 
sending of existing messages in the ASPTM class, which might be used for this purpose by such an attacker. 
Hence we believe that the extension described here does not introduce any new security considerations.

</p>
<a name="mscs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Informative Appendix: Message Sequence Diagrams for Acknowledgements</h3>

<p>
Message sequence diagrams in the following sub-sections provide informative
illustrations of the operation of the rate acknowledgement mechanism which is described 
normatively in <a class='info' href='#procack'>Section&nbsp;5.4<span> (</span><span class='info'>Procedures for use of the rate parameter acknowledgment</span><span>)</span></a> above.

</p>
<p>
In these diagrams, the overload control entities in the SG and ASP (SG OLC and ASP OLC respectively) 
are separated from the 
IUA protocol layer entities at the SG and ASP (SG IUA and ASP IUA respectively).

</p>
<p>
In these diagrams:

</p>
<p>
</p>
<ul class="text">
<li>
 the quantity "R" shown under the SG OLC represents the rate in force at the SG;

</li>
<li>
the quantity "r" is a rate parameter requested by the ASP OLC entity, and "in transit" either internally at the ASP, in an ASPCAR
message to the SG, or internally at the SG;

</li>
<li>
the quantity "a" is a rate parameter acknowledged by the SG OLC entity, and "in transit" either internally at the SG, in an ASPCAR Ack
message to the ASP, or internally at the ASP;

</li>
<li>
the quantity "c" shown under the ASP OLC is the ASP's local copy of the rate most recently sent out as an "r" value in a request; and

</li>
<li>
the notation "a == c" indicates that the rate parameter returned in an ASPCAR Ack message is equal to the ASP's locally stored value 
of the current rate, and "a != c" indicates that the rate parameter returned in an ASPCAR Ack message is not equal to the ASP's 
locally stored value of the current rate.

</li>
</ul><p>

</p>
<p>
The positive values (1 and 2) for rates in the examples, implying 0.001 and 0.002 calls per second , are unrealistically low 
for most deployments but are used only for illustration.

</p>
<a name="smscnorm"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Message sequence for normal transmission</h3>

<p>
<a class='info' href='#mscnorm'>Figure&nbsp;3<span> (</span><span class='info'>Message sequence for normal transmission</span><span>)</span></a> shows the simplest case where an ASPCAR message is sent with requested rate 1, and T(ack) is started. 
The message is successfully delivered
and acknowledged, and the acknowledgement arrives at the ASP before T(ack) expires. The rate value in the acknowledgement matches 
the ASP's locally-stored value for the most recently requested rate, so T(ack) is stopped.

</p><br /><hr class="insert" />
<a name="mscnorm"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SG       SG                      ASP        ASP
OLC      IUA                     IUA        OLC

                  ASPCAR (r=1)        r = 1
     r=1   &lt;----------------------&lt;----------
&lt;---------|                                 | start T(ack)
R=1                                         | c=1
                                            |
    a=1                                     |
---------&gt;|    ASPCAR Ack (a=1)             V
           -----------------------&gt;---------&gt; a == c
                                              stop T(ack)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Message sequence for normal transmission&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="smsclost"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Message sequence for a lost message</h3>

<p>
<a class='info' href='#msclost'>Figure&nbsp;4<span> (</span><span class='info'>Message sequence for a lost message</span><span>)</span></a> shows the case where an ASPCAR message is sent with requested rate 1, but the message is lost
in transit to the SG OLC, for example as a result of tail drop in a message queue within the SG application. 
A SCTP SACK has been sent for the ASPCAR message by the SG 
   and received at the ASP and thus no retransmissions of the ASPCAR will 
   occur at the SCTP layer.  However T(ack) will expire, so a second ASPCAR message is sent. 
In this case, the requested rate in the second ASPCAR message 
is the same as that in the first ASPCAR message. The second message is received and acknowledged successfully.

</p><br /><hr class="insert" />
<a name="msclost"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SG       SG                      ASP        ASP
OLC      IUA                     IUA        OLC

R=?             lost ASPCAR (r=1)      r=1
           &lt;----------------------&lt;----------
    *-----|                                 | start T(ack)
                                            | c=1
                                            |
                                            |
                                            |
                                            |
                 ASPCAR (r=1)         r=1   V  T(ack) expires
     r=1   &lt;----------------------&lt;----------
&lt;---------|                                 | start T(ack)
R=1                                         | c=1
                                            |
    a=1                                     |
---------&gt;|    ASPCAR Ack (a=1)             V
           -----------------------&gt;---------&gt; a == c
                                              stop T(ack)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Message sequence for a lost message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="smscdelayed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Message sequence for late acknowledgement</h3>

<p>
<a class='info' href='#mscdelayed'>Figure&nbsp;5<span> (</span><span class='info'>Message sequence for late acknowledgement</span><span>)</span></a> shows the case where an ASPCAR message is sent with requested rate 1, but the SG is slow to acknowledge 
the message. 

</p>
<p>
For illustration purposes only, the rate parameter values have been tagged with "x" and "y", but 
neither IUA nor the protocol extension described here provides any means to distinguish two messages bearing the same 
parameter value.

</p>
<p>
T(ack) expires, so a second ASPCAR message is sent. In this case, the requested rate in the second ASPCAR message 
is the same as that in the first ASPCAR message. 

</p>
<p>
The delayed acknowledgement for the first message arrives after the second message has been sent. However the rate parameter in the 
acknowledgement matches the ASP local copy of the current requested rate, so T(ack) is stopped. Later the acknowledgement for the 
second request arrives as an "unexpected ack" (one which arrives whilst no T(ack) is running). Because the rate parameter in the 
unexpected ack matches the ASP's local copy of the current requested rate, the unexpected ack is silently discarded.

</p><br /><hr class="insert" />
<a name="mscdelayed"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SG       SG                      ASP        ASP
OLC      IUA                     IUA        OLC

                     ASPCAR (r=1x)    r=1x
      r=1x &lt;----------------------&lt;---------
 &lt;--------|                                 | start T(ack)
 R=1x                                       | c=1x
                                            |
                                            |
                                            |
                                            |
                                            |
                 ASPCAR (r=1y)        r=1y  V  T(ack) expires
    r=1y   &lt;----------------------&lt;----------
&lt;---------|                                 | start T(ack)
R=1y                                         | c=1y
    a=1x                                    |
---------&gt;|    ASPCAR Ack (a=1x)            V
           -----------------------&gt;---------&gt; a == c
    a=1y                                      stop T(ack)
---------&gt;|    ASPCAR Ack (a=1y)
           -----------------------&gt;---------&gt; "unexpected ack"
                                              a == c
                                              discard
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Message sequence for late acknowledgement&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="smscupdated"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
Message sequence for updated rate</h3>

<p>
In <a class='info' href='#mscupdated'>Figure&nbsp;6<span> (</span><span class='info'>Message sequence for updated rate</span><span>)</span></a> the ASP OLC wishes to update the requested rate shortly after an earlier rate request was sent, before the 
ASP receives the acknowledgement of the earlier request and before expiry of T(ack) for the earlier request. This behaviour is 
permitted. T(ack) is restarted when the second request is sent, and the local copy of the current rate request is set to the
rate value of the second request. The acknowledgement for the first request is received whilst T(ack) is running for the second 
request message, but because the rate parameter in the acknowledgement does not match the ASP's local copy of the current rate,
the acknowledgement is discarded and T(ack) continues to run. Eventually, the acknowledgement for the second request arrives 
with a matching rate value, and T(ack) is stopped.

</p><br /><hr class="insert" />
<a name="mscupdated"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SG       SG                      ASP        ASP
OLC      IUA                     IUA        OLC

                 ASPCAR (r=1)          r=1
      r=1  &lt;----------------------&lt;----------
 &lt;--------|                                 | start T(ack)
R=1                                         | c=1
                                            |
                                            |
                                            |
                 ASPCAR (r=2)         r=2   V
    r=2    &lt;----------------------&lt;----------
&lt;---------|                                 | restart T(ack)
R=2                                         | c=2
    a=1                                     |
---------&gt;|    ASPCAR Ack (a=1)             |
           -----------------------&gt;--------&gt;| a != c
                                            | discard ack
    a=2                                     | T(ack) continues
---------&gt;|    ASPCAR Ack (a=2)             V
           -----------------------&gt;---------&gt; a == c
                                              stop T(ack)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Message sequence for updated rate&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="smsclostupdated"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5"></a><h3>8.5.&nbsp;
Message sequence for lost message and updated rate</h3>

<p>
<a class='info' href='#msclostupdated'>Figure&nbsp;7<span> (</span><span class='info'>Message sequence for lost message and updated rate</span><span>)</span></a> shows a sequence where an updated rate request message is sent shortly
after an earlier request, but the first request is lost  as a result of tail drop in a message queue within the SG
   application. A SCTP SACK has been sent by the SG for the first ASPCAR
   message and received at the ASP and thus no retransmissions of the first 
   ASPCAR message will occur at the SCTP layer.
   Hence, the first request is not acknowledged. T(ack) is restarted and the ASP's local copy 
is updated when the second rate request message is sent. The 
second message is acknowledged normally. 

</p><br /><hr class="insert" />
<a name="msclostupdated"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SG       SG                      ASP        ASP
OLC      IUA                     IUA        OLC

R=?             lost ASPCAR (r=1)      r=1
           &lt;----------------------&lt;----------
    *-----|                                 | start T(ack)
                                            | c=1
                                            |
                 ASPCAR (r=2)         r=2   V
     r=2   &lt;----------------------&lt;----------
&lt;---------|                                 | restart T(ack)
R=2                                         | c=2
                                            |
    a=2                                     |
---------&gt;|    ASPCAR Ack (a=2)             V
           ----------------------&gt;----------&gt;  a == c
                                              stop T(ack)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: Message sequence for lost message and updated rate&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="smsclostupdate"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6"></a><h3>8.6.&nbsp;
Message sequence for lost rate update</h3>

<p>
<a class='info' href='#msclostupdate'>Figure&nbsp;8<span> (</span><span class='info'>Message sequence for lost rate update</span><span>)</span></a> shows a sequence where an updated rate request message is sent shortly
after an earlier request, but the second request is lost as a result of tail drop in a message queue within the SG
   application. A SCTP SACK acknowledging the second request has been sent by 
   the SG and received at the ASP and thus no retransmission will occur at the 
   SCTP layer for the second request. The acknowledgement for the first request is 
received whilst T(ack) is running for the second request, but the rate parameter in the acknowledgement 
does not match the ASP's local copy so the acknowledgement is discarded and T(ack) continues to run. Eventually
T(ack) expires, causing a third request to be sent to ensure that the SG knows the ASP's current rate. This 
third request is delivered and acknowledged normally.

</p><br /><hr class="insert" />
<a name="msclostupdate"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SG       SG                      ASP        ASP
OLC      IUA                     IUA        OLC

                 ASPCAR (r=1)          r=1
      r=1  &lt;----------------------&lt;----------
 &lt;--------|                                 | start T(ack)
R=1                                         | c=1
                                            |
                                            |
                                            |
                lost ASPCAR (r=2)      r=2
           &lt;----------------------&lt;----------
    *-----|                                 | restart T(ack)
    a=1                                     | c=2
---------&gt;|     ASPCAR Ack (a=1)            |
           -----------------------&gt;--------&gt;| a != c
                                            | discard ack
                                            | T(ack continues)
                                            |
                 ASPCAR (r=2)         r=2   V T(ack) expires
     r=2   &lt;----------------------&lt;----------
&lt;---------|                                 | start T(ack)
R=2                                         | c=2
                                            |
    a=2                                     |
---------&gt;|    ASPCAR Ack (a=2)             V
           -----------------------&gt;---------&gt; a == c
                                              stop T(ack)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: Message sequence for lost rate update&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="smscseqerr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.7"></a><h3>8.7.&nbsp;
Message sequence for sequencing error</h3>

<p>
<a class='info' href='#mscseqerr'>Figure&nbsp;9<span> (</span><span class='info'>Message sequence for sequencing error</span><span>)</span></a> shows a case where the mechanism is able to recover from a sequencing error in the SG, which might 
be caused by successive ASPCAR messages being processed in different queues or by different processing threads. The acknowledgement
mechanism is not able to achieve recovery from sequencing errors in all cases, as illustrated by <a class='info' href='#mscseqerrloss'>Figure&nbsp;10<span> (</span><span class='info'>Message sequence for sequencing error and lost acknowledgement</span><span>)</span></a> below,
so SGs and ASP SHOULD NOT permit out-of-order delivery.

</p>
<p>
Two ASPCAR messages are sent in quick succession with rates 1 and 2 respectively. The second message is processed and 
acknowledged promptly by the SG, and the rate parameter in the ASPCAR Ack matches the ASP's local copy of the current rate, 
so T(ack) is stopped. The ASP assumes that the rate in force at the SG is 2. Then the first message is processed (out of sequence) by 
the SG, and the SG's rate controller is set to rate 1. A second ASPCAR Ack is sent, and arrives at the ASP as an unexpected ack, that is, 
when T(ack) is not running. Because the rate parameter in the second ASPCAR Ack does not match the ASP's local copy, the ASP resends 
the current rate (2), and the resend is delivered and acknowledged successfully.

</p><br /><hr class="insert" />
<a name="mscseqerr"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SG       SG                      ASP        ASP
OLC      IUA                     IUA        OLC

R=?             ASPCAR (r=1)          r=1
              &lt;-------------------&lt;----------
             |                              | start T(ack)
             |                              | c=1
             |                              |
             |   ASPCAR (r=2)         r=2   V
    r=2    &lt;----------------------&lt;----------
&lt;---------|  |                              | restart T(ack)
R=2          |                              | c=2
    a=2      |                              |
---------&gt;|  | ASPCAR Ack (a=2)             V
           -----------------------&gt;---------&gt; a == c
     r=1     |                                stop T(ack)
&lt;------------
R=1
    a=1
---------&gt;|    ASPCAR Ack (a=1)
           -----------------------&gt;---------&gt;  unexpected
                                              a != c
                  ASPCAR (r=2)        r=2     resend
     r=2   &lt;----------------------&lt;----------
&lt;---------|                                 | start T(ack)
R=2                                         | c=2
    a=2                                     |
---------&gt;|    ASPCAR Ack (a=2)             V
           -----------------------&gt;---------&gt; a == c
                                              stop T(ack)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: Message sequence for sequencing error&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="smscseqerrloss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.8"></a><h3>8.8.&nbsp;
Message sequence for sequencing error and lost acknowledgement</h3>

<p>
<a class='info' href='#mscseqerrloss'>Figure&nbsp;10<span> (</span><span class='info'>Message sequence for sequencing error and lost acknowledgement</span><span>)</span></a> shows a case where the mechanism fails to recover from a sequencing error in the SG, which might 
be caused by successive ASPCAR messages being processed in different queues or by different processing threads. This illustrates 
the need for the requirement that SGs and ASP SHOULD NOT permit out-of-order delivery.

</p>
<p>
Two ASPCAR messages are sent in quick succession with rates 1 and -1 respectively. The value -1 was chosen for illustration because 
it means "admit all calls" and is typically sent at the end of an overload incident. It is very likely that no further rate request 
messages will be sent for an extended period after such a message is sent, so it is important that the rate request message with value -1
is successfully delivered, and that the value -1 at the SG is not subsequently overwritten as a result of a protocol error.

</p>
<p>
The second message is processed and 
acknowledged promptly by the SG, and the rate parameter in the ASPCAR Ack matches the ASP's local copy of the current rate, 
so T(ack) is stopped. The ASP assumes that the rate in force at the SG is -1. Then the first message is processed (out of sequence) by 
the SG, and the SG's rate controller is set to rate 1. A second ASPCAR Ack is sent with rate parameter 1, but this ASPCAR Ack is lost 
in transit to the ASP, perhaps by tail drop from an ASP queue. The SCTP SACK for the second ASPCAR Ack is sent by the ASP
   to the SG and no retransmission for the second ASPCAR Ack occurs 
   at the SCTP layer. Hence the ASP remains unaware that the SG has "lost" the ASP's 
most recent rate request (in this example, an instruction to admit all calls).

</p><br /><hr class="insert" />
<a name="mscseqerrloss"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SG       SG                      ASP        ASP
OLC      IUA                     IUA        OLC

R=?              ASPCAR (r=1)          r=1
              &lt;-------------------&lt;---------
             |                              | start T(ack)
             |                              | c=1
             |                              |
             |   ASPCAR (r=-1)        r=-1  V
    r=-1   &lt;----------------------&lt;----------
&lt;---------|  |                              | restart T(ack)
R=-1         |                              | c=-1
    a=-1     |                              |
---------&gt;|  | ASPCAR Ack (a=-1)            V
           -----------------------&gt;---------&gt; a == c
     r=1     |                                stop T(ack)
&lt;------------
R=1
    a=1
-------*       ASPCAR Ack (a=1) lost
                                              ASP OLC
                                              continues
                                              - OLC entities
                                              unsynchronised
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: Message sequence for sequencing error and lost acknowledgement&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="smscupdateackloss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.9"></a><h3>8.9.&nbsp;
Message sequence for updated rate and lost acknowledgement</h3>

<p>
<a class='info' href='#mscupdateackloss'>Figure&nbsp;11<span> (</span><span class='info'>Message sequence for updated rate and lost acknowledgement</span><span>)</span></a> shows a case where an acknowledgement is lost in circumstances similar to those of <a class='info' href='#mscseqerrloss'>Figure&nbsp;10<span> (</span><span class='info'>Message sequence for sequencing error and lost acknowledgement</span><span>)</span></a>
above, but where the system is constrained to preserve message order. Because ordering is preserved, the acknowledgement mechanism 
is able to recover from the error.

</p>
<p>
The diagram shows the case where the SG OLC is slow to respond, such that the acknowledgement for the first message is sent 
after the second message has been processed. However because ordering is preserved, either the SG OLC rate control will be set to the 
value requested in the later message, or the ASP will not receive an acknowledgement for this value, or both (the case illustrated here). 
It is not possible for the ASP to receive an acknowledgement stating a rate equal to the local copy of the current rate, whilst the SG 
operates a different rate. 

</p>
<p>
In the diagram the ASP requests first rate 1, and then rate -1, in quick succession. The SG acknowledges rate 1, but the acknowledgement is 
slow to arrive, arriving after the second rate request has been sent. Hence the acknowledgement rate does not match the ASP's local copy
of the current rate, and is discarded. Because the acknowledgement for the second rate request is lost, the ASP does not receive an 
acknowledgement matching its current rate, and T(ack) expires. This causes a resend, which is successful in this example.

</p><br /><hr class="insert" />
<a name="mscupdateackloss"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SG       SG                      ASP        ASP
OLC      IUA                     IUA        OLC

                     ASPCAR (r=1)          r=1
      r=1  &lt;----------------------&lt;----------
 &lt;--------|                                 | start T(ack)
 R=1                                        | c=1
                                            |
                                            |
                                            |
                 ASPCAR (r=-1)        r=-1  V
     r=-1  &lt;----------------------&lt;----------
&lt;---------|                                 | restart T(ack)
R=-1                                        | c=-1
    a=1                                     |
---------&gt;|     ASPCAR Ack (a=1)            |
           -----------------------&gt;--------&gt;| a != c
    a=-1                                    | discard ack
-------*     ASPCAR Ack (a=-1) lost         | T(ack continues)
                                            |
                ASPCAR (r=-1)         r=-1  V T(ack) expires
     r=-1  &lt;----------------------&lt;----------
&lt;---------|                                 | start T(ack)
R=-1                                        | c=-1
                                            |
    a=-1                                    |
---------&gt;|    ASPCAR Ack (a=-1)            V
           -----------------------&gt;---------&gt; a == c
                                              stop T(ack)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;11: Message sequence for updated rate and lost acknowledgement&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Contributors</h3>

<p>
The authors gratefully acknowledge key contributions from Juan Harrison.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; RFC&nbsp;2119, BCP&nbsp;14, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3788">[RFC3788]</a></td>
<td class="author-text">Loughney, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3788">Security Considerations for Signaling Transport (SIGTRAN) Protocols</a>,&rdquo; RFC&nbsp;3788, June&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4233">[RFC4233]</a></td>
<td class="author-text">Morneault, K., &ldquo;<a href="http://tools.ietf.org/html/rfc4233">Integrated Services Digital Network (ISDN) Q.921-User Adaptation Layer</a>,&rdquo; RFC&nbsp;4233, January&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="ascii">[ascii]</a></td>
<td class="author-text">ANSI, &ldquo;Coded Character Set 7-Bit American Standard Code for Information Interchange,&rdquo; ANSI&nbsp;X3.4-1986, 1986.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ETSI_NR">[ETSI_NR]</a></td>
<td class="author-text">ETSI Standard, &ldquo;NGN Overload Control Architecture; Part 4: Adaptative Control for the MGC,&rdquo; ES&nbsp;283 039-4, April&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="H.248">[H.248]</a></td>
<td class="author-text">ITU-T Recommendation, &ldquo;Gateway control protocol: Version 3,&rdquo; ITU-T&nbsp;H.248.1, September&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2719">[RFC2719]</a></td>
<td class="author-text">Ong, L., &ldquo;<a href="http://tools.ietf.org/html/rfc2719">Framework Architecture for Signaling Transport</a>,&rdquo; RFC&nbsp;2719, October&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4129">[RFC4129]</a></td>
<td class="author-text">Mukundan, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4129">Digital Private Network Signaling System (DPNSS)/ 
                     Digital Access Signaling System 2 (DASS 2)
                     Extensions to the IUA Protocol</a>,&rdquo; RFC&nbsp;4129, August&nbsp;2005.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nick Stewart</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BT</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Aquarius 4M2 3</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adastral Park</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Martlesham Heath</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ipswich, Suffolk  IP5 3RE</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">United Kingdom</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+44 1473 649579</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:nick.m.stewart@bt.com">nick.m.stewart@bt.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Geoff Hunt</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BT</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Orion 2 PP3</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adastral Park</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Martlesham Heath</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ipswich, Suffolk  IP5 3RE</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">United Kingdom</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+44 1473 651704</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:geoff.hunt@bt.com">geoff.hunt@bt.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dal Chohan</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Fujitsu Telecommunications Europe Limited</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Birmingham Business Park</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Solihull Parkway</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Birmingham, West Midlands  B37 7YU</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">United Kingdom</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+44 121 717 6177</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:d.chohan@ftel.co.uk">d.chohan@ftel.co.uk</a></td></tr>
</table>
</body></html>
