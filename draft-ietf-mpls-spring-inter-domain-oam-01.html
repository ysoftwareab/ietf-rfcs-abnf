<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>PMS/Head-end based MPLS Ping and Traceroute in Inter-domain SR Networks</title>
<meta content="Shraddha Hegde" name="author">
<meta content="Kapil Arora" name="author">
<meta content="Mukul Srivastava" name="author">
<meta content="Samson Ninan" name="author">
<meta content="Nagendra Kumar" name="author">
<meta content="
       Segment Routing (SR) architecture leverages source routing and
   tunneling paradigms and can be directly applied to the use of a
   Multiprotocol Label Switching (MPLS) data plane. A network may 
   consist of multiple IGP
   domains or multiple ASes under the control of same organization.
   It is useful to have the Label switched Path (LSP)
   Ping and traceroute procedures when an SR 
   end-to-end path spans across multiple ASes or domains.
   This document describes mechanisms to facilitae LSP ping and 
   traceroute in inter-AS/inter-domain 
   SR-MPLS networks in an efficient manner with simple Operations,
   Administration, and Maintenance (OAM) protocol 
   extension which uses
   dataplane forwarding alone for sending echo reply.    
    " name="description">
<meta content="xml2rfc 3.12.0" name="generator">
<meta content="OAM" name="keyword">
<meta content="EPE" name="keyword">
<meta content="BGP-LS" name="keyword">
<meta content="BGP" name="keyword">
<meta content="SPRING" name="keyword">
<meta content="SDN" name="keyword">
<meta content="draft-ietf-mpls-spring-inter-domain-oam-01" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.4
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.26.0
    setuptools 59.5.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-ietf-mpls-spring-inter-domain-oam-01-dl9mc_7j.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Inter-as-OAM</td>
<td class="right">December 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Hegde, et al.</td>
<td class="center">Expires 15 June 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Routing area</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-mpls-spring-inter-domain-oam-01</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-12-12" class="published">12 December 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-06-15">15 June 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">S. Hegde</div>
<div class="org">Juniper Networks Inc.</div>
</div>
<div class="author">
      <div class="author-name">K. Arora</div>
<div class="org">Juniper Networks Inc.</div>
</div>
<div class="author">
      <div class="author-name">M. Srivastava</div>
<div class="org">Juniper Networks Inc.</div>
</div>
<div class="author">
      <div class="author-name">S. Ninan</div>
<div class="org">Individual Contributor</div>
</div>
<div class="author">
      <div class="author-name">N. Kumar</div>
<div class="org">Cisco Systems, Inc.</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">PMS/Head-end based MPLS Ping and Traceroute in Inter-domain SR Networks</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">Segment Routing (SR) architecture leverages source routing and
   tunneling paradigms and can be directly applied to the use of a
   Multiprotocol Label Switching (MPLS) data plane. A network may 
   consist of multiple IGP
   domains or multiple ASes under the control of same organization.
   It is useful to have the Label switched Path (LSP)
   Ping and traceroute procedures when an SR 
   end-to-end path spans across multiple ASes or domains.
   This document describes mechanisms to facilitae LSP ping and 
   traceroute in inter-AS/inter-domain 
   SR-MPLS networks in an efficient manner with simple Operations,
   Administration, and Maintenance (OAM) protocol 
   extension which uses
   dataplane forwarding alone for sending echo reply.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note" id="section-note.1">
      <h2 id="name-requirements-language">
<a href="#name-requirements-language" class="section-name selfRef">Requirements Language</a>
      </h2>
<p id="section-note.1-1"> The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
      NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
      "MAY", and "OPTIONAL" in this document are to be interpreted as
      described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span>
        <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
      appear in all capitals, as shown here.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 15 June 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-definition-of-domain" class="xref">Definition of Domain</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-inter-domain-networks-with-" class="xref">Inter domain networks with multiple IGPs</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-reply-path-tlv" class="xref">Reply Path TLV</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-segment-sub-tlv" class="xref">Segment sub-TLV</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-type-a-sid-only-in-the-form" class="xref">Type A: SID only, in the form of MPLS Label</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-type-c-ipv4-node-address-wi" class="xref">Type C: IPv4 Node Address with optional SID for SR-MPLS</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-type-d-ipv6-node-address-wi" class="xref">Type D: IPv6 Node Address with optional SID for SR MPLS</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-segment-flags" class="xref">Segment Flags</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-srv6-dataplane" class="xref">SRv6 Dataplane</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-detailed-procedures" class="xref">Detailed Procedures</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-sending-an-echo-request" class="xref">Sending an echo request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-receiving-an-echo-request" class="xref">Receiving an echo request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-sending-an-echo-reply" class="xref">Sending an echo reply</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-receiving-an-echo-reply" class="xref">Receiving an echo reply</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-detailed-example" class="xref">Detailed Example</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-procedures-for-segment-rout" class="xref">Procedures for Segment Routing LSP ping</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-procedures-for-segment-routi" class="xref">Procedures for Segment Routing LSP Traceroute</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-building-reply-path-tlv-dyn" class="xref">Building Reply Path TLV dynamically</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-the-procedures-to-build-the" class="xref">The procedures to build the return path</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-details-with-example" class="xref">Details with example</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-contributors" class="xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="xref">13.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="xref">13.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<span id="name-inter-as-segment-routing-to"></span><div id="Topology_1">
<figure id="figure-1">
        <div class="alignLeft art-text artwork" id="section-1-1.1">
<pre>
                    +----------------+
                    | Controller/PMS |
                    +----------------+



 |---AS1-----|                |------AS2------|            |----AS3---|

                ASBR2----ASBR3                ASBR5------ASBR7
                /             \               /            \
               /               \             /              \
 PE1----P1---P2                 P3---P4---PE4               P5---P6--PE5
               \               /            \               /
                \             /              \             /
                 ASBR1----ASBR4              ASBR6------ASBR8

</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-inter-as-segment-routing-to" class="selfRef">Inter-AS Segment Routing topology</a>
        </figcaption></figure>
</div>
<p id="section-1-2"> Many network deployments have built their networks consisting of multiple 
Autonomous Systems either for ease of operations or as a result of network 
mergers and acquisitions. Segment Routing can be deployed in such scenarios
to provide end to end paths, traversing multiple Autonomous systems(AS). These
paths consist of Segment Identifiers(SID) of 
different type as per <span>[<a href="#RFC8402" class="xref">RFC8402</a>]</span>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">    <span>[<a href="#RFC8660" class="xref">RFC8660</a>]</span> specifies the
forwarding plane behaviour to allow Segment Routing to operate on top of
MPLS data plane. 
<span>[<a href="#RFC9087" class="xref">RFC9087</a>]</span> describes BGP peering
SIDs, which will help in steering packet from one Autonomous system to another.
Using above SR capabilities, paths which span across multiple Autonomous systems
can be created.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">For example <a href="#Topology_1" class="xref">Figure 1</a> 
describes an inter-AS network scenario consisting of ASes AS1 and AS2. 
Both AS1 and AS2 are Segment Routing enabled and the EPE links 
have EPE labels configured 
and advertised via <span>[<a href="#I-D.ietf-idr-bgpls-segment-routing-epe" class="xref">I-D.ietf-idr-bgpls-segment-routing-epe</a>]</span>. 
Controller or head-end can build
end-to-end Traffic-Engineered path consisting of Node-SIDs,
 Adjacency-SIDs and EPE-SIDs.
It is advantageous for operations to be able to perform LSP ping and traceroute
procedures on these inter-AS SR-MPLS paths. LSP ping/traceroute procedures use IP 
connectivity for echo reply to 
reach the head-end. In inter-AS networks, IP connectivity may not be there 
from each router in the path.For example
in <a href="#Topology_1" class="xref">Figure 1</a> P3 and P4 may not have IP connectivity for PE1.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5"><span>[<a href="#RFC8403" class="xref">RFC8403</a>]</span> describes mechanisms to carry out the 
MPLS ping/traceroute from a Path Monitoring System (PMS).
It is possible to build GRE tunnels or static routes to each router 
in the network
 to get  IP connectivity for the reverse path.
This mechanism is operationally very heavy and requires PMS to be capable
of building huge number of GRE tunnels, which may not be feasible.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">It is not possible to carry out LSP ping and Traceroute functionality
on these paths to verify basic connectivity and fault isolation using existing
LSP ping and Traceroute mechanism(<span>[<a href="#RFC8287" class="xref">RFC8287</a>]</span> and
 <span>[<a href="#RFC8029" class="xref">RFC8029</a>]</span>). 
This is because, there exists no IP connectivity
to source address of ping packet, which is in a different AS, from the
 destination of Ping/Traceroute.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">  <span>[<a href="#RFC7743" class="xref">RFC7743</a>]</span> describes a Echo-relay based solution
based on advertising a new Relay Node Address Stack TLV containing 
stack of Echo-relay IP addresses. These mechansims can be applied to 
segment routing networks as well. <span>[<a href="#RFC7743" class="xref">RFC7743</a>]</span>
mechanism requires the return ping packet to be processed in slow 
path or as a bump-in-the-wire
on every relay node. The motivation of the current document
is to provide an alternate mechanism for ping/traceroute in 
inter-domain segment routing networks.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">
This document describes a new mechanism which is efficient and simple 
and can be easily deployed in SR-MPLS networks. This mechanism uses MPLS path and
no changes required in the forwarding path. 
Any MPLS capable node will be able to forward
the echo-reply packet in fast path.

The current draft describes a mechanism that uses Reply path TLV <span>[<a href="#RFC7110" class="xref">RFC7110</a>]</span> 
to convey the reverse path. Three new sub-TLVs for Reply path TLV are defined,
that faciliate encoding segment routing label stack.
The TLV can either be derived by a smart application or controller which has a full 
topology view. This document also proposes mechanisms to derive the return path dynamically
during traceroute procedures.<a href="#section-1-8" class="pilcrow">¶</a></p>
<div id="domain_definition">
<section id="section-1.1">
        <h3 id="name-definition-of-domain">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-definition-of-domain" class="section-name selfRef">Definition of Domain</a>
        </h3>
<p id="section-1.1-1"> The term domain used in this document implies an IGP domain where every node
is visible to every other node for the purposes of shortest path computation. The
domain implies an IGP area or level. An Autonomous System (AS) consists of
one or more IGP domains.The procedures described in this document are applicable 
to paths built across multiple domains which includes inter-area as well as inter-AS paths.
 This document is applicable to SR-MPLS networks
where all nodes in each of the domains are SR capable. It is also applicable to
SR-MPLS networks where SR acts an an overlay having SR incapable underlay nodes. In such
networks, the traceroute procedure is executed only on the overlay SR nodes.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="inter_domain">
<section id="section-2">
      <h2 id="name-inter-domain-networks-with-">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-inter-domain-networks-with-" class="section-name selfRef">Inter domain networks with multiple IGPs</a>
      </h2>
<span id="name-inter-domain-networks-with-m"></span><div id="Topology_2">
<figure id="figure-2">
        <div class="alignLeft art-text artwork" id="section-2-1.1">
<pre>


 |-Domain 1|-------Domain 2-----|--Domain 3-|


 PE1------ABR1--------P--------ABR2------PE4
  \        / \                  /\        /
   --------   -----------------   -------
    BGP-LU         BGP-LU          BGP-LU

</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-inter-domain-networks-with-m" class="selfRef">Inter-domain networks with multiple IGPs</a>
        </figcaption></figure>
</div>
<p id="section-2-2">When the network consists of large number of nodes, the nodes are 
seggregated into multiple IGP domains.
The connectivity to the remote PEs can be achieved using
BGP-Labeled Unicast (BGP-LU) 
<span>[<a href="#RFC8277" class="xref">RFC8277</a>]</span> or by stacking the labels
for each domain as described in <span>[<a href="#RFC8604" class="xref">RFC8604</a>]</span>. 
It is useful to support MPLS ping and traceroute 
mechanisms for these networks. The procedures described in 
this document for constructing Reply path TLV and its use
in echo reply is equally applicable to networks consisting 
of multiple IGP domains that use BGP-LU or label stacking.<a href="#section-2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Reply_path_TLV">
<section id="section-3">
      <h2 id="name-reply-path-tlv">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-reply-path-tlv" class="section-name selfRef">Reply Path TLV</a>
      </h2>
<p id="section-3-1">Segment Routing networks statically assign the labels to 
nodes and PMS/Head-end 
may know the entire database. The reverse path can be built 
from PMS/Head-end  by stacking
segments for the reverse path. Reply path TLV as defined in 
<span>[<a href="#RFC7110" class="xref">RFC7110</a>]</span> is used
to carry the return path. While using the procedures 
described in this document, the 
reply mode MUST be set to 5 "Reply via Specified Path" and as
 specified in <span>[<a href="#RFC7110" class="xref">RFC7110</a>]</span> Reply Path TLV MUST be 
included in the echo request message.
The procedures decribed in <span>[<a href="#RFC7110" class="xref">RFC7110</a>]</span> are 
applicable for constructing 
the Reply Path TLV. This document define three new sub-TLVs 
to encode the Segment Routing path.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">
The type of segment that the head-end
chooses to send in the Reply Path TLV is governed 
by local policy. Implementations may provide CLI input parameters in Labels,
IPv4 addresses or IPv6 addresses or a combination of these which gets encoded
in the return path TLV. Implementations may also provide mechansims to acquire
the database of remote domains and compute the return path based 
on the acquired database. For traceroute purposes, the return path will have to
consider the reply being sent from every node along the path. The return path
changes when the traceroute progresses and crosses each domain. One of the ways this can be
implemented on headend is to acquire the entire database (of all domains) and build return path
for every node along the SR-MPLS path based on the knowledge of the database. 
Another mechansim is to  use dynamically
computed return path as described in <a href="#Dynamic_TLV_building" class="xref">Section 8</a><a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">
Some networks may consist of pure IPV4 domains and pure IPv6 domains. 
Handling end-to-end MPLS OAM for such networks
is out of scope for this document. It is recommended to use dual 
stack in such cases and use end-to-end IPv6 addresses
for MPLS ping and trace route procedures.<a href="#section-3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="segment_sub_tlv">
<section id="section-4">
      <h2 id="name-segment-sub-tlv">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-segment-sub-tlv" class="section-name selfRef">Segment sub-TLV</a>
      </h2>
<p id="section-4-1"> <span>[<a href="#I-D.ietf-spring-segment-routing-policy" class="xref">I-D.ietf-spring-segment-routing-policy</a>]</span> 
defines various types of segments. 
The types of segments applicable to this document have been defined in this section for the use of
MPLS OAM.
The motivation has been to keep the definitions same as in 
<span>[<a href="#I-D.ietf-spring-segment-routing-policy" class="xref">I-D.ietf-spring-segment-routing-policy</a>]</span>
with minimal modifications if it is absolutely needed.
One or more segment sub-TLV can be included in the Reply Path TLV. 
The segment sub-TLVs included in a Reply Path TLV MAY be of different types.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2"> Below types of segment sub-TLVs are applicable for the 
Reverse Path Segment List TLV.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">Type  A: SID only, in the form of MPLS Label<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">Type  C: IPv4 Node Address with optional SID<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">Type  D: IPv6 Node Address with optional SID for SR MPLS<a href="#section-4-5" class="pilcrow">¶</a></p>
<div id="type1">
<section id="section-4.1">
        <h3 id="name-type-a-sid-only-in-the-form">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-type-a-sid-only-in-the-form" class="section-name selfRef">Type A: SID only, in the form of MPLS Label</a>
        </h3>
<p id="section-4.1-1">The Type-A Segment Sub-TLV encodes a single SID in the form of an
   MPLS label.  The format is as follows:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<span id="name-type-1-segment-sub-tlv"></span><div id="type1_tlv">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-4.1-2.1">
<pre>

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type                      |   Length                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Flags       |   RESERVED                                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Label                        | TC  |S|       TTL     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-type-1-segment-sub-tlv" class="selfRef">Type 1 Segment sub-TLV</a>
          </figcaption></figure>
</div>
<p id="section-4.1-3">
   where:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">  Type: TBD1(to be assigned by IANA from the registry 
   "Sub-TLVs for TLV Types 1, 16, and 21").<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5"> Length is 8.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6"> Flags: 1 octet of flags as defined in  <a href="#flags" class="xref">Section 4.4</a>.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1-7"> RESERVED: 3 octets of reserved bits.  SHOULD be unset on
      transmission and MUST be ignored on receipt.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">  Label: 20 bits of label value.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1-9">  TC: 3 bits of traffic class<a href="#section-4.1-9" class="pilcrow">¶</a></p>
<p id="section-4.1-10">  S: 1 bit Reserved<a href="#section-4.1-10" class="pilcrow">¶</a></p>
<p id="section-4.1-11">  TTL: 1 octet of TTL.<a href="#section-4.1-11" class="pilcrow">¶</a></p>
<p id="section-4.1-12"> The following applies to the Type-1 Segment sub-TLV:<a href="#section-4.1-12" class="pilcrow">¶</a></p>
<p id="section-4.1-13">  The S bit SHOULD be zero upon transmission, and MUST be ignored
      upon reception.<a href="#section-4.1-13" class="pilcrow">¶</a></p>
<p id="section-4.1-14">  If the originator wants the receiver to choose the TC value, it
      sets the TC field to zero.<a href="#section-4.1-14" class="pilcrow">¶</a></p>
<p id="section-4.1-15"> If the originator wants the receiver to choose the TTL value, it
      sets the TTL field to 255.<a href="#section-4.1-15" class="pilcrow">¶</a></p>
<p id="section-4.1-16">  If the originator wants to recommend a value for these fields, it
      puts those values in the TC and/or TTL fields.<a href="#section-4.1-16" class="pilcrow">¶</a></p>
<p id="section-4.1-17">  The receiver MAY override the originator's values for these
      fields.  This would be determined by local policy at the receiver.
      One possible policy would be to override the fields only if the
      fields have the default values specified above.<a href="#section-4.1-17" class="pilcrow">¶</a></p>
</section>
</div>
<div id="type3">
<section id="section-4.2">
        <h3 id="name-type-c-ipv4-node-address-wi">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-type-c-ipv4-node-address-wi" class="section-name selfRef">Type C: IPv4 Node Address with optional SID for SR-MPLS</a>
        </h3>
<p id="section-4.2-1">The Type-C Segment Sub-TLV encodes an IPv4 node address, SR Algorithm
   and an optional SID in the form of an MPLS label.  The format is as
   follows:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<span id="name-type-3-segment-sub-tlv"></span><div id="type3_tlv">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-4.2-2.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type                      |   Length                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Flags       |  RESERVED (MBZ)             | SR Algorithm    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 IPv4 Node Address (4 octets)                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                SID (optional, 4 octets)                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-type-3-segment-sub-tlv" class="selfRef">Type 3 Segment sub-TLV</a>
          </figcaption></figure>
</div>
<p id="section-4.2-3">where:<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">  Type: TBD3(to be assigned by IANA from the registry 
   "Sub-TLVs for TLV Types 1, 16, and 21").<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2-5"> Length is 8 or 12.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<p id="section-4.2-6">  Flags: 1 octet of flags as defined in  <a href="#flags" class="xref">Section 4.4</a>.<a href="#section-4.2-6" class="pilcrow">¶</a></p>
<p id="section-4.2-7">  SR Algorithm: 1 octet specifying SR Algorithm as described in
      section 3.1.1 in <span>[<a href="#RFC8402" class="xref">RFC8402</a>]</span>, when A-Flag as
      defined in   <a href="#flags" class="xref">Section 4.4</a>is present.  SR Algorithm is used 
   by the receiver to derive the Label. When A-flag is unset,
   this field has no meaning and thus MUST be set to zero on 
   transmission and ignored on receipt.<a href="#section-4.2-7" class="pilcrow">¶</a></p>
<p id="section-4.2-8"> RESERVED: 2 octets of reserved bits.MUST be set to zero when sending; 
                MUST be ignored on receipt.<a href="#section-4.2-8" class="pilcrow">¶</a></p>
<p id="section-4.2-9">  IPv4 Node Address: a 4 octet IPv4 address representing a node.<a href="#section-4.2-9" class="pilcrow">¶</a></p>
<p id="section-4.2-10">  SID: optional :4 octet field containing label, TC, S and
      TTL as defined in  <a href="#type1" class="xref">Section 4.1</a><a href="#section-4.2-10" class="pilcrow">¶</a></p>
<p id="section-4.2-11">The following applies to the Type-3 Segment sub-TLV:<a href="#section-4.2-11" class="pilcrow">¶</a></p>
<p id="section-4.2-12">  The IPv4 Node Address MUST be present.<a href="#section-4.2-12" class="pilcrow">¶</a></p>
<p id="section-4.2-13">  The SID is optional and specifies a 4 octet MPLS SID containing
      label, TC, S and TTL as defined in  <a href="#type1" class="xref">Section 4.1</a>.<a href="#section-4.2-13" class="pilcrow">¶</a></p>
<p id="section-4.2-14">  If length is 8, then only the IPv4 Node Address is present.<a href="#section-4.2-14" class="pilcrow">¶</a></p>
<p id="section-4.2-15"> If length is 12, then the IPv4 Node Address and the MPLS SID are
      present.When the MPLS SID field is present, it MUST be used for constructing the
   Reply Path TLV.<a href="#section-4.2-15" class="pilcrow">¶</a></p>
</section>
</div>
<div id="type4">
<section id="section-4.3">
        <h3 id="name-type-d-ipv6-node-address-wi">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-type-d-ipv6-node-address-wi" class="section-name selfRef">Type D: IPv6 Node Address with optional SID for SR MPLS</a>
        </h3>
<p id="section-4.3-1">The Type-D Segment Sub-TLV encodes an IPv6 node address, SR Algorithm
   and an optional SID in the form of an MPLS label.  The format is as
   follows:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<span id="name-type-4-segment-sub-tlv"></span><div id="type4_tlv">
<figure id="figure-5">
          <div class="alignLeft art-text artwork" id="section-4.3-2.1">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Type                      |   Length                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Flags       |       RESERVED(MBZ)           | SR Algorithm  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   //                IPv6 Node Address (16 octets)                //
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                SID (optional, 4 octets)                       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-type-4-segment-sub-tlv" class="selfRef">Type 4 Segment sub-TLV</a>
          </figcaption></figure>
</div>
<p id="section-4.3-3">where:<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">  Type: TBD4(to be assigned by IANA from the registry 
   "Sub-TLVs for TLV Types 1, 16, and 21").<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3-5">  Length is 20 or 24.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6">  Flags: 1 octet of flags as defined in  <a href="#flags" class="xref">Section 4.4</a>.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<p id="section-4.3-7"> SR Algorithm: 1 octet specifying SR Algorithm as described in
      section 3.1.1 in <span>[<a href="#RFC8402" class="xref">RFC8402</a>]</span>, when A-Flag as
      defined in  <a href="#flags" class="xref">Section 4.4</a> is present.  SR Algorithm is
   used by the receiver to derive the label.W hen A-flag is unset, this field has no 
   meaning and thus MUST be set to zero on transmission and ignored on receipt.<a href="#section-4.3-7" class="pilcrow">¶</a></p>
<p id="section-4.3-8"> RESERVED: 2 octets of reserved bits.MUST be set to zero when sending;
                 MUST be ignored on receipt..<a href="#section-4.3-8" class="pilcrow">¶</a></p>
<p id="section-4.3-9"> IPv6 Node Address: a 16 octet IPv6 address representing a node.<a href="#section-4.3-9" class="pilcrow">¶</a></p>
<p id="section-4.3-10"> SID: optional :4 octet field containing label, TC, S and
      TTL as defined in  <a href="#type1" class="xref">Section 4.1</a><a href="#section-4.3-10" class="pilcrow">¶</a></p>
<p id="section-4.3-11"> The following applies to the Type-4 Segment sub-TLV:<a href="#section-4.3-11" class="pilcrow">¶</a></p>
<p id="section-4.3-12"> The IPv6 Node Address MUST be present.<a href="#section-4.3-12" class="pilcrow">¶</a></p>
<p id="section-4.3-13">  The SID is optional and specifies a 4 octet MPLS SID containing
      label, TC, S and TTL as defined in  <a href="#type1" class="xref">Section 4.1</a> .<a href="#section-4.3-13" class="pilcrow">¶</a></p>
<p id="section-4.3-14">  If length is 20, then only the IPv6 Node Address is present.<a href="#section-4.3-14" class="pilcrow">¶</a></p>
<p id="section-4.3-15">  If length is 24, then the IPv6 Node Address and the MPLS SID are
      present. When the MPLS SID field is present, it MUST be used for constructing the
   Reply Path TLV.<a href="#section-4.3-15" class="pilcrow">¶</a></p>
</section>
</div>
<div id="flags">
<section id="section-4.4">
        <h3 id="name-segment-flags">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-segment-flags" class="section-name selfRef">Segment Flags</a>
        </h3>
<p id="section-4.4-1">The Segment Types described above contain following flags in the
   "Flags" field (codes to be assigned by IANA from the 
   registry "Segment sub-TLV Flags" )<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<span id="name-flags"></span><div id="flags_field">
<figure id="figure-6">
          <div class="alignLeft art-text artwork" id="section-4.4-2.1">
<pre>
    0 1 2 3 4 5 6 7
   +-+-+-+-+-+-+-+-+
   | |A|           |
   +-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-flags" class="selfRef">Flags</a>
          </figcaption></figure>
</div>
<p id="section-4.4-3">where:<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<p id="section-4.4-4">A-Flag: This flag indicates the presence of SR Algorithm id in the
      "SR Algorithm" field applicable to various Segment Types.<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<p id="section-4.4-5">Unused bits in the Flag octet SHOULD be set to zero upon
      transmission and MUST be ignored upon receipt.<a href="#section-4.4-5" class="pilcrow">¶</a></p>
<p id="section-4.4-6">The following applies to the Segment Flags:<a href="#section-4.4-6" class="pilcrow">¶</a></p>
<p id="section-4.4-7">  A-Flag is applicable to Segment Types 3, 4.  If A-Flag
      appears with any other Segment Type, it MUST be ignored.<a href="#section-4.4-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="SRv6">
<section id="section-5">
      <h2 id="name-srv6-dataplane">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-srv6-dataplane" class="section-name selfRef">SRv6 Dataplane</a>
      </h2>
<p id="section-5-1">SRv6 dataplane is not in the scope of this document and will be 
addressed in a separate document.<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="procedure">
<section id="section-6">
      <h2 id="name-detailed-procedures">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-detailed-procedures" class="section-name selfRef">Detailed Procedures</a>
      </h2>
<div id="initiator_procedure">
<section id="section-6.1">
        <h3 id="name-sending-an-echo-request">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-sending-an-echo-request" class="section-name selfRef">Sending an echo request</a>
        </h3>
<p id="section-6.1-1">In the inter-AS scenario when there is no reverse path connectivity, 
the procedures described in this document should be used.
LSP ping initiator MUST set the Reply Mode of the echo
request to "Reply via Specified Path", and a Reply Path
TLV MUST be carried in the echo request message correspondingly.   
The Reply Path TLV must contain the Segment Routing Path in the 
reverse direction encoded as an ordered list
of segments. The first Segment MUST correspond to the top Segment in
MPLS header that the responder MUST use while sending the echo reply.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="responder_procedure">
<section id="section-6.2">
        <h3 id="name-receiving-an-echo-request">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-receiving-an-echo-request" class="section-name selfRef">Receiving an echo request</a>
        </h3>
<p id="section-6.2-1">As described in <span>[<a href="#RFC7110" class="xref">RFC7110</a>]</span>, when Reply mode is set 
to 5 (Reply via Specified Path),The echo request MUST contain the Reply 
path TLV. Absence of Reply path TLV is treated as malformed
echo request.
when an echo request is
   received, if the egress LSR does not know the Reply Mode 5 defined in
   <span>[<a href="#RFC7110" class="xref">RFC7110</a>]</span>, an echo reply with the return code set to "Malformed
   echo request received" and the Subcode set to zero will be sent back
   to the ingress LSR according to the rules of <span>[<a href="#RFC8029" class="xref">RFC8029</a>]</span>.
   
When a Reply Path TLV is received, and the responder that
supports processing it, it  MUST use the segments in Reply Path TLV to build
the echo reply.The responder MUST follow the normal FEC validation 
procedures as described in  <span>[<a href="#RFC8029" class="xref">RFC8029</a>]</span>
and  <span>[<a href="#RFC8287" class="xref">RFC8287</a>]</span> and this document does not suggest
any change to those procedures. When the echo reply has to be sent 
out the Reply Path TLV is used to construct the MPLS packet to send out.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sending_echo_reply">
<section id="section-6.3">
        <h3 id="name-sending-an-echo-reply">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-sending-an-echo-reply" class="section-name selfRef">Sending an echo reply</a>
        </h3>
<p id="section-6.3-1">The echo reply message is sent as MPLS packet with a MPLS label stack. 
The echo reply message MUST be constructed
as described in the <span>[<a href="#RFC8029" class="xref">RFC8029</a>]</span>. An MPLS packet is 
constructed with echo reply in the payload.
The top label MUST be constructed from the first Segment from the 
Reply Path TLV.
The remaining labels MUST follow the order from the Reply Path TLV. 
The responder  MAY check the reachability of the top label in its
 own Label Forwarding Information Base (LFIB) before sending the echo reply.
 In certain scenarios the head-end
may choose to send Type 3/Type 4 segments consisting of IPV4 address  or
IPv6 address. Optionally a SID may also be assiciated with Type 3/Type4 segment.
In such cases the node sending the
echo reply MUST derive the MPLS labels based on Node-SIDs associated with the 
IPv4 /IPv6 addresses or from the optional MPLS SIDs in the type 3/ type 4 segments
and encode the echo reply with MPLS labels.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">
The reply path return code MUST be set as described in section 7.4 of  <span>[<a href="#RFC7110" class="xref">RFC7110</a>]</span>.
The Reply Path TLV MUST be included in echo reply indicating the 
specified return path that the echo reply message is required to follow as described in 
section 5.3 of  <span>[<a href="#RFC7110" class="xref">RFC7110</a>]</span>.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">
When the node is configured to dynamically create return path for next echo request,
the procedures described in <a href="#Dynamic_TLV_building" class="xref">Section 8</a> MUST be used.
The reply path return code MUST be set to TBA1 and same Reply Path TLV
or a new Reply Path TLV MUST be included in the echo reply.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Receving_echo_reply">
<section id="section-6.4">
        <h3 id="name-receiving-an-echo-reply">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-receiving-an-echo-reply" class="section-name selfRef">Receiving an echo reply</a>
        </h3>
<p id="section-6.4-1">The rules and process defined in Section 4.6 of  <span>[<a href="#RFC8029" class="xref">RFC8029</a>]</span> 
and section 5.4 of <span>[<a href="#RFC7110" class="xref">RFC7110</a>]</span>  apply here. In addition,
if the Reply path return code is  "Use Reply Path TLV 
in echo reply for next echo request", the Reply Path TLV from the
echo Reply MUST be sent in the next echo request with TTL incremented by 1.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Topology_description">
<section id="section-7">
      <h2 id="name-detailed-example">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-detailed-example" class="section-name selfRef">Detailed Example</a>
      </h2>
<p id="section-7-1">Example topologies given in <a href="#Topology_1" class="xref">Figure 1</a> and 
<a href="#Topology_2" class="xref">Figure 2</a> will be used in below sections to explain
LSP Ping and Traceroute procedures. The PMS/Head-end has  complete view
of topology. PE1, P1, P2, ASBR1 and ASBR2 are in AS1. Similarly ASBR3, 
ASBR4, P3, P4 and PE4 are in AS2.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">AS1 and AS2 have Segment Routing enabled. 
IGPs like OSPF/ISIS are used to flood
SIDs in each Autonomous System. The ASBR1, 
ASBR2, ASBR3, ASBR4 advertise BGP EPE SIDs 
for the inter-AS links.
Topology of AS1 and AS2 are advertised via BGP-Link State (BGP-LS)
to the controller/PMS or Head-end node.
The EPE-SIDs are also advertised via BGP-LS as described in 
<span>[<a href="#I-D.ietf-idr-bgpls-segment-routing-epe" class="xref">I-D.ietf-idr-bgpls-segment-routing-epe</a>]</span><a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">The description in the document uses below notations for 
Segment Identifiers(SIDs).<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">Node SIDs : N-PE1, N-P1, N-ASBR1 N-ABR1, N-ABR2etc.<a href="#section-7-4" class="pilcrow">¶</a></p>
<p id="section-7-5">Adjacency SIDs : Adj-PE1-P1, Adj-P1-P2 etc.<a href="#section-7-5" class="pilcrow">¶</a></p>
<p id="section-7-6">EPE SIDS : EPE-ASBR2-ASBR3, EPE-ASBR1-ASBR4, EPE-ASBR3-ASBR2 etc.<a href="#section-7-6" class="pilcrow">¶</a></p>
<p id="section-7-7">Let us consider a traffic engineered path built from PE1 to PE4 
with Segment List stack as below.
N-P1, N-ASBR1, EPE-ASBR1-ASBR4, N-PE4 for following procedures. 
This stack may be programmed
by controller/PMS or Head-end router PE1 may have 
imported the whole topology information 
from BGP-LS and computed the inter-AS path.<a href="#section-7-7" class="pilcrow">¶</a></p>
<div id="Mpls_ping_procedures">
<section id="section-7.1">
        <h3 id="name-procedures-for-segment-rout">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-procedures-for-segment-rout" class="section-name selfRef">Procedures for Segment Routing LSP ping</a>
        </h3>
<p id="section-7.1-1">To perform LSP ping procedure on an SR-MPLS-Path from PE1 to PE4 
consisting of label stacks [N-P1,N-ASBR1,EPE-ASBR1-ASBR4, N-PE4],
The remote end(PE4) needs IP connectivity to head end(PE1) for the
 Segment Routing ping to succeed,
because echo reply needs to travel back to PE1 from PE4.
But in typical deployment scenario there will be no IP route from 
PE4 to PE1 as they belong to different ASes.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2"> PE1 adds return Path from PE4 to PE1 in the MPLS echo request
 using multiple Segments in "Reply Path TLV" 
as defined above.
 An example return path TLV for PE1 to PE4 for
 LSP ping is [N-ASBR4, EPE-ASBR4-ASBR1, N-PE1].
 An implementation may also build a return Path  consisting of labels 
 to reach its own AS. Once the
label stack is popped-off the echo reply message will be exposed.
The further packet forwarding will be based on IP lookup.
An example return Path for this case could be [N-ASBR4, EPE-ASBR4-ASBR1].<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">On receiving MPLS echo request PE4 first validates FEC in the echo request.
 PE4 then builds label stack  to send the response from PE4 to PE1 by copying
 the labels from "Reply Path TLV". PE4 builds the echo reply packet
with the MPLS label stack constructed and imposes MPLS headers 
on top of echo reply packet and sends out the packet towards PE1.
This Segment List stack can successfully steer reply back to Head-end node(PE1).<a href="#section-7.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Mpls_traceroute_procedures">
<section id="section-7.2">
        <h3 id="name-procedures-for-segment-routi">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-procedures-for-segment-routi" class="section-name selfRef">Procedures for Segment Routing LSP Traceroute</a>
        </h3>
<p id="section-7.2-1">Traceroute procedure involves visiting every node on the path and echo reply
sent from every node. In this section, we describe the traceroute mechanims 
when the headend/PMS has complete visibility of the database. Headend/PMS
computes the return path from each node in the entire SR-MPLS path that
is being tracerouted. The return path computation is implementation dependant.
As the headend/PMS completely controls the return path, it can use proprietary 
computations to build the return path.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">One of the ways the return path can be
built, is to use the principle of building label stacks by adding each domain
border node's Node SID on the return path label stack as the traceroute progresses.
For inter-AS networks, in addition to border node's Node-SID, EPE-SID in the reverse
direction also need to be added to the label stack.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2-3">The Inter-domain/inter-as traceroute procedure uses the TTL expiry 
mechansim as specified in  <span>[<a href="#RFC8029" class="xref">RFC8029</a>]</span> and 
<span>[<a href="#RFC8287" class="xref">RFC8287</a>]</span>.  Every echo request packet Headend/PMS
MUST include the appropriate return path in the Reply Path TLV. 
The node that receives the echo request MUST follow procedures
described in section <a href="#initiator_procedure" class="xref">Section 6.1</a> and 
section <a href="#responder_procedure" class="xref">Section 6.2</a> to send out echo reply.<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<p id="section-7.2-4">For Example:<a href="#section-7.2-4" class="pilcrow">¶</a></p>
<p id="section-7.2-5"> Let us consider a topology from <a href="#Topology_1" class="xref">Figure 1</a>.
Let us consider a SR-MPLS path [N-P1,N-ASBR1,EPE-ASBR1-ASBR4, N-PE4].
The traceroute is being executed for this inter-AS path for destination PE4.
PE1 sends first echo request with TTL set to 1 and includes return path TLV
consisting of  Type 1 Segment containing label derived from its 
own SR Global Block (SRGB).
Note that the type of segment used in constructing the return Path is 
local policy. If the entire network has same SRGB configured, Type 1 segments
can be used.The TTL expires on P1 and the P1 sends echo reply using the 
return path. Note that implementations may choose to exclude return path TLV
until traceroute reaches the first domain border as the return IP path to PE1
is expected to be available inside the first domain.<a href="#section-7.2-5" class="pilcrow">¶</a></p>
<p id="section-7.2-6"> TTL is set to 2 and the next echo request is sent out. Until the 
traceroute procedure reaches the domain border node ASBR1, same return path
TLV consisting of single Label (PE1's node Label)is used. When echo request reaches
ASBR1, and echo reply is received, the next echo request needs to include additional
label as ASBR1 is a border node. The return path TLV is built based on the forward path.
As the forward path consists of EPE-ASBR1-ASBR4, an EPE-SID in the reverse direction
is included in the return path TLV. The return path now consists of two
labels [N-PE1, EPE-ASBR4-ASBR1]. The echo reply from ASBR4 will use this return path 
to send the reply.<a href="#section-7.2-6" class="pilcrow">¶</a></p>
<p id="section-7.2-7">
The next echo request after visiting the border node ASBR4 will update the return path
with Node-SID label of ASBR4. The return path beyond ASBR4 will be 
[N-PE1, EPE-ASBR4-ASBR1, N-ASBR4]. This same return path is used until the
traceroute procedure reaches next set of border nodes. When there are multiple ASes
the traceroute procedure will continue by adding a set of Node labels and EPE labels as
the border nodes are visited.<a href="#section-7.2-7" class="pilcrow">¶</a></p>
<p id="section-7.2-8">Note that the above return path building procedure requires the database of all the
domains to be available at the headend/PMS.<a href="#section-7.2-8" class="pilcrow">¶</a></p>
<p id="section-7.2-9"> The above description assumed the same SRGB is configured on all nodes along the path.
The SRGB may differ from one node to another node and the SR architecture <span>[<a href="#RFC8402" class="xref">RFC8402</a>]</span>
allows the nodes to use different SRGB. In such scenarios PE1 sends Type 3
(or Type 4 in case of IPv6 networks) segment with Node address of PE1 and with optional MPLS SID
associated with the Node address. The receiving node  derives the label for the return path based on
its own SRGB. When the traceroute procedure crosses the border ASBR1, headend PE1 should 
send type 1 segment for N-PE1 based on the label derived from ASBR1's SRGB. This is
required because in AS2, ASBR4, P3, P4 etc may not have the topology information to
derive SRGB for PE1. After the traceroute procedure reaches ASBR4 the return path
will be [N-PE1(type1 with label based on ASBR1's SRGB), EPE-ASBR4-ASBR1, N-ASBR4 (Type 3)].<a href="#section-7.2-9" class="pilcrow">¶</a></p>
<p id="section-7.2-10"> In order to extend the example to multiple ASes consisting of 3 or more ASes, let us consider
a traceroute from PE1 to PE5 in <a href="#Topology_1" class="xref">Figure 1</a>. In this example,
the PE1 to PE5 path has to cross 3 domains AS1, AS2 and AS3. Let us consider a path from PE1
to PE5 that goes through [PE1, ASBR1, ASBR4, ASBR6, ASBR8,PE5].
When the traceroute procedure is visiting the nodes in AS1, the Reply path TLV
sent from headend consists of [N-PE1]. When the traceroute procedure reaches the ASBR4,
the return Path consists of [N-PE1, EPE-ASBR4-ASBR1]. While visiting nodes in AS2,
the traceroute procedure consists of Reply Path TLV [N-PE1, EPE-ASBR4-ASBR1, N-ASBR4].
similarly, while visiting the ASBR8 Reply Path TLV adds the EPE SID from ASBR8 to ASBR6.
While visiting nodes in AS3 Node-SId of ASBR8 would also be added which makes the 
return Path [N-PE1, EPE-ASBR4-ASBR1, N-ASBR4, EPE-ASBR8-ASBR6, N-ASBR8]<a href="#section-7.2-10" class="pilcrow">¶</a></p>
<p id="section-7.2-11">Let us consider another example from topology <a href="#Topology_2" class="xref">Figure 2</a>.
This topology consists of multi-domain IGP with common border node between the domains. 
This could be achieved with multi-area or multi-level IGP or multiple instances of IGP
deployed on same node.
The return path computation for this topology is similar to the multi-AS computation
except that the return path consists of single border node label. When traceroute
procedure is visiting node P, the return path consists of [N-PE1, N-ABR1].<a href="#section-7.2-11" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Dynamic_TLV_building">
<section id="section-8">
      <h2 id="name-building-reply-path-tlv-dyn">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-building-reply-path-tlv-dyn" class="section-name selfRef">Building Reply Path TLV dynamically</a>
      </h2>
<p id="section-8-1">In some cases, the head-end may not have complete visibility of 
Inter-AS/Inter-domain topology. 
In such cases, it can rely on downstream routers to build the 
reverse path for MPLS traceroute procedures.
 For this purpose, Reply Path TLV
 in the echo reply corresponds to the return path to be 
 used in next echo request.<a href="#section-8-1" class="pilcrow">¶</a></p>
<span id="name-reply-path-return-code"></span><div id="return_code">
<figure id="figure-7">
        <div class="alignLeft art-text artwork" id="section-8-2.1">
<pre>
   Value         Meaning
   ------        ----------------------
   TBA1        Use Reply Path TLV in echo reply for next echo request.

</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-reply-path-return-code" class="selfRef">Reply path return Code</a>
        </figcaption></figure>
</div>
<div id="TLV_build_procedures">
<section id="section-8.1">
        <h3 id="name-the-procedures-to-build-the">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-the-procedures-to-build-the" class="section-name selfRef">The procedures to build the return path</a>
        </h3>
<p id="section-8.1-1"> In order to dynamically build the return Path for traceroute procedures,
the domain border nodes along the path being tracerouted MUST support the 
procedures described in this section. Local policy on the domain border nodes
SHOULD determine whether the domain border node participates in building
return path dynamically during traceroute.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2"> Headend/PMS node MAY include its own node label while initiating traceroute
procedure.  When an ABR receives the echo request, if the local policy
implies building dynamic return path, ABR MUST include its own Node label. 
If there is a Reply Path TLV included in the received echo request message,
the ABR's node label is added before the existing segments. The type of
segment added is based on local policy. In cases when SRGB is not uniform across the
network, it is RECOMMENDED to add type 3 or type 4 segment.
If the existing segment in the Reply Path TLV is a type 3/type 4 segment, 
that segment MUST be converted to Type 1 segment based on ABR's
own SRGB.This is because downstream nodes will not know what SRGB to use
to translate the IP address to a label. As the ABR added its own Node label, it is
guaranteed that this ABR will be in the return path and will be forwarding the 
traffic based on next label after its own label.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">When an ASBR receives an echo request from another AS, and ASBR is 
configured to build the return path dynamically,
ASBR MUST build a Reply Path TLV and include it in the echo reply.
The Reply Path TLV MUST consist of its own node label and an EPE-SID 
to the AS from where the traceroute message was received.
A Reply path return code of TBA1 MUST be set in the echo reply to indicate that next echo request
 should use the return Path from the Reply Path TLV in the echo reply.
 ASBR MUST locally decide the outgoing interface
for the echo reply packet. Generally, remote ASBR will choose interface
on which the incoming OAM packet was receieved  to send the echo reply out.
Reply Path  TLV is built by adding two segment sub TLVs. The top segment
 sub TLV consists of the ASBR's Node SID and second segment consists 
 of the EPE SID in the reverse direction to reach the AS from which 
the OAM packet was received.The type of segment chosen to build 
Reply Path TLV is a local policy. It is RECOMMENDED to use type 3/type4 segment for 
the top segment when the SRGB is not gurateed to be uniform in the domain.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<p id="section-8.1-4"> Irrespective of which type of segment is included in the Reply Path TLV,
 the responder
 of echo request MUST always translate the Reply Path TLV to a label stack and build
 MPLS header for the the echo reply packet. This procedure can be applied to
 an end-to-end path consisting of multiple ASes.
 Each ASBR that receives echo request from another AS adds its 
 Node-SID and EPE-SID on top of 
 existing segments in the Reply Path TLV.<a href="#section-8.1-4" class="pilcrow">¶</a></p>
<p id="section-8.1-5"> An ASBR that receives the echo request from a neighbor 
 belonging to same AS,
 MUST look at the Reply Path TLV received in the echo request. 
 If the Reply Path TLV
 consists of a Type 3/Type 4 segment, it MUST convert the Type 3/4 segment to Type 1
 segment by deriving label from its own SRGB. The ASBR MUST set the
 reply path return code to TBA1
 and send the newly constructed Reply Path TLV in the echo reply.<a href="#section-8.1-5" class="pilcrow">¶</a></p>
<p id="section-8.1-6">Internal nodes or non domain border nodes MAY not set the Reply Path TLV 
 return code to TBA1  in the 
 echo reply message as there is no change in the return Path. In these cases,
the headend node/PMS that initiates the traceroute procedure MUST continue
to send previously sent
Reply Path TLV in the echo request message in every next echo request.<a href="#section-8.1-6" class="pilcrow">¶</a></p>
<p id="section-8.1-7">Note that an ASBR's local policy may prohibit it from participating in the dynamic
traceroute procedures. If such an ASBR is encountered in the forward path, dynamic return path
building procedures will fail. In such cases, ASBR that supports this document MUST set the
return code TBA2 to indicate local policies do not allow the dynamic return path building.<a href="#section-8.1-7" class="pilcrow">¶</a></p>
<span id="name-local-policy-return-code"></span><div id="return_code2">
<figure id="figure-8">
          <div class="alignLeft art-text artwork" id="section-8.1-8.1">
<pre>
   Value         Meaning
   ------        ---------------------------------------------------
    TBA2        Local policy does not allow dynamic return Path building.

</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-local-policy-return-code" class="selfRef">Local policy return Code</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="TLV_build_procedure_example">
<section id="section-8.2">
        <h3 id="name-details-with-example">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-details-with-example" class="section-name selfRef">Details with example</a>
        </h3>
<p id="section-8.2-1">Let us consider a topology from <a href="#Topology_1" class="xref">Figure 1</a>.
Let us consider a SR policy path  built from PE1 to PE4 
with a label stack as below.  
N-P1, N-ASBR1, EPE-ASBR1-ASBR4, N-PE4.

PE1 begins traceroute with TTL set to 1 and includes [N-PE1] in the Reply Path TLV.
The traceroute packet TTL expires on P1 and P1 processes the traceroute as per the
procedures described in <span>[<a href="#RFC8029" class="xref">RFC8029</a>]</span> and <span>[<a href="#RFC8287" class="xref">RFC8287</a>]</span>.
P1 sends echo reply with the same return Path TLV with reply path return code set to 6.
The return code of the echo reply itself is set to the return code as per 
<span>[<a href="#RFC8029" class="xref">RFC8029</a>]</span> and <span>[<a href="#RFC8287" class="xref">RFC8287</a>]</span>.
 This traceroute doesn't need any changes to the Reply Path TLV 
till it leaves AS1. The same Reply Path TLV that is received may be included in the
echo reply by P1 and P2 or no Reply Path TLV included so that headend continues to
use same return path in echo request that it used to send previous echo request.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">When ASBR1 receives the echo request, in case it recieved type3/type 4 segment
 in the Reply Path TLV in the echo request, it converts that type 3/4 segment to
 Type 1 based on its own SRGB.
 When ASBR4 receives the echo request, it should form this Reply Path TLV 
 using its own Node SID(N-ASBR4)
 and EPE SID (EPE-ASRB4-ASBR1) labels and set the reply path return code to TBA1. 
 Then PE1 should use this Reply Path TLV  in subsequent echo requests.
 In this example, when the subsequent echo request reaches P3, it should use
 this Reply Path TLV for sending the
 echo reply. The same Reply Path TLV is sufficient  for any router in AS2 to send the reply. 
 Because the first label(N-ASBR4) can direct echo reply to ASBR4 
 and second one (EPE-ASBR4-ASBR1) to direct 
 echo reply to AS1. Once echo reply reaches AS1, normal IP forwarding or the N-PE1 helps 
 it to reach PE1.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<p id="section-8.2-3"> The example described in above paragraphs can be extended to multiple ASes by following
 the same procedure of each ASBR adding Node-SID and EPE-SID on receieving echo request from
 neighboring AS.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
<p id="section-8.2-4">Let us consider a topology from <a href="#Topology_2" class="xref">Figure 2</a>.
 It consists of multiple IGP domains with multiple area/levels or separate IGP instances.
 There is a single border node that seperates the two domains. In this case,
 PE1 sends traceroute packet with TTL set to 1 and includes N-PE1 in the return path TLV.
 ABR1 receives the echo request and while sending echo reply adds its own node Label
 to the Reply Path TLV and sets the Reply path return code to TBA1. The Reply path TLV
 in the echo reply from ABR1 consists of [N-PE1, N-ABR1]. Next echo request with TTL 2 reaches
 P node. It is an internal node so it does not change the return Path. echo request with TTL 3
 reaches ABR2 and it adds its own Node label so the return path TLV sent in echo reply
 will be [N-PE1, N-ABR1, N-ABR2]. echo request with TTL 4 reaches PE4 and it sends echo reply return code 
 as Egress. PE4 does not include any Reply Path TLV in echo reply. The above example assumes 
 uniform SRGB throughout the domain. In case of different SRGBs, the top segment will be a type 3/4
 segment and all other segments will be type 1. Each border node converts the type 3/type 4 segment to
 type 1 before adding its own segment to the Reply Path TLV.<a href="#section-8.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-con">
<section id="section-9">
      <h2 id="name-security-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-9-1"> The procedures described in this document enable LSP ping and traceroute to be
 executed across multiple domains or multiple ASes that belong to same adminstration
 or closely co-operating administration. It is assumed that sharing domain internal
 information across such domains does not pose security risk. 
 However procedures described in this document may be used by an attacker to extract the
 domain internal information. An operator MUST deploy appropriate filter policies
 as described in <span>[<a href="#RFC8029" class="xref">RFC8029</a>]</span> to restrict the LSP ping/traceroute packets based on origin.
 It is also suggested that an operator SHOULD deploy security mechanisms such as MACSEC
 on inter-domain links or security vulnerable links to prevent spoofing attacks.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IANA">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">Sub-TLVs for TLV Types 1, 16, and 21<a href="#section-10-1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-10-2.1">SID only in the form of MPLS label : TBD (Range 32768-65535)<a href="#section-10-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal ulEmpty" id="section-10-2.2">IPv4 Node Address with optional SID for SR-MPLS : TBD (Range 32768-65535)<a href="#section-10-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal ulEmpty" id="section-10-2.3">IPv6 Node Address with optional SID for SR-MPLS : TBD (Range 32768-65535)<a href="#section-10-2.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-10-3"> Reply Path Return Codes Registry<a href="#section-10-3" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-10-4.1">TBA1:Use Reply Path TLV in echo reply for next echo request.<a href="#section-10-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal ulEmpty" id="section-10-4.2">TBA2:Local policy does not allow dynamic return Path building.<a href="#section-10-4.2" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<section id="section-11">
      <h2 id="name-contributors">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<p id="section-11-1">1.Carlos Pignataro<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">Cisco Systems, Inc.<a href="#section-11-2" class="pilcrow">¶</a></p>
<p id="section-11-3">cpignata@cisco.com<a href="#section-11-3" class="pilcrow">¶</a></p>
<p id="section-11-4"></p>
<p id="section-11-5">2. Zafar Ali<a href="#section-11-5" class="pilcrow">¶</a></p>
<p id="section-11-6">Cisco Systems, Inc.<a href="#section-11-6" class="pilcrow">¶</a></p>
<p id="section-11-7">zali@cisco.com<a href="#section-11-7" class="pilcrow">¶</a></p>
</section>
<section id="section-12">
      <h2 id="name-acknowledgments">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-12-1"> Thanks to Bruno Decreane for suggesting use of generic Segment sub-TLV.
     Thanks to Adrian Farrel, Huub van Helvoort, Dhruv Dhody, Dongjie, for careful review and comments.
 Thanks to Mach Chen
 for suggesting to use Reply Path TLV. Thanks to Gregory
 Mirsky for detailed review which helped improve the readability of the document to
 a great extent.<a href="#section-12-1" class="pilcrow">¶</a></p>
</section>
<section id="section-13">
      <h2 id="name-references">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-13.1">
        <h3 id="name-normative-references">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7110">[RFC7110]</dt>
        <dd>
<span class="refAuthor">Chen, M.</span>, <span class="refAuthor">Cao, W.</span>, <span class="refAuthor">Ning, S.</span>, <span class="refAuthor">Jounay, F.</span>, and <span class="refAuthor">S. Delord</span>, <span class="refTitle">"Return Path Specified Label Switched Path (LSP) Ping"</span>, <span class="seriesInfo">RFC 7110</span>, <span class="seriesInfo">DOI 10.17487/RFC7110</span>, <time datetime="2014-01" class="refDate">January 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7110">https://www.rfc-editor.org/info/rfc7110</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8029">[RFC8029]</dt>
        <dd>
<span class="refAuthor">Kompella, K.</span>, <span class="refAuthor">Swallow, G.</span>, <span class="refAuthor">Pignataro, C., Ed.</span>, <span class="refAuthor">Kumar, N.</span>, <span class="refAuthor">Aldrin, S.</span>, and <span class="refAuthor">M. Chen</span>, <span class="refTitle">"Detecting Multiprotocol Label Switched (MPLS) Data-Plane Failures"</span>, <span class="seriesInfo">RFC 8029</span>, <span class="seriesInfo">DOI 10.17487/RFC8029</span>, <time datetime="2017-03" class="refDate">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8029">https://www.rfc-editor.org/info/rfc8029</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8287">[RFC8287]</dt>
        <dd>
<span class="refAuthor">Kumar, N., Ed.</span>, <span class="refAuthor">Pignataro, C., Ed.</span>, <span class="refAuthor">Swallow, G.</span>, <span class="refAuthor">Akiya, N.</span>, <span class="refAuthor">Kini, S.</span>, and <span class="refAuthor">M. Chen</span>, <span class="refTitle">"Label Switched Path (LSP) Ping/Traceroute for Segment Routing (SR) IGP-Prefix and IGP-Adjacency Segment Identifiers (SIDs) with MPLS Data Planes"</span>, <span class="seriesInfo">RFC 8287</span>, <span class="seriesInfo">DOI 10.17487/RFC8287</span>, <time datetime="2017-12" class="refDate">December 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8287">https://www.rfc-editor.org/info/rfc8287</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9087">[RFC9087]</dt>
      <dd>
<span class="refAuthor">Filsfils, C., Ed.</span>, <span class="refAuthor">Previdi, S.</span>, <span class="refAuthor">Dawra, G., Ed.</span>, <span class="refAuthor">Aries, E.</span>, and <span class="refAuthor">D. Afanasiev</span>, <span class="refTitle">"Segment Routing Centralized BGP Egress Peer Engineering"</span>, <span class="seriesInfo">RFC 9087</span>, <span class="seriesInfo">DOI 10.17487/RFC9087</span>, <time datetime="2021-08" class="refDate">August 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9087">https://www.rfc-editor.org/info/rfc9087</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-13.2">
        <h3 id="name-informative-references">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-idr-bgpls-segment-routing-epe">[I-D.ietf-idr-bgpls-segment-routing-epe]</dt>
        <dd>
<span class="refAuthor">Previdi, S.</span>, <span class="refAuthor">Talaulikar, K.</span>, <span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Patel, K.</span>, <span class="refAuthor">Ray, S.</span>, and <span class="refAuthor">J. Dong</span>, <span class="refTitle">"Border Gateway Protocol - Link State (BGP-LS) Extensions for Segment Routing BGP Egress Peer Engineering"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-idr-bgpls-segment-routing-epe-19</span>, <time datetime="2019-05-16" class="refDate">16 May 2019</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-idr-bgpls-segment-routing-epe-19.txt">https://www.ietf.org/archive/id/draft-ietf-idr-bgpls-segment-routing-epe-19.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-spring-segment-routing-policy">[I-D.ietf-spring-segment-routing-policy]</dt>
        <dd>
<span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Talaulikar, K.</span>, <span class="refAuthor">Voyer, D.</span>, <span class="refAuthor">Bogdanov, A.</span>, and <span class="refAuthor">P. Mattes</span>, <span class="refTitle">"Segment Routing Policy Architecture"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-spring-segment-routing-policy-14</span>, <time datetime="2021-10-25" class="refDate">25 October 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-spring-segment-routing-policy-14.txt">https://www.ietf.org/archive/id/draft-ietf-spring-segment-routing-policy-14.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7743">[RFC7743]</dt>
        <dd>
<span class="refAuthor">Luo, J., Ed.</span>, <span class="refAuthor">Jin, L., Ed.</span>, <span class="refAuthor">Nadeau, T., Ed.</span>, and <span class="refAuthor">G. Swallow, Ed.</span>, <span class="refTitle">"Relayed Echo Reply Mechanism for Label Switched Path (LSP) Ping"</span>, <span class="seriesInfo">RFC 7743</span>, <span class="seriesInfo">DOI 10.17487/RFC7743</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7743">https://www.rfc-editor.org/info/rfc7743</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8277">[RFC8277]</dt>
        <dd>
<span class="refAuthor">Rosen, E.</span>, <span class="refTitle">"Using BGP to Bind MPLS Labels to Address Prefixes"</span>, <span class="seriesInfo">RFC 8277</span>, <span class="seriesInfo">DOI 10.17487/RFC8277</span>, <time datetime="2017-10" class="refDate">October 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8277">https://www.rfc-editor.org/info/rfc8277</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8402">[RFC8402]</dt>
        <dd>
<span class="refAuthor">Filsfils, C., Ed.</span>, <span class="refAuthor">Previdi, S., Ed.</span>, <span class="refAuthor">Ginsberg, L.</span>, <span class="refAuthor">Decraene, B.</span>, <span class="refAuthor">Litkowski, S.</span>, and <span class="refAuthor">R. Shakir</span>, <span class="refTitle">"Segment Routing Architecture"</span>, <span class="seriesInfo">RFC 8402</span>, <span class="seriesInfo">DOI 10.17487/RFC8402</span>, <time datetime="2018-07" class="refDate">July 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8402">https://www.rfc-editor.org/info/rfc8402</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8403">[RFC8403]</dt>
        <dd>
<span class="refAuthor">Geib, R., Ed.</span>, <span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Pignataro, C., Ed.</span>, and <span class="refAuthor">N. Kumar</span>, <span class="refTitle">"A Scalable and Topology-Aware MPLS Data-Plane Monitoring System"</span>, <span class="seriesInfo">RFC 8403</span>, <span class="seriesInfo">DOI 10.17487/RFC8403</span>, <time datetime="2018-07" class="refDate">July 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8403">https://www.rfc-editor.org/info/rfc8403</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8604">[RFC8604]</dt>
        <dd>
<span class="refAuthor">Filsfils, C., Ed.</span>, <span class="refAuthor">Previdi, S.</span>, <span class="refAuthor">Dawra, G., Ed.</span>, <span class="refAuthor">Henderickx, W.</span>, and <span class="refAuthor">D. Cooper</span>, <span class="refTitle">"Interconnecting Millions of Endpoints with Segment Routing"</span>, <span class="seriesInfo">RFC 8604</span>, <span class="seriesInfo">DOI 10.17487/RFC8604</span>, <time datetime="2019-06" class="refDate">June 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8604">https://www.rfc-editor.org/info/rfc8604</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8660">[RFC8660]</dt>
      <dd>
<span class="refAuthor">Bashandy, A., Ed.</span>, <span class="refAuthor">Filsfils, C., Ed.</span>, <span class="refAuthor">Previdi, S.</span>, <span class="refAuthor">Decraene, B.</span>, <span class="refAuthor">Litkowski, S.</span>, and <span class="refAuthor">R. Shakir</span>, <span class="refTitle">"Segment Routing with the MPLS Data Plane"</span>, <span class="seriesInfo">RFC 8660</span>, <span class="seriesInfo">DOI 10.17487/RFC8660</span>, <time datetime="2019-12" class="refDate">December 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8660">https://www.rfc-editor.org/info/rfc8660</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Shraddha Hegde</span></div>
<div dir="auto" class="left"><span class="org">Juniper Networks Inc.</span></div>
<div dir="auto" class="left"><span class="street-address">Exora Business Park</span></div>
<div dir="auto" class="left">
<span class="locality">Bangalore</span> <span class="postal-code">560103</span>
</div>
<div dir="auto" class="left"><span class="region">KA</span></div>
<div dir="auto" class="left"><span class="country-name">India</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:shraddha@juniper.net" class="email">shraddha@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Kapil Arora</span></div>
<div dir="auto" class="left"><span class="org">Juniper Networks Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:kapilaro@juniper.net" class="email">kapilaro@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Mukul Srivastava</span></div>
<div dir="auto" class="left"><span class="org">Juniper Networks Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:msri@juniper.net" class="email">msri@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Samson Ninan</span></div>
<div dir="auto" class="left"><span class="org">Individual Contributor</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:samson.cse@gmail.com" class="email">samson.cse@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Nagendra Kumar</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems, Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:naikumar@cisco.com" class="email">naikumar@cisco.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
