<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>SIP to RTCWeb Offer/Answer Protocol (ROAP) Gateway</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Mapping to SIP">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 SuccessFull Session Establishment">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Add New Media (video)">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 SuccessFull Session Ending">
<link href="#rfc.section.3" rel="Chapter" title="3 Handling SIP Requests">
<link href="#rfc.section.4" rel="Chapter" title="4 Handling SIP Responses">
<link href="#rfc.section.5" rel="Chapter" title="5 Handling Web Messages">
<link href="#rfc.section.6" rel="Chapter" title="6 Limitations">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document proposes behavior of a RTCWeb signaling gateway for mapping message representations between RTCWeb Offer/Answer Protocol (ROAP) scheme and native SIP messaging scheme. Such a signaling gateway is intended to translate to and from/SIP for enabling use cases between a RTCWeb enabled browser and legacy SIP devices." />
  <meta name="description" content="This document proposes behavior of a RTCWeb signaling gateway for mapping message representations between RTCWeb Offer/Answer Protocol (ROAP) scheme and native SIP messaging scheme. Such a signaling gateway is intended to translate to and from/SIP for enabling use cases between a RTCWeb enabled browser and legacy SIP devices." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">C. Jennings</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">S. Nandakumar</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Cisco</td>
</tr>
<tr>
<td class="left">Expires: April 27, 2012</td>
<td class="right">C. Holmberg</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Ericsson</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 25, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">SIP to RTCWeb Offer/Answer Protocol (ROAP) Gateway<br />
  <span class="filename">draft-jennings-rtcweb-signaling-gateway-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document proposes behavior of a RTCWeb signaling gateway for mapping message representations between RTCWeb Offer/Answer Protocol (ROAP) scheme and native SIP messaging scheme. Such a signaling gateway is intended to translate to and from/SIP for enabling use cases between a RTCWeb enabled browser and legacy SIP devices.</p>
<p>The IETF has been notified of intellectual property rights claimed in regard to some or all of the specification contained in this document.  For more information consult the online list of claimed rights.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 27, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Mapping to SIP</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">SuccessFull Session Establishment</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Add New Media (video)</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">SuccessFull Session Ending</a>
</li>
<li>3.   <a href="#rfc.section.3">Handling SIP Requests</a>
</li>
<li>4.   <a href="#rfc.section.4">Handling SIP Responses</a>
</li>
<li>5.   <a href="#rfc.section.5">Handling Web Messages</a>
</li>
<li>6.   <a href="#rfc.section.6">Limitations</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgments</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li>10.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">This specification suggests one possible way to build a RTCWeb Signaling gateway that maps message representations proposed in <a href="#ROAP">[ROAP]</a> to native SIP <a href="#RFC3261">[RFC3261]</a> messages and vice-versa. The specification <a href="#ROAP">[ROAP]</a> describes a signaling protocol for RTCWeb to support negotiation of media session using SDP offer/answer <a href="#RFC3264">[RFC3264]</a> protocol. Such a signaling protocol enables an RTCWeb browser to setup media sessions to another browser or a SIP device. For Browser-to-SIP device use case, the signaling gateway connects to legacy SIP devices and SHALL translate messages between ROAP and SIP native messages schemes.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Mapping to SIP</h1>
<p></p>

<dl>
<dt>Note:</dt>
<dd style="margin-left: 8">The SDP and SIP examples are not correct but illustrate the rough outline of the mechanism. Future version will correct this. </dd>
<dt></dt>
<dd style="margin-left: 8"></dd>
</dl>
<p id="rfc.section.2.p.2">The design requires the gateway to be SIP transaction statefull but does not require any storage of longer term state. The information that remains constant over the SIP dialog is stored in session tokens while the information that is needed to from a SIP response is stored in response tokens. The gateway appears as a SIP UA to the sip side.  Message on the two sides of the signalling gateway are referred to as the SIP side and web side.</p>
<p id="rfc.section.2.p.3">The following sub-sections show example message flows with detailed message description of native SIP messages that are mapped from ROAP scheme and the ones that are received as responses by the signaling gateway. CallerUA(callerua@atlanta.example.com) is a RTCWeb browser.  CalleeUA(sip:calleeua@sippy.example.com) is assumed to be a SIP-enabled device. It is also assumed that CalleeUA has registered with a SIP proxy server to be able to receive the calls via the proxy.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#sec.successful-session" id="sec.successful-session">SuccessFull Session Establishment</a>
</h1>
<p id="rfc.section.2.1.p.1">In this scenario CallerUA establishes successful media session with CalleeUA, a legacy SIP end-point, with the help of the RTCWeb signaling gateway.</p>
<div id="#rfc.figure.1"></div>
<pre>
participant CallerUA
participant CallerJS
participant SIPGW
participant CalleeUA

CallerJS-&gt;CallerUA: peer=new PeerConnection();

CallerJS-&gt;CallerUA: peer-&gt;addStream();
CallerUA-&gt;CallerJS: sendSignalingChannel();
CallerJS-&gt;SIPGW: {"type":"OFFER", "sdp":"..."}
SIPGW-&gt;CalleeUA: SIP INVITE
note right of CalleeUA: Alert user

CalleeUA-&gt;CallerUA: ICE Checking

CalleeUA-&gt;SIPGW: SIP 180 w/SDP
SIPGW-&gt;CallerJS: {"type":"ANSWER", "more-coming":"TRUE", "sdp":"..."}
note right of CallerJS: This SDP has ICE candidates
CallerJS-&gt;CallerUA: peer-&gt;processSignalingMessage();
CallerUA-&gt;CallerJS: onstatechange();
note left of CallerUA: Might have one way\nmedia flowing at this point

CallerUA-&gt;CalleeUA: More ICE checking
CalleeUA-&gt;CallerUA: ICE Completes
CallerUA-&gt;CallerJS: onopen();

CalleeUA-&gt;SIPGW: SIP 200
SIPGW-&gt;CallerJS: {"type":"ANSWER", "sdp":"..."}
CallerJS-&gt;CallerUA: peer-&gt;processSignalingMessage();
CallerUA-&gt;CallerJS: onopen();

CalleeUA-&gt;CallerUA: Two-way Media     
note right of CalleeUA: Media plays 

CallerUA-&gt;CallerJS: sendSignalingChannel();
CallerJS-&gt;SIPGW: {"type":"OK" }
SIPGW-&gt;CalleeUA: SIP ACK
  </pre>
<p id="rfc.section.2.1.p.2">Message Details</p>
<p id="rfc.section.2.1.p.3">Signaling gateway (on behalf of CallerUA) maps ROAP:OFFER (section 5.3.1 of ROAP<a href="#ROAP">[ROAP]</a>) to SIP:INVITE and sends it to CalleeUA to start the session.</p>
<div id="#rfc.figure.2"></div>
<pre>
 {"type":"OFFER", 
  "offererSessionId":"36707f69b",
  "seq": 1
  "sdp":"
       v=0
       o=callerua 1429 0  IN IP4 client.atlanta.example.com
       s=Call
       c=IN IP4 192.0.2.101
       t=0 0
       m=audio 16384 RTP/AVP 0
       a=rtpmap:0 PCMU/8000
       a=sendrecv"
 }
 </pre>
<div id="#rfc.figure.3"></div>
<pre>
{INVITE sip:calleeua@sippy.example.com SIP/2.0
Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
Max-Forwards: 70
From: CallerUA &lt;sip:callerua@atlanta.example.com&gt;;tag=36707f69b
To: CalleeUA &lt;sip:calleeua@sippy.example.com&gt;
Call-ID: 00000000-00000003-2331a5b0-2aa0cdf5@atlanta.example.com
CSeq: 1 INVITE
Contact: &lt;sip:callerua@client.atlanta.example.com;transport=udp&gt;
Content-Type: application/sdp
            
v=0
o=callerua 1429 0  IN IP4 client.atlanta.example.com
s=Call
c=IN IP4 192.0.2.101
t=0 0
m=audio 16384 RTP/AVP 0
a=rtpmap:0 PCMU/8000
a=sendrecv
}
 </pre>
<p id="rfc.section.2.1.p.4">SIP:180 from CalleeUA is received at the signaling gateway.</p>
<div id="#rfc.figure.4"></div>
<pre>
{SIP/2.0 180 Ringing
Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
From: CallerUA &lt;sip:callerua@atlanta.example.com&gt;;tag=36707f69b
To: CalleeUA &lt;sip:calleeua@sippy.example.com&gt;;tag=8321234356
Call-ID:00000000-00000003-2331a5b0-2aa0cdf5@atlanta.example.com
CSeq: 1 INVITE
Contact: &lt;sip:calleeua@client.sippy.example.com;transport=udp&gt;

v=0
o=calleeua 2890844527 2890844527 IN IP4 client.sippy.example.com
s=Call
c=IN IP4 192.0.2.201
t=0 0
m=audio 16834 RTP/AVP 0
a=rtpmap:0 PCMU/8000
a=sendrecv
}
</pre>
<p id="rfc.section.2.1.p.5">This message SHALL be converted to ROAP:Answer (section 5.3.2 of ROAP<a href="#ROAP">[ROAP]</a>) with "more-coming" flag set to true as described in the section 5.2.3 of ROAP<a href="#ROAP">[ROAP]</a> specification and sent to CallerUA by the signaling gateway.</p>
<div id="#rfc.figure.5"></div>
<pre>
 {"type":"ANSWER", 
  "offererSessionId":"36707f69b",
  "answererSessionId":"8321234356",
  "seq": 1,
  "more-coming": true,
  "sdp":"
       v=0
       o=callerua 1429 0  IN IP4 client.atlanta.example.com
       s=Call
       c=IN IP4 192.0.2.101
       t=0 0
       m=audio 16384 RTP/AVP 0
       a=rtpmap:0 PCMU/8000
       a=sendrecv"
 }
 </pre>
<p id="rfc.section.2.1.p.6">SIP: OK from CalleeUA is received at the signaling gateway.</p>
<div id="#rfc.figure.6"></div>
<pre>
{SIP/2.0 200 OK
Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
From: CallerUA &lt;sip:callerua@atlanta.example.com&gt;;tag=36707f69b
To: CalleeUA &lt;sip:calleeua@sippy.example.com&gt;;tag=8321234356
Call-ID: 00000000-00000003-2331a5b0-2aa0cdf5@atlanta.example.com
CSeq: 1 INVITE
Contact: &lt;sip:calleeua@client.sippy.example.com;transport=udp&gt;
Content-Type: application/sdp

v=0
o=calleeua 2890844527 2890844527 IN IP4 client.sippy.example.com
s=Call
c=IN IP4 192.0.2.201
t=0 0
m=audio 16834 RTP/AVP 0
a=rtpmap:0 PCMU/8000
a=sendrecv
}
</pre>
<p id="rfc.section.2.1.p.7">This message SHALL be converted to ROAP:Answer(section 5.3.2 of ROAP<a href="#ROAP">[ROAP]</a>) and sent to caller by the signaling gateway. This represents a final answer as described in the section 5.2.3 of ROAP<a href="#ROAP">[ROAP]</a></p>
<div id="#rfc.figure.7"></div>
<pre>
 {"type":"ANSWER", 
  "offererSessionId":"36707f69b",
  "answererSessionId":"8321234356",
  "seq": 1,
  "sdp":"
v=0
o=calleeua 2890844527 2890844527 IN IP4 client.sippy.example.com
s=Call
c=IN IP4 192.0.2.201
t=0 0
m=audio 16834 RTP/AVP 0
a=rtpmap:0 PCMU/8000
a=sendrecv"
 }
 </pre>
<p id="rfc.section.2.1.p.8">Signaling gateway (on behalf of CallerUA) maps ROAP:OK (section 5.3.2 of ROAP<a href="#ROAP">[ROAP]</a>) to SIP:ACK and sends it to CalleeUA to start the session. This completes call-setup and media streams are established between CallerUA and the CalleeUA.</p>
<div id="#rfc.figure.8"></div>
<pre>
 {"type":"OK", 
  "offererSessionId":"36707f69b",
  "answererSessionId":"8321234356",
  "seq": 1
 }
 </pre>
<div id="#rfc.figure.9"></div>
<pre>
{ACK sip:calleeua@client.sippy.example.com SIP/2.0
Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
Max-Forwards: 70
From: CallerUA &lt;sip:callerua@atlanta.example.com&gt;;tag=36707f69b
To: CalleeUA &lt;sip:calleeua@sippy.example.com&gt;;tag=8321234356
Call-ID: 00000000-00000003-2331a5b0-2aa0cdf5@atlanta.example.com
CSeq: 1 ACK
}
  </pre>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#sec.new-media" id="sec.new-media">Add New Media (video)</a>
</h1>
<p id="rfc.section.2.2.p.1">This scenario describes the message exchanges when CalleeUA decides to add video as media to an existing audio-only session</p>
<div id="#rfc.figure.10"></div>
<pre>
participant CallerUA
participant CallerJS
participant SIPGW
participant CalleeUA

CalleeUA-&gt;CallerUA: Two-way Media (audio only)     
note right of CalleeUA: Media plays


note right of CalleeUA: Callee decides to add video

CalleeUA-&gt;SIPGW: SIP ReINVITE
SIPGW-&gt;CallerJS: {"type":"OFFER", "sdp":"..."}
CallerJS-&gt;CallerUA: peer-&gt;processSignalingMessage();

CallerUA-&gt;CallerJS: sendSignalingChannel();
CallerJS-&gt;SIPGW: {"type":"ANSWER", "sdp":"..."}
SIPGW-&gt;CalleeUA: SIP 200

CalleeUA-&gt;SIPGW: SIP ACK
SIPGW-&gt;CallerJS: {"type":"OK" }
CallerJS-&gt;CallerUA: peer-&gt;processSignalingMessage();
CallerUA-&gt;CallerJS: onaddstream();


CalleeUA-&gt;CallerUA: Two-way Media     
note right of CalleeUA: Media plays with video

  </pre>
<p id="rfc.section.2.2.p.2">Message Details</p>
<p id="rfc.section.2.2.p.3">On receipt of SIP:INVITE with SDP for video, the signaling gateway maps SIP:INVITE to ROAP:OFFER(section 5.3.1 of ROAP<a href="#ROAP">[ROAP]</a>) and sends it to CallerUA indicating the intent.</p>
<div id="#rfc.figure.11"></div>
<pre>
{INVITE sip:callerua@atlanta.example.com SIP/2.0
Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
Max-Forwards: 70
From: CalleeUA &lt;sip:calleeua@sippy.example.com&gt;;tag=8321234356
To: CallerUA &lt;sip:callrua@atlanta.example.com&gt;;tag=36707f69b
Call-ID: 00000000-00000003-2331a5b0-2aa0cdf5@atlanta.example.com
CSeq: 2 INVITE
Contact: &lt;sip:calleeua@client.sippy.example.com;transport=udp&gt;
Content-Type: application/sdp
            
v=0
o=callerua 1429 0  IN IP4 client.atlanta.example.com
s=SIP Call
c=IN IP4 192.0.2.101
t=0 0
m=video 1024 RTP/AVP 97
a=fmtp:97 profile-level-id=42E00C
a=sendrecv
}
 </pre>
<p id="rfc.section.2.2.p.4">CallerUA accepts the new ROAP:OFFER(section 5.3.1 of ROAP<a href="#ROAP">[ROAP]</a>) and sends ROAP:ANSWER section 5.3.2 of ROAP<a href="#ROAP">[ROAP]</a>).</p>
<div id="#rfc.figure.12"></div>
<pre>
 {"type":"OFFER", 
  "offererSessionId":"36707f69b",
  "answererSessionId":"8321234356",
  "seq": 2,
  "sdp":"
v=0
o=callerua 1429 0  IN IP4 client.atlanta.example.com
s=Call
c=IN IP4 192.0.2.101
t=0 0
m=video 1024 RTP/AVP 97
a=fmtp:97 profile-level-id=42E00C
a=sendrecv"
 }
 </pre>
<p id="rfc.section.2.2.p.5">Which results in the follwing answer.</p>
<div id="#rfc.figure.13"></div>
<pre>
 {"type":"ANSWER", 
  "offererSessionId":"36707f69b",
  "answererSessionId":"8321234356",
  "seq": 2,
  "sdp":"
v=0
o=calleeua 2890844527 2890844527 IN IP4 client.sippy.example.com
s=Call
c=IN IP4 192.0.2.201
t=0 0
m=audio 16834 RTP/AVP 0
a=rtpmap:0 PCMU/8000
a=sendrecv"
 }
 </pre>
<p id="rfc.section.2.2.p.6">The signaling gateway maps the ROAP:ANSWER to SIP:200 to be sent to the CalleeUA.</p>
<div id="#rfc.figure.14"></div>
<pre>
         {
{SIP/2.0 200 OK
Via: SIP/2.0/UDP client.sippy.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.201
From: CalleeUA &lt;sip:calleeua@sippy.example.com&gt;;tag=8321234356
To: CallerUA &lt;sip:calleeua@sippy.example.com&gt;;tag=36707f69b
Call-ID: 00000000-00000003-2331a5b0-2aa0cdf5@atlanta.example.com
CSeq: 102 INVITE
Contact: &lt;sip:callerua@client.atlanta.example.com;transport=udp&gt;
Content-Type: application/sdp

v=0
o=calleeua 2890844527 2890844527 IN IP4 client.sippy.example.com
s=SIP Call
c=IN IP4 192.0.2.201
t=0 0
m=video 1024 RTP/AVP 97
a=fmtp:97 profile-level-id=42E00C
a=sendrecv
}
</pre>
<p id="rfc.section.2.2.p.7">CalleeUA accepts the receipt of SIP:200 by sending SIP:ACK. The signaling gateway SIP:ACK to ROAP:OK (section 5.3.2 of ROAP<a href="#ROAP">[ROAP]</a>) sends it to CallerUA. This completes adding the new media (video) to the existing session.</p>
<div id="#rfc.figure.15"></div>
<pre>
{ACK sip:callerua@client.atlanta.example.com SIP/2.0
Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
Max-Forwards: 70
From: calleeua &lt;sip:calleeua@sippy.example.com&gt;;tag=8321234356
To: callerua &lt;sip:callerua@atlanta.example.com&gt;;tag=36707f69b
Call-ID: 00000000-00000003-2331a5b0-2aa0cdf5@atlanta.example.com
CSeq: 2 ACK
}
</pre>
<div id="#rfc.figure.16"></div>
<pre>
 {"type":"OK", 
  "offererSessionId":"36707f69b",
  "answererSessionId":"8321234356",
  "seq": 2
 }
 </pre>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#sec.end-session" id="sec.end-session">SuccessFull Session Ending</a>
</h1>
<p id="rfc.section.2.3.p.1">This section capture native SIP message descriptions when the caller decides to end the ongoing session.</p>
<div id="#rfc.figure.17"></div>
<pre>
participant CallerUA
participant CallerJS
participant SIPGW
participant CalleeUA

CalleeUA-&gt;CallerUA: Two-way Media (audio + video)     
note right of CalleeUA: Media plays



note left of CallerUA: Caller decides to end the session 

CallerJS-&gt;CallerUA: peer-&gt;close();
CallerUA-&gt;CallerJS: sendSignalingChannel();
CallerJS-&gt;SIPGW: {"type":"SHUTDOWN"}
SIPGW-&gt;CalleeUA: SIP BYE
CalleeUA-&gt;SIPGW: SIP 200
SIPGW-&gt;CallerJS: {"type":"OK"}
CallerJS-&gt;CallerUA: peer-&gt;processSignalingMessage();
  </pre>
<p id="rfc.section.2.3.p.2">Message Details</p>
<p id="rfc.section.2.3.p.3">The signaling gateway maps ROAP:SHUTDOWN message from the CallerUA to SIP:BYE and send it to CalleeUA to end the ongoing session.</p>
<div id="#rfc.figure.18"></div>
<pre>
 {"type":"SHUTDOWN", 
  "offererSessionId":"36707f69b",
  "answererSessionId":"8321234356",
  "seq": 3
 }
 </pre>
<div id="#rfc.figure.19"></div>
<pre>
{BYE sip:callerua@client.atlanta.example.com SIP/2.0
Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bKnashds7
Max-Forwards: 70
From: CallerUA &lt;sip:callerua@atlanta.example.com&gt;;tag=36707f69b
To: CalleeUA &lt;sip:calleeua@sippy.example.com&gt;;tag=8321234356
Call-ID: 00000000-00000003-2331a5b0-2aa0cdf5@atlanta.example.com
CSeq: 3 BYE
}
</pre>
<p id="rfc.section.2.3.p.4">CalleeUA end's the session from it's side by sending SIP:OK.</p>
<div id="#rfc.figure.20"></div>
<pre>
{SIP/2.0 200 OK
Via: SIP/2.0/UDP client.atlanta.example.com:5060;branch=z9hG4bK74bf9
    ;received=192.0.2.101
From: CallerUA &lt;sip:callerua@atlanta.example.com&gt;;tag=36707f69b
To: CalleeUA &lt;sip:calleeua@sippy.example.com&gt;;tag=8321234356
Call-ID: 00000000-00000003-2331a5b0-2aa0cdf5@atlanta.example.com
CSeq: 3 BYE
Contact: &lt;sip:calleeua@client.sippy.example.com;transport=udp&gt;
}
</pre>
<p id="rfc.section.2.3.p.5">This message SHALL be converted to ROAP:OK(section 5.3.2 of ROAP<a href="#ROAP">[ROAP]</a>) and sent to caller by the signaling gateway.</p>
<div id="#rfc.figure.21"></div>
<pre>
 {"type":"OK", 
  "offererSessionId":"36707f69b",
  "answererSessionId":"8321234356",
  "seq": 3
 }
 </pre>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Handling SIP Requests</h1>
<p id="rfc.section.3.p.1">When the signalling gateway receives a SIP request, the gateway forms the message on the web request side in the following way: </p>

<ol>
<li>The SIP methods INVITE, ACK, BYE, CANCEL are mapped to messageType OFFER, OK, SHUTDOWN, SHUTDOWN respectively</li>
<li>The Seq on web side is formed from the numeric portion of CSeq header field value from the SIP side.</li>
<li>The offererSessionId is formed by a JSON object string that has an call-id attribute containing the SIP call-id header field value and a from-tag attribute containing the SIP from-tag.</li>
<li>If there is a SIP to-tag, it is used for the answererSessionId.</li>
<li>If there is a SIP body containing SDP, it is copied into the SDP parameter on web side.</li>
<li>The setSessionToken is formed by a JSON object string that has contact attribute that contains the SIP contact header field value and an route attribute which is an array that has the values of the SIP route header field values in reverse order.</li>
<li>The setResponseToken formed by a JSON object string that has via attribute that is an array containing the SIP via headers field values. The JSON object also includes an attribute that holds the request method. The gateway MAY include any other SIP headers in an attribute named headers which is an array with one header field in each entry.</li>
</ol>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Handling SIP Responses</h1>
<p id="rfc.section.4.p.1">When the signalling gateway receives a SIP response, the gateway forms the message on the web request side in the following way: </p>

<ol>
<li>The SIP responses 180 is mapped to ANSWER with more_coming. A 200 response that contains SDP is mapped to ANSWER. 481 is mapped to NOMATCH. 408 is mapped to TIMEOUT. 486 is mapped to REFUSED. 491 is mapped to CONFLICT. All other SIP 3xx to 6xx responses are mapped to FAILED.</li>
<li>The Seq on web side is formed from the numeric portion of CSeq header field value from the SIP side.</li>
<li>The offererSessionId is formed by a JSON object string that has an call-id attribute containing the SIP call-id header field value and a from-tag attribute containing the SIP from-tag.</li>
<li>The SIP to-tag is used for the answererSessionId.</li>
<li>If there is a SIP body containing SDP, it is copied into the SDP parameter on web side.</li>
<li>The setSessionToken is formed by a JSON object string that has contact attribute that contains the SIP contact header field value and an route attribute which is an array that has the values of the SIP route header field values.</li>
<li>The setResponseToken formed by a JSON object string that has via attribute that is an array containing the SIP via headers field values. The gateway MAY include any other SIP headers in an attribute named headers which is an array with one header field in each entry.</li>
</ol>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Handling Web Messages</h1>
<p id="rfc.section.5.p.1">When the signalling gateway receives a WEB message, the gateway forms the message on the SIP side in the following way: </p>

<ol>
<li>The messageType OFFER, ANSWER with more_coming, ANSWER, OK, NOMATCH, TIMEOUT, REFUSED, CONFLICT, FAILED are mapped to INVITE, 180, 200, ACK, 481, 408, 486, 491, 500 respectively.</li>
<li>The messageType SHUTDOWN is mapped to a CANCEL if the answererSessionId is empty and to BYE otherwise</li>
<li>For SIP responses, The numeric portion of the CSeq is formed by taking the number portion from the Seq field. If the setResponseToken contains a method name, that is used for the method portion of the CSeq otherwise if it does not exist, the request method of the SIP message is used.</li>
<li>The Call-ID header field values is formed from the call-id attribute of the offererSessionId.</li>
<li>The from-tag is formed from the from-tag attribute of the offererSessionId.</li>
<li>If there is a answererSessionId, it is used for the SIP to-tag.</li>
<li>If there is a SDP parameter, it is used as a SIP SDP body and the content type of and content length headers are set appropriately.</li>
<li>If there is a sessionToken that contains a contact attribute, it is used to form the SIP contact header field value.</li>
<li>If there is a sessionToken that contains a route array, it is used to form the SIP route header field values.</li>
<li>If there is a responseToken that contains a via array, it is used to form the SIP via header field values.</li>
</ol>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Limitations</h1>
<p id="rfc.section.6.p.1">The following things, if used on the SIP side, will not interoperate:</p>
<p></p>

<ul>
<li>Redirection via 3xx</li>
<li>UPDATE / PRACK</li>
<li>REFER</li>
<li>SIP to pre RFC 3261 devices that don't support to and from tags.</li>
<li>SUB/NOTify</li>
<li>SIP INVITES that do not contain an SDP offer</li>
<li>SIP extensions to RFC 3261.</li>
</ul>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#sec-sec" id="sec-sec">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">TBD</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> IANA Considerations</h1>
<p id="rfc.section.8.p.1">This document requires no actions from IANA.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Acknowledgments</h1>
<p id="rfc.section.9.p.1">&lt;Get your name here&gt;</p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC3264">[RFC3264]</b></td>
<td class="top">
<a>Rosenberg, J.</a> and <a>H. Schulzrinne</a>, "<a href="http://tools.ietf.org/html/rfc3264">An Offer/Answer Model with Session Description Protocol (SDP)</a>", RFC 3264, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-rtcweb-use-cases-and-requirements">[I-D.ietf-rtcweb-use-cases-and-requirements]</b></td>
<td class="top">
<a>Holmberg, C</a>, <a>Hakansson, S</a> and <a>G Eriksson</a>, "<a href="http://tools.ietf.org/html/draft-ietf-rtcweb-use-cases-and-requirements-06">Web Real-Time Communication Use-cases and Requirements</a>", Internet-Draft draft-ietf-rtcweb-use-cases-and-requirements-06, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="ROAP">[ROAP]</b></td>
<td class="top">
<a>Jennings, C.</a> and <a>J. Rosenberg</a>, "<a href="http://tools.ietf.org/html/draft-jennings-rtcweb-signaling">RTCWeb Offer/Answer Protocol (ROAP)</a>", Internet-Draft draft-jennings-rtcweb-signaling, October 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Cullen Jennings</span> 
	  <span class="n hidden">
		<span class="family-name">Jennings</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  <span>170 West Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 408 421-9990</span>

<span class="vcardline">EMail: <a href="mailto:fluffy@cisco.com">fluffy@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Suhas Nandakumar</span> 
	  <span class="n hidden">
		<span class="family-name">Nandakumar</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  <span>170 West Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:snandaku@cisco.com">snandaku@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Christer Holmberg</span> 
	  <span class="n hidden">
		<span class="family-name">Holmberg</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>Hirsalantie 11</span>

	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region">Jorvas</span> 
		<span class="code">02420</span>
	  </span>
	  <span class="country-name vcardline">Finland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:christer.holmberg@ericsson.com">christer.holmberg@ericsson.com</a></span>

  </address>
</div>

</body>
</html>