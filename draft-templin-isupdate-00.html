<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>ISATAP Updates</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 ISATAP Updates">
<link href="#rfc.section.3" rel="Chapter" title="3 DHCPv6 Services">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Advertising ISATAP Router Behavior">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 ISATAP Host Behavior">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Non-Advertising ISATAP Router Behavior">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Reference Operational Scenario - No Prefix Model">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 DHCPv6 Site Administration Guidance">
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 On-Demand Dynamic Routing for DHCP">
<link href="#rfc.section.3.7" rel="Chapter" title="3.7 Loop Avoidance">
<link href="#rfc.section.4" rel="Chapter" title="4 Manual Configuration">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Many end user sites in the Internet today still have predominantly IPv4 internal infrastructures. These sites range in size from small home/office networks to large corporate enterprise networks, but share the commonality that IPv4 continues to provide satisfactory internal routing and addressing services for most applications. As more and more IPv6-only services are deployed in the Internet, however, end user devices within such sites will increasingly require at least basic IPv6 functionality for external access. It is also expected that more and more IPv6-only devices will be deployed within the site over time. This document therefore discusses updates to the Intra-Site Automatic Tunnel Addressing Protocol (ISATAP) to better accommodate these needs." />
  <meta name="description" content="Many end user sites in the Internet today still have predominantly IPv4 internal infrastructures. These sites range in size from small home/office networks to large corporate enterprise networks, but share the commonality that IPv4 continues to provide satisfactory internal routing and addressing services for most applications. As more and more IPv6-only services are deployed in the Internet, however, end user devices within such sites will increasingly require at least basic IPv6 functionality for external access. It is also expected that more and more IPv6-only devices will be deployed within the site over time. This document therefore discusses updates to the Intra-Site Automatic Tunnel Addressing Protocol (ISATAP) to better accommodate these needs." />
  <meta name="keywords" content="I-D, Internet-Draft" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">F. Templin</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Boeing Research &amp; Technology</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">July 02, 2011</td>
</tr>
<tr>
<td class="left">Expires: January 03, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">ISATAP Updates<br />
  <span class="filename">draft-templin-isupdate-00.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Many end user sites in the Internet today still have predominantly IPv4 internal infrastructures. These sites range in size from small home/office networks to large corporate enterprise networks, but share the commonality that IPv4 continues to provide satisfactory internal routing and addressing services for most applications. As more and more IPv6-only services are deployed in the Internet, however, end user devices within such sites will increasingly require at least basic IPv6 functionality for external access. It is also expected that more and more IPv6-only devices will be deployed within the site over time. This document therefore discusses updates to the Intra-Site Automatic Tunnel Addressing Protocol (ISATAP) to better accommodate these needs.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 03, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">ISATAP Updates</a>
</li>
<li>3.   <a href="#rfc.section.3">DHCPv6 Services</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Advertising ISATAP Router Behavior</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">ISATAP Host Behavior</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Non-Advertising ISATAP Router Behavior</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Reference Operational Scenario - No Prefix Model</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">DHCPv6 Site Administration Guidance</a>
</li>
<li>3.6.   <a href="#rfc.section.3.6">On-Demand Dynamic Routing for DHCP</a>
</li>
<li>3.7.   <a href="#rfc.section.3.7">Loop Avoidance</a>
</li>
<li>4.   <a href="#rfc.section.4">Manual Configuration</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Acknowledgments</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">End user sites in the Internet today currently use IPv4 routing and addressing internally for core operating functions such as web browsing, filesharing, network printing, e-mail, teleconferencing and numerous other site-internal networking services. Such sites typically have an abundance of public or private IPv4 addresses for internal networking, and are separated from the public Internet by firewalls, packet filtering gateways, proxies, address translators and other site border demarcation devices. To date, such sites have had little incentive to enable IPv6 services internally <a href="#RFC1687">[RFC1687]</a>.</p>
<p id="rfc.section.1.p.2">End-user sites that currently use IPv4 services internally come in endless sizes and varieties. For example, a home network behind a Network Address Translator (NAT) may consist of a single link supporting a few laptops, printers etc. As a larger example, a small business may consist of one or a few offices with several networks connecting considerably larger numbers of computers, routers, handheld devices, printers, faxes, etc. Moving further up the scale, large banks, restaurants, major retailers, large corporations, etc. may consist of hundreds or thousands of branches worldwide that are tied together in a complex global enterprise network. Additional examples include personal-area networks, mobile vehicular networks, disaster relief networks, tactical military networks, and various forms of Mobile Ad-hoc Networks (MANETs). These cases and more are discussed in RANGERS<a href="#RFC6139">[RFC6139]</a>.</p>
<p id="rfc.section.1.p.3">With the proliferation of IPv6 devices in the public Internet, however, existing IPv4 sites will increasingly require a means for enabling IPv6 services so that hosts within the site can communicate with IPv6-only correspondents. Such services must be deployable with minimal configuration, and in a fashion that will not cause disruptions to existing IPv4 services. The Intra-Site Automatic Tunnel Addressing Protocol (ISATAP) <a href="#RFC5214">[RFC5214]</a> provides a simple-to-use service that sites can deploy in the near term to meet these requirements, as discussed in <a href="#I-D.templin-v6ops-isops">[I-D.templin-v6ops-isops]</a>. However, the ISATAP base specification has several fundamental limitations that restrict its applicability.</p>
<p id="rfc.section.1.p.4">For example, the base specification does not allow for router-to-router tunneling and therefore does not support DHCPv6-based address and/or prefix delegation services <a href="#RFC3315">[RFC3315]</a><a href="#RFC3633">[RFC3633]</a>. The base specification moreover does not permit the assignment of non ISATAP-format addresses of any kind to the ISATAP interface. Finally, the base specification provides no means for address selection preference of IPv4 over ISATAP for communications within the same site.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> ISATAP Updates</h1>
<p id="rfc.section.2.p.1">The base ISATAP model supports two basic node types - namely, advertising ISATAP routers and ISATAP hosts. Advertising ISATAP routers configure their site-facing ISATAP interfaces as advertising router interfaces (see: <a href="#RFC4861">[RFC4861]</a>, Section 6.2.2). ISATAP hosts configure their site-facing ISATAP interfaces as simple host interfaces and also coordinate their autoconfiguration operations with advertising ISATAP routers.</p>
<p id="rfc.section.2.p.2">This document introduces a third node type known as "non-advertising ISATAP routers". Non-advertising ISATAP routers configure their site-facing ISATAP interfaces as non-advertising router interfaces and obtain IPv6 addresses/prefixes via autoconfiguration exchanges with advertising ISATAP routers. Non-advertising ISATAP routers connect IPv6 networks to the ISATAP link, and can therefore support a router-to-router tunneling mode not permitted under the base specification.</p>
<p id="rfc.section.2.p.3">To support this router-to-router tunneling (and also to support the assignment of non ISATAP-format addresses on ISATAP interfaces) ISATAP nodes add an update to the source address verification checks specified in Section 7.3 of <a href="#RFC5214">[RFC5214]</a>. Namely, the node also considers the outer IPv4 source address correct for the inner IPv6 source address if:</p>
<p></p>

<ul><li>a forwarding table entry exists that lists the packet's IPv4 source address as the link-layer address corresponding to the inner IPv6 source address via the ISATAP interface.</li></ul>
<p id="rfc.section.2.p.5">The base ISATAP model further does not specify any IPv6 multicast mappings. This precludes the use of services such as DHCPv6 which require a link-scoped IPv6 multicasting service. To support DHCPv6 services, ISATAP hosts and non-advertising ISATAP routers that observe this specification map the IPv6 "All_DHCP_Relay_Agents_and_Servers" link-scoped multicast address to the IPv4 address of an advertising ISATAP router. Advertising ISATAP routers in turn configure a DHCPv6 server or relay function, and accept DHCPv6 messages sent by clients using this mapping.</p>
<p id="rfc.section.2.p.6">Finally, this document updates the address selection policies of the base specification as follows. For communications between two nodes whose IPv6 addresses are covered by the same IPv6 prefix advertised in Router Advertisements (RAs) on an ISATAP interface, prefer IPv4 over IPv6 if the L bit in the Prefix Information Option (PIO) is set to 0.</p>
<p id="rfc.section.2.p.7">Using these updates, a much richer ISATAP service model is possible as discussed in the following sections.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> DHCPv6 Services</h1>
<p id="rfc.section.3.p.1">Whether or not advertising ISATAP routers make stateless IPv6 services available using StateLess Address AutoConfiguration (SLAAC), they can also provide managed IPv6 services to ISATAP clients (i.e., both hosts and non-advertising ISATAP routers) using DHCPv6. Any addresses/prefixes obtained via DHCPv6 are distinct from any IPv6 prefixes advertised on the ISATAP interface for SLAAC purposes, however.  In this way, DHCPv6 addresses/prefixes are reached by viewing the ISATAP tunnel interface as a "transit" rather than viewing it as an ordinary IPv6 host interface. In contrast to the shared prefix and individual prefix models described in <a href="#I-D.templin-v6ops-isops">[I-D.templin-v6ops-isops]</a>, we refer to this as the "no prefix" model.</p>
<p id="rfc.section.3.p.2">The following sections discuss operational considerations for enabling ISATAP DHCPv6 services within predominantly IPv4 sites.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#router-dhcpv6" id="router-dhcpv6">Advertising ISATAP Router Behavior</a>
</h1>
<p id="rfc.section.3.1.p.1">Advertising ISATAP routers that support DHCPv6 services send RA messages in response to Router Solicitation (RS) messages received on an advertising ISATAP interface. Advertising ISATAP routers also configure either a DHCPv6 relay or server function to service DHCPv6 requests received from ISATAP clients.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#host-dhcpv6" id="host-dhcpv6">ISATAP Host Behavior</a>
</h1>
<p id="rfc.section.3.2.p.1">ISATAP hosts send RS messages to obtain RA messages from an advertising ISATAP router. Whether or not IPv6 prefixes for SLAAC are advertised, the host can acquire IPv6 addresses, e.g., through the use of DHCPv6 stateful address autoconfiguration <a href="#RFC3315">[RFC3315]</a>. To acquire addresses, the host performs standard DHCPv6 exchanges while mapping the IPv6 "All_DHCP_Relay_Agents_and_Servers" link-scoped multicast address to the IPv4 address of an advertising ISATAP router.</p>
<p id="rfc.section.3.2.p.2">After the host receives IPv6 addresses, it assigns them to its ISATAP interface and forwards any of its outbound IPv6 packets via the advertising router as a default router. The advertising router in turn maintains IPv6 forwarding table entries that list the IPv4 address of the host as the link-layer address of the delegated IPv6 addresses.  Note that IPv6 addresses acquired from DHCPv6 therefore need not be ISATAP addresses, i.e., even though the addresses are assigned to the ISATAP interface.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#non-router-dhcpv6" id="non-router-dhcpv6">Non-Advertising ISATAP Router Behavior</a>
</h1>
<p id="rfc.section.3.3.p.1">Non-advertising ISATAP routers can acquire IPv6 prefixes, e.g., through the use of DHCPv6 Prefix Delegation <a href="#RFC3633">[RFC3633]</a> via an advertising router in the same fashion as described for host-based DHCPv6 stateful address autoconfiguration in <a href="#host-dhcpv6">Section 3.2</a>. The advertising router in turn maintains IPv6 forwarding table entries that list the IPv4 address of the non-advertising router as the link-layer address of the next hop toward the delegated IPv6 prefixes.</p>
<p id="rfc.section.3.3.p.2">In many use case scenarios (e.g., small enterprise networks, MANETs, etc.), advertising and non-advertising ISATAP routers can engage in a proactive dynamic IPv6 routing protocol (e.g., OSPFv3, RIPng, etc.) over their ISATAP interfaces so that IPv6 routing/forwarding tables can be populated and standard IPv6 forwarding between ISATAP routers can be used. In other scenarios (e.g., large enterprise networks, highly mobile MANETs, etc.), this might be impractical dues to scaling issues. When a proactive dynamic routing protocol cannot be used, non-advertising ISATAP routers send RS messages to obtain RA messages from an advertising ISATAP router, i.e., they act as "hosts" on their non-advertising ISATAP interfaces.</p>
<p id="rfc.section.3.3.p.3">After the non-advertising ISATAP router acquires IPv6 prefixes, it can sub-delegate them to routers and links within its attached IPv6 edge networks, then can forward any outbound IPv6 packets coming from its edge networks via other ISATAP nodes on the link.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#avoidance-fig" id="avoidance-fig">Reference Operational Scenario - No Prefix Model</a>
</h1>
<p><a href="#no-onlink-prefix-fig">Figure 1</a> depicts a reference ISATAP network topology that uses DHCPv6. The scenario shows two advertising ISATAP routers ('A', 'B'), two non-advertising ISATAP routers ('C', 'E'), an ISATAP host ('G'), and three ordinary IPv6 hosts ('D', 'F', 'H') in a typical deployment configuration:</p>
<div id="#rfc.figure.1"></div>
<div id="#no-onlink-prefix-fig"></div>
<pre>                 .-(::::::::)      2001:db8:3::1
              .-(::: IPv6 :::)-.  +-------------+
             (:::: Internet ::::) | IPv6 Host H |
              `-(::::::::::::)-'  +-------------+
                 `-(::::::)-'
             ,~~~~~~~~~~~~~~~~~,
        ,----|companion gateway|--.
       /     '~~~~~~~~~~~~~~~~~'  :
      /                           |.
   ,-'                              `.
  ;  +------------+   +------------+  )
  :  |  Router A  |   |  Router B  |  /
   : |  (isatap)  |   |  (isatap)  |  :    fe80::*192.0.2.6
   : | 192.0.2.1  |   | 192.0.2.1  | ;       2001:db8:2::1
   + +------------+   +------------+  \    +--------------+
  fe80::*:192.0.2.1   fe80::*:192.0.2.1    |   (isatap)   |
  |                                   ;    |    Host G    |
  :              IPv4 Site         -+-'    +--------------+
   `-.       (PRL: 192.0.2.1)       .)
      \                           _)
       `-----+--------)----+'----'
  fe80::*:192.0.2.4        fe80::*:192.0.2.5         .-.
  +--------------+         +--------------+       ,-(  _)-.
  |   (isatap)   |         |   (isatap)   |    .-(_ IPv6  )-.
  |   Router C   |         |   Router E   |--(__Edge Network )
  +--------------+         +--------------+     `-(______)-'
   2001:db8:0::/48          2001:db8:1::/48           |
          |                                     2001:db8:1::1
         .-.                                   +-------------+
      ,-(  _)-.      2001:db8:0::1             | IPv6 Host F |
   .-(_ IPv6  )-.   +-------------+            +-------------+
 (__Edge Network )--| IPv6 Host D |
    `-(______)-'    +-------------+

(* == "5efe")
</pre>
<p id="rfc.section.3.4.p.2">In <a href="#no-onlink-prefix-fig">Figure 1</a>, advertising ISATAP routers 'A' and 'B' within the IPv4 site connect to the IPv6 Internet via a companion gateway. (Note that the routers may instead connect to the IPv6 Internet directly as shown in <a href="#I-D.templin-v6ops-isops">[I-D.templin-v6ops-isops]</a>. For the purpose of this example, we also assume that the IPv4 site is configured within a single IPv4 subnet.</p>
<p id="rfc.section.3.4.p.3">Advertising ISATAP routers 'A' and 'B' both configure the IPv4 anycast address 192.0.2.1 on a site-interior IPv4 interface, and configure an advertising ISATAP interface with link-local ISATAP address fe80::5efe:192.0.2.1. The site administrator then places the single IPv4 address 192.0.2.1 in the Potential Router List (PRL) for the site. 'A' and 'B' then both advertise the anycast address/prefix into the site's IPv4 routing system so that ISATAP clients can locate the router that is topologically closest. (Note: advertising ISATAP routers can instead use individual IPv4 unicast addresses instead of a shared IPv4 anycast address. In that case, the PRL will contain multiple IPv4 addresses of advertising routers.)</p>
<p id="rfc.section.3.4.p.4">Non-advertising ISATAP router 'C' connects to one or more IPv6 edge networks and also connects to the site via an IPv4 interface with address 192.0.2.4, but it does not advertise the site's IPv4 anycast address/prefix. 'C' next configures a non-advertising ISATAP router interface with link-local ISATAP address fe80::5efe:192.0.2.4, then discovers router 'A' via an IPv6-in-IPv4 encapsulated RS/RA exchange.  'C' next receives the IPv6 prefix 2001:db8:0::/48 through a DHCPv6 prefix delegation exchange via 'A', then engages in an IPv6 routing protocol over its ISATAP interface and announces the delegated IPv6 prefix. 'C' finally sub-delegates the prefix to its attached edge networks, where IPv6 host 'D' autoconfigures the address 2001:db8:0::1.</p>
<p id="rfc.section.3.4.p.5">Non-advertising ISATAP router 'E' connects to the site, configures its ISATAP interface, performs an RS/RA exchange, receives a DHCPv6 prefix delegation, and engages in the IPv6 routing protocol the same as for 'C'. In particular, 'E' configures the IPv4 address 192.0.2.5 and the link-local ISATAP address fe80::5efe:192.0.2.5. 'E' then receives the delegated IPv6 prefix 2001:db8:1::/48 and sub-delegates the prefix to its attached edge networks, where IPv6 host 'F' autoconfigures IPv6 address 2001:db8:1::1.</p>
<p id="rfc.section.3.4.p.6">ISATAP host 'G' connects to the site via an IPv4 interface with address 192.0.2.6, and also configures an ISATAP host interface with link-local ISATAP address fe80::5efe:192.0.2.6 over the IPv4 interface. 'G' next performs an anycast RS/RA exchange to discover 'B" and configure a default IPv6 route with next-hop address fe80::5efe:192.0.2.1. 'G' then receives the IPv6 address 2001:db8:2::1 from a DHCPv6 address configuration exchange via 'B'; it then assigns the address to the ISATAP interface but does not assign a non-link-local IPv6 prefix to the interface.</p>
<p id="rfc.section.3.4.p.7">Finally, IPv6 host 'H' connects to an IPv6 network outside of the ISATAP domain. 'H' configures its IPv6 interface in a manner specific to its attached IPv6 link, and autoconfigures the IPv6 address 2001:db8:3::1.</p>
<p id="rfc.section.3.4.p.8">Following this autoconfiguration, when host 'D' has an IPv6 packet to send to host 'F', it prepares the packet with source address 2001:db8:0::1 and destination address 2001:db8:1::1, then sends the packet into the edge network where IPv6 forwarding will eventually convey it to router 'C'. 'C' then uses IPv6-in-IPv4 encapsulation to forward the packet to router 'E', since it has discovered a route to 2001:db8:1::/48 with next hop 'E' via dynamic routing over the ISATAP interface. Router 'E' finally sends the packet into the edge network where IPv6 forwarding will eventually convey it to host 'F'.</p>
<p id="rfc.section.3.4.p.9">In a second scenario, when 'D' has a packet to send to ISATAP host 'G', it prepares the packet with source address 2001:db8:0::1 and destination address 2001:db8:2::1, then sends the packet into the edge network where it will eventually be forwarded to router 'C' the same as above. 'C' then uses IPv6-in-IPv4 encapsulation to forward the packet to router 'A' (i.e., 'C's default router), which in turn forwards the packet to 'G'. Note that this operation entails two hops across the ISATAP link (i.e., one from 'C' to 'A', and a second from 'A' to 'G'). If 'G' also participates in the dynamic IPv6 routing protocol, however, 'C' could instead forward the packet directly to 'G' without involving 'A'.</p>
<p id="rfc.section.3.4.p.10">In a third scenario, when 'D' has a packet to send to host 'H' in the IPv6 Internet, the packet is forwarded to 'C' the same as above.  'C' then forwards the packet to 'A', which forwards the packet into the IPv6 Internet.</p>
<p id="rfc.section.3.4.p.11">In a final scenario, when 'G' has a packet to send to host 'H' in the IPv6 Internet, the packet is forwarded directly to 'B', which forwards the packet into the IPv6 Internet.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> DHCPv6 Site Administration Guidance</h1>
<p id="rfc.section.3.5.p.1">Site administrators configure advertising ISATAP routers that also support the DHCPv6 relay/server function to send RA messages with the M flag set to 1 as an indication to clients that the stateful DHCPv6 address autoconfiguration services area available. If stateless DHCPv6 services are also available, the RA messages also set the O flag to 1.</p>
<p id="rfc.section.3.5.p.2">Gateways and packet filtering devices of various forms are often deployed in order to divide the site into separate partitions.  Although the purely DHCPv6 model does not involve the advertisement of non-link-local IPv6 prefixes on ISATAP interfaces, alignment of IPv6 prefixes used for DHCPv6 address assignment with IPv4 site partitions is still recommended so that ISATAP clients can prefer native IPv4 communications over ISATAP IPv6 services for correspondents within their contiguous IPv4 partition.</p>
<p id="rfc.section.3.5.p.3">For example, if the site is assigned the aggregate prefix 2001:db8:0::/48, then the site administrators can assign the more-specific prefixes 2001:db8:0:0::/64, 2001:db8:0:1::/64, 2001:db8:0:2::/64, etc. to the different IPv4 partitions within the site. The administrators can then institute a policy that prefers native IPv4 addresses for communications between clients covered by the same /64 prefix.</p>
<p id="rfc.section.3.5.p.4">Site administrators can implement this policy implicitly by configuring advertising ISATAP routers to advertise each /64 prefix with both the A and L flags set to 0 as an indication that IPv4 should be preferred over IPv6 destinations that configure addresses from the same prefix. Site administrators can instead (or in addition) implement address selection policy rules <a href="#RFC3484">[RFC3484]</a> through explicit configurations in each ISATAP client.</p>
<p id="rfc.section.3.5.p.5">For example, each ISATAP client associated with the prefix 2001:db8:0:0::/64 can add the prefix to its address selection policy table with a lower precedence than the prefix ::ffff:0:0/96. In this way, IPv4 addresses are preferred over IPv6 addresses from within the same /64 prefix. The prefix could be added to each ISATAP client either manually, or through an automated service such as a DHCP option <a href="#I-D.ietf-6man-addr-select-opt">[I-D.ietf-6man-addr-select-opt]</a>. In this way, clients will use IPv4 communications to reach correspondents within the same IPv4 site partition, and will use IPv6 communications to reach correspondents in other partitions and/or outside of the site.</p>
<p id="rfc.section.3.5.p.6">Finally, site administrators should configure ISATAP routers to not send ICMPv6 Redirect messages to inform a source client of a better next hop toward the destination unless there is strong assurance that the client and the next hop are within the same IPv4 site partition (see Section 4.6 for further considerations).</p>
<h1 id="rfc.section.3.6">
<a href="#rfc.section.3.6">3.6.</a> <a href="#predirect" id="predirect">On-Demand Dynamic Routing for DHCP</a>
</h1>
<p id="rfc.section.3.6.p.1">With respect to the reference operational scenarios depicted in <a href="#no-onlink-prefix-fig">Figure 1</a>, there may be use cases in which a proactive dynamic IPv6 routing protocol cannot be used. For example, in large enterprise network deployments it would be impractical for all ISATAP routers to engage in a common routing protocol instance due to scaling considerations.</p>
<p id="rfc.section.3.6.p.2">In those cases, an on-demand routing capability can be enabled in which ISATAP nodes send initial packets via an advertising ISATAP router and receive redirection messages back. For example, when a non-advertising ISATAP router 'C' has a packet to send to a host located behind non-advertising ISATAP router 'E', it can send the initial packets via advertising router 'A' which will return redirection messages to inform 'C' that 'E' is a better first hop.  Protocol details for this redirection procedure (including a means for detecting whether the direct path is usable) are specified in <a href="#I-D.templin-aero">[I-D.templin-aero]</a>.</p>
<h1 id="rfc.section.3.7">
<a href="#rfc.section.3.7">3.7.</a> <a href="#loopavoid-dhcp" id="loopavoid-dhcp">Loop Avoidance</a>
</h1>
<p id="rfc.section.3.7.p.1">In a purely DHCPv6-based ISATAP deployment, no non-link-local IPv6 prefixes are assigned to ISATAP router interfaces. Therefore, an ISATAP router cannot mistake another router for an ISATAP host due to an address that matches an on-link prefix. This corresponds to the mitigation documented in Section 3.2.4 of <a href="#I-D.ietf-v6ops-tunnel-loops">[I-D.ietf-v6ops-tunnel-loops]</a>.</p>
<p id="rfc.section.3.7.p.2">Any routing loops introduced in the DHCPv6 scenario would therefore be due to a misconfiguration in IPv6 routing the same as for any IPv6 router, and hence are out of scope for this document.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Manual Configuration</h1>
<p id="rfc.section.4.p.1">In addition to any SLAAC services and DHCPv6 services, site administrators can use manual configuration to assign non-ISATAP IPv6 addresses to the ISATAP interfaces of client end systems. Site administrators can also use manual configuration to delegate IPv6 prefixes to non-advertising ISATAP routers instead of (or in addition to) using DHCPv6 prefix delegation.</p>
<p id="rfc.section.4.p.2">The IPv6 prefixes used for manual configuration must be distinct from any prefixes used for SLAAC, however they may overlap with the prefixes used for DHCPv6 as long as there is administrative assurance that the same IPv6 addresses/prefixes will not be delegated by both DHCPv6 and manual configuration. The manual configuration scenarios and routing considerations are otherwise the same as discussed for DHCPv6 in Section 4.</p>
<p id="rfc.section.4.p.3">When manually configured IPv6 addresses/prefixes are used, the prefixes must be covered by a shorter IPv6 prefix advertised into the IPv6 routing system by one or more advertising ISATAP routers. The advertising routers must further maintain forwarding table entries that associate the addresses/prefixes with the ISATAP clients to which the addresses/prefixes are delegated, i.e., the same as for DHCPv6.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> IANA Considerations</h1>
<p id="rfc.section.5.p.1">This document has no IANA considerations.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">In addition to the security considerations documented in <a href="#RFC5214">[RFC5214]</a>, sites that use ISATAP should take care to ensure that no routing loops are enabled <a href="#I-D.ietf-v6ops-tunnel-loops">[I-D.ietf-v6ops-tunnel-loops]</a>. Additional security concerns with IP tunneling are documented in <a href="#RFC6169">[RFC6169]</a>.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#acknowledge" id="acknowledge">Acknowledgments</a>
</h1>
<p id="rfc.section.7.p.1">The following are acknowledged for their insights that helped shape this work: Dmitry Anipko, Fred Baker, Brian Carpenter, Remi Despres, Thomas Henderson, Philip Homburg, Lee Howard, Ray Hunter, Joel Jaeggli, John Mann, Gabi Nakibly, Christoper Palmer, Hemant Singh, Mark Smith, Dave Thaler, Ole Troan, Gunter Van de Velde, ...</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5214">[RFC5214]</b></td>
<td class="top">
<a>Templin, F.</a>, <a>Gleeson, T.</a> and <a>D. Thaler</a>, "<a href="http://tools.ietf.org/html/rfc5214">Intra-Site Automatic Tunnel Addressing Protocol (ISATAP)</a>", RFC 5214, March 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4861">[RFC4861]</b></td>
<td class="top">
<a>Narten, T.</a>, <a>Nordmark, E.</a>, <a>Simpson, W.</a> and <a>H. Soliman</a>, "<a href="http://tools.ietf.org/html/rfc4861">Neighbor Discovery for IP version 6 (IPv6)</a>", RFC 4861, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3315">[RFC3315]</b></td>
<td class="top">
<a>Droms, R.</a>, <a>Bound, J.</a>, <a>Volz, B.</a>, <a>Lemon, T.</a>, <a>Perkins, C.</a> and <a>M. Carney</a>, "<a href="http://tools.ietf.org/html/rfc3315">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>", RFC 3315, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3633">[RFC3633]</b></td>
<td class="top">
<a>Troan, O.</a> and <a>R. Droms</a>, "<a href="http://tools.ietf.org/html/rfc3633">IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6</a>", RFC 3633, December 2003.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC6139">[RFC6139]</b></td>
<td class="top">
<a>Russert, S.</a>, <a>Fleischman, E.</a> and <a>F. Templin</a>, "<a href="http://tools.ietf.org/html/rfc6139">Routing and Addressing in Networks with Global Enterprise Recursion (RANGER) Scenarios</a>", RFC 6139, February 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1687">[RFC1687]</b></td>
<td class="top">
<a href="mailto:ericf@atc.boeing.com" title="Boeing Computer Services">Fleischman, E.</a>, "<a href="http://tools.ietf.org/html/rfc1687">A Large Corporate User's View of IPng</a>", RFC 1687, August 1994.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6169">[RFC6169]</b></td>
<td class="top">
<a>Krishnan, S.</a>, <a>Thaler, D.</a> and <a>J. Hoagland</a>, "<a href="http://tools.ietf.org/html/rfc6169">Security Concerns with IP Tunneling</a>", RFC 6169, April 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3484">[RFC3484]</b></td>
<td class="top">
<a>Draves, R.</a>, "<a href="http://tools.ietf.org/html/rfc3484">Default Address Selection for Internet Protocol version 6 (IPv6)</a>", RFC 3484, February 2003.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-v6ops-tunnel-loops">[I-D.ietf-v6ops-tunnel-loops]</b></td>
<td class="top">
<a>Nakibly, G</a> and <a>F Templin</a>, "<a href="http://tools.ietf.org/html/draft-ietf-v6ops-tunnel-loops-07">Routing Loop Attack using IPv6 Automatic Tunnels: Problem Statement and Proposed Mitigations</a>", Internet-Draft draft-ietf-v6ops-tunnel-loops-07, May 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-6man-addr-select-opt">[I-D.ietf-6man-addr-select-opt]</b></td>
<td class="top">
<a>Matsumoto, A</a>, <a>Fujisaki, T</a>, <a>Kato, J</a> and <a>T Chown</a>, "<a href="http://tools.ietf.org/html/draft-ietf-6man-addr-select-opt-01">Distributing Address Selection Policy using DHCPv6</a>", Internet-Draft draft-ietf-6man-addr-select-opt-01, June 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.templin-aero">[I-D.templin-aero]</b></td>
<td class="top">
<a>Templin, F</a>, "<a href="http://tools.ietf.org/html/draft-templin-aero-04">Asymmetric Extended Route Optimization (AERO)</a>", Internet-Draft draft-templin-aero-04, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.templin-v6ops-isops">[I-D.templin-v6ops-isops]</b></td>
<td class="top">
<a>Templin, F</a>, "<a href="http://tools.ietf.org/html/draft-templin-v6ops-isops-14">Operational Guidance for IPv6 Deployment in IPv4 Sites using ISATAP</a>", Internet-Draft draft-templin-v6ops-isops-14, October 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Fred L. Templin</span> 
	  <span class="n hidden">
		<span class="family-name">Templin</span>
	  </span>
	</span>
	<span class="org vcardline">Boeing Research & Technology</span>
	<span class="adr">
	  <span>P.O. Box 3707 MC 7L-49</span>

	  <span class="vcardline">
		<span class="locality">Seattle</span>,  
		<span class="region">WA</span> 
		<span class="code">98124</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:fltemplin@acm.org">fltemplin@acm.org</a></span>

  </address>
</div>

</body>
</html>