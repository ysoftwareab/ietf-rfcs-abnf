<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>DNS Referral Response Size Issues </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction and Overview">
<link href="#rfc.section.2" rel="Chapter" title="2 Delegation Details">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Relevant Protocol Elements">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Advice to Zone Owners">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Advice to Server Implementors">
<link href="#rfc.section.3" rel="Chapter" title="3 Analysis">
<link href="#rfc.section.4" rel="Chapter" title="4 Conclusions">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgement">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A The response simulator program">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="With a mandated default minimum maximum UDP message size of 512 octets, the DNS protocol presents some special problems for zones wishing to expose a moderate or high number of authority servers (NS RRs).  This document explains the operational issues caused by, or related to this response size limit, and suggests ways to optimize the use of this limited space.  Guidance is offered to DNS server implementors and to DNS zone operators.  " />
  <meta name="description" content="With a mandated default minimum maximum UDP message size of 512 octets, the DNS protocol presents some special problems for zones wishing to expose a moderate or high number of authority servers (NS RRs).  This document explains the operational issues caused by, or related to this response size limit, and suggests ways to optimize the use of this limited space.  Guidance is offered to DNS server implementors and to DNS zone operators.  " />
  <meta name="keywords" content="DNS, delegation, packet size, AAAA record" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Internet Engineering Task Force</td>
<td class="right">P. Vixie</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Internet Systems Consortium</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">A. Kato</td>
</tr>
<tr>
<td class="left">Expires: March 17, 2012</td>
<td class="right">Keio University/WIDE Project</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">September 14, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">DNS Referral Response Size Issues <br />
  <span class="filename">draft-ietf-dnsop-respsize-13</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>With a mandated default minimum maximum UDP message size of 512 octets, the DNS protocol presents some special problems for zones wishing to expose a moderate or high number of authority servers (NS RRs).  This document explains the operational issues caused by, or related to this response size limit, and suggests ways to optimize the use of this limited space.  Guidance is offered to DNS server implementors and to DNS zone operators.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 17, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may contain material from IETF Documents or IETF Contributions published or made publicly available before November 10, 2008.  The person(s) controlling the copyright in some of this material may not have granted the IETF Trust the right to allow modifications of such material outside the IETF Standards Process. Without obtaining an adequate license from the person(s) controlling the copyright in such materials, this document may not be modified outside the IETF Standards Process, and derivative works of it may not be created outside the IETF Standards Process, except to format it for publication as an RFC or to translate it into languages other than English.</p>
<h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction and Overview</h1>
<p id="rfc.section.1.p.1">The original DNS standard limited UDP message size to 512 octets (see <a href="#RFC1035">[RFC1035]</a> 4.2.1).  Even though this limitation was due to the required minimum IP reassembly limit for IPv4, it became a hard DNS protocol limit and is not implicitly relaxed by changes in a network layer protocol, for example to IPv6.  </p>
<p id="rfc.section.1.p.2">The EDNS (Extension Mechanisms for DNS) protocol extension starting with version 0 permits larger responses by mutual agreement of the requester and responder (see <a href="#RFC2671">[RFC2671]</a> 2.3, 4.5), and it is recommended to support EDNS.  The 512 octets UDP message size limit will remain in practical effect until virtually all DNS servers and resolvers support EDNS.  </p>
<p id="rfc.section.1.p.3">Since DNS responses include a copy of the request, the space available for response data is somewhat less than the full 512 octets.  Negative responses are quite small, but for positive and referral responses, every octet must be carefully and sparingly allocated.  While the response size of positive responses is also a concern in <a href="#RFC3226">[RFC3226]</a>, this document specifically addresses referral response size.  </p>
<p id="rfc.section.1.p.4">While more than twelve years passed since the publication of EDNS0 document[RFC2671], approximately 65% of the clients support it as observed at a root name server and this fraction has not changed in recent few years.  The long tail of EDNS deployment may eventually be measured in decades.  </p>
<p id="rfc.section.1.p.5">Even if EDNS deployment reached 100% of all DNS initiators and responders there will still be cases when path MTU limitations or IP fragmentation/reassembly problems in firewalls and other middleboxes will cause EDNS failures which leads to non-extended DNS retries.  A smaller referral response will always be better than a larger one if the same end result can be achieved either way.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#delegation_details" id="delegation_details">Delegation Details</a>
</h1>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#aa" id="aa">Relevant Protocol Elements</a>
</h1>
<p id="rfc.section.2.1.p.1">A positive delegation response will include the following elements: <br><br> <a href="#RFC1034">[RFC1034]</a>) while DNAME maps an entire subtree to another domain (<a href="#RFC2672">[RFC2672]</a>).  </p>

<ul class="empty">
<li>Header Section: fixed length (12 octets)</li>
<li>Question Section: original query (name, class, type)</li>
<li>Answer Section: empty, or a CNAME/DNAME chain</li>
<li>Authority Section: NS RRset (nameserver names)</li>
<li>Additional Section: A and AAAA RRsets (nameserver addresses)</li>
</ul>

<p> Note: CNAME defines a canonical name (</p>
<p id="rfc.section.2.1.p.2">If the total size of the UDP response exceeds 512 octets or the size advertised in EDNS, and if the data that does not fit was "required", then the TC bit will be set (indicating truncation).  This will usually cause the requester to retry using TCP, depending on what information was desired and what information was omitted.  For example, truncation in the authority section is of no interest to a stub resolver who only plans to consume the answer section.  If a retry using TCP is needed, the total cost of the transaction is much higher.  See <a href="#RFC1123">[RFC1123]</a> 6.1.3.2 for details on the requirement that UDP be attempted before falling back to TCP.  </p>
<p id="rfc.section.2.1.p.3">RRsets (Resource Record Set, see <a href="#RFC2136">[RFC2136]</a>) are never sent partially unless the TC bit is set to indicate truncation.  When the TC bit is set, the final apparent RRset in the final non-empty section must be considered "possibly damaged" (see <a href="#RFC1035">[RFC1035]</a> 6.2, <a href="#RFC2181">[RFC2181]</a> 9).  </p>
<p id="rfc.section.2.1.p.4">With or without truncation, the glue present in the additional data section should be considered "possibly incomplete", and requesters should be prepared to re-query for any damaged or missing RRsets.  Note that truncation of the additional data section might not be signaled via the TC bit since additional data is often optional (see discussion in <a href="#RFC4472">[RFC4472]</a> B).  </p>
<p id="rfc.section.2.1.p.5">DNS label compression allows the component labels of a domain name to be instantiated exactly once per DNS message, and then referenced with a two-octet "pointer" from other locations in that same DNS message (see <a href="#RFC1035">[RFC1035]</a> 4.1.4).  If all nameserver names in a message share a common parent (for example, all of them are in "ROOT-SERVERS.NET." zone), then more space will be available for incompressible data (such as nameserver addresses).  </p>
<p id="rfc.section.2.1.p.6">The query name can be as long as 255 octets of network data.  In this worst case scenario, the question section will be 259 octets in size, which would leave only 240 octets for the authority and additional sections (after deducting 12 octets for the fixed length header) in a referral.  </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Advice to Zone Owners</h1>
<p id="rfc.section.2.2.p.1">Average and maximum question section sizes can be predicted by the zone owner, since they will know what names actually exist and can measure which ones are queried for most often.  Note that if the zone contains any wildcards, it is possible for maximum length queries to require positive responses, but that it is reasonable to expect truncation and TCP retry in that case.  For cost and performance reasons, the majority of requests should be satisfied without truncation or TCP retry.  </p>
<p id="rfc.section.2.2.p.2">Some queries to non-existing names can be large, but this is not a problem because negative responses need not contain any answer, authority or additional records.  See <a href="#RFC2308">[RFC2308]</a> 2.1 for more information about the format of negative responses.  </p>
<p id="rfc.section.2.2.p.3">The minimum useful number of name servers is two, for redundancy (see <a href="#RFC1034">[RFC1034]</a> 4.1).  A zone's name servers should be reachable by all IP protocols versions (e.g., IPv4 and IPv6) in common use.  As long as the servers are well managed, the server serving IPv6 might be different from the server serving IPv4 sharing the same server name.  </p>
<p id="rfc.section.2.2.p.4">The best case is no truncation at all.  This is because many requesters will retry using TCP immediately, or will automatically requery for RRsets that are possibly truncated, without considering whether the omitted data was actually necessary.  </p>
<p id="rfc.section.2.2.p.5">Anycasting <a href="#RFC3258">[RFC3258]</a> is a useful tool for performance and reliability without increasing the size of referral responses.  </p>
<p id="rfc.section.2.2.p.6">While it is irrelevant to the response size issue, all zones have to be served via IPv4 as well to avoid name space fragmentation <a href="#RFC3901">[RFC3901]</a>.  </p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> Advice to Server Implementors</h1>
<p id="rfc.section.2.3.p.1">Each NS RR for a zone will add 12 fixed octets (name, type, class, ttl, and rdlen) plus 2 to 255 variable octets (for the NSDNAME).  Each A RR will require 16 octets, and each AAAA RR will require 28 octets.  </p>
<p id="rfc.section.2.3.p.2">While DNS distinguishes between necessary and optional resource records, this distinction is according to protocol elements necessary to signify facts, and takes no official notice of protocol content necessary to ensure correct operation.  For example, a nameserver name that is in or below the zone cut being described by a delegation is "necessary content", since there is no way to reach that zone unless the parent zone's delegation includes "glue records" describing that name server's addresses.  </p>
<p id="rfc.section.2.3.p.3">Recall that the TC bit is only set when a required RRset can not be included in its entirety (see <a href="#RFC2181">[RFC2181]</a> 9).  Even when some of the RRsets to be included in the additional section don't fit in the response size, the TC bit isn't set.  These RRsets may be important for a referral.  Some DNS implementations try to resolve these missing glue records separately which will introduce extra queries and extra time to resolve a given name.  </p>
<p id="rfc.section.2.3.p.4">A delegation response should prioritize glue records as follows.  <br><br> first: <br><br> Whenever there are multiple candidates for a position in this priority scheme, one should be chosen on a round-robin or fully random basis.  The goal of this priority scheme is to offer "necessary" glue first to fill into the response if possible.  </p>

<ul class="empty"><li>All glue RRsets for one name server whose name is in or below the zone being delegated, or which has multiple address RRsets (currently A and AAAA), or preferably both; </li></ul>

<p> second: </p>

<ul class="empty"><li>Alternate between adding all glue RRsets for any name servers whose names are in or below the zone being delegated, and all glue RRsets for any name servers who have multiple address RRsets (currently A and AAAA); </li></ul>

<p> thence: </p>

<ul class="empty"><li>All other glue RRsets, in any order.  </li></ul>

<p> </p>
<p id="rfc.section.2.3.p.5">If any "necessary" content cannot be fit in the response, then it is advisable that the TC bit be set in order to force a TCP retry, rather than have the zone be unreachable.  Note that a parent server's proper response to a query for in-child glue or below-child glue is a referral rather than an answer, and that this referral must be able to contain the in-child or below-child glue, and that in outlying cases, only EDNS or TCP will be large enough to contain that data.  </p>
<p id="rfc.section.2.3.p.6">The glue record order should be independent to the version of IP used in the query because the DNS server just see a query from an intermediate server rather than the query from the original client.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Analysis</h1>
<p id="rfc.section.3.p.1">An instrumented protocol trace of a best case delegation response is shown in <a href="#sample_response">Figure 1</a>.  Note that 13 servers are named, and 13 addresses are given.  This query was artificially designed to exactly reach the 512 octets limit.  </p>
<div id="#rfc.figure.1"></div>
<div id="#sample_response"></div>
<p></p>
<pre>
   ;; flags: qr rd; QUERY: 1, ANS: 0, AUTH: 13, ADDIT: 13
   ;; QUERY SECTION:
   ;;  [23456789.123456789.123456789.\
        123456789.123456789.123456789.com A IN]        ;; @80

   ;; AUTHORITY SECTION:
   com.                 172800 NS  E.GTLD-SERVERS.NET.  ;; @112
   com.                 172800 NS  F.GTLD-SERVERS.NET.  ;; @128
   com.                 172800 NS  G.GTLD-SERVERS.NET.  ;; @144
   com.                 172800 NS  H.GTLD-SERVERS.NET.  ;; @160
   com.                 172800 NS  I.GTLD-SERVERS.NET.  ;; @176
   com.                 172800 NS  J.GTLD-SERVERS.NET.  ;; @192
   com.                 172800 NS  K.GTLD-SERVERS.NET.  ;; @208
   com.                 172800 NS  L.GTLD-SERVERS.NET.  ;; @224
   com.                 172800 NS  M.GTLD-SERVERS.NET.  ;; @240
   com.                 172800 NS  A.GTLD-SERVERS.NET.  ;; @256
   com.                 172800 NS  B.GTLD-SERVERS.NET.  ;; @272
   com.                 172800 NS  C.GTLD-SERVERS.NET.  ;; @288
   com.                 172800 NS  D.GTLD-SERVERS.NET.  ;; @304


   ;; ADDITIONAL SECTION:
   A.GTLD-SERVERS.NET.  172800 A   192.5.6.30           ;; @320
   B.GTLD-SERVERS.NET.  172800 A   192.33.14.30         ;; @336
   C.GTLD-SERVERS.NET.  172800 A   192.26.92.30         ;; @352
   D.GTLD-SERVERS.NET.  172800 A   192.31.80.30         ;; @368
   E.GTLD-SERVERS.NET.  172800 A   192.12.94.30         ;; @384
   F.GTLD-SERVERS.NET.  172800 A   192.35.51.30         ;; @400
   G.GTLD-SERVERS.NET.  172800 A   192.42.93.30         ;; @416
   H.GTLD-SERVERS.NET.  172800 A   192.54.112.30        ;; @432
   I.GTLD-SERVERS.NET.  172800 A   192.43.172.30        ;; @448
   J.GTLD-SERVERS.NET.  172800 A   192.48.79.30         ;; @464
   K.GTLD-SERVERS.NET.  172800 A   192.52.178.30        ;; @480
   L.GTLD-SERVERS.NET.  172800 A   192.41.162.30        ;; @496
   M.GTLD-SERVERS.NET.  172800 A   192.55.83.30         ;; @512

   ;; MSG SIZE  sent: 80  rcvd: 512

      </pre>
<p></p>
<p id="rfc.section.3.p.2">For longer query names, the number of address records supplied will be lower.  Furthermore, it is only by using a common parent name (which is "GTLD-SERVERS.NET." in this example) that all 13 addresses are able to fit, due to the use of DNS compression pointers in the last 12 occurrences of the parent domain name.  The outputs from the response simulator in <a href="#code">Appendix Appendix A</a> (written in perl <a href="#PERL">[PERL]</a>) shown in <a href="#resp_analysis1">Figure 2</a> and <a href="#resp_analysis2">Figure 3</a> demonstrate these properties.  </p>
<div id="#rfc.figure.2"></div>
<div id="#resp_analysis1"></div>
<p></p>
<pre>
   % perl respsize.pl a.dns.br b.dns.br c.dns.br d.dns.br
   a.dns.br requires 10 bytes
   b.dns.br requires 4 bytes
   c.dns.br requires 4 bytes
   d.dns.br requires 4 bytes
   # of NS: 4
   For maximum size query (255 byte):
       only A is considered:        # of A is 4 (green)
       A and AAAA are considered:   # of A+AAAA is 3 (yellow)
       preferred-glue A is assumed: # of A is 4, # of AAAA is 3 (yellow)
   For average size query (64 byte):
       only A is considered:        # of A is 4 (green)
       A and AAAA are considered:   # of A+AAAA is 4 (green)
       preferred-glue A is assumed: # of A is 4, # of AAAA is 4 (green)

       </pre>
<p></p>
<div id="#rfc.figure.3"></div>
<div id="#resp_analysis2"></div>
<p></p>
<pre>
   % perl respsize.pl ns-ext.isc.org ns.psg.com ns.ripe.net ns.eu.int
   ns-ext.isc.org requires 16 bytes
   ns.psg.com requires 12 bytes
   ns.ripe.net requires 13 bytes
   ns.eu.int requires 11 bytes
   # of NS: 4
   For maximum size query (255 byte):
       only A is considered:        # of A is 4 (green)
       A and AAAA are considered:   # of A+AAAA is 3 (yellow)
       preferred-glue A is assumed: # of A is 4, # of AAAA is 2 (yellow)
   For average size query (64 byte):
       only A is considered:        # of A is 4 (green)
       A and AAAA are considered:   # of A+AAAA is 4 (green)
       preferred-glue A is assumed: # of A is 4, # of AAAA is 4 (green)
       </pre>
<p></p>
<p id="rfc.section.3.p.3">Here we use the term "green" if all address records could fit, or "yellow" if two or more could fit, or "orange" if only one could fit, or "red" if no address record could fit.  It's clear that without a common parent for nameserver names, much space would be lost.  For these examples we use an average/common name size of 15 octets, befitting our assumption of "GTLD-SERVERS.NET." as our common parent name.  </p>
<p id="rfc.section.3.p.4">We're assuming a medium query name size of 64 since that is the typical size seen in trace data at the time of this writing.  If Internationalized Domain Name (IDN) or any other technology which results in larger query names be deployed significantly in advance of EDNS, then new measurements and new estimates will have to be made.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Conclusions</h1>
<p id="rfc.section.4.p.1">The current practice of giving all nameserver names a common parent (such as "GTLD-SERVERS.NET." or "ROOT-SERVERS.NET.") saves space in DNS responses and allows for more nameservers to be enumerated than would otherwise be possible, since the common parent domain name only appears once in a DNS message and is referred to via "compression pointers" thereafter.  </p>
<p id="rfc.section.4.p.2">If all nameserver names for a zone share a common parent, then it is operationally advisable to make all servers for the zone thus served also be authoritative for the zone of that common parent.  For example, the root name servers (?.ROOT-SERVERS.NET.) can answer authoritatively for the ROOT-SERVERS.NET. zone.  This is to ensure that the zone's servers always have the zone's nameservers' glue available when delegating, and will be able to respond with answers rather than referrals if a requester who wants that glue comes back asking for it.  In this case the name server will likely be a "stealth server" -- authoritative but unadvertised in the glue zone's NS RRset.  See <a href="#RFC1996">[RFC1996]</a> 2 for more information about stealth servers.  </p>
<p id="rfc.section.4.p.3">Thirteen (13) is the effective maximum number of nameserver names usable with traditional (non-extended) DNS, assuming a common parent domain name, and given that implicit referral response truncation is undesirable in the average case.  </p>
<p id="rfc.section.4.p.4">More than one address record in a protocol family per server is inadvisable since the necessary glue RRsets (A or AAAA) are atomically indivisible, and will be larger than a single resource record.  Larger RRsets are more likely to lead to or encounter truncation.  </p>
<p id="rfc.section.4.p.5">More than one address record across protocol families is less likely to lead to or encounter truncation, partly because multiprotocol clients, which are required to handle larger RRsets such as AAAA RRs, are more likely to speak EDNS which can use a larger UDP response size limit, and partly because the resource records (A and AAAA) are in different RRsets and are therefore divisible from each other.  </p>
<p id="rfc.section.4.p.6">Name server names which are at or below the zone they serve are more sensitive to referral response truncation, and glue records for them should be considered "more important" than other glue records, in the assembly of referral responses.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Security Considerations</h1>
<p id="rfc.section.5.p.1">The recommendations contained in this document have no known security implications.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> IANA Considerations</h1>
<p id="rfc.section.6.p.1">This document does not call for changes or additions to any IANA registry.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Acknowledgement</h1>
<p id="rfc.section.7.p.1">The authors thank Peter Koch, Rob Austein, Joe Abley, Mark Andrews, Kenji Rikitake, Stephane Bortzmeyer, Olafur Gudmundsson, Alfred Hoenes, and Alexander Mayrhofer for their valuable comments and suggestions.  </p>
<p id="rfc.section.7.p.2">This work was supported by the US National Science Foundation (research grant SCI-0427144) and DNS-OARC.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1034">[RFC1034]</b></td>
<td class="top">
<a title="Information Sciences Institute (ISI)">Mockapetris, P.</a>, "<a href="http://tools.ietf.org/html/rfc1034">Domain names - concepts and facilities</a>", STD 13, RFC 1034, November 1987.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1035">[RFC1035]</b></td>
<td class="top">
<a title="USC/ISI">Mockapetris, P.</a>, "<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>", STD 13, RFC 1035, November 1987.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2181">[RFC2181]</b></td>
<td class="top">
<a href="mailto:kre@munnari.OZ.AU" title="Computer Science">Elz, R.</a> and <a href="mailto:randy@psg.com" title="RGnet, Inc.">R. Bush</a>, "<a href="http://tools.ietf.org/html/rfc2181">Clarifications to the DNS Specification</a>", RFC 2181, July 1997.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1123">[RFC1123]</b></td>
<td class="top">
<a href="mailto:Braden@ISI.EDU" title="University of Southern California (USC), Information Sciences Institute">Braden, R.</a>, "<a href="http://tools.ietf.org/html/rfc1123">Requirements for Internet Hosts - Application and Support</a>", STD 3, RFC 1123, October 1989.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1996">[RFC1996]</b></td>
<td class="top">
<a href="mailto:paul@vix.com" title="Internet Software Consortium">Vixie, P.</a>, "<a href="http://tools.ietf.org/html/rfc1996">A Mechanism for Prompt Notification of Zone Changes (DNS NOTIFY)</a>", RFC 1996, August 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2136">[RFC2136]</b></td>
<td class="top">
<a href="mailto:paul@vix.com" title="Internet Software Consortium">Vixie, P.</a>, <a href="mailto:set@thumper.bellcore.com" title="Bellcore">Thomson, S.</a>, <a href="mailto:yakov@cisco.com" title="Cisco Systems">Rekhter, Y.</a> and <a href="mailto:bound@zk3.dec.com" title="Digital Equipment Corp.">J. Bound</a>, "<a href="http://tools.ietf.org/html/rfc2136">Dynamic Updates in the Domain Name System (DNS UPDATE)</a>", RFC 2136, April 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2308">[RFC2308]</b></td>
<td class="top">
<a href="mailto:Mark.Andrews@cmis.csiro.au" title="CSIRO - Mathematical and Information Sciences">Andrews, M.</a>, "<a href="http://tools.ietf.org/html/rfc2308">Negative Caching of DNS Queries (DNS NCACHE)</a>", RFC 2308, March 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2671">[RFC2671]</b></td>
<td class="top">
<a href="mailto:vixie@isc.org" title="Internet Software Consortium">Vixie, P.</a>, "<a href="http://tools.ietf.org/html/rfc2671">Extension Mechanisms for DNS (EDNS0)</a>", RFC 2671, August 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2672">[RFC2672]</b></td>
<td class="top">
<a href="mailto:crawdad@fnal.gov" title="Fermilab MS 368">Crawford, M.</a>, "<a href="http://tools.ietf.org/html/rfc2672">Non-Terminal DNS Name Redirection</a>", RFC 2672, August 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3226">[RFC3226]</b></td>
<td class="top">
<a>Gudmundsson, O.</a>, "<a href="http://tools.ietf.org/html/rfc3226">DNSSEC and IPv6 A6 aware server/resolver message size requirements</a>", RFC 3226, December 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3258">[RFC3258]</b></td>
<td class="top">
<a>Hardie, T.</a>, "<a href="http://tools.ietf.org/html/rfc3258">Distributing Authoritative Name Servers via Shared Unicast Addresses</a>", RFC 3258, April 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3901">[RFC3901]</b></td>
<td class="top">
<a>Durand, A.</a> and <a>J. Ihren</a>, "<a href="http://tools.ietf.org/html/rfc3901">DNS IPv6 Transport Operational Guidelines</a>", BCP 91, RFC 3901, September 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4472">[RFC4472]</b></td>
<td class="top">
<a>Durand, A.</a>, <a>Ihren, J.</a> and <a>P. Savola</a>, "<a href="http://tools.ietf.org/html/rfc4472">Operational Considerations and Issues with IPv6 DNS</a>", RFC 4472, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="PERL">[PERL]</b></td>
<td class="top">
<a>Wall, L</a>, <a>Christiansen, T</a> and <a>J Orwant</a>, "<a>Programming Perl, 3rd ed.</a>", ISBN 0-596-00027-8, July 2000.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#code" id="code">The response simulator program</a>
</h1>
<div id="#rfc.figure.4"></div>
<p></p>
<pre>
#!/usr/bin/perl
#
# SYNOPSIS
#    respsize.pl [ -z zone ] fqdn_ns1 fqdn_ns2 ...
#        if all queries are assumed to have a same zone suffix,
#     such as "jp" in JP TLD servers, specify it in -z option
#
use strict;
use Getopt::Std;

my ($sz_msg) = (512);
my ($sz_header, $sz_ptr, $sz_rr_a, $sz_rr_aaaa) = (12, 2, 16, 28);
my ($sz_type, $sz_class, $sz_ttl, $sz_rdlen) = (2, 2, 4, 2);
my (%namedb, $name, $nssect, %opts, $optz);
my $n_ns = 0;

getopt('z', %opts);
if (defined($opts{'z'})) {
    server_name_len($opts{'z'}); # just register it
}

foreach $name (@ARGV) {
    my $len;
    $n_ns++;
    $len = server_name_len($name);
    print "$name requires $len bytes\n";
    $nssect += $sz_ptr + $sz_type + $sz_class + $sz_ttl
            +  $sz_rdlen + $len;
}
print "# of NS: $n_ns\n";
arsect(255, $nssect, $n_ns, "maximum");
arsect(64, $nssect, $n_ns, "average");

sub server_name_len {
    my ($name) = @_;
    my (@labels, $len, $n, $suffix);

    $name =~ tr/A-Z/a-z/;
    @labels = split(/\./, $name);
    $len = length(join('.', @labels)) + 2;
    for ($n = 0; $#labels &gt;= 0; $n++, shift @labels) {
        $suffix = join('.', @labels);
        return length($name) - length($suffix) + $sz_ptr
            if (defined($namedb{$suffix}));
        $namedb{$suffix} = 1;
    }
    return $len;
}

sub arsect {
    my ($sz_query, $nssect, $n_ns, $cond) = @_;
    my ($space, $n_a, $n_a_aaaa, $n_p_aaaa, $ansect);
    $ansect = $sz_query + $sz_type + $sz_class;
    $space = $sz_msg - $sz_header - $ansect - $nssect;
    $n_a = atmost(int($space / $sz_rr_a), $n_ns);
    $n_a_aaaa = atmost(int($space
                           / ($sz_rr_a + $sz_rr_aaaa)), $n_ns);
    $n_p_aaaa = atmost(int(($space - $sz_rr_a * $n_ns)
                           / $sz_rr_aaaa), $n_ns);
    printf "For %s size query (%d byte):\n", $cond, $sz_query;
    printf "    only A is considered:        ";
    printf "# of A is %d (%s)\n", $n_a, &amp;judge($n_a, $n_ns);
    printf "    A and AAAA are considered:   ";
    printf "# of A+AAAA is %d (%s)\n",
           $n_a_aaaa, &amp;judge($n_a_aaaa, $n_ns);
    printf "    preferred-glue A is assumed: ";
    printf "# of A is %d, # of AAAA is %d (%s)\n",
        $n_a, $n_p_aaaa, &amp;judge($n_p_aaaa, $n_ns);
}

sub judge {
    my ($n, $n_ns) = @_;
    return "green" if ($n &gt;= $n_ns);
    return "yellow" if ($n &gt;= 2);
    return "orange" if ($n == 1);
    return "red";
}

sub atmost {
    my ($a, $b) = @_;
    return 0 if ($a &lt; 0);
    return $b if ($a &gt; $b);
    return $a;
}
            </pre>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Paul Vixie</span> 
	  <span class="n hidden">
		<span class="family-name">Vixie</span>
	  </span>
	</span>
	<span class="org vcardline">Internet Systems Consortium</span>
	<span class="adr">
	  <span>950 Charter Street</span>

	  <span class="vcardline">
		<span class="locality">Redwood City</span>,  
		<span class="region">CA</span> 
		<span class="code">94063</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: +1 650 423 1300</span>

<span class="vcardline">EMail: <a href="mailto:vixie@isc.org">vixie@isc.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Akira Kato</span> 
	  <span class="n hidden">
		<span class="family-name">Kato</span>
	  </span>
	</span>
	<span class="org vcardline">Keio University/WIDE Project</span>
	<span class="adr">
	  <span>Graduate School of Media Design, 4-1-1 Hiyoshi</span>

	  <span class="vcardline">
		<span class="locality">Kohoku</span>,  
		<span class="region">Yokohama</span> 
		<span class="code">223-8526</span>
	  </span>
	  <span class="country-name vcardline">JP</span>
	</span>
	<span class="vcardline">Phone: +81 45 564 2490</span>

<span class="vcardline">EMail: <a href="mailto:kato@wide.ad.jp">kato@wide.ad.jp</a></span>

  </address>
</div>
  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction and Overview</a>
</li>
<li>2.   <a href="#rfc.section.2">Delegation Details</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Relevant Protocol Elements</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Advice to Zone Owners</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Advice to Server Implementors</a>
</li>
<li>3.   <a href="#rfc.section.3">Analysis</a>
</li>
<li>4.   <a href="#rfc.section.4">Conclusions</a>
</li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Acknowledgement</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">The response simulator program</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  

</body>
</html>