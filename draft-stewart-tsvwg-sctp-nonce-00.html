<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>ECN Nonces for Stream Control Transmission Protocol (SCTP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="ECN Nonces for Stream Control Transmission Protocol (SCTP)">
<meta name="keywords" content="Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">R. Stewart</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Researcher</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">S. Ladha</td></tr>
<tr><td class="header">Expires: August 20, 2009</td><td class="header">Qualcomm</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">N. Spring</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">University Of Maryland</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">February 16, 2009</td></tr>
</table></td></tr></table>
<h1><br />ECN Nonces for Stream Control Transmission Protocol (SCTP)<br />draft-stewart-tsvwg-sctp-nonce-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 20, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document describes the addition of the ECN-nonce
RFC 3540 <a class='info' href='#RFC3540'>[RFC3540]<span> (</span><span class='info'>Spring, N., Wetherall, D., and D. Ely, &ldquo;Robust Explicit Congestion Notification (ECN) Signaling with Nonces,&rdquo; June&nbsp;2003.</span><span>)</span></a> to the Stream Control Transmission Protocol
(SCTP) RFC 2960 <a class='info' href='#RFC2960'>[RFC2960]<span> (</span><span class='info'>Stewart, R., Xie, Q., Morneault, K., Sharp, C., Schwarzbauer, H., Taylor, T., Rytina, I., Kalla, M., Zhang, L., and V. Paxson, &ldquo;Stream Control Transmission Protocol,&rdquo; October&nbsp;2000.</span><span>)</span></a>.  The ECN-nonce reduces the vulnerability
of ECN senders to misbehaving receivers that conceal
congestion signals like ECN marks and packet losses.  The
 ECN-nonce approach is different in SCTP because SCTP uses
chunks for extensible protocol features and is
 selective acknowlegement (SACK)-based; this document
describes those differences. In particular this document describes (1) protocol extensions
in the form of a single new parameter for the INIT/INIT-ACK chunks, and a single bit flag in the SACK
 chunk, and (2) rules governing the sender and receiver side implementation.
</p>
<p>This document outlines a minimum response that an SCTP sender should apply after detecting a misbehaving receiver.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#1.">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">1.1.</a>&nbsp;
Overview of Protocol Extensions<br />
<a href="#Terminology">2.</a>&nbsp;
Terminology<br />
<a href="#anchor2">3.</a>&nbsp;
Protocol Extension to SCTP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.1.</a>&nbsp;
Nonce-Supported Parameter Definition<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.2.</a>&nbsp;
Nonce Sum (NS) flag Definition<br />
<a href="#anchor5">4.</a>&nbsp;
Nonce-Supported Parameter Negotiation<br />
<a href="#anchor6">5.</a>&nbsp;
ECN-nonce Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">5.1.</a>&nbsp;
State Information<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">5.2.</a>&nbsp;
Sender Behavior (Transmit)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">5.3.</a>&nbsp;
Router Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.4.</a>&nbsp;
Receiver Behavior (Receive and Transmit)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.5.</a>&nbsp;
Sender Side (Receive)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.6.</a>&nbsp;
Re-synchronization of the Nonce Sum<br />
<a href="#anchor13">6.</a>&nbsp;
Sender's Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">6.1.</a>&nbsp;
Response to a peer that does not support the ECN-nonce<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">6.2.</a>&nbsp;
Response to a misbehaving receiver<br />
<a href="#anchor16">7.</a>&nbsp;
Summary<br />
<a href="#anchor17">8.</a>&nbsp;
Security Considerations<br />
<a href="#anchor18">9.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor19">10.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">11.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">11.1.</a>&nbsp;
Normative references<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">11.2.</a>&nbsp;
Informational References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="1."></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Like TCP, SCTP RFC 2960 <a class='info' href='#RFC2960'>[RFC2960]<span> (</span><span class='info'>Stewart, R., Xie, Q., Morneault, K., Sharp, C., Schwarzbauer, H., Taylor, T., Rytina, I., Kalla, M., Zhang, L., and V. Paxson, &ldquo;Stream Control Transmission Protocol,&rdquo; October&nbsp;2000.</span><span>)</span></a> supports Explicit Congestion 
Notification (ECN) RFC 3168 <a class='info' href='#RFC3168'>[RFC3168]<span> (</span><span class='info'>Ramakrishnan, K., Floyd, S., and D. Black, &ldquo;The Addition of Explicit Congestion Notification (ECN) to IP,&rdquo; September&nbsp;2001.</span><span>)</span></a>, and therefore is exposed to misbehaving receivers 
that conceal congestion signals. The misbehavior includes the concealment of ECN Echo (ECNE) signals
which may cause an SCTP sender to be agressive and unfair to compliant flows. The ECN-nonce 
RFC 3540 <a class='info' href='#RFC3540'>[RFC3540]<span> (</span><span class='info'>Spring, N., Wetherall, D., and D. Ely, &ldquo;Robust Explicit Congestion Notification (ECN) Signaling with Nonces,&rdquo; June&nbsp;2003.</span><span>)</span></a> adds robustness to ECN signaling for TCP. This document 
analogously applies the ECN-nonce to SCTP. The ECN-nonce can be used to protect against other misbehaviors as well,
such as optimistic acknowledgements <a class='info' href='#paper.savage99'>[paper.savage99]<span> (</span><span class='info'>Savage, S., Cardwell, N., Wetherall, D., and T. Anderson, &ldquo;TCP congestion control with a misbehaving receiver,&rdquo; October&nbsp;1999.</span><span>)</span></a>, and false Duplicate
TSN notifications for more information discussions in RFC 3708 <a class='info' href='#RFC3708'>[RFC3708]<span> (</span><span class='info'>Blanton, E. and M. Allman, &ldquo;Using TCP Duplicate Selective Acknowledgement (DSACKs) and Stream Control Transmission Protocol (SCTP) Duplicate Transmission Sequence Numbers (TSNs) to Detect Spurious Retransmissions,&rdquo; February&nbsp;2004.</span><span>)</span></a> may
be helpful.
</p>
<p> The reader should be familiar with the ECN-Nonce as described in 
RFC 3540 <a class='info' href='#RFC3540'>[RFC3540]<span> (</span><span class='info'>Spring, N., Wetherall, D., and D. Ely, &ldquo;Robust Explicit Congestion Notification (ECN) Signaling with Nonces,&rdquo; June&nbsp;2003.</span><span>)</span></a>. This document describes only the SCTP-specific 
aspects of the ECN-nonce.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Overview of Protocol Extensions</h3>

<p>This document specifies the following:
</p>
<p>1. A single new Nonce-Supported parameter in the INIT/INIT-ACK chunks exchanged during the association 
establishment to indicate to the peer whether ECN-nonce is supported.
</p>
<p>2. A single bit flag in the SACK chunk called the Nonce Sum (NS), and the rules
 governing the sending, calculating and checking of the nonce sum.
</p>
<p>The ECN-nonce does not change the existing ECN protocol. The ECN-nonce uses
two bits of the IP header called the ECN Capable Transport (ECT) bits. The sender randomly generates
a single bit nonce and encodes it in the ECT codepoints, ECT(0) or ECT(1). To indicate congestion
in the network, routers may overwrite the ECT codepoints with a Congestion Experienced (CE) marking. 
The nonce  sum is a cumulative one bit addition of the nonces received so far. The receiver calculates 
the nonce sum and returns it in the NS flag of the SACK chunk. The sender verifies the value of the NS 
flag in the SACK chunk. Since all the nonces are needed to calculate the correct nonce sum, an 
incorrect nonce sum implies that one or more nonces are missing at the receiver. If an incorrect nonce 
sum is received by the sender without ECNE signals, the sender can infer that the receiver is misbehaving and concealing 
congestion notifications.
</p>
<p>It is beyond the scope of this document to specify a sender's complete response after detecting a
 misbehaving receiver. However this document outlines the minimum response that a sender SHOULD apply to
 a receiver's misbehavior.
</p>
<a name="Terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The keywords MUST, MUST NOT, REQUIRED, SHALL, SHALL NOT, SHOULD, SHOULD NOT, 
RECOMMENDED, NOT RECOMMENDED, MAY, and OPTIONAL, when they appear in this document, are to
be interpreted as described in RFC 2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Protocol Extension to SCTP</h3>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Nonce-Supported Parameter Definition</h3>

<p>Endpoints supporting ECN-nonce SHOULD use the following OPTIONAL parameter to 
indicate that the ECN-nonce extension is supported.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     Fixed Parameter                    Status     Type Value
   -------------------------------------------------------------
     Nonce-Supported                    OPTIONAL     0x8001

    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Parameter Type = 0x8001    |  Parameter Length = 4         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div>
<p>Type: 16 bit u_int
</p>
<p>0x8001, Indicating the Nonce-Supported parameter.
</p>
<p>Length: 16 bit u_int
</p>
<p>4, Indicating the size of the parameter.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Nonce Sum (NS) flag Definition</h3>

<p>A single bit flag (NS) in the SACK chunk is defined as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Type = 3    | Chunk Flags |N|      Chunk Length             |
      |               |             |S|                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                      Cumulative TSN Ack                       |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |          Advertised Receiver Window Credit (a_rwnd)           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Number of Gap Ack Blocks = N  |  Number of Duplicate TSNs = X |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |  Gap Ack Block #1 Start       |   Gap Ack Block #1 End        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      /                                                               /
      \                              ...                              \
      /                                                               /
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |   Gap Ack Block #N Start      |  Gap Ack Block #N End         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                       Duplicate TSN 1                         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      /                                                               /
      \                              ...                              \
      /                                                               /
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                       Duplicate TSN X                         |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div>
<p>        Chunk Flags: 
</p>
<p>        Reserved:  7 bits 
</p>
<p>        Set to 0 on transmit and ignored on receipt.
</p>
<p>        NS:  1 bit 
</p>
<p>        The Nonce Sum (NS) flag is set by the sender of the SACK chunk with the apropriate 
calculated value (1 bit cumulative nonce sum). If either peer does not support the ECN-nonce, 
then the NS flag is always set to 0.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Nonce-Supported Parameter Negotiation</h3>

<p>An SCTP endpoint supporting the ECN-nonce SHOULD include the Nonce-Supported 
Parameter in the INIT chunk when initializing the association to indicate this to the peer.
</p>
<p>When a receiver supports the ECN-nonce and detects a Nonce-Supported parameter in the INIT chunk, the receiver SHOULD respond with a Nonce-supported parameter in the INIT-ACK chunk.
</p>
<p>When an SCTP endpoint that supports the ECN-nonce receives an INIT chunk without 
the Nonce-Supported parameter, that SCTP endpoint:
</p>
<p>
               </p>
<ul class="text">
<li>MAY include the Nonce-Supported parameter in the INIT-ACK chunk.
</li>
<li>SHOULD NOT set the NS flag in the SACK chunk during the lifetime of the 
association.
</li>
</ul><p>
            
</p>
<p>An SCTP endpoint that supports the ECN-nonce SHOULD disable ECN (i.e., stop 
setting the ECT codepoints for the association) if its peer does not support the ECN-nonce. 
An SCTP endpoint that does not support the ECN-nonce may be denied preferential treatment or 
otherwise penalized by a peer that supports the ECN-nonce based on that peer's policy.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
ECN-nonce Operation</h3>

<p>The following sub-sections describe in detail the ECN-nonce operation.
 This operation includes (i) the local SCTP state to be maintained at each endpoint, (ii) the sender procedures 
for transmitting nonces and checking of the nonce sum, (iii) intermediate router(s) behavior, and (iv) the 
receiver procedures for calculating the nonce sum from the received nonces, and returning the 
nonce sum to the sender.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
State Information</h3>

<p> SCTP endpoints should maintain a single bit local state called "current nonce sum".
 The current nonce sum is a one bit cumulative addition of the nonces. In the beginning of a new 
SCTP association the current nonce sum SHOULD be initialised to one.
</p>
<p> SCTP senders should store a mapping from Transmission Sequence Numbers (TSNs) to 
nonce values associated with packets.
</p>
<p> The following sections describe in detail how these values are maintained and updated.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Sender Behavior (Transmit)</h3>

<p>The sender's transmit behavior follows Section 3 of
RFC 3540 <a class='info' href='#RFC3540'>[RFC3540]<span> (</span><span class='info'>Spring, N., Wetherall, D., and D. Ely, &ldquo;Robust Explicit Congestion Notification (ECN) Signaling with Nonces,&rdquo; June&nbsp;2003.</span><span>)</span></a> with the following changes to nonce handling.
</p>
<p>
The one-bit nonce is placed or encoded only for SCTP packets which
carry one or more "new" DATA chunks.  Only SCTP packets containing
one or more "new" DATA chunks can be marked as ECN-capable (with
either ECT(0) or ECT(1) codepoints set), so only these packets can
use the one-bit nonce.  This is because control chunks are not
subject to congestion control, and thus a router's ECN-marking 
of control chunks would not illicit a congestion response.

</p>
<p>The sender maintains a mapping of the TSNs of transmitted DATA chunks with
 the nonce values placed in the respective packets. When multiple DATA chunks are bundled 
in the same packet, only one of the TSNs transmitted in that packet is mapped to the nonce 
placed in the packet. All other TSNs transmitted in the same packet are mapped to a 
nonce value of zero.
</p>
<p>(Implementation Note: An implementation may maintain the mapping of only 
the single TSN sent in each packet with the corresponding nonce. Said implementation 
will assume that all TSNs lying between two consecutive TSNs in the data structure are mapped 
to a nonce value of zero.)
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Router Behavior</h3>

<p>For the ECN-nonce to function correctly, routers should behave as 
specified in RFC 3168 <a class='info' href='#RFC3168'>[RFC3168]<span> (</span><span class='info'>Ramakrishnan, K., Floyd, S., and D. Black, &ldquo;The Addition of Explicit Congestion Notification (ECN) to IP,&rdquo; September&nbsp;2001.</span><span>)</span></a>.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Receiver Behavior (Receive and Transmit)</h3>

<p>The receiver updates the value of its current nonce sum on receiving
a packet carrying one or more new DATA chunks. Recall that the nonce sum is the cumulative 
one bit addition of the nonces received so far. Thus on receipt of a packet with one or 
more new DATA chunks a single bit addition of the current nonce sum and the received 
nonce is performed. The result is the new value of current nonce sum.
</p>
<p>In contrast to RFC 3540 <a class='info' href='#RFC3540'>[RFC3540]<span> (</span><span class='info'>Spring, N., Wetherall, D., and D. Ely, &ldquo;Robust Explicit Congestion Notification (ECN) Signaling with Nonces,&rdquo; June&nbsp;2003.</span><span>)</span></a>, the current 
nonce sum is also updated immediately when receiving out of order packets. SCTP is 
inherently a SACK based protocol, hence an SCTP sender can know exactly which packets
had reached the receiver out of order.
</p>
<p> When a packet is marked with a Congestion Experienced (CE) signal, 
the original nonce is unknown to the receiver. The missing nonce value is ignored 
(or equivalently a value of zero is assumed) when calculating the current nonce sum.
</p>
<p>When the receiver sends a SACK chunk, the current nonce sum (the updated 
value as described above) is placed in the NS flag (defined in Section 3.2) of the SACK chunk.
</p>
<p>(Implementation Note: When sending an ECNE chunk and a SACK chunk in response
to a CE marked packet that contained one or more DATA chunks, an SCTP endpoint should try to
 bundle the ECNE chunk and the SACK chunk in the same packet.)
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
Sender Side (Receive)</h3>

<p> This section describes the sender's procedure for verifying the nonce sum 
returned by the receiver.
</p>
<p> The nonce sum is verified on the receipt of a SACK chunk which 
acknowledges new data, either via an advanced Cumulative TSN Ack field or by new Gap Ack Blocks. To 
verify the nonce sum, the sender SHOULD:
</p>
<p>

         </p>
<ul class="text">
<li> Calculate the expected nonce sum. This calculation is a single bit addition of the current nonce sum plus all the nonce values corresponding to the new data acknowledged. The nonce values are looked up from the local mapping of TSNs and nonce values maintained at the sender.
</li>
<li> Set the current nonce sum to the value of expected nonce sum.
</li>
<li> Compare the current nonce sum with the NS flag returned 
in the SACK chunk.
</li>
</ul><p>
		 
</p>
<p> The sender SHOULD disable checking of the nonce sum in the following three scenarios (checking of the nonce sum SHOULD be enabled after re-synchronization as described in Section 5.6) :
</p>
<p>
         </p>
<ul class="text">
<li> On detecting that a packet has been lost (i.e., after receiving
four missing reports or after the expiration of the retransmission timer). Nonce checking
is suspended because the receiver has admitted to missing packets and an ordinary congestion 
response is in effect.
</li>
<li> On receiving an ECNE chunk from the receiver. Nonce checking is suspended 
because the receiver has

admitted to a congestion experienced mark and an ordinary congestion response is in effect.
</li>
<li> After sending a FORWARD TSN chunk defined in RFC 3758<a class='info' href='#RFC3758'>[RFC3758]<span> (</span><span class='info'>Stewart, R., Ramalho, M., Xie, Q., Tuexen, M., and P. Conrad, &ldquo;Stream Control Transmission Protocol (SCTP) Partial Reliability Extension,&rdquo; May&nbsp;2004.</span><span>)</span></a>. 
The FORWARD TSN chunk is used by SCTP senders that support the partially reliable extension 
to move the receiver's cumulative ack point forward.
</li>
</ul><p>
		 
</p>
<p> If nonce sum checking is enabled, and a SACK chunk is received with an 
incorrect nonce sum, then several scenarios are possible: (i) the ECNE and SACK chunks were 
sent in separate packets and the ECNE chunk was dropped by the network, (ii) the ECNE chunk 
was sent in a separate packet after the SACK chunk (i.e., the ECNE chunk is currently in the network),
or (iii) the receiver is misbehaving and concealing Congestion Experienced (CE) signals.
</p>
<p> To detect unambiguously that a receiver is misbehaving, the sender waits until new data, sent after having received the incorrect nonce sum, is acknowledged. The sender also suspends checking of the nonce sum during this period. If no ECNE chunk is received till the acknowledgement for the new data arrives, the sender can be certain that the 
receiver is concealing CE signals and thus misbehaving.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
Re-synchronization of the Nonce Sum</h3>

<p> To enable proper checking of the nonce sums, re-synchronization of the sender 
and receiver current nonce sums is required in three situations.
</p>
<p>
         </p>
<ul class="text">
<li> Loss of one or more packets in a window of data: Re-synchronization of 
the sender and receiver current nonce sum occurs when new data sent after the congestion 
window was reduced is acknowledged via the Cumulative TSN Ack field.
</li>
<li> After having received an ECNE chunk: Re-synchronization of the sender and 
receiver current nonce sum occurs when new data sent after the Congestion Window Reduced (CWR) chunk is acknowldeged 
via the Cumulative TSN Ack field.
</li>
<li> After sending a FORWARD TSN chunk: Re-synchronization of the sender and receiver 
current nonce sum occurs when new data sent after the FORWARD TSN chunk is acknowledged via 
the Cumulative TSN Ack field.
</li>
</ul><p>
         
</p>
<p>To re-synchronize, the sender simply sets its current nonce sum to the value 
of NS flag received in the SACK chunk.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Sender's Response</h3>

<p> The following discussion describes the response that SHOULD be applied 
(i) to a peer that does not support the ECN-nonce, or (ii) after having detected a 
misbehaving receiver.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Response to a peer that does not support the ECN-nonce</h3>

<p>
               </p>
<ul class="text">
<li>An SCTP endpoint that supports the ECN-nonce SHOULD disable ECN 
(i.e., stop setting the ECT codepoints for the association) if its peer does not 
support the ECN-nonce.
</li>
<li>Optionally, an SCTP sender can further respond 
by rate limiting the association. Several such responses are possible; this document 
leaves them as a matter of policy that can be exercised by an endpoint.
</li>
</ul><p>
			
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Response to a misbehaving receiver</h3>

<p>
               </p>
<ul class="text">
<li>After having detected a misbehaving receiver,
the SCTP sender SHOULD disable ECN for the rest of the association.
</li>
<li>The minimum penalty to a receiver's misbehavior 
SHOULD be the equivalent of the response to an ECNE chunk.
</li>
<li>Optionally, an SCTP sender can further respond 
to a misbehaving receiver by setting the congestion window (cwnd) to one, thus 
re-probing the available bandwidth. This conservative action eliminates the incentive for a 
receiver to misbehave. Several such responses are possible; this document 
leaves them as a matter of policy that can be exercised by an endpoint.
</li>
</ul><p>
            
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Summary</h3>

<p>This document applies the ECN-nonce proposal RFC 3540 <a class='info' href='#RFC3540'>[RFC3540]<span> (</span><span class='info'>Spring, N., Wetherall, D., and D. Ely, &ldquo;Robust Explicit Congestion Notification (ECN) Signaling with Nonces,&rdquo; June&nbsp;2003.</span><span>)</span></a> to SCTP.
</p>
<p>A single new parameter called the Nonce-Supported parameter and a 
single bit flag in the SACK chunk called the Nonce Sum (NS) have been described 
along with rules governing the sender and receiver side implementation. This document outlines the minimum response that a sender should apply to a receiver's misbehavior.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>This document shares the same security concerns as RFC 3540 <a class='info' href='#RFC3540'>[RFC3540]<span> (</span><span class='info'>Spring, N., Wetherall, D., and D. Ely, &ldquo;Robust Explicit Congestion Notification (ECN) Signaling with Nonces,&rdquo; June&nbsp;2003.</span><span>)</span></a>.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>A single bit flag in the SACK chunk called the Nonce Sum (NS) is used 
by this proposal, and must be allocated.
</p>
<p>One new parameter type code is defined by this document to be
added to SCTP RFC 2960 ('0x8001').
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgements</h3>

<p>Paul Amer provided valuable feedback on an early version of this draft.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.1.&nbsp;Normative references</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3168">[RFC3168]</a></td>
<td class="author-text">Ramakrishnan, K., Floyd, S., and D. Black, &ldquo;<a href="http://tools.ietf.org/html/rfc3168">The Addition of Explicit Congestion Notification (ECN) to IP</a>,&rdquo; RFC&nbsp;3168, September&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3168.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2960">[RFC2960]</a></td>
<td class="author-text">Stewart, R., Xie, Q., Morneault, K., Sharp, C., Schwarzbauer, H., Taylor, T., Rytina, I., Kalla, M., Zhang, L., and V. Paxson, &ldquo;<a href="http://tools.ietf.org/html/rfc2960">Stream Control Transmission Protocol</a>,&rdquo; RFC&nbsp;2960, October&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2960.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3540">[RFC3540]</a></td>
<td class="author-text">Spring, N., Wetherall, D., and D. Ely, &ldquo;<a href="http://tools.ietf.org/html/rfc3540">Robust Explicit Congestion Notification (ECN) Signaling with Nonces</a>,&rdquo; RFC&nbsp;3540, June&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3540.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3758">[RFC3758]</a></td>
<td class="author-text">Stewart, R., Ramalho, M., Xie, Q., Tuexen, M., and P. Conrad, &ldquo;<a href="http://tools.ietf.org/html/rfc3758">Stream Control Transmission Protocol (SCTP) Partial Reliability Extension</a>,&rdquo; RFC&nbsp;3758, May&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3758.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.2.&nbsp;Informational References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="paper.savage99">[paper.savage99]</a></td>
<td class="author-text">Savage, S., Cardwell, N., Wetherall, D., and T. Anderson, &ldquo;TCP congestion control with a misbehaving receiver,&rdquo; &nbsp;SIGCOMM CCR, October&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3708">[RFC3708]</a></td>
<td class="author-text">Blanton, E. and M. Allman, &ldquo;<a href="http://tools.ietf.org/html/rfc3708">Using TCP Duplicate Selective Acknowledgement (DSACKs) and Stream Control Transmission Protocol (SCTP) Duplicate Transmission Sequence Numbers (TSNs) to Detect Spurious Retransmissions</a>,&rdquo; RFC&nbsp;3708, February&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3708.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Randall R. Stewart</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Researcher</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chapi, SC  29036</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:randall@lakerest.net">randall@lakerest.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sourabh Ladha</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Qualcomm</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">5775 Morehouse Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Diego, CA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:"></a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Neil Spring</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">University Of Maryland</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4133 A.V. Williams Bldg</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">College Park, MD  20742</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:nspring@cs.washington.edu">nspring@cs.washington.edu</a></td></tr>
</table>
</body></html>
