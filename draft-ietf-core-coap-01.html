<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Constrained Application Protocol (CoAP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Constrained Application Protocol (CoAP)">
<meta name="keywords" content="CoAP, Constrained Application Protocol, REST">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">CoRE</td><td class="header">Z. Shelby</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Sensinode</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">B. Frank</td></tr>
<tr><td class="header">Expires: January 9, 2011</td><td class="header">SkyFoundry</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">D. Sturek</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Pacific Gas & Electric</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 8, 2010</td></tr>
</table></td></tr></table>
<h1><br />Constrained Application Protocol (CoAP)<br />draft-ietf-core-coap-01</h1>

<h3>Abstract</h3>

<p>
    This document specifies the Constrained Application Protocol (CoAP), a specialized RESTful transfer protocol for use with constrained networks and nodes for machine-to-machine applications such as smart energy and building automation. These constrained nodes often have 8-bit microcontrollers with small amounts of ROM and RAM, while networks such as 6LoWPAN often have high packet error rates and a typical throughput of 10s of kbit/s. 
    CoAP provides the REST Method/Response interaction model between application end-points, supports built-in resource discovery, and includes key web concepts such as URIs and content-types. CoAP easily translates to HTTP for integration with the web while meeting specialized requirements such as multicast support, very low overhead and simplicity for constrained environments.
    
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on January 9, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#introduction">1.</a>&nbsp;
Introduction<br />
<a href="#protocol">2.</a>&nbsp;
Constrained Application Protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#interaction">2.1.</a>&nbsp;
Interaction Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#synchronous-response">2.1.1.</a>&nbsp;
Synchronous response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#asynchronous-response">2.1.2.</a>&nbsp;
Asynchronous response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#transactions">2.2.</a>&nbsp;
Transaction messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#confirmable">2.2.1.</a>&nbsp;
Confirmable (CON)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#non-confirmable">2.2.2.</a>&nbsp;
Non-Confirmable (NON)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#acknowledgment">2.2.3.</a>&nbsp;
Acknowledgment (ACK)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reset">2.2.4.</a>&nbsp;
Reset (RST)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#transactionid">2.2.5.</a>&nbsp;
Transaction IDs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#methods">2.3.</a>&nbsp;
Methods<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#read">2.3.1.</a>&nbsp;
GET<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#create">2.3.2.</a>&nbsp;
POST<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#update">2.3.3.</a>&nbsp;
PUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#delete">2.3.4.</a>&nbsp;
DELETE<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">2.4.</a>&nbsp;
Response Codes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#opt">2.5.</a>&nbsp;
Options<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#opt-proc">2.5.1.</a>&nbsp;
Option Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uri">2.5.2.</a>&nbsp;
URIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#content-type">2.5.3.</a>&nbsp;
Content-type encoding<br />
<a href="#messages">3.</a>&nbsp;
Message Formats<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#base">3.1.</a>&nbsp;
CoAP header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#options">3.2.</a>&nbsp;
Header options<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-content">3.2.1.</a>&nbsp;
Content-type Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-uri-scheme">3.2.2.</a>&nbsp;
Uri-Scheme Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-uri-auth">3.2.3.</a>&nbsp;
Uri-Authority Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-uri-path">3.2.4.</a>&nbsp;
Uri-Path Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-location">3.2.5.</a>&nbsp;
Location Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-max-age">3.2.6.</a>&nbsp;
Max-age Option<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-etag">3.2.7.</a>&nbsp;
Etag Option<br />
<a href="#binding">4.</a>&nbsp;
UDP Binding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#multicast">4.1.</a>&nbsp;
Multicast<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#retransmission">4.2.</a>&nbsp;
Retransmission<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#congenstion">4.3.</a>&nbsp;
Congestion Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#port">4.4.</a>&nbsp;
Default Port<br />
<a href="#caching">5.</a>&nbsp;
Caching<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cache-control">5.1.</a>&nbsp;
Cache control<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cache-refreshing">5.2.</a>&nbsp;
Cache refresh<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#proxying">5.3.</a>&nbsp;
Proxying<br />
<a href="#discovery">6.</a>&nbsp;
Resource Discovery<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#link_format">6.1.</a>&nbsp;
Link Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#discovery_naming">6.2.</a>&nbsp;
Naming<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#discovery_filtering">6.3.</a>&nbsp;
Query Filtering<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#discovry_http">6.4.</a>&nbsp;
HTTP Resource Discovery<br />
<a href="#http">7.</a>&nbsp;
HTTP Mapping<br />
<a href="#constants">8.</a>&nbsp;
Protocol Constants<br />
<a href="#examples">9.</a>&nbsp;
Examples<br />
<a href="#anchor2">10.</a>&nbsp;
Security Considerations<br />
<a href="#anchor3">11.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#appendix_codes">11.1.</a>&nbsp;
Codes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#appendix_content">11.2.</a>&nbsp;
Content Types<br />
<a href="#anchor4">12.</a>&nbsp;
Acknowledgments<br />
<a href="#anchor5">13.</a>&nbsp;
Changelog<br />
<a href="#rfc.references1">14.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">14.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">14.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
  The use of web services on the Internet has become ubiquitous in most applications, and depends on the fundamental Representational State Transfer (REST) architecture of the web. 
  
</p>
<p>
  The Constrained RESTful Environments (CoRE) working group aims at realizing the REST architecture in a suitable form for the most constrained nodes (e.g. 8-bit microcontrollers with limited RAM and ROM) and networks (e.g. 6LoWPAN). Constrained networks like 6LoWPAN support the expensive fragmentation of IPv6 packets into small link-layer frames. One design goal of CoRE has been to keep message overhead small, thus limiting the use of fragmentation.  
  
</p>
<p>One of the main goals of CoRE is to design a generic RESTful protocol for the special requirements of this constrained environment, especially considering energy, building automation and other M2M applications. The goal of CoAP is not to blindly compress HTTP, but rather to realize a subset of REST common with HTTP but optimized for M2M applications. Although CoRE could be used for compressing simple HTTP interfaces, it more importantly also offers features for M2M such as built-in discovery, multicast support and asynchronous transactions.
  
</p>
<p>
  This document specifies the RESTful Constrained Application Protocol (CoAP) , which easily translates to HTTP for integration with the existing web while meeting specialized requirements such as multicast support, very low overhead and simplicity for constrained environments and M2M applications <a class='info' href='#I-D.shelby-core-coap-req'>[I&#8209;D.shelby&#8209;core&#8209;coap&#8209;req]<span> (</span><span class='info'>Shelby, Z., Stuber, M., Sturek, D., Frank, B., and R. Kelsey, &ldquo;CoAP Requirements and Features,&rdquo; April&nbsp;2010.</span><span>)</span></a>. CoAP has the following main features:

  </p>
<ul class="text">
<li>Constrained RESTful protocol fulfilling M2M requirements.
</li>
<li>A stateless HTTP mapping, allowing proxies to be built providing access to CoAP resources via HTTP in a uniform way or for HTTP simple interfaces to be realized alternatively over CoAP.
</li>
<li>UDP binding with reliable unicast and best-effort multicast support.
</li>
<li>Asynchronous transaction support.
</li>
<li>Low header overhead and parsing complexity.
</li>
<li>URI and Content-type support.
</li>
<li>Built-in resource discovery.
</li>
<li>Simple proxy and caching capabilities.
</li>
</ul><p>
  
</p>
<p>
  
  
</p>
<a name="protocol"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Constrained Application Protocol</h3>

<p>
  This section specifies the basic functionality and processing rules of the protocol. 
  
</p>
<a name="interaction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Interaction Model</h3>

<p>
    The REST interaction model of CoAP is similar to the client/server model of HTTP. However, Machine-to-machine interactions typically result in a CoAP implementation acting in both client and server roles (called an end-point). A CoAP REST exchange is equivalent to that of HTTP, and is sent by a client to request an action (using a Method Code) on a resource (identified by a URI) on a server. A response is then sent with a Response Code and resource representation if appropriate. 
</p>
<p>
	Unlike HTTP, CoAP deals with these REST interchanges asynchronously over a UDP transport with support for both unicast and multicast interactions. This is achieved using transaction messages (Confirmable, Non-Confirmable, Acknowledgment, Reset) supporting optional reliability (with exponential back-off) and transaction IDs between end-points to carry REST requests and responses. These transactions are transparent to the REST interchanges. The only difference being that responses may arrive asynchronously. 
	
</p>
<p>
	One could think of CoAP as using a two-layer approach, a transactional layer used to deal with UDP and the asynchronous nature of the interactions, and the REST interactions using Method and Response codes. 
	
</p><br /><hr class="insert" />
<a name="fig-layers"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

                         +---------------------+
                         |     Application     |
                         +---------------------+
                         +---------------------+
                         |      CoAP REST      |
                         |---------------------|
                         |  CoAP Transactions  |
                         +---------------------+
                         +---------------------+
                         |        UDP          |
                         +---------------------+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Abstract layering of CoAP&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="synchronous-response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.1"></a><h3>2.1.1.&nbsp;
Synchronous response</h3>

<p>The most basic interaction between the REST and Transaction layers works by
sending a REST request in a confirmable CoAP message and waiting for
an acknowledgment message that also carries the REST response.
E.g., two possible interactions for a basic GET are shown in <a class='info' href='#get-basic'>Figure&nbsp;2<span> (</span><span class='info'>Two basic GET transactions, one successful, one not found</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="get-basic"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Client             Server       Client             Server
   |                 |             |                 |
   |    CON tid=47   |             |    CON tid=53   |
   |     GET /foo    |             |     GET /baz    |
   +----------------&gt;|             +----------------&gt;|
   |                 |             |                 |
   |    ACK tid=47   |             |    ACK tid=53   |
   |  200 "&lt;temp...  |             |    404 "Not...  |
   |&lt;----------------+             |&lt;----------------+
   |                 |             |                 |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Two basic GET transactions, one successful, one not found&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Note that at the transaction layer, the response is returned in an ACK
message, independent of whether the request was successful at the REST layer.
In effect, the REST response is piggy-backed on the ACK message, so no
separate acknowledgment is required that the GET message was received.
</p>
<p>The relationship between the confirmable message (CON) and the
acknowledgment message (ACK) is indicated by the transaction ID,
which is echoed back by the server in the ACK.
Transaction IDs are short-lived, they only serve to couple CON and ACK
messages.
</p>
<p>The tight coupling between CON and ACK also relieves the ACK of the
need to echo back information from the request, such as the URI or a
request token supplied by the client.  We say that a REST response
carried in an ACK <em>pertains</em> to the REST request in the corresponding
CON.
</p>
<a name="asynchronous-response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1.2"></a><h3>2.1.2.&nbsp;
Asynchronous response</h3>

<p>Not all interactions are as simple as the basic synchronous exchange
shown.  For example, a server might need longer to obtain the
representation of the resource requested than it can wait sending back
the acknowledgment, without risking the client to repeatedly
retransmit the request.  To handle this case, the REST response is
decoupled from the transaction layer acknowledgment.  Actually, the
latter does not carry any REST message at all.
</p>
<p>As the client cannot know that this will be the case, it sends exactly
the same confirmable message with the same REST request.  The server
maybe attempts to obtain the resource (e.g., by acting as a proxy) and
times out an ACK timer, or it immediately sends an acknowledgment
knowing in advance that there will be no quick answer.  The
acknowledgment effectively is a promise that the REST request will be
acted upon, see <a class='info' href='#get-async'>Figure&nbsp;3<span> (</span><span class='info'>An asynchronous GET transaction</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="get-async"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Client             Server
   |                 |
   |   CON tid=48    |
   |  GET http://n.. |
   +----------------&gt;|
   |                 |
   |   ACK tid=48    |
   |&lt;----------------+
   |                 |
   ... Time Passes ...
   |                 |
   |   CON tid=783   |
   |  200 http://n.. |
   |     "&lt;html..    |
   |&lt;----------------+
   |                 |
   |   ACK tid=783   |
   +----------------&gt;|
   |                 |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: An asynchronous GET transaction&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>When the server finally has obtained the resource representation and
is ready to send the response, it initiates a transaction to the
client.  This new transaction has its own transaction ID, so there is
no automatic coupling of the response to the request.  Instead, the
URI (and possibly token) is echoed back to the client in order to
associate the REST response to the original REST request.
To ensure that this message is not lost, it is again sent as a
confirmable message and answered by the client with an ACK, citing the
new TID chosen by the server.
</p>
<p>As a special failure situation, a client may no longer be aware that
it sent a request, e.g., if it does not have stable storage and was
rebooted in the meantime.  This can be indicated by a special "Reset"
message, as shown in <a class='info' href='#get-orphaned'>Figure&nbsp;4<span> (</span><span class='info'>An orphaned transaction</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="get-orphaned"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Client             Server
 ... Client reboots ...
   |                 |
   |   CON tid=783   |
   |  200 http://n.. |
   |     "&lt;html..    |
   |&lt;----------------+
   |                 |
   |   RST tid=783   |
   +----------------&gt;|
   |                 |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: An orphaned transaction&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="transactions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Transaction messages</h3>

<p>The CoAP transactions make use of four different message types, described in this section. These messages are transparent to the REST request/response carried over them.
</p>
<a name="confirmable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.1"></a><h3>2.2.1.&nbsp;
Confirmable (CON)</h3>

<p>
		Some messages require an acknowledgment, either just to know they did
arrive or also to deliver the reply to a request.  We call these
messages "Confirmable".  When no packets are lost, each Confirmable
message elicits exactly one return message of type Acknowledgment or
type Reset.
		
</p>
<a name="non-confirmable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2"></a><h3>2.2.2.&nbsp;
Non-Confirmable (NON)</h3>

<p>
		Some other messages do not require an acknowledgment. This is
particularly true for messages that are repeated regularly for
application requirements, such as repeated readings from a sensor
where eventual arrival is sufficient.
		
</p>
<a name="acknowledgment"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.3"></a><h3>2.2.3.&nbsp;
Acknowledgment (ACK)</h3>

<p>
		An Acknowledgment message acknowledges that a specific Confirmable
message (identified by its Transaction ID) arrived.  As with all of
the message types itself, it may carry a payload and some options to
provide more details, such as the result of a request that was carried
in the Confirmable.
		
</p>
<a name="reset"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.4"></a><h3>2.2.4.&nbsp;
Reset (RST)</h3>

<p>
		A Reset message indicates that a specific Confirmable message was
received, but some context is missing to properly process it.  This
condition is usually caused when the receiving node has rebooted and has
forgotten some state that would be required to interpret the message.
		
</p>
<a name="transactionid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.5"></a><h3>2.2.5.&nbsp;
Transaction IDs</h3>

<p>
      The Transaction ID is an unsigned integer kept by a CoAP end-point for all of the CoAP Confirmable or Non-Confirmable messages it sends. Each CoAP end-point keeps a single Transaction ID variable, which is changed each time a new Confirmable or Non-Confirmable message is sent regardless of the destination address or port. The Transaction ID is used to match an Acknowledgment with an outstanding request, for retransmission and to discard duplicate messages. The initial Transaction ID should be randomized. The same Transaction ID MUST NOT be re-used within the potential retransmission window, calculated as RESPONSE_TIMEOUT * (2 ^ MAX_RETRANSMIT - 1).
      
</p>
<a name="methods"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Methods</h3>

<p>
    CoAP supports the basic RESTful methods of GET, POST, PUT, DELETE, which are easily mapped to HTTP. In this section each method is defined along with its behavior. A unicast request with an unknown or unsupported Method Code MUST generate a message with a "405 Method Not Allowed" Response Code.
    
</p>
<p>
    As CoAP methods manipulate resources, they have the same properties of safe (only retrieval) and idempotent (you can invoke it multiple times with the same effects) as HTTP <a class='info' href='#RFC2616'>Section 9.1<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> [RFC2616]. The GET method is safe, therefore it MUST NOT take any other action on a resource other than retrieval. The GET, PUT and DELETE methods MUST be performed in such a way that they are idempotent.
    
</p>
<a name="read"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.1"></a><h3>2.3.1.&nbsp;
GET</h3>

<p>
      The GET method retrieves the information of the resource identified by the request URI. Upon success a 200 (OK) response SHOULD be sent.
      
</p>
<p>
      The response to a GET is cacheable if it meets the requirements in <a class='info' href='#caching'>Section&nbsp;5<span> (</span><span class='info'>Caching</span><span>)</span></a>.
      
</p>
<a name="create"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.2"></a><h3>2.3.2.&nbsp;
POST</h3>

<p>
      The POST method is used to request the server to create a new resource under the requested URI. If a resource has been created on the server, the response SHOULD be 201 (Created) including the URI of the new resource in a Location Option with any possible status in the message body. If the POST succeeds but does not result in a new resource being created on the server, a 200 (OK) response code SHOULD be returned. 
      
</p>
<p>
      Responses to this method are not cacheable.
      
</p>
<a name="update"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.3"></a><h3>2.3.3.&nbsp;
PUT</h3>

<p>
      The PUT method requests that the resource identified by the request URI be updated with the enclosed message body. If a resource exists at that URI the message body SHOULD be considered a modified version of that resource, and a 200 (OK) response SHOULD be returned. If no resource exists then the server MAY create a new resource with that URI, resulting in a 201 (Created) response. If the resource could not be created or modified, then an appropriate error response code SHOULD be sent.
      
</p>
<p>
      Responses to this method are not cacheable.
      
</p>
<a name="delete"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.4"></a><h3>2.3.4.&nbsp;
DELETE</h3>

<p>
      The DELETE method requests that the resource identified by the request URI be deleted. The response 200 (OK) SHOULD be sent on success.
      
</p>
<p>
      Responses to this method are not cacheable.
      
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Response Codes</h3>

<p>
    CoAP makes use of a subset of HTTP response codes as defined in <a class='info' href='#appendix_codes'>Section&nbsp;11.1<span> (</span><span class='info'>Codes</span><span>)</span></a>.
    
</p>
<a name="opt"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Options</h3>

<p>
	  CoAP makes use of compact, extensible Type-Length-Value (TLV) style options. This section explains the processing of CoAP options along with a summary of the main features implemented in options such as URIs and Content-types.  
	  
</p>
<a name="opt-proc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.1"></a><h3>2.5.1.&nbsp;
Option Processing</h3>

<p>
      If no options are to be included, the Option Count field is set to 0 below and the Payload (if any) immediately follows the Transaction ID. If options are to be included, the following rules apply. The number of options is placed in the Option Count field. Each option is then placed in order of Type, immediately following the Transaction ID with no padding. Upon reception, unknown options of class "elective" MUST be silently skipped. Unknown options of class "critical" in a Confirmable SHOULD cause the return of a response code "400 Bad Request" (TBD) including a copy of the critical option number.
      
</p>
<a name="uri"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.2"></a><h3>2.5.2.&nbsp;
URIs</h3>

<p>
    The Universal Resource Identifier (URI) <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> is an important feature of the REST architecture, where the relative part of the URI indicates the resource being manipulated. CoAP supports URIs similarly to HTTP, e.g. coap://[2001:DB8::101]/s/temp. As this URI is used purely as a locator, CoAP only supports Universal Resource Locator features of <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> although throughout the document we refer to URI. 
    
</p>
<p>
    CoAP splits the URI up into its three parts with the Uri-Scheme, Uri-Authority and Uri-Path Options. The full URI can be created by concatenating those options (or their defaults if not present). Uri-Scheme and Uri-Authority options are used for proxying, whereas Uri-Path is used for all requests. CoAP does not support "." or ".." in URIs nor does it support IRIs. A CoAP implementation SHOULD support query "?" processing  (see <a class='info' href='#discovery'>Section&nbsp;6<span> (</span><span class='info'>Resource Discovery</span><span>)</span></a> on the use of the query string in discovery), however fragment "#" processing is not supported. All URI strings in CoAP MUST use the US-ASCII encoding defined in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>. When using the Uri-Path Option the leading slash MUST be omitted. Thus the above example "/s/temp" is included in the Uri-Path Option as "s/temp". 
    
</p>
<p>
    Application designers are encouraged to make use of short, but descriptive URIs. For example URIs 14 or less bytes in length fit in a more compact option header. In addition, very short URIs such as "/1" can be assigned as an alternative short URI for a resource by the application. CoAP resource descriptions includes an attribute to indicate if a short alternative URI of a resource is available (see <a class='info' href='#discovery'>Section&nbsp;6<span> (</span><span class='info'>Resource Discovery</span><span>)</span></a>).
    
</p>
<p>
    The CoAP protocol scheme is identified in URIs with "coap://" [IANA_TBD_SCHEME].
    
</p>
<a name="content-type"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5.3"></a><h3>2.5.3.&nbsp;
Content-type encoding</h3>

<p>
    In order to support heterogeneous uses, CoAP is transparent to the use of different application payloads. In order for the application process receiving a packet to properly parse a payload, its content-type should be explicitly known from the header (as e.g. with HTTP). The use of typical binary encodings for XML is discussed in <a class='info' href='#I-D.shelby-6lowapp-encoding'>[I&#8209;D.shelby&#8209;6lowapp&#8209;encoding]<span> (</span><span class='info'>Shelby, Z., Luimula, M., and D. Peintner, &ldquo;Efficient XML Encoding and 6LowApp,&rdquo; October&nbsp;2009.</span><span>)</span></a>.
    
</p>
<p>
    String names of Internet media types (MIME types) <a class='info' href='#RFC2046'>[RFC2046]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types,&rdquo; November&nbsp;1996.</span><span>)</span></a> are not optimal for use in the CoAP header. Instead, CoAP simply assigns identifiers to a subset of common media and content transfer encoding types. The content-type identifier is optionally included in the Content-type Option Header of messages to indicate the type of the message body. CoAP Content-type identifiers are defined in <a class='info' href='#appendix_content'>Section&nbsp;11.2<span> (</span><span class='info'>Content Types</span><span>)</span></a>. In the absence of the Content-type Option the MIME type "text/plain" MUST BE assumed.
    
</p>
<a name="messages"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Message Formats</h3>

<p>
  CoAP makes use of asynchronous transactions using a simple binary header format. This base header may be followed by options in Type-Length-Value (TLV) format. CoAP is bound to UDP as described in <a class='info' href='#binding'>Section&nbsp;4<span> (</span><span class='info'>UDP Binding</span><span>)</span></a>. 

  
</p>
<p>
  Any bytes after the headers in the packet are considered the message payload, if any. The length of the message payload is implied by the datagram length. See <a class='info' href='#binding'>Section&nbsp;4<span> (</span><span class='info'>UDP Binding</span><span>)</span></a> for further message length requirements.
  
</p>
<a name="base"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
CoAP header</h3>

<p>
    This section defines the CoAP header, which is shared for all CoAP messages. CoAP makes use of an asynchronous transaction model. These transactions are used to carry RESTful exchanges, either using a Method Code (GET/PUT/POST/DELETE) to invoke interaction with a resource, or a Response Code carried in an immediate or asynchronous response. 
	
</p><br /><hr class="insert" />
<a name="fig-req"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

  0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Ver| T |  OC   |      Code     |        Transaction ID         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Options (if any) ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Payload (if any) ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: CoAP header format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
         </p>
<blockquote class="text"><dl>
<dt>Header Fields:</dt>
<dd>
       
<blockquote class="text"><dl>
<dt>Ver:</dt>
<dd>
         Version. 2-bit unsigned integer. Indicates the version of CoAP. Implementations of this specification MUST set this field to 1. Other values are reserved for future versions. 
         
</dd>
<dt>T:</dt>
<dd>
         2-bit unsigned integer Transaction Type field. Indicates if this message is Confirmable (0), Non-Confirmable (1), Acknowledgment (2) or Reset (3).
         
</dd>
<dt>OC:</dt>
<dd>
         4-bit unsigned integer Option Count field. Indicates if there are Option Headers following the base header. If set to 0 the payload (if any) immediately follows the base header. If greater than zero the field indicates the number of options to immediately follow the header. 
         
</dd>
<dt>Code:</dt>
<dd>
         8-bit unsigned integer. This field indicates the Method or Response Code of a message. The value 0 indicates no code. The values 1-10 are used for Method Codes as defined in <a class='info' href='#tab-method'>Table&nbsp;1<span> (</span><span class='info'>Method Codes</span><span>)</span></a>. The values 11-39 are reserved for future use. The values 40-255 are used for Response Codes as defined in <a class='info' href='#appendix_codes'>Section&nbsp;11.1<span> (</span><span class='info'>Codes</span><span>)</span></a>.
         
</dd>
<dt>Transaction ID:</dt>
<dd>
         16-bit unsigned integer. A unique Transaction ID assigned by the source and used to match responses. The Transaction ID MUST be changed for each new request (regardless of the end-point) and MUST NOT be changed when retransmitting a request (see <a class='info' href='#transactionid'>Section&nbsp;2.2.5<span> (</span><span class='info'>Transaction IDs</span><span>)</span></a>). 
         
</dd>
</dl></blockquote>
     
</dd>
</dl></blockquote><p>
    
</p><br /><hr class="insert" />
<a name="tab-method"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Method</th><th align="left">Code</th></tr>
<tr>
<td align="left">GET</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">POST</td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">PUT</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">DELETE</td>
<td align="left">4</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1: Method Codes&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="options"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Header options</h3>

<p>
    CoAP messages may also include one or more header options in TLV format. Options MUST appear in order of option type (see <a class='info' href='#tab-options'>Table&nbsp;2<span> (</span><span class='info'>Option headers</span><span>)</span></a>). A delta encoding is used between each option header, with the Type identifier for each Option calculated as the sum of its Option Delta field and the Type identifier of the preceding Option in the message, if any, or zero otherwise.
    
</p>
<p>Each option header includes a Length field which can be extended by an octet for options with values longer than 14 octets. CoAP options include the concept of Critical (odd value) and Elective (even value) options (see <a class='info' href='#opt-proc'>Section&nbsp;2.5.1<span> (</span><span class='info'>Option Processing</span><span>)</span></a>). 
    
</p>
<p>
    Each option has the following format:
    
</p><br /><hr class="insert" />
<a name="fig-opt"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

      0   1   2   3   4   5   6   7
    +---+---+---+---+---+---+---+---+
    | option delta  |    length     | for 0..14
    +---+---+---+---+---+---+---+---+
                                               for 15..270:
    +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
    | option delta  | 1   1   1   1 |          length - 15          |
    +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Header option format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
       </p>
<blockquote class="text"><dl>
<dt>Option delta:</dt>
<dd>
          4-bit unsigned integer. This field defines the difference between the option Type of this option and the previous option (or zero for the first option). In other words, the Type identifier is calculated by simply summing the Option delta fields of this and previous options before it. The Option Values 14, 28, ... are reserved for no-op options with no value (they are ignored) and are used for deltas larger than 14. Thus these can be used as "fenceposts" if deltas larger than 15 would otherwise be required.
         
</dd>
<dt>Length:</dt>
<dd>
          Length Field. Normally Length is a 4-bit unsigned integer allowing values of 0-14 octets. When the length is 15 or more, another byte is added as an 8-bit unsigned integer plus 15 allowing values of 15-270 octets.
         
</dd>
<dt>Option Value</dt>
<dd>
         The value in the format defined for that option in <a class='info' href='#tab-options'>Table&nbsp;2<span> (</span><span class='info'>Option headers</span><span>)</span></a> of Length octets. Options MAY use variable length values.
         
</dd>
</dl></blockquote><p>
     
</p>
<p>
    The following options are defined in this document. The Default column indicates the value to be assumed in the absence of this option (if any). 
    
</p><br /><hr class="insert" />
<a name="tab-options"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left"><col align="left"><col align="left"><col align="left">
<tr><th align="left">Type</th><th align="left">C/E</th><th align="left">Name</th><th align="left">Data type</th><th align="left">Length</th><th align="left">Default</th></tr>
<tr>
<td align="left">0</td>
<td align="left">-</td>
<td align="left">Reserved</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">C</td>
<td align="left">Content-type</td>
<td align="left">8-bit unsigned integer</td>
<td align="left">1 B</td>
<td align="left">0 (text/plain)</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">E</td>
<td align="left">Max-age</td>
<td align="left">Variable length unsigned integer</td>
<td align="left">1-4 B</td>
<td align="left">60 seconds</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">C</td>
<td align="left">Uri-Scheme</td>
<td align="left">String</td>
<td align="left">1-270 B</td>
<td align="left">"coap"</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">E</td>
<td align="left">Etag</td>
<td align="left">Sequence of bytes</td>
<td align="left">1-4 B</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">C</td>
<td align="left">Uri-Authority</td>
<td align="left">String</td>
<td align="left">1-270 B</td>
<td align="left">""</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">E</td>
<td align="left">Location</td>
<td align="left">String</td>
<td align="left">1-270 B</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">-</td>
<td align="left">Reserved</td>
<td align="left">-</td>
<td align="left">-</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">C</td>
<td align="left">Uri-Path</td>
<td align="left">String</td>
<td align="left">1-270 B</td>
<td align="left">""</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 2: Option headers&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="option-content"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
Content-type Option</h3>

<p>The Content-type Identifier Option indicates the Internet media type identifier of the message-body, see <a class='info' href='#appendix_content'>Section&nbsp;11.2<span> (</span><span class='info'>Content Types</span><span>)</span></a> for the encoding and identifier tables. A Content-type Identifier Option SHOULD be included if there is a payload included with a CoAP message. In the absence of the Content-type Option the MIME type "text/plain" (0) MUST be assumed. This option MUST be supported by all end-points.
</p>
<a name="option-uri-scheme"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
Uri-Scheme Option</h3>

<p>The Uri-Scheme Option indicates the schema part of the URI without any ":" or "://" glue. This option is most often used to access a resource via a proxy. For example, to access an HTTP resource via a proxy the option value would be "http". In the absence of this option, the URI scheme is assumed to be "coap". <a class='info' href='#uri'>Section&nbsp;2.5.2<span> (</span><span class='info'>URIs</span><span>)</span></a> specifies the rules for URIs in CoAP. This option MUST be supported by an end-point implementing proxy functionality.
</p>
<a name="option-uri-auth"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.3"></a><h3>3.2.3.&nbsp;
Uri-Authority Option</h3>

<p>The Uri-Authority Option indicates the authority (host + port) part of a URI. Examples of this option include "[2001:DB8::101]", "198.51.100.0:8000" and "sensor.example.com". This option is used when accessing a resource via a proxy. In the absence of this option, the authority is assumed to be "". <a class='info' href='#uri'>Section&nbsp;2.5.2<span> (</span><span class='info'>URIs</span><span>)</span></a> specifies the rules for URIs in CoAP. This option MUST be supported by an end-point implementing proxy functionality.
</p>
<a name="option-uri-path"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.4"></a><h3>3.2.4.&nbsp;
Uri-Path Option</h3>

<p>The Uri-Path Option indicates the absolute path part of a URI. One example of an absolute path in his option is "s/light". In the absence of this option, the path is assumed to be "/". <a class='info' href='#uri'>Section&nbsp;2.5.2<span> (</span><span class='info'>URIs</span><span>)</span></a> specifies the rules for URIs in CoAP. The leading slash is assumed and MUST be omitted. This option MUST be supported by all end-points. 
</p>
<a name="option-location"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.5"></a><h3>3.2.5.&nbsp;
Location Option</h3>

<p>The Location Option indicates the location of a resource as an absolute path URI and is similar to the Uri-Path Option. The Location Option MAY be included in a response to indicate the Location of a new resource created with POST or together with a 30x response code. The leading slash is assumed and MUST be omitted. 
</p>
<a name="option-max-age"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.6"></a><h3>3.2.6.&nbsp;
Max-age Option</h3>

<p>The Max-age Option indicates the maximum age of the resource for use in cache control in seconds. The option value is represented as a variable length unsigned integer between 8 and 32 bits. A default value of 60 seconds is assumed in the absence of this option.
  
</p>
<p>
  When included in a request, Max-age indicates the maximum age of a cached representation of that resource the client will accept. When included in a response, Max-age indicates the maximum time the representation may be cached before it MUST be discarded.
  
</p>
<a name="option-etag"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.7"></a><h3>3.2.7.&nbsp;
Etag Option</h3>

<p>The Etag Option is an opaque sequence of bytes which specifies the version of a resource representation. An Etag may be generated for a resource in any number of ways including a version, checksum, hash or time. An end-point receiving an Etag MUST treat it as opaque and make no assumptions about its format. The Etag MAY be included in a response to indicate to a client if a resource has changed. The Etag SHOULD be included in a request used for a cache refresh to indicate the client's current version of the resource (see <a class='info' href='#cache-refreshing'>Section&nbsp;5.2<span> (</span><span class='info'>Cache refresh</span><span>)</span></a>). 
</p>
<a name="binding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
UDP Binding</h3>

<p>
  The CoAP protocol operates by default over UDP. CoAP could also be used over other transports such as TCP or SCTP, the specification of which is out of this document's scope.
  
</p>
<p>
    The goal of binding CoAP to UDP is to provide the bare minimum features for the protocol to operate over UDP, without trying to re-create the full feature set of a transport like TCP. CoAP over UDP has the following features:
    
</p>
<p>
      </p>
<ul class="text">
<li>Simple stop-and-wait retransmission reliability with exponential back-off as described in <a class='info' href='#retransmission'>Section&nbsp;4.2<span> (</span><span class='info'>Retransmission</span><span>)</span></a> for Confirmable messages.
</li>
<li>Transaction ID for response matching as described in <a class='info' href='#transactionid'>Section&nbsp;2.2.5<span> (</span><span class='info'>Transaction IDs</span><span>)</span></a>.
</li>
<li>Multicast support as described in <a class='info' href='#multicast'>Section&nbsp;4.1<span> (</span><span class='info'>Multicast</span><span>)</span></a>.  
</li>
</ul><p>
    
</p>
<p>
   The length of the Payload in a CoAP message is calculated from the datagram length. While specific link layers make it beneficial to keep CoAP messages small enough to fit into their link layer packets (see <a class='info' href='#introduction'>Section&nbsp;1<span> (</span><span class='info'>Introduction</span><span>)</span></a>), this is a matter of implementation quality.  The CoAP specification itself provides only an upper bound to the message size. A CoAP message SHOULD fit within a single IP packet and MUST fit within a single IP datagram. If the Path MTU is not known for a destination, an MTU of 1280 octets SHOULD be assumed.
    
</p>
<a name="multicast"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Multicast</h3>

<p>
 	CoAP supports the use of multicast destination addresses. Multicast messages SHOULD be Non-Confirmable. If a Confirmable multicast message is sent then retransmission MUST NOT be performed. Furthermore, a destination end-point to a multicast Confirmable message MUST only send an Acknowledgment if the response code included indicates success (Code = 2XX) in order to eliminate error code response floods. Other mechanisms for avoiding congestion from multicast requests are being considered in <a class='info' href='#I-D.eggert-core-congestion-control'>[I&#8209;D.eggert&#8209;core&#8209;congestion&#8209;control]<span> (</span><span class='info'>Eggert, L., &ldquo;Congestion Control for the Constrained Application Protocol (CoAP),&rdquo; June&nbsp;2010.</span><span>)</span></a>.
 	
</p>
<a name="retransmission"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Retransmission</h3>

<p>
      A CoAP end-point keeps track of open Confirmable messages it sent that are waiting for a response. Each entry includes at least the destination IP address and port of the original message, the message itself, a retransmission counter and a timeout. When a Confirmable is sent, an entry is made for that message with a default initial timeout of RESPONSE_TIMEOUT and the retransmission counter set to 0. When a matching Acknowledgment is received for an entry, the entry is invalidated. When a timeout is triggered for an entry and the retransmission counter is less than MAX_RETRANSMIT, the original message is retransmitted to the destination without modification, the retransmission counter is incremented, and the timeout is doubled. If the retransmission counter reaches MAX_RETRANSMIT on a timeout, then the entry is removed and the application process informed of delivery failure.
      
</p>
<p>
      For CoAP messages sent to IP multicast addresses, retransmission MUST NOT be performed. Therefore MAX_RETRANSMIT is always set to 0 when the destination address is multicast.
      
</p>
<a name="congenstion"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Congestion Control</h3>

<p>
      In addition to the exponential back-off mechanism in <a class='info' href='#retransmission'>Section&nbsp;4.2<span> (</span><span class='info'>Retransmission</span><span>)</span></a>, further congestion control optimizations are being considered and tested for CoAP. These congestion control mechanism under consideration are described in <a class='info' href='#I-D.eggert-core-congestion-control'>[I&#8209;D.eggert&#8209;core&#8209;congestion&#8209;control]<span> (</span><span class='info'>Eggert, L., &ldquo;Congestion Control for the Constrained Application Protocol (CoAP),&rdquo; June&nbsp;2010.</span><span>)</span></a>.
      
</p>
<a name="port"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Default Port</h3>

<p>
    The CoAP default port number [IANA_TBD_PORT] MUST be supported by a server for resource discovery (see <a class='info' href='#discovery'>Section&nbsp;6<span> (</span><span class='info'>Resource Discovery</span><span>)</span></a>) and SHOULD be supported for providing access to other resources. In addition other end-points may be hosted in the dynamic port space.
    
</p>
<p>
    When a CoAP server is hosted by a 6LoWPAN node, it SHOULD support a port in the 61616-61631 compressed UDP port space defined in <a class='info' href='#RFC4944'>[RFC4944]<span> (</span><span class='info'>Montenegro, G., Kushalnagar, N., Hui, J., and D. Culler, &ldquo;Transmission of IPv6 Packets over IEEE 802.15.4 Networks,&rdquo; September&nbsp;2007.</span><span>)</span></a>. The specific port number in use will be communicated in a URI and/or by some other discovery mechanism.
    
</p>
<a name="caching"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Caching</h3>

<p>
  CoAP end-points are by definition constrained by bandwidth and processing power. To optimize the performance of data transfer under these constraints, we use caching features consistent with HTTP.  Caching includes the following concepts:
    </p>
<ul class="text">
<li>Cache life of a resource is controlled via the Max-Age header option
</li>
<li>Cache refresh and versioning of a resource is controlled via the Etag header option
</li>
<li>Proxies between a client and end-point may participate in the caching process on behalf of sleeping end-points and to avoid unnecessary traffic on the constrained network
</li>
</ul><p>
  
</p>
<a name="cache-control"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Cache control</h3>

<p>
    When an end-point responds to a GET request by sending a representation of the resource, it SHOULD specify the Max-Age header option.  The Max-Age specifies the cache life of the resource in seconds.  Resources which change rapidly will have a short cache life, and resources which change infrequently should specify a long cache life.  If Max-Age is unspecified in a GET response, then it is assumed to be 60 seconds.  If an end-point wishes to disable caching, it must explicitly specify a Max-Age of zero seconds.
    
</p>
<p>
    When a client reads the response from a GET request, it should cache the resource representation for the cache lifetime as specified by the Max-Age header.  During the cache lifetime, the client SHOULD use its cached version and avoid performing additional GETs for the resource.
    
</p>
<p>
    In general, the origin server end-point is responsible for determining cache age. However, in some cases a client may wish to determine its own tolerance for cache staleness.  In this case, a client may specify the Max-Age header during a GET request.  If the client's Max-Age is of a shorter duration than the age of a cached resource, then the proxy or end-point SHOULD perform a cache refresh.  If the client specifies a Max-Age of zero seconds, then the response MUST discard the cached representation and return a fresh representation.
    
</p>
<a name="cache-refreshing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Cache refresh</h3>

<p>
    After the expiration of the cache lifetime, clients and proxies can refresh their cached representation of a resource.  Cache refresh is accomplished using a GET request which will return a representation of the resource's current state.
    
</p>
<p>
    If the end-point has the capability to version the resource, then the end-point should include the Etag header option in the response to a GET request.  The Etag is a variable length sequence of bytes which captures a version identifier of the resource.  The Etag is an opaque identifier; clients MUST NOT infer any semantics from the Etag value.
    
</p>
<p>
    If an end-point specifies the Etag header option with a response, then the client SHOULD specify a matching Etag header option in their GET request during cache refresh.  If the end-point's version of the resource is unmodified, then the server SHOULD return a 304 response with no payload to avoid retransmitting the resource representation.
    
</p>
<a name="proxying"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Proxying</h3>

<p>
	A proxy is defined as a CoAP end-point which services cached requests on behalf of other CoAP end-points.  Any node in a CoAP network may act as a proxy, although in general the node between the constrained network and the Internet at large SHOULD always support proxy functionality.
	
</p>
<p>
	Proxies should be used under the following scenarios:
	</p>
<ul class="text">
<li>Clients external to the constrained network SHOULD always make requests through a proxy to limit traffic on the constrained network
</li>
<li>Clients internal to the constrained network MAY use a proxy based on network topology when performance warrants
</li>
<li>Clients of sleeping devices MUST use a proxy to access resources while the device is sleeping
</li>
</ul><p>  
	
</p>
<p>
	Proxy requests are made as normal CON requests to the proxy end-point. All proxy requests MUST use the Uri-Authority header to indicate the origin server's IP address using the URI format defined by RFC 3986:
	
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

  full uri  = "coap://" + authority + path
  authority = host [ ":" port ]
  host      = IP-literal / IPv4address / reg-name
              (as defined by RFC 3986)
  port      = *DIGIT

</pre></div>
<p>
	The host part is case insensitive and may be an IPv4 literal, IPv6 literal in square brackets, or a registered name.  The port number is optional, if omitted or zero-length it is assumed to be the default CoAP port (see <a class='info' href='#port'>Section&nbsp;4.4<span> (</span><span class='info'>Default Port</span><span>)</span></a>).  
	
</p>
<p>If a request is made using the Uri-Authority header, then the following steps are taken:
	</p>
<blockquote class="text">
<p>1.  If the authority (host and port) is the same as the proxy end-point, then the request MUST be treated as a local request and the path part is used as Uri-Path
</p>
<p>2.  If the end-point does not support proxy functionality for the given URI or Method code, then the 400 Bad Request (TBD) error code MUST be returned
</p>
<p>3.  If the proxy does not contain a fresh cached representation of the resource, then the proxy MUST attempt to refresh its cache according to section 5.2.  The origin server's IP address and port is determined by the authority part of the full URI.  The Uri-Path option for the refresh request is determined by the path part of the full URI.
</p>
<p>4.  If the proxy fails to obtain a fresh cached representation, then a 502 Bad Gateway error code MUST be returned
</p>
<p>5.  The proxy returns the cached representation on behalf of the origin server
</p>
</blockquote><p>
	
</p>
<p>
	All CoAP options are considered end-to-end and MUST be stored as part of the cache entry and MUST be transmitted in the proxy's response.  The Max-Age option should be adjusted by the proxy for each response using the formula: proxy-max-age = original-max-age - cache-age. For example if a request is made to a proxied resource that was refreshed 20sec ago and had an original Max-Age of 60sec, then that resource's proxied Max-Age is now 40sec.
    
</p>
<a name="discovery"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Resource Discovery</h3>

<p>
  The discovery of resources offered by a CoAP end-point is extremely important in machine-to-machine applications where there are no humans in the loop and static interfaces result in fragility. The discovery of resources provided by an HTTP Web Server is typically called Web Discovery. In this document we refer to the discovery of resources offered by a CoAP end-point as resource discovery. CoAP resource discovery enables both unicast and multicast discovery of resources including filtering on attributes of resource descriptions. CoAP resource discovery can also be used to discovery HTTP resources. 
  
</p>
<p>
  CoAP makes the assumption that all CoAP servers host an end-point on the default CoAP port (see <a class='info' href='#port'>Section&nbsp;4.4<span> (</span><span class='info'>Default Port</span><span>)</span></a>) hosting a well-known discovery resource, or otherwise have been configured or discovered using some general service discovery mechanism such as <a class='info' href='#I-D.cheshire-dnsext-dns-sd'>[I&#8209;D.cheshire&#8209;dnsext&#8209;dns&#8209;sd]<span> (</span><span class='info'>Cheshire, S. and M. Krochmal, &ldquo;DNS-Based Service Discovery,&rdquo; March&nbsp;2010.</span><span>)</span></a>. This section assumes that such a configuration or service discovery has already been performed a priori, if needed.
  
</p>
<p>
  Resource discovery in CoAP is accomplished through the use of well-known resources which describe the links (resource descriptions) offered by that CoAP server. Well-known resources use the URI form "/.well-known/" as specified in <a class='info' href='#RFC5785'>[RFC5785]<span> (</span><span class='info'>Nottingham, M. and E. Hammer-Lahav, &ldquo;Defining Well-Known Uniform Resource Identifiers (URIs),&rdquo; April&nbsp;2010.</span><span>)</span></a>.  CoAP discovery defines a new well-known URI for discovery "/.well-known/r" [IANA_TBD_WELLKNOWN]. A CoAP end-point MUST support this URI for the purpose of resource discovery. It is however up to the application which resources descriptions are included and how they are organized. The resource representation of this resource is described in <a class='info' href='#link_format'>Section&nbsp;6.1<span> (</span><span class='info'>Link Format</span><span>)</span></a>.
  
</p>
<p>
  CoAP Resource Discovery supports the following interactions:
    </p>
<ul class="text">
<li>[GET /.well-known/r] returns a list of links available from a CoAP server (if any). This request may be unicast or multicast.
</li>
<li>Filtering may be performed on any of the resource description attributes using a query string as specified in <a class='info' href='#discovery_filtering'>Section&nbsp;6.3<span> (</span><span class='info'>Query Filtering</span><span>)</span></a>. For example [GET /.well-known/r?n=Temperature] would return resources with the name Temperature.
      
</li>
<li>More capable end-points such as proxies could support a resource directory by requesting the resource descriptions of other end-points or accepting [POST /.well-known/r] messages from other CoAP end-points. This adds the resources of other end-points to a resource directory in which absolute URIs are included for the links. The details of such an entity are however out of scope for this document.
</li>
<li>CoAP may also be used to discovery HTTP resources or an HTTP server may use the well-known resource and link-format as discussed in <a class='info' href='#discovry_http'>Section&nbsp;6.4<span> (</span><span class='info'>HTTP Resource Discovery</span><span>)</span></a>. 
</li>
</ul><p>
  
</p>
<p>
  End-points with a large number of resources SHOULD include resource descriptions only for important collections and organize their resource descriptions into a hierarchy of link resources. This is done by including links in the /.well-known/r list which point to other resource lists, e.g. "&lt;/.well-known/r/s&gt;;n=Sensors;ct=40". Such a hierarchy SHOULD be under the /.well-known/r path.
  
</p>
<a name="link_format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Link Format</h3>

<p>
    CoAP resource discovery makes use of the HTTP Link Header format specified in <a class='info' href='#I-D.nottingham-http-link-header'>[I&#8209;D.nottingham&#8209;http&#8209;link&#8209;header]<span> (</span><span class='info'>Nottingham, M., &ldquo;Web Linking,&rdquo; April&nbsp;2010.</span><span>)</span></a> which is in Augmented Backus-Naur Form (ABNF) notation <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>. This specification allows for the use of this simple link format by other protocols, thus not limiting it to the actual HTTP Link Header. The format does not require special XML or binary parsing, and is extensible. The format is also compatible with the naming and descriptions used in <a class='info' href='#I-D.cheshire-dnsext-dns-sd'>[I&#8209;D.cheshire&#8209;dnsext&#8209;dns&#8209;sd]<span> (</span><span class='info'>Cheshire, S. and M. Krochmal, &ldquo;DNS-Based Service Discovery,&rdquo; March&nbsp;2010.</span><span>)</span></a>. 
    
</p>
<p>
    <a class='info' href='#I-D.nottingham-http-link-header'>[I&#8209;D.nottingham&#8209;http&#8209;link&#8209;header]<span> (</span><span class='info'>Nottingham, M., &ldquo;Web Linking,&rdquo; April&nbsp;2010.</span><span>)</span></a> did not request a MIME type for this link format, as it assumes that would usually be carried in an HTTP header. This specification thus requests a MIME type for this header as in <a class='info' href='#appendix_content'>Section&nbsp;11.2<span> (</span><span class='info'>Content Types</span><span>)</span></a> [IANA_TBD_LINK].
    
</p>
<p>
    The CoAP link-format defines default attributes for CoAP resource discovery. All link parameters are optional and custom link-extensions MAY be defined.  Multiple descriptions are separated by commas as in <a class='info' href='#I-D.nottingham-http-link-header'>[I&#8209;D.nottingham&#8209;http&#8209;link&#8209;header]<span> (</span><span class='info'>Nottingham, M., &ldquo;Web Linking,&rdquo; April&nbsp;2010.</span><span>)</span></a>. The following ABNF specification defines the format:
    
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   link-value        = "&lt;" URI-Reference "&gt;" *( ";" link-param )
   link-param        = ( ( "d" "=" URI )
                     | ( "sh" "=" URI )
                     | ( "n" "=" string )
                     | ( "ct" "=" media-code *( "," media-code ) )
                     | ( "id" "=" integer )
                     | ( link-extension ) )
   link-extension    = ( parmname [ "=" ( ptoken | string ) ] )
   ptoken            = 1*ptokenchar
   ptokenchar        = "!" | "#" | "$" | "%" | "&amp;" | "'" | "("
                     | ")" | "*" | "+" | "-" | "." | "/" | DIGIT
                     | ":" | "&lt;" | "=" | "&gt;" | "?" | "@" | ALPHA
                     | "[" | "]" | "^" | "_" | "`" | "{" | "|"
                     | "}" | "~"
   media-code        = Identifier for media type in decimal ASCII,
                       see Section 11.2
   URI-reference     = Imported from [RFC3986]
   URI               = Imported from [RFC3986]

</pre></div>
<p>
       </p>
<blockquote class="text"><dl>
<dt>link-value:</dt>
<dd>
         The link-value is the relative URI of the resource on that end-point or an absolute full URI in the case of e.g. a directory agent or HTTP resource. The key "uri=" is used to match this field in a query string. Protocol identifier, host and port parts of the URI MAY be included if they differ from the default CoAP values.
         
</dd>
<dt>d:</dt>
<dd>
         Description. A URI that points to the definition of that resource interface, for example in WADL.
         
</dd>
<dt>sh:</dt>
<dd>
         Short URI. Alternative short URI which can also be used to access this resource.
         
</dd>
<dt>n:</dt>
<dd>
         Instance Name. See <a class='info' href='#discovery_naming'>Section&nbsp;6.2<span> (</span><span class='info'>Naming</span><span>)</span></a>.
         
</dd>
<dt>ct:</dt>
<dd>
         Content-type. The Internet media type this resource returns in the CoAP identifier code format as a decimal ASCII integer as per <a class='info' href='#appendix_content'>Section&nbsp;11.2<span> (</span><span class='info'>Content Types</span><span>)</span></a>. For example application/xml would be indicated as "ct=41". If a resource supports multiple content-types they can be separated by a comma in this attribute. If no Content-type attribute is present then text/plain is assumed. 
         
</dd>
<dt>id:</dt>
<dd>
         Unique Identifier. The id field is a unique identifier (e.g. UUID) for this resource for use in e.g. search directories.
         
</dd>
</dl></blockquote><p>
    
</p>
<p>
  An example of three typical CoAP link descriptions in this format follows. Multiple resource descriptions in a representation are separated by commas. Linefeeds are included in the example just for readability. 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;/&gt;;n=Info,
&lt;/sensor/temp&gt;;sh=/t;ct=0,41;n=Temperature,
&lt;/sensor/light&gt;;sh=/l;ct=41;n=Light,
</pre></div>
<a name="discovery_naming"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Naming</h3>

<p>
	CoAP resource naming is designed to be compatible with DNS-based Service Discovery naming. The n= attribute carries what can be considered the "Instance" part of a DNS-SD name. The "Service" and "Domain" parts of DNS naming are implied as Service is assumed to be "_coap._udp" and Domain is assumed to be .local. The Service part MAY be included as _http._tcp in the case of an HTTP resource. The Domain MAY be included if different than .local.
	
</p>
<p>Whereas service discovery is used to find the IP address, port and protocol of an unknown service, resource discovery is a fine-grained discovery of resource URIs within a web service. CoAP resource descriptions can be imported into DNS-SD for exposure to service discovery by using the n= attribute as the "Instance", "_coap_udp" as the Service and a default of ".local" as the Domain. The DNS TXT record can be generated by importing the resource description attributes as they share the same format as Section 6 of <a class='info' href='#I-D.cheshire-dnsext-dns-sd'>[I&#8209;D.cheshire&#8209;dnsext&#8209;dns&#8209;sd]<span> (</span><span class='info'>Cheshire, S. and M. Krochmal, &ldquo;DNS-Based Service Discovery,&rdquo; March&nbsp;2010.</span><span>)</span></a>. 
	
</p>
<a name="discovery_filtering"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Query Filtering</h3>

<p>
	A CoAP end-point SHOULD support the query string /.well-known/r? with uri= or any of the resource description attributes for the purpose of filtering a discovery. Wildcard * endings SHOULD be supported. An exact match is performed on the query string, and a 200 OK response is returned with a link-style structure that contains the matching entries (if any). If resource descriptions are organized hierarchically, a query on the root resource /.well-known/r SHOULD return all matching resource descriptions from the entire hierarchy if possible.
	
</p>
<p>
	For a unicast query with no matching entries a 404 Not Found code is returned, however no response is sent in case of a multicast query as described in <a class='info' href='#multicast'>Section&nbsp;4.1<span> (</span><span class='info'>Multicast</span><span>)</span></a> to prevent a flood of responses.	
	
</p>
<a name="discovry_http"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
HTTP Resource Discovery</h3>

<p>
	This mechanism may also be used to discover HTTP resources as HTTP lacks a built-in discovery mechanism and multicast support. When HTTP resources are listed in the link-format HTTP they SHOULD be indicated by including http:// in the link-value field or the _http._tcp Service in the name attribute. 
	
</p>
<p>
	An HTTP server may make use of the /.well-known/r URI scheme and link-format representation defined in this section for the purpose of discovery using HTTP. This may especially be useful for a CoAP-HTTP proxy to expose the resources available in a constrained domain to HTTP clients.
	
</p>
<a name="http"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
HTTP Mapping</h3>

<p>
  CoAP supports a limited subset of HTTP functionality, and thus a mapping to HTTP is straightforward. There might be several reasons for mapping between CoAP and HTTP, for example when designing a REST interface for use over either protocol or when realizing a CoAP-HTTP proxy. Likewise, CoAP could equally be mapped to other protocols such as XMPP or SIP, the definition of which is out of scope. 
  
</p>
<p>
  The mapping of CoAP to HTTP is a straightforward conversion of the CoAP method or response code, content-type and options to the corresponding HTTP feature. The payload is carried in an equivalent way by both protocols. The mapping of HTTP to CoAP requires checking for methods, response codes, options and content-types that are not supported by CoAP. A mapping SHOULD attempt to map options, response codes and content-types to a suitable alternative if possible. Otherwise the unsupported feature SHOULD be silently dropped if possible, or an appropriate error code generated otherwise.
  
</p>
<p>
  The caching and proxying of CoAP is specified in <a class='info' href='#caching'>Section&nbsp;5<span> (</span><span class='info'>Caching</span><span>)</span></a>. In a similar manner, caching and proxying MAY be performed between CoAP and HTTP by an intermediate node. A proxy SHOULD respond with a 502 (Bad Gateway) error to HTTP requests which can not be successfully mapped to CoAP. CoAP transaction messages are transparent to REST and MUST have no affect on a proxy function.
  
</p>
<a name="constants"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Protocol Constants</h3>

<p>
    This section defines the relevant protocol constants defined in this document:

         </p>
<blockquote class="text"><dl>
<dt>RESPONSE_TIMEOUT</dt>
<dd>1 second
</dd>
<dt>MAX_RETRANSMIT</dt>
<dd>5
</dd>
</dl></blockquote><p>
  
</p>
<a name="examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Examples</h3>

<p>
  <a class='info' href='#fig-example-1'>Figure&nbsp;7<span> (</span><span class='info'>Basic request/response</span><span>)</span></a> shows a basic request sequence. A client makes a Confirmable GET request for the resource /temperature to the server with a Transaction ID of 1234. The request includes one Uri-Path Option (delta 0 + 9 = 9) "temperature" of Len = 11. This request is a total of 16 octets long. The corresponding Acknowledgment is of Code 200 OK and includes a Payload of "22.3 C". The Transaction ID is 1234, thus the transaction is successfully completed. The response is 10 octets long and a Content-type of 0 (text/plain) is assumed as there is no Content-type Option.
  
</p><br /><hr class="insert" />
<a name="fig-example-1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

CLIENT                                                     SERVER
  |                                                          |
  |    ----- CON + GET /temperature [TID=1234]  ------&gt;      |
  |                                                          |


 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| 1 | 0 |   1   |    GET = 1    |           TID=1234            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   9   |   11  |       "temperature" (11 Octets) ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+



CLIENT                                                     SERVER
  |                                                          |
  |       &lt;-------- ACK + 200 OK [TID=1234] ---------        |
  |                                                          |


 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| 1 | 2 |   0   |    Code=80    |           TID=1234            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    "22.3 C" (6 Octets) ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: Basic request/response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
  <a class='info' href='#fig-example-2'>Figure&nbsp;8<span> (</span><span class='info'>Basic request/response</span><span>)</span></a> shows an example of a retransmission using the previous request. The first ACK from the server is lost, and after RESPONSE_TIMEOUT seconds the client retransmits the request.
  
</p><br /><hr class="insert" />
<a name="fig-example-2"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

CLIENT                                                     SERVER
  |                                                          |
  |    ----- CON + GET /temperature [TID=1234]  ------&gt;      |
  |                                                          |
  |                           X------------------------      |
  |                                                          |
                      RESPONSE_TIMEOUT
  |                                                          |
  |    ----- CON + GET /temperature [TID=1234]  ------&gt;      |
  |                                                          |
  |                                                          |
  |       &lt;-------- ACK + 200 OK [TID=1234] ---------        |
Payload:
22.3 C


</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: Basic request/response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
  <a class='info' href='#fig-example-3'>Figure&nbsp;9<span> (</span><span class='info'>Basic request/response</span><span>)</span></a> shows an example of resource discovery. Here a unicast GET request is made to the server for /.well-known/r, which returns a list of two resource descriptions. The client then decides to make a request for the short URI of /sensor/light (/l). Requesting /sensors/light would result in the same representation.
  
</p><br /><hr class="insert" />
<a name="fig-example-3"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

CLIENT                                                     SERVER
  |                                                          |
  |   ----- CON + GET /.well-known/r [TID=5068]  ------&gt;     |
  |                                                          |
  |      &lt;----- ACK + 200 OK [TID=5068, CT=40] ------        |
Payload:
&lt;/sensor/temp&gt;;sh=/t;ct=0,41;n=Temperature,
&lt;/sensor/light&gt;;sh=/l;ct=41;n=Light

  |                                                          |
  |          ----- CON + GET /l [TID=5069]  ------&gt;          |
  |                                                          |
  |        &lt;---- ACK + 200 OK [TID=5069, CT=41] -----        |
Payload:
&lt;?xml?&gt;&lt;Light unit="Lux"&gt;45&lt;/Light&gt;

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: Basic request/response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
<a class='info' href='#fig-example-4'>Figure&nbsp;10<span> (</span><span class='info'>Basic request/response</span><span>)</span></a> shows an example of multicast resource discovery. Here a client sends a request for /.well-known/r with a query for ?n=Light (Resource name = Light) to all-nodes link-scope multicast. There are 3 servers on the link: A, B and C. Servers A and B have a matching resource, therefore they send back a successful 200 OK response with the matching resource in the payload. C does not attempt to send a response.
</p><br /><hr class="insert" />
<a name="fig-example-4"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

CLIENT                                                    FF02::1
  |                                                          |
  |  --- CON + GET /.well-known/r?n=Light [TID=7000]  ---&gt;   |
  |                                                          |
  |      &lt;----- ACK + 200 OK [TID=7000, CT=40] ------     SERVER A
Payload:
&lt;/sensor/light&gt;;sh=/l;ct=41;n=Light

  |                                                          |
  |      &lt;----- ACK + 200 OK [TID=7000, CT=40] ------     SERVER B
Payload:
&lt;/light&gt;;ct=41;n=Light


</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: Basic request/response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p> 
         TODO: Expand this section to a full security analysis, including how to use CoAP with various security options.
         
</p>
<p>
         Some of the features considered in this document will need further security considerations during a protocol design. For example the use of string URLs may have entail security risks due to complex processing on limited microcontroller implementations.
         
</p>
<p>
     	 The CoAP protocol will be designed for use with e.g. (D)TLS, IPsec or object security. A protocol design should consider how integration with these security methods will be done, how to secure the CoAP header and other implications.
     	 
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
IANA Considerations</h3>

<p>
         [IANA_TBD_SCHEME] This document suggests the scheme coap:// to identify this protocol in a URI. The string "coap" should similarly be used in well-known port and service discovery registrations.
        
</p>
<p>
         [IANA_TBD_PORT] Apply for a well-known port number in the 0-1023 space as CoAP end-points are usually executed by an operating system or root process. http://www.iana.org/assignments/port-numbers
     	
</p>
<p>
     	 [IANA_TBD_MIME] A new registry is required for the Internet MIME type identifier space for CoAP as described in <a class='info' href='#appendix_content'>Section&nbsp;11.2<span> (</span><span class='info'>Content Types</span><span>)</span></a>.
     	
</p>
<p>
     	 [IANA_TBD_LINK] MIME type for link format, application/link-format to be requested. 
     	
</p>
<p>
     	 [IANA_TBD_WELLKNOWN] Apply for a well-known URI for the purpose of resource discovery at /.well-known/r as per <a class='info' href='#RFC5785'>[RFC5785]<span> (</span><span class='info'>Nottingham, M. and E. Hammer-Lahav, &ldquo;Defining Well-Known Uniform Resource Identifiers (URIs),&rdquo; April&nbsp;2010.</span><span>)</span></a>.
     	
</p>
<a name="appendix_codes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
Codes</h3>

<p>
  CoAP makes use of (a subset of) the HTTP status codes defined in <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>. The HTTP status code is encoded into an 8-bit unsigned integer code with the mapping defined in <a class='info' href='#tab-codes'>Table&nbsp;3<span> (</span><span class='info'>CoAP Codes</span><span>)</span></a>. The use of these codes is defined throughout this document using the HTTP Name.
  
</p><br /><hr class="insert" />
<a name="tab-codes"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Code</th><th align="left">HTTP Name</th></tr>
<tr>
<td align="left">40</td>
<td align="left">100 Continue</td>
</tr>
<tr>
<td align="left">80</td>
<td align="left">200 OK</td>
</tr>
<tr>
<td align="left">81</td>
<td align="left">201 Created</td>
</tr>
<tr>
<td align="left">124</td>
<td align="left">304 Not Modified</td>
</tr>
<tr>
<td align="left">160</td>
<td align="left">400 Bad Request</td>
</tr>
<tr>
<td align="left">164</td>
<td align="left">404 Not Found</td>
</tr>
<tr>
<td align="left">165</td>
<td align="left">405 Method Not Allowed</td>
</tr>
<tr>
<td align="left">175</td>
<td align="left">415 Unsupported Media Type</td>
</tr>
<tr>
<td align="left">&nbsp;</td>
<td align="left">&nbsp;</td>
</tr>
<tr>
<td align="left">200</td>
<td align="left">500 Internal Server Error</td>
</tr>
<tr>
<td align="left">202</td>
<td align="left">502 Bad Gateway</td>
</tr>
<tr>
<td align="left">204</td>
<td align="left">504 Gateway Timeout</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 3: CoAP Codes&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="appendix_content"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
Content Types</h3>

<p>
  Internet media types are identified by a string in HTTP, such as "application/xml". This string is made up of a top-level type "application" and a sub-type "xml" <a class='info' href='#RFC2046'>[RFC2046]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types,&rdquo; November&nbsp;1996.</span><span>)</span></a>. In order to minimize the overhead of using these media types to indicate the type of message payload, CoAP defines an identifier encoding scheme for a subset of Internet media types. It is expected that this table of identifiers will be extensible and maintained by IANA for values of 0-200 [IANA_TBD_MIME].
  
</p>
<p>
  The Content-type Option is formatted as an 8-bit unsigned integer. Initial mappings from Internet media types to a suitable identifier is shown in <a class='info' href='#tab-mediatype'>Table&nbsp;4<span> (</span><span class='info'>Media type identifiers</span><span>)</span></a>. Composite high-level types (multipart and message) are not supported. Identifier values from 201-255 are reserved for vendor specific, application specific or experimental use and are not maintained by IANA.  
  
</p><br /><hr class="insert" />
<a name="tab-mediatype"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Internet media type</th><th align="left">Identifier</th></tr>
<tr>
<td align="left">text/plain (UTF-8)</td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">text/xml (UTF-8)</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">text/csv (UTF-8)</td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">text/html (UTF-8)</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">image/gif</td>
<td align="left">21</td>
</tr>
<tr>
<td align="left">image/jpeg</td>
<td align="left">22</td>
</tr>
<tr>
<td align="left">image/png</td>
<td align="left">23</td>
</tr>
<tr>
<td align="left">image/tiff</td>
<td align="left">24</td>
</tr>
<tr>
<td align="left">audio/raw</td>
<td align="left">25</td>
</tr>
<tr>
<td align="left">video/raw</td>
<td align="left">26</td>
</tr>
<tr>
<td align="left">application/link-format [IANA_TBD_LINK]</td>
<td align="left">40</td>
</tr>
<tr>
<td align="left">application/xml</td>
<td align="left">41</td>
</tr>
<tr>
<td align="left">application/octet-stream</td>
<td align="left">42</td>
</tr>
<tr>
<td align="left">application/rdf+xml</td>
<td align="left">43</td>
</tr>
<tr>
<td align="left">application/soap+xml</td>
<td align="left">44</td>
</tr>
<tr>
<td align="left">application/atom+xml</td>
<td align="left">45</td>
</tr>
<tr>
<td align="left">application/xmpp+xml</td>
<td align="left">46</td>
</tr>
<tr>
<td align="left">application/exi</td>
<td align="left">47</td>
</tr>
<tr>
<td align="left">application/x-bxml</td>
<td align="left">48</td>
</tr>
<tr>
<td align="left">application/fastinfoset</td>
<td align="left">49</td>
</tr>
<tr>
<td align="left">application/soap+fastinfoset</td>
<td align="left">50</td>
</tr>
<tr>
<td align="left">application/json</td>
<td align="left">51</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 4: Media type identifiers&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Acknowledgments</h3>

<p>
Special thanks to Carsten Bormann and Klaus Hartke for substantial contributions to the ideas and text in the document (<a class='info' href='#synchronous-response'>Section&nbsp;2.1.1<span> (</span><span class='info'>Synchronous response</span><span>)</span></a>, <a class='info' href='#asynchronous-response'>Section&nbsp;2.1.2<span> (</span><span class='info'>Asynchronous response</span><span>)</span></a>, <a class='info' href='#transactions'>Section&nbsp;2.2<span> (</span><span class='info'>Transaction messages</span><span>)</span></a>, <a class='info' href='#options'>Section&nbsp;3.2<span> (</span><span class='info'>Header options</span><span>)</span></a>), along with countless detailed reviews and discussions.

</p>
<p>Thanks to Michael Stuber, Richard Kelsey, Cullen Jennings, Guido Moritz, Peter Van Der Stok, Adriano Pezzuto, Lisa Dussealt, Alexey Melnikov, Gilbert Clark, Salvatore Loreto, Petri Mutka, Szymon Sasin, Robert Quattlebaum, Robert Cragie, Angelo Castellani, Tom Herbst, Ed Beroset, Gilman Tolle, Robby Simpson, Peter Bigot, Colin O'Flynn and David Ryan for helpful comments and discussions that have shaped the document.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Changelog</h3>

<p>Changes from ietf-00 to ietf-01:
      </p>
<blockquote class="text">
<p>o New cleaner transaction message model and header (#5)
</p>
<p>o Removed subscription while being designed (#1)
</p>
<p>o Section 2 re-written (#3)
</p>
<p>o Text added about use of short URIs (#4)
</p>
<p>o Improved header option scheme (#5, #14)
</p>
<p>o Date option removed whiled being designed (#6)
</p>
<p>o New text for CoAP default port (#7)
</p>
<p>o Completed proxying section (#8)
</p>
<p>o Completed resource discovery section (#9)
</p>
<p>o Completed HTTP mapping section (#10)
</p>
<p>o Several new examples added (#11)
</p>
<p>o URI split into 3 options (#12)
</p>
<p>o MIME type defined for link-format (#13, #16)
</p>
<p>o New text on maximum message size (#15)
</p>
<p>o Location Option added
</p>
</blockquote><p>
    
</p>
<p>Changes from shelby-01 to ietf-00:
      </p>
<blockquote class="text">
<p>o Removed the TCP binding section, left open for the future.
</p>
<p>o Fixed a bug in the example.
</p>
<p>o Marked current Sub/Notify as (Experimental) while under WG discussion.
</p>
<p>o Fixed maximum datagram size to 1280 for both IPv4 and IPv6 (for CoAP-CoAP proxying to work).
</p>
<p>o Temporarily removed the Magic Byte header as TCP is no longer included as a binding. 
</p>
<p>o Removed the Uri-code Option as different URI encoding schemes are being discussed.
</p>
<p>o Changed the rel= field to desc= for resource discovery.
</p>
<p>o Changed the maximum message size to 1024 bytes to allow for IP/UDP headers.
</p>
<p>o Made the URI slash optimization and method impotence MUSTs 
</p>
<p>o Minor editing and bug fixing.
</p>
</blockquote><p>
    
</p>
<p>Changes from shelby-00 to shelby-01:
      </p>
<blockquote class="text">
<p>o Unified the message header and added a notify message type.
</p>
<p>o Renamed methods with HTTP names and removed the NOTIFY method.
</p>
<p>o Added a number of options field to the header.
</p>
<p>o Combines the Option Type and Length into an 8-bit field.
</p>
<p>o Added the magic byte header.
</p>
<p>o Added new Etag option.
</p>
<p>o Added new Date option.
</p>
<p>o Added new Subscription option.
</p>
<p>o Completed the HTTP Code - CoAP Code mapping table appendix.
</p>
<p>o Completed the Content-type Identifier appendix and tables.
</p>
<p>o Added more simplifications for URI support.
</p>
<p>o Initial subscription and discovery sections.
</p>
<p>o A Flag requirements simplified.
</p>
</blockquote><p>
    
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.nottingham-http-link-header">[I-D.nottingham-http-link-header]</a></td>
<td class="author-text">Nottingham, M., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-nottingham-http-link-header-09.txt">Web Linking</a>,&rdquo; draft-nottingham-http-link-header-09 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-nottingham-http-link-header-09.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2046">[RFC2046]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2046">Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</a>,&rdquo; RFC&nbsp;2046, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2046.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2616.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3986">[RFC3986]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>,&rdquo; STD&nbsp;66, RFC&nbsp;3986, January&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3986.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3986.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3986.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5785">[RFC5785]</a></td>
<td class="author-text">Nottingham, M. and E. Hammer-Lahav, &ldquo;<a href="http://tools.ietf.org/html/rfc5785">Defining Well-Known Uniform Resource Identifiers (URIs)</a>,&rdquo; RFC&nbsp;5785, April&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5785.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.cheshire-dnsext-dns-sd">[I-D.cheshire-dnsext-dns-sd]</a></td>
<td class="author-text">Cheshire, S. and M. Krochmal, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-cheshire-dnsext-dns-sd-06.txt">DNS-Based Service Discovery</a>,&rdquo; draft-cheshire-dnsext-dns-sd-06 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-cheshire-dnsext-dns-sd-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.eggert-core-congestion-control">[I-D.eggert-core-congestion-control]</a></td>
<td class="author-text">Eggert, L., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-eggert-core-congestion-control-00.txt">Congestion Control for the Constrained Application Protocol (CoAP)</a>,&rdquo; draft-eggert-core-congestion-control-00 (work in progress), June&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-eggert-core-congestion-control-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.shelby-6lowapp-encoding">[I-D.shelby-6lowapp-encoding]</a></td>
<td class="author-text">Shelby, Z., Luimula, M., and D. Peintner, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-shelby-6lowapp-encoding-00.txt">Efficient XML Encoding and 6LowApp</a>,&rdquo; draft-shelby-6lowapp-encoding-00 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-shelby-6lowapp-encoding-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.shelby-core-coap-req">[I-D.shelby-core-coap-req]</a></td>
<td class="author-text">Shelby, Z., Stuber, M., Sturek, D., Frank, B., and R. Kelsey, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-shelby-core-coap-req-01.txt">CoAP Requirements and Features</a>,&rdquo; draft-shelby-core-coap-req-01 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-shelby-core-coap-req-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4944">[RFC4944]</a></td>
<td class="author-text">Montenegro, G., Kushalnagar, N., Hui, J., and D. Culler, &ldquo;<a href="http://tools.ietf.org/html/rfc4944">Transmission of IPv6 Packets over IEEE 802.15.4 Networks</a>,&rdquo; RFC&nbsp;4944, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4944.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Zach Shelby</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sensinode</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kidekuja 2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Vuokatti  88600</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">FINLAND</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358407796297</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:zach@sensinode.com">zach@sensinode.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Brian Frank</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">SkyFoundry</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Richmond, VA  </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:brian@skyfoundry.com">brian@skyfoundry.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Don Sturek</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Pacific Gas & Electric</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">77 Beale Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Francisco, CA  </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1-619-504-3615</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:d.sturek@att.net">d.sturek@att.net</a></td></tr>
</table>
</body></html>
