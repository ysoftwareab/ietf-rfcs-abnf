<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Use of DNS SRV and NAPTR Records for SPEERMINT</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Use of DNS SRV and NAPTR Records for SPEERMINT">
<meta name="keywords" content="RFC, Request for Comments, I-D, Internet-Draft, XML, Extensible Markup Language">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SPEERMINT</td><td class="header">T. Creighton</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">J. Livingood</td></tr>
<tr><td class="header">Intended status: BCP</td><td class="header">Comcast</td></tr>
<tr><td class="header">Expires: May 24, 2009</td><td class="header">November 20, 2008</td></tr>
</table></td></tr></table>
<h1><br />Use of DNS SRV and NAPTR Records for SPEERMINT<br />draft-ietf-speermint-srv-naptr-use-03</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 24, 2009.</p>

<h3>Abstract</h3>

<p>The objective of this document is to specify the Best Current Practice (BCP) adopted by a service provider providing multimedia communication services such as Voice over Internet Protocol(VoIP) in order to locate another service provider to peer with in the context of Session PEERing for Multimedia INTerconnect. 
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#ReqLang">1.</a>&nbsp;
Requirements Language<br />
<a href="#intro">2.</a>&nbsp;
Introduction<br />
<a href="#setup">3.</a>&nbsp;
Session Peering Setup<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#target_determination">3.1.</a>&nbsp;
Target Determination<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#naptr_lookup">3.2.</a>&nbsp;
NAPTR Lookup<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#srv_lookup">3.3.</a>&nbsp;
SRV Lookup<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#using_srv">3.4.</a>&nbsp;
Using SRV Results<br />
<a href="#ha">4.</a>&nbsp;
High Availability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#failure1">4.1.</a>&nbsp;
SBE1 Fails to Reach SBE2<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#failure2">4.2.</a>&nbsp;
Using SRV Results<br />
<a href="#caching_ttl">5.</a>&nbsp;
Caching/TTL<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#caching">5.1.</a>&nbsp;
Caching<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ttl">5.2.</a>&nbsp;
TTL<br />
<a href="#anchor1">6.</a>&nbsp;
Security Considerations<br />
<a href="#anchor2">7.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor3">8.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#anchor6">Appendix&nbsp;A.</a>&nbsp;
Document Changelog<br />
<a href="#anchor7">Appendix&nbsp;B.</a>&nbsp;
Open Issues<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="ReqLang"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p>A service provider needs to identify the ingress Session Initiation Protocol (SIP) (<a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261]) server of a peering network before it can signal and route SIP based real-time communication sessions. This function of locating the ingress SIP server of peering network is typically performed by the egress SIP server of the service provider originating the SIP session.  Also, the ingress server in the peering network needs to locate the originating service provider_s egress server in situations where the peering connection to it gets terminated after receiving the SIP requests or if the egress SIP server of originating service provider fails.  The SIP servers at originating and peering side use the DNS procedures, using both SRV <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> and <a class='info' href='#RFC3404'>NAPTR<span> (</span><span class='info'>Mealling, M., &ldquo;Dynamic Delegation Discovery System (DDDS) Part Four: The Uniform Resource Identifiers (URI),&rdquo; October&nbsp;2002.</span><span>)</span></a> [RFC3404] records, in order to locate each other. 
</p>
<a name="setup"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Session Peering Setup</h3>

<p>
				SIP systems are represented by user agents (UA).  The diagram below shows the case of direct peering where a user agent (UA1), hosted by a service provider SP1, initiates a SIP session to a User Agent (UA2), hosted by service provider SP2. The egress SIP server of SP1 is a SIP signaling path border element (SBE) as defined in section 3 of <a class='info' href='#SPEERMINT-Terminology'>[SPEERMINT&#8209;Terminology]<span> (</span><span class='info'>Malas, D. and D. Meyer, &ldquo;SPEERMINT Terminology,&rdquo; February&nbsp;2008.</span><span>)</span></a>, called SBE1, that interfaces with session peering service provider SP2. The SIP session initiated by UA1 is received by this network element SBE1.  The resource to which the SIP request needs to be routed by SBE1 is identified by a SIP or SIPS URI.  This could be the SIP URI of UA2 found in the Request-URI of the SIP request received by SBE1, or the next hop from SBE1 found in the topmost Route header of SIP request.  In order to determine the resource to route the request to, SP1 MAY make use of ENUM <a class='info' href='#RFC3761'>[RFC3761]<span> (</span><span class='info'>Faltstrom, P. and M. Mealling, &ldquo;The E.164 to Uniform Resource Identifiers (URI) Dynamic Delegation Discovery System (DDDS) Application (ENUM),&rdquo; April&nbsp;2004.</span><span>)</span></a> lookup services or an internal lookup to determine the SIP URI of the resource.  This lookup MAY be performed by SBE1 or another network element of SP1.
				
</p><br /><hr class="insert" />
<a name="direct-peering"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   ............................          .............................
   .                 +------+ .          . +------+                  .
   .                 |      | .          . |      |                  .
   .                 | SBE 1|--------------| SBE 2|                  .
   .               / |      | .          . |      | \                .
   .              /  +------+ .          . +------+  \               .
   .   +------+  /      ||    .          .    ||      \  +------+    .
   .   |      | /       ||    .          .    ||       \ |      |    .
   .   | UA 1 |         ||    .          .    ||         | UA 2 |    .
   .   |      |         ||    .          .    ||         |      |    .
   .   +------+         ||    .          .    ||         +------+    .
   .                +-------+ .          . +-------+                 .
   .                |       | .          . |       |                 .
   .                | DNS 1 | .          . | DNS 2 |                 .
   .                |       | .          . |       |                 .
   .                +-------+ .          . +-------+                 .
   .                          .          .                           .
   .                 SP 1     .          .      SP 2                 .
   ............................          .............................

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In order to route the SIP request to this resource in SP2, SBE1 needs to determine the ingress SIP signaling path border element for SP2, called SBE2, by resolving the SIP or SIPS URI in DNS.  SBE1 makes use of the NAPTR and DNS SRV mechanism defined in <a class='info' href='#RFC3263'>[RFC3263]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;Session Initiation Protocol (SIP): Locating SIP Servers,&rdquo; June&nbsp;2002.</span><span>)</span></a> to determine the IP address, port, and transport protocol for peering with the SP2 ingress SIP proxy server (i.e. SBE2).  SBE1 and SBE2 which are involved in the session peering, support a set of protocols and have list of preferences for these protocols. UDP, TCP and TLS MUST be supported by these proxies. 
</p>
<p>As a best current practice, SBE1 and SBE2 SHOULD be deployed in a highly scalable and highly available manner, such as a cluster of servers. These servers are of different prioritization and weight, to ensure capacity-based load balancing.
</p>
<p>The figure below shows the case of indirect/transit peering where SBE2 is the ingress SIP server of a transit service provider. The mechanism to locate SBE2 is the same as described for direct peering scenario. 
</p><br /><hr class="insert" />
<a name="indirect-peering"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   ............................     ..............     .             .
   .                 +------+ .     . +------+   .     .             .
   .                 |      | .     . |      |   .     .             .
   .                 | SBE 1|---------| SBE 2|   .     .             .
   .               / |      | .     . |      |   .     .             .
   .              /  +------+ .     . +------+   .     .             .
   .   +------+  /      ||    .     .    ||      .     . +------+    .
   .   |      | /       ||    .     .    ||      .     . |      |    .
   .   | UA 1 |         ||    .     .    ||      .     . | UA 2 |    .
   .   |      |         ||    .     .    ||      .     . |      |    .
   .   +------+         ||    .     .    ||      .     . +------+    .
   .                +-------+ .     . +-------+  .     .             .
   .                |       | .     . |       |  .     .             .
   .                | DNS 1 | .     . | DNS 2 |  .     .             .
   .                |       | .     . |       |  .     .             .
   .                +-------+ .     . +-------+  .     .             .
   .                          .     .            .     .             .
   .                 SP 1     .     . Transit SP .     .    SP 2     .
   ............................     ..............      ...............

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The figure below shows a high level SIP call flow setting up a direct SIP peering session between SP1 and SP2. In this call flow a VoIP session is eastablished between a caller, Bob (sip:bob@sp.com), in SP1 and callee, Alice(sip:alice@sp2.com), in SP2 using SIP INVITE request. All SIP signaling MUST go through the SBE1 and SBE2 as these are the ingress and egress points in SP1 and SP2 network. 
</p><br /><hr class="insert" />
<a name="call-flow"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

             Bob(UA 1)  SBE 1  DNS 1  DNS 2  SBE 2 Alice(UA 2)
                  |      |      |      |      |      |
                  |INVITE|      |      |      |      |
                  |-----&gt;|      |      |      |      |
                  |    NAPTR Query     |      |      |
                  |      |-----&gt;|      |      |      |
                  |    NAPTR Response  |      |      |
                  |      |&lt;-----|      |      |      |
                  |     SRV Query      |      |      |
                  |      |-----&gt;|      |      |      |
                  |     SRV Response   |      |      |
                  |      |&lt;-----|      |      |      |
                  |      A Query       |      |      |
                  |      |-----&gt;|      |      |      |
                  |      A Response    |      |      |
                  |      |&lt;-----|      |      |      |
                  |      |       INVITE       |      |
                  |      |-------------------&gt;|      |
                  |      |      |      |      |INVITE|
                  |      |      |      |      |-----&gt;|
                  |      |      |      |      |200 OK|
                  |      |      |      |      |&lt;-----|
                  |      |       200 OK       |      |
                  |      |&lt;-------------------|      |
                  |200 OK|      |      |      |      |
                  |&lt;-----|      |      |      |      |
                  | ACK  |      |      |      |      |
                  |-----&gt;|      |      |      |      |
                  |      |        ACK         |      |
                  |      |-------------------&gt;|      |
                  |      |      |      |      | ACK  |
                  |      |      |      |      |-----&gt;|
                  |            2-Way Media           |
                  |&lt;================================&gt;|
                  |      |      |      |      |      |
                  |      |      |      |      |      |

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The target, to which the request is sent, is determined by SBE1 as follows: 
</p>
<a name="target_determination"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Target Determination</h3>

<p>The target resource is identified with a SIP or SIPS URI.  This is the URI in the Route header, if present, or the URI from the request URI of the SIP request received by SBE1.  The host value of the hostport component of the URI is the TARGET. This TARGET is the domain to be contacted. The NAPTR/SRV/A lookup as described in the following section should be skipped if transport/port/ip address is already specified for the target URI. 
</p>
<a name="naptr_lookup"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
NAPTR Lookup</h3>

<p>Next the SBE1 determines the transport protocol of the TARGET by performing a NAPTR query for the TARGET.  NAPTR processing as described in <a class='info' href='#RFC2915'>[RFC2915]<span> (</span><span class='info'>Mealling, M. and R. Daniel, &ldquo;The Naming Authority Pointer (NAPTR) DNS Resource Record,&rdquo; September&nbsp;2000.</span><span>)</span></a> will result in the discovery of the most preferred transport protocol of a server instance of SBE2 and SRV records.  
</p>
<p>Considering our example call flow setup above, SBE1 wishes to resolve sip:alice@sp2.com and performs a NAPTR query for that TARGET domain sp2.com, and the following NAPTR records are returned: 
</p><br /><hr class="insert" />
<a name="naptr-lookup-data"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
;         order     pref    flags   service         regexp   replacement
IN NAPTR    50       50      "s"    "SIPS+D2T"   ""  _sips._tcp.sp2.com
IN NAPTR    90       50      "s"    "SIP+D2T"    ""  _sip._tcp.sp2.com
IN NAPTR   100       50      "s"    "SIP+D2U"    ""  _sip._udp.sp2.com
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>DNS MUST return at least three records - one with "SIP+D2T", one with "SIP+D2U" and one with "SIPS+D2T" service type for the case of direct and indirect peering (section 4.3 in <a class='info' href='#SPEERMINT-Terminology'>[SPEERMINT&#8209;Terminology]<span> (</span><span class='info'>Malas, D. and D. Meyer, &ldquo;SPEERMINT Terminology,&rdquo; February&nbsp;2008.</span><span>)</span></a>). For indirect (transit) peering (section 4.4 in <a class='info' href='#SPEERMINT-Terminology'>[SPEERMINT&#8209;Terminology]<span> (</span><span class='info'>Malas, D. and D. Meyer, &ldquo;SPEERMINT Terminology,&rdquo; February&nbsp;2008.</span><span>)</span></a>) since domain validation as specified in 
   section 26.3.2.2 of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> for TLS at layer 5 will not work, SIPS over TLS cannot be used. 
</p>
<a name="srv_lookup"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
SRV Lookup</h3>

<p>Depending on what transport protocols SBE1 supports, SBE1 selects one from the preference list of NAPTR results and performs the SRV lookup to obtain a list of available server instances for SBE2. TLS SHOULD be the preferred transport protocol for peering between SBE1 and SBE2.  
</p>
<p> In our example SBE1 uses TCP, the SRV lookup for _sip._tcp.sp2.com would return list of available servers : 
</p><br /><hr class="insert" />
<a name="srv-lookup-data"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
;;    Priority Weight   Port   Target
IN SRV  0        1      5060   server1.sp2.com
IN SRV  0        2      5060   server2.sp2.com
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Alternatively, if no NAPTR records are found, then SBE1 uses the preferred transport protocol and issues an SRV query for that specific transport using "sips" for SIPS URI and SIP URI with TLS and "sip" for SIP URI as the SRV domain prefix. 
</p>
<p> In our example, SBE1 prefers to use TCP and target SIP URI of SP2 is sip:alice@sp2.com, it sends a SRV query for _sip._tcp.sp2.com.  
</p>
<p>The SRV responses MAY also include A records with it.
</p>
<a name="using_srv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Using SRV Results</h3>

<p>If A records are not returned with the SRV responses, procedure from RFC 2782 describes how to use and interpret the results obtained from the SRV query.  The target entry of the SRV RRs is looked up by querying the DNS for address records. If the SRV response from DNS includes A records with it, it will cut down on round trips and lookup of DNS again for target entry. On determining the transport protocol, service, port and address record from the SRV RRs as described above, the SBE1 will try to connect to the (protocol, address, service).  Once the connection is established to an available instance of SBE2, SBE1 sends the SIP request to SBE2.  SBE1 MUST act in a stateful manner and any retransmission of SIP requests for a specific SIP transaction, including ACKS for non-2xx response or CANCEL for that SIP transaction MUST go to the same server instance of SBE2. 
</p>
<p>When SBE1 sends the SIP request to SBE2, it SHOULD set the sent-by parameter of the topmost Via header in the SIP request to a domain that identifies SBE1.  It MUST NOT specify the port. 
</p>
<a name="ha"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
High Availability</h3>

<p>High Availability is ensured by detecting failures in the ability to connect to SBE1 and SBE2 server instances.  In the event of a failure, when SBE1 tries to send SIP INVITE to SBE2, the following failures could occur:  
</p>
<a name="failure1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
SBE1 Fails to Reach SBE2</h3>

<p>A 503 error response is reported by the transaction layer, or failure can occur at the transport layer due to TCP disconnect in connection, ICMP error in UDP or time out at transport layer or SIP layer timeout when its not receiving any SIP response.  In such situations, SBE1 tries a new SIP request transaction to the next available server instance of SBE2 as determined by SRV RRs entry. The SIP T1 timer on SBE1 SHOULD be configurable with a upper limit value of 500ms. A shorter value of T1, say 100ms, reflects a faser failover support. 
</p>
<a name="failure2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Using SRV Results</h3>

<p>Failure may also occur after the request is received by SBE2 from SBE1 due to closure of the transport connection the request came in on at SBE2, before the response can be sent back to SBE1.  In this situation, SBE2 uses the domain value present in the 'sent-by' parameter in the top most Via header of the received SIP INVITE, and queries for SRV records at this domain name using the service identifier "_sips" if the Via transport is "TLS", "_sip" otherwise. The sorted list of SRV RRs are obtained and used as described in <a class='info' href='#RFC2782'>[RFC2782]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> to send the response back to SBE1.  If the topmost element in the list of server instances of SBE1 fails, the next available one is tried. 
</p>
<p>[FOR NEXT REV: SHOULD WE ADD CALL FLOW FOR FAILURE SCENARIO DESCRIBED IN 4.1 AND 4.2] 
</p>
<a name="caching_ttl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Caching/TTL</h3>

<a name="caching"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Caching</h3>

<p>SBE SHOULD use caching of DNS results to eliminate unnecessary DNS queries. 
</p>
<a name="ttl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
TTL</h3>

<p>SRV RRs have a TTL value based on which the SBE1 caches the entry for that duration, if it supports caching, and any further requests to the same TARGET domain are delivered to the cached server instance.  The TTL recommended for SRV is about 1 hr.  The TTL for NAPTR is much higher, about 1 day (24hrs) since the NAPTR records do not vary that often as compared to SRV. 
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>This document introduces no new security considerations.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>There are no IANA considerations in this document.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgements</h3>

<p>Special thanks go to Yiu Lee for his valuable input to this document. 
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2782">[RFC2782]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P., and <a href="mailto:levone@microsoft.com">L. Esibov</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782, February&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2782.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2915">[RFC2915]</a></td>
<td class="author-text">Mealling, M. and R. Daniel, &ldquo;<a href="http://tools.ietf.org/html/rfc2915">The Naming Authority Pointer (NAPTR) DNS Resource Record</a>,&rdquo; RFC&nbsp;2915, September&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2915.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3263">[RFC3263]</a></td>
<td class="author-text">Rosenberg, J. and H. Schulzrinne, &ldquo;<a href="http://tools.ietf.org/html/rfc3263">Session Initiation Protocol (SIP): Locating SIP Servers</a>,&rdquo; RFC&nbsp;3263, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3263.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3404">[RFC3404]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3404">Dynamic Delegation Discovery System (DDDS) Part Four: The Uniform Resource Identifiers (URI)</a>,&rdquo; RFC&nbsp;3404, October&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3404.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3667">[RFC3667]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc3667">IETF Rights in Contributions</a>,&rdquo; RFC&nbsp;3667, February&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3667.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3761">[RFC3761]</a></td>
<td class="author-text">Faltstrom, P. and M. Mealling, &ldquo;<a href="http://tools.ietf.org/html/rfc3761">The E.164 to Uniform Resource Identifiers (URI) Dynamic Delegation Discovery System (DDDS) Application (ENUM)</a>,&rdquo; RFC&nbsp;3761, April&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3761.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SPEERMINT-Terminology">[SPEERMINT-Terminology]</a></td>
<td class="author-text">Malas, D. and D. Meyer, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-speermint-terminology-16.txt">SPEERMINT Terminology</a>,&rdquo; February&nbsp;2008.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2434">[RFC2434]</a></td>
<td class="author-text"><a href="mailto:narten@raleigh.ibm.com">Narten, T.</a> and <a href="mailto:Harald@Alvestrand.no">H. Alvestrand</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2434">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;2434, October&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2434.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2434.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2434.xml">XML</a>).</td></tr>
</table>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Document Changelog</h3>

<p>[RFC Editor: This section is to be removed before publication]
</p>
<p>draft-ietf-speermint-srv-naptr-use-03:
        </p>
<ul class="text">
<li>jason: converted from MS Word template to XML
</li>
</ul><p>
      
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Open Issues</h3>

<p>Several in queue.  These will be dealt with shortly in -04, so please hold comments until that document is released.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tom Creighton</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Comcast Cable Communications</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">One Comcast Center</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1701 John F. Kennedy Boulevard</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Philadelphia, PA  19103</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:tom_creighton@cable.comcast.com">tom_creighton@cable.comcast.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.comcast.com">http://www.comcast.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jason Livingood</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Comcast Cable Communications</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">One Comcast Center</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1701 John F. Kennedy Boulevard</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Philadelphia, PA  19103</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jason_livingood@cable.comcast.com">jason_livingood@cable.comcast.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.comcast.com">http://www.comcast.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
