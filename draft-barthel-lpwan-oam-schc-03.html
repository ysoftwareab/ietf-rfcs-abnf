<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>OAM for LPWAN using Static Context Header Compression (SCHC)</title>
<meta content="Dominique Barthel" name="author">
<meta content="Laurent Toutain" name="author">
<meta content="Arunprabhu Kandasamy" name="author">
<meta content="Diego Dujovne" name="author">
<meta content="Juan Carlos Zuniga" name="author">
<meta content="
       With IP protocols now generalizing to constrained networks, users expect to be able to Operate, Administer and Maintain them 
    with the familiar tools and protocols they already use on less constrained networks. 
       OAM uses specific messages sent into the data plane to measure some parameters of a network.
    Most of the time, no explicit values are sent is these messages.
    Network parameters are obtained from the analysis of these specific messages. 
       This can be used: 
       
         To detect if a host is up or down. 
         To measure the RTT and its variation over time. 
         To learn the path used by packets to reach a destination. 
       
       OAM in LPWAN is a little bit trickier since the bandwidth is limited and
    extra traffic added by OAM can introduce perturbation on regular transmission. 
       Two scenarios can be investigated: 
       
         OAM coming from internet. In that case, the NGW should act as a proxy and handle specifically the OAM traffic. 
         OAM coming from LPWAN devices: This can be included into regular devices but some specific devices may be installed in the LPWAN network to measure its quality. 
       
       The primitive functionalities of OAM are achieved with the ICMPv6 protocol. 
       ICMPv6 defines messages that inform the source of IPv6 packets of errors during packet delivery.
    It also defines the Echo Request/Reply messages that are used for basic network troubleshooting (ping command).
    ICMPv6 messages are transported on IPv6. 
       This document describes
    how basic OAM is performed on Low Power Wide Area Networks (LPWANs)
    by compressing ICMPv6/IPv6 headers
    and by protecting the LPWAN network and the Device from undesirable ICMPv6 traffic. 
    " name="description">
<meta content="xml2rfc 3.12.0" name="generator">
<meta content="template" name="keyword">
<meta content="draft-barthel-lpwan-oam-schc-03" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.7.1
    pycountry 22.1.10
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-barthel-lpwan-oam-schc-03-j1qrr2pz.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">SCHC OAM for LPWAN</td>
<td class="right">February 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Barthel, et al.</td>
<td class="center">Expires 13 August 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">lpwan Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-barthel-lpwan-oam-schc-03</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-02-09" class="published">9 February 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-08-13">13 August 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">D. Barthel</div>
<div class="org">Orange SA</div>
</div>
<div class="author">
      <div class="author-name">L. Toutain</div>
<div class="org">IMT Atlantique</div>
</div>
<div class="author">
      <div class="author-name">A. Kandasamy</div>
<div class="org">Acklio</div>
</div>
<div class="author">
      <div class="author-name">D. Dujovne</div>
<div class="org">Universidad Diego Portales</div>
</div>
<div class="author">
      <div class="author-name">JC. Zuniga</div>
<div class="org">SIGFOX</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">OAM for LPWAN using Static Context Header Compression (SCHC)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">With IP protocols now generalizing to constrained networks, users expect to be able to Operate, Administer and Maintain them 
    with the familiar tools and protocols they already use on less constrained networks.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">OAM uses specific messages sent into the data plane to measure some parameters of a network.
    Most of the time, no explicit values are sent is these messages.
    Network parameters are obtained from the analysis of these specific messages.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
<p id="section-abstract-3">This can be used:<a href="#section-abstract-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-abstract-4.1">To detect if a host is up or down.<a href="#section-abstract-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-abstract-4.2">To measure the RTT and its variation over time.<a href="#section-abstract-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-abstract-4.3">To learn the path used by packets to reach a destination.<a href="#section-abstract-4.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-abstract-5">OAM in LPWAN is a little bit trickier since the bandwidth is limited and
    extra traffic added by OAM can introduce perturbation on regular transmission.<a href="#section-abstract-5" class="pilcrow">¶</a></p>
<p id="section-abstract-6">Two scenarios can be investigated:<a href="#section-abstract-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-abstract-7.1">OAM coming from internet. In that case, the NGW should act as a proxy and handle specifically the OAM traffic.<a href="#section-abstract-7.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-abstract-7.2">OAM coming from LPWAN devices: This can be included into regular devices but some specific devices may be installed in the LPWAN network to measure its quality.<a href="#section-abstract-7.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-abstract-8">The primitive functionalities of OAM are achieved with the ICMPv6 protocol.<a href="#section-abstract-8" class="pilcrow">¶</a></p>
<p id="section-abstract-9">ICMPv6 defines messages that inform the source of IPv6 packets of errors during packet delivery.
    It also defines the Echo Request/Reply messages that are used for basic network troubleshooting (ping command).
    ICMPv6 messages are transported on IPv6.<a href="#section-abstract-9" class="pilcrow">¶</a></p>
<p id="section-abstract-10">This document describes
    how basic OAM is performed on Low Power Wide Area Networks (LPWANs)
    by compressing ICMPv6/IPv6 headers
    and by protecting the LPWAN network and the Device from undesirable ICMPv6 traffic.<a href="#section-abstract-10" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 13 August 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="xref">3</a>.  <a href="#name-use-cases" class="xref">Use cases</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-detailed-behavior" class="xref">Detailed behavior</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-device-does-a-ping" class="xref">Device does a ping</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-rule-example" class="xref">Rule example</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-device-is-pinged" class="xref">Device is ping'ed</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="xref">4.2.1</a>.  <a href="#name-rule-example-2" class="xref">Rule example</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-device-is-the-source-of-an-" class="xref">Device is the source of an ICMPv6 error message</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-device-is-the-destination-o" class="xref">Device is the destination of an ICMPv6 error message</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4.2.1">
                    <p id="section-toc.1-1.4.2.4.2.1.1"><a href="#section-4.4.1" class="xref">4.4.1</a>.  <a href="#name-icmpv6-error-message-compre" class="xref">ICMPv6 error message compression.</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-traceroute" class="xref">Traceroute</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-security-considerations" class="xref">Security considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The primitive functionalities of OAM <span>[<a href="#RFC6291" class="xref">RFC6291</a>]</span> are achieved with the ICMPv6 protocol.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">ICMPv6 <span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span> is a companion protocol to IPv6 <span>[<a href="#RFC8200" class="xref">RFC8200</a>]</span>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3"><span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span> defines a generic message format.
This format is used for messages to be sent back to the source of an IPv6 packet to inform it about errors during packet delivery.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">More specifically, <span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span> defines 4 error messages:
Destination Unreachable, Packet Too Big, Time Exceeded and Parameter Problem.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5"><span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span> also defines the Echo Request and Echo Reply messages, which provide support for the ping application.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">Other ICMPv6 messages are defined in other RFCs, such as an extended format of the same messages <span>[<a href="#RFC4884" class="xref">RFC4884</a>]</span>
and other messages used by the Neighbor Discovery Protocol <span>[<a href="#RFC4861" class="xref">RFC4861</a>]</span>.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">This document focuses on using Static Context Header Compression (SCHC) to compress <span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span> messages that need to be transmitted over the LPWAN network, and on having the LPWAN gateway proxying the Device to save it the unwanted traffic.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">LPWANs' salient characteristics are described in <span>[<a href="#RFC8376" class="xref">RFC8376</a>]</span>.<a href="#section-1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">This draft re-uses the Terminology defined in <span>[<a href="#RFC8724" class="xref">RFC8724</a>]</span>.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", 
"SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", 
and "OPTIONAL" in this document are to be interpreted as 
described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they 
appear in all capitals, as shown here.<a href="#section-2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="use-cases">
<section id="section-3">
      <h2 id="name-use-cases">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-use-cases" class="section-name selfRef">Use cases</a>
      </h2>
<p id="section-3-1">In the LPWAN architecture, we can distinguish the following cases:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">the Device is the originator of an Echo Request message, and therefore the destination of the Echo Reply message.<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.2">the Device is the destination of an Echo Request message, and therefore the purported source of an Echo Reply message.<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.3">the Device is the (purported) source of an ICMP error message, mainly in response to an incorrect incoming IPv6
message, or in response to a ping request. In this case, as much as possible, the core SCHC C/D should act as a proxy and originate the ICMP message, so that the Device and the LPWAN network are protected from this unwanted traffic.<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.4">the Device is the destination of the ICMP message, mainly in response to a
packet sent by the Device to the network that generates an error. In this case, we want the ICMP message to reach the Device, and this document describes in <a href="#ErrMsgCompr" class="xref">Section 4.4.1</a> what SCHC compression should be applied.<a href="#section-3-2.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-3-3">These cases are further described in <a href="#DetailedBehavior" class="xref">Section 4</a>.<a href="#section-3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="DetailedBehavior">
<section id="section-4">
      <h2 id="name-detailed-behavior">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-detailed-behavior" class="section-name selfRef">Detailed behavior</a>
      </h2>
<div id="DevicePings">
<section id="section-4.1">
        <h3 id="name-device-does-a-ping">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-device-does-a-ping" class="section-name selfRef">Device does a ping</a>
        </h3>
<p id="section-4.1-1">If a ping request is generated by a Device, then SCHC compression applies.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">The format of an ICMPv6 Echo Request message is described in <a href="#Fig-ICMPv6-Echo-Request" class="xref">Figure 1</a>, with Type=128 and Code=0.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<span id="name-icmpv6-echo-request-message"></span><div id="Fig-ICMPv6-Echo-Request">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-4.1-3.1">
<pre>
       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     Type      |     Code      |          Checksum             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |           Identifier          |        Sequence Number        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     Data ...
      +-+-+-+-+-

</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-icmpv6-echo-request-message" class="selfRef">ICMPv6 Echo Request message format</a>
          </figcaption></figure>
</div>
<p id="section-4.1-4">If we assume that one rule will be devoted to compressing Echo Request messages, then Type and Code are known in the rule to be 128 and 0 and can therefore be elided with the not-sent CDA.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">Checksum can be reconstructed with the compute-checksum CDA and therefore is not transmitted.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6"><span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span> states that Identifier and Sequence Number are meant to
"aid in matching Echo Replies to this Echo Request" and that they "may be zero".
Data is "zero or more bytes of arbitrary data".<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1-7">We recommend that Identifier be zero, Sequence Number be a counter on 3 bits, and Data be zero bytes (absent). Therefore, Identifier is elided with the not-sent CDA, Sequence Number is transmitted on 3 bits with the LSB CDA and no Data is transmitted.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">The transmission cost of the Echo Request message is therefore the size of the Rule Id + 3 bits.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1-9">When the destination receives the Echo Request message, it will respond back with a Echo Reply message.
This message bears the same format as the Echo Request message but with Type = 129
(see <a href="#Fig-ICMPv6-Echo-Request" class="xref">Figure 1</a>).<a href="#section-4.1-9" class="pilcrow">¶</a></p>
<p id="section-4.1-10"><span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span> states that the Identifier, Sequence Number and Data fields of the Echo Reply message shall contain the same values as the invoking Echo Request message. Therefore, a rule shall be used similar to that used for compressing the Echo Request message.<a href="#section-4.1-10" class="pilcrow">¶</a></p>
<p id="section-4.1-11">TODO: how about a shared rule for Echo Request and Echo Reply with an LSB(1) CDA on the Type field? Or exploiting the Up/Down direction field in the rule?<a href="#section-4.1-11" class="pilcrow">¶</a></p>
<div id="rule-example">
<section id="section-4.1.1">
          <h4 id="name-rule-example">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-rule-example" class="section-name selfRef">Rule example</a>
          </h4>
<p id="section-4.1.1-1">The following rule gives an example of a SCHC compression.
The type can be elided if the direction is taken into account.
Identifier is ignored and generated as 0 at decompression.
This implies that only one single ping can be launched at any given time on a device.
Finally, only the least significant 8 bits of the sequence number are sent on the LPWAN,
allowing a serie of 255 consecutive pings.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<span id="name-example-of-compression-rule"></span><div id="Fig-ping-up">
<table class="center" id="table-1">
            <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-example-of-compression-rule" class="selfRef">Example of compression rule for a ping from the device</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Field</th>
                <th class="text-left" rowspan="1" colspan="1">FL</th>
                <th class="text-left" rowspan="1" colspan="1">FP</th>
                <th class="text-left" rowspan="1" colspan="1">DI</th>
                <th class="text-left" rowspan="1" colspan="1">Value</th>
                <th class="text-left" rowspan="1" colspan="1">Matching Operator</th>
                <th class="text-left" rowspan="1" colspan="1">CDA</th>
                <th class="text-left" rowspan="1" colspan="1"></th>
                <th class="text-left" rowspan="1" colspan="1">Sent bits</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ICMPv6 Type</td>
                <td class="text-left" rowspan="1" colspan="1">8</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Up</td>
                <td class="text-left" rowspan="1" colspan="1">128</td>
                <td class="text-left" rowspan="1" colspan="1">equal</td>
                <td class="text-left" rowspan="1" colspan="1">not-sent</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ICMPv6 Type</td>
                <td class="text-left" rowspan="1" colspan="1">8</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Dw</td>
                <td class="text-left" rowspan="1" colspan="1">129</td>
                <td class="text-left" rowspan="1" colspan="1">equal</td>
                <td class="text-left" rowspan="1" colspan="1">not-sent</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ICMPv6 Code</td>
                <td class="text-left" rowspan="1" colspan="1">8</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Bi</td>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">equal</td>
                <td class="text-left" rowspan="1" colspan="1">not-sent</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ICMPv6 Identifier</td>
                <td class="text-left" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Bi</td>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">ignore</td>
                <td class="text-left" rowspan="1" colspan="1">not-sent</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ICMPv6 Sequence</td>
                <td class="text-left" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Bi</td>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">MSB(24)</td>
                <td class="text-left" rowspan="1" colspan="1">LSB</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1">8</td>
              </tr>
            </tbody>
          </table>
</div>
</section>
</div>
</section>
</div>
<div id="device-is-pinged">
<section id="section-4.2">
        <h3 id="name-device-is-pinged">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-device-is-pinged" class="section-name selfRef">Device is ping'ed</a>
        </h3>
<p id="section-4.2-1">If the Device is ping'ed (i.e., is the destination of an Echo Request message), the default behavior is to avoid
propagating the Echo Request message over the LPWAN.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">This is done by proxying the ping request on the core SCHC C/D.
This requires to add an action when the rule is selected.
Instead of been processed by the compressor, the packet description is processed by a ping proxy.
The rule is used for the selection, so CDAs are not necessary.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">The resulting behavior is shown on <a href="#Fig-ICMPv6-ping" class="xref">Figure 2</a> and described below:<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<span id="name-examples-of-icmpv6-echo-req"></span><div id="Fig-ICMPv6-ping">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-4.2-4.1">
<pre>
     Device       NGW     core SCHC C/D                 Internet Host

       |           |            |    Echo Request, Code=0    |
       |           |            |&lt;---------------------------|
       |           |            |                            |
       |           |            |---------------------------&gt;|
       |           |            |    Echo Reply,   Code=0    |


</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-examples-of-icmpv6-echo-req" class="selfRef">Examples of ICMPv6 Echo Request/Reply</a>
          </figcaption></figure>
</div>
<div id="rule-example-1">
<section id="section-4.2.1">
          <h4 id="name-rule-example-2">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-rule-example-2" class="section-name selfRef">Rule example</a>
          </h4>
<p id="section-4.2.1-1">The following rule shows an example of a compression rule for pinging a device.<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<span id="name-example-of-compression-rule-"></span><div id="Fig-ping-down">
<table class="center" id="table-2">
            <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-example-of-compression-rule-" class="selfRef">Example of compression rule for a ping to a device</a>
            </caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Field</th>
                <th class="text-left" rowspan="1" colspan="1">FL</th>
                <th class="text-left" rowspan="1" colspan="1">FP</th>
                <th class="text-left" rowspan="1" colspan="1">DI</th>
                <th class="text-left" rowspan="1" colspan="1">Value</th>
                <th class="text-left" rowspan="1" colspan="1">Matching Operator</th>
                <th class="text-left" rowspan="1" colspan="1">CDA</th>
                <th class="text-left" rowspan="1" colspan="1"></th>
                <th class="text-left" rowspan="1" colspan="1">Sent bits</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ICMPv6 Type</td>
                <td class="text-left" rowspan="1" colspan="1">8</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Dw</td>
                <td class="text-left" rowspan="1" colspan="1">128</td>
                <td class="text-left" rowspan="1" colspan="1">equal</td>
                <td class="text-left" rowspan="1" colspan="1">not-sent</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ICMPv6 Type</td>
                <td class="text-left" rowspan="1" colspan="1">8</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Up</td>
                <td class="text-left" rowspan="1" colspan="1">129</td>
                <td class="text-left" rowspan="1" colspan="1">equal</td>
                <td class="text-left" rowspan="1" colspan="1">not-sent</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ICMPv6 Code</td>
                <td class="text-left" rowspan="1" colspan="1">8</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Bi</td>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">equal</td>
                <td class="text-left" rowspan="1" colspan="1">not-sent</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ICMPv6 Identifier</td>
                <td class="text-left" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Bi</td>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">ignore</td>
                <td class="text-left" rowspan="1" colspan="1">not-sent</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1"></td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">ICMPv6 Sequence</td>
                <td class="text-left" rowspan="1" colspan="1">16</td>
                <td class="text-left" rowspan="1" colspan="1">1</td>
                <td class="text-left" rowspan="1" colspan="1">Bi</td>
                <td class="text-left" rowspan="1" colspan="1">0</td>
                <td class="text-left" rowspan="1" colspan="1">MSB(24)</td>
                <td class="text-left" rowspan="1" colspan="1">LSB</td>
                <td class="text-left" rowspan="1" colspan="1"></td>
                <td class="text-left" rowspan="1" colspan="1">8</td>
              </tr>
            </tbody>
          </table>
</div>
<p id="section-4.2.1-3">In this example, type and code are elided, the identifer has to be sent, and the sequence number is limited to one byte.<a href="#section-4.2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ProxyErrMsg">
<section id="section-4.3">
        <h3 id="name-device-is-the-source-of-an-">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-device-is-the-source-of-an-" class="section-name selfRef">Device is the source of an ICMPv6 error message</a>
        </h3>
<p id="section-4.3-1">As stated in <span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span>, a node should generate an ICMPv6 message in response to an
IPv6 packet that is malformed or which cannot be processed due to some incorrect field value.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">The general intent of this document is to spare both the Device and the LPWAN network this un-necessary traffic.
The incorrect packets should be caught at the core SCHC C/D and the ICMPv6 notification should be sent back from there.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<span id="name-example-of-icmpv6-error-mes"></span><div id="Fig-ICMPv6-up">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-4.3-3.1">
<pre>
     Device       NGW     core SCHC C/D                 Internet Host

       |           |            |    Destination Port=XXX    |
       |           |            |&lt;---------------------------|
       |           |            |                            |
       |           |            |---------------------------&gt;|
       |           |            | ICMPv6 Port Unreachable    |
       |           |            |                            |
       |           |            |                            |


</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-example-of-icmpv6-error-mes" class="selfRef">Example of ICMPv6 error message sent back to the Internet</a>
          </figcaption></figure>
</div>
<p id="section-4.3-4"><a href="#Fig-ICMPv6-up" class="xref">Figure 3</a> shows an example of an IPv6 packet trying to reach a Device. Let's assume that the port number used
as destination port is not "known" (needs better definition) from the core SCHC C/D. Instead of sending the packet over
the LPWAN and having this packet rejected by the Device, the core SCHC C/D issues
an ICMPv6 error message "Destination Unreachable" (Type 1) with Code 1 ("Port Unreachable") on behalf of the Device.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3-5">In that case the SCHC C/D acts as a router and MUST have a routable IPv6 address to generate
an ICMPv6 message. when compressing a packet containing an IPv6 header, no compression rules are found and:
* if a rule contains some extension headers, a parameter problem may be generated (type 4),
* no rules contains the IPv6 prefix, a no route to destination ICMPv6  message (type 0, code 0) may be generated,
* a prefix is found, but no devIID matches, a address unreachable ICMPv6  message (type 0, code 3) may be generated,
* a device IPv6 address is found, but no port matches,  a port unreachable ICMPv6  message (type 0, code 4) may be generated,<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6">TODO: This assumes that all ports that the Device listens to will be matched by a SCHC rule. Is this the basic assumption of SCHC that all packets that do not match a rule are rejected? If yes, why do have fragmentation also for uncompressed packets?<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<p id="section-4.3-7">TODO: discuss the various Type/Code that are expected to be generated in response to various errors.<a href="#section-4.3-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="device-is-the-destination-of-an-icmpv6-error-message">
<section id="section-4.4">
        <h3 id="name-device-is-the-destination-o">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-device-is-the-destination-o" class="section-name selfRef">Device is the destination of an ICMPv6 error message</a>
        </h3>
<p id="section-4.4-1">In this situation, we assume that a Device has been configured to send information to a server on the Internet. If this
server becomes no longer accessible, an ICMPv6 message will be generated back towards the Device by an intermediate router.
This information can be useful to the Device, for example for reducing the reporting rate in case of periodic reporting of data.
Therefore, we compress the ICMPv6 message using SCHC and forward it to the Device over the LPWAN.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<span id="name-example-of-icmpv6-error-mess"></span><div id="Fig-ICMPv6-down">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-4.4-2.1">
<pre>
     Device       NGW     core SCHC C/D                Internet Server

       |           |            |                            |
       | SCHC compressed IPv6   |                            |
       |~~~~~~~~~~~|-----------&gt;|----------------------X     |
       |           |            | &lt;---------------------     |
       |&lt;~~~~~~~~~~|------------| ICMPv6 Host unreachable    |
       |SCHC compressed ICMPv6  |                            |
       |           |            |                            |
       |           |            |                            |


</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-example-of-icmpv6-error-mess" class="selfRef">Example of ICMPv6 error message sent back to the Device</a>
          </figcaption></figure>
</div>
<p id="section-4.4-3"><a href="#Fig-ICMPv6-down" class="xref">Figure 4</a> illustrates this behavior. The ICMPv6 error message is compressed
as described in <a href="#ErrMsgCompr" class="xref">Section 4.4.1</a> and forwarded over the LPWAN to the Device.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<div id="ErrMsgCompr">
<section id="section-4.4.1">
          <h4 id="name-icmpv6-error-message-compre">
<a href="#section-4.4.1" class="section-number selfRef">4.4.1. </a><a href="#name-icmpv6-error-message-compre" class="section-name selfRef">ICMPv6 error message compression.</a>
          </h4>
<p id="section-4.4.1-1">The ICMPv6 error messages defined in <span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span> contain the fields shown in
<a href="#Fig-ICMP-error" class="xref">Figure 5</a>.<a href="#section-4.4.1-1" class="pilcrow">¶</a></p>
<span id="name-icmpv6-error-message-format"></span><div id="Fig-ICMP-error">
<figure id="figure-5">
            <div class="alignLeft art-text artwork" id="section-4.4.1-2.1">
<pre>
       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     Type      |     Code      |          Checksum             |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                            Value                              |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                    As much of invoking packet                 |
      +                as possible without the ICMPv6 packet          +
      |                exceeding the minimum IPv6 MTU                 |

</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-icmpv6-error-message-format" class="selfRef">ICMPv6 Error Message format</a>
            </figcaption></figure>
</div>
<p id="section-4.4.1-3"><span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span> states that Type can take the values 1 to 4, and Code can be set to values between 0 and 6.
Value is unused for the Destination Unreachable and Time Exceeded messages. It contains the MTU for
the Packet Too Big message and a pointer to the byte causing the error for the Parameter Error message.
Therefore, Value is never expected to be greater than 1280 in LPWAN networks.<a href="#section-4.4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.4.1-4">The following generic rule can therefore be used to compress all ICMPv6 error messages as defined today.
More specific rules can also be defined to achieve better compression of some error messages.<a href="#section-4.4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.4.1-5">The Type field can be associated to a matching list [1, 2, 3, 4] and is therefore compressed down to 2
bits. Code can be reduced to 3 bits using the LSB CDA. Value can be sent on 11 bits using the LSB
CDA, but if the Device is known to send smaller packets, then the size of this field can
be further reduced.<a href="#section-4.4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.4.1-6">By <span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span>, the rest of the ICMPv6 message must contain as much as possible of the IPv6 offending (invoking) packet that triggered
this ICMPv6 error message. This information is used to try and identify the SCHC rule that
was used to decompress the offending IPv6 packet. If the rule can be found then the Rule Id
is added at the end of the compressed ICMPv6 message. Otherwise the compressed
packet ends with the compressed Value field.<a href="#section-4.4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.4.1-7"><span>[<a href="#RFC4443" class="xref">RFC4443</a>]</span> states that the "ICMPv6 error message MUST include as much
of the IPv6 offending (invoking) packet ... as possible".
In order to comply with this requirement, if there is enough information in the incoming ICMPv6 message for the core SCHC C/D to
identify the rule that has been used to decompress the erroneous IPv6 packet, this Rule Id must be
sent in the compressed ICMPv6 message to the Device.
TODO: the erroneous IPv6 packet header (not just the Rule Id) should be sent back. This includes the Rule Id and the compression residue. This means the SCHC C/D uses the context backwards (in the reverse direction). How does the Device know it must also use the context backwards?<a href="#section-4.4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.4.1-8">TODO: how does one know that the "payload" of a compressed-header packet is in fact another compressed header?<a href="#section-4.4.1-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="traceroute">
<section id="section-5">
      <h2 id="name-traceroute">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-traceroute" class="section-name selfRef">Traceroute</a>
      </h2>
<p id="section-5-1">The traceroute6 program sends successive probe packets destined to a chosen target
but with the Hop Limit value successively incremented from the initial value 1.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">It expects to receive a "Time Exceeded" (Type = 3) "Hop Limit" (Code = 0) ICMPv6 error message back from the successive routers along the path to the destination.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">The probe packet is usually a UDP datagram, but can also be a TCP datagram or even an ICMPv6 message.
The destination port is chosen in the unassigned range in hope that the destination, when eventually reached,
will respond with a "Destination Unreachable" (Type = 1) "Port Unreachable" (Code = 4) ICMPv6 error message.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">It is not anticipated that a Device will want to traceroute a destination on the Internet.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">By contrast, a host on the Internet may attempt to traceroute an IPv6 address that is assigned to an LPWAN device. This is described in <a href="#Fig-traceroute" class="xref">Figure 6</a>.<a href="#section-5-5" class="pilcrow">¶</a></p>
<span id="name-example-of-traceroute-to-th"></span><div id="Fig-traceroute">
<figure id="figure-6">
        <div class="alignLeft art-text artwork" id="section-5-6.1">
<pre>
     Device       NGW     core SCHC C/D                 Internet

       |           |            | Hop Limit=1, Dest Port=XXX |
       |           |            |&lt;---------------------------|
       |           |            |                            |
       |           |            |---------------------------&gt;|
       |           |            |   ICMPv6 Hop Limit error   |
       |           |            |                            |
       |           |            |                            |
       |           |            | Hop Limit=2, Dest Port=XXX |
       |           |            |&lt;---------------------------|
       |           |            |                            |
       |           |            |---------------------------&gt;|
       |           |            |  ICMPv6 Port Unreachable   |


</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-example-of-traceroute-to-th" class="selfRef">Example of traceroute to the LPWAN Device</a>
        </figcaption></figure>
</div>
<p id="section-5-7">When the probe packet first reaches the core SCHC C/D, its remaining Hop Limit is 1. The core SCHC C/D will
respond back with a "Time Exceeded" (Type = 3) "Hop Limit" (Code = 0) ICMPv6 error message.
Later on, when the probe packet reaches the code SCHC C/D with a Hop Limit value of 2, the core SCHC C/D will,
as explained in <a href="#ProxyErrMsg" class="xref">Section 4.3</a>, answer back with a "Destination Unreachable" (Type = 1) "Port Unreachable" (Code = 4) ICMPv6 error message.
This is what the traceroute6 command expects.
Therefore, the traceroute6 command will work with LPWAN IPv6 destinations, except for the time displayed for the destination, which is actually the time to its proxy.<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">However, if the probe packet happens to hit a port that matches a SCHC rule for that Device, the packet will be compressed with this rule and sent over the LPWAN, which is unfortunate.
Forwarding of packets to the Device over the LPWAN should only be done from authenticated/trusted sources anyway.
Rate-limitation on top of authentication will mitigate this nuisance.<a href="#section-5-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security considerations</a>
      </h2>
<p id="section-6-1">TODO<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1">TODO<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-8">
      <h2 id="name-references">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-8.1">
        <h3 id="name-normative-references">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4443">[RFC4443]</dt>
        <dd>
<span class="refAuthor">Conta, A.</span>, <span class="refAuthor">Deering, S.</span>, and <span class="refAuthor">M. Gupta, Ed.</span>, <span class="refTitle">"Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 89</span>, <span class="seriesInfo">RFC 4443</span>, <span class="seriesInfo">DOI 10.17487/RFC4443</span>, <time datetime="2006-03" class="refDate">March 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4443">https://www.rfc-editor.org/info/rfc4443</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4861">[RFC4861]</dt>
        <dd>
<span class="refAuthor">Narten, T.</span>, <span class="refAuthor">Nordmark, E.</span>, <span class="refAuthor">Simpson, W.</span>, and <span class="refAuthor">H. Soliman</span>, <span class="refTitle">"Neighbor Discovery for IP version 6 (IPv6)"</span>, <span class="seriesInfo">RFC 4861</span>, <span class="seriesInfo">DOI 10.17487/RFC4861</span>, <time datetime="2007-09" class="refDate">September 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4861">https://www.rfc-editor.org/info/rfc4861</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4884">[RFC4884]</dt>
        <dd>
<span class="refAuthor">Bonica, R.</span>, <span class="refAuthor">Gan, D.</span>, <span class="refAuthor">Tappan, D.</span>, and <span class="refAuthor">C. Pignataro</span>, <span class="refTitle">"Extended ICMP to Support Multi-Part Messages"</span>, <span class="seriesInfo">RFC 4884</span>, <span class="seriesInfo">DOI 10.17487/RFC4884</span>, <time datetime="2007-04" class="refDate">April 2007</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4884">https://www.rfc-editor.org/info/rfc4884</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6291">[RFC6291]</dt>
        <dd>
<span class="refAuthor">Andersson, L.</span>, <span class="refAuthor">van Helvoort, H.</span>, <span class="refAuthor">Bonica, R.</span>, <span class="refAuthor">Romascanu, D.</span>, and <span class="refAuthor">S. Mansfield</span>, <span class="refTitle">"Guidelines for the Use of the "OAM" Acronym in the IETF"</span>, <span class="seriesInfo">BCP 161</span>, <span class="seriesInfo">RFC 6291</span>, <span class="seriesInfo">DOI 10.17487/RFC6291</span>, <time datetime="2011-06" class="refDate">June 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6291">https://www.rfc-editor.org/info/rfc6291</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8200">[RFC8200]</dt>
        <dd>
<span class="refAuthor">Deering, S.</span> and <span class="refAuthor">R. Hinden</span>, <span class="refTitle">"Internet Protocol, Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 86</span>, <span class="seriesInfo">RFC 8200</span>, <span class="seriesInfo">DOI 10.17487/RFC8200</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8200">https://www.rfc-editor.org/info/rfc8200</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8724">[RFC8724]</dt>
      <dd>
<span class="refAuthor">Minaburo, A.</span>, <span class="refAuthor">Toutain, L.</span>, <span class="refAuthor">Gomez, C.</span>, <span class="refAuthor">Barthel, D.</span>, and <span class="refAuthor">JC. Zuniga</span>, <span class="refTitle">"SCHC: Generic Framework for Static Context Header Compression and Fragmentation"</span>, <span class="seriesInfo">RFC 8724</span>, <span class="seriesInfo">DOI 10.17487/RFC8724</span>, <time datetime="2020-04" class="refDate">April 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8724">https://www.rfc-editor.org/info/rfc8724</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-8.2">
        <h3 id="name-informative-references">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC8376">[RFC8376]</dt>
      <dd>
<span class="refAuthor">Farrell, S., Ed.</span>, <span class="refTitle">"Low-Power Wide Area Network (LPWAN) Overview"</span>, <span class="seriesInfo">RFC 8376</span>, <span class="seriesInfo">DOI 10.17487/RFC8376</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8376">https://www.rfc-editor.org/info/rfc8376</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Dominique Barthel</span></div>
<div dir="auto" class="left"><span class="org">Orange SA</span></div>
<div dir="auto" class="left"><span class="street-address">28 chemin du Vieux Chene<br>BP 98</span></div>
<div dir="auto" class="left">
<span class="postal-code">38243</span> <span class="locality">Meylan Cedex</span>
</div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dominique.barthel@orange.com" class="email">dominique.barthel@orange.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Laurent Toutain</span></div>
<div dir="auto" class="left"><span class="org">IMT Atlantique</span></div>
<div dir="auto" class="left"><span class="street-address">2 rue de la Chataigneraie<br>CS 17607</span></div>
<div dir="auto" class="left">
<span class="postal-code">35576</span> <span class="locality">Cesson-Sevigne Cedex</span>
</div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:laurent.toutain@imt-atlantique.fr" class="email">laurent.toutain@imt-atlantique.fr</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Arunprabhu Kandasamy</span></div>
<div dir="auto" class="left"><span class="org">Acklio</span></div>
<div dir="auto" class="left"><span class="street-address">1137A avenue des Champs Blancs</span></div>
<div dir="auto" class="left">
<span class="postal-code">35510</span> <span class="locality">Cesson-Sevigne Cedex</span>
</div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:arun@ackl.io" class="email">arun@ackl.io</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Diego Dujovne</span></div>
<div dir="auto" class="left"><span class="org">Universidad Diego Portales</span></div>
<div dir="auto" class="left"><span class="street-address">Vergara 432</span></div>
<div dir="auto" class="left"><span class="locality">Santiago</span></div>
<div dir="auto" class="left"><span class="country-name">Chile</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:diego.dujovne@mail.udp.cl" class="email">diego.dujovne@mail.udp.cl</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Juan Carlos Zuniga</span></div>
<div dir="auto" class="left"><span class="org">SIGFOX</span></div>
<div dir="auto" class="left"><span class="street-address">425 rue Jean Rostand</span></div>
<div dir="auto" class="left">
<span class="postal-code">31670</span> <span class="locality">Labege</span>
</div>
<div dir="auto" class="left"><span class="country-name">France</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:JuanCarlos.Zuniga@sigfox.com" class="email">JuanCarlos.Zuniga@sigfox.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
