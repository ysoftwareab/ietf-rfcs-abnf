<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Open Grid Protocol: Foundation</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Open Grid Protocol: Foundation">
<meta name="keywords" content="OGP, virtual world, messaging base, capabilities">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">M. Lentczner</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Linden Research, Inc.</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">March 03, 2009</td></tr>
<tr><td class="header">Expires: September 4, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Open Grid Protocol: Foundation<br />draft-lentczner-ogp-base-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 4, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>The Open Grid Protocol documents define the protocols by which a vast, Internet wide
            virtual world can operate. This protocol enables different regions of the virtual world
            to be operated independently, yet interoperate to form a cohesive experience.
</p>
<p>This document specifies the foundation upon which various suites of virtual world
            functionality are built. It describes the basic structure of OGP interaction and common
            methodology and terminology for protocols.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Structure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.1.1.</a>&nbsp;
Requirements Language<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.2.</a>&nbsp;
Domains<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">1.3.</a>&nbsp;
Basic Flow<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">1.4.</a>&nbsp;
Structure of the Protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">1.5.</a>&nbsp;
Document Structure<br />
<a href="#anchor8">2.</a>&nbsp;
Base Protocols<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">2.1.</a>&nbsp;
Resources, HTTP &amp; REST<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">2.2.</a>&nbsp;
LLSD &amp; LLIDL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">2.2.1.</a>&nbsp;
Serialization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">2.3.</a>&nbsp;
Capabilities<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">2.3.1.</a>&nbsp;
Obtaining<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">2.3.2.</a>&nbsp;
Invocation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">2.3.3.</a>&nbsp;
Lifetime &amp; Revocation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">2.3.4.</a>&nbsp;
Names<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">2.3.5.</a>&nbsp;
Seed Capability (Resource Class)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Capbility-Security">2.3.6.</a>&nbsp;
Security<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">2.4.</a>&nbsp;
Event Queues<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">2.4.1.</a>&nbsp;
Basic Flow<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">2.4.2.</a>&nbsp;
Restrictions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">2.4.3.</a>&nbsp;
Event Queue Get (Resource Class)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">2.4.4.</a>&nbsp;
Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">2.4.5.</a>&nbsp;
Responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">2.4.6.</a>&nbsp;
Long Poll<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">2.4.7.</a>&nbsp;
Closing the Queue<br />
<a href="#Security">3.</a>&nbsp;
Security Considerations<br />
<a href="#anchor26">4.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">5.</a>&nbsp;
Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Structure</h3>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Introduction</h3>

<p>The Open Grid Protocol (OGP) is about a three way interaction between viewer, agent
               and region in order to facilitate a shared experience between people. While the
               description here is grounded in a common view of what a virtual world is, the terms
               are deliberately described so as to be usable in a wider variety of situations. The
               OGP structure is design to support the abstract the notion of persistent user
               identity interacting over time in a variety of shared experiences in different
               persistent locations, especially where the users and locations are operated by
               different administrative domains.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1.1"></a><h3>1.1.1.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
                  "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
                  interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Domains</h3>

<p>The viewer is the element that senses and acts on the state of the virtual world. The
               viewer does so from the vantage point of an agent. An agent is persistent identity
               and persona that interacts in a virtual world. The agent persists and can be
               interacted with even when the user controlling it (though a viewer) is off-line.
               Regions are persistent locations in the virtual world. Multiple agents may be present
               in a region at the same time, and when they are they have a shared experience.
</p>
<p>Groups of regions and agents are managed by domains. A region domain is responsible
               for a collection of regions. An agent domain manages agent accounts.
</p>
<p>This protocol makes few assumptions about how a domain manages its collection of
               elements. In particular, it does not assume that a region will be entirely managed on
               a single host, nor that an agent will or won’t be managed by a single process.
</p>
<p>It is useful to think of the “stance” that each element takes in the three-way
               protocol:
</p>
<p>The viewer is the direct proxy for a human that wants to control an agent. This
               control can be direct as in the case of an interactive 3D viewer, or indirect as in
               the case of a web site that the user directs to display their agent’s status.
</p>
<p>The agent domain is responsible for the agent itself. The persistent state of the
               agent is held within the agent domain, and requests to interact with the agent, even
               by the viewer, are mediated by the agent domain.
</p>
<p>The region domain runs the live simulations of regions in the virtual world. The
               region domain manages the persistent state of these regions.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Basic Flow</h3>

<p>The basic flow of the protocol is:
</p>
<p>
               </p>
<ol class="text">
<li>The viewer authenticates to an agent domain for the authorized control of a
                     particular agent.
</li>
<li>The viewer directs the agent domain to to place the agent in a region.
</li>
<li>The agent domain contacts the region domain for the region, and negotiates
                     placement of the agent.
</li>
<li>The region grants access to the agent domain, which in turn passes some of that
                     granted access on to the viewer.
</li>
</ol><p>
            
</p>
<p>At this stage, each entity will have access to many resources in the other entities.
               For example:
</p>
<p>
               </p>
<ul class="text">
<li>The viewer has access to region resources that let it move the avatar.
</li>
<li>The region has access to viewer resources that update the state of objects in
                     the region.
</li>
<li>The viewer and agent have access to resources in each other to facilitate text
                     messaging.
</li>
</ul><p>
            
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Structure of the Protocol</h3>

<p>The protocol is fundamentally composed of individual resources that can be invoked by
               one entity in the system upon another. Each resource is a member of a resource class
               that describes the syntax and semantics of invoking the resource.
</p>
<p>The resource classes are composed into suites that form logical groupings, though
               suites do not otherwise play a part in the protocol. Other protocol suites based on
               this document, when complete, will describe the several hundred resource classes that
               make up the virtual world.
</p>
<p>In order to facilitate migration from the existing systems, as well as support future
               extension, some resources could return information that allow entities to continue to
               communicate using other protocols and structures. These protocols and structures are
               not part of OGP. It is the intention that when this work is complete, virtual world
               interaction will be entirely OGP based, and that OGP itself will have enough
               extensibility for future development.
</p>
<p>Agent and region domains have a few resources that are available at well known URLs.
               All other resources in the agent and region domains are accessed via capabilities
               obtained from the those few initial resources.
</p>
<p>Since viewers are typically behind firewalls that do not allow connection, resources
               in the viewer are accessed by event queues held in the agent and region for the
               viewer. The viewer uses the “long poll” technique to efficiently proxy these inward
               resource invocations.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.5"></a><h3>1.5.&nbsp;
Document Structure</h3>

<p>OGP is a large suite of interrelated protocol suites. Each major protocol suite is
               described in its own document. For examples, see the OGP Authentication and OGP
               Teleport documents. This document describes the base facilities and concepts upon
               which the other protocols are based. To be compliant with OGP, an implementation MUST
               conform to this document, and may implement any of the other protocol sets that are
               deemed relevant.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Base Protocols</h3>

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Resources, HTTP &amp; REST</h3>

<p>All interaction between entities is through a client invoking a resource. Resources
               are invoked either directly via <a class='info' href='#RFC2616'>HTTP<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> [RFC2616], or through an
               event queue.
</p>
<p>For each resource class, this protocol defines how the client obtains the URL, the
               HTTP verb (or verbs) to be used, the request and response bodies (if any), and
               significant status codes. Resource classes are designed with REST style semantics.
</p>
<p>In general, HTTP &amp; REST are used as follows: The URL will be either well-known in
               advance or returned in a response from another resource. The latter is called a
               capability. Except for security reasons, URLs are always treated as opaque. Clients
               should not modify them. Parameters are never added to them via the query section.
               Resource handlers must be prepared to ignore query sections.
</p>
<p>Resources follow general REST semantics and so respond to one of these HTTP verb
                  sets:</p>
<blockquote class="text"><dl>
<dt>GET</dt>
<dd>for cacheable resources
</dd>
<dt>GET, PUT</dt>
<dd>for cacheable resources that can be modified
</dd>
<dt>GET, PUT, DELETE</dt>
<dd>for cacheable resources that can be modified and
                     deleted
</dd>
<dt>POST</dt>
<dd>for non-cacheable resources
</dd>
</dl></blockquote>

<p>Unless otherwise stated, if a resource accepts PUT, it accepts multiple PUT
               invocations.
</p>
<p>The request and response bodies are transmitted as serialized LLSD data. If a
               resource has no response defined, then it can return either an undefined value, an
               empty map, or have a zero length response body.
</p>
<p>HTTP status codes should only be used to indicate the status of the HTTP interaction
               itself. In general, if the resource is reachable, and the request understood, a 2xx
               code should be returned.
</p>
<p>HTTP headers, both for the request and the response are never part of a resource
               class definition. Headers are handled as per the HTTP standard.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
LLSD &amp; LLIDL</h3>

<p>All data in this system is defined by LLSD and protocols specified in
               LLIDL. LLSD is an abstract way of talking about structured data. It is defined in
               <a class='info' href='#draft-hamrick-llsd-00'>LLSD &amp; LLIDL<span> (</span><span class='info'>Brashears, A., Hamrick, M., and M. Lentczner, &ldquo;Linden Lab Structured Data,&rdquo; 2009.</span><span>)</span></a> [draft&#8209;hamrick&#8209;llsd&#8209;00].
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.1"></a><h3>2.2.1.&nbsp;
Serialization</h3>

<p>When used as part of OGP, the XML and JSON serializations of LLSD MUST be
                  supported.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Capabilities</h3>

<p>This protocol makes extensive use of capabilities. A capability is an opaque HTTP (or
               HTTPS) URL used for accessing a particular resource. The provider of the resource has
               three logical parts: the<em>grantor</em>,
               the<em>capability host</em>, and
               the<em>service</em>.
</p>
<p>The grantor uses the capability host to construct a capability that maps to the
               service that provides the resource, then returns that capability to the client. At
               some point in the future, the client invokes the capability which makes a connection
               to the capability host. The capability host then proxies to the service to provide
               the resource.
</p>
<p>The parts that make up the provider may be separate entities or may be the same.
</p>
<p>The client can’t invoke the resource without the capability. Typically the capability
               is a URL with a cryptographically secure path component. Within the capability host,
               this URL is mapped to the actual internal resource URL.
</p>
<p>The client is free to hand the capability to other entities who become clients of the
               capability as well. Other than for the security considerations below, the client must
               not rely on any assumed structure of the capability URL.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.1"></a><h3>2.3.1.&nbsp;
Obtaining</h3>

<p>For each resource a client wants to invoke, the capability must be obtained. In a
                  few cases, the capability will have been expressly returned in the result of some
                  other resource. Usually, the system uses a seed capability (see below) to request
                  the capability for a given resource by name.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.2"></a><h3>2.3.2.&nbsp;
Invocation</h3>

<p>To invoke a capability, the holder performs an HTTP transaction with the
                  capability as the URL. The resource class the capability represents will dictate
                  which verb (or verbs) can be used, and what the request and response bodies (if
                  any) should be.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.3"></a><h3>2.3.3.&nbsp;
Lifetime &amp; Revocation</h3>

<p>Capabilities can be either unlimited or one-shot. Unlimited capabilities can be
                  used multiple times, whereas one-shot can be used only once and are automatically
                  revoked on invocation.
</p>
<p>Invoking a one-shot with the HTTP verbs HEAD or OPTIONS does not revoke it.
</p>
<p>Any capability can be revoked at will by the provider of the resource. Clients
                  must be prepared to handle revoked capabilities. A revoked capability, when
                  invoked must return a 4xx HTTP status code. The capability host may return a 404,
                  even if the capability had been previously active.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.4"></a><h3>2.3.4.&nbsp;
Names</h3>

<p>The resource a capability performs is identified by name. When
                  requesting a capability, or when returning a capability, the opaque URL is
                  identified with this name. The names of such resources are intended to be globally
                  unique.
</p>
<p>Names are URIs. When a name appears without a scheme component, then
                  it is a relative URL, considered relative to the base:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>http://xmlns.secondlife.com/capability/name/</pre></div>
<p>While names do exhibit path-link structure, they are to be considered opaque
                  identifiers. For example, while the following three capability names are indeed
                  from the same protocol suite, nothing should be inferred about a capability that
                  starts with their common prefix:
</p>
<p>
                  </p>
<blockquote class="text">
<p>
                        </p>
<blockquote class="text">
<p>inventory/root
</p>
<p>inventory/folder_contents
</p>
<p>inventory/move_folder
</p>
</blockquote>
                     

</blockquote><p>
               
</p>
<p>While not required, this protocol prefers names that are all lower case ASCII
                  letters, separated by underscores and forward slashes.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.5"></a><h3>2.3.5.&nbsp;
Seed Capability (Resource Class)</h3>

<p>In many cases, a sub-system will
                  return a<em>seed capability</em>from which other capabilities
                  can be requested.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>%% seed
-&gt; { capabilities: [ string, ... ] }
&lt;- { capabilities: { $: uri } }</pre></div>
<p>The request contains an array of all resource names for which
                  capabilities are desired. The response contains a map with an entry for each
                  capability granted. Note: a grantor may grant all, some or none of the requested
                  capabilities. The grantor may also grant additional capabilities that were
                  requested, or none at all. If the grantor grants none, the response map must be
                  empty and the HTTP status code should still be 200.
</p>
<a name="Capbility-Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.6"></a><h3>2.3.6.&nbsp;
Security</h3>

<p>If an end-point receives a capability from an untrusted source, it is permissible
                  for security reasons to check the following aspects of the URL before use:
</p>
<p>
                  </p>
<ul class="text">
<li>The scheme should be http: or https:.
</li>
<li>The authority (in particular, the resolved host name) should not resolve to
                        ports on the local machine that aren’t publicly accessible.
</li>
</ul><p>
               
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Event Queues</h3>

<p>An event queue enables an entity to invoke resources in the viewer, which cannot be
               directly contaced via HTTP. This is usually the case because the viewer is behind a
               firewall that doesn’t allow incoming TCP (and hence HTTP) connections from the region
               or agent domains.
</p>
<p>In such a situation, the client establishes a queue of invocation requests for
               resources in the viewer. At the same time, the viewer uses
               an<strong>event_queue/get</strong>capability to effectively tunnel the
               requests from the client to itself.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.1"></a><h3>2.4.1.&nbsp;
Basic Flow</h3>

<p>When the viewer invokes<strong>event_queue/get</strong>, the entity
                  replies with the list of messages that have been queued up. The viewer takes the
                  response, breaks it apart into a series of requests that it processes on itself,
                  as resource invocations that the entity wanted to perform. The next invocation of
                  <strong>event_queue/get</strong> includes the responses to any
                  requests that have completed processing. While it takes two resource invocations
                  of<strong> event_queue/get</strong> to tunnel a set of invocations in
                  the other directions, subsequent transactions are chained, since the
                  acknowledgement of a previous requests is performed in the same invocation that
                  gets the next set.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.2"></a><h3>2.4.2.&nbsp;
Restrictions</h3>

<p>Resources accessed this way have the following restrictions:
</p>
<p>
                  </p>
<ul class="text">
<li>Resources are identified by their resource class name. With capabilities,
                        there can be several resources in an entity that all conform to the same
                        resource class. With event queues only one resource can exist for each
                        resource class within the viewer. This is not usually a severe restriction.
</li>
<li>The only verb allowed is POST.
</li>
</ul><p>
               
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.3"></a><h3>2.4.3.&nbsp;
Event Queue Get (Resource Class)</h3>

<p>This resource is a capability both
                  in the agent and in the region, for implementing a tunneled series of resource
                  invocations from the entity back to the client:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>%% event_queue/get
-&gt; { responses: [ &amp;response, ... ], done: bool }
&lt;- { requests: [ &amp;request, ... ] }

&amp;request = { id: int, name: string, body: undef }
&amp;response = { id: int, status: int, body: undef }</pre></div>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.4"></a><h3>2.4.4.&nbsp;
Requests</h3>

<p>Each request contains a name and a body. The name is the resource name to be
                  invoked. The request can then be seen as equivalent to fetching the capability for
                  this named resource from a seed capability, and then invoking that capability.
                  Since the viewer cannot have URLs that point into it, these two steps must be
                  combined into one operation here.
</p>
<p>The id field represents a number that is used later to correlate responses with
                  the requests. The number must be considered opaque from the point of view of the
                  viewer. It is up to the entity to choose an allocation regieme that works for
                  itself.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.5"></a><h3>2.4.5.&nbsp;
Responses</h3>

<p>Each response includes the id number from the request it is the response to. This
                  enables the entity to correate responses with requests. The status value is the
                  same as the HTTP status code for the request. However, the status of 0 (which
                  corresponds to the value that would be seen if the status field were missing in
                  the LLSD), shall be construed as a status of 200. The body is the response body.
</p>
<p>Note that requestors need to be prepared to handle the same set of eventualities
                  as any REST request: A response to a request might never come, or might be delayed
                  significantly.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.6"></a><h3>2.4.6.&nbsp;
Long Poll</h3>

<p>Both viewers and entities must be prepared to handle use the “long poll” technique
                  to keep the flow of requests timely. Viewers must be prepared to handle that
                  invoking <strong>event_queue/get</strong> may take a relatively long
                  time to return, as the entity may choose to delay responding if there are no
                  requests pending, or if it believes it would be better to wait for more requests
                  to queue. Entities must be prepared to handle viewers that request as soon as they
                  are ready for events with no delay. Both sides must be prepared to handle time
                  outs and retries.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4.7"></a><h3>2.4.7.&nbsp;
Closing the Queue</h3>

<p>When the viewer is ready to terminate the queue, meaning that it wishes to be done
                  accepting requests, it may signal such by including the done flag in the next
                  invocation of<strong> event_queue/get</strong>. This value is purely
                  advisory, but enables entities to cleanly flush remaining events, and release
                  resources. Specifically, setting done to true in the invocation body indicates to
                  the entity that if no requests are returned, the viewer intends to no longer
                  invoke this queue.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Security Considerations</h3>

<p>The OGP protocols described by this document describe mechanism by which other
            application specific protocols are layered on top. Issues such as authentication and
            authorization are described in other OGP documents, and only pertain to systems that
            choose to use them. However, as this document's protocols form a base of others, and
            these are intended to be deployed across the Internet, there are some basic security
            considerations at this level. 
</p>
<p>All resources in OGP are invoked via HTTP or HTTPS URLs. Where a resource requires any
            of end-to-end data integrity, protection from man-in-the middle attacks, or
            authentication of resource provider, that resource should be accessed via HTTPS, with
            the client checking the validity of the server certificate. If the URL indicates https:,
            then the security available with HTTPS connections applies to the resource request.
</p>
<p>Some resources in OGP are accessed via cryptographically strong URLs. That is, a entity
            decides to authorize a client to access a resource, and does so by handing back a
            non-guessable URL to the service to the client. When such a URL is returned, it must be
            over a HTTPS channel, lest the URL be sniffed as it traverses the network. Care must be
            taken by the entity providing the capability to ensure that the URL is unguessable and
            unforgeable. Usually, using a 128 bit random key in the URL path is sufficient, assuming
            the randomness has sufficient cryptographic properties. 
</p>
<p>Clients must take care to consider such URLs precious - just as they would session
            cookies in a web browser environment. These URLs are authorized to invoke some action,
            and if leaked, give out that ability. Since they are generally limited in scope, it is
            possible to delegate these URLs to other sub-systems the client may entrust to perform
            its work, and it is safer to do so than techniques like sharing session cookies or
            account passwords.
</p>
<p>As discussed in <a class='info' href='#Capbility-Security'>Section&nbsp;2.3.6<span> (</span><span class='info'>Security</span><span>)</span></a>, clients must take caution that
            capabilities returned by services don't point to localhost. The primary reason for this
            is that it is common for hosts to have more ports and services open to localhost than to
            external entities. A malicous external entity returning a URL pointed at localhost, if
            it can guess the likely services available, can cause the client to invoke those
            services on its behalf, even thought it can't directly view the results. Clients should
            check the resolved IP address for the host in the URL, since it is trivial to have
            remotely controlled DNS names that resolve to 127.0.0.1. Note: This threat is no
            different that already exists in web browsing in general.
</p>
<p>There are two denial of service attack vectors. As with any web service, entities must
            be prepared to handle all manner of ill formed requests, requests that take too much
            time, and requests that come at a high rate. Standard web service techniques can be used
            to mitigate these risks. In the case of the Event Queue, clients must be prepared to
            handle unreasonable, or malformed requests from the contacted entity. If a client finds
            itself overwhelmed by requests from an Event Queue, simply dropping the connection and
            not replying is completely acceptable mitigation. The long poll technique also allows
            either side to release the connection at any time that resources are being too heavily
            consumed.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
IANA Considerations</h3>

<p>This document has no actions for IANA.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>5.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2616.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="draft-hamrick-llsd-00">[draft-hamrick-llsd-00]</a></td>
<td class="author-text">Brashears, A., Hamrick, M., and M. Lentczner, &ldquo;Linden Lab Structured Data,&rdquo; 2009.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mark Lentczner</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Linden Research, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">945 Battery St.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Francisco, CA  94111</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 415 243 9000</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:zero@lindenlab.com">zero@lindenlab.com</a></td></tr>
</table>
</body></html>
