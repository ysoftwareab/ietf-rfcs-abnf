<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>TLS Extension For Indicating A Previously-Seen Server Certificate Chain</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Language">
<link href="#rfc.section.2" rel="Chapter" title="2 Extension Definitions">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Extension for large certificate chains">
<link href="#rfc.section.3" rel="Chapter" title="3 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="4 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes a TLS extension which enables a TLS client to send to a TLS server a certificate chain which the client has previously received from the same server.  Server operators are expected to use this information to detect use of fraudulent certificates on the Internet.  " />
  <meta name="description" content="This document describes a TLS extension which enables a TLS client to send to a TLS server a certificate chain which the client has previously received from the same server.  Server operators are expected to use this information to detect use of fraudulent certificates on the Internet.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">TLS</td>
<td class="right">Weimer</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">BFK</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">September 26, 2011</td>
</tr>
<tr>
<td class="left">Expires: March 29, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">TLS Extension For Indicating A Previously-Seen Server Certificate Chain<br />
  <span class="filename">draft-weimer-tls-previous-certificate-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes a TLS extension which enables a TLS client to send to a TLS server a certificate chain which the client has previously received from the same server.  Server operators are expected to use this information to detect use of fraudulent certificates on the Internet.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 29, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Requirements Language</a>
</li>
<li>2.   <a href="#rfc.section.2">Extension Definitions</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Extension for large certificate chains</a>
</li>
<li>3.   <a href="#rfc.section.3">Security Considerations</a>
</li>
<li>4.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The <a href="#RFC5246">TLS protocol</a> <cite title="NONE">[RFC5246]</cite> does not provide any non-cryptographic mechanism to detect which server certificates are in use.  The <a href="#RFC2560">OCSP protocol</a> <cite title="NONE">[RFC2560]</cite> does not embed the actual certificate in requests, which means that certificate authorities are not able to detect unexpected certificates, either.</p>
<p id="rfc.section.1.p.2">This document describes an extension which a TLS client can use during the TLS handshake to send back to a server the certificate chain that the client has seen during a previous connection attempt (presumably the last).  The server operator can analyze incoming certificates and investigate those which it has not obtained itself.</p>
<p id="rfc.section.1.p.3">It is expected that attackers simply strip the extension, to avoid alerting server operators.  However, assuming that a subset of the clients which are exposed to a fraudulent certificate are mobile, some of them will eventually move to a network which provides a clear path to the server.  At this point, the server will receive the fraudulent certificate, and the server operator can initiate countermeasures.  </p>
<p id="rfc.section.1.p.4">Compared to client-side detection, server-side detection has the advantage that the client user interface does not need changing.  Additionally, the server operator is in a better position to tell fraudulent from authorized certificates.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Requirements Language</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Extension Definitions</h1>
<p id="rfc.section.2.p.1">In order to send a previously-encountered server certificate chain, clients MAY include an extension of type "previous_certificate_chain" in the client hello, with extension type TBD.</p>
<div id="#rfc.figure.1"></div>
<p>The "extension_data" field of this extension SHALL contain a "PreviousCertificateChain" structure, which is defined as: </p>
<pre>
struct {
    Certificate certificate;
} PreviousCertificateChain;
	</pre>
<p id="rfc.section.2.p.2">This extension can be used with <a href="#RFC4347">DTLS</a> <cite title="NONE">[RFC4347]</cite>.</p>
<p id="rfc.section.2.p.3">The client MUST take the certificate chain from the "certificate" message in a previous, successful TLS handshake with the same endpoint, and include it in the "certificate" field.  The most recent handshake matching these criteria SHOULD be used.  Two endpoints are the same if they have the same name or address, as supplied by the user or an application protocol which uses TLS.</p>
<p id="rfc.section.2.p.4">If the certificate chain does not fit into the client hello, the extension defined in the next section SHOULD be used.</p>
<p id="rfc.section.2.p.5">A TLS server MAY ignore this extension.  It MUST NOT assume a particular order of the presented certificates.  It SHOULD NOT include it in the server hello.  A client MUST ignore the extension if it is included in the server hello.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Extension for large certificate chains</h1>
<p id="rfc.section.2.1.p.1">The TLS protocol limits for certificate chain lengths exceed those for extension lengths.  An attacker can therefore evade detection by intentionally supplying a certificate chain which contains many certificates or a large certificate.  In order to address this problem, a client implementing the "previous_certificate_chain" extension SHOULD use the "large_previous_certificate_chain" extension.  </p>
<p id="rfc.section.2.1.p.2">The "large_previous_certificate_chain" has type TBD, and the the "extension_data" field SHALL contain the "PreviousCertificateChain" structure defined above.</p>
<p id="rfc.section.2.1.p.3">The certificate chain in the "certificate" field SHOULD be prepared in the following manner: </p>

<ul class="empty">
<li>If the certificate chain that caused the client to accept the certificate as valid does not exceed the imposed size limit, this certificate chain MUST be used.</li>
<li>Otherwise, if including the server certificate does not exceed the size limit, it SHOULD be included.</li>
<li>The client should add as many certificates as possible, within the size constraint, starting at the trusted root CA and going down the chain.</li>
</ul>
<p id="rfc.section.2.1.p.4">Otherwise, server and client behavior is the same as for the "previous_certificate_chain" extension.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.3.p.1">The mechanism described in this document is by no means cryptographically strong.  It is the explicit goal of this document to provide detection capabilities which do not rely on cryptography and cryptography-related infrastructure.</p>
<p id="rfc.section.3.p.2">If a server dynamically generates its server certificate, it can recognize reconnecting clients.  In comparison to the session resumption mechanism built into TLS, this ability last for a longer time.  For privacy-sensitive applications, use of these extensions should be disabled or restricted.</p>
<p id="rfc.section.3.p.3">Clients may deliberately transmit incorrect certificate chains.  For the "previous_certificate_chain" extension, this can be detected on the server side because such a certificate chain will not be linked to a globally accepted root certificate.</p>
<p id="rfc.section.3.p.4">If a client downgrades its advertised TLS protocol version or set of extensions on handshake failures, an attacker may suppress sending these extensions, especially if the attacker can force the client to perform such a downgraded handshake after the fraudulent certificate has been used.</p>
<h1 id="rfc.references">
<a href="#rfc.references">4.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4347">[RFC4347]</b></td>
<td class="top">
<a>Rescorla, E.</a> and <a>N. Modadugu</a>, "<a href="http://tools.ietf.org/html/rfc4347">Datagram Transport Layer Security</a>", RFC 4347, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2560">[RFC2560]</b></td>
<td class="top">
<a href="mailto:mmyers@verisign.com" title="VeriSign, Inc.">Myers, M.</a>, <a href="mailto:rankney@erols.com" title="CertCo, LLC">Ankney, R.</a>, <a href="mailto:ambarish@valicert.com" title="ValiCert, Inc.">Malpani, A.</a>, <a href="mailto:galperin@mycfo.com" title="My CFO, Inc.">Galperin, S.</a> and <a href="mailto:cadams@entrust.com" title="Entrust Technologies">C. Adams</a>, "<a href="http://tools.ietf.org/html/rfc2560">X.509 Internet Public Key Infrastructure Online Certificate Status Protocol - OCSP</a>", RFC 2560, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Florian Weimer</span> 
	  <span class="n hidden">
		<span class="family-name">Weimer</span>
	  </span>
	</span>
	<span class="org vcardline">BFK edv-consulting GmbH</span>
	<span class="adr">
	  <span>Kriegsstra&#223;e 100</span>

	  <span class="vcardline">
		<span class="locality">Karlsruhe</span>,  
		<span class="region"></span>
		<span class="code">76133</span>
	  </span>
	  <span class="country-name vcardline">DE</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:fweimer@bfk.de">fweimer@bfk.de</a></span>

  </address>
</div>

</body>
</html>