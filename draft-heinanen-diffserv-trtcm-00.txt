





Internet Engineering Task Force                            Juha Heinanen
INTERNET DRAFT                                             Telia Finland
Expires September 1999                                       Roch Guerin
                                              University of Pennsylvania
                                                             March, 1999


                     A Two Rate Three Color Marker
                 <draft-heinanen-diffserv-trtcm-00.txt>


Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet- Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   Distribution of this memo is unlimited.

Abstract

   This document defines a Two Rate Three Color Marker (trTCM), which
   can be used as a component in a Diffserv traffic conditioner
   [RFC2475, RFC2474].  The trTCM meters an IP packet stream and marks
   its packets based on two rates, Peak Information Rate (PIR) and
   Committed Information Rate (CIR), and their associated burst sizes to
   be either green, yellow, or red.  A packet is marked red if it
   exceeds the PIR.  Otherwise it is marked either yellow or green
   depending on whether it exceeds or doesn't exceed the CIR.







Heinanen & Guerin     A Two Rate Three Color Marker             [Page 1]

INTERNET DRAFT                                               March, 1999


1. Introduction

   The Two Rate Three Color Marker (trTCM) meters an IP packet stream
   and marks its packets either green, yellow, or red.  A packet is
   marked red if it exceeds the Peak Information Rate (PIR).  Otherwise
   it is marked either yellow or green depending on whether it exceeds
   or doesn't exceed the Committed Information Rate (CIR).  The trTCM is
   useful in policing a service, where a peak rate needs to be enforced
   separately from a committed information rate.

   The Meter meters each packet and passes the packet and the metering
   result to the Marker:

                            +------------+
                            |   Result   |
                            |            V
                        +-------+    +--------+
                        |       |    |        |
      Packet Stream ===>| Meter |===>| Marker |===> Marked Packet Stream
                        |       |    |        |
                        +-------+    +--------+

   The Meter operates in one of two modes.  In the Color-Blind mode, the
   Meter assumes that the packet stream is uncolored.  In the Color-
   Aware mode the Meter assumes that the packet stream has been pre-
   colored.

   The Marker (re)colors an IP packet according to the results of the
   Meter.  The color is coded in the DS field [Nichols] of the packet in
   a PHB specific manner (see section 4 for an example).

   A companion document [Heinanen1] describes another three color
   marker, called a Single Rate Three Color Maker (srTCM), where packets
   are marked based on a single rate and two burst sizes.

2. Configuration

   The trTCM is configured by setting its mode and by assigning values
   to four traffic parameters: a Peak Information Rate (PIR) and its
   associated Peak Burst Size (PBS) and a Committed Information Rate
   (CIR) and its associated Committed Burst Size (CBS).

   The PIR and CIR are measured in bytes of IP packets per second, i.e.,
   it includes the IP header, but not link specific headers.  The PIR
   must be equal to or greater than the CIR.

   The PBS and the CBS and are measured in bytes and both of them MUST
   be configured to be greater than 0.  It is RECOMMENDED that they be



Heinanen & Guerin     A Two Rate Three Color Marker             [Page 2]

INTERNET DRAFT                                               March, 1999


   configured to be equal to or greater than the size of the largest
   possible IP packet in the stream.

3. Metering

   The behavior of the Meter is specified in terms of its mode and two
   token buckets, P and C, with rates PIR and CIR, respectively.  The
   maximum size of the token bucket P is PBS and the maximum size of the
   token bucket C is CBS.

   The token buckets P and C are initially (at time 0) full, i.e., the
   token count Tp(0) = PBS and the token count Tc(0) = CBS.  Thereafter,
   the token count Tp is incremented by one PIR times per second up to
   PBS and the token count Tc is incremented by one CIR times per second
   up to CBS.

   When a packet of size B bytes arrives at time t, the following
   happens if the trTCM is configured to operate in the Color-Blind
   mode:

     o If Tp(t)-B < 0, the packet is red, else

     o if Tc(t)-B < 0, the packet is yellow and Tp is decremented by B,
       else

     o the packet is green and both Tp and Tc are decremented by B.

   When a packet of size B bytes arrives at time t, the following
   happens if the trTCM is configured to operate in the Color-Aware
   mode:

     o If the packet has been precolored as red or if Tp(t)-B < 0, the
       packet is red, else

     o if the packet has been precolored as yellow or if Tc(t)-B < 0,
       the packet is yellow and Tp is decremented by B, else

     o the packet is green and both Tp and Tc are decremented by B.

   The actual implementation of a Meter doesn't need to be modeled
   according to the above formal specification.

4. Marking

   The Marker reflects the metering result by setting the DS field of
   the packet to a particular codepoint.  In case of the AF PHB
   [Heinanen2], the color can be coded as the drop precedence of the
   packet.



Heinanen & Guerin     A Two Rate Three Color Marker             [Page 3]

INTERNET DRAFT                                               March, 1999


5. Service Example

   The trTCM can be used to mark a IP packet stream in a service, where
   different, decreasing levels of assurances (either absolute or
   relative) are given to packets which are green, yellow, or red.  For
   example, a service may discard all red packets, because they exceeded
   the peak rate, forward yellow packets as best effort, and forward
   green packets with a low drop probability.

6. Security Concerns

   The trTCM has no known security concerns.

7. References

   [Heinanen1] J. Heinanen and R. Guerin, A Single Rate Three Color
   Marker.  Internet draft draft-heinanen-diffserv-srtcm-00.txt, March
   1999.

   [Heinanen2] J. Heinanen, et al., Assured Forwarding PHB Group.
   Internet draft draft-ietf-diffserv-af-06.txt, February 1999.

   [Nichols] K. Nichols and B. Carpenter, Format for Diffserv Working
   Group Traffic Conditioner Drafts. Internet draft draft-ietf-diffserv-
   traffcon-format-00.txt, February 1999.

   [RFC2474] K. Nichols, et al., Definition of the Differentiated
   Services Field (DS Field) in the IPv4 and IPv6 Headers.  RFC 2474,
   December 1998.

   [RFC2475] S. Blake, et al., An Architecture for Differentiated
   Services. RFC 2475, December 1998.

8. Author Addresses

   Juha Heinanen
   Telia Finland, Inc.
   Myyrmaentie 2
   01600 Vantaa, Finland
   Email: jh@telia.fi

   Roch Guerin
   University of Pennsylvania
   Department of Electrical Engineering, Rm 367 GRW
   200 South 33rd Street
   Philadelphia, PA 19104
   Email: guerin@ee.upenn.edu




Heinanen & Guerin     A Two Rate Three Color Marker             [Page 4]

