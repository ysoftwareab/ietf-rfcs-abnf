<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>TLS Extension for Optimizing Application Protocols, Specifically SASL with GSS-API mechanisms</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="TLS Extension for Optimizing Application Protocols, Specifically SASL with GSS-API mechanisms">
<meta name="keywords" content="Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">N. Williams</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Sun</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">April 14, 2009</td></tr>
<tr><td class="header">Expires: October 16, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />TLS Extension for Optimizing Application Protocols, Specifically SASL with GSS-API mechanisms<br />draft-williams-tls-app-sasl-opt-02.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on October 16, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document specifies an extension to Transport Layer
		Security (TLS) for carrying application data which is
		suitable for delayed integrity protection and does not
		require privacy protection.  In particular we describe
		how to use this extension to reduce the number of
		round-trips needed for application-layer authentication,
		specifically Simple Authentication (SASL), and through
		it, Generic Security Services (GSS-API).  The use of
		this extension to optimize SASL/GSS-API authentication
		is termed "TLS/SA".
</p>
<p>This extension can also be used to optimize application
		protocols.  Optimizations for Simple Mail transfer
		Protocol (SMTP) and Light-weight Directory Access
		Protocol (LDAP) are described.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">1.1.</a>&nbsp;
Conventions used in this document<br />
<a href="#ext">2.</a>&nbsp;
TLS Extensions for Optimization of
	    SASL and Application protocols<br />
<a href="#anchor3">3.</a>&nbsp;
Using TLS/SA<br />
<a href="#anchor4">3.1.</a>&nbsp;
Optimizing SASL Mechanism Negotiation<br />
<a href="#anchor5">3.2.</a>&nbsp;
Optimizing Authentication<br />
<a href="#cbinding">3.2.1.</a>&nbsp;
Channel Binding<br />
<a href="#anchor6">4.</a>&nbsp;
Non-SASL Optimizations of Existing Application Protocols<br />
<a href="#anchor7">4.1.</a>&nbsp;
LDAP<br />
<a href="#anchor8">4.2.</a>&nbsp;
SMTP<br />
<a href="#anchor9">5.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor10">6.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">7.</a>&nbsp;
References<br />
<a href="#rfc.references1">7.1.</a>&nbsp;
Normative References<br />
<a href="#rfc.references2">7.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Many applications use TLS <a class='info' href='#RFC5246'>[RFC5246]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> and
		then Simple Authentication and Security Layers (SASL)
		<a class='info' href='#RFC4422'>[RFC4422]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a> on top of TLS.  This requires
		at least two round-trips for TLS, then one round-trip
		for SASL mechanism negotiation, then as many round-trips
		as the negotiated SASL mechanism requires.  One and a
		half of the TLS round-trips can carry extensions such
		that we could piggyback some application data on those
		TLS messages to save up to two round-trips.  This
		document specifies how to take advantage of TLS
		extensions to reduce the number of round-trips needed
		altogether.
</p>
<p>First we define a TLS extension for use in Client Hello
		and Handshake messages.  This extension will carry typed
		application data.  Then we describe how to reduce the
		number of round-trips for SASL applications.  And
		through the new SASL/GSS-API bridge <a class='info' href='#I-D.ietf-sasl-gs2'>[I&#8209;D.ietf&#8209;sasl&#8209;gs2]<span> (</span><span class='info'>Josefsson, S. and N. Williams, &ldquo;Using GSS-API Mechanisms in SASL: The GS2 Mechanism Family,&rdquo; January&nbsp;2010.</span><span>)</span></a> we obtain support for
		use of GSS-API <a class='info' href='#RFC2743'>[RFC2743]<span> (</span><span class='info'>Linn, J., &ldquo;Generic Security Service Application Program Interface Version 2, Update 1,&rdquo; January&nbsp;2000.</span><span>)</span></a> mechanisms as
		well.  <a class='info' href='#RFC2743'>[RFC2743]<span> (</span><span class='info'>Linn, J., &ldquo;Generic Security Service Application Program Interface Version 2, Update 1,&rdquo; January&nbsp;2000.</span><span>)</span></a> applications.
		Altogether we achieve a one and a half round-trip
		reduction for SASL applications.
</p>
<p>In the case of SASL applications we use the first TLS
		round-trip to optimize the SASL mechanism negotiation.
		Then we use the client's handshake message to send the
		first authentication message of the selected SASL
		mechanism.  Note that the TLS channel binding <a class='info' href='#RFC5056'>[RFC5056]<span> (</span><span class='info'>Williams, N., &ldquo;On the Use of Channel Bindings to Secure Channels,&rdquo; November&nbsp;2007.</span><span>)</span></a> can be made available at that
		time, thus no special considerations apply to how
		channel binding is done (but see <a class='info' href='#cbinding'>Section&nbsp;3.2.1<span> (</span><span class='info'>Channel Binding</span><span>)</span></a> below).  Use of channel binding
		protects against man-in-the-middle attacks, including
		downgrade attacks on mechanism negotiation.
</p>
<p>This extension is motivated by:

		</p>
<ul class="text">
<li>a desire to reduce the number of round-trips
			needed by SASL and GSS-API applications running
			over TLS;
</li>
<li>a desire to replace an earlier proposal for
			"TLS/GSS" with one that passes muster at the TLS
			WG;
</li>
<li>a desire to provide a profile that new
			applications may use for TLS with GSS-API for
			user authentication.
</li>
</ul><p>

	    
</p>
<p>The use of this extension to optimize SASL/GSS-API
		authentication is termed "TLS/SA".
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Conventions used in this document</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED",
		    "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
		    "RECOMMENDED", "MAY", and "OPTIONAL" in this
		    document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="ext"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
TLS Extensions for Optimization of
	    SASL and Application protocols</h3>

<p>When a client application wishes to exchange one or more
		application messages prior to the conclusion of a TLS
		exchange it uses the TLS Client Hello message extension
		to a) indicate its intention to the server, and b)
		optionally send the first application message to the
		server.  These messages will not have any privacy or
		integrity protection applied by TLS unless a
		ChangeCipherSpec has been done earlier (i.e., unless the
		application has already done one TLS handshake).
</p>
<p>When this message is received the server MUST either
		ignore the extension or pass it to the application,
		which then MUST respond to that application data via a
		new handshake message (see below).  If the server
		ignores it then the client will discover that the server
		does not support this extension when the client receives
		the server's handshake messages.  Otherwise there must
		be a corresponding application data handshake message in
		the server's response, and that indicates that the
		server TLS and application implementations support this
		extension.
</p>
<p>The extension contents are defined by the application.
		In order to save the application having to encode
		application data types and lengths we define two
		application data extension types and we allow the Client
		Hello to carry one of each of these extensions:

		</p>
<ul class="text">
<li>pfapp_data (&lt;TBD&gt;)
</li>
<li>sasl_sml_req (&lt;TBD&gt;)
</li>
</ul><p>

	    
</p>
<p>The "pf" prefix indicates "pre-Finished message
		exchange".  It is the application's responsibility to
		define the contents of the pfapp_data extension.
</p>
<p>The sasl_sml_req (SASL server mechanism list request)
		message contains an empty payload.
</p>
<p>We also define new Handshake messages that may be used
		after the Client Hello messages:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      enum {
          finished(20), pfapp_data(&lt;TBD&gt;),
          sasl_sml(&lt;TBD&gt;), sasl_msg(&lt;TBD&gt;), (255)
      } HandshakeType;

      struct {
          HandshakeType msg_type;    /* handshake type */
          uint24 length;             /* bytes in message */
          select (HandshakeType) {
              case hello_request:       HelloRequest;
              ...
              /* Application pre-Finished message data */
              case pfapp_data:         PFAppData;
              /* SASL server mechanism list */
              case sasl_sml:           SaslSML;
              /* SASL mechanism message */
              case sasl_msg:           SaslMsg;
          } body;
      } Handshake;

      opaque PFAppData&lt;2^16-1&gt;;
      opaque SaslSML&lt;2^16-1&gt;;
      opaque SaslMsg&lt;2^16-1&gt;;
</pre></div>
<p>A generic application protocol using these extensions
		might look like:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   Client                                               Server

   ClientHello w/ sasl_sml_req --------&gt;
                                                   ServerHello
                                                      SaslSML*
                                                  Certificate*
                                            ServerKeyExchange*
                                           CertificateRequest*
                                &lt;--------      ServerHelloDone
   Certificate*
   ClientKeyExchange
   CertificateVerify*
   SaslMsg*
   [ChangeCipherSpec]
   Finished                     --------&gt;
                                            [ChangeCipherSpec]
                                &lt;--------             Finished
   SASL auth messages           &lt;-------&gt;   SASL auth messages
   Application Data             &lt;-------&gt;     Application Data

</pre></div>
<p>Note that the SaslMsg in the client's handshake MUST NOT
		be included in the client's Finisshed message
		construction.  See <a class='info' href='#cbinding'>Section&nbsp;3.2.1<span> (</span><span class='info'>Channel Binding</span><span>)</span></a> for more
		information.  [An alternative to this oddity would be to
		allow application data to be sent by the client after
		sending the client's Finished message but before
		receiving the server's Finished message.  I'm not sure
		which of these two options might be the most
		controversial, but I'd be happy with either. -Nico]
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Using TLS/SA</h3>

<p>"TLS/SA" is the name given to the use of the
		sasl_sml_req, SaslSML and SaslMsg TLS extensions to
		perform SASL authentication in a round-trip optimized
		manner over TLS.  Only SASL/GS2 <a class='info' href='#I-D.ietf-sasl-gs2'>[I&#8209;D.ietf&#8209;sasl&#8209;gs2]<span> (</span><span class='info'>Josefsson, S. and N. Williams, &ldquo;Using GSS-API Mechanisms in SASL: The GS2 Mechanism Family,&rdquo; January&nbsp;2010.</span><span>)</span></a> mechanisms may be
		optimized.
</p>
<p>In order to use SASL via this extension it's important to
		define how the client requests authentication, how it
		sends its first message (SASL/GS2 mechanisms are always
		client-speaks-first mechanisms), and how the SASL
		exchange continues after the TLS handshake finishes.  It
		is also important to explain how existing SASL
		applications, such as IMAP, POP3, SMTP, LDAP, etcetera,
		will use this extension.  We do this in the following
		two sections.
</p>
<p>Application protocols may differ from the protocol
		described below where specifically allowed, but all of
		the following is NORMATIVE for IMAP, POP3, SMTP, and
		LDAP.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Optimizing SASL Mechanism Negotiation</h3>

<p>A client wishing to optimize SASL mechanism
		    negotiation MUST send a sasl_sml_req extension in
		    the client's TLS Hello message.  The client MUST NOT
		    send a payload in its sasl_sml_req client hello
		    extension.
</p>
<p>If the server supports SASL mechanism negotiation
		    optimization and the server's mechanisl list is
		    shorter than 2^16 - 1 bytes then the server MUST
		    include a SaslSML message in its reply to the
		    client.  The payload of the server's SaslSML message
		    MUST be a comma-separated list of SASL mechanism
		    names (note: no NUL terminator is needed, but if
		    present the client MUST ignore the NUL).
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Optimizing Authentication</h3>

<p>A client wishing to optimize a SASL/GS2 mechanism
		    whose first message is shorter than 2^16 - 2 -
		    length of SASL mechanism name bytes MUST: a) use
		    channel binding, b) send the mechanism's first
		    message in the client's SaslMsg handshake message,
		    and c) it MUST prefix the mechanism's first message
		    with the SASL name of the mechanism and a
		    zero-valued byte:
		    "&lt;mech-name&gt;&lt;NUL&gt;&lt;mech-message&gt;.
		    Note that any replies to this message will be in the
		    form of application data in the record protocol, the
		    form of which may differ by application, though
		    below we define a generic form.
</p>
<p>After the TLS handshake finishes the application must
		    continue exchanging SASL messages: any mechanism
		    messages and, finally, the outcome of authentication
		    exchange message.  SASL requires that applications
		    define how to frame and encode these messages.  Here
		    we provide an example of how applications SHOULD do
		    it, though applications are free to use their own
		    framing and encoding.  IMAP, POP3, SMTP and LDAP
		    MUST, when using this extension, do as described
		    below.
</p>
<p>For any SASL mechanism authentication messages
		    subsequent to the initial message the application
		    MUST send a network byte order, four byte unsigned
		    binary length of the mechanism message followed by
		    the mechanism message as-is.  Messages longer than
		    2^24 MUST NOT be sent.  Where empty messages are
		    required by the SASL mechanism the application
		    should send a zero-valued length and an empty
		    message.
</p>
<p>The server's successful "outcome of authentication
		    exchange" message MUST consist of four bytes with
		    all bits set followed by a network byte order four
		    byte unsigned binary length of supplementary
		    information to be defined by the application.
</p>
<p>Whereas a server's failed authentication message MUST
		    consist of four bytes in network byte order with the
		    high bit set and the remaining bits cleared,
		    followed by a network byte order four byte unsigned
		    binary length of supplementary information to be
		    defined by the application.
</p>
<p>If the last message of the SASL mechanism used is
		    sent by the server then the server's outcome of
		    authentication message MUST immediately follow the
		    last mechanism message.  That is: there is no need
		    for the client to send an empty message in response
		    to the last mechanism message just to get the
		    outcome of authentication message.  This saves
		    another round-trip.
</p>
<p>Typically the supplementary information will be a
		    character string meant for the user to read; the
		    language and encoding may be application dependent
		    or negotiated by the SASL mechanism but, unless
		    specified otherwise by the application, the encoding
		    MUST be UTF-8.
</p>
<p>If the SASL authentication exchange ends successfully
		    then the application protocol takes over as it is
		    normally specified, but with the user already
		    authenticated, thus there should be no need to use
		    SASL authentication as normally specified for the
		    application (unless there is a need to
		    re-authenticate, possibly as a different user).  If
		    the SASL authentication exchange ends unsuccessfully
		    then the application protocol takes over as it is
		    normally specified, with the user not authenticated,
		    at which point the client MAY re-try
		    authentication.
</p>
<p>With a one round trip SASL/GS2 mechanism the protocol
		    then looks like:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   Client                                               Server

   ClientHello w/ sasl_sml_req --------&gt;
                                                   ServerHello
                                                       SaslSML
                                                  Certificate*
                                            ServerKeyExchange*
                                           CertificateRequest*
                                &lt;--------      ServerHelloDone
   Certificate*
   ClientKeyExchange
   CertificateVerify*
   SaslMsg
   [ChangeCipherSpec]
   Finished                     --------&gt;
                                            [ChangeCipherSpec]
                                &lt;--------             Finished
                                &lt;--------        SASL auth msg
                                                   as app data
                                &lt;--------      Outcome of SASL
                                                authentication
   Application Data             &lt;-------&gt;     Application Data

</pre></div>
<p>With a one and one half round trip mechanism the
		    protocol looks like:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   Client                                               Server

   ClientHello w/ sasl_sml_req --------&gt;
                                                   ServerHello
                                                       SaslSML
                                                  Certificate*
                                            ServerKeyExchange*
                                           CertificateRequest*
                                &lt;--------      ServerHelloDone
   Certificate*
   ClientKeyExchange
   CertificateVerify*
   SaslMsg
   [ChangeCipherSpec]
   Finished                     --------&gt;
                                            [ChangeCipherSpec]
                                &lt;--------             Finished
                                &lt;--------        SASL auth msg
                                                   as app data
   SASL auth msg as app data    --------&gt;
                                &lt;--------      Outcome of SASL
                                                authentication
   Application Data             &lt;-------&gt;     Application Data

</pre></div>
<p>And with a two round trip mechanism the protocol
		    looks like:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   Client                                               Server

   ClientHello w/ sasl_sml_req --------&gt;
                                                   ServerHello
                                                       SaslSML
                                                  Certificate*
                                            ServerKeyExchange*
                                           CertificateRequest*
                                &lt;--------      ServerHelloDone
   Certificate*
   ClientKeyExchange
   CertificateVerify*
   SaslMsg
   [ChangeCipherSpec]
   Finished                     --------&gt;
                                            [ChangeCipherSpec]
                                &lt;--------             Finished
                                &lt;--------        SASL auth msg
                                                   as app data
   SASL auth msg as app data    --------&gt;
                                &lt;--------        SASL auth msg
                                                   as app data
                                &lt;--------      Outcome of SASL
                                                authentication
   Application Data             &lt;-------&gt;     Application Data

</pre></div>
<a name="cbinding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
Channel Binding</h3>

<p>The TLS channel binding types that are suitable
			for use with SASL in this facility are:

			</p>
<ul class="text">
<li>tls-server-end-point
</li>
<li>tls-unique
</li>
</ul><p>

		    
</p>
<p>See the IANA channel binding type registry for
			more information about these channel binding
			types.  The channel binding type to use is to be
			selected as described in <a class='info' href='#I-D.ietf-sasl-channel-bindings'>[I&#8209;D.ietf&#8209;sasl&#8209;channel&#8209;bindings]<span> (</span><span class='info'>Williams, N., &ldquo;SASL And Channel Binding,&rdquo; April&nbsp;2009.</span><span>)</span></a>
			(namely: if there is a server certificate, then
			use tls-server-end-point, else use
			tls-unique).
</p>
<p>Note that the application has to construct its
			first SASL authentication message for sending in
			the same half-round trip as the client's
			Finished message, yet the client's Finished
			message is used in the tls-unique channel
			binding type.  This means that the Finished
			message MUST be constructed before the client's
			SaslMsg, and the SaslMsg is not integrity
			protected by the client's Finished message,
			though it will be integrity protected by the
			server's Finished message.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Non-SASL Optimizations of Existing Application Protocols</h3>

<p>In this section and its sub-sections we INFORMATIVELY how
		a number of existing TLS application protocols might be
		modified to take advantage of the application data
		extension for optimization of the application
		protocol.
</p>
<p>It is crucial that clients only use the pfapp_data
		extension for operations that do not require that the
		user already be authenticated (the server application
		MUST reject such uses of pfapp_data) or that require
		privacy protection.  There are no operations in IMAP and
		POP3, for example, which are suitable for optimization
		via pfapp_data, but there are for SMTP and LDAP.  That's
		because IMAP and POP3 deal exclusively with user data,
		while SMTP and LDAP have some operations or objects
		which can be executed publicly and without user
		authentication (see below).
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
LDAP</h3>

<p>In the case of LDAP the pfapp_data extension can be
		    used to send a single LDAP message, typically a
		    search for the root DSE object.  If the server
		    supports this extension then the pfapp_data
		    handshake message can be used to return the result.
		    If the server does not support this extension then
		    the client can repeat its search after the TLS
		    handshake is completed and the TLS record protocol
		    begins to operate.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
SMTP</h3>

<p>Clients may use the pfapp_data extension to send a
		    EHLO SMTP command to the server, and the server may
		    send the SMTP reply to it in a pfapp_data handshake
		    message.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>When this document is approved for the Standards-Track
		the &lgt;TBD&gt; values above will be filled in and the
		IANA TLS ExtensionType and HandshakeType registries will
		have to be updated to reflect these assignments.  (These
		registries require IETF Consensus and Standards action,
		respectively.)
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>The security considerations of <a class='info' href='#RFC4422'>[RFC4422]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a>,
		<a class='info' href='#I-D.ietf-sasl-channel-bindings'>[I&#8209;D.ietf&#8209;sasl&#8209;channel&#8209;bindings]<span> (</span><span class='info'>Williams, N., &ldquo;SASL And Channel Binding,&rdquo; April&nbsp;2009.</span><span>)</span></a>, <a class='info' href='#RFC5246'>[RFC5246]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> and <a class='info' href='#RFC5056'>[RFC5056]<span> (</span><span class='info'>Williams, N., &ldquo;On the Use of Channel Bindings to Secure Channels,&rdquo; November&nbsp;2007.</span><span>)</span></a>
		apply, as do those of <a class='info' href='#RFC2743'>[RFC2743]<span> (</span><span class='info'>Linn, J., &ldquo;Generic Security Service Application Program Interface Version 2, Update 1,&rdquo; January&nbsp;2000.</span><span>)</span></a> when used
		via the SASL/GS2 bridge <a class='info' href='#I-D.ietf-sasl-gs2'>[I&#8209;D.ietf&#8209;sasl&#8209;gs2]<span> (</span><span class='info'>Josefsson, S. and N. Williams, &ldquo;Using GSS-API Mechanisms in SASL: The GS2 Mechanism Family,&rdquo; January&nbsp;2010.</span><span>)</span></a>.
</p>
<p>As usual with TLS there is no privacy protection of
		client identity unless the client first completes a
		handshake without authenticating itself, changes the
		cipher spec, then initiates a new handshake where it
		does authenticate itself.  In this case, client
		authentication being done via SASL, this means not
		sending a SaslMsg until after the initial
		ChangeCipherSpec exchange.
</p>
<p>The initial SASL authentication message is not protected
		by the TLS client's Finished message, but it is
		protected by the server's Finished message.  Channel
		binding must be used in the optimized authentication
		case.  Therefore the server can detect modifications to
		the initial SASL authentication message to the best of
		the selected SASL mechanism's ability, and the client
		can detect modifications to its initial SASL
		authentication message through the server's TLS Finished
		message.
</p>
<p>The SASL mechanism negotiation is protected by the TLS
		Finished messages.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sasl-channel-bindings">[I-D.ietf-sasl-channel-bindings]</a></td>
<td class="author-text">Williams, N., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sasl-channel-bindings-03.txt">SASL And Channel Binding</a>,&rdquo; draft-ietf-sasl-channel-bindings-03 (work in progress), April&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sasl-channel-bindings-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4422">[RFC4422]</a></td>
<td class="author-text">Melnikov, A. and K. Zeilenga, &ldquo;<a href="http://tools.ietf.org/html/rfc4422">Simple Authentication and Security Layer (SASL)</a>,&rdquo; RFC&nbsp;4422, June&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4422.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5056">[RFC5056]</a></td>
<td class="author-text">Williams, N., &ldquo;<a href="http://tools.ietf.org/html/rfc5056">On the Use of Channel Bindings to Secure Channels</a>,&rdquo; RFC&nbsp;5056, November&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc5056.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[RFC5246]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5246.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sasl-gs2">[I-D.ietf-sasl-gs2]</a></td>
<td class="author-text">Josefsson, S. and N. Williams, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sasl-gs2-20.txt">Using GSS-API Mechanisms in SASL: The GS2 Mechanism Family</a>,&rdquo; draft-ietf-sasl-gs2-20 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sasl-gs2-20.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2743">[RFC2743]</a></td>
<td class="author-text"><a href="mailto:jlinn@rsasecurity.com">Linn, J.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2743">Generic Security Service Application Program Interface Version 2, Update 1</a>,&rdquo; RFC&nbsp;2743, January&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2743.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nicolas
            Williams</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sun Microsystems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">5300 Riata Trace Ct</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Austin, TX  78727</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Nicolas.Williams@sun.com">Nicolas.Williams@sun.com</a></td></tr>
</table>
</body></html>
