<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Make TCP more Robust to Long Connectivity Disruptions</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Make TCP more Robust to Long Connectivity Disruptions">
<meta name="keywords" content="Transmission Control Protocol (TCP),
        Internet Control Message Protocol (ICMP), Long Connectivity
        Disruption">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">A. Zimmermann</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">A. Hannemann</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">RWTH Aachen University</td></tr>
<tr><td class="header">Expires: August 1, 2009</td><td class="header">January 28, 2009</td></tr>
</table></td></tr></table>
<h1><br />Make TCP more Robust to Long Connectivity Disruptions<br />draft-zimmermann-tcp-lcd-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 1, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>TCP was designed with fixed, wired networks in mind. As a result
            TCP performs suboptimal in networks where connectivity disruptions
            are frequent, e.g., in wireless (multi-hop) networks. One reason for
            the performance degradation is TCP's over-conservative behavior in
            face of long connectivity disruptions.
</p>
<p>This document describes how connectivity disruption indications
            provided by standard ICMP messages may be exploited to improve TCP's
            performance. An RTO revert strategy is proposed that enables earlier
            detection of whether connectivity to a previously disconnected peer
            node has been restored or not. The scheme is a sender only
            modification which fully respects the TCP congestion control
            principles.
</p>
<a name="anchor1"></a><br /><hr />
<a name="rfc.section.1"></a><h3>1.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
            "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
            document are to be interpreted as described in
            <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>The term "acceptable acknowledgment (ACK)" in this document
            refers to a TCP segment that acknowledges previously unacknowledged
            data (as defined in <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>). The Transmission
            Control Protocol (TCP) sender state variable "SND.UNA" and the
            current segment variable "SEG.SEQ" are used as defined in <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>. SND.UNA holds the segment sequence number of
            the oldest outstanding segment. SEG.SEQ is the segment sequence
            number of a given segment.
</p>
<a name="introduction"></a><br /><hr />
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p>Connectivity disruptions can occur in many different situation.
            The frequency of the connectivity disruptions depend thereby on the
            property of the end-to-end path between the communicating hosts.
            While connectivity disruptions can occur in traditional wired
            networks too, e.g., simply due to an unplugged network cable, the
            likelihood of occurrence is significant higher in wireless
            (multi-hop) networks. Especially, end-host mobility and wireless
            interferences are crucial factors. In the case the hosts use the
            Transmission Control Protocol (TCP) <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> for
            their communication, the performance of the connection can exhibit
            a significant reduction compared to a permanently connected path
            <a class='info' href='#SESB05'>[SESB05]<span> (</span><span class='info'>Schuetz, S., Eggert, L., Schmid, S., and M. Brunner, &ldquo;Protocol enhancements for intermittently connected                     hosts,&rdquo; December&nbsp;2005.</span><span>)</span></a>.
</p>
<p>According to Schuetz et. al.
            <a class='info' href='#I-D.schuetz-tcpm-tcp-rlci'>[I&#8209;D.schuetz&#8209;tcpm&#8209;tcp&#8209;rlci]<span> (</span><span class='info'>Schuetz, S., Koutsianas, N., Eggert, L., Eddy, W., Swami, Y., and K. Le, &ldquo;TCP Response to Lower-Layer Connectivity-Change Indications,&rdquo; February&nbsp;2008.</span><span>)</span></a> connectivity disruptions
            can be classified into two groups: "short" and "long" connectivity
            disruptions. A connectivity disruption is short if connectivity
            returns before the retransmission timeout (RTO) fires for the first
            time. In this case, TCP recovers lost data segments through Fast
            Retransmit and lost ACKs through successfully delivered later ACKs.
            Connectivity disruptions are declared as long for a given TCP
            connection, if the RTO fires at least once before connectivity
            returns. Whether or not path characteristics have changed when the
            connectivity returns after a disruption is second important aspect
            for TCP's retransmission scheme
            <a class='info' href='#I-D.schuetz-tcpm-tcp-rlci'>[I&#8209;D.schuetz&#8209;tcpm&#8209;tcp&#8209;rlci]<span> (</span><span class='info'>Schuetz, S., Koutsianas, N., Eggert, L., Eddy, W., Swami, Y., and K. Le, &ldquo;TCP Response to Lower-Layer Connectivity-Change Indications,&rdquo; February&nbsp;2008.</span><span>)</span></a>.
</p>
<p>This memo will focus on TCP's behavior in face of long
            connectivity disruptions in the time "before" connectivity is
            restored. Moreover, this document does not describe any additional
            optimization to detect if the path characteristics remain
            unchanged. Therefore, TCP's RTO based Loss Recovery and in particular
            Slow-Start <a class='info' href='#RFC2581'>[RFC2581]<span> (</span><span class='info'>Allman, M., Paxson, V., and W. Stevens, &ldquo;TCP Congestion Control,&rdquo; April&nbsp;1999.</span><span>)</span></a>  will be unchanged.
</p>
<p>When a long connectivity disruption occurs on path between two
            communicating hosts, the TCP sender stops receiving ACKs. After
            expiration of the RTO the TCP sender will repeatedly retransmit the
            first unacknowledged segment (SND.UNA) until it is successfully
            acknowledged. TCP implementations that follow the recommended RTO
            management proposed in RFC 2988 <a class='info' href='#RFC2988'>[RFC2988]<span> (</span><span class='info'>Paxson, V. and M. Allman, &ldquo;Computing TCP's Retransmission Timer,&rdquo; November&nbsp;2000.</span><span>)</span></a> double the
            RTO value after each retransmission attempt. However, the RTO growth
            may be bounded by an upper limit maximum RTO, which is at least 60s,
            but may be longer: Linux for example uses 120s. If the connectivity
            is restored between two retransmission attempts, a TCP still have to
            wait until the RTO expires before resuming transmission, since TCP
            simply does not have any means to know that the connectivity is
            re-established. Therefore, depending on when connectivity becomes
            available again, this can waste up to maximum RTO of possible
            transmission time.
</p>
<p>This retransmission behavior is not efficient, especially in
            scenarios or networks like wireless (multi-hop) networks where
            connectivity disruptions are frequent. In the ideal case, TCP would
            attempt a retransmission as soon as connectivity to its peer was
            re-established. In this document a method how the standard Internet
            Control Message Protocol (ICMP) can be exploited to improve TCP's
            performance is described. The presented scheme is a sender only
            modification, i.e., neither intermediate routers nor the TCP receiver
            have to be modified. Furthermore, the proposed modification
            approaches the ideal behavior, if the network allows for it (i.e.,
            no congestion is present). By an RTO revert strategy,
            higher-frequency retransmissions can be realized to enable earlier
            detection of whether connectivity to a previously disconnected peer
            node has been restored.
</p>
<a name="cdi"></a><br /><hr />
<a name="rfc.section.3"></a><h3>3.&nbsp;
Connectivity Disruption Indication</h3>

<p>As long as the queue of a router experiencing a link outage is
            deep enough, i.e., it can buffer all incoming packets, a connectivity
            disruption will only cause variation in delay which is handled well
            by a contemporary TCP with the help of Eifel <a class='info' href='#RFC3522'>[RFC3522]<span> (</span><span class='info'>Ludwig, R. and M. Meyer, &ldquo;The Eifel Detection Algorithm for TCP,&rdquo; April&nbsp;2003.</span><span>)</span></a>
            or forward RTO (F-RTO) <a class='info' href='#RFC4138'>[RFC4138]<span> (</span><span class='info'>Sarolahti, P. and M. Kojo, &ldquo;Forward RTO-Recovery (F-RTO): An Algorithm for Detecting Spurious Retransmission Timeouts with TCP and the Stream Control Transmission Protocol (SCTP),&rdquo; August&nbsp;2005.</span><span>)</span></a>. However, if the link
            outage lasts too long, the router experiencing the link outage is
            forced to drop packets and finally to discard the according route.
            Means to detect such link outages comprise reacting on failed address
            resolution protocol (ARP) queries, unsuccessful link sensing, and the
            like. However, this is solely in the responsibility of the respective
            router.

            </p>
<blockquote class="text">
<p>Note: The focus of this memo is on introducing a method how
                ICMP messages may be exploited to improve TCP's performance; how
                different physical-and link layer mechanisms underneath the
                network layer may trigger ICMP destination unreachable messages
                are out of scope of this memo.
</p>
</blockquote><p>
            
</p>
<p>The removal of the route usually goes along with a notification
            to the corresponding TCP source about the dropped packets via ICMP
            destination unreachable messages of code 0 (net unreachable) or code
            1 (host unreachable) <a class='info' href='#RFC1812'>[RFC1812]<span> (</span><span class='info'>Baker, F., &ldquo;Requirements for IP Version 4 Routers,&rdquo; June&nbsp;1995.</span><span>)</span></a>. Therefore, since ICMP
            destination unreachable messages of these codes are evidence that
            packets were dropped due to a link outage, they can be interpreted
            as a connectivity disruption indication.
</p>
<p>Note that there are also other ICMP destination unreachable
            messages with different codes. Some of them are candidates for
            connectivity disruption indications too, but need further
            investigation. For example ICMP destination unreachable messages
            with code 5 (source route failed), code 11 (net unreachable for TOS),
            or code 12 (host unreachable for TOS). On the other side codes that
            flag hard errors <a class='info' href='#RFC1122'>[RFC1122]<span> (</span><span class='info'>Braden, R., &ldquo;Requirements for Internet Hosts - Communication Layers,&rdquo; October&nbsp;1989.</span><span>)</span></a> are of no use for the
            proposed scheme. In the following, the term "ICMP unreachable
            message" is used as synonym for ICMP destination unreachable
            messages of code 0 or code 1.
</p>
<p>A router experiencing a link outage is an obvious candidate for
            being heavily congested because it is not just unable to forward
            packets fast enough, it is even unable to forward packets at all.
            Therefore, TCP's exponential back-off may seem appropriate. However,
            taking into account the congestion control principles
            <a class='info' href='#RFC2914'>[RFC2914]<span> (</span><span class='info'>Floyd, S., &ldquo;Congestion Control Principles,&rdquo; September&nbsp;2000.</span><span>)</span></a>, i.e., congestion is indicated by packet
            loss, receiving an ICMP unreachable message might be an indication
            that there is no congestion. For instance, when a (re-)transmission
            is replied to with an ICMP unreachable message, this is a strong
            indication that there is no congestion in the network - at least on
            that very part of the path which was traveled by both, the TCP
            segment eliciting the ICMP unreachable message as well as the ICMP
            unreachable message itself. Therefore, it seems a little bit harsh
            for TCP to back-off as if there was true congestion.
</p>
<p>The accurate interpretation of ICMP unreachable messages as
            an connectivity disruption indication is complicated by the following
            two peculiarities of ICMP messages. Firstly, they do not necessarily
            operate on the same timescale as the packets, i.e., in the given case
            TCP segments, which elicited them. When a router drops a packet due
            to a missing route it will not necessarily send an ICMP unreachable
            message immediately, but rather queues it for later delivery.
            Secondly, ICMP messages are subject to rate limiting, e.g., when a
            router drops a whole window of data due to a link outage, it will
            hardly send as many ICMP unreachable messages as it dropped
            TCP segments. Depending on the load of the router it may even send
            no ICMP unreachable messages at all. Both peculiarities originate
            from RFC 1812 <a class='info' href='#RFC1812'>[RFC1812]<span> (</span><span class='info'>Baker, F., &ldquo;Requirements for IP Version 4 Routers,&rdquo; June&nbsp;1995.</span><span>)</span></a>.
</p>
<p>Fortunately, according to RFC 792 <a class='info' href='#RFC0792'>[RFC0792]<span> (</span><span class='info'>Postel, J., &ldquo;Internet Control Message Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> ICMP
            unreachable messages are obliged to contain in their body the
            Internet Protocol (IP) header of the datagram eliciting the ICMP
            unreachable messages plus the first 64 bits of the payload of that
            datagram, i.e., in case of a TCP segment both port numbers and the
            sequence number. This allows the originating TCP to identify the
            connection which an ICMP unreachable message is reporting an
            error about. Moreover, it allows the originating TCP to identify
            which segment of the respective connection triggered the ICMP
            unreachable message, provided that there are not several segments
            in flight with the same sequence number. This may very well be the
            case when TCP is recovering lost segments.
</p>
<a name="cdr"></a><br /><hr />
<a name="rfc.section.4"></a><h3>4.&nbsp;
Connectivity Disruption Reaction</h3>

<p>The complete algorithm is specified in <a class='info' href='#cdr_alg'>Section&nbsp;4.1<span> (</span><span class='info'>The Algorithm</span><span>)</span></a>.
            In section <a class='info' href='#cdr_exp'>Section&nbsp;4.2<span> (</span><span class='info'>The Algorithm in Detail</span><span>)</span></a>, the different steps of the
            algorithm are discussed in detail.
            
</p>
<a name="cdr_alg"></a><br /><hr />
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
The Algorithm</h3>

<p>The following scheme MAY be used by a TCP sender to avoid
                over-conservative back-offs of the retransmission timer in the
                case of long connectivity disruptions:

                    </p>
<blockquote class="text"><dl>
<dt>(1)</dt>
<dd>Set a "UndoBackOff" variable to UNPROVED (equal 0)
                            
<blockquote class="text">
<p>UndoBackOff := UNPROVED.
</p>
</blockquote>
                        
</dd>
<dt>(2)</dt>
<dd>Wait for the expiration the retransmission timer,
                        proceed  to step (RTO).
</dd>
<dt>(3)</dt>
<dd>Wait either
                            
<blockquote class="text">
<p>for the arrival of an acceptable ACK. When an
                                acceptable ACK has arrived, proceed to step
                                (ACK),
</p>
<p>or for the arrival of an ICMP destination
                                unreachable message. When ICMP destination
                                unreachable message has arrived, proceed to
                                step (4),
</p>
<p>or for the expiration the retransmission
                                timer, proceed to step (RTO).
</p>
</blockquote>
                        
</dd>
<dt>(4)</dt>
<dd>Extract the TCP segment header included in the ICMP
                        destination unreachable message
                            
<blockquote class="text">
<p>SEG := Extract(ICMP_MSG).
</p>
</blockquote>
                        
</dd>
<dt>(5)</dt>
<dd>If "SEG.SEQ == SND.UNA", i.e., ICMP unreachable
                        message reports on a retransmission, then
                            
<blockquote class="text">
<p>If "UndoBackOff ==  UNPROVED", then set the
                                "UndoBackOff" variable to PROVED (equal 1)
                                    </p>
<blockquote class="text">
<p>UndoBackOff := PROVED.
</p>
</blockquote>
                                

<p>else revert one RTO back-off
                                    </p>
<blockquote class="text">
<p>RTO := max(MINIMUM_RTO, RTO / 2).
</p>
</blockquote>
                                

</blockquote>
                        
</dd>
<dt>(6)</dt>
<dd>Proceed to step (3).
</dd>
</dl></blockquote><p>

                    </p>
<blockquote class="text"><dl>
<dt>(RTO)</dt>
<dd>This is a placeholder for the
                        standard TCP behavior that must be executed at this
                        point in the case the retransmission timer is expired.
                        Proceed to step (3).
</dd>
<dt>(ACK)</dt>
<dd>This is a placeholder for the
                        standard TCP behavior that must be executed at this
                        point in the case an acceptable ACK is arrived. Proceed
                        to step (1).
</dd>
</dl></blockquote><p>
                
</p>
<a name="cdr_exp"></a><br /><hr />
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
The Algorithm in Detail</h3>

<p>When an RTO expires a TCP marks all outstanding segments as
                lost, sets the congestion window (CWND) to one segment,
                back-offs the RTO, and retransmits the first unacknowledged
                segment SND.UNA (step 2). If the RTO expires again a TCP will
                repeat the retransmission of the first unacknowledged segment
                and back-off again (step 3c). This pattern will be repeated as
                long as no packet arrives or until the maximum RTO expired.
</p>
<p>If the first received packet after the retransmission(s) is
                an acceptable ACK (step 3a), a TCP will proceed as normal, i.e.,
                slow-start the connection. It ignores later ICMP unreachable
                messages from the window of data which experienced RTO. Late
                ICMP unreachable messages are of no use as the ACK clock is
                already restarting due to the successful retransmission.
</p>
<p>On the other side if the first received packet after the
                retransmission(s) is an ICMP unreachable message, a TCP SHOULD
                revert one back-off for each ICMP unreachable message reporting
                an error on a retransmission. To decide if an ICMP unreachable
                message reports on a retransmission, the sequence number therein
                is exploited (step 4, step 5).
</p>
<p>Nevertheless, the first unacknowledged sequence number is
                suffering from the ambiguity if it refers to the original
                transmission or to any of the retransmissions. To be
                conservative, it should be considered to belong to the original
                transmission (step 5a). However, for each next ICMP unreachable
                message reporting on the retransmission, TCP SHOULD revert one
                back-off (step 5b).
</p>
<p>Upon receipt of an ICMP unreachable message which legitimately
                reverts one back-off there is the possibility that this new RTO
                has expired already. Then, a TCP SHOULD retransmit immediately,
                i.e., an ICMP message clocked retransmission. In case the new
                RTO has not expired yet, TCP MUST wait accordingly.
</p>
<a name="discussion"></a><br /><hr />
<a name="rfc.section.5"></a><h3>5.&nbsp;
Discussion</h3>

<p>Apart from the possibility to receive ICMP unreachable messages
            reporting on the sequence number of the retransmission, there might
            as well arrive ICMP unreachable messages reporting on the original
            window of data while a TCP is in RTO induced recovery. As TCP
            cannot decide by a single or a few ICMP unreachable messages if the
            whole window of data was dropped because of a link outage, there is
            the option that at least one of the segments was dropped due to true
            congestion in the network, calling for back-off. Therefore, to be
            conservative, a TCP MUST NOT revert the back-off in such a case
            (step 5a). Although, there is still the unlikely possibility that
            the intermediate router indeed sends an ICMP unreachable message for
            each dropped segment. Then, TCP should be allowed to even revert the
            first back-off. However, as this case is very unlikely and requires
            one more state variable to detect it is not recommended in this
            document.
</p>
<p>Besides the ambiguity if the first unacknowledged sequence number
            refers to the original transmission or to any of the retransmissions,
            there is another source of ambiguity about the sequence numbers
            contained in the ICMP unreachable messages. For high bandwidth paths
            like modern gigabit links the sequence space may wrap rather quickly,
            thereby allowing the possibility that a late ICMP unreachable message
            reporting on an old error may coincidentally fit as input in the
            scheme explained above. As a result, the scheme would wrongly revert
            one back-off. However, chances for this to happen are minuscule.
            Moreover, as the scheme is tailored most conservatively no threat to
            the network from this issues may arise.
</p>
<p>Finally, the scheme explicitly does not call for a differentiation
            of ICMP unreachable messages originating from different routers, as
            the evidence of no congestion still holds even if the reporting
            router changed.
</p>
<p>Another exploitation of ICMP unreachable messages in the context
            of TCP congestion control might seem appropriate in case the ICMP
            unreachable message is received while TCP is in steady-state and the
            message refers to a segment from within the current window of data.
            As the round trip time (RTT) up to the router which generates the
            ICMP unreachable message is likely to be substantially shorter than
            the overall RTT to the destination, the ICMP unreachable message may
            very well reach the originating TCP while it is transmitting the
            current window of data. In case the remaining window is large, it
            might seem appropriate to refrain from transmitting the remaining
            window as there is timely evidence that it will only trigger further
            ICMP unreachable messages at the very router. Although this might
            seem appropriate from a wastage perspective, it may be
            counterproductive from a security perspective since ICMP messages
            are easy to spoof, thereby allowing an easy attack to the TCP by
            simply forging such ICMP messages.
</p>
<p>An additional consideration is the following: in the presence of
            multi-path routing even the receipt of a legitimate ICMP unreachable
            message cannot be exploited accurately because there is the option
            that only one of the multiple paths to the destination is suffering
            from a connectivity disruption which causes ICMP unreachable messages
            to be sent. Then however, there is the possibility that the path
            along which the connectivity disruption occurred contributed
            considerably to the overall bandwidth, such that a congestion
            response is very well reasonable. However, this is not necessarily
            the case. Therefore, a TCP has no means except for its inherent
            congestion control to decide on this matter. All in all, it seems
            that for a connection in steady-state, i.e., not in RTO induced
            recovery, reacting on ICMP unreachable messages in regard to
            congestion control is not appropriate. For the case of RTO-based
            retransmissions, however, there is a reasonable congestion response,
            which is skipping further back-off of the RTO because there is no
            congestion indication - as described above.
</p>
<a name="related_work"></a><br /><hr />
<a name="rfc.section.6"></a><h3>6.&nbsp;
Related Work</h3>

<p>In literature there are several methods, which address TCP's
            problems in the presence of connectivity disruptions. Some of them
            try to improve TCP's performance by modifying the lower layers. For
            example <a class='info' href='#SM03'>[SM03]<span> (</span><span class='info'>Scott, J. and G. Mapp, &ldquo;Link layer-based TCP optimisation for disconnecting                     networks,&rdquo; October&nbsp;2003.</span><span>)</span></a> introduces a "smart link layer" 
            that buffers one segment for each ongoing connection and replaying
            these segments on connectivity reestablishment. This approach has a
            serious drawback: previously state-less intermediate routers have to
            be modified in order to inspect TCP headers, track the end-to-end
            connection and to provide additional buffer space that lead all in
            all to an additional need of memory and processing power.
</p>
<p>On the other hand stateless link layer schemes, like proposed in
            RFC&nbsp;3819 <a class='info' href='#RFC3819'>[RFC3819]<span> (</span><span class='info'>Karn, P., Bormann, C., Fairhurst, G., Grossman, D., Ludwig, R., Mahdavi, J., Montenegro, G., Touch, J., and L. Wood, &ldquo;Advice for Internet Subnetwork Designers,&rdquo; July&nbsp;2004.</span><span>)</span></a>, which unconditionally buffer some
            small number of packets may have another problem: if a packet is
            buffered longer than the maximum segment lifetime (MSL) of
            <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a> 2 min, i.e., the disconnection lasts longer
            than MSL, TCP's assumption that such segments will never be received
            will no longer be true, violating TCP's semantics
            <a class='info' href='#I-D.eggert-tcpm-tcp-retransmit-now'>[I&#8209;D.eggert&#8209;tcpm&#8209;tcp&#8209;retransmit&#8209;now]<span> (</span><span class='info'>Eggert, L., &ldquo;TCP Extensions for Immediate Retransmissions,&rdquo; June&nbsp;2005.</span><span>)</span></a>.
</p>
<p>Other approaches like TCP-F <a class='info' href='#CRVP01'>[CRVP01]<span> (</span><span class='info'>Chandran, K., Raghunathan, S., Venkatesan, S., and R. Prakash, &ldquo;A feedback-based scheme for improving TCP performance                     in ad hoc wireless networks,&rdquo; February&nbsp;2001.</span><span>)</span></a> or the
            Explicit Link Failure Notification (ELFN) <a class='info' href='#HV02'>[HV02]<span> (</span><span class='info'>Holland, G. and N. Vaidya, &ldquo;Analysis of TCP performance over mobile ad hoc                     networks,&rdquo; March&nbsp;2002.</span><span>)</span></a>
            inform the TCP senders about disrupted paths by special messages
            generated from intermediate routers. In case of a link failure they
            stop sending data segments and freeze TCP's retransmission timers.
            TCP-F stays in this state and remains silent until either a "route
            establishment notification" is received or an internal timer expires.
            In contrast, ELFN periodically probes the network to detect
            connectivity reestablishment. Both proposals rely on changes to
            intermediate routers, whereas the scheme proposed in this memo is a
            sender only modification. Moreover, ELFN also does not consider
            congestion in the network and may impose serious additional load on
            the network, depending on the probe interval.
</p>
<p>The authors of ATCP <a class='info' href='#LS01'>[LS01]<span> (</span><span class='info'>Liu, J. and S. Singh, &ldquo;ATCP: TCP for mobile ad hoc networks,&rdquo; 2001&nbsp;July.</span><span>)</span></a> propose enhancements
            to identify different types of packet loss, by introducing a layer
            between TCP and IP. They utilize ICMP destination unreachable
            messages to set TCP's receiver advertised window to zero and thus
            forcing the TCP sender to do zero window probing with exponential
            back-off. ICMP destination unreachable messages, which arrive during
            this probing period, are ignored. This approach is nearly orthogonal
            to this memo, which exploits ICMP messages to revert a RTO back-off,
            when TCP is already probing. In principle both mechanisms could be
            combined, however, due to security considerations it does not seem
            appropriate to adopt ATCP's reaction as discussed in
            <a class='info' href='#discussion'>Section&nbsp;5<span> (</span><span class='info'>Discussion</span><span>)</span></a>.
</p>
<p>Schuetz et al. describe in
            <a class='info' href='#I-D.schuetz-tcpm-tcp-rlci'>[I&#8209;D.schuetz&#8209;tcpm&#8209;tcp&#8209;rlci]<span> (</span><span class='info'>Schuetz, S., Koutsianas, N., Eggert, L., Eddy, W., Swami, Y., and K. Le, &ldquo;TCP Response to Lower-Layer Connectivity-Change Indications,&rdquo; February&nbsp;2008.</span><span>)</span></a> a set of TCP extensions
            that improve behavior when transmitting over paths whose
            characteristics can change on short time-scales. Their proposed TCP
            extensions modify the local behavior of TCP and introduce a new TCP
            option to signal locally received connectivity-change indications
            (CCIs) to remote peers. Upon reception of a CCI, they re-probe the
            path characteristics either by performing a speculative
            retransmission or by sending a single segment of new data, depending
            on whether the connection is currently in the loss state or
            transmitting in steady-state, respectively. The authors focus on
            specifying TCP response mechanisms, nevertheless underlying layers
            would have to be modified to explicitly send CCIs to make these
            immediate responses possible.
</p>
<a name="iana"></a><br /><hr />
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>This memo includes no request to IANA.
</p>
<a name="security"></a><br /><hr />
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>The proposed mechanism is considered to be secure. For example an
            attacker cannot make a TCP modified with proposed scheme flood the
            network just by sending forged ICMP unreachable messages reverting
            RTO back-offs. Even in the case the attacker could correctly guess
            the sequence number of the current retransmitted segment, the
            retransmission frequency is limited by the minimum value for the RTO
            of 1s specified by RFC 2988 <a class='info' href='#RFC2988'>[RFC2988]<span> (</span><span class='info'>Paxson, V. and M. Allman, &ldquo;Computing TCP's Retransmission Timer,&rdquo; November&nbsp;2000.</span><span>)</span></a>.
</p>
<a name="rfc.references"></a><br /><hr />
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC0792">[RFC0792]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc792">Internet Control Message Protocol</a>,&rdquo; STD&nbsp;5, RFC&nbsp;792, September&nbsp;1981 (<a href="http://www.rfc-editor.org/rfc/rfc792.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC0793">[RFC0793]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>,&rdquo; STD&nbsp;7, RFC&nbsp;793, September&nbsp;1981 (<a href="http://www.rfc-editor.org/rfc/rfc793.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1812">[RFC1812]</a></td>
<td class="author-text"><a href="mailto:fred@cisco.com">Baker, F.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1812">Requirements for IP Version 4 Routers</a>,&rdquo; RFC&nbsp;1812, June&nbsp;1995 (<a href="http://www.rfc-editor.org/rfc/rfc1812.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2581">[RFC2581]</a></td>
<td class="author-text"><a href="mailto:mallman@grc.nasa.gov">Allman, M.</a>, <a href="mailto:vern@aciri.org">Paxson, V.</a>, and <a href="mailto:rstevens@kohala.com">W. Stevens</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2581">TCP Congestion Control</a>,&rdquo; RFC&nbsp;2581, April&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2581.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2988">[RFC2988]</a></td>
<td class="author-text">Paxson, V. and M. Allman, &ldquo;<a href="http://tools.ietf.org/html/rfc2988">Computing TCP's Retransmission Timer</a>,&rdquo; RFC&nbsp;2988, November&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2988.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CRVP01">[CRVP01]</a></td>
<td class="author-text">Chandran, K., Raghunathan, S., Venkatesan, S., and R. Prakash, &ldquo;A feedback-based scheme for improving TCP performance
                    in ad hoc wireless networks,&rdquo; IEEE Personal Communications&nbsp;vol. 8, no. 1, pp. 34-39, February&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="HV02">[HV02]</a></td>
<td class="author-text">Holland, G. and N. Vaidya, &ldquo;Analysis of TCP performance over mobile ad hoc
                    networks,&rdquo; Wireless Networks&nbsp;vol. 8, no. 2-3, pp. 275-288, March&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.eggert-tcpm-tcp-retransmit-now">[I-D.eggert-tcpm-tcp-retransmit-now]</a></td>
<td class="author-text">Eggert, L., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-eggert-tcpm-tcp-retransmit-now-02.txt">TCP Extensions for Immediate Retransmissions</a>,&rdquo; draft-eggert-tcpm-tcp-retransmit-now-02 (work in progress), June&nbsp;2005 (<a href="http://www.ietf.org/internet-drafts/draft-eggert-tcpm-tcp-retransmit-now-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.schuetz-tcpm-tcp-rlci">[I-D.schuetz-tcpm-tcp-rlci]</a></td>
<td class="author-text">Schuetz, S., Koutsianas, N., Eggert, L., Eddy, W., Swami, Y., and K. Le, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-schuetz-tcpm-tcp-rlci-03.txt">TCP Response to Lower-Layer Connectivity-Change Indications</a>,&rdquo; draft-schuetz-tcpm-tcp-rlci-03 (work in progress), February&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-schuetz-tcpm-tcp-rlci-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="LS01">[LS01]</a></td>
<td class="author-text">Liu, J. and S. Singh, &ldquo;ATCP: TCP for mobile ad hoc networks,&rdquo; IEEE Journal on Selected Areas in
                Communications&nbsp;vol. 19, no. 7, pp. 1300-1315, 2001&nbsp;July.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1122">[RFC1122]</a></td>
<td class="author-text"><a href="mailto:Braden@ISI.EDU">Braden, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1122">Requirements for Internet Hosts - Communication Layers</a>,&rdquo; STD&nbsp;3, RFC&nbsp;1122, October&nbsp;1989 (<a href="http://www.rfc-editor.org/rfc/rfc1122.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2914">[RFC2914]</a></td>
<td class="author-text">Floyd, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2914">Congestion Control Principles</a>,&rdquo; BCP&nbsp;41, RFC&nbsp;2914, September&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2914.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3522">[RFC3522]</a></td>
<td class="author-text">Ludwig, R. and M. Meyer, &ldquo;<a href="http://tools.ietf.org/html/rfc3522">The Eifel Detection Algorithm for TCP</a>,&rdquo; RFC&nbsp;3522, April&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3522.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3819">[RFC3819]</a></td>
<td class="author-text">Karn, P., Bormann, C., Fairhurst, G., Grossman, D., Ludwig, R., Mahdavi, J., Montenegro, G., Touch, J., and L. Wood, &ldquo;<a href="http://tools.ietf.org/html/rfc3819">Advice for Internet Subnetwork Designers</a>,&rdquo; BCP&nbsp;89, RFC&nbsp;3819, July&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3819.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4138">[RFC4138]</a></td>
<td class="author-text">Sarolahti, P. and M. Kojo, &ldquo;<a href="http://tools.ietf.org/html/rfc4138">Forward RTO-Recovery (F-RTO): An Algorithm for Detecting Spurious Retransmission Timeouts with TCP and the Stream Control Transmission Protocol (SCTP)</a>,&rdquo; RFC&nbsp;4138, August&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4138.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SESB05">[SESB05]</a></td>
<td class="author-text">Schuetz, S., Eggert, L., Schmid, S., and M. Brunner, &ldquo;Protocol enhancements for intermittently connected
                    hosts,&rdquo; SIGCOMM Computer Communication Review&nbsp;vol. 35, no. 3, pp. 5-18, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="SM03">[SM03]</a></td>
<td class="author-text">Scott, J. and G. Mapp, &ldquo;Link layer-based TCP optimisation for disconnecting
                    networks,&rdquo; SIGCOMM Computer Communication Review&nbsp;vol. 33, no. 5, pp. 31-42, October&nbsp;2003.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Alexander Zimmermann</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">RWTH Aachen University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ahornstrasse 55</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Aachen,   52074</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+49 241 80 21422</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:zimmermann@cs.rwth-aachen.de">zimmermann@cs.rwth-aachen.de</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Arnd Hannemann</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">RWTH Aachen University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ahornstrasse 55</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Aachen,   52074</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+49 241 80 21423</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hannemann@nets.rwth-aachen.de">hannemann@nets.rwth-aachen.de</a></td></tr>
</table>
</body></html>
