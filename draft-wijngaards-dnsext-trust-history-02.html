<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>DNSSEC Trust Anchor History Service</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="DNSSEC Trust Anchor History Service">
<meta name="keywords" content="DNS, DNSSEC, DNSKEY, history, rollover, trust anchor">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">DNS Extensions Working Group</td><td class="header">W. Wijngaards</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">NLnet Labs</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">March 05, 2009</td></tr>
<tr><td class="header">Expires: September 6, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />DNSSEC Trust Anchor History Service<br />draft-wijngaards-dnsext-trust-history-02</h1>

<h3>Status of This Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 6, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p> When DNS validators have trusted keys, but have been
offline for a longer period, key rollover will fail and they are stuck
with stale trust anchors.  History service allows validators to query for
older DNSKEY RRsets and pick up the rollover trail where they left off.

</p>
<h3>Requirements Language</h3>

<p>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;, 
&quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
&quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;,
&quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be
interpreted as described in  <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="anchor1"></a><br /><hr />
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> DNSSEC <a class='info' href='#RFC4034'>[RFC4034]<span> (</span><span class='info'>Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;Resource Records for the DNS Security Extensions,&rdquo; March&nbsp;2005.</span><span>)</span></a> validators that have been offline
of have missed an (emergency) rollover can use trust history service
to get back on track.  The trust history location is assumed available
from the validator configuration. The validator then fetches old DNSKEY
RRsets and checks they form a chain to the latest key. 
</p>
<p> Providers of trust history can fetch the DNSKEY data as published by
the zone they track, and copy-and-paste it.  They need not sign nor hold
private keys safe.  The algorithms for this are explained below.  
</p>
<a name="anchor2"></a><br /><hr />
<a name="rfc.section.2"></a><h3>2.&nbsp;
Trust History Lookup</h3>

<p> The algorithm is in steps. 
</p>
<p> Step 1. The validator performs a DNSKEY lookup to the target zone,
which looks like any other initial DNSKEY lookup for a trust anchor.
If the keyset verifies with the trust anchor currently held, the keyset
already works. Otherwise, store this result, the further algorithm either
ends with this result or fails. 
</p>
<p> Step 2. Fetch the trust history list end points.  Query type PTR to
the location configured for trust history. 
</p>
<p> Step 3. Go backwards through the trust history list.  Verify that the
keyset validly signs the next keyset.  This is <a class='info' href='#RFC4034'>[RFC4034]<span> (</span><span class='info'>Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;Resource Records for the DNS Security Extensions,&rdquo; March&nbsp;2005.</span><span>)</span></a>
validation, but the RRSIG expiration date is ignored.  Replace the owner
domain name of the DNSKEY with the target zone name for verification.
Query type PTR to get previous and next locations. 
</p>
<p> Step 4. When the trust anchor currently held by the validator verifies
the keyset, the algorithm is done.  The initial DNSKEY from Step 1 is the
result. Use it as the new trust anchor (if using <a class='info' href='#RFC5011'>[RFC5011]<span> (</span><span class='info'>StJohns, M., &ldquo;Automated Updates of DNS Security (DNSSEC) Trust Anchors,&rdquo; September&nbsp;2007.</span><span>)</span></a>, put it in state VALID).  The validator SHOULD store the new trust
anchor on stable storage. 
</p>
<a name="anchor3"></a><br /><hr />
<a name="rfc.section.3"></a><h3>3.&nbsp;
Trust History Tracker</h3>

<p> The tracker polls the target zone DNSKEY RRset from cron.  Ignore
date changes in the RRSIG.  If the tracker knows that the zone performs
responsible prepublish KSK rollovers <a class='info' href='#RFC4641'>[RFC4641]<span> (</span><span class='info'>Kolkman, O. and R. Gieben, &ldquo;DNSSEC Operational Practices,&rdquo; September&nbsp;2006.</span><span>)</span></a> then also
ZSK changes can be ignored. 
</p>
<p> Copy the newly polled DNSKEY RRset and RRSIGs, change the owner
name to "h%d.example" or similar. With %d a new number, and .example the
history location.  Publish the new RRset. Publish PTR records that link
list elements.  Update PTR records for the list start and end. 
</p>
<p> The list is a double linked list, because this empowers low memory
hosts to perform consistency checks.  Thus if there is x.example PTR
y.example then there MUST be y.example PTR x.example.  Except at start
and end of list. 
</p>
<p> To find the start of the list, it MUST be a name before the end of the
list in canonical comparison ordering (<a class='info' href='#RFC4034'>[RFC4034]<span> (</span><span class='info'>Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;Resource Records for the DNS Security Extensions,&rdquo; March&nbsp;2005.</span><span>)</span></a>). With
exactly one list element, one PTR record points to both start and end.
</p>
<a name="anchor4"></a><br /><hr />
<a name="rfc.section.4"></a><h3>4.&nbsp;
Example</h3>

<p> In this example tuhi.example.com provides trust history for
example.net. The DNSKEY rdata and RRSIG rdata is omitted for brevity,
it is a literal copy and paste of the data from example.net. 
</p>
<p>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>$ORIGIN tuhi.example.com.
@ PTR h0
@ PTR h2

h0 PTR h1
h0 DNSKEY ...
h0 RRSIG ...

h1 PTR h2
h1 PTR h0
h1 DNSKEY ...
h1 RRSIG ...

h2 DNSKEY ...
h2 RRSIG ...
h2 PTR h1
</pre></div>
<p>
</p>


<a name="Security"></a><br /><hr />
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p> The trust history tracker only provides a cached copy of old data.
The history data can be altered or withheld; the lookup algorithm then
fails. 
</p>
<p> Ultimately the security depends on the key that the validator is
holding, and the keys in the chain up to the present.  If the old key
held by the validator is too old, the validator MAY not accept this risk,
and then SHOULD perform out of band key priming. 
</p>
<p> The algorithm looks up the initial DNSKEY like other validators do,
and then walks the history in reverse.  This avoids exposing the validator
on the network as a host with an older key and the key id. 
</p>
<p> Validators can (OPTIONAL) examine RRSIG dates. To account for clock
skew padding by the target zone, the middle of the inception and expiration
date SHOULD be used, if consistency checks are done. 
</p>
<p> The algorithm can be abused to provide a secure method to get (close
to) the current month or year. Validators without clock then know the
date that validates signatures currently in use by the zone.  
</p>
<a name="IANA"></a><br /><hr />
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>-
</p>
<a name="rfc.references"></a><br /><hr />
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<h3>7.1.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC4641">[RFC4641]</a></td>
<td class="author-text">Kolkman, O. and R. Gieben, &ldquo;<a href="http://tools.ietf.org/html/rfc4641">DNSSEC Operational Practices</a>,&rdquo; RFC&nbsp;4641, September&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4641.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5011">[RFC5011]</a></td>
<td class="author-text">StJohns, M., &ldquo;<a href="http://tools.ietf.org/html/rfc5011">Automated Updates of DNS Security (DNSSEC) Trust Anchors</a>,&rdquo; RFC&nbsp;5011, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc5011.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<h3>7.2.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4034">[RFC4034]</a></td>
<td class="author-text">Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;<a href="http://tools.ietf.org/html/rfc4034">Resource Records for the DNS Security Extensions</a>,&rdquo; RFC&nbsp;4034, March&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4034.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wouter Wijngaards</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NLnet Labs</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Science Park 140</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Amsterdam  1098 XG</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">The Netherlands</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+31-20-888-4551</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:wouter@nlnetlabs.nl">wouter@nlnetlabs.nl</a></td></tr>
</table>
</body></html>
