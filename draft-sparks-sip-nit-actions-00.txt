

Network Working Group                                          R. Sparks
Internet-Draft                                               dynamicsoft
Expires: August 6, 2004                                 February 6, 2004


    Actions addressing identified issues with the Session Initiation
                   Protocol's non-INVITE Transaction
                    draft-sparks-sip-nit-actions-00

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups. Note that other
   groups may also distribute working documents as Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time. It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at http://
   www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on August 6, 2004.

Copyright Notice

   Copyright (C) The Internet Society (2004). All Rights Reserved.

Abstract

   This draft describes modifications to the Session Initiation Protocol
   (SIP) to address problems that have been identified with the SIP
   non-INVITE transaction. These modifications reduce the probability of
   messages losing the race condition inherent in the non-INVITE
   transaction and reduce useless network traffic. They also improve the
   robustness of SIP networks when elements stop responding. These
   changes update behavior defined in RFCs 3261 and 3263.








Sparks                   Expires August 6, 2004                 [Page 1]

Internet-Draft           SIP non-INVITE Actions            February 2004


Table of Contents

   1.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  3
   2.  Improving the situation when responses are only delayed  . . .  3
   2.1 Action 1: Make the best use of provisional responses . . . . .  3
   2.2 Action 2: Remove the useless late-response storm . . . . . . .  4
   3.  Improving the situation when an element is not going to
       respond  . . . . . . . . . . . . . . . . . . . . . . . . . . .  5
   3.1 Action 3: Strengthen specification of caching success and
       failures in RFC 3263 . . . . . . . . . . . . . . . . . . . . .  5
   4.  Normative Updates to RFC 3261  . . . . . . . . . . . . . . . .  5
   4.1 Action 1 . . . . . . . . . . . . . . . . . . . . . . . . . . .  5
   4.2 Action 2 . . . . . . . . . . . . . . . . . . . . . . . . . . .  6
   5.  Normative Updates to RFC 3263  . . . . . . . . . . . . . . . .  6
   5.1 Action 3 . . . . . . . . . . . . . . . . . . . . . . . . . . .  6
       References . . . . . . . . . . . . . . . . . . . . . . . . . .  7
       Author's Address . . . . . . . . . . . . . . . . . . . . . . .  7
       Intellectual Property and Copyright Statements . . . . . . . .  8

































Sparks                   Expires August 6, 2004                 [Page 2]

Internet-Draft           SIP non-INVITE Actions            February 2004


1. Introduction

   There are a number of unpleasant edge conditions created by the SIP
   non-INVITE transaction model's fixed duration. The negative aspects
   of some of these are exacerbated by the effect provisional responses
   have on the non-INVITE transaction state machines. These problems are
   documented in [3]. In summary:

      A non-INVITE transaction must complete immediately or risk losing
      a race

      Losing the race will cause the requester to stop sending traffic
      to the responder (the responder will be temporarily blacklisted)

      Provisional responses can delay recovery from lost final responses

      The 408 response is useless for the non-INVITE transaction

      As non-INVITE transactions through N proxies time-out, there can
      be an O(N^2) storm of the useless 408 responses

   This draft specifies updates to RFC 3261 [1] and RFC 3263 [2] to
   improve the behavior of SIP elements when these edge conditions
   arise.

2. Improving the situation when responses are only delayed

   There are two goals to achieve when we constrain the problem to those
   cases where all elements are ultimately responsive and networks
   ultimately deliver messages:

   o  Reduce the probability of losing the race, preferably to the point
      that it is negligible

   o  Reduce or eliminate useless messaging


2.1 Action 1: Make the best use of provisional responses

   o  Disallow non-100 provisionals to non-INVITE requests

   o  Disallow 100 Trying to non-INVITE requests before Timer E reaches
      T2 (for UDP hops)

   o  Allow 100 Trying after Timer E reaches T2 (for UDP hops)

   o  Allow 100 Trying for hops over reliable transports




Sparks                   Expires August 6, 2004                 [Page 3]

Internet-Draft           SIP non-INVITE Actions            February 2004


   Since non-INVITE transactions must complete rapidly ([3]), any
   information beyond "I'm here" (which can be provided by a 100 Trying)
   can be just as usefully delayed to the final response. Sending
   non-100 provisionals wastes bandwidth.

   As shown in [3], sending any provisional response inside a NIT before
   Timer E reaches T2 damages recovery from failure of an unreliable
   transport.

   Without a provisional, a late final response is the same as no
   response at all and will likely result in blacklisting the late
   responding element ([3]), If an element is delaying its final
   response at all, sending a 100 Trying after Timer E reaches T2
   prevents this blacklisting without damaging recovery from unreliable
   transport failure.

   Blacklisting on a late response occurs even over reliable transports.
   Thus, if an element processing a request received over a reliable
   transport is delaying its final response at all, sending a 100 Trying
   well in advance of the timeout will prevent blacklisting. Sending a
   100 Trying immediately will not harm the transaction as it would over
   UDP, but a policy of always sending such a message results in
   unneccessary traffic. A policy of sending a 100 Trying after the
   period of time in which Timer E reaches T2 had this been a UDP hop is
   one reasonable compromise.

2.2 Action 2: Remove the useless late-response storm

   o  Disallow 408 to non-INVITE requests

   o  Absorb stray non-INVITE responses at proxies

   A 408 to non-INVITE will always arrive too late to be useful ([3]),
   The client already has full knowledge of the timeout. The only
   information this message would convey is whether or not the server
   believed the transaction timed out. However, with the current design
   of the NIT, a client can't do anything with this knowledge. Thus the
   408 simply wasting network resources and contributes to the response
   bombardment illustrated in [3].

   Late non-INVITE responses by definition arrive after the client
   transaction's Timer F has fired and the client transaction has
   entered the Terminated state. Thus, these responses cannot be
   distinguished from strays. Changing the protocol behavior to prohibit
   forwarding non-INVITE stray responses stops the late response storm.
   It also improves the proxy's defenses against malicious users
   counting on the RFC 3261 requirement to forward such strays.




Sparks                   Expires August 6, 2004                 [Page 4]

Internet-Draft           SIP non-INVITE Actions            February 2004


3. Improving the situation when an element is not going to respond

   When we expand the scope of the problem to also deal with element or
   network failure, we have more goals to achieve:

   o  Identifying when an element is non-responsive

   o  Minimizing or eliminating falsely identifying responsive elements
      as non-responsive

   o  Avoiding non-responsive elements with future requests

   Action 1 dramatically improves an elements ability to distinguish
   between failure and delayed response from the next downstream
   element. Ssome response, either provisional or final, will almost
   certainly be received before the transaction times out. So, an
   element can more safely assume that no response at all indicates the
   peer is not available and follow the existing requirements in [1] and
   [2] (as amended by this memo) for that case.

   As [3] discusses, behavior once an element is identified as
   non-responsive is currently underspecified. [2] speaks only
   non-normatively about caching the addresses of servers that have
   successfully been communicated with for an unspecified period of
   time.

3.1 Action 3: Strengthen specification of caching success and failures
    in RFC 3263

   o  Make the caching recommendation normative for servers successfully
      reached

   o  Add failures due to non-responsiveness to that cache

   This cache will also be used to remember servers that have issued a
   503 with or without a Retry-After.

4. Normative Updates to RFC 3261

4.1 Action 1

   A SIP element MUST NOT send any provisional response with a
   Status-Code other than 100 to a non-INVITE request.

   A SIP element MUST NOT respond to a request with a Status-Code of 100
   over any unreliable transport, such as UDP, before the amount of time
   it takes a client transaction's Timer E to be reset to T2.




Sparks                   Expires August 6, 2004                 [Page 5]

Internet-Draft           SIP non-INVITE Actions            February 2004


   A SIP element MAY respond to a request with a Status-Code of 100 over
   an unreliable transport after the amount of time it takes a client
   transaction's Timer E to be reset to T2.

   A SIP element MAY respond to a request with a Status-Code of 100 over
   a reliable transport at any time.

4.2 Action 2

   A transaction-stateful SIP element MUST NOT send a response with
   Status-Code of 408 to a non-INVITE request. As a consequence, an
   element that can not respond before the transaction expires will not
   send a final response at all.

   A transaction-stateful SIP proxy MUST NOT send any response to a
   non-INVITE request unless it has a matching server transaction that
   is not in the Terminated state. As a consequence, this proxy will not
   forward any "late" non-INVITE response.

5. Normative Updates to RFC 3263

5.1 Action 3

   (Note that RFC 3263 uses "client" for "any SIP element wishing to
   send a request".)

   Once a client identifies an available server for a domain name using
   the algorithms defined in RFC 3263, it SHOULD cache the identity of
   that server in an available-cache.  This identity MUST be
   periodically removed from the cache, and its time-to-live in that
   cache SHOULD be short. If the server with that identity becomes
   unavailable, the identity MUST be immediately removed from the cache
   and SHOULD be placed in an unavailable-cache. The next attempt to
   reach that domain name MUST invoke the algorithms in RFC 3263.

   If any attempt to contact a server based on the output of the
   algorithms of RFC 3263 yeilds that the server is unavailable (the
   request times out or the server returns a 503 Status-Code), the
   identity of that server SHOULD be placed in an unavailable-cache.
   This identity MUST be periodically removed from that cache, and its
   time-to-live in that cache SHOULD be short. If information about the
   period of unavailability is present (such as in a Retry-After header
   field in a 503 response), the time-to-live in this cache SHOULD
   reflect that information.

   If the algorithms of RFC 3263 yeild a server identity that is in an
   unavailable-cache, that identity MUST be discarded and the algorithm
   MUST be continued to search for another candidate.



Sparks                   Expires August 6, 2004                 [Page 6]

Internet-Draft           SIP non-INVITE Actions            February 2004


   OPEN ISSUE: Can we strengthen placing identities in an
   unavailable-cache to MUST? RFC 3263 failover for non-INVITE will not
   work without it.

   OPEN ISSUE: Is it possible to recommend a time more specific than
   "short" in these requirements?

References

   [1]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A.,
        Peterson, J., Sparks, R., Handley, M. and E. Schooler, "SIP:
        Session Initiation Protocol", RFC 3261, June 2002.

   [2]  Rosenberg, J. and H. Schulzrinne, "Session Initiation Protocol
        (SIP): Locating SIP Servers", RFC 3263, June 2002.

   [3]  Sparks, R., "Problems identified associated with the Session
        Initiation Protocol's non-INVITE Transaction",
        draft-sparks-sip-nit-problems (work in progress), February 2004.


Author's Address

   Robert J. Sparks
   dynamicsoft
   5100 Tennyson Parkway
   Suite 1200
   Plano, TX  75024

   EMail: rsparks@dynamicsoft.com





















Sparks                   Expires August 6, 2004                 [Page 7]

Internet-Draft           SIP non-INVITE Actions            February 2004


Intellectual Property Statement

   The IETF takes no position regarding the validity or scope of any
   intellectual property or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; neither does it represent that it
   has made any effort to identify any such rights. Information on the
   IETF's procedures with respect to rights in standards-track and
   standards-related documentation can be found in BCP-11. Copies of
   claims of rights made available for publication and any assurances of
   licenses to be made available, or the result of an attempt made to
   obtain a general license or permission for the use of such
   proprietary rights by implementors or users of this specification can
   be obtained from the IETF Secretariat.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights which may cover technology that may be required to practice
   this standard. Please address the information to the IETF Executive
   Director.


Full Copyright Statement

   Copyright (C) The Internet Society (2004). All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works. However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assignees.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION



Sparks                   Expires August 6, 2004                 [Page 8]

Internet-Draft           SIP non-INVITE Actions            February 2004


   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Acknowledgment

   Funding for the RFC Editor function is currently provided by the
   Internet Society.











































Sparks                   Expires August 6, 2004                 [Page 9]

