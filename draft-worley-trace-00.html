<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>SIP Tracing Facility</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="SIP Tracing Facility">
<meta name="keywords" content="">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIP</td><td class="header">D. Worley</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Nortel Networks</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">March 03, 2009</td></tr>
<tr><td class="header">Expires: September 4, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />SIP Tracing Facility<br />draft-worley-trace-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 4, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
This document defines a SIP option tag, "trace", to be used
within SIP messages to request that SIP elements (both proxies and
UASs) that receive the message reflect to the UAC
the request they received and the response they gave
by encapsulating the request and response in a provisional response.
A new provisional response code "170" is defined to carry the request
and response.
This option tag is expected to be used solely for diagnostic purposes.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#purpose">1.</a>&nbsp;
Purpose of the 'trace' option tag<br />
<a href="#syntax">2.</a>&nbsp;
Syntax and Semantics<br />
<a href="#difficulties">3.</a>&nbsp;
Difficulties<br />
<a href="#example">4.</a>&nbsp;
Example<br />
<a href="#security">5.</a>&nbsp;
Security Considerations<br />
<a href="#revision">6.</a>&nbsp;
Revision History<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#00">6.1.</a>&nbsp;
draft-worley-trace-00<br />
<a href="#rfc.references1">7.</a>&nbsp;
Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="purpose"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Purpose of the 'trace' option tag</h3>

<p>
Currently it is very difficult to determine the routing of an
out-of-dialog SIP request, even in situations without forking.
In practice, the usual method is to obtain some identification of the
request (usually the Call-Id value) and search through detailed logs
taken at every SIP element that the request might have passed through.
While effective tools to carry this out can be constructed for any
particular SIP system, interoperation between different SIP systems
rapidly makes this technique infeasible even if the systems have no
policy of information-hiding regarding each other.

</p>
<p>
The purpose of this Internet-Draft is to propose an option tag, "trace" which
requests that all recipients of all forks of a request echo a copy of
the received request and the recipient's final response in a
provisional response.
A new provisional response code, "170", is defined to carry these
echos.

</p>
<p>
Generally, retrieving tracing data is a difficult problem.
An advantage of this technique for message tracing is that it uses SIP
transport to gather the tracing information, which is the only
transport mechanism that we have certain knowledge works.

</p>
<p>
The request and response copies carried in the 170 responses can be reassembled
into the forking tree by examining their Via branch parameters.
If the SIP elements involved implement the History-Info header,
further information about the causes and consequences of the forks can
be obtained.

</p>
<a name="syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Syntax and Semantics</h3>

<p>
This Internet-Draft defines a new option-tag, "trace".
If a SIP element which supports this option-tag receives a request
containing "Supported: trace", the element SHOULD send a provisional
response with status code 170 containing a body that contains the
request and the final response that the element generated to the request.
Stateless proxies will omit the body part containing the final
response and transmit the 170 response upon receiving the request,
since a stateless proxy has no method of retaining the request information
until the final response is generated.

</p>
<p>
This Internet-Draft defines a new status code, "170", with the
conventional reason-phrase "Trace".
The body of a provisional response with status code 170 MUST be a
multipart/related body with one or two parts, each of which has content-type
message/sipfrag.
One of the parts is a SIP request, and if there are two parts, the
other is a SIP response.

</p>
<p>
A 170 response MUST NOT be sent with "Supported: 100rel", in order to
ensure that the UAC is not compelled to send a PRACK.
In any case, a
UAC SHOULD never send a PRACK for a 170, even if it contains
"Supported: 100rel".
The element sending the 170 response must give it an appropriate
to-tag, as it would with any response.
The element MAY choose a different to-tag from that it uses for any other
response (especially if the element normally
uses 100rel for provisional responses) -- the conceit is that the 170
response is generated by a separate UAS to which the request is
forked.

</p>
<p>
Technically, the receipt of a 170 response by a UAC establishes an
early dialog.
However, the 170 response has no further SIP-visible processing
associated with it, so the UAC does not need to create an early dialog in
practice, and the UAC MAY omit adding it to its dialog events.
If no further responses arrive with the same to-tag (from the same SIP
element as generated the 170), retaining an early dialog would have
been useless.
If a further response arrives with the same to-tag, the early dialog
would be created by the later response.

</p>
<a name="difficulties"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Difficulties</h3>

<p>
History-Info, if fully implemented by all the SIP elements, provides
much of the information that "trace" would provide.
On the other hand, History-Info does not capture changes in the
propagated requests other than the request-URIs.

</p>
<p>
The generated 170 responses will be significantly larger than the
requests that create them.
(This problem is similar to that in
draft-ietf-sip-hop-limit-diagnostics.)
This is not a problem if a stream transport is used but can be
problematic if UDP was used to send the request.
This is somewhat mitigated by the fact that provisional responses are
transmitted unreliably, so if an element is unable to transmit a
particular 170 response, it will be dropped and not resent.
In addition, the response pruning strategies discussed in
draft-ietf-sip-hop-limit-diagnostics can be applied to substantially
reduce the response size.

</p>
<p>
This mechanism does not provide any information regarding a request
sent to a non-responding destination, which may be a very useful
fact.
One possible solution to that problem would be for the sending element
to synthesize a 170 response apparently from the destination element,
including the 408 Request Timeout response from the destination that
the sending element has effectively synthesized.
However, this still does not record requests sent to a non-responding
destination if an alternative, responding destination is chosen via
the RFC 3263 mechanisms.
This suggests that trace responses should be generated not by the
receipt of a request, but by the sending of a request.

</p>
<p>
This proposal to some degree parallels draft-kuthan-sipping-diag-00.
The returning of copies of requests as seen by UASs covers one of the
components of that draft.
The other component is that proxies should identify in some way which "rule"
was used to forward a request to a particular request-URI.
That draft proposes to carry this information in an additional Via
parameter.
Within the machinery of this draft, rule information could be added to
170 responses, but only if they were generated regarding outgoing
requests, not incoming requests.

</p>
<p>
The "trace" mechanism does not provide much diagnostic information
regarding problems in the RFC 3263 process.
In particular, failures to find a responding destination host/port/transport for
a request-URI generate no 170 responses.
This is improved if 170 responses are generated for transmitted
requests, but the request itself does not carry information about the
destination host and port.
(The transport is coded in the topmost Via header.)

</p>
<a name="example"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Example</h3>

<p>
This example shows a typical use of "Supported: trace".
Only the more significant messages are shown.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    UAC            Proxy           UAS1         UAS2

     |               |              |            |
     |  F1 INVITE    |              |            |
     |--------------&gt;|              |            |
     |               |  F2 INVITE   |            |
     |               |-------------&gt;|            |
     |               |  F3 180 Ring.|            |
     |               |&lt;-------------|            |
     |  F4 180 Ring. |              |            |
     |&lt;--------------|              |            |
     |               |  F5 CANCEL   |            |
     |               |-------------&gt;|            |
     |               |  F6 487 Term.|            |
     |               |&lt;-------------|            |
     |               |  F7 170 Trace|            |
     |               |&lt;-------------|            |
     |  F8 170 Trace |              |            |
     |&lt;--------------|              |            |
     |               |  F9 INVITE   |            |
     |               |--------------------------&gt;|
     |               |  F10 180 Ringing          |
     |               |&lt;--------------------------|
     |  F11 180 Ring.|              |            |
     |&lt;--------------|              |            |
     |               |  F12 200 OK  |            |
     |               |&lt;--------------------------|
     |  F13 200 OK   |              |            |
     |&lt;--------------|              |            |
     |               |  F14 170 Trace            |
     |               |&lt;--------------------------|
     |  F15 170 Trace|              |            |
     |&lt;--------------|              |            |
     |  F16 170 Trace|              |            |
     |&lt;--------------|              |            |
     |               |              |            |
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F1 INVITE

   INVITE sip:alice@atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   Max-Forwards: 20
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:bill@pc.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]


F2 INVITE

   INVITE sip:alice@pc1.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK23SX
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   Max-Forwards: 19
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:bill@pc.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]


F6 487 Request Terminated

   SIP/2.0 487 Request Terminated
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK23SX
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=qazwsx
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE


F7 170 Trace (containing F2 and F6)

   SIP/2.0 170 Trace
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK23SX
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=qazwsx
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Content-Type: multipart/related;boundary=trace
   Content-Length: ...

   --trace
   Content-Type: message/sipfrag

   INVITE sip:alice@pc1.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK23SX
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   Max-Forwards: 19
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:bill@pc.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]

   --trace
   Content-type: message/sipfrag

   SIP/2.0 487 Request Terminated
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK23SX
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=qazwsx
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE


   --trace--


F8 170 Trace (containing F2 and F6)

   SIP/2.0 170 Trace
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=qazwsx
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Content-Type: multipart/related;boundary=trace
   Content-Length: ...

   --trace
   Content-Type: message/sipfrag

   INVITE sip:alice@pc1.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK23SX
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   Max-Forwards: 19
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:bill@pc.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]

   --trace
   Content-type: message/sipfrag

   SIP/2.0 487 Request Terminated
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK23SX
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=qazwsx
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE


   --trace--


F9 INVITE

   INVITE sip:alice@pc2.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK50UI
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   Max-Forwards: 19
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:bill@pc.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]


F12 200 OK

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK50UI
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=RTYU
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:alice@pc2.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]


F13 200 OK

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=RTYU
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:alice@pc2.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]


F14 170 Trace (containing F9 and F12)

   SIP/2.0 170 Trace
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK50UI
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=RTYU
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Content-Type: multipart/related;boundary=trace
   Content-Length: ...

   --trace
   Content-Type: message/sipfrag

   INVITE sip:alice@pc2.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK50UI
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   Max-Forwards: 19
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:bill@pc.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]

   --trace
   Content-type: message/sipfrag

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK50UI
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=RTYU
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:alice@pc2.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]

   --trace--


F15 170 Trace (containing F9 and F12)

   SIP/2.0 170 Trace
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=RTYU
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Content-Type: multipart/related;boundary=trace
   Content-Length: ...

   --trace
   Content-Type: message/sipfrag

   INVITE sip:alice@pc2.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK50UI
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   Max-Forwards: 19
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:bill@pc.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]

   --trace
   Content-type: message/sipfrag

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK50UI
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=RTYU
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:alice@pc2.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]

   --trace--


F16 170 Trace (containing F1 and F13)

   SIP/2.0 170 Trace
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=RTYU
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Content-Type: multipart/related;boundary=trace
   Content-Length: ...

   --trace
   Content-Type: message/sipfrag

   INVITE sip:alice@pc2.atlanta.example.com SIP/2.0
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK50UI
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   Max-Forwards: 19
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:bill@pc.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]

   --trace
   Content-type: message/sipfrag

   SIP/2.0 200 OK
   Via: SIP/2.0/TCP atlanta.example.com:5061
    ;branch=z9hG4bK50UI
   Via: SIP/2.0/TCP pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   From: Bill &lt;sip:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sip:alice@atlanta.example.com&gt;;tag=RTYU
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Contact: &lt;sip:alice@pc2.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: trace
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]

   --trace--
</pre></div>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>
A service provider desiring to keep hidden the topology of its
network will not want to permit trace data to be transmitted
outward from their network.
This can be accomplished by removing "Supported: trace" from any
request that enters the network, and by dropping any 170 responses
that attempt to exit the network.

</p>
<p>
Generating trace responses increases the volume of messages generated
by a SIP request.
However, the increase is limited to a factor slightly larger than 2,
although the increase in message traffic is concentrated toward the
UAC end of the forking tree.
so the trace mechanism is particularly effective in generating a
denial-of-service attach.
In any case, UACs SHOULD never apply "Supported: trace" to a message
routinely.

</p>
<a name="revision"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Revision History</h3>

<a name="00"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
draft-worley-trace-00</h3>

<p>
Initial version.

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="sip">[sip]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3261.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dale R. Worley</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nortel Networks Corp.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">600 Technology Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Billerica, MA  01821</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 978 288 5505</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:dworley@nortel.com">dworley@nortel.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.nortel.com">http://www.nortel.com</a></td></tr>
</table>
</body></html>
