<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Fragmentation Avoidance in DNS</title>
<meta content="Kazunori Fujiwara" name="author">
<meta content="Paul Vixie" name="author">
<meta content="
       EDNS0 enables a DNS server to send large responses using UDP
and is widely deployed.
Path MTU discovery remains widely undeployed due to security issues,
and IP fragmentation has exposed weaknesses in application protocols.
Currently, DNS is known to be the largest user of IP fragmentation.
It is possible to avoid IP fragmentation in DNS by limiting response
size where possible, and signaling the need to upgrade from UDP to TCP
transport where necessary. This document proposes to avoid IP
fragmentation in DNS. 
    " name="description">
<meta content="xml2rfc 3.12.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-dnsop-avoid-fragmentation-06" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.4
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.26.0
    setuptools 59.5.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-ietf-dnsop-avoid-fragmentation-2h65unzy.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">avoid-fragmentation</td>
<td class="right">December 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Fujiwara &amp; Vixie</td>
<td class="center">Expires 27 June 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-dnsop-avoid-fragmentation-06</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-12-24" class="published">24 December 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Best Current Practice</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-06-27">27 June 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">K. Fujiwara</div>
<div class="org">JPRS</div>
</div>
<div class="author">
      <div class="author-name">P. Vixie</div>
<div class="org">none</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Fragmentation Avoidance in DNS</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">EDNS0 enables a DNS server to send large responses using UDP
and is widely deployed.
Path MTU discovery remains widely undeployed due to security issues,
and IP fragmentation has exposed weaknesses in application protocols.
Currently, DNS is known to be the largest user of IP fragmentation.
It is possible to avoid IP fragmentation in DNS by limiting response
size where possible, and signaling the need to upgrade from UDP to TCP
transport where necessary. This document proposes to avoid IP
fragmentation in DNS.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 27 June 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-proposal-to-avoid-ip-fragme" class="xref">Proposal to avoid IP fragmentation in DNS</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1" class="keepWithNext"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-recommendations-for-udp-res" class="xref">Recommendations for UDP responders</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-recommendations-for-udp-req" class="xref">Recommendations for UDP requestors</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-default-maximum-dns-udp-pay" class="xref">Default Maximum DNS/UDP payload size</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-incremental-deployment" class="xref">Incremental deployment</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-request-to-zone-operators-a" class="xref">Request to zone operators and DNS server operators</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-considerations" class="xref">Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-protocol-compliance" class="xref">Protocol compliance</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-weaknesses-of-ip-fragmentat" class="xref">Weaknesses of IP fragmentation</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-details-of-maximum-dns-udp-" class="xref">Details of maximum DNS/UDP payload size discussions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-C" class="xref">Appendix C</a>.  <a href="#name-how-to-retrieve-path-mtu-va" class="xref">How to retrieve path MTU value to a destination from applications</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-D" class="xref">Appendix D</a>.  <a href="#name-how-to-retrieve-minimal-mtu" class="xref">How to retrieve minimal MTU value to a destination</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-E" class="xref">Appendix E</a>.  <a href="#name-minimal-responses" class="xref">Minimal-responses</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-F" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">DNS has EDNS0 <span>[<a href="#RFC6891" class="xref">RFC6891</a>]</span> mechanism.
It enables a DNS server to send large responses using UDP.
EDNS0 is now widely deployed,
and DNS (over UDP) is said to be the biggest user of IP fragmentation.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Fragmented DNS UDP responses have systemic weaknesses, which expose
the requestor to DNS cache poisoning from off-path attackers.
(See <a href="#ProblemOfFragmentation" class="xref">Appendix A</a> for references and details.)<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3"><span>[<a href="#RFC8900" class="xref">RFC8900</a>]</span> summarized that IP fragmentation
introduces fragility to Internet communication. The transport of DNS messages
over UDP should take account of the observations stated in that document.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">TCP avoids fragmentation using its Maximum Segment Size (MSS) parameter, but
each transmitted segment is header-size aware such that the size of the IP and
TCP headers is known, as well as the far end's MSS parameter and the interface
or path MTU, so that the segment size can be chosen so as to keep the each IP
datagram below a target size. This takes advantage of the elasticity of TCP's
packetizing process as to how much queued data will fit into the next
segment. In contrast, DNS over UDP has little datagram size elasticity and
lacks insight into IP header and option size, and so must make more
conservative estimates about available UDP payload space.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This document proposes to set IP_DONTFRAG / IPV6_DONTFRAG in DNS/UDP
messages in order to avoid IP fragmentation, and describes how to
avoid packet losses due to IP_DONTFRAG / IPV6_DONTFRAG.<a href="#section-1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
"OPTIONAL" in this document are to be interpreted as described in 
<span><a href="#RFC2119" class="xref">BCP14</a> [<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all
capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">"Requestor" refers to the side that sends a request.  "Responder"
refers to an authoritative, recursive resolver or other DNS component
that responds to questions. (Quoted from EDNS0 <span>[<a href="#RFC6891" class="xref">RFC6891</a>]</span>)<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">"Path MTU" is the minimum link MTU of all the links in a path
between a source node and a destination node. (Quoted from <span>[<a href="#RFC8201" class="xref">RFC8201</a>]</span>)<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">"Path MTU discovery" is defined by <span>[<a href="#RFC1191" class="xref">RFC1191</a>]</span>, <span>[<a href="#RFC8201" class="xref">RFC8201</a>]</span> and
<span>[<a href="#RFC8899" class="xref">RFC8899</a>]</span>.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">IP_DONTFRAG option is not defined by any RFCs. It is similar to
IPV6_DONTFRAG option defined in <span>[<a href="#RFC3542" class="xref">RFC3542</a>]</span>.
IP_DONTFRAG option is used on BSD systems to set the Don't Fragment bit <span>[<a href="#RFC0791" class="xref">RFC0791</a>]</span> 
when sending IPv4 packets.
On Linux systems this is done via IP_MTU_DISCOVER and IP_PMTUDISC_DO.<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6">Many of the specialized terms used in this document are defined in
DNS Terminology <span>[<a href="#RFC8499" class="xref">RFC8499</a>]</span>.<a href="#section-2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="proposal-to-avoid-ip-fragmentation-in-dns">
<section id="section-3">
      <h2 id="name-proposal-to-avoid-ip-fragme">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-proposal-to-avoid-ip-fragme" class="section-name selfRef">Proposal to avoid IP fragmentation in DNS</a>
      </h2>
<p id="section-3-1">The methods to avoid IP fragmentation in DNS are described below:<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="recommendations-for-udp-responders">
<section id="section-3.1">
        <h3 id="name-recommendations-for-udp-res">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-recommendations-for-udp-res" class="section-name selfRef">Recommendations for UDP responders</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-3.1-1.1">UDP responders SHOULD send DNS responses with
IP_DONTFRAG / IPV6_DONTFRAG <span>[<a href="#RFC3542" class="xref">RFC3542</a>]</span> options.<a href="#section-3.1-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-1.2">If the UDP responder detects immediate error
that the UDP packet cannot be sent beyond the path MTU size (EMSGSIZE),
the UDP responder MAY recreate response packets fit in path MTU size,
or TC bit set.<a href="#section-3.1-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-1.3">UDP responders MAY probe to discover the real MTU value per destination.<a href="#section-3.1-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-1.4">
            <p id="section-3.1-1.4.1">UDP responders SHOULD compose UDP responses that result in IP packets
that do not exceed the path MTU to the requestor.
If the path MTU discovery failed or is impossible,
UDP responders SHOULD compose UDP responses that result in IP packets
that do not exceed the default maximum DNS/UDP payload size described in <a href="#Default_MTU" class="xref">Section 3.3</a>.<a href="#section-3.1-1.4.1" class="pilcrow">¶</a></p>
<p id="section-3.1-1.4.2">
The cause and effect of the TC bit is unchanged from EDNS0 <span>[<a href="#RFC6891" class="xref">RFC6891</a>]</span>.<a href="#section-3.1-1.4.2" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="recommendations-for-udp-requestors">
<section id="section-3.2">
        <h3 id="name-recommendations-for-udp-req">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-recommendations-for-udp-req" class="section-name selfRef">Recommendations for UDP requestors</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-3.2-1.1">UDP requestors SHOULD send DNS requests with
IP_DONTFRAG / IPV6_DONTFRAG <span>[<a href="#RFC3542" class="xref">RFC3542</a>]</span> options.<a href="#section-3.2-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-1.2">UDP requestors MAY probe to discover the real MTU value per destination.
Then, calculate their maximum DNS/UDP payload size as
the reported path MTU minus IPv4/IPv6 header size (20 or 40) minus UDP header size (8).
If the path MTU discovery failed or is impossible,
use the default maximum DNS/UDP payload size described in <a href="#Default_MTU" class="xref">Section 3.3</a>.<a href="#section-3.2-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-1.3">UDP requestors SHOULD use the requestor's payload size
as the calculated or the default maximum DNS/UDP payload size.<a href="#section-3.2-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-1.4">UDP requestors MAY drop fragmented DNS/UDP responses without IP reassembly
to avoid cache poisoning attacks.<a href="#section-3.2-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-1.5">DNS responses may be dropped by IP fragmentation.
Upon a timeout, UDP requestors may retry using TCP or UDP, per local policy.<a href="#section-3.2-1.5" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="Default_MTU">
<section id="section-3.3">
        <h3 id="name-default-maximum-dns-udp-pay">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-default-maximum-dns-udp-pay" class="section-name selfRef">Default Maximum DNS/UDP payload size</a>
        </h3>
<p id="section-3.3-1">Fragmentation avoidance is achieved with the IP(V6)_DONTFRAG option.
The purpose of packet size limitation is to decrease packet loss
due to the effects of the IP(V6)_DONTFRAG option.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">Default maximum DNS/UDP payload size depends on the connectivity of each node,
it cannot be determined unconditionally.
However, there are good proposed values.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">Operators MAY select a good number from <a href="#maxpayloadsize" class="xref">Table 1</a>.
Details of proposed values are described in <a href="#details" class="xref">Appendix B</a>.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
<span id="name-default-maximum-dns-udp-payl"></span><div id="maxpayloadsize">
<table class="center" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-default-maximum-dns-udp-payl" class="selfRef">Default maximum DNS/UDP payload size</a>
          </caption>
<thead>
            <tr>
              <th class="text-right" rowspan="1" colspan="1">Source</th>
              <th class="text-right" rowspan="1" colspan="1">IPv4</th>
              <th class="text-left" rowspan="1" colspan="1">IPv6</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-right" rowspan="1" colspan="1">Minimal: RFC 4035 MUST</td>
              <td class="text-right" rowspan="1" colspan="1">1220</td>
              <td class="text-left" rowspan="1" colspan="1">1220</td>
            </tr>
            <tr>
              <td class="text-right" rowspan="1" colspan="1">Software developers / DNSFlagDay2020 propose</td>
              <td class="text-right" rowspan="1" colspan="1">1232</td>
              <td class="text-left" rowspan="1" colspan="1">1232 (1280-40-8)</td>
            </tr>
            <tr>
              <td class="text-right" rowspan="1" colspan="1">Authors' recommendation</td>
              <td class="text-right" rowspan="1" colspan="1">1400</td>
              <td class="text-left" rowspan="1" colspan="1">1400 (1500 -40 -8 - some headers)</td>
            </tr>
            <tr>
              <td class="text-right" rowspan="1" colspan="1">Maximum: Ethernet MTU 1500 <span>[<a href="#Huston2021" class="xref">Huston2021</a>]</span>
</td>
              <td class="text-right" rowspan="1" colspan="1">1472 (1500-20-8)</td>
              <td class="text-left" rowspan="1" colspan="1">1452 (1500-40-8)</td>
            </tr>
            <tr>
              <td class="text-right" rowspan="1" colspan="1">Measured</td>
              <td class="text-right" rowspan="1" colspan="1">MTU -20-8</td>
              <td class="text-left" rowspan="1" colspan="1">MTU -40-8</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-3.3-5">However, operators of DNS servers SHOULD measure their path MTU to
the Internet at setting up DNS servers
(and when network configuration changes).<a href="#section-3.3-5" class="pilcrow">¶</a></p>
<p id="section-3.3-6">How to measure path MTU is described in <a href="#IP_MTU2" class="xref">Appendix D</a>.<a href="#section-3.3-6" class="pilcrow">¶</a></p>
<p id="section-3.3-7">Operators of authoritative servers (that offer global DNS zones) 
 and full-service resolvers (that access authoritative servers of the global DNS)
SHOULD measure their path MTU to well-known locations on the Internet,
 such as [a-m].root-servers.net or [a-m].gtld-servers.net.<a href="#section-3.3-7" class="pilcrow">¶</a></p>
<p id="section-3.3-8">Operators of full-service resolvers would be well advised
to measure their path MTU to several authority name servers
and to a random sample of their expected stub resolver client networks,
to find the upper boundary on IP/UDP packet size in the average case.
Or, operators of ISPs know their customers' connectivity and customers' MTU to
ISPs' servers.
This limit should not be exceeded by most messages received or transmitted
by a full resolver, or else fallback to TCP will occur too often.<a href="#section-3.3-8" class="pilcrow">¶</a></p>
<p id="section-3.3-9">DNS clients (stub resolvers) need to specify
an appropriate requestor's payload size when supporting EDNS0.
In case of CPEs, embedded devices, and user devices,
network operators can not control them,
developers may choose small values such as 1220 and 1232.<a href="#section-3.3-9" class="pilcrow">¶</a></p>
<p id="section-3.3-10">Other DNS servers are out-of-scope of this document.
(For example, Forwarding only resolvers, or private DNS).<a href="#section-3.3-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="incremental-deployment">
<section id="section-4">
      <h2 id="name-incremental-deployment">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-incremental-deployment" class="section-name selfRef">Incremental deployment</a>
      </h2>
<p id="section-4-1">The proposed method supports incremental deployment.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">When a full-service resolver implements the proposed method, its stub
resolvers (clients) and the authority server network will no longer
observe IP fragmentation or reassembly from that server, and will
fall back to TCP when necessary.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">When an authoritative server implements the proposed method, its full
service resolvers (clients) will no longer observe IP fragmentation
or reassembly from that server, and will fall back to TCP when necessary.<a href="#section-4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="request-to-zone-operators-and-dns-server-operators">
<section id="section-5">
      <h2 id="name-request-to-zone-operators-a">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-request-to-zone-operators-a" class="section-name selfRef">Request to zone operators and DNS server operators</a>
      </h2>
<p id="section-5-1">Large DNS responses are the result of zone configuration.
Zone operators SHOULD seek configurations resulting in small responses.
For example,<a href="#section-5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-2.1">Use smaller number of name servers (13 may be too large)<a href="#section-5-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.2">Use smaller number of A/AAAA RRs for a domain name<a href="#section-5-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.3">Use 'minimal-responses' configuration:
Some implementations have 'minimal responses' configuration that causes
DNS servers to make response packets smaller, containing only mandatory
and required data (<a href="#minimal-responses" class="xref">Appendix E</a>).<a href="#section-5-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.4">Use smaller signature / public key size algorithm for DNSSEC.
Notably, the signature size of ECDSA or EdDSA is smaller than RSA.<a href="#section-5-2.4" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="considerations">
<section id="section-6">
      <h2 id="name-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-considerations" class="section-name selfRef">Considerations</a>
      </h2>
<div id="protocol-compliance">
<section id="section-6.1">
        <h3 id="name-protocol-compliance">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-protocol-compliance" class="section-name selfRef">Protocol compliance</a>
        </h3>
<p id="section-6.1-1">In prior research (<span>[<a href="#Fujiwara2018" class="xref">Fujiwara2018</a>]</span> and dns-operations mailing list discussions),
there are some authoritative servers
that ignore EDNS0 requestor's UDP payload size, and return large UDP responses.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">It is also well known that there are some authoritative servers that do not
support TCP transport.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">Such non-compliant behavior cannot become implementation or configuration
constraints for the rest of the DNS. If failure is the result, then that
failure must be localized to the non-compliant servers.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1">This document has no IANA actions.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="securitycons">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
    </h2>
</section>
</div>
<div id="acknowledgments">
<section id="section-9">
      <h2 id="name-acknowledgments">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-9-1">The author would like to specifically thank 
Paul Wouters, 
Mukund Sivaraman,
Tony Finch,
Hugo Salgado,
Peter van Dijk,
Brian Dickson,
Puneet Sood
and
Jim Reid
for extensive review and comments.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC0791">[RFC0791]</dt>
        <dd>
<span class="refAuthor">Postel, J.</span>, <span class="refTitle">"Internet Protocol"</span>, <span class="seriesInfo">STD 5</span>, <span class="seriesInfo">RFC 791</span>, <span class="seriesInfo">DOI 10.17487/RFC0791</span>, <time datetime="1981-09" class="refDate">September 1981</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc791">https://www.rfc-editor.org/info/rfc791</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC1191">[RFC1191]</dt>
        <dd>
<span class="refAuthor">Mogul, J.</span> and <span class="refAuthor">S. Deering</span>, <span class="refTitle">"Path MTU discovery"</span>, <span class="seriesInfo">RFC 1191</span>, <span class="seriesInfo">DOI 10.17487/RFC1191</span>, <time datetime="1990-11" class="refDate">November 1990</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1191">https://www.rfc-editor.org/info/rfc1191</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3542">[RFC3542]</dt>
        <dd>
<span class="refAuthor">Stevens, W.</span>, <span class="refAuthor">Thomas, M.</span>, <span class="refAuthor">Nordmark, E.</span>, and <span class="refAuthor">T. Jinmei</span>, <span class="refTitle">"Advanced Sockets Application Program Interface (API) for IPv6"</span>, <span class="seriesInfo">RFC 3542</span>, <span class="seriesInfo">DOI 10.17487/RFC3542</span>, <time datetime="2003-05" class="refDate">May 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3542">https://www.rfc-editor.org/info/rfc3542</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4035">[RFC4035]</dt>
        <dd>
<span class="refAuthor">Arends, R.</span>, <span class="refAuthor">Austein, R.</span>, <span class="refAuthor">Larson, M.</span>, <span class="refAuthor">Massey, D.</span>, and <span class="refAuthor">S. Rose</span>, <span class="refTitle">"Protocol Modifications for the DNS Security Extensions"</span>, <span class="seriesInfo">RFC 4035</span>, <span class="seriesInfo">DOI 10.17487/RFC4035</span>, <time datetime="2005-03" class="refDate">March 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4035">https://www.rfc-editor.org/info/rfc4035</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6891">[RFC6891]</dt>
        <dd>
<span class="refAuthor">Damas, J.</span>, <span class="refAuthor">Graff, M.</span>, and <span class="refAuthor">P. Vixie</span>, <span class="refTitle">"Extension Mechanisms for DNS (EDNS(0))"</span>, <span class="seriesInfo">STD 75</span>, <span class="seriesInfo">RFC 6891</span>, <span class="seriesInfo">DOI 10.17487/RFC6891</span>, <time datetime="2013-04" class="refDate">April 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6891">https://www.rfc-editor.org/info/rfc6891</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8201">[RFC8201]</dt>
        <dd>
<span class="refAuthor">McCann, J.</span>, <span class="refAuthor">Deering, S.</span>, <span class="refAuthor">Mogul, J.</span>, and <span class="refAuthor">R. Hinden, Ed.</span>, <span class="refTitle">"Path MTU Discovery for IP version 6"</span>, <span class="seriesInfo">STD 87</span>, <span class="seriesInfo">RFC 8201</span>, <span class="seriesInfo">DOI 10.17487/RFC8201</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8201">https://www.rfc-editor.org/info/rfc8201</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8499">[RFC8499]</dt>
        <dd>
<span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Sullivan, A.</span>, and <span class="refAuthor">K. Fujiwara</span>, <span class="refTitle">"DNS Terminology"</span>, <span class="seriesInfo">BCP 219</span>, <span class="seriesInfo">RFC 8499</span>, <span class="seriesInfo">DOI 10.17487/RFC8499</span>, <time datetime="2019-01" class="refDate">January 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8499">https://www.rfc-editor.org/info/rfc8499</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8899">[RFC8899]</dt>
        <dd>
<span class="refAuthor">Fairhurst, G.</span>, <span class="refAuthor">Jones, T.</span>, <span class="refAuthor">Tüxen, M.</span>, <span class="refAuthor">Rüngeler, I.</span>, and <span class="refAuthor">T. Völker</span>, <span class="refTitle">"Packetization Layer Path MTU Discovery for Datagram Transports"</span>, <span class="seriesInfo">RFC 8899</span>, <span class="seriesInfo">DOI 10.17487/RFC8899</span>, <time datetime="2020-09" class="refDate">September 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8899">https://www.rfc-editor.org/info/rfc8899</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8900">[RFC8900]</dt>
      <dd>
<span class="refAuthor">Bonica, R.</span>, <span class="refAuthor">Baker, F.</span>, <span class="refAuthor">Huston, G.</span>, <span class="refAuthor">Hinden, R.</span>, <span class="refAuthor">Troan, O.</span>, and <span class="refAuthor">F. Gont</span>, <span class="refTitle">"IP Fragmentation Considered Fragile"</span>, <span class="seriesInfo">BCP 230</span>, <span class="seriesInfo">RFC 8900</span>, <span class="seriesInfo">DOI 10.17487/RFC8900</span>, <time datetime="2020-09" class="refDate">September 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8900">https://www.rfc-editor.org/info/rfc8900</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="Brandt2018">[Brandt2018]</dt>
        <dd>
<span class="refAuthor">Brandt, M.</span>, <span class="refAuthor">Dai, T.</span>, <span class="refAuthor">Klein, A.</span>, <span class="refAuthor">Shulman, H.</span>, and <span class="refAuthor">M. Waidner</span>, <span class="refTitle">"Domain Validation++ For MitM-Resilient PKI"</span>, <span class="seriesInfo">Proceedings of the 2018 ACM SIGSAC Conference on Computer and Communications Security </span>, <time datetime="2018" class="refDate">2018</time>. </dd>
<dd class="break"></dd>
<dt id="DNSFlagDay2020">[DNSFlagDay2020]</dt>
        <dd>
<span class="refTitle">"DNS flag day 2020"</span>, <span>n.d.</span>, <span>&lt;<a href="https://dnsflagday.net/2020/">https://dnsflagday.net/2020/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Fujiwara2018">[Fujiwara2018]</dt>
        <dd>
<span class="refAuthor">Fujiwara, K.</span>, <span class="refTitle">"Measures against cache poisoning attacks using IP fragmentation in DNS"</span>, <span class="seriesInfo">OARC 30 Workshop </span>, <time datetime="2019" class="refDate">2019</time>. </dd>
<dd class="break"></dd>
<dt id="Herzberg2013">[Herzberg2013]</dt>
        <dd>
<span class="refAuthor">Herzberg, A.</span> and <span class="refAuthor">H. Shulman</span>, <span class="refTitle">"Fragmentation Considered Poisonous"</span>, <span class="seriesInfo">IEEE Conference on Communications and Network Security </span>, <time datetime="2013" class="refDate">2013</time>. </dd>
<dd class="break"></dd>
<dt id="Hlavacek2013">[Hlavacek2013]</dt>
        <dd>
<span class="refAuthor">Hlavacek, T.</span>, <span class="refTitle">"IP fragmentation attack on DNS"</span>, <span class="seriesInfo">RIPE 67 Meeting </span>, <time datetime="2013" class="refDate">2013</time>, <span>&lt;<a href="https://ripe67.ripe.net/presentations/240-ipfragattack.pdf">https://ripe67.ripe.net/presentations/240-ipfragattack.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Huston2021">[Huston2021]</dt>
        <dd>
<span class="refAuthor">Huston, G.</span> and <span class="refAuthor">J. Damas</span>, <span class="refTitle">"Measuring DNS Flag Day 2020"</span>, <span class="seriesInfo">OARC 34 Workshop </span>, <time datetime="2021-02" class="refDate">February 2021</time>. </dd>
<dd class="break"></dd>
<dt id="RFC1122">[RFC1122]</dt>
        <dd>
<span class="refAuthor">Braden, R., Ed.</span>, <span class="refTitle">"Requirements for Internet Hosts - Communication Layers"</span>, <span class="seriesInfo">STD 3</span>, <span class="seriesInfo">RFC 1122</span>, <span class="seriesInfo">DOI 10.17487/RFC1122</span>, <time datetime="1989-10" class="refDate">October 1989</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc1122">https://www.rfc-editor.org/info/rfc1122</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5155">[RFC5155]</dt>
        <dd>
<span class="refAuthor">Laurie, B.</span>, <span class="refAuthor">Sisson, G.</span>, <span class="refAuthor">Arends, R.</span>, and <span class="refAuthor">D. Blacka</span>, <span class="refTitle">"DNS Security (DNSSEC) Hashed Authenticated Denial of Existence"</span>, <span class="seriesInfo">RFC 5155</span>, <span class="seriesInfo">DOI 10.17487/RFC5155</span>, <time datetime="2008-03" class="refDate">March 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5155">https://www.rfc-editor.org/info/rfc5155</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7739">[RFC7739]</dt>
        <dd>
<span class="refAuthor">Gont, F.</span>, <span class="refTitle">"Security Implications of Predictable Fragment Identification Values"</span>, <span class="seriesInfo">RFC 7739</span>, <span class="seriesInfo">DOI 10.17487/RFC7739</span>, <time datetime="2016-02" class="refDate">February 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7739">https://www.rfc-editor.org/info/rfc7739</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8085">[RFC8085]</dt>
        <dd>
<span class="refAuthor">Eggert, L.</span>, <span class="refAuthor">Fairhurst, G.</span>, and <span class="refAuthor">G. Shepherd</span>, <span class="refTitle">"UDP Usage Guidelines"</span>, <span class="seriesInfo">BCP 145</span>, <span class="seriesInfo">RFC 8085</span>, <span class="seriesInfo">DOI 10.17487/RFC8085</span>, <time datetime="2017-03" class="refDate">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8085">https://www.rfc-editor.org/info/rfc8085</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8200">[RFC8200]</dt>
      <dd>
<span class="refAuthor">Deering, S.</span> and <span class="refAuthor">R. Hinden</span>, <span class="refTitle">"Internet Protocol, Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 86</span>, <span class="seriesInfo">RFC 8200</span>, <span class="seriesInfo">DOI 10.17487/RFC8200</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8200">https://www.rfc-editor.org/info/rfc8200</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="ProblemOfFragmentation">
<section id="appendix-A">
      <h2 id="name-weaknesses-of-ip-fragmentat">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-weaknesses-of-ip-fragmentat" class="section-name selfRef">Weaknesses of IP fragmentation</a>
      </h2>
<p id="appendix-A-1">"Fragmentation Considered Poisonous" <span>[<a href="#Herzberg2013" class="xref">Herzberg2013</a>]</span> proposed effective
off-path DNS cache poisoning attack vectors using IP fragmentation.
"IP fragmentation attack on DNS" <span>[<a href="#Hlavacek2013" class="xref">Hlavacek2013</a>]</span> and "Domain Validation++
For MitM-Resilient PKI" <span>[<a href="#Brandt2018" class="xref">Brandt2018</a>]</span> proposed that off-path attackers
can intervene in path MTU discovery <span>[<a href="#RFC1191" class="xref">RFC1191</a>]</span> to perform intentionally
fragmented responses from authoritative servers. <span>[<a href="#RFC7739" class="xref">RFC7739</a>]</span> stated the
security implications of predictable fragment identification values.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">DNSSEC is a countermeasure against cache poisoning attacks that use
IP fragmentation.
However, DNS delegation responses are not signed with DNSSEC,
and DNSSEC does not have a mechanism to get the correct response if
an incorrect delegation is injected. This is a denial-of-service
vulnerability that can yield failed name resolutions.
If cache poisoning attacks can be avoided,
DNSSEC validation failures will be avoided.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">In Section 3.2 (Message Side Guidelines) of UDP Usage Guidelines <span>[<a href="#RFC8085" class="xref">RFC8085</a>]</span>
we are told that an application SHOULD NOT send UDP datagrams
that result in IP packets that exceed the Maximum Transmission Unit (MTU)
along the path to the destination.<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<p id="appendix-A-4">A DNS message receiver cannot trust fragmented UDP datagrams primarily due to
the small amount of entropy provided by UDP port numbers and DNS message
identifiers, each of which being only 16 bits in size, and both likely
being in the first fragment of a packet, if fragmentation occurs.
By comparison, TCP protocol stack controls packet size and avoid IP fragmentation under ICMP NEEDFRAG attacks.
In TCP, fragmentation should be avoided for performance reasons, whereas for
UDP, fragmentation should be avoided for resiliency and authenticity reasons.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="details">
<section id="appendix-B">
      <h2 id="name-details-of-maximum-dns-udp-">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-details-of-maximum-dns-udp-" class="section-name selfRef">Details of maximum DNS/UDP payload size discussions</a>
      </h2>
<p id="appendix-B-1">There are many discussions for
default path MTU size and maximum DNS/UDP payload size.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-2.1">The minimum MTU for an IPv6 interface is 1280 octets
(see Section 5 of <span>[<a href="#RFC8200" class="xref">RFC8200</a>]</span>).
Then, we can use it as default path MTU value for IPv6.
The corresponding minimum MTU for an IPv4 interface is 68 (60 + 8)
<span>[<a href="#RFC0791" class="xref">RFC0791</a>]</span>.<a href="#appendix-B-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-2.2">Most of the Internet and especially the inner core has an MTU of at least 
1500 octets.
Maximum DNS/UDP payload size for IPv6 on MTU 1500 ethernet is
1452 (1500 minus 40 (IPv6 header size) minus 8 (UDP header size)).
To allow for possible IP options and distant tunnel overhead,
authors' recommendation of default maximum DNS/UDP payload size is 1400.<a href="#appendix-B-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-2.3">
          <span>[<a href="#RFC4035" class="xref">RFC4035</a>]</span> defines that "A security-aware name server MUST support
the EDNS0 message size extension, MUST support a message
size of at least 1220 octets". Then, the smallest number of
the maximum DNS/UDP payload size is 1220.<a href="#appendix-B-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-2.4">In order to avoid IP fragmentation,
<span>[<a href="#DNSFlagDay2020" class="xref">DNSFlagDay2020</a>]</span> proposed that the UDP requestors set the requestor's
payload size to 1232, and the UDP responders compose UDP responses fit
in 1232 octets.
The size 1232 is based on an MTU of 1280, which is required
by the IPv6 specification <span>[<a href="#RFC8200" class="xref">RFC8200</a>]</span>,
minus 48 octets for the IPv6 and UDP headers.<a href="#appendix-B-2.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-B-2.5">
          <span>[<a href="#Huston2021" class="xref">Huston2021</a>]</span> analyzed the result of <span>[<a href="#DNSFlagDay2020" class="xref">DNSFlagDay2020</a>]</span>, reported that
their measurements suggest that in the interior of the Internet
between recursive resolvers and authoritative servers
the prevailing MTU is at 1,500
and there is no measurable signal of use of smaller MTUs
in this part of the Internet, and proposed that
their measurements suggest setting the EDNS0 Buffer size to
IPv4 1472 octets and IPv6 1452 octets.<a href="#appendix-B-2.5" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="IP_MTU">
<section id="appendix-C">
      <h2 id="name-how-to-retrieve-path-mtu-va">
<a href="#appendix-C" class="section-number selfRef">Appendix C. </a><a href="#name-how-to-retrieve-path-mtu-va" class="section-name selfRef">How to retrieve path MTU value to a destination from applications</a>
      </h2>
<p id="appendix-C-1">Socket options: "IP_MTU (since Linux 2.2)
Retrieve the current known path MTU of the current socket.
Valid only when the socket has been connected.  Returns an integer.
Only valid as a getsockopt(2)."
(Quoted from Debian GNU Linux manual: ip(7))<a href="#appendix-C-1" class="pilcrow">¶</a></p>
<p id="appendix-C-2">"IPV6_MTU getsockopt(): Retrieve the current known path MTU of the current
socket.  Only valid when the socket has been connected.  Returns an integer."
(Quoted from Debian GNU Linux manual: ipv6(7))<a href="#appendix-C-2" class="pilcrow">¶</a></p>
<p id="appendix-C-3">Section 3.4 of <span>[<a href="#RFC1122" class="xref">RFC1122</a>]</span> specifies FIND_MAXSIZES()
as one of "INTERNET/TRANSPORT LAYER INTERFACEs".<a href="#appendix-C-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IP_MTU2">
<section id="appendix-D">
      <h2 id="name-how-to-retrieve-minimal-mtu">
<a href="#appendix-D" class="section-number selfRef">Appendix D. </a><a href="#name-how-to-retrieve-minimal-mtu" class="section-name selfRef">How to retrieve minimal MTU value to a destination</a>
      </h2>
<p id="appendix-D-1">The Linux tool "tracepath" can be used to measure the path MTU
to a destination.<a href="#appendix-D-1" class="pilcrow">¶</a></p>
<p id="appendix-D-2">Or, "ping/ping6" command with "-D"
 Don't Fragment bit set / Disable IPv6 fragmentation options.<a href="#appendix-D-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="minimal-responses">
<section id="appendix-E">
      <h2 id="name-minimal-responses">
<a href="#appendix-E" class="section-number selfRef">Appendix E. </a><a href="#name-minimal-responses" class="section-name selfRef">Minimal-responses</a>
      </h2>
<p id="appendix-E-1">Some implementations have 'minimal responses' configuration that causes
a DNS server to make response packets smaller, containing only mandatory and
required data.<a href="#appendix-E-1" class="pilcrow">¶</a></p>
<p id="appendix-E-2">Under the minimal-responses configuration,
DNS servers compose response messages using only RRSets corresponding to
queries.
In case of delegation, DNS servers compose response packets with
delegation NS RRSet in authority section 
and in-domain (in-zone and below-zone) glue in the additional data section.
In case of non-existent domain name or non-existent type,
the start of authority (SOA RR) will be placed in the Authority Section.<a href="#appendix-E-2" class="pilcrow">¶</a></p>
<p id="appendix-E-3">In addition, if the zone is DNSSEC signed and a query has the DNSSEC OK bit,
signatures are added in answer section,
or the corresponding DS RRSet and signatures are added in authority section.
Details are defined in <span>[<a href="#RFC4035" class="xref">RFC4035</a>]</span> and <span>[<a href="#RFC5155" class="xref">RFC5155</a>]</span>.<a href="#appendix-E-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-F">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Kazunori Fujiwara</span></div>
<div dir="auto" class="left"><span class="org">Japan Registry Services Co., Ltd.</span></div>
<div dir="auto" class="left">
<span class="street-address">Chiyoda First Bldg. East 13F, 3-8-1 Nishi-Kanda</span>, <span class="region">Chiyoda-ku, Tokyo</span>
</div>
<div dir="auto" class="left"><span class="postal-code">101-0065</span></div>
<div dir="auto" class="left"><span class="country-name">Japan</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+81%203%205215%208451" class="tel">+81 3 5215 8451</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:fujiwara@jprs.co.jp" class="email">fujiwara@jprs.co.jp</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Paul Vixie</span></div>
<div dir="auto" class="left"><span class="org">none</span></div>
<div dir="auto" class="left"><span class="street-address">11400 La Honda Road</span></div>
<div dir="auto" class="left">
<span class="locality">Woodside, CA</span>,  <span class="postal-code">94062</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+1%20650%20393%203994" class="tel">+1 650 393 3994</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:paul@redbarn.org" class="email">paul@redbarn.org</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
