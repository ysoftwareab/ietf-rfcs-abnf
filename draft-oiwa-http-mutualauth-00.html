<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Mutual Authentication Protocol for HTTP</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Mutual Authentication Protocol for HTTP">
<meta name="keywords" content="HTTP, authentication">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">Y. Oiwa</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">H. Watanabe</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">H. Takagi</td></tr>
<tr><td class="header">Expires: May 15, 2008</td><td class="header">RCIS, AIST</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">H. Suzuki</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Yahoo! Japan</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">November 12, 2007</td></tr>
</table></td></tr></table>
<h1><br />Mutual Authentication Protocol for HTTP<br />draft-oiwa-http-mutualauth-00</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 15, 2008.</p>

<h3>Abstract</h3>

<p>This document defines the "Mutual authentication protocol for
Hyper-Text Transport Protocol".  This protocol provides true
mutual authentication between HTTP clients and servers using
simple password-based authentication.  Unlike Basic and Digest HTTP
access authentication protocol, the protocol ensures that server
knows the user's entity (encrypted password) upon successful
authentication.  This prevents common phishing attacks: phishing
attackers cannot convince users that the user has been authenticated to
the genuine website.  Furthermore, even when user has been authenticated
against an illegitimate server, the server can not gain any bit of
information about user's passwords.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements Language<br />
<a href="#protocol overview">2.</a>&nbsp;
Protocol Overview<br />
<a href="#syntax">3.</a>&nbsp;
Message Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.1.</a>&nbsp;
Tokens and Ext-tokens<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.2.</a>&nbsp;
Numbers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.3.</a>&nbsp;
Strings<br />
<a href="#anchor6">4.</a>&nbsp;
Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#401-B0">4.1.</a>&nbsp;
401-B0<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.2.</a>&nbsp;
401-B0-stale<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.3.</a>&nbsp;
req-A1<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.4.</a>&nbsp;
401-B1<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">4.5.</a>&nbsp;
req-A3<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">4.6.</a>&nbsp;
200-B4<br />
<a href="#cli-decision">5.</a>&nbsp;
Decision procedure for the client<br />
<a href="#algorithm">6.</a>&nbsp;
Authentication Algorithms<br />
<a href="#validation">7.</a>&nbsp;
Validation Methods<br />
<a href="#session">8.</a>&nbsp;
Session Management<br />
<a href="#anchor12">9.</a>&nbsp;
Extension 1: Optional Mutual Authentication<br />
<a href="#anchor13">10.</a>&nbsp;
Methods to extend this protocol<br />
<a href="#IANA">11.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">12.</a>&nbsp;
Security Considerations<br />
<a href="#anchor14">13.</a>&nbsp;
Notice on intellectual properties<br />
<a href="#rfc.references1">14.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">14.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">14.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This document defines the "Mutual authentication protocol for
     Hyper-Text Transport Protocol".  This protocol provides true
     mutual authentication between HTTP clients and servers
     using simple password-based authentication.  Unlike Basic and
     Digest HTTP access authentication protocol, the protocol ensures
     that server knows the user's entity (encrypted password)
     upon successful authentication.  This prevents common phishing
     attacks: phishing attackers cannot convince users that the user
     has been authenticated to the genuine website.  Furthermore, even
     when user has been authenticated against an illegitimate server,
     the server can not gain any bit of information about user's
     passwords.
</p>
<p>Recently, phishing attacks are getting more and more
     sophisticated.  Phishers not only steal user's password directly,
     but imitate successful authentication to steal user's sensitive
     information, check the password validity by forwarding the
     password to the legitimate server, or employ a man-in-the-middle
     attack to hijack user's login session.  Existing countermeasures
     such as one-time passwords can not completely solve these
     problems.
</p>
<p>
     The protocol prevents such attacks by providing users a way to
     discriminate between true and fake web servers using their own
     passwords.  Even when a user inputs his/her password to a fake
     website, using this authentication method, any information about
     the password does not leak to the phisher, and the user certainly
     notices that the mutual authentication has failed.  Phishers
     cannot make such authentication attempt succeed, even if they
     forward received data from a user to the legitimate server or
     vice versa.  Users can safely input sensitive data to the web
     forms after confirming that the mutual authentication has
     succeeded.
     
</p>
<p>To achieve this goal, this protocol use a mechanism in <a href='ISO-11770-4'>ISO/IEC
        11770-4</a>, a kind of PAKE (Password-Authenticated Key Exchange)
        authentication algorithms as a basis.  The use of PAKE
        mechanism allows users to use familiar ID/password based
        accesses, without fear of leaking any password information to
        the communication peer.  The protocol, as a whole, is designed
        as a natural extension to the current HTTP authentication
        schema such as Basic and Digest access authentication (RFC
        2617). To use PAKE mechanism for such a purpose, we had to
        modify it to prevent credential forwarding (man-in-the-middle)
        attacks.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
        NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
        "OPTIONAL" in this document are to be interpreted as described
        in <a href='RFC2119'>RFC2119</a>.
</p>
<a name="protocol overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Protocol Overview</h3>

<p>The following sequence is a typical sequence for the first access to the resource.

</p>
<ul class="text">
<li>  If the server (S) has received a request for mutual-authentication
       protected resources from the Client (C) (which is not a req-A1
       nor a req-A3 message), it sends a 401-B0 message to C.
       <br />
<br />

       When C has received a 401-B0 message, C SHOULD check validity of the message.
       If succeed, C processes the body of the message, and enables the password entry field.
   
</li>
<li>  If the user has input the username and password as a response to
       the 401-B0 message, C creates a value s_A, calculates
       the value w_A, and construct and send a req-A1 message.
   
</li>
<li>  If S has received an req-A1 message, 
       S should record the received w_A value, validate
       w_A using T(w_A), and then look up the username from the
       user table. if the user is found, S prepares a
       new session id (sid), record it into a session table, and then 
       construct s_B, calculate w_B, and then send an 401-B1 message.
       <br />
<br />

       If there is no matching user found, the server SHOULD construct
       a fake w_B value, and let the protocol going on by sending an
       401-B1 message.
   
</li>
<li>  When C has received an 401-B1 message as a response for a req-A1 message,
       C should compute z and K_i, compute o_A, and send
       an req-A3 message.
       <br />
<br />

       If C receives any messages other than 
       401-B1, C MUST NOT process the message body and treat
       it as a fatal communication error condition.  This case includes
       the reception of HTTP OK (200-status) message.
   
</li>
<li>  If S has received an req-A3 message, S should look up the
       received sid from the session table.  If no matching sid message
       is received, or if S has not received the corresponding req-A1
       message beforehand, S SHOULD send an 401-B0-stale message.
       <br />
<br />

       Otherwise, S should computes o_A' and check its value.
       If the validation has failed, the server SHOULD send an 401-B0
       message.
       <br />
<br />

       If the validation has succeed, the server SHOULD calculate 
       o_B, and send a 200-B4 message.
   
</li>
<li> When C has received a 401-B0-stale message as a response to
       req-A3 message, and it is the first time that it has received a
       401-B0-stale message, C SHOULD redo constructing req-A1 message.
       <br />
<br />

       Instead, when C has received an 401-B0 message, it means the
       authentication has been failed, possibly due to that the wrong
       password has been given.  C MAY ignore the body of the 401-B0
       message in this case.
       <br />
<br />

       When C has received an 200-B4 message,
       C MUST first compute the value of o_B' and validates
       the value o_B sent from the server.
       If it has not verified successfully, C MUST ignore the
       body of the message, and treat it as a fatal communication error
       condition.  If it has succeed, C will process the body
       of the message.
       <br />
<br />

       If C receives any messages other than 401-B0-stale or
       401-B1, C SHOULD NOT process the message body and other headers and treat
       it as a fatal communication error condition.  This case includes
       the reception of usual HTTP OK (200-status) messages.
   
</li>
</ul><p>

</p>
<p>
For the second or later request to the server, if the client knows that
the resource is likely to require the authentication, the client MAY
omit first unauthenticated request and send req-A1 message immediately.
Furthermore, if client owns a valid session ID (sid), the client can
send a req-A3 message using existing sid.  In either case, the first
(and only the first) response from the server MAY be a normal,
unauthenticated message, and client MAY accept such messages.
For more detail, see <a class='info' href='#cli-decision'>Section&nbsp;5<span> (</span><span class='info'>Decision procedure for the client</span><span>)</span></a>.

</p>
<a name="syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Message Syntax</h3>

<p>
The Mutual authentication protocol uses four headers: WWW-Authenticate
(in responses with status code 401), Optional-WWW-Authenticate (in
responses with positive status codes), Authorization (in requests),
and Authentication-info (in positive responses).  These three headers
share the common syntax described in <a class='info' href='#figure-syntax'>Figure&nbsp;1<span> (</span><span class='info'>BNF syntax for the headers used in the protocol</span><span>)</span></a>.
The syntax is denoted in the augmented BNF syntax defined in <a href='RFC2616'>RFC2616</a>,
except that "a"..."b" means any ASCII characters between "a" and "b" inclusive.
The syntax is a subset of the one described in <a href='RFC2617'>RFC2617</a>.

</p><br /><hr class="insert" />
<a name="figure-syntax"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           header = header-name ":" spaces "Mutual" spaces fields
      header-name = "WWW-Authenticate" | "Optional-WWW-Authenticate"
                    | "Authorization" | "Authentication-info"
           spaces = 1*(SP | HT | CR LF 1*(SP | HT))+
           fields = field 0*("," spaces fields)
            field = key "=" value
              key = extensive-token
  extensive-token = token | extension-token
  extension-token = token "@" token
            token = 1*("0"..."9" | "A"..."Z" | "a"..."z"
                     | "-" | "_" | ".")
            value = extensive-token | integer | hex-integer
                  | hex-fixed-number
                  | base64-fixed-number | string
          integer = "0" | ("1"..."9") 0*("0"..."9")
      hex-integer = "0" |
                    ("1"..."9" | "A"..."F" | "a"..."f")
                    0*("0"..."9" | "A"..."F" | "a"..."f")
 hex-fixed-number = 1*("0"..."9" | "A"..."F" | "a"..."f")
 base64-fixed-number = string
           string = &lt;"&gt; *(&lt;TEXT except &lt;"&gt; and "\"&gt; | "\\" |
                          "\" &lt;"&gt; | "\,")* &lt;"&gt;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: BNF syntax for the headers used in the protocol&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Tokens and Ext-tokens</h3>

<p>
The tokens MUST be interpreted case-insensitive, and SHOULD be sent
in the same case as shown in the specification.  All hex-fixed-number or
hex-integer numbers are case-insensitive, and SHOULD be sent in
lower-case.

</p>
<p>
Extensive-tokens are used where the set of acceptable tokens are
extensible.  Any non-standard extensions of this protocol MUST use the
extension-tokens of format "&lt;token&gt;@&lt;domain-name&gt;", where domain-name is
the valid registered (sub-)domain name on the Internet owned by the
party who defines extensions.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Numbers</h3>

<p>
The syntax definitions of integer and
hex-integer only allow representations
which do not contain extra leading 0s.

</p>
<p>
The numbers represented as a hex-fixed-number SHALL have even
characters (i.e. multiple of eight bits).  When these are generated
from the cryptographic values, those SHOULD have the natural length:
if these are generated from a hash function, its lengths SHOULD
correspond to the hash size; if these are representing elements of a
mathematical group, its lengths SHOULD be the shortest which can
represent all elements in the group. Other values such as session-id
are represented in any (even) length determined by the side who
generates it first, and the same length SHALL be used throughout the
whole communications by both peers.

</p>
<p>
The numbers represented as a base64-fixed-number MUST be generated as follows:
first, the number is converted to a big-endian octet-string
representation.  The length of the representation is determined in the
same way as above.  Then, the string is BASE64-converted, and then
surrounded by two double-quotations.

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Strings</h3>

<p>
All strings outside ASCII or equivalent character sets SHOULD be
encoded using UTF-8 encoding of the ISO 10646-1 character set.
Both peers SHOULD reject any invalid UTF-8 sequences which causes 
decoding ambiguities (e.g. containing &lt;"&gt; in the
second or later byte of the UTF-8 encoded characters).
To encode character strings, these will first be encoded according to UTF-8, then
all occurrences of characters &lt;"&gt; and
"\" will be escaped by prepending "\", and
two &lt;"&gt;s will be put around the string.
If the contents of the strings are comma-separated values, the commas
in the values are also quoted by "\".

</p>
<p>
If strings are representing a domain name or URI which contains
non-ASCII characters, the host parts SHOULD be encoded
using puny-code instead of UTF-8, and SHOULD use lower-case ASCII characters.

</p>
<p>
For Base64-fixed-numbers, which use the string syntax, see the previous section.

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Messages</h3>

<a name="401-B0"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
401-B0</h3>

<p>
Every 401-B0 message must be an valid HTTP 401 (Authentication Required) message
containing one (and only one: hereafter not explicitly noticed)
"WWW-Authenticate" header of the following format.

</p>
<p>
WWW-Authenticate: Mutual algorithm=xxxx, validation=xxxx, realm=xxxx, stale=0

</p>
<p>
The header MUST contain the fields with the following keys:

</p>
<blockquote class="text"><dl>
<dt>algorithm:</dt>
<dd>(extensive-token) specifies the authentication algorithm to be used.
	    The value MUST be one of the tokens described in <a class='info' href='#algorithm'>Section&nbsp;6<span> (</span><span class='info'>Authentication Algorithms</span><span>)</span></a>, 
	    or the tokens specified in other supplemental specification documentations.
 
</dd>
<dt>validation:</dt>
<dd>(extensive-token) specifies the method of host validation.
	    The value MUST be one of the tokens described in <a class='info' href='#validation'>Section&nbsp;7<span> (</span><span class='info'>Validation Methods</span><span>)</span></a>,
	    or the tokens specified in other supplemental specification documentations.
 
</dd>
<dt>realm:</dt>
<dd>(string) is a UTF-8 encoded name of the authentication
	    domain inside the server.
 
</dd>
<dt>pwdhash:</dt>
<dd>(optional, extensive-token) specifies the hash algorithm
	    (referred to by ph) used for additionally hashing the password.
	    The valid tokens are
	    
<ul class="text">
<li> none: ph(p) = p
</li>
<li> md5: ph(p) = MD5(p)
</li>
<li> digest-md5: ph(p) defined as A1 in <a href='RFC2617'>RFC2617</a>.
</li>
<li> sha1: ph(p) = SHA1(p)
</li>
</ul>
	    If omitted, the value "none" is assumed.
 
</dd>
<dt>auth-domain:</dt>
<dd>(optional, string) MUST currently be equal to the
	    host-part of the requested URI, and assumed to have that
	    value if omitted.  The triple of auth-domain, algorithm,
	    and realm determines the "authentication realm" which
	    defines the area where the same user-name and passwords are applicable.
 
</dd>
<dt>stale:</dt>
<dd>(token) MUST be "0".

</dd>
</dl></blockquote><p>

</p>
<p>
Any additional fields MUST NOT be contained in the header, 
except those explicitly specified in supplement specifications of the "authentication algorithm".

</p>
<p>
The algorithm will determine the values for w_A, w_B, o_A and o_B.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
401-B0-stale</h3>

<p>
A 401-B0-stale message is a variant of 401-B0 message, which means that
the client has sent a request message which is not for any active session.

</p>
<p>
WWW-Authenticate: Mutual algorithm=xxxx, validation=xxxx, realm=xxxx, stale=1

</p>
<p>
The header MUST contain the same fields as in 401-B0, except the stale field holds the integer 1.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
req-A1</h3>

<p>
Every req-A1 message MUST be a valid HTTP request message containing a 
"Authorization" header of the following format.

</p>
<p>
Authorization: Mutual algorithm=xxxx, validation=xxxx, user=xxxx, realm=xxxx, wa=xxxx

</p>
<p>
The header MUST contain the fields with the following keys:

</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>algorithm, validation, auth-domain, realm:</dt>
<dd>MUST be the same value as it is received from S.
 
</dd>
<dt>user:</dt>
<dd>(string) is the UTF-8 encoded name of the user.
 
</dd>
<dt>wa:</dt>
<dd>(algorithm-determined) is the value of w_A specified by the used algorithm.

</dd>
</dl></blockquote><p>

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
401-B1</h3>

<p>
Every 401-B1 message MUST be an valid HTTP 401 (Authentication Required) message
containing a "WWW-Authenticate" header of the following format.

</p>
<p>
WWW-Authenticate: Mutual sid=xxxx, wb=xxxx, nc-max=x, nc-window=x, time=x, path=xxxx

</p>
<p>
The header MUST contain the fields with the following keys:

</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>sid:</dt>
<dd>(hex-fixed-number) MUST be a session id, which is a random
	    integer.  The sid SHOULD have uniqueness of at least 80 bits or
	    the square of the maximal estimated transactions
	    concurrently available in the session table, whichever is
	    larger.  Sids are local to each authentication realm
	    concerned: the same sids for different authentication realms
	    SHALL be treated as independent ones.
 
</dd>
<dt>wb:</dt>
<dd>(algorithm-determined) is the value of w_B specified by the algorithm.
 
</dd>
<dt>nc-max:</dt>
<dd>(hex-integer) is the maximal value of nonce counts which S accepts.
 
</dd>
<dt>nc-window:</dt>
<dd>(hex-integer) the number of available nonce slots which S prepares.
	    The value of nc-window is RECOMMENDED to be thirty-two ("20" in hex-integer) or more.
 
</dd>
<dt>time:</dt>
<dd>(integer) represents the suggested time (in
	    seconds) which C can reuse the session key represented by sid. It SHOULD at
	    least be 60. The value of this field is not directly linked to the
	    duration that S keeps track of the session represented by sid.
 
</dd>
<dt>path:</dt>
<dd>(string) specifies for which path in the URI space the same
	    authentication is expected to apply.  The value is the same format
	    as it is specified in <a href='RFC2617'>RFC2617</a> for the Digest authentications, and
	    client is RECOMMENDED to recognize it.  The all paths contained in the field SHALL be
            inside the specified auth-domain: if not, client SHOULD ignore such elements.

</dd>
</dl></blockquote><p>

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
req-A3</h3>

<p>
Every req-A3 message MUST be a valid HTTP request message containing a 
"Authorization" header of the following format.

</p>
<p>
Authorization: Mutual sid=xxxx, nc=x, oa=xxxx

</p>
<p>
The fields contained in the header is as follows:

</p>
<blockquote class="text"><dl>
<dt>sid:</dt>
<dd>(hex-fixed-number) MUST be one of the  sid values which has been received from S.
 
</dd>
<dt>nc:</dt>
<dd>(hex-integer) is a nonce value which is unique among the requests sharing the same sid.
	    The valie of nc MUST satisfy the following properties:
	    
<ul class="text">
<li> It is not larger than the nc-max value which has been
		 sent from S in the session represented by the sid.
</li>
<li> C have not sent the same value in the same session.
</li>
<li> It is not smaller than (largest-nc - nc-window),
		   where largest-nc is the maximal value of nc
		   which has previously been sent in the session,
		   and nc-window is the value of the nc-window field
		   which has been sent from S in the session.
</li>
</ul>
 
</dd>
<dt>oa:</dt>
<dd>(algorithm-determined) is the value of o_A specified by the algorithm.

</dd>
</dl></blockquote><p>

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
200-B4</h3>

<p>
Every 200-B1 message MUST be an valid HTTP message
which is not 401 (Authentication Required) type,
containing an "Authentication-Info" header of the following format.

</p>
<p>
Authentication-Info: Mutual sid=xxxx, ob=xxxx

</p>
<p>
The fields contained in the header is as follows:

</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>sid:</dt>
<dd>(hex-fixed-number) MUST be the value received from C.
 
</dd>
<dt>ob:</dt>
<dd>(algorithm-determined) is the value of o_B specified by the algorithm.
 
</dd>
<dt>logout-timeout:</dt>
<dd>(optional, integer) is a number of seconds after which the
	    client should re-validate the user's password for the authentication realm. As a special
	    case, the value 0 means that the client SHOULD automatically
	    forget the user-inputed password to the current
	    authentication realm and revert to the unauthenticated state (i.e.~server-initiated
	    logout).  This does not, however, mean that the long-term
	    memories for the passwords (such as password reminders and
	    auto fill-in) should be removed.
	    If new value of timeout is received for the same authentication realm,
	    it overrides the previous timeout.

</dd>
</dl></blockquote><p>

</p>
<a name="cli-decision"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Decision procedure for the client</h3>

<p>
To securely implementing the protocol, the user client must be careful
to accepting authenticated responses from the server.

</p>
<p>Clients SHOULD implement the decision procedure equivalent to the one shown below. 
(Unless implementers understand what is required for security, they should not alter this.)

</p>
<blockquote class="text"><dl>
<dt>Step 1</dt>
<dd>
  If the client software need to get a new Web resource, check
  whether the resource is expected to be inside some authentication realm for which the user
  has already authenticated.
  if yes, go to Step 2. Otherwise, go to Step 5.
  
</dd>
<dt>Step 2</dt>
<dd>
  Check whether there is an available sid for the authentication realm you expects.
  If there is one, go to Step 3. Other wise, go to Step 4.
  
</dd>
<dt>Step 3</dt>
<dd>
  Send a req-A3 request. 
  
<ul class="text">
<li>If you receive a 401-B0 message with a different authentication realm than expected,
    go to Step 6.
</li>
<li>If you receive a 401-B0-stale message, go to Step 9.
</li>
<li>If you receive a 401-B0 message, go to Step 13.
</li>
<li>If you receive a valid 200-B4 message, go to Step 14.
</li>
<li>If you receive a normal response (without Mutual-specific headers), go to Step 11.
</li>
</ul>
  
</dd>
<dt>Step 4</dt>
<dd>Send a req-A1 request.
  
<ul class="text">
<li>If you receive a 401-B0 message with a different authentication realm than expected,
    go to Step 6.
</li>
<li>If you receive a 401-B0-stale message, go to Step 9.
</li>
<li>If you receive a 401-B1 message, go to Step 10.
</li>
<li>If you receive a normal response (without Mutual-specific headers), go to Step 10.
</li>
</ul>
  
</dd>
<dt>Step 5</dt>
<dd>Send a request without any authentication headers.
  
<ul class="text">
<li>If you receive a 401-B0 message, go to Step 6.
</li>
<li>If you receive a normal response (without Mutual-specific headers), go to Step 11.
</li>
</ul>
  
</dd>
<dt>Step 6</dt>
<dd>Check whether you know the user's password for the requested authentication realm.
  If yes, go to Step 7.  Otherwise, go to Step 12.
</dd>
<dt>Step 7</dt>
<dd>
  Check whether there is an available sid for the authentication realm you expects.
  If there is one, go to Step 8. Other wise, go to Step 9.
  
</dd>
<dt>Step 8</dt>
<dd>
  Send a req-A3 request. 
  
<ul class="text">
<li>If you receive a 401-B0 message with a different authentication realm than expected,
    go to Step 6.
</li>
<li>If you receive a 401-B0-stale message, go to Step 9.
</li>
<li>If you receive a 401-B0 message, go to Step 13.
</li>
<li>If you receive a valid 200-B4 message, go to Step 14.
</li>
</ul>
  
</dd>
<dt>Step 9</dt>
<dd>Send a req-A1 request.
  
<ul class="text">
<li>If you receive a 401-B1 message, go to Step 10.
</li>
</ul>
  
</dd>
<dt>Step 10</dt>
<dd>
  Send a req-A3 request. 
  
<ul class="text">
<li>If you receive a 401-B0 message, go to Step 13.
</li>
<li>If you receive a valid 200-B4 message, go to Step 14.
</li>
</ul>
  
</dd>
<dt>Step 11</dt>
<dd>
  This case means that the resource requested is out of the authenticated contents area.
  The client will be in "UNAUTHENTICATED" status.
  
</dd>
<dt>Step 12</dt>
<dd>
  This case means that the resource requested requires mutual
  authentication, and the user is not authenticated yet.  The client
  will be in "AUTH_REQUESTED" status, is RECOMMENDED to process the
  content sent from the server and, SHOULD ask user a username and password.
  If the user has input those, go to Step 9.
  
</dd>
<dt>Step 13</dt>
<dd>
  This case means that in some reason the authentication failed:
  possibly the password or username is invalid for the authenticated
  resource.  Forget the password for the authentication realm and go to Step 12.
  
</dd>
<dt>Step 14</dt>
<dd>
  This case means that the mutual authentication has been succeeded.
  The client will be in "AUTH_SUCCEEDED" status.
  
</dd>
</dl></blockquote><p>

</p>
<p>
All other kind of responses than shown in above procedure SHOULD be
interpreted as fatal communication error, and in such cases user
clients MUST NOT process any data sent from the server.

</p>
<p>
The client software SHOULD show the three client status to the end-user.

</p>
<a name="algorithm"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Authentication Algorithms</h3>

<p>
This specification specified only one family of the authentication
algorithm.  The family consist of four authentication algorithms, which
only differ in underlying mathematical groups and security parameters.
The algorithms do not add any additional fields.  The tokens for
algorithms are
</p>
<ul class="text">
<li> "iso11770-4-ec-p256" for the 256-bit prime-field elliptic-curve setting.
</li>
<li> "iso11770-4-ec-p521" for the 521-bit prime-field elliptic-curve setting.
</li>
<li> "iso11770-4-dl-2048" for the 2048-bit discrete-logarithm setting.
</li>
<li> "iso11770-4-dl-4096" for the 4096-bit discrete-logarithm setting.
</li>
</ul><p>

</p>
<p>
The clients SHOULD support at least "iso11770-4-dl-2048"
algorithm, and RECOMMENDED to support all of the above four algorithms if possible.
The server software implementations SHOULD support at least "iso11770-4-dl-2048"
algorithm, unless it is known that users will not use it.

</p>
<p>
This algorithm uses Key-exchange-method-3 defined in <a href='ISO-11770-4'>ISO-11770-4</a> as a basis.

</p>
<p>
For the elliptic-curve settings, the underlying fields and the curves used
for elliptic-curve cryptography are the prime field and the Curve P-256
and P-511, respectively, specified in the appendix of FIPS PUB 186-2
specification.  The hash functions H are SHA-256 for P-256 curve and
SHA-512 for P-521 curve, respectively.  The representation of fields
wa, wb, oa, and ob is hex-fixed-number.

</p>
<p>
For discrete-logarithm settings, the underlying groups are 2048-bit
and 4096-bit MODP group defined in <a href='RFC3526'>RFC3526</a> respectively.
The hash functions H are SHA-256 for
2048-bit field and SHA-512 for 4096-bit field, respectively.
The representation of fields wa, wb, oa, and ob is base64-fixed-number.

</p>
<p>
The password-based string pi used by this authentication is derived in the
following manner:

</p>
<p>
 pi = H(VS(algorithm) | VS(auth-domain) | VS(realm) | VS(username) | VS(ph(password)).

</p>
<p>
The values of algorithm, realm and auth-domain are taken from the values contained
in the 401-B0 message.
When pi is used in the context of an octet string, it MUST have
the natural length derived from the bit-length of the output of function
H (e.g. 32 octets for SHA-256).  The function ph is defined by
the value of the pwdhash given in a 401-B0 message.

</p>
<p>
The function VS encodes variable-length octet string into decodable
octet string, as in the following manner:

</p>
<p>
 VS(s) = VI(length(s)) | s,

</p>
<p>
where length(s) is a number of octets (not characters) in s and the function 
VI converts integer into octet string in the manner which is used
for the length field in DER format.  Shortly, integers are represented in
big-endian radix-128 string, where each digit is represented by a octet
0x80&ndash;0xff except for the last digit represented by 0x00&ndash;0x7f.
The first octet MUST NOT be 0x80.
For example, VI(i) = octet(i) for i < 128,
and VI(i) = octet(0x80 | (i &gt;&gt; 7)) | octet(i &amp; 127) for 128 &lt;= i < 16384.

</p>
<p>
The equation for J, w_A, T, z, K_i, and w_B is the one specified in the
documentation of ISO-11770-4, given that pi is derived in the above equation.

</p>
<p>
The value o_A (o_A') and o_B (o_B') is derived by the following equation, instead of ones specified in ISO 11770-4.

</p>
<p>
 o_A = H(hex(04) | GEtoOS_x(w_A) | GEtoOS_x(W_B) | GEtoOS_x(z) | GEtoOS_x(g_1) | VI(nc) | VS(v))
<br />
<br />

 o_B = H(hex(03) | GEtoOS_x(w_A) | GEtoOS_x(W_B) | GEtoOS_x(z) | GEtoOS_x(g_1) | VI(nc) | VS(v))

</p>
<a name="validation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Validation Methods</h3>

<p>
The "validation methods" specifies a method to "relates" the mutual
authentication processed by this protocol with other authentications
already performed in the underlying layers. It decides the value of v,
which is an input to the authentication protocol.

</p>
<p>
The meaning of the validation method field and corresponding values of v
is as follows:

</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>host:</dt>
<dd> hostname validation: v will be the ASCII string in the
       following format: "scheme://host:port".
       The scheme and host are lower-case, and the port is in a shortest
       decimal representation.  Even if the request-URI do not have a
       port part, v will include the one.
</dd>
<dt>tls-cert:</dt>
<dd> TLS certificate validation: v will be the octet string of
       the fingerprint of the public key certificate used in underlying
       TLS/SSL connection.
</dd>
<dt>tls-key:</dt>
<dd> TLS shared-key validation: v will be the octet string of
       the pre-shared secret negotiated in underlying TLS/SSL connection.
</dd>
</dl></blockquote><p>

</p>
<p>
If HTTP protocol is used on unencrypted channel, the validation type
MUST be "host".  If HTTPS protocol with server certificates is
used, the validation type MUST be either "tls-cert" or
"tls-key".  If HTTPS protocol is used with anonymous
Diffie-Hellman key exchange, the validation type MUST be
"tls-key" (but see the note below).

</p>
<p>
The client MUST validate this field upon reception of 401-B0 messages.

</p>
<p>
However, when the protocol is used on web browsers with any scripting
capabilities, anonymous Diffie-Hellman family of TLS/SSL cipher-suite
MUST NOT be used even if "tls-key" validated Mutual
authentication has been employed, and the certificate shown in TLS/SSL
negotiation MUST be verified using PKI. For other systems, if the
"tls-key" validation is used on TLS/SSL protocol without
certificate verification using PKI, those systems MUST ensure that all
transactions with authenticated peer server MUST use and be validated by
the Mutual authentication protocol, regardless of the existence of the
401-B0 responses.

</p>
<a name="session"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Session Management</h3>

<p>
By the first 4 messages (first request, 401-B0, req-A1 and 401-B1), a
session represented by a sid is generated.  This session can be used
for 1 or more requests for resources protected by the same realm in the
same server.

</p>
<p>
The server SHOULD accept at least one req-A3 request for each sessions
(given that the request reaches to the server in a time window specified
by the timeout field specified in the 401-B1 message).  After that, the
server can discard any session at any time and send 401-B0-stale
messages for any req-A3 requests.

</p>
<p>
The client can send more than 1 requests using a single session
specified by the sid.  However, for all such requests, the values of the
nonce-counter (nc field) MUST be different from each other.  The server
MUST check for duplication of the received nonces, and if any
duplication is detected, the server MUST discard the session and respond
by a 401-B1-stale message.

</p>
<p>
In addition, for each sessions, if the client has already sent a request
with nonce value x, it SHOULD NOT sent requests with nonce value not
larger than (x - nc-window) afterwards. The server MAY reject
any requests with nonces violating this rule with 401-B1-stale responses.

</p>
<p>
The value of nonces and nonce-related values MUST always be treated as a
natural number within infinite range.  Implementations using fixed-width
integers or fixed-precision floating numbers MUST handle integer
overflow correctly and carefully.  Such implementations are RECOMMENDED
to accept any larger values from the peer which cannot be represented in
the fixed-width integer representations, as long as other limits such as
internal header-length restrictions are involved.
The protocol is designed carefully so that both clients and servers
can be implemented the protocol only with
fixed-width integers, by rounding any
overflowed value into the maximum possible value.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Extension 1: Optional Mutual Authentication</h3>

<p>
In several Web applications, users can access the same contents both as
a guest user and as a authenticated users.  In usual Web applications,
it is implemented using Cookies and custom form-based authentications.
The extension described in this section provides a replacement for
those authentication systems.

</p>
<p>
Every HTTP successful responses (response code 200, 206 and others) to
GET requests which do not contain Authentication-Info: header can
contain the Optional-WWW-Authenticate header.  Such messages are
hereafter called 200-Optional-B0 messages.

</p>
<blockquote class="text">
<p>
HTTP/1.1 200 OK<br />

Optional-WWW-Authenticate: Mutual algorithm=xxxx,
                           validation=xxxx, realm=xxxx, stale=0

</p>
</blockquote><p>

</p>
<p>
The fields contained in the Optional-WWW-Authenticate header is the same as
the 401-B0 message described in <a class='info' href='#401-B0'>Section&nbsp;4.1<span> (</span><span class='info'>401-B0</span><span>)</span></a>.
The client software supporting the mutual authentication protocol receiving
a 200-Optional-B0 message will process the contents of the message and
enables an authentication input field.

</p>
<p>
When the user input the username and password, the client resends the
request with req-A1 header.  The server MUST respond with a 401-B1
message.  200-Optional-B0 response SHOULD NOT be sent as a response to
req-A1 and req-A3 messages, unless the authentication realm sent from
the client (or indicated by sid) is different from the one which the server requests.

</p>
<p>
The client software supporting optional mutual authentication MUST
recognize the "Path" field contained in 200-B4 message, and MUST send
either req-A1 or req-A3 request for the URI space inside the specified
"path"s, instead of unauthenticated requests.

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Methods to extend this protocol</h3>

<p>
If a non-standard extensions to the this protocol is implemented, 
it SHOULD use the extension-tokens defined in
<a class='info' href='#syntax'>Section&nbsp;3<span> (</span><span class='info'>Message Syntax</span><span>)</span></a> to avoid conflicts with this protocol and other
extensions.

</p>
<p>
Authentication algorithms other than those defined in this document
MAY use other representations for keys "wa", "wb", "oa" and
"ob", replace those keys, and/or add fields to the messages containing
those fields by supplemental specifications.
Those specifications are RECOMMENDED to use extension-tokens 
to avoid any key-name conflict with the future extension of this protocol.

</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
IANA Considerations</h3>

<p>The tokens used for authentication-algorithm, pwd-hash, validation
MUST be registered to and assigned by IANA.  All registered tokens
must be defined by at least Informational RFC or similar
standardization processes.  Extension-tokens MAY be freely used for
any non-standard or experimental uses for those fields provided that
the domain part in the token is appropriately used.

</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Security Considerations</h3>

<p>
</p>
<ul class="text">
<li>   To securely implement the protocol, the Authentication-Info
       headers in the 200-B4 messages MUST always be validated by the
       client. If the validation is failed, the client MUST NOT process
       any content sent with the message, including the body part.
       Non-compliance to this will enable the phishing attacks.

</li>
<li>
       The authentication status on the client-side SHOULD be visible to
       the users of the client.  In addition, the method for asking
       user's name and passwords SHOULD be carefully designed so that
       (1) the user can easily distinguish request of this
       authentication methods from existing insecure authentication
       methods such as Basic methods, and (2) the Web contents cannot
       imitate the user-interfaces of this protocol.

</li>
<li>
       For TLS communications, when a web form is submitted from
       PAKE-authenticated pages with the validation methods of
       "tls-cert" to an URI which is protected by the same realm (so
       indicated by the path parameter), if server certificate
       has been changed since the pages has been received, the peer
       is RECOMMENDED to be revalidated using a req-A1 message with an
       "Expect: continue" header.  The same applies when the
       page is received with the validation methods of "tls-key", and
       when the TLS session has been expired.

</li>
<li>
       Server-side storage of the user passwords is RECOMMENDED to have
       the values encrypted by one-way function J(pi),
       instead of the real passwords, those hashed by ph, or pi.

</li>
</ul><p>

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Notice on intellectual properties</h3>

<p>
The National Institute of Advanced Industrial Science and Technology (AIST) and
Yahoo! Japan, Inc. has jointly submitted a patent application about the
protocol proposed in this documentation to the Patent Office of Japan.
The patent is intended to be open to any implementors of this protocol
and its variants under non-exclusive royalty-free manner without any
contracts with the patent owners once the protocol is accepted as a
Internet standard.
For the detail of the patent application, contact the author of this document.

</p>
<p>
The elliptic-curve based authentication algorithms might involve several
existing patents of third-parties.  The authors of the document take no
position regarding the validity or scope of such patents, and other patents
as well.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ISO-11770-4">[ISO-11770-4]</a></td>
<td class="author-text">International Organization for Standardization, &ldquo;ISO/IEC 11770-4:2006: Information technology &ndash; Security techniques &ndash; Key management &ndash; Part 4: Mechanisms based on weak secrets,&rdquo; 2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3526">[RFC3526]</a></td>
<td class="author-text">Kivinen, T. and M. Kojo, &ldquo;<a href="http://tools.ietf.org/html/rfc3526">More Modular Exponential (MODP) Diffie-Hellman groups for Internet Key Exchange (IKE)</a>,&rdquo; RFC&nbsp;3526, May&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3526.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2616.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2617">[RFC2617]</a></td>
<td class="author-text"><a href="mailto:john@math.nwu.edu">Franks, J.</a>, <a href="mailto:pbaker@verisign.com">Hallam-Baker, P.</a>, <a href="mailto:jeff@AbiSource.com">Hostetler, J.</a>, <a href="mailto:lawrence@agranat.com">Lawrence, S.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, Luotonen, A., and <a href="mailto:stewart@OpenMarket.com">L. Stewart</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and Digest Access Authentication</a>,&rdquo; RFC&nbsp;2617, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2617.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2617.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2617.xml">XML</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yutaka Oiwa</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">National Institute of Advanced Industrial Science and Technology</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Research Center for Information Security</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Akihabara Daibiru #1102</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1-18-13 Sotokanda</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chiyoda-ku, Tokyo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">JP</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 3-5298-4722</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:y.oiwa@aist.go.jp">y.oiwa@aist.go.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hajime Watanabe</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">National Institute of Advanced Industrial Science and Technology</td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hiromitsu Takagi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">National Institute of Advanced Industrial Science and Technology</td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hirofumi Suzuki</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yahoo! Japan, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Roppongi Hills Mori Tower</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">6-10-1 Roppongi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Minato-ku, Tokyo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">JP</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 3-6440-6290</td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2007).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
