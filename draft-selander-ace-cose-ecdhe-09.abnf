exchange_hash = H( H( message_1 | message_2 ) | message_3 )

message_1 = [
     MSG_TYPE : int,
     S_U : bstr,
     ECDH-Curves_U : alg_array,
     ECDH-Curve_U : uint,
     X_U : bstr,
     HKDFs_U : alg_array,
     AEADs_U : alg_array,
     SIGs_V : alg_array,
     SIGs_U : alg_array,
     ? UAD_1 : bstr
alg_array = [ + alg : int / tstr ]

ERR_MSG = "Curve not supported; Z"

message_2 = [
     data_2,
     CIPHERTEXT_2 : bstr
data_2 = (
     MSG_TYPE : int,
     S_U : bstr / nil,
     S_V : bstr,
     X_V : bstr,
     HKDF_V : uint,
     AEAD_V : uint,
     SIG_V : uint,
     SIG_U : uint,
aad_2 = H( message_1 | [ data_2 ] )

message_3 = [
     data_3,
     CIPHERTEXT_3 : bstr
data_3 = (
     MSG_TYPE : int,
     S_V : bstr
aad_3 = H( H( message_1 | message_2 ) | [ data_3 ] )


message_1 = [
     data_1
data_1 = (
     MSG_TYPE : int,
     S_U : bstr,
     ECDH-Curves_U : alg_array,
     ECDH-Curve_U : uint,
     X_U : bstr,
     HKDFs_U : alg_array,
     AEADs_U : alg_array,
     KID : bstr,
     ? UAD_1 : bstr
serialized_COSE_Key = bstr .cbor COSE_Key

alg_array = [ + alg : int / tstr ]

message_2 = [
     data_2,
     CIPHERTEXT_2 : bstr
data_2 = (
     MSG_TYPE : int,
     S_U : bstr / nil,
     S_V : bstr,
     X_V : bstr,
     HKDF_V : uint,
     AEAD_V : uint
aad_2 = H( message_1 | [ data_2 ] )

message_3 = [
     data_3,
     CIPHERTEXT_3 : bstr
data_3 = (
     MSG_TYPE : int,
     S_V : bstr
aad_3 = H( H( message_1 | message_2 ) | [ data_3 ] )

error = [
     MSG_TYPE : int,
     ? ERR_MSG : tstr
message1 = [
     1,
     h'c3',
     [4],
     0,
     'abcdefghijklmnopqrstuvwxyz123456',
     [-27],
     [10],
     [-8],
     [-8]
plaintext = [
     { 4 : 'abba' },
     'abcdefghijklmnopqrstuvwxyz123456abcdefghijklmnopqrstuvwxyz123456'
message2 = [
  2,
  null,
  h'c4',
  'abcdefghijklmnopqrstuvwxyz123456',
  0,
  0,
  0,
  0,
  'abcdefghijklmnopqrstuvwxyz123456abcdefghijklmnopqrstuvwxyz123456abcdefghijklmnopqr'
message3 = [
  3,
  h'c3',
  'abcdefghijklmnopqrstuvwxyz123456abcdefghijklmnopqrstuvwxyz123456abcdefghijklmnopqr'
